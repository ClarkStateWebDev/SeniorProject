{"ast":null,"code":"/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.6.2 (2020-12-08)\n */\n(function () {\n  'use strict';\n\n  var typeOf = function (x) {\n    if (x === null) {\n      return 'null';\n    }\n\n    if (x === undefined) {\n      return 'undefined';\n    }\n\n    var t = typeof x;\n\n    if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    }\n\n    if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    }\n\n    return t;\n  };\n\n  var isEquatableType = function (x) {\n    return ['undefined', 'boolean', 'number', 'string', 'function', 'xml', 'null'].indexOf(x) !== -1;\n  };\n\n  var sort = function (xs, compareFn) {\n    var clone = Array.prototype.slice.call(xs);\n    return clone.sort(compareFn);\n  };\n\n  var contramap = function (eqa, f) {\n    return eq(function (x, y) {\n      return eqa.eq(f(x), f(y));\n    });\n  };\n\n  var eq = function (f) {\n    return {\n      eq: f\n    };\n  };\n\n  var tripleEq = eq(function (x, y) {\n    return x === y;\n  });\n  var eqString = tripleEq;\n\n  var eqArray = function (eqa) {\n    return eq(function (x, y) {\n      if (x.length !== y.length) {\n        return false;\n      }\n\n      var len = x.length;\n\n      for (var i = 0; i < len; i++) {\n        if (!eqa.eq(x[i], y[i])) {\n          return false;\n        }\n      }\n\n      return true;\n    });\n  };\n\n  var eqSortedArray = function (eqa, compareFn) {\n    return contramap(eqArray(eqa), function (xs) {\n      return sort(xs, compareFn);\n    });\n  };\n\n  var eqRecord = function (eqa) {\n    return eq(function (x, y) {\n      var kx = Object.keys(x);\n      var ky = Object.keys(y);\n\n      if (!eqSortedArray(eqString).eq(kx, ky)) {\n        return false;\n      }\n\n      var len = kx.length;\n\n      for (var i = 0; i < len; i++) {\n        var q = kx[i];\n\n        if (!eqa.eq(x[q], y[q])) {\n          return false;\n        }\n      }\n\n      return true;\n    });\n  };\n\n  var eqAny = eq(function (x, y) {\n    if (x === y) {\n      return true;\n    }\n\n    var tx = typeOf(x);\n    var ty = typeOf(y);\n\n    if (tx !== ty) {\n      return false;\n    }\n\n    if (isEquatableType(tx)) {\n      return x === y;\n    } else if (tx === 'array') {\n      return eqArray(eqAny).eq(x, y);\n    } else if (tx === 'object') {\n      return eqRecord(eqAny).eq(x, y);\n    }\n\n    return false;\n  });\n\n  var noop = function () {};\n\n  var compose = function (fa, fb) {\n    return function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      return fa(fb.apply(null, args));\n    };\n  };\n\n  var compose1 = function (fbc, fab) {\n    return function (a) {\n      return fbc(fab(a));\n    };\n  };\n\n  var constant = function (value) {\n    return function () {\n      return value;\n    };\n  };\n\n  var identity = function (x) {\n    return x;\n  };\n\n  function curry(fn) {\n    var initialArgs = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      initialArgs[_i - 1] = arguments[_i];\n    }\n\n    return function () {\n      var restArgs = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        restArgs[_i] = arguments[_i];\n      }\n\n      var all = initialArgs.concat(restArgs);\n      return fn.apply(null, all);\n    };\n  }\n\n  var not = function (f) {\n    return function (t) {\n      return !f(t);\n    };\n  };\n\n  var die = function (msg) {\n    return function () {\n      throw new Error(msg);\n    };\n  };\n\n  var call = function (f) {\n    f();\n  };\n\n  var never = constant(false);\n  var always = constant(true);\n\n  var none = function () {\n    return NONE;\n  };\n\n  var NONE = function () {\n    var eq = function (o) {\n      return o.isNone();\n    };\n\n    var call = function (thunk) {\n      return thunk();\n    };\n\n    var id = function (n) {\n      return n;\n    };\n\n    var me = {\n      fold: function (n, _s) {\n        return n();\n      },\n      is: never,\n      isSome: never,\n      isNone: always,\n      getOr: id,\n      getOrThunk: call,\n      getOrDie: function (msg) {\n        throw new Error(msg || 'error: getOrDie called on none.');\n      },\n      getOrNull: constant(null),\n      getOrUndefined: constant(undefined),\n      or: id,\n      orThunk: call,\n      map: none,\n      each: noop,\n      bind: none,\n      exists: never,\n      forall: always,\n      filter: none,\n      equals: eq,\n      equals_: eq,\n      toArray: function () {\n        return [];\n      },\n      toString: constant('none()')\n    };\n    return me;\n  }();\n\n  var some = function (a) {\n    var constant_a = constant(a);\n\n    var self = function () {\n      return me;\n    };\n\n    var bind = function (f) {\n      return f(a);\n    };\n\n    var me = {\n      fold: function (n, s) {\n        return s(a);\n      },\n      is: function (v) {\n        return a === v;\n      },\n      isSome: always,\n      isNone: never,\n      getOr: constant_a,\n      getOrThunk: constant_a,\n      getOrDie: constant_a,\n      getOrNull: constant_a,\n      getOrUndefined: constant_a,\n      or: self,\n      orThunk: self,\n      map: function (f) {\n        return some(f(a));\n      },\n      each: function (f) {\n        f(a);\n      },\n      bind: bind,\n      exists: bind,\n      forall: bind,\n      filter: function (f) {\n        return f(a) ? me : NONE;\n      },\n      toArray: function () {\n        return [a];\n      },\n      toString: function () {\n        return 'some(' + a + ')';\n      },\n      equals: function (o) {\n        return o.is(a);\n      },\n      equals_: function (o, elementEq) {\n        return o.fold(never, function (b) {\n          return elementEq(a, b);\n        });\n      }\n    };\n    return me;\n  };\n\n  var from = function (value) {\n    return value === null || value === undefined ? NONE : some(value);\n  };\n\n  var Optional = {\n    some: some,\n    none: none,\n    from: from\n  };\n\n  var typeOf$1 = function (x) {\n    var t = typeof x;\n\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n\n  var isType = function (type) {\n    return function (value) {\n      return typeOf$1(value) === type;\n    };\n  };\n\n  var isSimpleType = function (type) {\n    return function (value) {\n      return typeof value === type;\n    };\n  };\n\n  var eq$1 = function (t) {\n    return function (a) {\n      return t === a;\n    };\n  };\n\n  var isString = isType('string');\n  var isObject = isType('object');\n  var isArray = isType('array');\n  var isNull = eq$1(null);\n  var isBoolean = isSimpleType('boolean');\n  var isUndefined = eq$1(undefined);\n\n  var isNullable = function (a) {\n    return a === null || a === undefined;\n  };\n\n  var isNonNullable = function (a) {\n    return !isNullable(a);\n  };\n\n  var isFunction = isSimpleType('function');\n  var isNumber = isSimpleType('number');\n  var nativeSlice = Array.prototype.slice;\n  var nativeIndexOf = Array.prototype.indexOf;\n  var nativePush = Array.prototype.push;\n\n  var rawIndexOf = function (ts, t) {\n    return nativeIndexOf.call(ts, t);\n  };\n\n  var indexOf = function (xs, x) {\n    var r = rawIndexOf(xs, x);\n    return r === -1 ? Optional.none() : Optional.some(r);\n  };\n\n  var contains = function (xs, x) {\n    return rawIndexOf(xs, x) > -1;\n  };\n\n  var exists = function (xs, pred) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n\n      if (pred(x, i)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var map = function (xs, f) {\n    var len = xs.length;\n    var r = new Array(len);\n\n    for (var i = 0; i < len; i++) {\n      var x = xs[i];\n      r[i] = f(x, i);\n    }\n\n    return r;\n  };\n\n  var each = function (xs, f) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n\n  var eachr = function (xs, f) {\n    for (var i = xs.length - 1; i >= 0; i--) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n\n  var partition = function (xs, pred) {\n    var pass = [];\n    var fail = [];\n\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      var arr = pred(x, i) ? pass : fail;\n      arr.push(x);\n    }\n\n    return {\n      pass: pass,\n      fail: fail\n    };\n  };\n\n  var filter = function (xs, pred) {\n    var r = [];\n\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n\n      if (pred(x, i)) {\n        r.push(x);\n      }\n    }\n\n    return r;\n  };\n\n  var foldr = function (xs, f, acc) {\n    eachr(xs, function (x) {\n      acc = f(acc, x);\n    });\n    return acc;\n  };\n\n  var foldl = function (xs, f, acc) {\n    each(xs, function (x) {\n      acc = f(acc, x);\n    });\n    return acc;\n  };\n\n  var findUntil = function (xs, pred, until) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n\n      if (pred(x, i)) {\n        return Optional.some(x);\n      } else if (until(x, i)) {\n        break;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var find = function (xs, pred) {\n    return findUntil(xs, pred, never);\n  };\n\n  var findIndex = function (xs, pred) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n\n      if (pred(x, i)) {\n        return Optional.some(i);\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var flatten = function (xs) {\n    var r = [];\n\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n\n      nativePush.apply(r, xs[i]);\n    }\n\n    return r;\n  };\n\n  var bind = function (xs, f) {\n    return flatten(map(xs, f));\n  };\n\n  var forall = function (xs, pred) {\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      var x = xs[i];\n\n      if (pred(x, i) !== true) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  var reverse = function (xs) {\n    var r = nativeSlice.call(xs, 0);\n    r.reverse();\n    return r;\n  };\n\n  var difference = function (a1, a2) {\n    return filter(a1, function (x) {\n      return !contains(a2, x);\n    });\n  };\n\n  var mapToObject = function (xs, f) {\n    var r = {};\n\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      r[String(x)] = f(x, i);\n    }\n\n    return r;\n  };\n\n  var sort$1 = function (xs, comparator) {\n    var copy = nativeSlice.call(xs, 0);\n    copy.sort(comparator);\n    return copy;\n  };\n\n  var get = function (xs, i) {\n    return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n  };\n\n  var head = function (xs) {\n    return get(xs, 0);\n  };\n\n  var last = function (xs) {\n    return get(xs, xs.length - 1);\n  };\n\n  var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n    return nativeSlice.call(x);\n  };\n\n  var findMap = function (arr, f) {\n    for (var i = 0; i < arr.length; i++) {\n      var r = f(arr[i], i);\n\n      if (r.isSome()) {\n        return r;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var keys = Object.keys;\n  var hasOwnProperty = Object.hasOwnProperty;\n\n  var each$1 = function (obj, f) {\n    var props = keys(obj);\n\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n\n  var map$1 = function (obj, f) {\n    return tupleMap(obj, function (x, i) {\n      return {\n        k: i,\n        v: f(x, i)\n      };\n    });\n  };\n\n  var tupleMap = function (obj, f) {\n    var r = {};\n    each$1(obj, function (x, i) {\n      var tuple = f(x, i);\n      r[tuple.k] = tuple.v;\n    });\n    return r;\n  };\n\n  var objAcc = function (r) {\n    return function (x, i) {\n      r[i] = x;\n    };\n  };\n\n  var internalFilter = function (obj, pred, onTrue, onFalse) {\n    var r = {};\n    each$1(obj, function (x, i) {\n      (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n    return r;\n  };\n\n  var bifilter = function (obj, pred) {\n    var t = {};\n    var f = {};\n    internalFilter(obj, pred, objAcc(t), objAcc(f));\n    return {\n      t: t,\n      f: f\n    };\n  };\n\n  var filter$1 = function (obj, pred) {\n    var t = {};\n    internalFilter(obj, pred, objAcc(t), noop);\n    return t;\n  };\n\n  var mapToArray = function (obj, f) {\n    var r = [];\n    each$1(obj, function (value, name) {\n      r.push(f(value, name));\n    });\n    return r;\n  };\n\n  var values = function (obj) {\n    return mapToArray(obj, function (v) {\n      return v;\n    });\n  };\n\n  var get$1 = function (obj, key) {\n    return has(obj, key) ? Optional.from(obj[key]) : Optional.none();\n  };\n\n  var has = function (obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  var hasNonNullableKey = function (obj, key) {\n    return has(obj, key) && obj[key] !== undefined && obj[key] !== null;\n  };\n\n  var equal = function (a1, a2, eq) {\n    if (eq === void 0) {\n      eq = eqAny;\n    }\n\n    return eqRecord(eq).eq(a1, a2);\n  };\n\n  var isArray$1 = Array.isArray;\n\n  var toArray = function (obj) {\n    if (!isArray$1(obj)) {\n      var array = [];\n\n      for (var i = 0, l = obj.length; i < l; i++) {\n        array[i] = obj[i];\n      }\n\n      return array;\n    } else {\n      return obj;\n    }\n  };\n\n  var each$2 = function (o, cb, s) {\n    var n, l;\n\n    if (!o) {\n      return false;\n    }\n\n    s = s || o;\n\n    if (o.length !== undefined) {\n      for (n = 0, l = o.length; n < l; n++) {\n        if (cb.call(s, o[n], n, o) === false) {\n          return false;\n        }\n      }\n    } else {\n      for (n in o) {\n        if (o.hasOwnProperty(n)) {\n          if (cb.call(s, o[n], n, o) === false) {\n            return false;\n          }\n        }\n      }\n    }\n\n    return true;\n  };\n\n  var map$2 = function (array, callback) {\n    var out = [];\n    each$2(array, function (item, index) {\n      out.push(callback(item, index, array));\n    });\n    return out;\n  };\n\n  var filter$2 = function (a, f) {\n    var o = [];\n    each$2(a, function (v, index) {\n      if (!f || f(v, index, a)) {\n        o.push(v);\n      }\n    });\n    return o;\n  };\n\n  var indexOf$1 = function (a, v) {\n    if (a) {\n      for (var i = 0, l = a.length; i < l; i++) {\n        if (a[i] === v) {\n          return i;\n        }\n      }\n    }\n\n    return -1;\n  };\n\n  var reduce = function (collection, iteratee, accumulator, thisArg) {\n    var acc = isUndefined(accumulator) ? collection[0] : accumulator;\n\n    for (var i = 0; i < collection.length; i++) {\n      acc = iteratee.call(thisArg, acc, collection[i], i);\n    }\n\n    return acc;\n  };\n\n  var findIndex$1 = function (array, predicate, thisArg) {\n    var i, l;\n\n    for (i = 0, l = array.length; i < l; i++) {\n      if (predicate.call(thisArg, array[i], i, array)) {\n        return i;\n      }\n    }\n\n    return -1;\n  };\n\n  var last$1 = function (collection) {\n    return collection[collection.length - 1];\n  };\n\n  var __assign = function () {\n    __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n\n      return t;\n    };\n\n    return __assign.apply(this, arguments);\n  };\n\n  function __rest(s, e) {\n    var t = {};\n\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n    if (s != null && typeof Object.getOwnPropertySymbols === 'function') for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n      if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n    }\n    return t;\n  }\n\n  function __spreadArrays() {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n    for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n    return r;\n  }\n\n  var cached = function (f) {\n    var called = false;\n    var r;\n    return function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      if (!called) {\n        called = true;\n        r = f.apply(null, args);\n      }\n\n      return r;\n    };\n  };\n\n  var DeviceType = function (os, browser, userAgent, mediaMatch) {\n    var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\n    var isiPhone = os.isiOS() && !isiPad;\n    var isMobile = os.isiOS() || os.isAndroid();\n    var isTouch = isMobile || mediaMatch('(pointer:coarse)');\n    var isTablet = isiPad || !isiPhone && isMobile && mediaMatch('(min-device-width:768px)');\n    var isPhone = isiPhone || isMobile && !isTablet;\n    var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\n    var isDesktop = !isPhone && !isTablet && !iOSwebview;\n    return {\n      isiPad: constant(isiPad),\n      isiPhone: constant(isiPhone),\n      isTablet: constant(isTablet),\n      isPhone: constant(isPhone),\n      isTouch: constant(isTouch),\n      isAndroid: os.isAndroid,\n      isiOS: os.isiOS,\n      isWebView: constant(iOSwebview),\n      isDesktop: constant(isDesktop)\n    };\n  };\n\n  var firstMatch = function (regexes, s) {\n    for (var i = 0; i < regexes.length; i++) {\n      var x = regexes[i];\n\n      if (x.test(s)) {\n        return x;\n      }\n    }\n\n    return undefined;\n  };\n\n  var find$1 = function (regexes, agent) {\n    var r = firstMatch(regexes, agent);\n\n    if (!r) {\n      return {\n        major: 0,\n        minor: 0\n      };\n    }\n\n    var group = function (i) {\n      return Number(agent.replace(r, '$' + i));\n    };\n\n    return nu(group(1), group(2));\n  };\n\n  var detect = function (versionRegexes, agent) {\n    var cleanedAgent = String(agent).toLowerCase();\n\n    if (versionRegexes.length === 0) {\n      return unknown();\n    }\n\n    return find$1(versionRegexes, cleanedAgent);\n  };\n\n  var unknown = function () {\n    return nu(0, 0);\n  };\n\n  var nu = function (major, minor) {\n    return {\n      major: major,\n      minor: minor\n    };\n  };\n\n  var Version = {\n    nu: nu,\n    detect: detect,\n    unknown: unknown\n  };\n\n  var detect$1 = function (candidates, userAgent) {\n    var agent = String(userAgent).toLowerCase();\n    return find(candidates, function (candidate) {\n      return candidate.search(agent);\n    });\n  };\n\n  var detectBrowser = function (browsers, userAgent) {\n    return detect$1(browsers, userAgent).map(function (browser) {\n      var version = Version.detect(browser.versionRegexes, userAgent);\n      return {\n        current: browser.name,\n        version: version\n      };\n    });\n  };\n\n  var detectOs = function (oses, userAgent) {\n    return detect$1(oses, userAgent).map(function (os) {\n      var version = Version.detect(os.versionRegexes, userAgent);\n      return {\n        current: os.name,\n        version: version\n      };\n    });\n  };\n\n  var UaString = {\n    detectBrowser: detectBrowser,\n    detectOs: detectOs\n  };\n\n  var removeFromStart = function (str, numChars) {\n    return str.substring(numChars);\n  };\n\n  var checkRange = function (str, substr, start) {\n    return substr === '' || str.length >= substr.length && str.substr(start, start + substr.length) === substr;\n  };\n\n  var removeLeading = function (str, prefix) {\n    return startsWith(str, prefix) ? removeFromStart(str, prefix.length) : str;\n  };\n\n  var contains$1 = function (str, substr) {\n    return str.indexOf(substr) !== -1;\n  };\n\n  var startsWith = function (str, prefix) {\n    return checkRange(str, prefix, 0);\n  };\n\n  var blank = function (r) {\n    return function (s) {\n      return s.replace(r, '');\n    };\n  };\n\n  var trim = blank(/^\\s+|\\s+$/g);\n  var lTrim = blank(/^\\s+/g);\n  var rTrim = blank(/\\s+$/g);\n  var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\n\n  var checkContains = function (target) {\n    return function (uastring) {\n      return contains$1(uastring, target);\n    };\n  };\n\n  var browsers = [{\n    name: 'Edge',\n    versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\n    search: function (uastring) {\n      return contains$1(uastring, 'edge/') && contains$1(uastring, 'chrome') && contains$1(uastring, 'safari') && contains$1(uastring, 'applewebkit');\n    }\n  }, {\n    name: 'Chrome',\n    versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/, normalVersionRegex],\n    search: function (uastring) {\n      return contains$1(uastring, 'chrome') && !contains$1(uastring, 'chromeframe');\n    }\n  }, {\n    name: 'IE',\n    versionRegexes: [/.*?msie\\ ?([0-9]+)\\.([0-9]+).*/, /.*?rv:([0-9]+)\\.([0-9]+).*/],\n    search: function (uastring) {\n      return contains$1(uastring, 'msie') || contains$1(uastring, 'trident');\n    }\n  }, {\n    name: 'Opera',\n    versionRegexes: [normalVersionRegex, /.*?opera\\/([0-9]+)\\.([0-9]+).*/],\n    search: checkContains('opera')\n  }, {\n    name: 'Firefox',\n    versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\n    search: checkContains('firefox')\n  }, {\n    name: 'Safari',\n    versionRegexes: [normalVersionRegex, /.*?cpu os ([0-9]+)_([0-9]+).*/],\n    search: function (uastring) {\n      return (contains$1(uastring, 'safari') || contains$1(uastring, 'mobile/')) && contains$1(uastring, 'applewebkit');\n    }\n  }];\n  var oses = [{\n    name: 'Windows',\n    search: checkContains('win'),\n    versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\n  }, {\n    name: 'iOS',\n    search: function (uastring) {\n      return contains$1(uastring, 'iphone') || contains$1(uastring, 'ipad');\n    },\n    versionRegexes: [/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/, /.*cpu os ([0-9]+)_([0-9]+).*/, /.*cpu iphone os ([0-9]+)_([0-9]+).*/]\n  }, {\n    name: 'Android',\n    search: checkContains('android'),\n    versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\n  }, {\n    name: 'OSX',\n    search: checkContains('mac os x'),\n    versionRegexes: [/.*?mac\\ os\\ x\\ ?([0-9]+)_([0-9]+).*/]\n  }, {\n    name: 'Linux',\n    search: checkContains('linux'),\n    versionRegexes: []\n  }, {\n    name: 'Solaris',\n    search: checkContains('sunos'),\n    versionRegexes: []\n  }, {\n    name: 'FreeBSD',\n    search: checkContains('freebsd'),\n    versionRegexes: []\n  }, {\n    name: 'ChromeOS',\n    search: checkContains('cros'),\n    versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/]\n  }];\n  var PlatformInfo = {\n    browsers: constant(browsers),\n    oses: constant(oses)\n  };\n  var edge = 'Edge';\n  var chrome = 'Chrome';\n  var ie = 'IE';\n  var opera = 'Opera';\n  var firefox = 'Firefox';\n  var safari = 'Safari';\n\n  var unknown$1 = function () {\n    return nu$1({\n      current: undefined,\n      version: Version.unknown()\n    });\n  };\n\n  var nu$1 = function (info) {\n    var current = info.current;\n    var version = info.version;\n\n    var isBrowser = function (name) {\n      return function () {\n        return current === name;\n      };\n    };\n\n    return {\n      current: current,\n      version: version,\n      isEdge: isBrowser(edge),\n      isChrome: isBrowser(chrome),\n      isIE: isBrowser(ie),\n      isOpera: isBrowser(opera),\n      isFirefox: isBrowser(firefox),\n      isSafari: isBrowser(safari)\n    };\n  };\n\n  var Browser = {\n    unknown: unknown$1,\n    nu: nu$1,\n    edge: constant(edge),\n    chrome: constant(chrome),\n    ie: constant(ie),\n    opera: constant(opera),\n    firefox: constant(firefox),\n    safari: constant(safari)\n  };\n  var windows = 'Windows';\n  var ios = 'iOS';\n  var android = 'Android';\n  var linux = 'Linux';\n  var osx = 'OSX';\n  var solaris = 'Solaris';\n  var freebsd = 'FreeBSD';\n  var chromeos = 'ChromeOS';\n\n  var unknown$2 = function () {\n    return nu$2({\n      current: undefined,\n      version: Version.unknown()\n    });\n  };\n\n  var nu$2 = function (info) {\n    var current = info.current;\n    var version = info.version;\n\n    var isOS = function (name) {\n      return function () {\n        return current === name;\n      };\n    };\n\n    return {\n      current: current,\n      version: version,\n      isWindows: isOS(windows),\n      isiOS: isOS(ios),\n      isAndroid: isOS(android),\n      isOSX: isOS(osx),\n      isLinux: isOS(linux),\n      isSolaris: isOS(solaris),\n      isFreeBSD: isOS(freebsd),\n      isChromeOS: isOS(chromeos)\n    };\n  };\n\n  var OperatingSystem = {\n    unknown: unknown$2,\n    nu: nu$2,\n    windows: constant(windows),\n    ios: constant(ios),\n    android: constant(android),\n    linux: constant(linux),\n    osx: constant(osx),\n    solaris: constant(solaris),\n    freebsd: constant(freebsd),\n    chromeos: constant(chromeos)\n  };\n\n  var detect$2 = function (userAgent, mediaMatch) {\n    var browsers = PlatformInfo.browsers();\n    var oses = PlatformInfo.oses();\n    var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);\n    var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\n    var deviceType = DeviceType(os, browser, userAgent, mediaMatch);\n    return {\n      browser: browser,\n      os: os,\n      deviceType: deviceType\n    };\n  };\n\n  var PlatformDetection = {\n    detect: detect$2\n  };\n\n  var mediaMatch = function (query) {\n    return window.matchMedia(query).matches;\n  };\n\n  var platform = cached(function () {\n    return PlatformDetection.detect(navigator.userAgent, mediaMatch);\n  });\n\n  var detect$3 = function () {\n    return platform();\n  };\n\n  var userAgent = navigator.userAgent;\n  var platform$1 = detect$3();\n  var browser = platform$1.browser;\n  var os = platform$1.os;\n  var deviceType = platform$1.deviceType;\n  var webkit = /WebKit/.test(userAgent) && !browser.isEdge();\n  var fileApi = 'FormData' in window && 'FileReader' in window && 'URL' in window && !!URL.createObjectURL;\n  var windowsPhone = userAgent.indexOf('Windows Phone') !== -1;\n  var Env = {\n    opera: browser.isOpera(),\n    webkit: webkit,\n    ie: browser.isIE() || browser.isEdge() ? browser.version.major : false,\n    gecko: browser.isFirefox(),\n    mac: os.isOSX() || os.isiOS(),\n    iOS: deviceType.isiPad() || deviceType.isiPhone(),\n    android: os.isAndroid(),\n    contentEditable: true,\n    transparentSrc: 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',\n    caretAfter: true,\n    range: window.getSelection && 'Range' in window,\n    documentMode: browser.isIE() ? document.documentMode || 7 : 10,\n    fileApi: fileApi,\n    ceFalse: true,\n    cacheSuffix: null,\n    container: null,\n    experimentalShadowDom: false,\n    canHaveCSP: !browser.isIE(),\n    desktop: deviceType.isDesktop(),\n    windowsPhone: windowsPhone,\n    browser: {\n      current: browser.current,\n      version: browser.version,\n      isChrome: browser.isChrome,\n      isEdge: browser.isEdge,\n      isFirefox: browser.isFirefox,\n      isIE: browser.isIE,\n      isOpera: browser.isOpera,\n      isSafari: browser.isSafari\n    },\n    os: {\n      current: os.current,\n      version: os.version,\n      isAndroid: os.isAndroid,\n      isChromeOS: os.isChromeOS,\n      isFreeBSD: os.isFreeBSD,\n      isiOS: os.isiOS,\n      isLinux: os.isLinux,\n      isOSX: os.isOSX,\n      isSolaris: os.isSolaris,\n      isWindows: os.isWindows\n    },\n    deviceType: {\n      isDesktop: deviceType.isDesktop,\n      isiPad: deviceType.isiPad,\n      isiPhone: deviceType.isiPhone,\n      isPhone: deviceType.isPhone,\n      isTablet: deviceType.isTablet,\n      isTouch: deviceType.isTouch,\n      isWebView: deviceType.isWebView\n    }\n  };\n  var whiteSpaceRegExp = /^\\s*|\\s*$/g;\n\n  var trim$1 = function (str) {\n    return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp, '');\n  };\n\n  var is = function (obj, type) {\n    if (!type) {\n      return obj !== undefined;\n    }\n\n    if (type === 'array' && isArray$1(obj)) {\n      return true;\n    }\n\n    return typeof obj === type;\n  };\n\n  var makeMap = function (items, delim, map) {\n    var i;\n    items = items || [];\n    delim = delim || ',';\n\n    if (typeof items === 'string') {\n      items = items.split(delim);\n    }\n\n    map = map || {};\n    i = items.length;\n\n    while (i--) {\n      map[items[i]] = {};\n    }\n\n    return map;\n  };\n\n  var hasOwnProperty$1 = function (obj, prop) {\n    return Object.prototype.hasOwnProperty.call(obj, prop);\n  };\n\n  var create = function (s, p, root) {\n    var self = this;\n    var sp,\n        scn,\n        c,\n        de = 0;\n    s = /^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);\n    var cn = s[3].match(/(^|\\.)(\\w+)$/i)[2];\n    var ns = self.createNS(s[3].replace(/\\.\\w+$/, ''), root);\n\n    if (ns[cn]) {\n      return;\n    }\n\n    if (s[2] === 'static') {\n      ns[cn] = p;\n\n      if (this.onCreate) {\n        this.onCreate(s[2], s[3], ns[cn]);\n      }\n\n      return;\n    }\n\n    if (!p[cn]) {\n      p[cn] = function () {};\n\n      de = 1;\n    }\n\n    ns[cn] = p[cn];\n    self.extend(ns[cn].prototype, p);\n\n    if (s[5]) {\n      sp = self.resolve(s[5]).prototype;\n      scn = s[5].match(/\\.(\\w+)$/i)[1];\n      c = ns[cn];\n\n      if (de) {\n        ns[cn] = function () {\n          return sp[scn].apply(this, arguments);\n        };\n      } else {\n        ns[cn] = function () {\n          this.parent = sp[scn];\n          return c.apply(this, arguments);\n        };\n      }\n\n      ns[cn].prototype[cn] = ns[cn];\n      self.each(sp, function (f, n) {\n        ns[cn].prototype[n] = sp[n];\n      });\n      self.each(p, function (f, n) {\n        if (sp[n]) {\n          ns[cn].prototype[n] = function () {\n            this.parent = sp[n];\n            return f.apply(this, arguments);\n          };\n        } else {\n          if (n !== cn) {\n            ns[cn].prototype[n] = f;\n          }\n        }\n      });\n    }\n\n    self.each(p.static, function (f, n) {\n      ns[cn][n] = f;\n    });\n  };\n\n  var extend = function (obj) {\n    var exts = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      exts[_i - 1] = arguments[_i];\n    }\n\n    for (var i = 0; i < exts.length; i++) {\n      var ext = exts[i];\n\n      for (var name_1 in ext) {\n        if (ext.hasOwnProperty(name_1)) {\n          var value = ext[name_1];\n\n          if (value !== undefined) {\n            obj[name_1] = value;\n          }\n        }\n      }\n    }\n\n    return obj;\n  };\n\n  var walk = function (o, f, n, s) {\n    s = s || this;\n\n    if (o) {\n      if (n) {\n        o = o[n];\n      }\n\n      each$2(o, function (o, i) {\n        if (f.call(s, o, i, n) === false) {\n          return false;\n        }\n\n        walk(o, f, n, s);\n      });\n    }\n  };\n\n  var createNS = function (n, o) {\n    var i, v;\n    o = o || window;\n    n = n.split('.');\n\n    for (i = 0; i < n.length; i++) {\n      v = n[i];\n\n      if (!o[v]) {\n        o[v] = {};\n      }\n\n      o = o[v];\n    }\n\n    return o;\n  };\n\n  var resolve = function (n, o) {\n    var i, l;\n    o = o || window;\n    n = n.split('.');\n\n    for (i = 0, l = n.length; i < l; i++) {\n      o = o[n[i]];\n\n      if (!o) {\n        break;\n      }\n    }\n\n    return o;\n  };\n\n  var explode = function (s, d) {\n    if (!s || is(s, 'array')) {\n      return s;\n    }\n\n    return map$2(s.split(d || ','), trim$1);\n  };\n\n  var _addCacheSuffix = function (url) {\n    var cacheSuffix = Env.cacheSuffix;\n\n    if (cacheSuffix) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + cacheSuffix;\n    }\n\n    return url;\n  };\n\n  var Tools = {\n    trim: trim$1,\n    isArray: isArray$1,\n    is: is,\n    toArray: toArray,\n    makeMap: makeMap,\n    each: each$2,\n    map: map$2,\n    grep: filter$2,\n    inArray: indexOf$1,\n    hasOwn: hasOwnProperty$1,\n    extend: extend,\n    create: create,\n    walk: walk,\n    createNS: createNS,\n    resolve: resolve,\n    explode: explode,\n    _addCacheSuffix: _addCacheSuffix\n  };\n\n  var fromHtml = function (html, scope) {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n\n    if (!div.hasChildNodes() || div.childNodes.length > 1) {\n      console.error('HTML does not have a single root node', html);\n      throw new Error('HTML must have a single root node');\n    }\n\n    return fromDom(div.childNodes[0]);\n  };\n\n  var fromTag = function (tag, scope) {\n    var doc = scope || document;\n    var node = doc.createElement(tag);\n    return fromDom(node);\n  };\n\n  var fromText = function (text, scope) {\n    var doc = scope || document;\n    var node = doc.createTextNode(text);\n    return fromDom(node);\n  };\n\n  var fromDom = function (node) {\n    if (node === null || node === undefined) {\n      throw new Error('Node cannot be null or undefined');\n    }\n\n    return {\n      dom: node\n    };\n  };\n\n  var fromPoint = function (docElm, x, y) {\n    return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n  };\n\n  var SugarElement = {\n    fromHtml: fromHtml,\n    fromTag: fromTag,\n    fromText: fromText,\n    fromDom: fromDom,\n    fromPoint: fromPoint\n  };\n\n  var toArray$1 = function (target, f) {\n    var r = [];\n\n    var recurse = function (e) {\n      r.push(e);\n      return f(e);\n    };\n\n    var cur = f(target);\n\n    do {\n      cur = cur.bind(recurse);\n    } while (cur.isSome());\n\n    return r;\n  };\n\n  var compareDocumentPosition = function (a, b, match) {\n    return (a.compareDocumentPosition(b) & match) !== 0;\n  };\n\n  var documentPositionContainedBy = function (a, b) {\n    return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_CONTAINED_BY);\n  };\n\n  var COMMENT = 8;\n  var DOCUMENT = 9;\n  var DOCUMENT_FRAGMENT = 11;\n  var ELEMENT = 1;\n  var TEXT = 3;\n\n  var is$1 = function (element, selector) {\n    var dom = element.dom;\n\n    if (dom.nodeType !== ELEMENT) {\n      return false;\n    } else {\n      var elem = dom;\n\n      if (elem.matches !== undefined) {\n        return elem.matches(selector);\n      } else if (elem.msMatchesSelector !== undefined) {\n        return elem.msMatchesSelector(selector);\n      } else if (elem.webkitMatchesSelector !== undefined) {\n        return elem.webkitMatchesSelector(selector);\n      } else if (elem.mozMatchesSelector !== undefined) {\n        return elem.mozMatchesSelector(selector);\n      } else {\n        throw new Error('Browser lacks native selectors');\n      }\n    }\n  };\n\n  var bypassSelector = function (dom) {\n    return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;\n  };\n\n  var all = function (selector, scope) {\n    var base = scope === undefined ? document : scope.dom;\n    return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), SugarElement.fromDom);\n  };\n\n  var one = function (selector, scope) {\n    var base = scope === undefined ? document : scope.dom;\n    return bypassSelector(base) ? Optional.none() : Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);\n  };\n\n  var eq$2 = function (e1, e2) {\n    return e1.dom === e2.dom;\n  };\n\n  var regularContains = function (e1, e2) {\n    var d1 = e1.dom;\n    var d2 = e2.dom;\n    return d1 === d2 ? false : d1.contains(d2);\n  };\n\n  var ieContains = function (e1, e2) {\n    return documentPositionContainedBy(e1.dom, e2.dom);\n  };\n\n  var contains$2 = function (e1, e2) {\n    return detect$3().browser.isIE() ? ieContains(e1, e2) : regularContains(e1, e2);\n  };\n\n  var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n\n  var name = function (element) {\n    var r = element.dom.nodeName;\n    return r.toLowerCase();\n  };\n\n  var type = function (element) {\n    return element.dom.nodeType;\n  };\n\n  var isType$1 = function (t) {\n    return function (element) {\n      return type(element) === t;\n    };\n  };\n\n  var isComment = function (element) {\n    return type(element) === COMMENT || name(element) === '#comment';\n  };\n\n  var isElement = isType$1(ELEMENT);\n  var isText = isType$1(TEXT);\n  var isDocument = isType$1(DOCUMENT);\n  var isDocumentFragment = isType$1(DOCUMENT_FRAGMENT);\n\n  var owner = function (element) {\n    return SugarElement.fromDom(element.dom.ownerDocument);\n  };\n\n  var documentOrOwner = function (dos) {\n    return isDocument(dos) ? dos : owner(dos);\n  };\n\n  var documentElement = function (element) {\n    return SugarElement.fromDom(documentOrOwner(element).dom.documentElement);\n  };\n\n  var defaultView = function (element) {\n    return SugarElement.fromDom(documentOrOwner(element).dom.defaultView);\n  };\n\n  var parent = function (element) {\n    return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);\n  };\n\n  var parents = function (element, isRoot) {\n    var stop = isFunction(isRoot) ? isRoot : never;\n    var dom = element.dom;\n    var ret = [];\n\n    while (dom.parentNode !== null && dom.parentNode !== undefined) {\n      var rawParent = dom.parentNode;\n      var p = SugarElement.fromDom(rawParent);\n      ret.push(p);\n\n      if (stop(p) === true) {\n        break;\n      } else {\n        dom = rawParent;\n      }\n    }\n\n    return ret;\n  };\n\n  var siblings = function (element) {\n    var filterSelf = function (elements) {\n      return filter(elements, function (x) {\n        return !eq$2(element, x);\n      });\n    };\n\n    return parent(element).map(children).map(filterSelf).getOr([]);\n  };\n\n  var prevSibling = function (element) {\n    return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom);\n  };\n\n  var nextSibling = function (element) {\n    return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);\n  };\n\n  var prevSiblings = function (element) {\n    return reverse(toArray$1(element, prevSibling));\n  };\n\n  var nextSiblings = function (element) {\n    return toArray$1(element, nextSibling);\n  };\n\n  var children = function (element) {\n    return map(element.dom.childNodes, SugarElement.fromDom);\n  };\n\n  var child = function (element, index) {\n    var cs = element.dom.childNodes;\n    return Optional.from(cs[index]).map(SugarElement.fromDom);\n  };\n\n  var firstChild = function (element) {\n    return child(element, 0);\n  };\n\n  var lastChild = function (element) {\n    return child(element, element.dom.childNodes.length - 1);\n  };\n\n  var childNodesCount = function (element) {\n    return element.dom.childNodes.length;\n  };\n\n  var getHead = function (doc) {\n    var b = doc.dom.head;\n\n    if (b === null || b === undefined) {\n      throw new Error('Head is not available yet');\n    }\n\n    return SugarElement.fromDom(b);\n  };\n\n  var isShadowRoot = function (dos) {\n    return isDocumentFragment(dos);\n  };\n\n  var supported = isFunction(Element.prototype.attachShadow) && isFunction(Node.prototype.getRootNode);\n  var isSupported = constant(supported);\n  var getRootNode = supported ? function (e) {\n    return SugarElement.fromDom(e.dom.getRootNode());\n  } : documentOrOwner;\n\n  var getStyleContainer = function (dos) {\n    return isShadowRoot(dos) ? dos : getHead(documentOrOwner(dos));\n  };\n\n  var getShadowRoot = function (e) {\n    var r = getRootNode(e);\n    return isShadowRoot(r) ? Optional.some(r) : Optional.none();\n  };\n\n  var getShadowHost = function (e) {\n    return SugarElement.fromDom(e.dom.host);\n  };\n\n  var getOriginalEventTarget = function (event) {\n    if (isSupported() && isNonNullable(event.target)) {\n      var el = SugarElement.fromDom(event.target);\n\n      if (isElement(el) && isOpenShadowHost(el)) {\n        if (event.composed && event.composedPath) {\n          var composedPath = event.composedPath();\n\n          if (composedPath) {\n            return head(composedPath);\n          }\n        }\n      }\n    }\n\n    return Optional.from(event.target);\n  };\n\n  var isOpenShadowHost = function (element) {\n    return isNonNullable(element.dom.shadowRoot);\n  };\n\n  var before = function (marker, element) {\n    var parent$1 = parent(marker);\n    parent$1.each(function (v) {\n      v.dom.insertBefore(element.dom, marker.dom);\n    });\n  };\n\n  var after = function (marker, element) {\n    var sibling = nextSibling(marker);\n    sibling.fold(function () {\n      var parent$1 = parent(marker);\n      parent$1.each(function (v) {\n        append(v, element);\n      });\n    }, function (v) {\n      before(v, element);\n    });\n  };\n\n  var prepend = function (parent, element) {\n    var firstChild$1 = firstChild(parent);\n    firstChild$1.fold(function () {\n      append(parent, element);\n    }, function (v) {\n      parent.dom.insertBefore(element.dom, v.dom);\n    });\n  };\n\n  var append = function (parent, element) {\n    parent.dom.appendChild(element.dom);\n  };\n\n  var wrap = function (element, wrapper) {\n    before(element, wrapper);\n    append(wrapper, element);\n  };\n\n  var before$1 = function (marker, elements) {\n    each(elements, function (x) {\n      before(marker, x);\n    });\n  };\n\n  var append$1 = function (parent, elements) {\n    each(elements, function (x) {\n      append(parent, x);\n    });\n  };\n\n  var empty = function (element) {\n    element.dom.textContent = '';\n    each(children(element), function (rogue) {\n      remove(rogue);\n    });\n  };\n\n  var remove = function (element) {\n    var dom = element.dom;\n\n    if (dom.parentNode !== null) {\n      dom.parentNode.removeChild(dom);\n    }\n  };\n\n  var unwrap = function (wrapper) {\n    var children$1 = children(wrapper);\n\n    if (children$1.length > 0) {\n      before$1(wrapper, children$1);\n    }\n\n    remove(wrapper);\n  };\n\n  var inBody = function (element) {\n    var dom = isText(element) ? element.dom.parentNode : element.dom;\n\n    if (dom === undefined || dom === null || dom.ownerDocument === null) {\n      return false;\n    }\n\n    var doc = dom.ownerDocument;\n    return getShadowRoot(SugarElement.fromDom(dom)).fold(function () {\n      return doc.body.contains(dom);\n    }, compose1(inBody, getShadowHost));\n  };\n\n  var r = function (left, top) {\n    var translate = function (x, y) {\n      return r(left + x, top + y);\n    };\n\n    return {\n      left: left,\n      top: top,\n      translate: translate\n    };\n  };\n\n  var SugarPosition = r;\n\n  var boxPosition = function (dom) {\n    var box = dom.getBoundingClientRect();\n    return SugarPosition(box.left, box.top);\n  };\n\n  var firstDefinedOrZero = function (a, b) {\n    if (a !== undefined) {\n      return a;\n    } else {\n      return b !== undefined ? b : 0;\n    }\n  };\n\n  var absolute = function (element) {\n    var doc = element.dom.ownerDocument;\n    var body = doc.body;\n    var win = doc.defaultView;\n    var html = doc.documentElement;\n\n    if (body === element.dom) {\n      return SugarPosition(body.offsetLeft, body.offsetTop);\n    }\n\n    var scrollTop = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageYOffset, html.scrollTop);\n    var scrollLeft = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageXOffset, html.scrollLeft);\n    var clientTop = firstDefinedOrZero(html.clientTop, body.clientTop);\n    var clientLeft = firstDefinedOrZero(html.clientLeft, body.clientLeft);\n    return viewport(element).translate(scrollLeft - clientLeft, scrollTop - clientTop);\n  };\n\n  var viewport = function (element) {\n    var dom = element.dom;\n    var doc = dom.ownerDocument;\n    var body = doc.body;\n\n    if (body === dom) {\n      return SugarPosition(body.offsetLeft, body.offsetTop);\n    }\n\n    if (!inBody(element)) {\n      return SugarPosition(0, 0);\n    }\n\n    return boxPosition(dom);\n  };\n\n  var get$2 = function (_DOC) {\n    var doc = _DOC !== undefined ? _DOC.dom : document;\n    var x = doc.body.scrollLeft || doc.documentElement.scrollLeft;\n    var y = doc.body.scrollTop || doc.documentElement.scrollTop;\n    return SugarPosition(x, y);\n  };\n\n  var to = function (x, y, _DOC) {\n    var doc = _DOC !== undefined ? _DOC.dom : document;\n    var win = doc.defaultView;\n\n    if (win) {\n      win.scrollTo(x, y);\n    }\n  };\n\n  var intoView = function (element, alignToTop) {\n    var isSafari = detect$3().browser.isSafari();\n\n    if (isSafari && isFunction(element.dom.scrollIntoViewIfNeeded)) {\n      element.dom.scrollIntoViewIfNeeded(false);\n    } else {\n      element.dom.scrollIntoView(alignToTop);\n    }\n  };\n\n  var get$3 = function (_win) {\n    var win = _win === undefined ? window : _win;\n    return Optional.from(win['visualViewport']);\n  };\n\n  var bounds = function (x, y, width, height) {\n    return {\n      x: x,\n      y: y,\n      width: width,\n      height: height,\n      right: x + width,\n      bottom: y + height\n    };\n  };\n\n  var getBounds = function (_win) {\n    var win = _win === undefined ? window : _win;\n    var doc = win.document;\n    var scroll = get$2(SugarElement.fromDom(doc));\n    return get$3(win).fold(function () {\n      var html = win.document.documentElement;\n      var width = html.clientWidth;\n      var height = html.clientHeight;\n      return bounds(scroll.left, scroll.top, width, height);\n    }, function (visualViewport) {\n      return bounds(Math.max(visualViewport.pageLeft, scroll.left), Math.max(visualViewport.pageTop, scroll.top), visualViewport.width, visualViewport.height);\n    });\n  };\n\n  var isNodeType = function (type) {\n    return function (node) {\n      return !!node && node.nodeType === type;\n    };\n  };\n\n  var isRestrictedNode = function (node) {\n    return !!node && !Object.getPrototypeOf(node);\n  };\n\n  var isElement$1 = isNodeType(1);\n\n  var matchNodeNames = function (names) {\n    var lowercasedNames = names.map(function (s) {\n      return s.toLowerCase();\n    });\n    return function (node) {\n      if (node && node.nodeName) {\n        var nodeName = node.nodeName.toLowerCase();\n        return contains(lowercasedNames, nodeName);\n      }\n\n      return false;\n    };\n  };\n\n  var matchStyleValues = function (name, values) {\n    var items = values.toLowerCase().split(' ');\n    return function (node) {\n      var i, cssValue;\n\n      if (isElement$1(node)) {\n        for (i = 0; i < items.length; i++) {\n          var computed = node.ownerDocument.defaultView.getComputedStyle(node, null);\n          cssValue = computed ? computed.getPropertyValue(name) : null;\n\n          if (cssValue === items[i]) {\n            return true;\n          }\n        }\n      }\n\n      return false;\n    };\n  };\n\n  var hasAttribute = function (attrName) {\n    return function (node) {\n      return isElement$1(node) && node.hasAttribute(attrName);\n    };\n  };\n\n  var hasAttributeValue = function (attrName, attrValue) {\n    return function (node) {\n      return isElement$1(node) && node.getAttribute(attrName) === attrValue;\n    };\n  };\n\n  var isBogus = function (node) {\n    return isElement$1(node) && node.hasAttribute('data-mce-bogus');\n  };\n\n  var isBogusAll = function (node) {\n    return isElement$1(node) && node.getAttribute('data-mce-bogus') === 'all';\n  };\n\n  var isTable = function (node) {\n    return isElement$1(node) && node.tagName === 'TABLE';\n  };\n\n  var hasContentEditableState = function (value) {\n    return function (node) {\n      if (isElement$1(node)) {\n        if (node.contentEditable === value) {\n          return true;\n        }\n\n        if (node.getAttribute('data-mce-contenteditable') === value) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n  };\n\n  var isTextareaOrInput = matchNodeNames(['textarea', 'input']);\n  var isText$1 = isNodeType(3);\n  var isComment$1 = isNodeType(8);\n  var isDocument$1 = isNodeType(9);\n  var isDocumentFragment$1 = isNodeType(11);\n  var isBr = matchNodeNames(['br']);\n  var isImg = matchNodeNames(['img']);\n  var isContentEditableTrue = hasContentEditableState('true');\n  var isContentEditableFalse = hasContentEditableState('false');\n  var isTableCell = matchNodeNames(['td', 'th']);\n  var isMedia = matchNodeNames(['video', 'audio', 'object', 'embed']);\n\n  var isSupported$1 = function (dom) {\n    return dom.style !== undefined && isFunction(dom.style.getPropertyValue);\n  };\n\n  var rawSet = function (dom, key, value) {\n    if (isString(value) || isBoolean(value) || isNumber(value)) {\n      dom.setAttribute(key, value + '');\n    } else {\n      console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n      throw new Error('Attribute value was not simple');\n    }\n  };\n\n  var set = function (element, key, value) {\n    rawSet(element.dom, key, value);\n  };\n\n  var setAll = function (element, attrs) {\n    var dom = element.dom;\n    each$1(attrs, function (v, k) {\n      rawSet(dom, k, v);\n    });\n  };\n\n  var get$4 = function (element, key) {\n    var v = element.dom.getAttribute(key);\n    return v === null ? undefined : v;\n  };\n\n  var getOpt = function (element, key) {\n    return Optional.from(get$4(element, key));\n  };\n\n  var has$1 = function (element, key) {\n    var dom = element.dom;\n    return dom && dom.hasAttribute ? dom.hasAttribute(key) : false;\n  };\n\n  var remove$1 = function (element, key) {\n    element.dom.removeAttribute(key);\n  };\n\n  var clone = function (element) {\n    return foldl(element.dom.attributes, function (acc, attr) {\n      acc[attr.name] = attr.value;\n      return acc;\n    }, {});\n  };\n\n  var internalSet = function (dom, property, value) {\n    if (!isString(value)) {\n      console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);\n      throw new Error('CSS value must be a string: ' + value);\n    }\n\n    if (isSupported$1(dom)) {\n      dom.style.setProperty(property, value);\n    }\n  };\n\n  var setAll$1 = function (element, css) {\n    var dom = element.dom;\n    each$1(css, function (v, k) {\n      internalSet(dom, k, v);\n    });\n  };\n\n  var get$5 = function (element, property) {\n    var dom = element.dom;\n    var styles = window.getComputedStyle(dom);\n    var r = styles.getPropertyValue(property);\n    return r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;\n  };\n\n  var getUnsafeProperty = function (dom, property) {\n    return isSupported$1(dom) ? dom.style.getPropertyValue(property) : '';\n  };\n\n  var getRaw = function (element, property) {\n    var dom = element.dom;\n    var raw = getUnsafeProperty(dom, property);\n    return Optional.from(raw).filter(function (r) {\n      return r.length > 0;\n    });\n  };\n\n  var getAllRaw = function (element) {\n    var css = {};\n    var dom = element.dom;\n\n    if (isSupported$1(dom)) {\n      for (var i = 0; i < dom.style.length; i++) {\n        var ruleName = dom.style.item(i);\n        css[ruleName] = dom.style[ruleName];\n      }\n    }\n\n    return css;\n  };\n\n  var reflow = function (e) {\n    return e.dom.offsetWidth;\n  };\n\n  var browser$1 = detect$3().browser;\n\n  var firstElement = function (nodes) {\n    return find(nodes, isElement);\n  };\n\n  var getTableCaptionDeltaY = function (elm) {\n    if (browser$1.isFirefox() && name(elm) === 'table') {\n      return firstElement(children(elm)).filter(function (elm) {\n        return name(elm) === 'caption';\n      }).bind(function (caption) {\n        return firstElement(nextSiblings(caption)).map(function (body) {\n          var bodyTop = body.dom.offsetTop;\n          var captionTop = caption.dom.offsetTop;\n          var captionHeight = caption.dom.offsetHeight;\n          return bodyTop <= captionTop ? -captionHeight : 0;\n        });\n      }).getOr(0);\n    } else {\n      return 0;\n    }\n  };\n\n  var hasChild = function (elm, child) {\n    return elm.children && contains(elm.children, child);\n  };\n\n  var getPos = function (body, elm, rootElm) {\n    var x = 0,\n        y = 0,\n        offsetParent;\n    var doc = body.ownerDocument;\n    var pos;\n    rootElm = rootElm ? rootElm : body;\n\n    if (elm) {\n      if (rootElm === body && elm.getBoundingClientRect && get$5(SugarElement.fromDom(body), 'position') === 'static') {\n        pos = elm.getBoundingClientRect();\n        x = pos.left + (doc.documentElement.scrollLeft || body.scrollLeft) - doc.documentElement.clientLeft;\n        y = pos.top + (doc.documentElement.scrollTop || body.scrollTop) - doc.documentElement.clientTop;\n        return {\n          x: x,\n          y: y\n        };\n      }\n\n      offsetParent = elm;\n\n      while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType && !hasChild(offsetParent, rootElm)) {\n        x += offsetParent.offsetLeft || 0;\n        y += offsetParent.offsetTop || 0;\n        offsetParent = offsetParent.offsetParent;\n      }\n\n      offsetParent = elm.parentNode;\n\n      while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType && !hasChild(offsetParent, rootElm)) {\n        x -= offsetParent.scrollLeft || 0;\n        y -= offsetParent.scrollTop || 0;\n        offsetParent = offsetParent.parentNode;\n      }\n\n      y += getTableCaptionDeltaY(SugarElement.fromDom(elm));\n    }\n\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  var exports$1 = {},\n      module$1 = {\n    exports: exports$1\n  };\n\n  (function (define, exports, module, require) {\n    (function (f) {\n      if (typeof exports === 'object' && typeof module !== 'undefined') {\n        module.exports = f();\n      } else if (typeof define === 'function' && define.amd) {\n        define([], f);\n      } else {\n        var g;\n\n        if (typeof window !== 'undefined') {\n          g = window;\n        } else if (typeof global !== 'undefined') {\n          g = global;\n        } else if (typeof self !== 'undefined') {\n          g = self;\n        } else {\n          g = this;\n        }\n\n        g.EphoxContactWrapper = f();\n      }\n    })(function () {\n      return function () {\n        function r(e, n, t) {\n          function o(i, f) {\n            if (!n[i]) {\n              if (!e[i]) {\n                var c = 'function' == typeof require && require;\n                if (!f && c) return c(i, !0);\n                if (u) return u(i, !0);\n                var a = new Error('Cannot find module \\'' + i + '\\'');\n                throw a.code = 'MODULE_NOT_FOUND', a;\n              }\n\n              var p = n[i] = {\n                exports: {}\n              };\n              e[i][0].call(p.exports, function (r) {\n                var n = e[i][1][r];\n                return o(n || r);\n              }, p, p.exports, r, e, n, t);\n            }\n\n            return n[i].exports;\n          }\n\n          for (var u = 'function' == typeof require && require, i = 0; i < t.length; i++) o(t[i]);\n\n          return o;\n        }\n\n        return r;\n      }()({\n        1: [function (require, module, exports) {\n          var process = module.exports = {};\n          var cachedSetTimeout;\n          var cachedClearTimeout;\n\n          function defaultSetTimout() {\n            throw new Error('setTimeout has not been defined');\n          }\n\n          function defaultClearTimeout() {\n            throw new Error('clearTimeout has not been defined');\n          }\n\n          (function () {\n            try {\n              if (typeof setTimeout === 'function') {\n                cachedSetTimeout = setTimeout;\n              } else {\n                cachedSetTimeout = defaultSetTimout;\n              }\n            } catch (e) {\n              cachedSetTimeout = defaultSetTimout;\n            }\n\n            try {\n              if (typeof clearTimeout === 'function') {\n                cachedClearTimeout = clearTimeout;\n              } else {\n                cachedClearTimeout = defaultClearTimeout;\n              }\n            } catch (e) {\n              cachedClearTimeout = defaultClearTimeout;\n            }\n          })();\n\n          function runTimeout(fun) {\n            if (cachedSetTimeout === setTimeout) {\n              return setTimeout(fun, 0);\n            }\n\n            if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n              cachedSetTimeout = setTimeout;\n              return setTimeout(fun, 0);\n            }\n\n            try {\n              return cachedSetTimeout(fun, 0);\n            } catch (e) {\n              try {\n                return cachedSetTimeout.call(null, fun, 0);\n              } catch (e) {\n                return cachedSetTimeout.call(this, fun, 0);\n              }\n            }\n          }\n\n          function runClearTimeout(marker) {\n            if (cachedClearTimeout === clearTimeout) {\n              return clearTimeout(marker);\n            }\n\n            if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n              cachedClearTimeout = clearTimeout;\n              return clearTimeout(marker);\n            }\n\n            try {\n              return cachedClearTimeout(marker);\n            } catch (e) {\n              try {\n                return cachedClearTimeout.call(null, marker);\n              } catch (e) {\n                return cachedClearTimeout.call(this, marker);\n              }\n            }\n          }\n\n          var queue = [];\n          var draining = false;\n          var currentQueue;\n          var queueIndex = -1;\n\n          function cleanUpNextTick() {\n            if (!draining || !currentQueue) {\n              return;\n            }\n\n            draining = false;\n\n            if (currentQueue.length) {\n              queue = currentQueue.concat(queue);\n            } else {\n              queueIndex = -1;\n            }\n\n            if (queue.length) {\n              drainQueue();\n            }\n          }\n\n          function drainQueue() {\n            if (draining) {\n              return;\n            }\n\n            var timeout = runTimeout(cleanUpNextTick);\n            draining = true;\n            var len = queue.length;\n\n            while (len) {\n              currentQueue = queue;\n              queue = [];\n\n              while (++queueIndex < len) {\n                if (currentQueue) {\n                  currentQueue[queueIndex].run();\n                }\n              }\n\n              queueIndex = -1;\n              len = queue.length;\n            }\n\n            currentQueue = null;\n            draining = false;\n            runClearTimeout(timeout);\n          }\n\n          process.nextTick = function (fun) {\n            var args = new Array(arguments.length - 1);\n\n            if (arguments.length > 1) {\n              for (var i = 1; i < arguments.length; i++) {\n                args[i - 1] = arguments[i];\n              }\n            }\n\n            queue.push(new Item(fun, args));\n\n            if (queue.length === 1 && !draining) {\n              runTimeout(drainQueue);\n            }\n          };\n\n          function Item(fun, array) {\n            this.fun = fun;\n            this.array = array;\n          }\n\n          Item.prototype.run = function () {\n            this.fun.apply(null, this.array);\n          };\n\n          process.title = 'browser';\n          process.browser = true;\n          process.env = {};\n          process.argv = [];\n          process.version = '';\n          process.versions = {};\n\n          function noop() {}\n\n          process.on = noop;\n          process.addListener = noop;\n          process.once = noop;\n          process.off = noop;\n          process.removeListener = noop;\n          process.removeAllListeners = noop;\n          process.emit = noop;\n          process.prependListener = noop;\n          process.prependOnceListener = noop;\n\n          process.listeners = function (name) {\n            return [];\n          };\n\n          process.binding = function (name) {\n            throw new Error('process.binding is not supported');\n          };\n\n          process.cwd = function () {\n            return '/';\n          };\n\n          process.chdir = function (dir) {\n            throw new Error('process.chdir is not supported');\n          };\n\n          process.umask = function () {\n            return 0;\n          };\n        }, {}],\n        2: [function (require, module, exports) {\n          (function (setImmediate) {\n            (function (root) {\n              var setTimeoutFunc = setTimeout;\n\n              function noop() {}\n\n              function bind(fn, thisArg) {\n                return function () {\n                  fn.apply(thisArg, arguments);\n                };\n              }\n\n              function Promise(fn) {\n                if (typeof this !== 'object') throw new TypeError('Promises must be constructed via new');\n                if (typeof fn !== 'function') throw new TypeError('not a function');\n                this._state = 0;\n                this._handled = false;\n                this._value = undefined;\n                this._deferreds = [];\n                doResolve(fn, this);\n              }\n\n              function handle(self, deferred) {\n                while (self._state === 3) {\n                  self = self._value;\n                }\n\n                if (self._state === 0) {\n                  self._deferreds.push(deferred);\n\n                  return;\n                }\n\n                self._handled = true;\n\n                Promise._immediateFn(function () {\n                  var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n\n                  if (cb === null) {\n                    (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n                    return;\n                  }\n\n                  var ret;\n\n                  try {\n                    ret = cb(self._value);\n                  } catch (e) {\n                    reject(deferred.promise, e);\n                    return;\n                  }\n\n                  resolve(deferred.promise, ret);\n                });\n              }\n\n              function resolve(self, newValue) {\n                try {\n                  if (newValue === self) throw new TypeError('A promise cannot be resolved with itself.');\n\n                  if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n                    var then = newValue.then;\n\n                    if (newValue instanceof Promise) {\n                      self._state = 3;\n                      self._value = newValue;\n                      finale(self);\n                      return;\n                    } else if (typeof then === 'function') {\n                      doResolve(bind(then, newValue), self);\n                      return;\n                    }\n                  }\n\n                  self._state = 1;\n                  self._value = newValue;\n                  finale(self);\n                } catch (e) {\n                  reject(self, e);\n                }\n              }\n\n              function reject(self, newValue) {\n                self._state = 2;\n                self._value = newValue;\n                finale(self);\n              }\n\n              function finale(self) {\n                if (self._state === 2 && self._deferreds.length === 0) {\n                  Promise._immediateFn(function () {\n                    if (!self._handled) {\n                      Promise._unhandledRejectionFn(self._value);\n                    }\n                  });\n                }\n\n                for (var i = 0, len = self._deferreds.length; i < len; i++) {\n                  handle(self, self._deferreds[i]);\n                }\n\n                self._deferreds = null;\n              }\n\n              function Handler(onFulfilled, onRejected, promise) {\n                this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n                this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n                this.promise = promise;\n              }\n\n              function doResolve(fn, self) {\n                var done = false;\n\n                try {\n                  fn(function (value) {\n                    if (done) return;\n                    done = true;\n                    resolve(self, value);\n                  }, function (reason) {\n                    if (done) return;\n                    done = true;\n                    reject(self, reason);\n                  });\n                } catch (ex) {\n                  if (done) return;\n                  done = true;\n                  reject(self, ex);\n                }\n              }\n\n              Promise.prototype['catch'] = function (onRejected) {\n                return this.then(null, onRejected);\n              };\n\n              Promise.prototype.then = function (onFulfilled, onRejected) {\n                var prom = new this.constructor(noop);\n                handle(this, new Handler(onFulfilled, onRejected, prom));\n                return prom;\n              };\n\n              Promise.all = function (arr) {\n                var args = Array.prototype.slice.call(arr);\n                return new Promise(function (resolve, reject) {\n                  if (args.length === 0) return resolve([]);\n                  var remaining = args.length;\n\n                  function res(i, val) {\n                    try {\n                      if (val && (typeof val === 'object' || typeof val === 'function')) {\n                        var then = val.then;\n\n                        if (typeof then === 'function') {\n                          then.call(val, function (val) {\n                            res(i, val);\n                          }, reject);\n                          return;\n                        }\n                      }\n\n                      args[i] = val;\n\n                      if (--remaining === 0) {\n                        resolve(args);\n                      }\n                    } catch (ex) {\n                      reject(ex);\n                    }\n                  }\n\n                  for (var i = 0; i < args.length; i++) {\n                    res(i, args[i]);\n                  }\n                });\n              };\n\n              Promise.resolve = function (value) {\n                if (value && typeof value === 'object' && value.constructor === Promise) {\n                  return value;\n                }\n\n                return new Promise(function (resolve) {\n                  resolve(value);\n                });\n              };\n\n              Promise.reject = function (value) {\n                return new Promise(function (resolve, reject) {\n                  reject(value);\n                });\n              };\n\n              Promise.race = function (values) {\n                return new Promise(function (resolve, reject) {\n                  for (var i = 0, len = values.length; i < len; i++) {\n                    values[i].then(resolve, reject);\n                  }\n                });\n              };\n\n              Promise._immediateFn = typeof setImmediate === 'function' ? function (fn) {\n                setImmediate(fn);\n              } : function (fn) {\n                setTimeoutFunc(fn, 0);\n              };\n\n              Promise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n                if (typeof console !== 'undefined' && console) {\n                  console.warn('Possible Unhandled Promise Rejection:', err);\n                }\n              };\n\n              Promise._setImmediateFn = function _setImmediateFn(fn) {\n                Promise._immediateFn = fn;\n              };\n\n              Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {\n                Promise._unhandledRejectionFn = fn;\n              };\n\n              if (typeof module !== 'undefined' && module.exports) {\n                module.exports = Promise;\n              } else if (!root.Promise) {\n                root.Promise = Promise;\n              }\n            })(this);\n          }).call(this, require('timers').setImmediate);\n        }, {\n          'timers': 3\n        }],\n        3: [function (require, module, exports) {\n          (function (setImmediate, clearImmediate) {\n            var nextTick = require('process/browser.js').nextTick;\n\n            var apply = Function.prototype.apply;\n            var slice = Array.prototype.slice;\n            var immediateIds = {};\n            var nextImmediateId = 0;\n\n            exports.setTimeout = function () {\n              return new Timeout(apply.call(setTimeout, window, arguments), clearTimeout);\n            };\n\n            exports.setInterval = function () {\n              return new Timeout(apply.call(setInterval, window, arguments), clearInterval);\n            };\n\n            exports.clearTimeout = exports.clearInterval = function (timeout) {\n              timeout.close();\n            };\n\n            function Timeout(id, clearFn) {\n              this._id = id;\n              this._clearFn = clearFn;\n            }\n\n            Timeout.prototype.unref = Timeout.prototype.ref = function () {};\n\n            Timeout.prototype.close = function () {\n              this._clearFn.call(window, this._id);\n            };\n\n            exports.enroll = function (item, msecs) {\n              clearTimeout(item._idleTimeoutId);\n              item._idleTimeout = msecs;\n            };\n\n            exports.unenroll = function (item) {\n              clearTimeout(item._idleTimeoutId);\n              item._idleTimeout = -1;\n            };\n\n            exports._unrefActive = exports.active = function (item) {\n              clearTimeout(item._idleTimeoutId);\n              var msecs = item._idleTimeout;\n\n              if (msecs >= 0) {\n                item._idleTimeoutId = setTimeout(function onTimeout() {\n                  if (item._onTimeout) item._onTimeout();\n                }, msecs);\n              }\n            };\n\n            exports.setImmediate = typeof setImmediate === 'function' ? setImmediate : function (fn) {\n              var id = nextImmediateId++;\n              var args = arguments.length < 2 ? false : slice.call(arguments, 1);\n              immediateIds[id] = true;\n              nextTick(function onNextTick() {\n                if (immediateIds[id]) {\n                  if (args) {\n                    fn.apply(null, args);\n                  } else {\n                    fn.call(null);\n                  }\n\n                  exports.clearImmediate(id);\n                }\n              });\n              return id;\n            };\n            exports.clearImmediate = typeof clearImmediate === 'function' ? clearImmediate : function (id) {\n              delete immediateIds[id];\n            };\n          }).call(this, require('timers').setImmediate, require('timers').clearImmediate);\n        }, {\n          'process/browser.js': 1,\n          'timers': 3\n        }],\n        4: [function (require, module, exports) {\n          var promisePolyfill = require('promise-polyfill');\n\n          var Global = function () {\n            if (typeof window !== 'undefined') {\n              return window;\n            } else {\n              return Function('return this;')();\n            }\n          }();\n\n          module.exports = {\n            boltExport: Global.Promise || promisePolyfill\n          };\n        }, {\n          'promise-polyfill': 2\n        }]\n      }, {}, [4])(4);\n    });\n  })(undefined, exports$1, module$1, undefined);\n\n  var Promise = module$1.exports.boltExport;\n\n  var nu$3 = function (baseFn) {\n    var data = Optional.none();\n    var callbacks = [];\n\n    var map = function (f) {\n      return nu$3(function (nCallback) {\n        get(function (data) {\n          nCallback(f(data));\n        });\n      });\n    };\n\n    var get = function (nCallback) {\n      if (isReady()) {\n        call(nCallback);\n      } else {\n        callbacks.push(nCallback);\n      }\n    };\n\n    var set = function (x) {\n      if (!isReady()) {\n        data = Optional.some(x);\n        run(callbacks);\n        callbacks = [];\n      }\n    };\n\n    var isReady = function () {\n      return data.isSome();\n    };\n\n    var run = function (cbs) {\n      each(cbs, call);\n    };\n\n    var call = function (cb) {\n      data.each(function (x) {\n        setTimeout(function () {\n          cb(x);\n        }, 0);\n      });\n    };\n\n    baseFn(set);\n    return {\n      get: get,\n      map: map,\n      isReady: isReady\n    };\n  };\n\n  var pure = function (a) {\n    return nu$3(function (callback) {\n      callback(a);\n    });\n  };\n\n  var LazyValue = {\n    nu: nu$3,\n    pure: pure\n  };\n\n  var errorReporter = function (err) {\n    setTimeout(function () {\n      throw err;\n    }, 0);\n  };\n\n  var make = function (run) {\n    var get = function (callback) {\n      run().then(callback, errorReporter);\n    };\n\n    var map = function (fab) {\n      return make(function () {\n        return run().then(fab);\n      });\n    };\n\n    var bind = function (aFutureB) {\n      return make(function () {\n        return run().then(function (v) {\n          return aFutureB(v).toPromise();\n        });\n      });\n    };\n\n    var anonBind = function (futureB) {\n      return make(function () {\n        return run().then(function () {\n          return futureB.toPromise();\n        });\n      });\n    };\n\n    var toLazy = function () {\n      return LazyValue.nu(get);\n    };\n\n    var toCached = function () {\n      var cache = null;\n      return make(function () {\n        if (cache === null) {\n          cache = run();\n        }\n\n        return cache;\n      });\n    };\n\n    var toPromise = run;\n    return {\n      map: map,\n      bind: bind,\n      anonBind: anonBind,\n      toLazy: toLazy,\n      toCached: toCached,\n      toPromise: toPromise,\n      get: get\n    };\n  };\n\n  var nu$4 = function (baseFn) {\n    return make(function () {\n      return new Promise(baseFn);\n    });\n  };\n\n  var pure$1 = function (a) {\n    return make(function () {\n      return Promise.resolve(a);\n    });\n  };\n\n  var Future = {\n    nu: nu$4,\n    pure: pure$1\n  };\n\n  var par = function (asyncValues, nu) {\n    return nu(function (callback) {\n      var r = [];\n      var count = 0;\n\n      var cb = function (i) {\n        return function (value) {\n          r[i] = value;\n          count++;\n\n          if (count >= asyncValues.length) {\n            callback(r);\n          }\n        };\n      };\n\n      if (asyncValues.length === 0) {\n        callback([]);\n      } else {\n        each(asyncValues, function (asyncValue, i) {\n          asyncValue.get(cb(i));\n        });\n      }\n    });\n  };\n\n  var par$1 = function (futures) {\n    return par(futures, Future.nu);\n  };\n\n  var value = function (o) {\n    var is = function (v) {\n      return o === v;\n    };\n\n    var or = function (_opt) {\n      return value(o);\n    };\n\n    var orThunk = function (_f) {\n      return value(o);\n    };\n\n    var map = function (f) {\n      return value(f(o));\n    };\n\n    var mapError = function (_f) {\n      return value(o);\n    };\n\n    var each = function (f) {\n      f(o);\n    };\n\n    var bind = function (f) {\n      return f(o);\n    };\n\n    var fold = function (_, onValue) {\n      return onValue(o);\n    };\n\n    var exists = function (f) {\n      return f(o);\n    };\n\n    var forall = function (f) {\n      return f(o);\n    };\n\n    var toOptional = function () {\n      return Optional.some(o);\n    };\n\n    return {\n      is: is,\n      isValue: always,\n      isError: never,\n      getOr: constant(o),\n      getOrThunk: constant(o),\n      getOrDie: constant(o),\n      or: or,\n      orThunk: orThunk,\n      fold: fold,\n      map: map,\n      mapError: mapError,\n      each: each,\n      bind: bind,\n      exists: exists,\n      forall: forall,\n      toOptional: toOptional\n    };\n  };\n\n  var error = function (message) {\n    var getOrThunk = function (f) {\n      return f();\n    };\n\n    var getOrDie = function () {\n      return die(String(message))();\n    };\n\n    var or = function (opt) {\n      return opt;\n    };\n\n    var orThunk = function (f) {\n      return f();\n    };\n\n    var map = function (_f) {\n      return error(message);\n    };\n\n    var mapError = function (f) {\n      return error(f(message));\n    };\n\n    var bind = function (_f) {\n      return error(message);\n    };\n\n    var fold = function (onError, _) {\n      return onError(message);\n    };\n\n    return {\n      is: never,\n      isValue: never,\n      isError: always,\n      getOr: identity,\n      getOrThunk: getOrThunk,\n      getOrDie: getOrDie,\n      or: or,\n      orThunk: orThunk,\n      fold: fold,\n      map: map,\n      mapError: mapError,\n      each: noop,\n      bind: bind,\n      exists: never,\n      forall: always,\n      toOptional: Optional.none\n    };\n  };\n\n  var fromOption = function (opt, err) {\n    return opt.fold(function () {\n      return error(err);\n    }, value);\n  };\n\n  var Result = {\n    value: value,\n    error: error,\n    fromOption: fromOption\n  };\n\n  var generate = function (cases) {\n    if (!isArray(cases)) {\n      throw new Error('cases must be an array');\n    }\n\n    if (cases.length === 0) {\n      throw new Error('there must be at least one case');\n    }\n\n    var constructors = [];\n    var adt = {};\n    each(cases, function (acase, count) {\n      var keys$1 = keys(acase);\n\n      if (keys$1.length !== 1) {\n        throw new Error('one and only one name per case');\n      }\n\n      var key = keys$1[0];\n      var value = acase[key];\n\n      if (adt[key] !== undefined) {\n        throw new Error('duplicate key detected:' + key);\n      } else if (key === 'cata') {\n        throw new Error('cannot have a case named cata (sorry)');\n      } else if (!isArray(value)) {\n        throw new Error('case arguments must be an array');\n      }\n\n      constructors.push(key);\n\n      adt[key] = function () {\n        var argLength = arguments.length;\n\n        if (argLength !== value.length) {\n          throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);\n        }\n\n        var args = new Array(argLength);\n\n        for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i];\n        }\n\n        var match = function (branches) {\n          var branchKeys = keys(branches);\n\n          if (constructors.length !== branchKeys.length) {\n            throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\\nActual: ' + branchKeys.join(','));\n          }\n\n          var allReqd = forall(constructors, function (reqKey) {\n            return contains(branchKeys, reqKey);\n          });\n\n          if (!allReqd) {\n            throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\\nRequired: ' + constructors.join(', '));\n          }\n\n          return branches[key].apply(null, args);\n        };\n\n        return {\n          fold: function () {\n            if (arguments.length !== cases.length) {\n              throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + arguments.length);\n            }\n\n            var target = arguments[count];\n            return target.apply(null, args);\n          },\n          match: match,\n          log: function (label) {\n            console.log(label, {\n              constructors: constructors,\n              constructor: key,\n              params: args\n            });\n          }\n        };\n      };\n    });\n    return adt;\n  };\n\n  var Adt = {\n    generate: generate\n  };\n  var comparison = Adt.generate([{\n    bothErrors: ['error1', 'error2']\n  }, {\n    firstError: ['error1', 'value2']\n  }, {\n    secondError: ['value1', 'error2']\n  }, {\n    bothValues: ['value1', 'value2']\n  }]);\n\n  var unite = function (result) {\n    return result.fold(identity, identity);\n  };\n\n  function ClosestOrAncestor(is, ancestor, scope, a, isRoot) {\n    if (is(scope, a)) {\n      return Optional.some(scope);\n    } else if (isFunction(isRoot) && isRoot(scope)) {\n      return Optional.none();\n    } else {\n      return ancestor(scope, a, isRoot);\n    }\n  }\n\n  var ancestor = function (scope, predicate, isRoot) {\n    var element = scope.dom;\n    var stop = isFunction(isRoot) ? isRoot : never;\n\n    while (element.parentNode) {\n      element = element.parentNode;\n      var el = SugarElement.fromDom(element);\n\n      if (predicate(el)) {\n        return Optional.some(el);\n      } else if (stop(el)) {\n        break;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var closest = function (scope, predicate, isRoot) {\n    var is = function (s, test) {\n      return test(s);\n    };\n\n    return ClosestOrAncestor(is, ancestor, scope, predicate, isRoot);\n  };\n\n  var sibling = function (scope, predicate) {\n    var element = scope.dom;\n\n    if (!element.parentNode) {\n      return Optional.none();\n    }\n\n    return child$1(SugarElement.fromDom(element.parentNode), function (x) {\n      return !eq$2(scope, x) && predicate(x);\n    });\n  };\n\n  var child$1 = function (scope, predicate) {\n    var pred = function (node) {\n      return predicate(SugarElement.fromDom(node));\n    };\n\n    var result = find(scope.dom.childNodes, pred);\n    return result.map(SugarElement.fromDom);\n  };\n\n  var ancestor$1 = function (scope, selector, isRoot) {\n    return ancestor(scope, function (e) {\n      return is$1(e, selector);\n    }, isRoot);\n  };\n\n  var descendant = function (scope, selector) {\n    return one(selector, scope);\n  };\n\n  var closest$1 = function (scope, selector, isRoot) {\n    var is = function (element, selector) {\n      return is$1(element, selector);\n    };\n\n    return ClosestOrAncestor(is, ancestor$1, scope, selector, isRoot);\n  };\n\n  var promise = function () {\n    function bind(fn, thisArg) {\n      return function () {\n        fn.apply(thisArg, arguments);\n      };\n    }\n\n    var isArray = Array.isArray || function (value) {\n      return Object.prototype.toString.call(value) === '[object Array]';\n    };\n\n    var Promise = function (fn) {\n      if (typeof this !== 'object') {\n        throw new TypeError('Promises must be constructed via new');\n      }\n\n      if (typeof fn !== 'function') {\n        throw new TypeError('not a function');\n      }\n\n      this._state = null;\n      this._value = null;\n      this._deferreds = [];\n      doResolve(fn, bind(resolve, this), bind(reject, this));\n    };\n\n    var asap = Promise.immediateFn || typeof setImmediate === 'function' && setImmediate || function (fn) {\n      setTimeout(fn, 1);\n    };\n\n    function handle(deferred) {\n      var me = this;\n\n      if (this._state === null) {\n        this._deferreds.push(deferred);\n\n        return;\n      }\n\n      asap(function () {\n        var cb = me._state ? deferred.onFulfilled : deferred.onRejected;\n\n        if (cb === null) {\n          (me._state ? deferred.resolve : deferred.reject)(me._value);\n          return;\n        }\n\n        var ret;\n\n        try {\n          ret = cb(me._value);\n        } catch (e) {\n          deferred.reject(e);\n          return;\n        }\n\n        deferred.resolve(ret);\n      });\n    }\n\n    function resolve(newValue) {\n      try {\n        if (newValue === this) {\n          throw new TypeError('A promise cannot be resolved with itself.');\n        }\n\n        if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n          var then = newValue.then;\n\n          if (typeof then === 'function') {\n            doResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\n            return;\n          }\n        }\n\n        this._state = true;\n        this._value = newValue;\n        finale.call(this);\n      } catch (e) {\n        reject.call(this, e);\n      }\n    }\n\n    function reject(newValue) {\n      this._state = false;\n      this._value = newValue;\n      finale.call(this);\n    }\n\n    function finale() {\n      for (var i = 0, len = this._deferreds.length; i < len; i++) {\n        handle.call(this, this._deferreds[i]);\n      }\n\n      this._deferreds = null;\n    }\n\n    function Handler(onFulfilled, onRejected, resolve, reject) {\n      this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n      this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n      this.resolve = resolve;\n      this.reject = reject;\n    }\n\n    function doResolve(fn, onFulfilled, onRejected) {\n      var done = false;\n\n      try {\n        fn(function (value) {\n          if (done) {\n            return;\n          }\n\n          done = true;\n          onFulfilled(value);\n        }, function (reason) {\n          if (done) {\n            return;\n          }\n\n          done = true;\n          onRejected(reason);\n        });\n      } catch (ex) {\n        if (done) {\n          return;\n        }\n\n        done = true;\n        onRejected(ex);\n      }\n    }\n\n    Promise.prototype.catch = function (onRejected) {\n      return this.then(null, onRejected);\n    };\n\n    Promise.prototype.then = function (onFulfilled, onRejected) {\n      var me = this;\n      return new Promise(function (resolve, reject) {\n        handle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\n      });\n    };\n\n    Promise.all = function () {\n      var args = Array.prototype.slice.call(arguments.length === 1 && isArray(arguments[0]) ? arguments[0] : arguments);\n      return new Promise(function (resolve, reject) {\n        if (args.length === 0) {\n          return resolve([]);\n        }\n\n        var remaining = args.length;\n\n        function res(i, val) {\n          try {\n            if (val && (typeof val === 'object' || typeof val === 'function')) {\n              var then = val.then;\n\n              if (typeof then === 'function') {\n                then.call(val, function (val) {\n                  res(i, val);\n                }, reject);\n                return;\n              }\n            }\n\n            args[i] = val;\n\n            if (--remaining === 0) {\n              resolve(args);\n            }\n          } catch (ex) {\n            reject(ex);\n          }\n        }\n\n        for (var i = 0; i < args.length; i++) {\n          res(i, args[i]);\n        }\n      });\n    };\n\n    Promise.resolve = function (value) {\n      if (value && typeof value === 'object' && value.constructor === Promise) {\n        return value;\n      }\n\n      return new Promise(function (resolve) {\n        resolve(value);\n      });\n    };\n\n    Promise.reject = function (value) {\n      return new Promise(function (resolve, reject) {\n        reject(value);\n      });\n    };\n\n    Promise.race = function (values) {\n      return new Promise(function (resolve, reject) {\n        for (var i = 0, len = values.length; i < len; i++) {\n          values[i].then(resolve, reject);\n        }\n      });\n    };\n\n    return Promise;\n  };\n\n  var promiseObj = window.Promise ? window.Promise : promise();\n  var requestAnimationFramePromise;\n\n  var requestAnimationFrame = function (callback, element) {\n    var i,\n        requestAnimationFrameFunc = window.requestAnimationFrame;\n    var vendors = ['ms', 'moz', 'webkit'];\n\n    var featurefill = function (callback) {\n      window.setTimeout(callback, 0);\n    };\n\n    for (i = 0; i < vendors.length && !requestAnimationFrameFunc; i++) {\n      requestAnimationFrameFunc = window[vendors[i] + 'RequestAnimationFrame'];\n    }\n\n    if (!requestAnimationFrameFunc) {\n      requestAnimationFrameFunc = featurefill;\n    }\n\n    requestAnimationFrameFunc(callback, element);\n  };\n\n  var wrappedSetTimeout = function (callback, time) {\n    if (typeof time !== 'number') {\n      time = 0;\n    }\n\n    return setTimeout(callback, time);\n  };\n\n  var wrappedSetInterval = function (callback, time) {\n    if (typeof time !== 'number') {\n      time = 1;\n    }\n\n    return setInterval(callback, time);\n  };\n\n  var wrappedClearTimeout = function (id) {\n    return clearTimeout(id);\n  };\n\n  var wrappedClearInterval = function (id) {\n    return clearInterval(id);\n  };\n\n  var debounce = function (callback, time) {\n    var timer;\n\n    var func = function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      clearTimeout(timer);\n      timer = wrappedSetTimeout(function () {\n        callback.apply(this, args);\n      }, time);\n    };\n\n    func.stop = function () {\n      clearTimeout(timer);\n    };\n\n    return func;\n  };\n\n  var Delay = {\n    requestAnimationFrame: function (callback, element) {\n      if (requestAnimationFramePromise) {\n        requestAnimationFramePromise.then(callback);\n        return;\n      }\n\n      requestAnimationFramePromise = new promiseObj(function (resolve) {\n        if (!element) {\n          element = document.body;\n        }\n\n        requestAnimationFrame(resolve, element);\n      }).then(callback);\n    },\n    setTimeout: wrappedSetTimeout,\n    setInterval: wrappedSetInterval,\n    setEditorTimeout: function (editor, callback, time) {\n      return wrappedSetTimeout(function () {\n        if (!editor.removed) {\n          callback();\n        }\n      }, time);\n    },\n    setEditorInterval: function (editor, callback, time) {\n      var timer = wrappedSetInterval(function () {\n        if (!editor.removed) {\n          callback();\n        } else {\n          clearInterval(timer);\n        }\n      }, time);\n      return timer;\n    },\n    debounce: debounce,\n    throttle: debounce,\n    clearInterval: wrappedClearInterval,\n    clearTimeout: wrappedClearTimeout\n  };\n\n  function StyleSheetLoader(documentOrShadowRoot, settings) {\n    if (settings === void 0) {\n      settings = {};\n    }\n\n    var idCount = 0;\n    var loadedStates = {};\n    var edos = SugarElement.fromDom(documentOrShadowRoot);\n    var doc = documentOrOwner(edos);\n    var maxLoadTime = settings.maxLoadTime || 5000;\n\n    var _setReferrerPolicy = function (referrerPolicy) {\n      settings.referrerPolicy = referrerPolicy;\n    };\n\n    var addStyle = function (element) {\n      append(getStyleContainer(edos), element);\n    };\n\n    var removeStyle = function (id) {\n      var styleContainer = getStyleContainer(edos);\n      descendant(styleContainer, '#' + id).each(remove);\n    };\n\n    var getOrCreateState = function (url) {\n      return get$1(loadedStates, url).getOrThunk(function () {\n        return {\n          id: 'mce-u' + idCount++,\n          passed: [],\n          failed: [],\n          count: 0\n        };\n      });\n    };\n\n    var load = function (url, success, failure) {\n      var link;\n\n      var urlWithSuffix = Tools._addCacheSuffix(url);\n\n      var state = getOrCreateState(urlWithSuffix);\n      loadedStates[urlWithSuffix] = state;\n      state.count++;\n\n      var resolve = function (callbacks, status) {\n        var i = callbacks.length;\n\n        while (i--) {\n          callbacks[i]();\n        }\n\n        state.status = status;\n        state.passed = [];\n        state.failed = [];\n\n        if (link) {\n          link.onload = null;\n          link.onerror = null;\n          link = null;\n        }\n      };\n\n      var passed = function () {\n        return resolve(state.passed, 2);\n      };\n\n      var failed = function () {\n        return resolve(state.failed, 3);\n      };\n\n      var wait = function (testCallback, waitCallback) {\n        if (!testCallback()) {\n          if (Date.now() - startTime < maxLoadTime) {\n            Delay.setTimeout(waitCallback);\n          } else {\n            failed();\n          }\n        }\n      };\n\n      var waitForWebKitLinkLoaded = function () {\n        wait(function () {\n          var styleSheets = documentOrShadowRoot.styleSheets;\n          var i = styleSheets.length;\n\n          while (i--) {\n            var styleSheet = styleSheets[i];\n            var owner = styleSheet.ownerNode;\n\n            if (owner && owner.id === link.id) {\n              passed();\n              return true;\n            }\n          }\n\n          return false;\n        }, waitForWebKitLinkLoaded);\n      };\n\n      if (success) {\n        state.passed.push(success);\n      }\n\n      if (failure) {\n        state.failed.push(failure);\n      }\n\n      if (state.status === 1) {\n        return;\n      }\n\n      if (state.status === 2) {\n        passed();\n        return;\n      }\n\n      if (state.status === 3) {\n        failed();\n        return;\n      }\n\n      state.status = 1;\n      var linkElem = SugarElement.fromTag('link', doc.dom);\n      setAll(linkElem, {\n        rel: 'stylesheet',\n        type: 'text/css',\n        id: state.id\n      });\n      var startTime = Date.now();\n\n      if (settings.contentCssCors) {\n        set(linkElem, 'crossOrigin', 'anonymous');\n      }\n\n      if (settings.referrerPolicy) {\n        set(linkElem, 'referrerpolicy', settings.referrerPolicy);\n      }\n\n      link = linkElem.dom;\n      link.onload = waitForWebKitLinkLoaded;\n      link.onerror = failed;\n      addStyle(linkElem);\n      set(linkElem, 'href', urlWithSuffix);\n    };\n\n    var loadF = function (url) {\n      return Future.nu(function (resolve) {\n        load(url, compose(resolve, constant(Result.value(url))), compose(resolve, constant(Result.error(url))));\n      });\n    };\n\n    var loadAll = function (urls, success, failure) {\n      par$1(map(urls, loadF)).get(function (result) {\n        var parts = partition(result, function (r) {\n          return r.isValue();\n        });\n\n        if (parts.fail.length > 0) {\n          failure(parts.fail.map(unite));\n        } else {\n          success(parts.pass.map(unite));\n        }\n      });\n    };\n\n    var unload = function (url) {\n      var urlWithSuffix = Tools._addCacheSuffix(url);\n\n      get$1(loadedStates, urlWithSuffix).each(function (state) {\n        var count = --state.count;\n\n        if (count === 0) {\n          delete loadedStates[urlWithSuffix];\n          removeStyle(state.id);\n        }\n      });\n    };\n\n    var unloadAll = function (urls) {\n      each(urls, function (url) {\n        unload(url);\n      });\n    };\n\n    return {\n      load: load,\n      loadAll: loadAll,\n      unload: unload,\n      unloadAll: unloadAll,\n      _setReferrerPolicy: _setReferrerPolicy\n    };\n  }\n\n  var create$1 = function () {\n    var map = new WeakMap();\n\n    var forElement = function (referenceElement, settings) {\n      var root = getRootNode(referenceElement);\n      var rootDom = root.dom;\n      return Optional.from(map.get(rootDom)).getOrThunk(function () {\n        var sl = StyleSheetLoader(rootDom, settings);\n        map.set(rootDom, sl);\n        return sl;\n      });\n    };\n\n    return {\n      forElement: forElement\n    };\n  };\n\n  var instance = create$1();\n\n  var DomTreeWalker = function () {\n    function DomTreeWalker(startNode, rootNode) {\n      this.node = startNode;\n      this.rootNode = rootNode;\n      this.current = this.current.bind(this);\n      this.next = this.next.bind(this);\n      this.prev = this.prev.bind(this);\n      this.prev2 = this.prev2.bind(this);\n    }\n\n    DomTreeWalker.prototype.current = function () {\n      return this.node;\n    };\n\n    DomTreeWalker.prototype.next = function (shallow) {\n      this.node = this.findSibling(this.node, 'firstChild', 'nextSibling', shallow);\n      return this.node;\n    };\n\n    DomTreeWalker.prototype.prev = function (shallow) {\n      this.node = this.findSibling(this.node, 'lastChild', 'previousSibling', shallow);\n      return this.node;\n    };\n\n    DomTreeWalker.prototype.prev2 = function (shallow) {\n      this.node = this.findPreviousNode(this.node, 'lastChild', 'previousSibling', shallow);\n      return this.node;\n    };\n\n    DomTreeWalker.prototype.findSibling = function (node, startName, siblingName, shallow) {\n      var sibling, parent;\n\n      if (node) {\n        if (!shallow && node[startName]) {\n          return node[startName];\n        }\n\n        if (node !== this.rootNode) {\n          sibling = node[siblingName];\n\n          if (sibling) {\n            return sibling;\n          }\n\n          for (parent = node.parentNode; parent && parent !== this.rootNode; parent = parent.parentNode) {\n            sibling = parent[siblingName];\n\n            if (sibling) {\n              return sibling;\n            }\n          }\n        }\n      }\n    };\n\n    DomTreeWalker.prototype.findPreviousNode = function (node, startName, siblingName, shallow) {\n      var sibling, parent, child;\n\n      if (node) {\n        sibling = node[siblingName];\n\n        if (this.rootNode && sibling === this.rootNode) {\n          return;\n        }\n\n        if (sibling) {\n          if (!shallow) {\n            for (child = sibling[startName]; child; child = child[startName]) {\n              if (!child[startName]) {\n                return child;\n              }\n            }\n          }\n\n          return sibling;\n        }\n\n        parent = node.parentNode;\n\n        if (parent && parent !== this.rootNode) {\n          return parent;\n        }\n      }\n    };\n\n    return DomTreeWalker;\n  }();\n\n  var blocks = ['article', 'aside', 'details', 'div', 'dt', 'figcaption', 'footer', 'form', 'fieldset', 'header', 'hgroup', 'html', 'main', 'nav', 'section', 'summary', 'body', 'p', 'dl', 'multicol', 'dd', 'figure', 'address', 'center', 'blockquote', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'listing', 'xmp', 'pre', 'plaintext', 'menu', 'dir', 'ul', 'ol', 'li', 'hr', 'table', 'tbody', 'thead', 'tfoot', 'th', 'tr', 'td', 'caption'];\n  var tableCells = ['td', 'th'];\n  var tableSections = ['thead', 'tbody', 'tfoot'];\n  var textBlocks = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'div', 'address', 'pre', 'form', 'blockquote', 'center', 'dir', 'fieldset', 'header', 'footer', 'article', 'section', 'hgroup', 'aside', 'nav', 'figure'];\n  var headings = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n  var listItems = ['li', 'dd', 'dt'];\n  var lists = ['ul', 'ol', 'dl'];\n  var wsElements = ['pre', 'script', 'textarea', 'style'];\n\n  var lazyLookup = function (items) {\n    var lookup;\n    return function (node) {\n      lookup = lookup ? lookup : mapToObject(items, always);\n      return lookup.hasOwnProperty(name(node));\n    };\n  };\n\n  var isHeading = lazyLookup(headings);\n  var isBlock = lazyLookup(blocks);\n\n  var isTable$1 = function (node) {\n    return name(node) === 'table';\n  };\n\n  var isInline = function (node) {\n    return isElement(node) && !isBlock(node);\n  };\n\n  var isBr$1 = function (node) {\n    return isElement(node) && name(node) === 'br';\n  };\n\n  var isTextBlock = lazyLookup(textBlocks);\n  var isList = lazyLookup(lists);\n  var isListItem = lazyLookup(listItems);\n  var isTableSection = lazyLookup(tableSections);\n  var isTableCell$1 = lazyLookup(tableCells);\n  var isWsPreserveElement = lazyLookup(wsElements);\n\n  var ancestor$2 = function (scope, selector, isRoot) {\n    return ancestor$1(scope, selector, isRoot).isSome();\n  };\n\n  var zeroWidth = '\\uFEFF';\n  var nbsp = '\\xA0';\n\n  var isZwsp = function (char) {\n    return char === zeroWidth;\n  };\n\n  var removeZwsp = function (s) {\n    return s.replace(/\\uFEFF/g, '');\n  };\n\n  var ZWSP = zeroWidth;\n  var isZwsp$1 = isZwsp;\n  var trim$2 = removeZwsp;\n  var isElement$2 = isElement$1;\n  var isText$2 = isText$1;\n\n  var isCaretContainerBlock = function (node) {\n    if (isText$2(node)) {\n      node = node.parentNode;\n    }\n\n    return isElement$2(node) && node.hasAttribute('data-mce-caret');\n  };\n\n  var isCaretContainerInline = function (node) {\n    return isText$2(node) && isZwsp$1(node.data);\n  };\n\n  var isCaretContainer = function (node) {\n    return isCaretContainerBlock(node) || isCaretContainerInline(node);\n  };\n\n  var hasContent = function (node) {\n    return node.firstChild !== node.lastChild || !isBr(node.firstChild);\n  };\n\n  var insertInline = function (node, before) {\n    var sibling;\n    var doc = node.ownerDocument;\n    var textNode = doc.createTextNode(ZWSP);\n    var parentNode = node.parentNode;\n\n    if (!before) {\n      sibling = node.nextSibling;\n\n      if (isText$2(sibling)) {\n        if (isCaretContainer(sibling)) {\n          return sibling;\n        }\n\n        if (startsWithCaretContainer(sibling)) {\n          sibling.splitText(1);\n          return sibling;\n        }\n      }\n\n      if (node.nextSibling) {\n        parentNode.insertBefore(textNode, node.nextSibling);\n      } else {\n        parentNode.appendChild(textNode);\n      }\n    } else {\n      sibling = node.previousSibling;\n\n      if (isText$2(sibling)) {\n        if (isCaretContainer(sibling)) {\n          return sibling;\n        }\n\n        if (endsWithCaretContainer(sibling)) {\n          return sibling.splitText(sibling.data.length - 1);\n        }\n      }\n\n      parentNode.insertBefore(textNode, node);\n    }\n\n    return textNode;\n  };\n\n  var isBeforeInline = function (pos) {\n    var container = pos.container();\n\n    if (!isText$1(container)) {\n      return false;\n    }\n\n    return container.data.charAt(pos.offset()) === ZWSP || pos.isAtStart() && isCaretContainerInline(container.previousSibling);\n  };\n\n  var isAfterInline = function (pos) {\n    var container = pos.container();\n\n    if (!isText$1(container)) {\n      return false;\n    }\n\n    return container.data.charAt(pos.offset() - 1) === ZWSP || pos.isAtEnd() && isCaretContainerInline(container.nextSibling);\n  };\n\n  var createBogusBr = function () {\n    var br = document.createElement('br');\n    br.setAttribute('data-mce-bogus', '1');\n    return br;\n  };\n\n  var insertBlock = function (blockName, node, before) {\n    var doc = node.ownerDocument;\n    var blockNode = doc.createElement(blockName);\n    blockNode.setAttribute('data-mce-caret', before ? 'before' : 'after');\n    blockNode.setAttribute('data-mce-bogus', 'all');\n    blockNode.appendChild(createBogusBr());\n    var parentNode = node.parentNode;\n\n    if (!before) {\n      if (node.nextSibling) {\n        parentNode.insertBefore(blockNode, node.nextSibling);\n      } else {\n        parentNode.appendChild(blockNode);\n      }\n    } else {\n      parentNode.insertBefore(blockNode, node);\n    }\n\n    return blockNode;\n  };\n\n  var startsWithCaretContainer = function (node) {\n    return isText$2(node) && node.data[0] === ZWSP;\n  };\n\n  var endsWithCaretContainer = function (node) {\n    return isText$2(node) && node.data[node.data.length - 1] === ZWSP;\n  };\n\n  var trimBogusBr = function (elm) {\n    var brs = elm.getElementsByTagName('br');\n    var lastBr = brs[brs.length - 1];\n\n    if (isBogus(lastBr)) {\n      lastBr.parentNode.removeChild(lastBr);\n    }\n  };\n\n  var showCaretContainerBlock = function (caretContainer) {\n    if (caretContainer && caretContainer.hasAttribute('data-mce-caret')) {\n      trimBogusBr(caretContainer);\n      caretContainer.removeAttribute('data-mce-caret');\n      caretContainer.removeAttribute('data-mce-bogus');\n      caretContainer.removeAttribute('style');\n      caretContainer.removeAttribute('_moz_abspos');\n      return caretContainer;\n    }\n\n    return null;\n  };\n\n  var isRangeInCaretContainerBlock = function (range) {\n    return isCaretContainerBlock(range.startContainer);\n  };\n\n  var isContentEditableTrue$1 = isContentEditableTrue;\n  var isContentEditableFalse$1 = isContentEditableFalse;\n  var isBr$2 = isBr;\n  var isText$3 = isText$1;\n  var isInvalidTextElement = matchNodeNames(['script', 'style', 'textarea']);\n  var isAtomicInline = matchNodeNames(['img', 'input', 'textarea', 'hr', 'iframe', 'video', 'audio', 'object', 'embed']);\n  var isTable$2 = matchNodeNames(['table']);\n  var isCaretContainer$1 = isCaretContainer;\n\n  var isCaretCandidate = function (node) {\n    if (isCaretContainer$1(node)) {\n      return false;\n    }\n\n    if (isText$3(node)) {\n      return !isInvalidTextElement(node.parentNode);\n    }\n\n    return isAtomicInline(node) || isBr$2(node) || isTable$2(node) || isNonUiContentEditableFalse(node);\n  };\n\n  var isUnselectable = function (node) {\n    return isElement$1(node) && node.getAttribute('unselectable') === 'true';\n  };\n\n  var isNonUiContentEditableFalse = function (node) {\n    return isUnselectable(node) === false && isContentEditableFalse$1(node);\n  };\n\n  var isInEditable = function (node, root) {\n    for (node = node.parentNode; node && node !== root; node = node.parentNode) {\n      if (isNonUiContentEditableFalse(node)) {\n        return false;\n      }\n\n      if (isContentEditableTrue$1(node)) {\n        return true;\n      }\n    }\n\n    return true;\n  };\n\n  var isAtomicContentEditableFalse = function (node) {\n    if (!isNonUiContentEditableFalse(node)) {\n      return false;\n    }\n\n    return foldl(from$1(node.getElementsByTagName('*')), function (result, elm) {\n      return result || isContentEditableTrue$1(elm);\n    }, false) !== true;\n  };\n\n  var isAtomic = function (node) {\n    return isAtomicInline(node) || isAtomicContentEditableFalse(node);\n  };\n\n  var isEditableCaretCandidate = function (node, root) {\n    return isCaretCandidate(node) && isInEditable(node, root);\n  };\n\n  var whiteSpaceRegExp$1 = /^[ \\t\\r\\n]*$/;\n\n  var isWhitespaceText = function (text) {\n    return whiteSpaceRegExp$1.test(text);\n  };\n\n  var hasWhitespacePreserveParent = function (node, rootNode) {\n    var rootElement = SugarElement.fromDom(rootNode);\n    var startNode = SugarElement.fromDom(node);\n    return ancestor$2(startNode, 'pre,code', curry(eq$2, rootElement));\n  };\n\n  var isWhitespace = function (node, rootNode) {\n    return isText$1(node) && isWhitespaceText(node.data) && hasWhitespacePreserveParent(node, rootNode) === false;\n  };\n\n  var isNamedAnchor = function (node) {\n    return isElement$1(node) && node.nodeName === 'A' && !node.hasAttribute('href') && (node.hasAttribute('name') || node.hasAttribute('id'));\n  };\n\n  var isContent = function (node, rootNode) {\n    return isCaretCandidate(node) && isWhitespace(node, rootNode) === false || isNamedAnchor(node) || isBookmark(node);\n  };\n\n  var isBookmark = hasAttribute('data-mce-bookmark');\n  var isBogus$1 = hasAttribute('data-mce-bogus');\n  var isBogusAll$1 = hasAttributeValue('data-mce-bogus', 'all');\n\n  var isEmptyNode = function (targetNode, skipBogus) {\n    var node,\n        brCount = 0;\n\n    if (isContent(targetNode, targetNode)) {\n      return false;\n    } else {\n      node = targetNode.firstChild;\n\n      if (!node) {\n        return true;\n      }\n\n      var walker = new DomTreeWalker(node, targetNode);\n\n      do {\n        if (skipBogus) {\n          if (isBogusAll$1(node)) {\n            node = walker.next(true);\n            continue;\n          }\n\n          if (isBogus$1(node)) {\n            node = walker.next();\n            continue;\n          }\n        }\n\n        if (isBr(node)) {\n          brCount++;\n          node = walker.next();\n          continue;\n        }\n\n        if (isContent(node, targetNode)) {\n          return false;\n        }\n\n        node = walker.next();\n      } while (node);\n\n      return brCount <= 1;\n    }\n  };\n\n  var isEmpty = function (elm, skipBogus) {\n    if (skipBogus === void 0) {\n      skipBogus = true;\n    }\n\n    return isEmptyNode(elm.dom, skipBogus);\n  };\n\n  var isSpan = function (node) {\n    return node.nodeName.toLowerCase() === 'span';\n  };\n\n  var isInlineContent = function (node, root) {\n    return isNonNullable(node) && (isContent(node, root) || isInline(SugarElement.fromDom(node)));\n  };\n\n  var surroundedByInlineContent = function (node, root) {\n    var prev = new DomTreeWalker(node, root).prev(false);\n    var next = new DomTreeWalker(node, root).next(false);\n    var prevIsInline = isUndefined(prev) || isInlineContent(prev, root);\n    var nextIsInline = isUndefined(next) || isInlineContent(next, root);\n    return prevIsInline && nextIsInline;\n  };\n\n  var isBookmarkNode = function (node) {\n    return isSpan(node) && node.getAttribute('data-mce-type') === 'bookmark';\n  };\n\n  var isKeepTextNode = function (node, root) {\n    return isText$1(node) && node.data.length > 0 && surroundedByInlineContent(node, root);\n  };\n\n  var isKeepElement = function (node) {\n    return isElement$1(node) ? node.childNodes.length > 0 : false;\n  };\n\n  var isDocument$2 = function (node) {\n    return isDocumentFragment$1(node) || isDocument$1(node);\n  };\n\n  var trimNode = function (dom, node, root) {\n    var rootNode = root || node;\n\n    if (isElement$1(node) && isBookmarkNode(node)) {\n      return node;\n    }\n\n    var children = node.childNodes;\n\n    for (var i = children.length - 1; i >= 0; i--) {\n      trimNode(dom, children[i], rootNode);\n    }\n\n    if (isElement$1(node)) {\n      var currentChildren = node.childNodes;\n\n      if (currentChildren.length === 1 && isBookmarkNode(currentChildren[0])) {\n        node.parentNode.insertBefore(currentChildren[0], node);\n      }\n    }\n\n    if (!isDocument$2(node) && !isContent(node, rootNode) && !isKeepElement(node) && !isKeepTextNode(node, rootNode)) {\n      dom.remove(node);\n    }\n\n    return node;\n  };\n\n  var makeMap$1 = Tools.makeMap;\n  var attrsCharsRegExp = /[&<>\\\"\\u0060\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\n  var textCharsRegExp = /[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\n  var rawCharsRegExp = /[<>&\\\"\\']/g;\n  var entityRegExp = /&#([a-z0-9]+);?|&([a-z0-9]+);/gi;\n  var asciiMap = {\n    128: '\\u20AC',\n    130: '\\u201A',\n    131: '\\u0192',\n    132: '\\u201E',\n    133: '\\u2026',\n    134: '\\u2020',\n    135: '\\u2021',\n    136: '\\u02c6',\n    137: '\\u2030',\n    138: '\\u0160',\n    139: '\\u2039',\n    140: '\\u0152',\n    142: '\\u017d',\n    145: '\\u2018',\n    146: '\\u2019',\n    147: '\\u201C',\n    148: '\\u201D',\n    149: '\\u2022',\n    150: '\\u2013',\n    151: '\\u2014',\n    152: '\\u02DC',\n    153: '\\u2122',\n    154: '\\u0161',\n    155: '\\u203A',\n    156: '\\u0153',\n    158: '\\u017e',\n    159: '\\u0178'\n  };\n  var baseEntities = {\n    '\"': '&quot;',\n    '\\'': '&#39;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '&': '&amp;',\n    '`': '&#96;'\n  };\n  var reverseEntities = {\n    '&lt;': '<',\n    '&gt;': '>',\n    '&amp;': '&',\n    '&quot;': '\"',\n    '&apos;': '\\''\n  };\n\n  var nativeDecode = function (text) {\n    var elm = SugarElement.fromTag('div').dom;\n    elm.innerHTML = text;\n    return elm.textContent || elm.innerText || text;\n  };\n\n  var buildEntitiesLookup = function (items, radix) {\n    var i, chr, entity;\n    var lookup = {};\n\n    if (items) {\n      items = items.split(',');\n      radix = radix || 10;\n\n      for (i = 0; i < items.length; i += 2) {\n        chr = String.fromCharCode(parseInt(items[i], radix));\n\n        if (!baseEntities[chr]) {\n          entity = '&' + items[i + 1] + ';';\n          lookup[chr] = entity;\n          lookup[entity] = chr;\n        }\n      }\n\n      return lookup;\n    }\n  };\n\n  var namedEntities = buildEntitiesLookup('50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' + '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' + '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' + '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' + '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' + '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' + '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' + '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' + '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' + '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' + 'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' + 'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' + 't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' + 'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' + 'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' + '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' + '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' + '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' + '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' + '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' + 'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' + 'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' + 'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' + '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' + '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\n\n  var encodeRaw = function (text, attr) {\n    return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n      return baseEntities[chr] || chr;\n    });\n  };\n\n  var encodeAllRaw = function (text) {\n    return ('' + text).replace(rawCharsRegExp, function (chr) {\n      return baseEntities[chr] || chr;\n    });\n  };\n\n  var encodeNumeric = function (text, attr) {\n    return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n      if (chr.length > 1) {\n        return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\n      }\n\n      return baseEntities[chr] || '&#' + chr.charCodeAt(0) + ';';\n    });\n  };\n\n  var encodeNamed = function (text, attr, entities) {\n    entities = entities || namedEntities;\n    return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n      return baseEntities[chr] || entities[chr] || chr;\n    });\n  };\n\n  var getEncodeFunc = function (name, entities) {\n    var entitiesMap = buildEntitiesLookup(entities) || namedEntities;\n\n    var encodeNamedAndNumeric = function (text, attr) {\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        if (baseEntities[chr] !== undefined) {\n          return baseEntities[chr];\n        }\n\n        if (entitiesMap[chr] !== undefined) {\n          return entitiesMap[chr];\n        }\n\n        if (chr.length > 1) {\n          return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\n        }\n\n        return '&#' + chr.charCodeAt(0) + ';';\n      });\n    };\n\n    var encodeCustomNamed = function (text, attr) {\n      return encodeNamed(text, attr, entitiesMap);\n    };\n\n    var nameMap = makeMap$1(name.replace(/\\+/g, ','));\n\n    if (nameMap.named && nameMap.numeric) {\n      return encodeNamedAndNumeric;\n    }\n\n    if (nameMap.named) {\n      if (entities) {\n        return encodeCustomNamed;\n      }\n\n      return encodeNamed;\n    }\n\n    if (nameMap.numeric) {\n      return encodeNumeric;\n    }\n\n    return encodeRaw;\n  };\n\n  var decode = function (text) {\n    return text.replace(entityRegExp, function (all, numeric) {\n      if (numeric) {\n        if (numeric.charAt(0).toLowerCase() === 'x') {\n          numeric = parseInt(numeric.substr(1), 16);\n        } else {\n          numeric = parseInt(numeric, 10);\n        }\n\n        if (numeric > 65535) {\n          numeric -= 65536;\n          return String.fromCharCode(55296 + (numeric >> 10), 56320 + (numeric & 1023));\n        }\n\n        return asciiMap[numeric] || String.fromCharCode(numeric);\n      }\n\n      return reverseEntities[all] || namedEntities[all] || nativeDecode(all);\n    });\n  };\n\n  var Entities = {\n    encodeRaw: encodeRaw,\n    encodeAllRaw: encodeAllRaw,\n    encodeNumeric: encodeNumeric,\n    encodeNamed: encodeNamed,\n    getEncodeFunc: getEncodeFunc,\n    decode: decode\n  };\n  var mapCache = {},\n      dummyObj = {};\n  var makeMap$2 = Tools.makeMap,\n      each$3 = Tools.each,\n      extend$1 = Tools.extend,\n      explode$1 = Tools.explode,\n      inArray = Tools.inArray;\n\n  var split = function (items, delim) {\n    items = Tools.trim(items);\n    return items ? items.split(delim || ' ') : [];\n  };\n\n  var compileSchema = function (type) {\n    var schema = {};\n    var globalAttributes, blockContent;\n    var phrasingContent, flowContent, html4BlockContent, html4PhrasingContent;\n\n    var add = function (name, attributes, children) {\n      var ni, attributesOrder, element;\n\n      var arrayToMap = function (array, obj) {\n        var map = {};\n        var i, l;\n\n        for (i = 0, l = array.length; i < l; i++) {\n          map[array[i]] = obj || {};\n        }\n\n        return map;\n      };\n\n      children = children || [];\n      attributes = attributes || '';\n\n      if (typeof children === 'string') {\n        children = split(children);\n      }\n\n      var names = split(name);\n      ni = names.length;\n\n      while (ni--) {\n        attributesOrder = split([globalAttributes, attributes].join(' '));\n        element = {\n          attributes: arrayToMap(attributesOrder),\n          attributesOrder: attributesOrder,\n          children: arrayToMap(children, dummyObj)\n        };\n        schema[names[ni]] = element;\n      }\n    };\n\n    var addAttrs = function (name, attributes) {\n      var ni, schemaItem, i, l;\n      var names = split(name);\n      ni = names.length;\n      var attrs = split(attributes);\n\n      while (ni--) {\n        schemaItem = schema[names[ni]];\n\n        for (i = 0, l = attrs.length; i < l; i++) {\n          schemaItem.attributes[attrs[i]] = {};\n          schemaItem.attributesOrder.push(attrs[i]);\n        }\n      }\n    };\n\n    if (mapCache[type]) {\n      return mapCache[type];\n    }\n\n    globalAttributes = 'id accesskey class dir lang style tabindex title role';\n    blockContent = 'address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul';\n    phrasingContent = 'a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd ' + 'label map noscript object q s samp script select small span strong sub sup ' + 'textarea u var #text #comment';\n\n    if (type !== 'html4') {\n      globalAttributes += ' contenteditable contextmenu draggable dropzone ' + 'hidden spellcheck translate';\n      blockContent += ' article aside details dialog figure main header footer hgroup section nav';\n      phrasingContent += ' audio canvas command datalist mark meter output picture ' + 'progress time wbr video ruby bdi keygen';\n    }\n\n    if (type !== 'html5-strict') {\n      globalAttributes += ' xml:lang';\n      html4PhrasingContent = 'acronym applet basefont big font strike tt';\n      phrasingContent = [phrasingContent, html4PhrasingContent].join(' ');\n      each$3(split(html4PhrasingContent), function (name) {\n        add(name, '', phrasingContent);\n      });\n      html4BlockContent = 'center dir isindex noframes';\n      blockContent = [blockContent, html4BlockContent].join(' ');\n      flowContent = [blockContent, phrasingContent].join(' ');\n      each$3(split(html4BlockContent), function (name) {\n        add(name, '', flowContent);\n      });\n    }\n\n    flowContent = flowContent || [blockContent, phrasingContent].join(' ');\n    add('html', 'manifest', 'head body');\n    add('head', '', 'base command link meta noscript script style title');\n    add('title hr noscript br');\n    add('base', 'href target');\n    add('link', 'href rel media hreflang type sizes hreflang');\n    add('meta', 'name http-equiv content charset');\n    add('style', 'media type scoped');\n    add('script', 'src async defer type charset');\n    add('body', 'onafterprint onbeforeprint onbeforeunload onblur onerror onfocus ' + 'onhashchange onload onmessage onoffline ononline onpagehide onpageshow ' + 'onpopstate onresize onscroll onstorage onunload', flowContent);\n    add('address dt dd div caption', '', flowContent);\n    add('h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn', '', phrasingContent);\n    add('blockquote', 'cite', flowContent);\n    add('ol', 'reversed start type', 'li');\n    add('ul', '', 'li');\n    add('li', 'value', flowContent);\n    add('dl', '', 'dt dd');\n    add('a', 'href target rel media hreflang type', phrasingContent);\n    add('q', 'cite', phrasingContent);\n    add('ins del', 'cite datetime', flowContent);\n    add('img', 'src sizes srcset alt usemap ismap width height');\n    add('iframe', 'src name width height', flowContent);\n    add('embed', 'src type width height');\n    add('object', 'data type typemustmatch name usemap form width height', [flowContent, 'param'].join(' '));\n    add('param', 'name value');\n    add('map', 'name', [flowContent, 'area'].join(' '));\n    add('area', 'alt coords shape href target rel media hreflang type');\n    add('table', 'border', 'caption colgroup thead tfoot tbody tr' + (type === 'html4' ? ' col' : ''));\n    add('colgroup', 'span', 'col');\n    add('col', 'span');\n    add('tbody thead tfoot', '', 'tr');\n    add('tr', '', 'td th');\n    add('td', 'colspan rowspan headers', flowContent);\n    add('th', 'colspan rowspan headers scope abbr', flowContent);\n    add('form', 'accept-charset action autocomplete enctype method name novalidate target', flowContent);\n    add('fieldset', 'disabled form name', [flowContent, 'legend'].join(' '));\n    add('label', 'form for', phrasingContent);\n    add('input', 'accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate ' + 'formtarget height list max maxlength min multiple name pattern readonly required size src step type value width');\n    add('button', 'disabled form formaction formenctype formmethod formnovalidate formtarget name type value', type === 'html4' ? flowContent : phrasingContent);\n    add('select', 'disabled form multiple name required size', 'option optgroup');\n    add('optgroup', 'disabled label', 'option');\n    add('option', 'disabled label selected value');\n    add('textarea', 'cols dirname disabled form maxlength name readonly required rows wrap');\n    add('menu', 'type label', [flowContent, 'li'].join(' '));\n    add('noscript', '', flowContent);\n\n    if (type !== 'html4') {\n      add('wbr');\n      add('ruby', '', [phrasingContent, 'rt rp'].join(' '));\n      add('figcaption', '', flowContent);\n      add('mark rt rp summary bdi', '', phrasingContent);\n      add('canvas', 'width height', flowContent);\n      add('video', 'src crossorigin poster preload autoplay mediagroup loop ' + 'muted controls width height buffered', [flowContent, 'track source'].join(' '));\n      add('audio', 'src crossorigin preload autoplay mediagroup loop muted controls ' + 'buffered volume', [flowContent, 'track source'].join(' '));\n      add('picture', '', 'img source');\n      add('source', 'src srcset type media sizes');\n      add('track', 'kind src srclang label default');\n      add('datalist', '', [phrasingContent, 'option'].join(' '));\n      add('article section nav aside main header footer', '', flowContent);\n      add('hgroup', '', 'h1 h2 h3 h4 h5 h6');\n      add('figure', '', [flowContent, 'figcaption'].join(' '));\n      add('time', 'datetime', phrasingContent);\n      add('dialog', 'open', flowContent);\n      add('command', 'type label icon disabled checked radiogroup command');\n      add('output', 'for form name', phrasingContent);\n      add('progress', 'value max', phrasingContent);\n      add('meter', 'value min max low high optimum', phrasingContent);\n      add('details', 'open', [flowContent, 'summary'].join(' '));\n      add('keygen', 'autofocus challenge disabled form keytype name');\n    }\n\n    if (type !== 'html5-strict') {\n      addAttrs('script', 'language xml:space');\n      addAttrs('style', 'xml:space');\n      addAttrs('object', 'declare classid code codebase codetype archive standby align border hspace vspace');\n      addAttrs('embed', 'align name hspace vspace');\n      addAttrs('param', 'valuetype type');\n      addAttrs('a', 'charset name rev shape coords');\n      addAttrs('br', 'clear');\n      addAttrs('applet', 'codebase archive code object alt name width height align hspace vspace');\n      addAttrs('img', 'name longdesc align border hspace vspace');\n      addAttrs('iframe', 'longdesc frameborder marginwidth marginheight scrolling align');\n      addAttrs('font basefont', 'size color face');\n      addAttrs('input', 'usemap align');\n      addAttrs('select');\n      addAttrs('textarea');\n      addAttrs('h1 h2 h3 h4 h5 h6 div p legend caption', 'align');\n      addAttrs('ul', 'type compact');\n      addAttrs('li', 'type');\n      addAttrs('ol dl menu dir', 'compact');\n      addAttrs('pre', 'width xml:space');\n      addAttrs('hr', 'align noshade size width');\n      addAttrs('isindex', 'prompt');\n      addAttrs('table', 'summary width frame rules cellspacing cellpadding align bgcolor');\n      addAttrs('col', 'width align char charoff valign');\n      addAttrs('colgroup', 'width align char charoff valign');\n      addAttrs('thead', 'align char charoff valign');\n      addAttrs('tr', 'align char charoff valign bgcolor');\n      addAttrs('th', 'axis align char charoff valign nowrap bgcolor width height');\n      addAttrs('form', 'accept');\n      addAttrs('td', 'abbr axis scope align char charoff valign nowrap bgcolor width height');\n      addAttrs('tfoot', 'align char charoff valign');\n      addAttrs('tbody', 'align char charoff valign');\n      addAttrs('area', 'nohref');\n      addAttrs('body', 'background bgcolor text link vlink alink');\n    }\n\n    if (type !== 'html4') {\n      addAttrs('input button select textarea', 'autofocus');\n      addAttrs('input textarea', 'placeholder');\n      addAttrs('a', 'download');\n      addAttrs('link script img', 'crossorigin');\n      addAttrs('img', 'loading');\n      addAttrs('iframe', 'sandbox seamless allowfullscreen loading');\n    }\n\n    each$3(split('a form meter progress dfn'), function (name) {\n      if (schema[name]) {\n        delete schema[name].children[name];\n      }\n    });\n    delete schema.caption.children.table;\n    delete schema.script;\n    mapCache[type] = schema;\n    return schema;\n  };\n\n  var compileElementMap = function (value, mode) {\n    var styles;\n\n    if (value) {\n      styles = {};\n\n      if (typeof value === 'string') {\n        value = {\n          '*': value\n        };\n      }\n\n      each$3(value, function (value, key) {\n        styles[key] = styles[key.toUpperCase()] = mode === 'map' ? makeMap$2(value, /[, ]/) : explode$1(value, /[, ]/);\n      });\n    }\n\n    return styles;\n  };\n\n  function Schema(settings) {\n    var elements = {};\n    var children = {};\n    var patternElements = [];\n    var customElementsMap = {},\n        specialElements = {};\n\n    var createLookupTable = function (option, defaultValue, extendWith) {\n      var value = settings[option];\n\n      if (!value) {\n        value = mapCache[option];\n\n        if (!value) {\n          value = makeMap$2(defaultValue, ' ', makeMap$2(defaultValue.toUpperCase(), ' '));\n          value = extend$1(value, extendWith);\n          mapCache[option] = value;\n        }\n      } else {\n        value = makeMap$2(value, /[, ]/, makeMap$2(value.toUpperCase(), /[, ]/));\n      }\n\n      return value;\n    };\n\n    settings = settings || {};\n    var schemaItems = compileSchema(settings.schema);\n\n    if (settings.verify_html === false) {\n      settings.valid_elements = '*[*]';\n    }\n\n    var validStyles = compileElementMap(settings.valid_styles);\n    var invalidStyles = compileElementMap(settings.invalid_styles, 'map');\n    var validClasses = compileElementMap(settings.valid_classes, 'map');\n    var whiteSpaceElementsMap = createLookupTable('whitespace_elements', 'pre script noscript style textarea video audio iframe object code');\n    var selfClosingElementsMap = createLookupTable('self_closing_elements', 'colgroup dd dt li option p td tfoot th thead tr');\n    var shortEndedElementsMap = createLookupTable('short_ended_elements', 'area base basefont br col frame hr img input isindex link ' + 'meta param embed source wbr track');\n    var boolAttrMap = createLookupTable('boolean_attributes', 'checked compact declare defer disabled ismap multiple nohref noresize ' + 'noshade nowrap readonly selected autoplay loop controls');\n    var nonEmptyOrMoveCaretBeforeOnEnter = 'td th iframe video audio object script code';\n    var nonEmptyElementsMap = createLookupTable('non_empty_elements', nonEmptyOrMoveCaretBeforeOnEnter + ' pre', shortEndedElementsMap);\n    var moveCaretBeforeOnEnterElementsMap = createLookupTable('move_caret_before_on_enter_elements', nonEmptyOrMoveCaretBeforeOnEnter + ' table', shortEndedElementsMap);\n    var textBlockElementsMap = createLookupTable('text_block_elements', 'h1 h2 h3 h4 h5 h6 p div address pre form ' + 'blockquote center dir fieldset header footer article section hgroup aside main nav figure');\n    var blockElementsMap = createLookupTable('block_elements', 'hr table tbody thead tfoot ' + 'th tr td li ol ul caption dl dt dd noscript menu isindex option ' + 'datalist select optgroup figcaption details summary', textBlockElementsMap);\n    var textInlineElementsMap = createLookupTable('text_inline_elements', 'span strong b em i font strike u var cite ' + 'dfn code mark q sup sub samp');\n    each$3((settings.special || 'script noscript iframe noframes noembed title style textarea xmp').split(' '), function (name) {\n      specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\n    });\n\n    var patternToRegExp = function (str) {\n      return new RegExp('^' + str.replace(/([?+*])/g, '.$1') + '$');\n    };\n\n    var addValidElements = function (validElements) {\n      var ei, el, ai, al, matches, element, attr, attrData, elementName, attrName, attrType, attributes, attributesOrder, prefix, outputName, globalAttributes, globalAttributesOrder, value;\n      var elementRuleRegExp = /^([#+\\-])?([^\\[!\\/]+)(?:\\/([^\\[!]+))?(?:(!?)\\[([^\\]]+)])?$/,\n          attrRuleRegExp = /^([!\\-])?(\\w+[\\\\:]:\\w+|[^=:<]+)?(?:([=:<])(.*))?$/,\n          hasPatternsRegExp = /[*?+]/;\n\n      if (validElements) {\n        var validElementsArr = split(validElements, ',');\n\n        if (elements['@']) {\n          globalAttributes = elements['@'].attributes;\n          globalAttributesOrder = elements['@'].attributesOrder;\n        }\n\n        for (ei = 0, el = validElementsArr.length; ei < el; ei++) {\n          matches = elementRuleRegExp.exec(validElementsArr[ei]);\n\n          if (matches) {\n            prefix = matches[1];\n            elementName = matches[2];\n            outputName = matches[3];\n            attrData = matches[5];\n            attributes = {};\n            attributesOrder = [];\n            element = {\n              attributes: attributes,\n              attributesOrder: attributesOrder\n            };\n\n            if (prefix === '#') {\n              element.paddEmpty = true;\n            }\n\n            if (prefix === '-') {\n              element.removeEmpty = true;\n            }\n\n            if (matches[4] === '!') {\n              element.removeEmptyAttrs = true;\n            }\n\n            if (globalAttributes) {\n              each$1(globalAttributes, function (value, key) {\n                attributes[key] = value;\n              });\n              attributesOrder.push.apply(attributesOrder, globalAttributesOrder);\n            }\n\n            if (attrData) {\n              attrData = split(attrData, '|');\n\n              for (ai = 0, al = attrData.length; ai < al; ai++) {\n                matches = attrRuleRegExp.exec(attrData[ai]);\n\n                if (matches) {\n                  attr = {};\n                  attrType = matches[1];\n                  attrName = matches[2].replace(/[\\\\:]:/g, ':');\n                  prefix = matches[3];\n                  value = matches[4];\n\n                  if (attrType === '!') {\n                    element.attributesRequired = element.attributesRequired || [];\n                    element.attributesRequired.push(attrName);\n                    attr.required = true;\n                  }\n\n                  if (attrType === '-') {\n                    delete attributes[attrName];\n                    attributesOrder.splice(inArray(attributesOrder, attrName), 1);\n                    continue;\n                  }\n\n                  if (prefix) {\n                    if (prefix === '=') {\n                      element.attributesDefault = element.attributesDefault || [];\n                      element.attributesDefault.push({\n                        name: attrName,\n                        value: value\n                      });\n                      attr.defaultValue = value;\n                    }\n\n                    if (prefix === ':') {\n                      element.attributesForced = element.attributesForced || [];\n                      element.attributesForced.push({\n                        name: attrName,\n                        value: value\n                      });\n                      attr.forcedValue = value;\n                    }\n\n                    if (prefix === '<') {\n                      attr.validValues = makeMap$2(value, '?');\n                    }\n                  }\n\n                  if (hasPatternsRegExp.test(attrName)) {\n                    element.attributePatterns = element.attributePatterns || [];\n                    attr.pattern = patternToRegExp(attrName);\n                    element.attributePatterns.push(attr);\n                  } else {\n                    if (!attributes[attrName]) {\n                      attributesOrder.push(attrName);\n                    }\n\n                    attributes[attrName] = attr;\n                  }\n                }\n              }\n            }\n\n            if (!globalAttributes && elementName === '@') {\n              globalAttributes = attributes;\n              globalAttributesOrder = attributesOrder;\n            }\n\n            if (outputName) {\n              element.outputName = elementName;\n              elements[outputName] = element;\n            }\n\n            if (hasPatternsRegExp.test(elementName)) {\n              element.pattern = patternToRegExp(elementName);\n              patternElements.push(element);\n            } else {\n              elements[elementName] = element;\n            }\n          }\n        }\n      }\n    };\n\n    var setValidElements = function (validElements) {\n      elements = {};\n      patternElements = [];\n      addValidElements(validElements);\n      each$3(schemaItems, function (element, name) {\n        children[name] = element.children;\n      });\n    };\n\n    var addCustomElements = function (customElements) {\n      var customElementRegExp = /^(~)?(.+)$/;\n\n      if (customElements) {\n        mapCache.text_block_elements = mapCache.block_elements = null;\n        each$3(split(customElements, ','), function (rule) {\n          var matches = customElementRegExp.exec(rule),\n              inline = matches[1] === '~',\n              cloneName = inline ? 'span' : 'div',\n              name = matches[2];\n          children[name] = children[cloneName];\n          customElementsMap[name] = cloneName;\n\n          if (!inline) {\n            blockElementsMap[name.toUpperCase()] = {};\n            blockElementsMap[name] = {};\n          }\n\n          if (!elements[name]) {\n            var customRule = elements[cloneName];\n            customRule = extend$1({}, customRule);\n            delete customRule.removeEmptyAttrs;\n            delete customRule.removeEmpty;\n            elements[name] = customRule;\n          }\n\n          each$3(children, function (element, elmName) {\n            if (element[cloneName]) {\n              children[elmName] = element = extend$1({}, children[elmName]);\n              element[name] = element[cloneName];\n            }\n          });\n        });\n      }\n    };\n\n    var addValidChildren = function (validChildren) {\n      var childRuleRegExp = /^([+\\-]?)([A-Za-z0-9_\\-.\\u00b7\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u037d\\u037f-\\u1fff\\u200c-\\u200d\\u203f-\\u2040\\u2070-\\u218f\\u2c00-\\u2fef\\u3001-\\ud7ff\\uf900-\\ufdcf\\ufdf0-\\ufffd]+)\\[([^\\]]+)]$/;\n      mapCache[settings.schema] = null;\n\n      if (validChildren) {\n        each$3(split(validChildren, ','), function (rule) {\n          var matches = childRuleRegExp.exec(rule);\n          var parent, prefix;\n\n          if (matches) {\n            prefix = matches[1];\n\n            if (prefix) {\n              parent = children[matches[2]];\n            } else {\n              parent = children[matches[2]] = {\n                '#comment': {}\n              };\n            }\n\n            parent = children[matches[2]];\n            each$3(split(matches[3], '|'), function (child) {\n              if (prefix === '-') {\n                delete parent[child];\n              } else {\n                parent[child] = {};\n              }\n            });\n          }\n        });\n      }\n    };\n\n    var getElementRule = function (name) {\n      var element = elements[name],\n          i;\n\n      if (element) {\n        return element;\n      }\n\n      i = patternElements.length;\n\n      while (i--) {\n        element = patternElements[i];\n\n        if (element.pattern.test(name)) {\n          return element;\n        }\n      }\n    };\n\n    if (!settings.valid_elements) {\n      each$3(schemaItems, function (element, name) {\n        elements[name] = {\n          attributes: element.attributes,\n          attributesOrder: element.attributesOrder\n        };\n        children[name] = element.children;\n      });\n\n      if (settings.schema !== 'html5') {\n        each$3(split('strong/b em/i'), function (item) {\n          var items = split(item, '/');\n          elements[items[1]].outputName = items[0];\n        });\n      }\n\n      each$3(split('ol ul sub sup blockquote span font a table tbody strong em b i'), function (name) {\n        if (elements[name]) {\n          elements[name].removeEmpty = true;\n        }\n      });\n      each$3(split('p h1 h2 h3 h4 h5 h6 th td pre div address caption li'), function (name) {\n        elements[name].paddEmpty = true;\n      });\n      each$3(split('span'), function (name) {\n        elements[name].removeEmptyAttrs = true;\n      });\n    } else {\n      setValidElements(settings.valid_elements);\n    }\n\n    addCustomElements(settings.custom_elements);\n    addValidChildren(settings.valid_children);\n    addValidElements(settings.extended_valid_elements);\n    addValidChildren('+ol[ul|ol],+ul[ul|ol]');\n    each$3({\n      dd: 'dl',\n      dt: 'dl',\n      li: 'ul ol',\n      td: 'tr',\n      th: 'tr',\n      tr: 'tbody thead tfoot',\n      tbody: 'table',\n      thead: 'table',\n      tfoot: 'table',\n      legend: 'fieldset',\n      area: 'map',\n      param: 'video audio object'\n    }, function (parents, item) {\n      if (elements[item]) {\n        elements[item].parentsRequired = split(parents);\n      }\n    });\n\n    if (settings.invalid_elements) {\n      each$3(explode$1(settings.invalid_elements), function (item) {\n        if (elements[item]) {\n          delete elements[item];\n        }\n      });\n    }\n\n    if (!getElementRule('span')) {\n      addValidElements('span[!data-mce-type|*]');\n    }\n\n    var getValidStyles = function () {\n      return validStyles;\n    };\n\n    var getInvalidStyles = function () {\n      return invalidStyles;\n    };\n\n    var getValidClasses = function () {\n      return validClasses;\n    };\n\n    var getBoolAttrs = function () {\n      return boolAttrMap;\n    };\n\n    var getBlockElements = function () {\n      return blockElementsMap;\n    };\n\n    var getTextBlockElements = function () {\n      return textBlockElementsMap;\n    };\n\n    var getTextInlineElements = function () {\n      return textInlineElementsMap;\n    };\n\n    var getShortEndedElements = function () {\n      return shortEndedElementsMap;\n    };\n\n    var getSelfClosingElements = function () {\n      return selfClosingElementsMap;\n    };\n\n    var getNonEmptyElements = function () {\n      return nonEmptyElementsMap;\n    };\n\n    var getMoveCaretBeforeOnEnterElements = function () {\n      return moveCaretBeforeOnEnterElementsMap;\n    };\n\n    var getWhiteSpaceElements = function () {\n      return whiteSpaceElementsMap;\n    };\n\n    var getSpecialElements = function () {\n      return specialElements;\n    };\n\n    var isValidChild = function (name, child) {\n      var parent = children[name.toLowerCase()];\n      return !!(parent && parent[child.toLowerCase()]);\n    };\n\n    var isValid = function (name, attr) {\n      var attrPatterns, i;\n      var rule = getElementRule(name);\n\n      if (rule) {\n        if (attr) {\n          if (rule.attributes[attr]) {\n            return true;\n          }\n\n          attrPatterns = rule.attributePatterns;\n\n          if (attrPatterns) {\n            i = attrPatterns.length;\n\n            while (i--) {\n              if (attrPatterns[i].pattern.test(name)) {\n                return true;\n              }\n            }\n          }\n        } else {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    var getCustomElements = function () {\n      return customElementsMap;\n    };\n\n    return {\n      children: children,\n      elements: elements,\n      getValidStyles: getValidStyles,\n      getValidClasses: getValidClasses,\n      getBlockElements: getBlockElements,\n      getInvalidStyles: getInvalidStyles,\n      getShortEndedElements: getShortEndedElements,\n      getTextBlockElements: getTextBlockElements,\n      getTextInlineElements: getTextInlineElements,\n      getBoolAttrs: getBoolAttrs,\n      getElementRule: getElementRule,\n      getSelfClosingElements: getSelfClosingElements,\n      getNonEmptyElements: getNonEmptyElements,\n      getMoveCaretBeforeOnEnterElements: getMoveCaretBeforeOnEnterElements,\n      getWhiteSpaceElements: getWhiteSpaceElements,\n      getSpecialElements: getSpecialElements,\n      isValidChild: isValidChild,\n      isValid: isValid,\n      getCustomElements: getCustomElements,\n      addValidElements: addValidElements,\n      setValidElements: setValidElements,\n      addCustomElements: addCustomElements,\n      addValidChildren: addValidChildren\n    };\n  }\n\n  var toHex = function (match, r, g, b) {\n    var hex = function (val) {\n      val = parseInt(val, 10).toString(16);\n      return val.length > 1 ? val : '0' + val;\n    };\n\n    return '#' + hex(r) + hex(g) + hex(b);\n  };\n\n  var Styles = function (settings, schema) {\n    var rgbRegExp = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi;\n    var urlOrStrRegExp = /(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi;\n    var styleRegExp = /\\s*([^:]+):\\s*([^;]+);?/g;\n    var trimRightRegExp = /\\s+$/;\n    var i;\n    var encodingLookup = {};\n    var validStyles;\n    var invalidStyles;\n    var invisibleChar = zeroWidth;\n    settings = settings || {};\n\n    if (schema) {\n      validStyles = schema.getValidStyles();\n      invalidStyles = schema.getInvalidStyles();\n    }\n\n    var encodingItems = ('\\\\\" \\\\\\' \\\\; \\\\: ; : ' + invisibleChar).split(' ');\n\n    for (i = 0; i < encodingItems.length; i++) {\n      encodingLookup[encodingItems[i]] = invisibleChar + i;\n      encodingLookup[invisibleChar + i] = encodingItems[i];\n    }\n\n    return {\n      toHex: function (color) {\n        return color.replace(rgbRegExp, toHex);\n      },\n      parse: function (css) {\n        var styles = {};\n        var matches, name, value, isEncoded;\n        var urlConverter = settings.url_converter;\n        var urlConverterScope = settings.url_converter_scope || this;\n\n        var compress = function (prefix, suffix, noJoin) {\n          var top = styles[prefix + '-top' + suffix];\n\n          if (!top) {\n            return;\n          }\n\n          var right = styles[prefix + '-right' + suffix];\n\n          if (!right) {\n            return;\n          }\n\n          var bottom = styles[prefix + '-bottom' + suffix];\n\n          if (!bottom) {\n            return;\n          }\n\n          var left = styles[prefix + '-left' + suffix];\n\n          if (!left) {\n            return;\n          }\n\n          var box = [top, right, bottom, left];\n          i = box.length - 1;\n\n          while (i--) {\n            if (box[i] !== box[i + 1]) {\n              break;\n            }\n          }\n\n          if (i > -1 && noJoin) {\n            return;\n          }\n\n          styles[prefix + suffix] = i === -1 ? box[0] : box.join(' ');\n          delete styles[prefix + '-top' + suffix];\n          delete styles[prefix + '-right' + suffix];\n          delete styles[prefix + '-bottom' + suffix];\n          delete styles[prefix + '-left' + suffix];\n        };\n\n        var canCompress = function (key) {\n          var value = styles[key],\n              i;\n\n          if (!value) {\n            return;\n          }\n\n          value = value.split(' ');\n          i = value.length;\n\n          while (i--) {\n            if (value[i] !== value[0]) {\n              return false;\n            }\n          }\n\n          styles[key] = value[0];\n          return true;\n        };\n\n        var compress2 = function (target, a, b, c) {\n          if (!canCompress(a)) {\n            return;\n          }\n\n          if (!canCompress(b)) {\n            return;\n          }\n\n          if (!canCompress(c)) {\n            return;\n          }\n\n          styles[target] = styles[a] + ' ' + styles[b] + ' ' + styles[c];\n          delete styles[a];\n          delete styles[b];\n          delete styles[c];\n        };\n\n        var encode = function (str) {\n          isEncoded = true;\n          return encodingLookup[str];\n        };\n\n        var decode = function (str, keepSlashes) {\n          if (isEncoded) {\n            str = str.replace(/\\uFEFF[0-9]/g, function (str) {\n              return encodingLookup[str];\n            });\n          }\n\n          if (!keepSlashes) {\n            str = str.replace(/\\\\([\\'\\\";:])/g, '$1');\n          }\n\n          return str;\n        };\n\n        var decodeSingleHexSequence = function (escSeq) {\n          return String.fromCharCode(parseInt(escSeq.slice(1), 16));\n        };\n\n        var decodeHexSequences = function (value) {\n          return value.replace(/\\\\[0-9a-f]+/gi, decodeSingleHexSequence);\n        };\n\n        var processUrl = function (match, url, url2, url3, str, str2) {\n          str = str || str2;\n\n          if (str) {\n            str = decode(str);\n            return '\\'' + str.replace(/\\'/g, '\\\\\\'') + '\\'';\n          }\n\n          url = decode(url || url2 || url3);\n\n          if (!settings.allow_script_urls) {\n            var scriptUrl = url.replace(/[\\s\\r\\n]+/g, '');\n\n            if (/(java|vb)script:/i.test(scriptUrl)) {\n              return '';\n            }\n\n            if (!settings.allow_svg_data_urls && /^data:image\\/svg/i.test(scriptUrl)) {\n              return '';\n            }\n          }\n\n          if (urlConverter) {\n            url = urlConverter.call(urlConverterScope, url, 'style');\n          }\n\n          return 'url(\\'' + url.replace(/\\'/g, '\\\\\\'') + '\\')';\n        };\n\n        if (css) {\n          css = css.replace(/[\\u0000-\\u001F]/g, '');\n          css = css.replace(/\\\\[\\\"\\';:\\uFEFF]/g, encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g, function (str) {\n            return str.replace(/[;:]/g, encode);\n          });\n\n          while (matches = styleRegExp.exec(css)) {\n            styleRegExp.lastIndex = matches.index + matches[0].length;\n            name = matches[1].replace(trimRightRegExp, '').toLowerCase();\n            value = matches[2].replace(trimRightRegExp, '');\n\n            if (name && value) {\n              name = decodeHexSequences(name);\n              value = decodeHexSequences(value);\n\n              if (name.indexOf(invisibleChar) !== -1 || name.indexOf('\"') !== -1) {\n                continue;\n              }\n\n              if (!settings.allow_script_urls && (name === 'behavior' || /expression\\s*\\(|\\/\\*|\\*\\//.test(value))) {\n                continue;\n              }\n\n              if (name === 'font-weight' && value === '700') {\n                value = 'bold';\n              } else if (name === 'color' || name === 'background-color') {\n                value = value.toLowerCase();\n              }\n\n              value = value.replace(rgbRegExp, toHex);\n              value = value.replace(urlOrStrRegExp, processUrl);\n              styles[name] = isEncoded ? decode(value, true) : value;\n            }\n          }\n\n          compress('border', '', true);\n          compress('border', '-width');\n          compress('border', '-color');\n          compress('border', '-style');\n          compress('padding', '');\n          compress('margin', '');\n          compress2('border', 'border-width', 'border-style', 'border-color');\n\n          if (styles.border === 'medium none') {\n            delete styles.border;\n          }\n\n          if (styles['border-image'] === 'none') {\n            delete styles['border-image'];\n          }\n        }\n\n        return styles;\n      },\n      serialize: function (styles, elementName) {\n        var css = '';\n\n        var serializeStyles = function (name) {\n          var value;\n          var styleList = validStyles[name];\n\n          if (styleList) {\n            for (var i_1 = 0, l = styleList.length; i_1 < l; i_1++) {\n              name = styleList[i_1];\n              value = styles[name];\n\n              if (value) {\n                css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n              }\n            }\n          }\n        };\n\n        var isValid = function (name, elementName) {\n          var styleMap = invalidStyles['*'];\n\n          if (styleMap && styleMap[name]) {\n            return false;\n          }\n\n          styleMap = invalidStyles[elementName];\n          return !(styleMap && styleMap[name]);\n        };\n\n        if (elementName && validStyles) {\n          serializeStyles('*');\n          serializeStyles(elementName);\n        } else {\n          each$1(styles, function (value, name) {\n            if (value && (!invalidStyles || isValid(name, elementName))) {\n              css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n            }\n          });\n        }\n\n        return css;\n      }\n    };\n  };\n\n  var eventExpandoPrefix = 'mce-data-';\n  var mouseEventRe = /^(?:mouse|contextmenu)|click/;\n  var deprecated = {\n    keyLocation: 1,\n    layerX: 1,\n    layerY: 1,\n    returnValue: 1,\n    webkitMovementX: 1,\n    webkitMovementY: 1,\n    keyIdentifier: 1,\n    mozPressure: 1\n  };\n\n  var hasIsDefaultPrevented = function (event) {\n    return event.isDefaultPrevented === returnTrue || event.isDefaultPrevented === returnFalse;\n  };\n\n  var returnFalse = function () {\n    return false;\n  };\n\n  var returnTrue = function () {\n    return true;\n  };\n\n  var addEvent = function (target, name, callback, capture) {\n    if (target.addEventListener) {\n      target.addEventListener(name, callback, capture || false);\n    } else if (target.attachEvent) {\n      target.attachEvent('on' + name, callback);\n    }\n  };\n\n  var removeEvent = function (target, name, callback, capture) {\n    if (target.removeEventListener) {\n      target.removeEventListener(name, callback, capture || false);\n    } else if (target.detachEvent) {\n      target.detachEvent('on' + name, callback);\n    }\n  };\n\n  var isMouseEvent = function (event) {\n    return mouseEventRe.test(event.type);\n  };\n\n  var fix = function (originalEvent, data) {\n    var name;\n    var event = data || {};\n\n    for (name in originalEvent) {\n      if (!deprecated[name]) {\n        event[name] = originalEvent[name];\n      }\n    }\n\n    if (!event.target) {\n      event.target = event.srcElement || document;\n    }\n\n    if (event.composedPath) {\n      event.composedPath = function () {\n        return originalEvent.composedPath();\n      };\n    }\n\n    if (originalEvent && isMouseEvent(originalEvent) && originalEvent.pageX === undefined && originalEvent.clientX !== undefined) {\n      var eventDoc = event.target.ownerDocument || document;\n      var doc = eventDoc.documentElement;\n      var body = eventDoc.body;\n      event.pageX = originalEvent.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);\n      event.pageY = originalEvent.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0);\n    }\n\n    event.preventDefault = function () {\n      event.isDefaultPrevented = returnTrue;\n\n      if (originalEvent) {\n        if (originalEvent.preventDefault) {\n          originalEvent.preventDefault();\n        } else {\n          originalEvent.returnValue = false;\n        }\n      }\n    };\n\n    event.stopPropagation = function () {\n      event.isPropagationStopped = returnTrue;\n\n      if (originalEvent) {\n        if (originalEvent.stopPropagation) {\n          originalEvent.stopPropagation();\n        } else {\n          originalEvent.cancelBubble = true;\n        }\n      }\n    };\n\n    event.stopImmediatePropagation = function () {\n      event.isImmediatePropagationStopped = returnTrue;\n      event.stopPropagation();\n    };\n\n    if (hasIsDefaultPrevented(event) === false) {\n      event.isDefaultPrevented = returnFalse;\n      event.isPropagationStopped = returnFalse;\n      event.isImmediatePropagationStopped = returnFalse;\n    }\n\n    if (typeof event.metaKey === 'undefined') {\n      event.metaKey = false;\n    }\n\n    return event;\n  };\n\n  var bindOnReady = function (win, callback, eventUtils) {\n    var doc = win.document,\n        event = {\n      type: 'ready'\n    };\n\n    if (eventUtils.domLoaded) {\n      callback(event);\n      return;\n    }\n\n    var isDocReady = function () {\n      return doc.readyState === 'complete' || doc.readyState === 'interactive' && doc.body;\n    };\n\n    var readyHandler = function () {\n      removeEvent(win, 'DOMContentLoaded', readyHandler);\n      removeEvent(win, 'load', readyHandler);\n\n      if (!eventUtils.domLoaded) {\n        eventUtils.domLoaded = true;\n        callback(event);\n      }\n\n      win = null;\n    };\n\n    if (isDocReady()) {\n      readyHandler();\n    } else {\n      addEvent(win, 'DOMContentLoaded', readyHandler);\n    }\n\n    if (!eventUtils.domLoaded) {\n      addEvent(win, 'load', readyHandler);\n    }\n  };\n\n  var EventUtils = function () {\n    function EventUtils() {\n      this.domLoaded = false;\n      this.events = {};\n      this.count = 1;\n      this.expando = eventExpandoPrefix + (+new Date()).toString(32);\n      this.hasMouseEnterLeave = 'onmouseenter' in document.documentElement;\n      this.hasFocusIn = 'onfocusin' in document.documentElement;\n      this.count = 1;\n    }\n\n    EventUtils.prototype.bind = function (target, names, callback, scope) {\n      var self = this;\n      var id, callbackList, i, name, fakeName, nativeHandler, capture;\n      var win = window;\n\n      var defaultNativeHandler = function (evt) {\n        self.executeHandlers(fix(evt || win.event), id);\n      };\n\n      if (!target || target.nodeType === 3 || target.nodeType === 8) {\n        return;\n      }\n\n      if (!target[self.expando]) {\n        id = self.count++;\n        target[self.expando] = id;\n        self.events[id] = {};\n      } else {\n        id = target[self.expando];\n      }\n\n      scope = scope || target;\n      var namesList = names.split(' ');\n      i = namesList.length;\n\n      while (i--) {\n        name = namesList[i];\n        nativeHandler = defaultNativeHandler;\n        fakeName = capture = false;\n\n        if (name === 'DOMContentLoaded') {\n          name = 'ready';\n        }\n\n        if (self.domLoaded && name === 'ready' && target.readyState === 'complete') {\n          callback.call(scope, fix({\n            type: name\n          }));\n          continue;\n        }\n\n        if (!self.hasMouseEnterLeave) {\n          fakeName = self.mouseEnterLeave[name];\n\n          if (fakeName) {\n            nativeHandler = function (evt) {\n              var current = evt.currentTarget;\n              var related = evt.relatedTarget;\n\n              if (related && current.contains) {\n                related = current.contains(related);\n              } else {\n                while (related && related !== current) {\n                  related = related.parentNode;\n                }\n              }\n\n              if (!related) {\n                evt = fix(evt || win.event);\n                evt.type = evt.type === 'mouseout' ? 'mouseleave' : 'mouseenter';\n                evt.target = current;\n                self.executeHandlers(evt, id);\n              }\n            };\n          }\n        }\n\n        if (!self.hasFocusIn && (name === 'focusin' || name === 'focusout')) {\n          capture = true;\n          fakeName = name === 'focusin' ? 'focus' : 'blur';\n\n          nativeHandler = function (evt) {\n            evt = fix(evt || win.event);\n            evt.type = evt.type === 'focus' ? 'focusin' : 'focusout';\n            self.executeHandlers(evt, id);\n          };\n        }\n\n        callbackList = self.events[id][name];\n\n        if (!callbackList) {\n          self.events[id][name] = callbackList = [{\n            func: callback,\n            scope: scope\n          }];\n          callbackList.fakeName = fakeName;\n          callbackList.capture = capture;\n          callbackList.nativeHandler = nativeHandler;\n\n          if (name === 'ready') {\n            bindOnReady(target, nativeHandler, self);\n          } else {\n            addEvent(target, fakeName || name, nativeHandler, capture);\n          }\n        } else {\n          if (name === 'ready' && self.domLoaded) {\n            callback(fix({\n              type: name\n            }));\n          } else {\n            callbackList.push({\n              func: callback,\n              scope: scope\n            });\n          }\n        }\n      }\n\n      target = callbackList = null;\n      return callback;\n    };\n\n    EventUtils.prototype.unbind = function (target, names, callback) {\n      var callbackList, i, ci, name, eventMap;\n\n      if (!target || target.nodeType === 3 || target.nodeType === 8) {\n        return this;\n      }\n\n      var id = target[this.expando];\n\n      if (id) {\n        eventMap = this.events[id];\n\n        if (names) {\n          var namesList = names.split(' ');\n          i = namesList.length;\n\n          while (i--) {\n            name = namesList[i];\n            callbackList = eventMap[name];\n\n            if (callbackList) {\n              if (callback) {\n                ci = callbackList.length;\n\n                while (ci--) {\n                  if (callbackList[ci].func === callback) {\n                    var nativeHandler = callbackList.nativeHandler;\n                    var fakeName = callbackList.fakeName,\n                        capture = callbackList.capture;\n                    callbackList = callbackList.slice(0, ci).concat(callbackList.slice(ci + 1));\n                    callbackList.nativeHandler = nativeHandler;\n                    callbackList.fakeName = fakeName;\n                    callbackList.capture = capture;\n                    eventMap[name] = callbackList;\n                  }\n                }\n              }\n\n              if (!callback || callbackList.length === 0) {\n                delete eventMap[name];\n                removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n              }\n            }\n          }\n        } else {\n          each$1(eventMap, function (callbackList, name) {\n            removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n          });\n          eventMap = {};\n        }\n\n        for (name in eventMap) {\n          if (has(eventMap, name)) {\n            return this;\n          }\n        }\n\n        delete this.events[id];\n\n        try {\n          delete target[this.expando];\n        } catch (ex) {\n          target[this.expando] = null;\n        }\n      }\n\n      return this;\n    };\n\n    EventUtils.prototype.fire = function (target, name, args) {\n      var id;\n\n      if (!target || target.nodeType === 3 || target.nodeType === 8) {\n        return this;\n      }\n\n      var event = fix(null, args);\n      event.type = name;\n      event.target = target;\n\n      do {\n        id = target[this.expando];\n\n        if (id) {\n          this.executeHandlers(event, id);\n        }\n\n        target = target.parentNode || target.ownerDocument || target.defaultView || target.parentWindow;\n      } while (target && !event.isPropagationStopped());\n\n      return this;\n    };\n\n    EventUtils.prototype.clean = function (target) {\n      var i, children;\n\n      if (!target || target.nodeType === 3 || target.nodeType === 8) {\n        return this;\n      }\n\n      if (target[this.expando]) {\n        this.unbind(target);\n      }\n\n      if (!target.getElementsByTagName) {\n        target = target.document;\n      }\n\n      if (target && target.getElementsByTagName) {\n        this.unbind(target);\n        children = target.getElementsByTagName('*');\n        i = children.length;\n\n        while (i--) {\n          target = children[i];\n\n          if (target[this.expando]) {\n            this.unbind(target);\n          }\n        }\n      }\n\n      return this;\n    };\n\n    EventUtils.prototype.destroy = function () {\n      this.events = {};\n    };\n\n    EventUtils.prototype.cancel = function (e) {\n      if (e) {\n        e.preventDefault();\n        e.stopImmediatePropagation();\n      }\n\n      return false;\n    };\n\n    EventUtils.prototype.executeHandlers = function (evt, id) {\n      var container = this.events[id];\n      var callbackList = container && container[evt.type];\n\n      if (callbackList) {\n        for (var i = 0, l = callbackList.length; i < l; i++) {\n          var callback = callbackList[i];\n\n          if (callback && callback.func.call(callback.scope, evt) === false) {\n            evt.preventDefault();\n          }\n\n          if (evt.isImmediatePropagationStopped()) {\n            return;\n          }\n        }\n      }\n    };\n\n    EventUtils.Event = new EventUtils();\n    return EventUtils;\n  }();\n\n  var support,\n      Expr,\n      getText,\n      isXML,\n      tokenize,\n      compile,\n      select,\n      outermostContext,\n      sortInput,\n      hasDuplicate,\n      setDocument,\n      document$1,\n      docElem,\n      documentIsHTML,\n      rbuggyQSA,\n      rbuggyMatches,\n      matches,\n      contains$3,\n      expando = 'sizzle' + -new Date(),\n      preferredDoc = window.document,\n      dirruns = 0,\n      done = 0,\n      classCache = createCache(),\n      tokenCache = createCache(),\n      compilerCache = createCache(),\n      sortOrder = function (a, b) {\n    if (a === b) {\n      hasDuplicate = true;\n    }\n\n    return 0;\n  },\n      strundefined = typeof undefined,\n      MAX_NEGATIVE = 1 << 31,\n      hasOwn = {}.hasOwnProperty,\n      arr = [],\n      pop = arr.pop,\n      push_native = arr.push,\n      push = arr.push,\n      slice = arr.slice,\n      indexOf$2 = arr.indexOf || function (elem) {\n    var i = 0,\n        len = this.length;\n\n    for (; i < len; i++) {\n      if (this[i] === elem) {\n        return i;\n      }\n    }\n\n    return -1;\n  },\n      booleans = 'checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped',\n      whitespace = '[\\\\x20\\\\t\\\\r\\\\n\\\\f]',\n      identifier = '(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+',\n      attributes = '\\\\[' + whitespace + '*(' + identifier + ')(?:' + whitespace + '*([*^$|!~]?=)' + whitespace + '*(?:\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\"|(' + identifier + '))|)' + whitespace + '*\\\\]',\n      pseudos = ':(' + identifier + ')(?:\\\\((' + '(\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\")|' + '((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|' + attributes + ')*)|' + '.*' + ')\\\\)|)',\n      rtrim = new RegExp('^' + whitespace + '+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)' + whitespace + '+$', 'g'),\n      rcomma = new RegExp('^' + whitespace + '*,' + whitespace + '*'),\n      rcombinators = new RegExp('^' + whitespace + '*([>+~]|' + whitespace + ')' + whitespace + '*'),\n      rattributeQuotes = new RegExp('=' + whitespace + '*([^\\\\]\\'\"]*?)' + whitespace + '*\\\\]', 'g'),\n      rpseudo = new RegExp(pseudos),\n      ridentifier = new RegExp('^' + identifier + '$'),\n      matchExpr = {\n    ID: new RegExp('^#(' + identifier + ')'),\n    CLASS: new RegExp('^\\\\.(' + identifier + ')'),\n    TAG: new RegExp('^(' + identifier + '|[*])'),\n    ATTR: new RegExp('^' + attributes),\n    PSEUDO: new RegExp('^' + pseudos),\n    CHILD: new RegExp('^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(' + whitespace + '*(even|odd|(([+-]|)(\\\\d*)n|)' + whitespace + '*(?:([+-]|)' + whitespace + '*(\\\\d+)|))' + whitespace + '*\\\\)|)', 'i'),\n    bool: new RegExp('^(?:' + booleans + ')$', 'i'),\n    needsContext: new RegExp('^' + whitespace + '*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(' + whitespace + '*((?:-\\\\d)?\\\\d*)' + whitespace + '*\\\\)|)(?=[^-]|$)', 'i')\n  },\n      rinputs = /^(?:input|select|textarea|button)$/i,\n      rheader = /^h\\d$/i,\n      rnative = /^[^{]+\\{\\s*\\[native \\w/,\n      rquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,\n      rsibling = /[+~]/,\n      rescape = /'|\\\\/g,\n      runescape = new RegExp('\\\\\\\\([\\\\da-f]{1,6}' + whitespace + '?|(' + whitespace + ')|.)', 'ig'),\n      funescape = function (_, escaped, escapedWhitespace) {\n    var high = '0x' + escaped - 65536;\n    return high !== high || escapedWhitespace ? escaped : high < 0 ? String.fromCharCode(high + 65536) : String.fromCharCode(high >> 10 | 55296, high & 1023 | 56320);\n  };\n\n  try {\n    push.apply(arr = slice.call(preferredDoc.childNodes), preferredDoc.childNodes);\n    arr[preferredDoc.childNodes.length].nodeType;\n  } catch (e) {\n    push = {\n      apply: arr.length ? function (target, els) {\n        push_native.apply(target, slice.call(els));\n      } : function (target, els) {\n        var j = target.length,\n            i = 0;\n\n        while (target[j++] = els[i++]) {}\n\n        target.length = j - 1;\n      }\n    };\n  }\n\n  var Sizzle = function (selector, context, results, seed) {\n    var match, elem, m, nodeType, i, groups, old, nid, newContext, newSelector;\n\n    if ((context ? context.ownerDocument || context : preferredDoc) !== document$1) {\n      setDocument(context);\n    }\n\n    context = context || document$1;\n    results = results || [];\n\n    if (!selector || typeof selector !== 'string') {\n      return results;\n    }\n\n    if ((nodeType = context.nodeType) !== 1 && nodeType !== 9) {\n      return [];\n    }\n\n    if (documentIsHTML && !seed) {\n      if (match = rquickExpr.exec(selector)) {\n        if (m = match[1]) {\n          if (nodeType === 9) {\n            elem = context.getElementById(m);\n\n            if (elem && elem.parentNode) {\n              if (elem.id === m) {\n                results.push(elem);\n                return results;\n              }\n            } else {\n              return results;\n            }\n          } else {\n            if (context.ownerDocument && (elem = context.ownerDocument.getElementById(m)) && contains$3(context, elem) && elem.id === m) {\n              results.push(elem);\n              return results;\n            }\n          }\n        } else if (match[2]) {\n          push.apply(results, context.getElementsByTagName(selector));\n          return results;\n        } else if ((m = match[3]) && support.getElementsByClassName) {\n          push.apply(results, context.getElementsByClassName(m));\n          return results;\n        }\n      }\n\n      if (support.qsa && (!rbuggyQSA || !rbuggyQSA.test(selector))) {\n        nid = old = expando;\n        newContext = context;\n        newSelector = nodeType === 9 && selector;\n\n        if (nodeType === 1 && context.nodeName.toLowerCase() !== 'object') {\n          groups = tokenize(selector);\n\n          if (old = context.getAttribute('id')) {\n            nid = old.replace(rescape, '\\\\$&');\n          } else {\n            context.setAttribute('id', nid);\n          }\n\n          nid = '[id=\\'' + nid + '\\'] ';\n          i = groups.length;\n\n          while (i--) {\n            groups[i] = nid + toSelector(groups[i]);\n          }\n\n          newContext = rsibling.test(selector) && testContext(context.parentNode) || context;\n          newSelector = groups.join(',');\n        }\n\n        if (newSelector) {\n          try {\n            push.apply(results, newContext.querySelectorAll(newSelector));\n            return results;\n          } catch (qsaError) {} finally {\n            if (!old) {\n              context.removeAttribute('id');\n            }\n          }\n        }\n      }\n    }\n\n    return select(selector.replace(rtrim, '$1'), context, results, seed);\n  };\n\n  function createCache() {\n    var keys = [];\n\n    function cache(key, value) {\n      if (keys.push(key + ' ') > Expr.cacheLength) {\n        delete cache[keys.shift()];\n      }\n\n      return cache[key + ' '] = value;\n    }\n\n    return cache;\n  }\n\n  function markFunction(fn) {\n    fn[expando] = true;\n    return fn;\n  }\n\n  function siblingCheck(a, b) {\n    var cur = b && a,\n        diff = cur && a.nodeType === 1 && b.nodeType === 1 && (~b.sourceIndex || MAX_NEGATIVE) - (~a.sourceIndex || MAX_NEGATIVE);\n\n    if (diff) {\n      return diff;\n    }\n\n    if (cur) {\n      while (cur = cur.nextSibling) {\n        if (cur === b) {\n          return -1;\n        }\n      }\n    }\n\n    return a ? 1 : -1;\n  }\n\n  function createInputPseudo(type) {\n    return function (elem) {\n      var name = elem.nodeName.toLowerCase();\n      return name === 'input' && elem.type === type;\n    };\n  }\n\n  function createButtonPseudo(type) {\n    return function (elem) {\n      var name = elem.nodeName.toLowerCase();\n      return (name === 'input' || name === 'button') && elem.type === type;\n    };\n  }\n\n  function createPositionalPseudo(fn) {\n    return markFunction(function (argument) {\n      argument = +argument;\n      return markFunction(function (seed, matches) {\n        var j,\n            matchIndexes = fn([], seed.length, argument),\n            i = matchIndexes.length;\n\n        while (i--) {\n          if (seed[j = matchIndexes[i]]) {\n            seed[j] = !(matches[j] = seed[j]);\n          }\n        }\n      });\n    });\n  }\n\n  function testContext(context) {\n    return context && typeof context.getElementsByTagName !== strundefined && context;\n  }\n\n  support = Sizzle.support = {};\n\n  isXML = Sizzle.isXML = function (elem) {\n    var documentElement = elem && (elem.ownerDocument || elem).documentElement;\n    return documentElement ? documentElement.nodeName !== 'HTML' : false;\n  };\n\n  setDocument = Sizzle.setDocument = function (node) {\n    var hasCompare,\n        doc = node ? node.ownerDocument || node : preferredDoc,\n        parent = doc.defaultView;\n\n    function getTop(win) {\n      try {\n        return win.top;\n      } catch (ex) {}\n\n      return null;\n    }\n\n    if (doc === document$1 || doc.nodeType !== 9 || !doc.documentElement) {\n      return document$1;\n    }\n\n    document$1 = doc;\n    docElem = doc.documentElement;\n    documentIsHTML = !isXML(doc);\n\n    if (parent && parent !== getTop(parent)) {\n      if (parent.addEventListener) {\n        parent.addEventListener('unload', function () {\n          setDocument();\n        }, false);\n      } else if (parent.attachEvent) {\n        parent.attachEvent('onunload', function () {\n          setDocument();\n        });\n      }\n    }\n\n    support.attributes = true;\n    support.getElementsByTagName = true;\n    support.getElementsByClassName = rnative.test(doc.getElementsByClassName);\n    support.getById = true;\n\n    Expr.find.ID = function (id, context) {\n      if (typeof context.getElementById !== strundefined && documentIsHTML) {\n        var m = context.getElementById(id);\n        return m && m.parentNode ? [m] : [];\n      }\n    };\n\n    Expr.filter.ID = function (id) {\n      var attrId = id.replace(runescape, funescape);\n      return function (elem) {\n        return elem.getAttribute('id') === attrId;\n      };\n    };\n\n    Expr.find.TAG = support.getElementsByTagName ? function (tag, context) {\n      if (typeof context.getElementsByTagName !== strundefined) {\n        return context.getElementsByTagName(tag);\n      }\n    } : function (tag, context) {\n      var elem,\n          tmp = [],\n          i = 0,\n          results = context.getElementsByTagName(tag);\n\n      if (tag === '*') {\n        while (elem = results[i++]) {\n          if (elem.nodeType === 1) {\n            tmp.push(elem);\n          }\n        }\n\n        return tmp;\n      }\n\n      return results;\n    };\n\n    Expr.find.CLASS = support.getElementsByClassName && function (className, context) {\n      if (documentIsHTML) {\n        return context.getElementsByClassName(className);\n      }\n    };\n\n    rbuggyMatches = [];\n    rbuggyQSA = [];\n    support.disconnectedMatch = true;\n    rbuggyQSA = rbuggyQSA.length && new RegExp(rbuggyQSA.join('|'));\n    rbuggyMatches = rbuggyMatches.length && new RegExp(rbuggyMatches.join('|'));\n    hasCompare = rnative.test(docElem.compareDocumentPosition);\n    contains$3 = hasCompare || rnative.test(docElem.contains) ? function (a, b) {\n      var adown = a.nodeType === 9 ? a.documentElement : a,\n          bup = b && b.parentNode;\n      return a === bup || !!(bup && bup.nodeType === 1 && (adown.contains ? adown.contains(bup) : a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16));\n    } : function (a, b) {\n      if (b) {\n        while (b = b.parentNode) {\n          if (b === a) {\n            return true;\n          }\n        }\n      }\n\n      return false;\n    };\n    sortOrder = hasCompare ? function (a, b) {\n      if (a === b) {\n        hasDuplicate = true;\n        return 0;\n      }\n\n      var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;\n\n      if (compare) {\n        return compare;\n      }\n\n      compare = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : 1;\n\n      if (compare & 1 || !support.sortDetached && b.compareDocumentPosition(a) === compare) {\n        if (a === doc || a.ownerDocument === preferredDoc && contains$3(preferredDoc, a)) {\n          return -1;\n        }\n\n        if (b === doc || b.ownerDocument === preferredDoc && contains$3(preferredDoc, b)) {\n          return 1;\n        }\n\n        return sortInput ? indexOf$2.call(sortInput, a) - indexOf$2.call(sortInput, b) : 0;\n      }\n\n      return compare & 4 ? -1 : 1;\n    } : function (a, b) {\n      if (a === b) {\n        hasDuplicate = true;\n        return 0;\n      }\n\n      var cur,\n          i = 0,\n          aup = a.parentNode,\n          bup = b.parentNode,\n          ap = [a],\n          bp = [b];\n\n      if (!aup || !bup) {\n        return a === doc ? -1 : b === doc ? 1 : aup ? -1 : bup ? 1 : sortInput ? indexOf$2.call(sortInput, a) - indexOf$2.call(sortInput, b) : 0;\n      } else if (aup === bup) {\n        return siblingCheck(a, b);\n      }\n\n      cur = a;\n\n      while (cur = cur.parentNode) {\n        ap.unshift(cur);\n      }\n\n      cur = b;\n\n      while (cur = cur.parentNode) {\n        bp.unshift(cur);\n      }\n\n      while (ap[i] === bp[i]) {\n        i++;\n      }\n\n      return i ? siblingCheck(ap[i], bp[i]) : ap[i] === preferredDoc ? -1 : bp[i] === preferredDoc ? 1 : 0;\n    };\n    return doc;\n  };\n\n  Sizzle.matches = function (expr, elements) {\n    return Sizzle(expr, null, null, elements);\n  };\n\n  Sizzle.matchesSelector = function (elem, expr) {\n    if ((elem.ownerDocument || elem) !== document$1) {\n      setDocument(elem);\n    }\n\n    expr = expr.replace(rattributeQuotes, '=\\'$1\\']');\n\n    if (support.matchesSelector && documentIsHTML && (!rbuggyMatches || !rbuggyMatches.test(expr)) && (!rbuggyQSA || !rbuggyQSA.test(expr))) {\n      try {\n        var ret = matches.call(elem, expr);\n\n        if (ret || support.disconnectedMatch || elem.document && elem.document.nodeType !== 11) {\n          return ret;\n        }\n      } catch (e) {}\n    }\n\n    return Sizzle(expr, document$1, null, [elem]).length > 0;\n  };\n\n  Sizzle.contains = function (context, elem) {\n    if ((context.ownerDocument || context) !== document$1) {\n      setDocument(context);\n    }\n\n    return contains$3(context, elem);\n  };\n\n  Sizzle.attr = function (elem, name) {\n    if ((elem.ownerDocument || elem) !== document$1) {\n      setDocument(elem);\n    }\n\n    var fn = Expr.attrHandle[name.toLowerCase()],\n        val = fn && hasOwn.call(Expr.attrHandle, name.toLowerCase()) ? fn(elem, name, !documentIsHTML) : undefined;\n    return val !== undefined ? val : support.attributes || !documentIsHTML ? elem.getAttribute(name) : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null;\n  };\n\n  Sizzle.error = function (msg) {\n    throw new Error('Syntax error, unrecognized expression: ' + msg);\n  };\n\n  Sizzle.uniqueSort = function (results) {\n    var elem,\n        duplicates = [],\n        j = 0,\n        i = 0;\n    hasDuplicate = !support.detectDuplicates;\n    sortInput = !support.sortStable && results.slice(0);\n    results.sort(sortOrder);\n\n    if (hasDuplicate) {\n      while (elem = results[i++]) {\n        if (elem === results[i]) {\n          j = duplicates.push(i);\n        }\n      }\n\n      while (j--) {\n        results.splice(duplicates[j], 1);\n      }\n    }\n\n    sortInput = null;\n    return results;\n  };\n\n  getText = Sizzle.getText = function (elem) {\n    var node,\n        ret = '',\n        i = 0,\n        nodeType = elem.nodeType;\n\n    if (!nodeType) {\n      while (node = elem[i++]) {\n        ret += getText(node);\n      }\n    } else if (nodeType === 1 || nodeType === 9 || nodeType === 11) {\n      if (typeof elem.textContent === 'string') {\n        return elem.textContent;\n      } else {\n        for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\n          ret += getText(elem);\n        }\n      }\n    } else if (nodeType === 3 || nodeType === 4) {\n      return elem.nodeValue;\n    }\n\n    return ret;\n  };\n\n  Expr = Sizzle.selectors = {\n    cacheLength: 50,\n    createPseudo: markFunction,\n    match: matchExpr,\n    attrHandle: {},\n    find: {},\n    relative: {\n      '>': {\n        dir: 'parentNode',\n        first: true\n      },\n      ' ': {\n        dir: 'parentNode'\n      },\n      '+': {\n        dir: 'previousSibling',\n        first: true\n      },\n      '~': {\n        dir: 'previousSibling'\n      }\n    },\n    preFilter: {\n      ATTR: function (match) {\n        match[1] = match[1].replace(runescape, funescape);\n        match[3] = (match[3] || match[4] || match[5] || '').replace(runescape, funescape);\n\n        if (match[2] === '~=') {\n          match[3] = ' ' + match[3] + ' ';\n        }\n\n        return match.slice(0, 4);\n      },\n      CHILD: function (match) {\n        match[1] = match[1].toLowerCase();\n\n        if (match[1].slice(0, 3) === 'nth') {\n          if (!match[3]) {\n            Sizzle.error(match[0]);\n          }\n\n          match[4] = +(match[4] ? match[5] + (match[6] || 1) : 2 * (match[3] === 'even' || match[3] === 'odd'));\n          match[5] = +(match[7] + match[8] || match[3] === 'odd');\n        } else if (match[3]) {\n          Sizzle.error(match[0]);\n        }\n\n        return match;\n      },\n      PSEUDO: function (match) {\n        var excess,\n            unquoted = !match[6] && match[2];\n\n        if (matchExpr.CHILD.test(match[0])) {\n          return null;\n        }\n\n        if (match[3]) {\n          match[2] = match[4] || match[5] || '';\n        } else if (unquoted && rpseudo.test(unquoted) && (excess = tokenize(unquoted, true)) && (excess = unquoted.indexOf(')', unquoted.length - excess) - unquoted.length)) {\n          match[0] = match[0].slice(0, excess);\n          match[2] = unquoted.slice(0, excess);\n        }\n\n        return match.slice(0, 3);\n      }\n    },\n    filter: {\n      TAG: function (nodeNameSelector) {\n        var nodeName = nodeNameSelector.replace(runescape, funescape).toLowerCase();\n        return nodeNameSelector === '*' ? function () {\n          return true;\n        } : function (elem) {\n          return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\n        };\n      },\n      CLASS: function (className) {\n        var pattern = classCache[className + ' '];\n        return pattern || (pattern = new RegExp('(^|' + whitespace + ')' + className + '(' + whitespace + '|$)')) && classCache(className, function (elem) {\n          return pattern.test(typeof elem.className === 'string' && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute('class') || '');\n        });\n      },\n      ATTR: function (name, operator, check) {\n        return function (elem) {\n          var result = Sizzle.attr(elem, name);\n\n          if (result == null) {\n            return operator === '!=';\n          }\n\n          if (!operator) {\n            return true;\n          }\n\n          result += '';\n          return operator === '=' ? result === check : operator === '!=' ? result !== check : operator === '^=' ? check && result.indexOf(check) === 0 : operator === '*=' ? check && result.indexOf(check) > -1 : operator === '$=' ? check && result.slice(-check.length) === check : operator === '~=' ? (' ' + result + ' ').indexOf(check) > -1 : operator === '|=' ? result === check || result.slice(0, check.length + 1) === check + '-' : false;\n        };\n      },\n      CHILD: function (type, what, argument, first, last) {\n        var simple = type.slice(0, 3) !== 'nth',\n            forward = type.slice(-4) !== 'last',\n            ofType = what === 'of-type';\n        return first === 1 && last === 0 ? function (elem) {\n          return !!elem.parentNode;\n        } : function (elem, context, xml) {\n          var cache,\n              outerCache,\n              node,\n              diff,\n              nodeIndex,\n              start,\n              dir = simple !== forward ? 'nextSibling' : 'previousSibling',\n              parent = elem.parentNode,\n              name = ofType && elem.nodeName.toLowerCase(),\n              useCache = !xml && !ofType;\n\n          if (parent) {\n            if (simple) {\n              while (dir) {\n                node = elem;\n\n                while (node = node[dir]) {\n                  if (ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) {\n                    return false;\n                  }\n                }\n\n                start = dir = type === 'only' && !start && 'nextSibling';\n              }\n\n              return true;\n            }\n\n            start = [forward ? parent.firstChild : parent.lastChild];\n\n            if (forward && useCache) {\n              outerCache = parent[expando] || (parent[expando] = {});\n              cache = outerCache[type] || [];\n              nodeIndex = cache[0] === dirruns && cache[1];\n              diff = cache[0] === dirruns && cache[2];\n              node = nodeIndex && parent.childNodes[nodeIndex];\n\n              while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\n                if (node.nodeType === 1 && ++diff && node === elem) {\n                  outerCache[type] = [dirruns, nodeIndex, diff];\n                  break;\n                }\n              }\n            } else if (useCache && (cache = (elem[expando] || (elem[expando] = {}))[type]) && cache[0] === dirruns) {\n              diff = cache[1];\n            } else {\n              while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\n                if ((ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) && ++diff) {\n                  if (useCache) {\n                    (node[expando] || (node[expando] = {}))[type] = [dirruns, diff];\n                  }\n\n                  if (node === elem) {\n                    break;\n                  }\n                }\n              }\n            }\n\n            diff -= last;\n            return diff === first || diff % first === 0 && diff / first >= 0;\n          }\n        };\n      },\n      PSEUDO: function (pseudo, argument) {\n        var args,\n            fn = Expr.pseudos[pseudo] || Expr.setFilters[pseudo.toLowerCase()] || Sizzle.error('unsupported pseudo: ' + pseudo);\n\n        if (fn[expando]) {\n          return fn(argument);\n        }\n\n        if (fn.length > 1) {\n          args = [pseudo, pseudo, '', argument];\n          return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase()) ? markFunction(function (seed, matches) {\n            var idx,\n                matched = fn(seed, argument),\n                i = matched.length;\n\n            while (i--) {\n              idx = indexOf$2.call(seed, matched[i]);\n              seed[idx] = !(matches[idx] = matched[i]);\n            }\n          }) : function (elem) {\n            return fn(elem, 0, args);\n          };\n        }\n\n        return fn;\n      }\n    },\n    pseudos: {\n      not: markFunction(function (selector) {\n        var input = [],\n            results = [],\n            matcher = compile(selector.replace(rtrim, '$1'));\n        return matcher[expando] ? markFunction(function (seed, matches, context, xml) {\n          var elem,\n              unmatched = matcher(seed, null, xml, []),\n              i = seed.length;\n\n          while (i--) {\n            if (elem = unmatched[i]) {\n              seed[i] = !(matches[i] = elem);\n            }\n          }\n        }) : function (elem, context, xml) {\n          input[0] = elem;\n          matcher(input, null, xml, results);\n          return !results.pop();\n        };\n      }),\n      has: markFunction(function (selector) {\n        return function (elem) {\n          return Sizzle(selector, elem).length > 0;\n        };\n      }),\n      contains: markFunction(function (text) {\n        text = text.replace(runescape, funescape);\n        return function (elem) {\n          return (elem.textContent || elem.innerText || getText(elem)).indexOf(text) > -1;\n        };\n      }),\n      lang: markFunction(function (lang) {\n        if (!ridentifier.test(lang || '')) {\n          Sizzle.error('unsupported lang: ' + lang);\n        }\n\n        lang = lang.replace(runescape, funescape).toLowerCase();\n        return function (elem) {\n          var elemLang;\n\n          do {\n            if (elemLang = documentIsHTML ? elem.lang : elem.getAttribute('xml:lang') || elem.getAttribute('lang')) {\n              elemLang = elemLang.toLowerCase();\n              return elemLang === lang || elemLang.indexOf(lang + '-') === 0;\n            }\n          } while ((elem = elem.parentNode) && elem.nodeType === 1);\n\n          return false;\n        };\n      }),\n      target: function (elem) {\n        var hash = window.location && window.location.hash;\n        return hash && hash.slice(1) === elem.id;\n      },\n      root: function (elem) {\n        return elem === docElem;\n      },\n      focus: function (elem) {\n        return elem === document$1.activeElement && (!document$1.hasFocus || document$1.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);\n      },\n      enabled: function (elem) {\n        return elem.disabled === false;\n      },\n      disabled: function (elem) {\n        return elem.disabled === true;\n      },\n      checked: function (elem) {\n        var nodeName = elem.nodeName.toLowerCase();\n        return nodeName === 'input' && !!elem.checked || nodeName === 'option' && !!elem.selected;\n      },\n      selected: function (elem) {\n        if (elem.parentNode) {\n          elem.parentNode.selectedIndex;\n        }\n\n        return elem.selected === true;\n      },\n      empty: function (elem) {\n        for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\n          if (elem.nodeType < 6) {\n            return false;\n          }\n        }\n\n        return true;\n      },\n      parent: function (elem) {\n        return !Expr.pseudos.empty(elem);\n      },\n      header: function (elem) {\n        return rheader.test(elem.nodeName);\n      },\n      input: function (elem) {\n        return rinputs.test(elem.nodeName);\n      },\n      button: function (elem) {\n        var name = elem.nodeName.toLowerCase();\n        return name === 'input' && elem.type === 'button' || name === 'button';\n      },\n      text: function (elem) {\n        var attr;\n        return elem.nodeName.toLowerCase() === 'input' && elem.type === 'text' && ((attr = elem.getAttribute('type')) == null || attr.toLowerCase() === 'text');\n      },\n      first: createPositionalPseudo(function () {\n        return [0];\n      }),\n      last: createPositionalPseudo(function (matchIndexes, length) {\n        return [length - 1];\n      }),\n      eq: createPositionalPseudo(function (matchIndexes, length, argument) {\n        return [argument < 0 ? argument + length : argument];\n      }),\n      even: createPositionalPseudo(function (matchIndexes, length) {\n        var i = 0;\n\n        for (; i < length; i += 2) {\n          matchIndexes.push(i);\n        }\n\n        return matchIndexes;\n      }),\n      odd: createPositionalPseudo(function (matchIndexes, length) {\n        var i = 1;\n\n        for (; i < length; i += 2) {\n          matchIndexes.push(i);\n        }\n\n        return matchIndexes;\n      }),\n      lt: createPositionalPseudo(function (matchIndexes, length, argument) {\n        var i = argument < 0 ? argument + length : argument;\n\n        for (; --i >= 0;) {\n          matchIndexes.push(i);\n        }\n\n        return matchIndexes;\n      }),\n      gt: createPositionalPseudo(function (matchIndexes, length, argument) {\n        var i = argument < 0 ? argument + length : argument;\n\n        for (; ++i < length;) {\n          matchIndexes.push(i);\n        }\n\n        return matchIndexes;\n      })\n    }\n  };\n  Expr.pseudos.nth = Expr.pseudos.eq;\n  each(['radio', 'checkbox', 'file', 'password', 'image'], function (i) {\n    Expr.pseudos[i] = createInputPseudo(i);\n  });\n  each(['submit', 'reset'], function (i) {\n    Expr.pseudos[i] = createButtonPseudo(i);\n  });\n\n  function setFilters() {}\n\n  setFilters.prototype = Expr.filters = Expr.pseudos;\n  Expr.setFilters = new setFilters();\n\n  tokenize = Sizzle.tokenize = function (selector, parseOnly) {\n    var matched,\n        match,\n        tokens,\n        type,\n        soFar,\n        groups,\n        preFilters,\n        cached = tokenCache[selector + ' '];\n\n    if (cached) {\n      return parseOnly ? 0 : cached.slice(0);\n    }\n\n    soFar = selector;\n    groups = [];\n    preFilters = Expr.preFilter;\n\n    while (soFar) {\n      if (!matched || (match = rcomma.exec(soFar))) {\n        if (match) {\n          soFar = soFar.slice(match[0].length) || soFar;\n        }\n\n        groups.push(tokens = []);\n      }\n\n      matched = false;\n\n      if (match = rcombinators.exec(soFar)) {\n        matched = match.shift();\n        tokens.push({\n          value: matched,\n          type: match[0].replace(rtrim, ' ')\n        });\n        soFar = soFar.slice(matched.length);\n      }\n\n      for (type in Expr.filter) {\n        if (!Expr.filter.hasOwnProperty(type)) {\n          continue;\n        }\n\n        if ((match = matchExpr[type].exec(soFar)) && (!preFilters[type] || (match = preFilters[type](match)))) {\n          matched = match.shift();\n          tokens.push({\n            value: matched,\n            type: type,\n            matches: match\n          });\n          soFar = soFar.slice(matched.length);\n        }\n      }\n\n      if (!matched) {\n        break;\n      }\n    }\n\n    return parseOnly ? soFar.length : soFar ? Sizzle.error(selector) : tokenCache(selector, groups).slice(0);\n  };\n\n  function toSelector(tokens) {\n    var i = 0,\n        len = tokens.length,\n        selector = '';\n\n    for (; i < len; i++) {\n      selector += tokens[i].value;\n    }\n\n    return selector;\n  }\n\n  function addCombinator(matcher, combinator, base) {\n    var dir = combinator.dir,\n        checkNonElements = base && dir === 'parentNode',\n        doneName = done++;\n    return combinator.first ? function (elem, context, xml) {\n      while (elem = elem[dir]) {\n        if (elem.nodeType === 1 || checkNonElements) {\n          return matcher(elem, context, xml);\n        }\n      }\n    } : function (elem, context, xml) {\n      var oldCache,\n          outerCache,\n          newCache = [dirruns, doneName];\n\n      if (xml) {\n        while (elem = elem[dir]) {\n          if (elem.nodeType === 1 || checkNonElements) {\n            if (matcher(elem, context, xml)) {\n              return true;\n            }\n          }\n        }\n      } else {\n        while (elem = elem[dir]) {\n          if (elem.nodeType === 1 || checkNonElements) {\n            outerCache = elem[expando] || (elem[expando] = {});\n\n            if ((oldCache = outerCache[dir]) && oldCache[0] === dirruns && oldCache[1] === doneName) {\n              return newCache[2] = oldCache[2];\n            } else {\n              outerCache[dir] = newCache;\n\n              if (newCache[2] = matcher(elem, context, xml)) {\n                return true;\n              }\n            }\n          }\n        }\n      }\n    };\n  }\n\n  function elementMatcher(matchers) {\n    return matchers.length > 1 ? function (elem, context, xml) {\n      var i = matchers.length;\n\n      while (i--) {\n        if (!matchers[i](elem, context, xml)) {\n          return false;\n        }\n      }\n\n      return true;\n    } : matchers[0];\n  }\n\n  function multipleContexts(selector, contexts, results) {\n    var i = 0,\n        len = contexts.length;\n\n    for (; i < len; i++) {\n      Sizzle(selector, contexts[i], results);\n    }\n\n    return results;\n  }\n\n  function condense(unmatched, map, filter, context, xml) {\n    var elem,\n        newUnmatched = [],\n        i = 0,\n        len = unmatched.length,\n        mapped = map != null;\n\n    for (; i < len; i++) {\n      if (elem = unmatched[i]) {\n        if (!filter || filter(elem, context, xml)) {\n          newUnmatched.push(elem);\n\n          if (mapped) {\n            map.push(i);\n          }\n        }\n      }\n    }\n\n    return newUnmatched;\n  }\n\n  function setMatcher(preFilter, selector, matcher, postFilter, postFinder, postSelector) {\n    if (postFilter && !postFilter[expando]) {\n      postFilter = setMatcher(postFilter);\n    }\n\n    if (postFinder && !postFinder[expando]) {\n      postFinder = setMatcher(postFinder, postSelector);\n    }\n\n    return markFunction(function (seed, results, context, xml) {\n      var temp,\n          i,\n          elem,\n          preMap = [],\n          postMap = [],\n          preexisting = results.length,\n          elems = seed || multipleContexts(selector || '*', context.nodeType ? [context] : context, []),\n          matcherIn = preFilter && (seed || !selector) ? condense(elems, preMap, preFilter, context, xml) : elems,\n          matcherOut = matcher ? postFinder || (seed ? preFilter : preexisting || postFilter) ? [] : results : matcherIn;\n\n      if (matcher) {\n        matcher(matcherIn, matcherOut, context, xml);\n      }\n\n      if (postFilter) {\n        temp = condense(matcherOut, postMap);\n        postFilter(temp, [], context, xml);\n        i = temp.length;\n\n        while (i--) {\n          if (elem = temp[i]) {\n            matcherOut[postMap[i]] = !(matcherIn[postMap[i]] = elem);\n          }\n        }\n      }\n\n      if (seed) {\n        if (postFinder || preFilter) {\n          if (postFinder) {\n            temp = [];\n            i = matcherOut.length;\n\n            while (i--) {\n              if (elem = matcherOut[i]) {\n                temp.push(matcherIn[i] = elem);\n              }\n            }\n\n            postFinder(null, matcherOut = [], temp, xml);\n          }\n\n          i = matcherOut.length;\n\n          while (i--) {\n            if ((elem = matcherOut[i]) && (temp = postFinder ? indexOf$2.call(seed, elem) : preMap[i]) > -1) {\n              seed[temp] = !(results[temp] = elem);\n            }\n          }\n        }\n      } else {\n        matcherOut = condense(matcherOut === results ? matcherOut.splice(preexisting, matcherOut.length) : matcherOut);\n\n        if (postFinder) {\n          postFinder(null, results, matcherOut, xml);\n        } else {\n          push.apply(results, matcherOut);\n        }\n      }\n    });\n  }\n\n  function matcherFromTokens(tokens) {\n    var checkContext,\n        matcher,\n        j,\n        len = tokens.length,\n        leadingRelative = Expr.relative[tokens[0].type],\n        implicitRelative = leadingRelative || Expr.relative[' '],\n        i = leadingRelative ? 1 : 0,\n        matchContext = addCombinator(function (elem) {\n      return elem === checkContext;\n    }, implicitRelative, true),\n        matchAnyContext = addCombinator(function (elem) {\n      return indexOf$2.call(checkContext, elem) > -1;\n    }, implicitRelative, true),\n        matchers = [function (elem, context, xml) {\n      return !leadingRelative && (xml || context !== outermostContext) || ((checkContext = context).nodeType ? matchContext(elem, context, xml) : matchAnyContext(elem, context, xml));\n    }];\n\n    for (; i < len; i++) {\n      if (matcher = Expr.relative[tokens[i].type]) {\n        matchers = [addCombinator(elementMatcher(matchers), matcher)];\n      } else {\n        matcher = Expr.filter[tokens[i].type].apply(null, tokens[i].matches);\n\n        if (matcher[expando]) {\n          j = ++i;\n\n          for (; j < len; j++) {\n            if (Expr.relative[tokens[j].type]) {\n              break;\n            }\n          }\n\n          return setMatcher(i > 1 && elementMatcher(matchers), i > 1 && toSelector(tokens.slice(0, i - 1).concat({\n            value: tokens[i - 2].type === ' ' ? '*' : ''\n          })).replace(rtrim, '$1'), matcher, i < j && matcherFromTokens(tokens.slice(i, j)), j < len && matcherFromTokens(tokens = tokens.slice(j)), j < len && toSelector(tokens));\n        }\n\n        matchers.push(matcher);\n      }\n    }\n\n    return elementMatcher(matchers);\n  }\n\n  function matcherFromGroupMatchers(elementMatchers, setMatchers) {\n    var bySet = setMatchers.length > 0,\n        byElement = elementMatchers.length > 0,\n        superMatcher = function (seed, context, xml, results, outermost) {\n      var elem,\n          j,\n          matcher,\n          matchedCount = 0,\n          i = '0',\n          unmatched = seed && [],\n          setMatched = [],\n          contextBackup = outermostContext,\n          elems = seed || byElement && Expr.find.TAG('*', outermost),\n          dirrunsUnique = dirruns += contextBackup == null ? 1 : Math.random() || 0.1,\n          len = elems.length;\n\n      if (outermost) {\n        outermostContext = context !== document$1 && context;\n      }\n\n      for (; i !== len && (elem = elems[i]) != null; i++) {\n        if (byElement && elem) {\n          j = 0;\n\n          while (matcher = elementMatchers[j++]) {\n            if (matcher(elem, context, xml)) {\n              results.push(elem);\n              break;\n            }\n          }\n\n          if (outermost) {\n            dirruns = dirrunsUnique;\n          }\n        }\n\n        if (bySet) {\n          if (elem = !matcher && elem) {\n            matchedCount--;\n          }\n\n          if (seed) {\n            unmatched.push(elem);\n          }\n        }\n      }\n\n      matchedCount += i;\n\n      if (bySet && i !== matchedCount) {\n        j = 0;\n\n        while (matcher = setMatchers[j++]) {\n          matcher(unmatched, setMatched, context, xml);\n        }\n\n        if (seed) {\n          if (matchedCount > 0) {\n            while (i--) {\n              if (!(unmatched[i] || setMatched[i])) {\n                setMatched[i] = pop.call(results);\n              }\n            }\n          }\n\n          setMatched = condense(setMatched);\n        }\n\n        push.apply(results, setMatched);\n\n        if (outermost && !seed && setMatched.length > 0 && matchedCount + setMatchers.length > 1) {\n          Sizzle.uniqueSort(results);\n        }\n      }\n\n      if (outermost) {\n        dirruns = dirrunsUnique;\n        outermostContext = contextBackup;\n      }\n\n      return unmatched;\n    };\n\n    return bySet ? markFunction(superMatcher) : superMatcher;\n  }\n\n  compile = Sizzle.compile = function (selector, match) {\n    var i,\n        setMatchers = [],\n        elementMatchers = [],\n        cached = compilerCache[selector + ' '];\n\n    if (!cached) {\n      if (!match) {\n        match = tokenize(selector);\n      }\n\n      i = match.length;\n\n      while (i--) {\n        cached = matcherFromTokens(match[i]);\n\n        if (cached[expando]) {\n          setMatchers.push(cached);\n        } else {\n          elementMatchers.push(cached);\n        }\n      }\n\n      cached = compilerCache(selector, matcherFromGroupMatchers(elementMatchers, setMatchers));\n      cached.selector = selector;\n    }\n\n    return cached;\n  };\n\n  select = Sizzle.select = function (selector, context, results, seed) {\n    var i,\n        tokens,\n        token,\n        type,\n        find,\n        compiled = typeof selector === 'function' && selector,\n        match = !seed && tokenize(selector = compiled.selector || selector);\n    results = results || [];\n\n    if (match.length === 1) {\n      tokens = match[0] = match[0].slice(0);\n\n      if (tokens.length > 2 && (token = tokens[0]).type === 'ID' && support.getById && context.nodeType === 9 && documentIsHTML && Expr.relative[tokens[1].type]) {\n        context = (Expr.find.ID(token.matches[0].replace(runescape, funescape), context) || [])[0];\n\n        if (!context) {\n          return results;\n        } else if (compiled) {\n          context = context.parentNode;\n        }\n\n        selector = selector.slice(tokens.shift().value.length);\n      }\n\n      i = matchExpr.needsContext.test(selector) ? 0 : tokens.length;\n\n      while (i--) {\n        token = tokens[i];\n\n        if (Expr.relative[type = token.type]) {\n          break;\n        }\n\n        if (find = Expr.find[type]) {\n          if (seed = find(token.matches[0].replace(runescape, funescape), rsibling.test(tokens[0].type) && testContext(context.parentNode) || context)) {\n            tokens.splice(i, 1);\n            selector = seed.length && toSelector(tokens);\n\n            if (!selector) {\n              push.apply(results, seed);\n              return results;\n            }\n\n            break;\n          }\n        }\n      }\n    }\n\n    (compiled || compile(selector, match))(seed, context, !documentIsHTML, results, rsibling.test(selector) && testContext(context.parentNode) || context);\n    return results;\n  };\n\n  support.sortStable = expando.split('').sort(sortOrder).join('') === expando;\n  support.detectDuplicates = !!hasDuplicate;\n  setDocument();\n  support.sortDetached = true;\n  var doc = document,\n      push$1 = Array.prototype.push,\n      slice$1 = Array.prototype.slice;\n  var rquickExpr$1 = /^(?:[^#<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]*)$)/;\n  var Event = EventUtils.Event;\n  var skipUniques = Tools.makeMap('children,contents,next,prev');\n\n  var isDefined = function (obj) {\n    return typeof obj !== 'undefined';\n  };\n\n  var isString$1 = function (obj) {\n    return typeof obj === 'string';\n  };\n\n  var isWindow = function (obj) {\n    return obj && obj === obj.window;\n  };\n\n  var createFragment = function (html, fragDoc) {\n    fragDoc = fragDoc || doc;\n    var container = fragDoc.createElement('div');\n    var frag = fragDoc.createDocumentFragment();\n    container.innerHTML = html;\n    var node;\n\n    while (node = container.firstChild) {\n      frag.appendChild(node);\n    }\n\n    return frag;\n  };\n\n  var domManipulate = function (targetNodes, sourceItem, callback, reverse) {\n    var i;\n\n    if (isString$1(sourceItem)) {\n      sourceItem = createFragment(sourceItem, getElementDocument(targetNodes[0]));\n    } else if (sourceItem.length && !sourceItem.nodeType) {\n      sourceItem = DomQuery.makeArray(sourceItem);\n\n      if (reverse) {\n        for (i = sourceItem.length - 1; i >= 0; i--) {\n          domManipulate(targetNodes, sourceItem[i], callback, reverse);\n        }\n      } else {\n        for (i = 0; i < sourceItem.length; i++) {\n          domManipulate(targetNodes, sourceItem[i], callback, reverse);\n        }\n      }\n\n      return targetNodes;\n    }\n\n    if (sourceItem.nodeType) {\n      i = targetNodes.length;\n\n      while (i--) {\n        callback.call(targetNodes[i], sourceItem);\n      }\n    }\n\n    return targetNodes;\n  };\n\n  var hasClass = function (node, className) {\n    return node && className && (' ' + node.className + ' ').indexOf(' ' + className + ' ') !== -1;\n  };\n\n  var wrap$1 = function (elements, wrapper, all) {\n    var lastParent, newWrapper;\n    wrapper = DomQuery(wrapper)[0];\n    elements.each(function () {\n      var self = this;\n\n      if (!all || lastParent !== self.parentNode) {\n        lastParent = self.parentNode;\n        newWrapper = wrapper.cloneNode(false);\n        self.parentNode.insertBefore(newWrapper, self);\n        newWrapper.appendChild(self);\n      } else {\n        newWrapper.appendChild(self);\n      }\n    });\n    return elements;\n  };\n\n  var numericCssMap = Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom', ' ');\n  var booleanMap = Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected', ' ');\n  var propFix = {\n    for: 'htmlFor',\n    class: 'className',\n    readonly: 'readOnly'\n  };\n  var cssFix = {\n    float: 'cssFloat'\n  };\n  var attrHooks = {},\n      cssHooks = {};\n\n  var DomQueryConstructor = function (selector, context) {\n    return new DomQuery.fn.init(selector, context);\n  };\n\n  var inArray$1 = function (item, array) {\n    var i;\n\n    if (array.indexOf) {\n      return array.indexOf(item);\n    }\n\n    i = array.length;\n\n    while (i--) {\n      if (array[i] === item) {\n        return i;\n      }\n    }\n\n    return -1;\n  };\n\n  var whiteSpaceRegExp$2 = /^\\s*|\\s*$/g;\n\n  var trim$3 = function (str) {\n    return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp$2, '');\n  };\n\n  var each$4 = function (obj, callback) {\n    var length, key, i, value;\n\n    if (obj) {\n      length = obj.length;\n\n      if (length === undefined) {\n        for (key in obj) {\n          if (obj.hasOwnProperty(key)) {\n            value = obj[key];\n\n            if (callback.call(value, key, value) === false) {\n              break;\n            }\n          }\n        }\n      } else {\n        for (i = 0; i < length; i++) {\n          value = obj[i];\n\n          if (callback.call(value, i, value) === false) {\n            break;\n          }\n        }\n      }\n    }\n\n    return obj;\n  };\n\n  var grep = function (array, callback) {\n    var out = [];\n    each$4(array, function (i, item) {\n      if (callback(item, i)) {\n        out.push(item);\n      }\n    });\n    return out;\n  };\n\n  var getElementDocument = function (element) {\n    if (!element) {\n      return doc;\n    }\n\n    if (element.nodeType === 9) {\n      return element;\n    }\n\n    return element.ownerDocument;\n  };\n\n  DomQueryConstructor.fn = DomQueryConstructor.prototype = {\n    constructor: DomQueryConstructor,\n    selector: '',\n    context: null,\n    length: 0,\n    init: function (selector, context) {\n      var self = this;\n      var match, node;\n\n      if (!selector) {\n        return self;\n      }\n\n      if (selector.nodeType) {\n        self.context = self[0] = selector;\n        self.length = 1;\n        return self;\n      }\n\n      if (context && context.nodeType) {\n        self.context = context;\n      } else {\n        if (context) {\n          return DomQuery(selector).attr(context);\n        }\n\n        self.context = context = document;\n      }\n\n      if (isString$1(selector)) {\n        self.selector = selector;\n\n        if (selector.charAt(0) === '<' && selector.charAt(selector.length - 1) === '>' && selector.length >= 3) {\n          match = [null, selector, null];\n        } else {\n          match = rquickExpr$1.exec(selector);\n        }\n\n        if (match) {\n          if (match[1]) {\n            node = createFragment(selector, getElementDocument(context)).firstChild;\n\n            while (node) {\n              push$1.call(self, node);\n              node = node.nextSibling;\n            }\n          } else {\n            node = getElementDocument(context).getElementById(match[2]);\n\n            if (!node) {\n              return self;\n            }\n\n            if (node.id !== match[2]) {\n              return self.find(selector);\n            }\n\n            self.length = 1;\n            self[0] = node;\n          }\n        } else {\n          return DomQuery(context).find(selector);\n        }\n      } else {\n        this.add(selector, false);\n      }\n\n      return self;\n    },\n    toArray: function () {\n      return Tools.toArray(this);\n    },\n    add: function (items, sort) {\n      var self = this;\n      var nodes, i;\n\n      if (isString$1(items)) {\n        return self.add(DomQuery(items));\n      }\n\n      if (sort !== false) {\n        nodes = DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));\n        self.length = nodes.length;\n\n        for (i = 0; i < nodes.length; i++) {\n          self[i] = nodes[i];\n        }\n      } else {\n        push$1.apply(self, DomQuery.makeArray(items));\n      }\n\n      return self;\n    },\n    attr: function (name, value) {\n      var self = this;\n      var hook;\n\n      if (typeof name === 'object') {\n        each$4(name, function (name, value) {\n          self.attr(name, value);\n        });\n      } else if (isDefined(value)) {\n        this.each(function () {\n          var hook;\n\n          if (this.nodeType === 1) {\n            hook = attrHooks[name];\n\n            if (hook && hook.set) {\n              hook.set(this, value);\n              return;\n            }\n\n            if (value === null) {\n              this.removeAttribute(name, 2);\n            } else {\n              this.setAttribute(name, value, 2);\n            }\n          }\n        });\n      } else {\n        if (self[0] && self[0].nodeType === 1) {\n          hook = attrHooks[name];\n\n          if (hook && hook.get) {\n            return hook.get(self[0], name);\n          }\n\n          if (booleanMap[name]) {\n            return self.prop(name) ? name : undefined;\n          }\n\n          value = self[0].getAttribute(name, 2);\n\n          if (value === null) {\n            value = undefined;\n          }\n        }\n\n        return value;\n      }\n\n      return self;\n    },\n    removeAttr: function (name) {\n      return this.attr(name, null);\n    },\n    prop: function (name, value) {\n      var self = this;\n      name = propFix[name] || name;\n\n      if (typeof name === 'object') {\n        each$4(name, function (name, value) {\n          self.prop(name, value);\n        });\n      } else if (isDefined(value)) {\n        this.each(function () {\n          if (this.nodeType === 1) {\n            this[name] = value;\n          }\n        });\n      } else {\n        if (self[0] && self[0].nodeType && name in self[0]) {\n          return self[0][name];\n        }\n\n        return value;\n      }\n\n      return self;\n    },\n    css: function (name, value) {\n      var self = this;\n      var elm, hook;\n\n      var camel = function (name) {\n        return name.replace(/-(\\D)/g, function (a, b) {\n          return b.toUpperCase();\n        });\n      };\n\n      var dashed = function (name) {\n        return name.replace(/[A-Z]/g, function (a) {\n          return '-' + a;\n        });\n      };\n\n      if (typeof name === 'object') {\n        each$4(name, function (name, value) {\n          self.css(name, value);\n        });\n      } else {\n        if (isDefined(value)) {\n          name = camel(name);\n\n          if (typeof value === 'number' && !numericCssMap[name]) {\n            value = value.toString() + 'px';\n          }\n\n          self.each(function () {\n            var style = this.style;\n            hook = cssHooks[name];\n\n            if (hook && hook.set) {\n              hook.set(this, value);\n              return;\n            }\n\n            try {\n              this.style[cssFix[name] || name] = value;\n            } catch (ex) {}\n\n            if (value === null || value === '') {\n              if (style.removeProperty) {\n                style.removeProperty(dashed(name));\n              } else {\n                style.removeAttribute(name);\n              }\n            }\n          });\n        } else {\n          elm = self[0];\n          hook = cssHooks[name];\n\n          if (hook && hook.get) {\n            return hook.get(elm);\n          }\n\n          if (elm.ownerDocument.defaultView) {\n            try {\n              return elm.ownerDocument.defaultView.getComputedStyle(elm, null).getPropertyValue(dashed(name));\n            } catch (ex) {\n              return undefined;\n            }\n          } else if (elm.currentStyle) {\n            return elm.currentStyle[camel(name)];\n          } else {\n            return '';\n          }\n        }\n      }\n\n      return self;\n    },\n    remove: function () {\n      var self = this;\n      var node,\n          i = this.length;\n\n      while (i--) {\n        node = self[i];\n        Event.clean(node);\n\n        if (node.parentNode) {\n          node.parentNode.removeChild(node);\n        }\n      }\n\n      return this;\n    },\n    empty: function () {\n      var self = this;\n      var node,\n          i = this.length;\n\n      while (i--) {\n        node = self[i];\n\n        while (node.firstChild) {\n          node.removeChild(node.firstChild);\n        }\n      }\n\n      return this;\n    },\n    html: function (value) {\n      var self = this;\n      var i;\n\n      if (isDefined(value)) {\n        i = self.length;\n\n        try {\n          while (i--) {\n            self[i].innerHTML = value;\n          }\n        } catch (ex) {\n          DomQuery(self[i]).empty().append(value);\n        }\n\n        return self;\n      }\n\n      return self[0] ? self[0].innerHTML : '';\n    },\n    text: function (value) {\n      var self = this;\n      var i;\n\n      if (isDefined(value)) {\n        i = self.length;\n\n        while (i--) {\n          if ('innerText' in self[i]) {\n            self[i].innerText = value;\n          } else {\n            self[0].textContent = value;\n          }\n        }\n\n        return self;\n      }\n\n      return self[0] ? self[0].innerText || self[0].textContent : '';\n    },\n    append: function () {\n      return domManipulate(this, arguments, function (node) {\n        if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\n          this.appendChild(node);\n        }\n      });\n    },\n    prepend: function () {\n      return domManipulate(this, arguments, function (node) {\n        if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\n          this.insertBefore(node, this.firstChild);\n        }\n      }, true);\n    },\n    before: function () {\n      var self = this;\n\n      if (self[0] && self[0].parentNode) {\n        return domManipulate(self, arguments, function (node) {\n          this.parentNode.insertBefore(node, this);\n        });\n      }\n\n      return self;\n    },\n    after: function () {\n      var self = this;\n\n      if (self[0] && self[0].parentNode) {\n        return domManipulate(self, arguments, function (node) {\n          this.parentNode.insertBefore(node, this.nextSibling);\n        }, true);\n      }\n\n      return self;\n    },\n    appendTo: function (val) {\n      DomQuery(val).append(this);\n      return this;\n    },\n    prependTo: function (val) {\n      DomQuery(val).prepend(this);\n      return this;\n    },\n    replaceWith: function (content) {\n      return this.before(content).remove();\n    },\n    wrap: function (content) {\n      return wrap$1(this, content);\n    },\n    wrapAll: function (content) {\n      return wrap$1(this, content, true);\n    },\n    wrapInner: function (content) {\n      this.each(function () {\n        DomQuery(this).contents().wrapAll(content);\n      });\n      return this;\n    },\n    unwrap: function () {\n      return this.parent().each(function () {\n        DomQuery(this).replaceWith(this.childNodes);\n      });\n    },\n    clone: function () {\n      var result = [];\n      this.each(function () {\n        result.push(this.cloneNode(true));\n      });\n      return DomQuery(result);\n    },\n    addClass: function (className) {\n      return this.toggleClass(className, true);\n    },\n    removeClass: function (className) {\n      return this.toggleClass(className, false);\n    },\n    toggleClass: function (className, state) {\n      var self = this;\n\n      if (typeof className !== 'string') {\n        return self;\n      }\n\n      if (className.indexOf(' ') !== -1) {\n        each$4(className.split(' '), function () {\n          self.toggleClass(this, state);\n        });\n      } else {\n        self.each(function (index, node) {\n          var classState = hasClass(node, className);\n\n          if (classState !== state) {\n            var existingClassName = node.className;\n\n            if (classState) {\n              node.className = trim$3((' ' + existingClassName + ' ').replace(' ' + className + ' ', ' '));\n            } else {\n              node.className += existingClassName ? ' ' + className : className;\n            }\n          }\n        });\n      }\n\n      return self;\n    },\n    hasClass: function (className) {\n      return hasClass(this[0], className);\n    },\n    each: function (callback) {\n      return each$4(this, callback);\n    },\n    on: function (name, callback) {\n      return this.each(function () {\n        Event.bind(this, name, callback);\n      });\n    },\n    off: function (name, callback) {\n      return this.each(function () {\n        Event.unbind(this, name, callback);\n      });\n    },\n    trigger: function (name) {\n      return this.each(function () {\n        if (typeof name === 'object') {\n          Event.fire(this, name.type, name);\n        } else {\n          Event.fire(this, name);\n        }\n      });\n    },\n    show: function () {\n      return this.css('display', '');\n    },\n    hide: function () {\n      return this.css('display', 'none');\n    },\n    slice: function () {\n      return new DomQuery(slice$1.apply(this, arguments));\n    },\n    eq: function (index) {\n      return index === -1 ? this.slice(index) : this.slice(index, +index + 1);\n    },\n    first: function () {\n      return this.eq(0);\n    },\n    last: function () {\n      return this.eq(-1);\n    },\n    find: function (selector) {\n      var i, l;\n      var ret = [];\n\n      for (i = 0, l = this.length; i < l; i++) {\n        DomQuery.find(selector, this[i], ret);\n      }\n\n      return DomQuery(ret);\n    },\n    filter: function (selector) {\n      if (typeof selector === 'function') {\n        return DomQuery(grep(this.toArray(), function (item, i) {\n          return selector(i, item);\n        }));\n      }\n\n      return DomQuery(DomQuery.filter(selector, this.toArray()));\n    },\n    closest: function (selector) {\n      var result = [];\n\n      if (selector instanceof DomQuery) {\n        selector = selector[0];\n      }\n\n      this.each(function (i, node) {\n        while (node) {\n          if (typeof selector === 'string' && DomQuery(node).is(selector)) {\n            result.push(node);\n            break;\n          } else if (node === selector) {\n            result.push(node);\n            break;\n          }\n\n          node = node.parentNode;\n        }\n      });\n      return DomQuery(result);\n    },\n    offset: function (offset) {\n      var elm, doc, docElm;\n      var x = 0,\n          y = 0,\n          pos;\n\n      if (!offset) {\n        elm = this[0];\n\n        if (elm) {\n          doc = elm.ownerDocument;\n          docElm = doc.documentElement;\n\n          if (elm.getBoundingClientRect) {\n            pos = elm.getBoundingClientRect();\n            x = pos.left + (docElm.scrollLeft || doc.body.scrollLeft) - docElm.clientLeft;\n            y = pos.top + (docElm.scrollTop || doc.body.scrollTop) - docElm.clientTop;\n          }\n        }\n\n        return {\n          left: x,\n          top: y\n        };\n      }\n\n      return this.css(offset);\n    },\n    push: push$1,\n    sort: Array.prototype.sort,\n    splice: Array.prototype.splice\n  };\n  Tools.extend(DomQueryConstructor, {\n    extend: Tools.extend,\n    makeArray: function (object) {\n      if (isWindow(object) || object.nodeType) {\n        return [object];\n      }\n\n      return Tools.toArray(object);\n    },\n    inArray: inArray$1,\n    isArray: Tools.isArray,\n    each: each$4,\n    trim: trim$3,\n    grep: grep,\n    find: Sizzle,\n    expr: Sizzle.selectors,\n    unique: Sizzle.uniqueSort,\n    text: Sizzle.getText,\n    contains: Sizzle.contains,\n    filter: function (expr, elems, not) {\n      var i = elems.length;\n\n      if (not) {\n        expr = ':not(' + expr + ')';\n      }\n\n      while (i--) {\n        if (elems[i].nodeType !== 1) {\n          elems.splice(i, 1);\n        }\n      }\n\n      if (elems.length === 1) {\n        elems = DomQuery.find.matchesSelector(elems[0], expr) ? [elems[0]] : [];\n      } else {\n        elems = DomQuery.find.matches(expr, elems);\n      }\n\n      return elems;\n    }\n  });\n\n  var dir = function (el, prop, until) {\n    var matched = [];\n    var cur = el[prop];\n\n    if (typeof until !== 'string' && until instanceof DomQuery) {\n      until = until[0];\n    }\n\n    while (cur && cur.nodeType !== 9) {\n      if (until !== undefined) {\n        if (cur === until) {\n          break;\n        }\n\n        if (typeof until === 'string' && DomQuery(cur).is(until)) {\n          break;\n        }\n      }\n\n      if (cur.nodeType === 1) {\n        matched.push(cur);\n      }\n\n      cur = cur[prop];\n    }\n\n    return matched;\n  };\n\n  var sibling$1 = function (node, siblingName, nodeType, until) {\n    var result = [];\n\n    if (until instanceof DomQuery) {\n      until = until[0];\n    }\n\n    for (; node; node = node[siblingName]) {\n      if (nodeType && node.nodeType !== nodeType) {\n        continue;\n      }\n\n      if (until !== undefined) {\n        if (node === until) {\n          break;\n        }\n\n        if (typeof until === 'string' && DomQuery(node).is(until)) {\n          break;\n        }\n      }\n\n      result.push(node);\n    }\n\n    return result;\n  };\n\n  var firstSibling = function (node, siblingName, nodeType) {\n    for (node = node[siblingName]; node; node = node[siblingName]) {\n      if (node.nodeType === nodeType) {\n        return node;\n      }\n    }\n\n    return null;\n  };\n\n  each$4({\n    parent: function (node) {\n      var parent = node.parentNode;\n      return parent && parent.nodeType !== 11 ? parent : null;\n    },\n    parents: function (node) {\n      return dir(node, 'parentNode');\n    },\n    next: function (node) {\n      return firstSibling(node, 'nextSibling', 1);\n    },\n    prev: function (node) {\n      return firstSibling(node, 'previousSibling', 1);\n    },\n    children: function (node) {\n      return sibling$1(node.firstChild, 'nextSibling', 1);\n    },\n    contents: function (node) {\n      return Tools.toArray((node.nodeName === 'iframe' ? node.contentDocument || node.contentWindow.document : node).childNodes);\n    }\n  }, function (name, fn) {\n    DomQueryConstructor.fn[name] = function (selector) {\n      var self = this;\n      var result = [];\n      self.each(function () {\n        var nodes = fn.call(result, this, selector, result);\n\n        if (nodes) {\n          if (DomQuery.isArray(nodes)) {\n            result.push.apply(result, nodes);\n          } else {\n            result.push(nodes);\n          }\n        }\n      });\n\n      if (this.length > 1) {\n        if (!skipUniques[name]) {\n          result = DomQuery.unique(result);\n        }\n\n        if (name.indexOf('parents') === 0) {\n          result = result.reverse();\n        }\n      }\n\n      var wrappedResult = DomQuery(result);\n\n      if (selector) {\n        return wrappedResult.filter(selector);\n      }\n\n      return wrappedResult;\n    };\n  });\n  each$4({\n    parentsUntil: function (node, until) {\n      return dir(node, 'parentNode', until);\n    },\n    nextUntil: function (node, until) {\n      return sibling$1(node, 'nextSibling', 1, until).slice(1);\n    },\n    prevUntil: function (node, until) {\n      return sibling$1(node, 'previousSibling', 1, until).slice(1);\n    }\n  }, function (name, fn) {\n    DomQueryConstructor.fn[name] = function (selector, filter) {\n      var self = this;\n      var result = [];\n      self.each(function () {\n        var nodes = fn.call(result, this, selector, result);\n\n        if (nodes) {\n          if (DomQuery.isArray(nodes)) {\n            result.push.apply(result, nodes);\n          } else {\n            result.push(nodes);\n          }\n        }\n      });\n\n      if (this.length > 1) {\n        result = DomQuery.unique(result);\n\n        if (name.indexOf('parents') === 0 || name === 'prevUntil') {\n          result = result.reverse();\n        }\n      }\n\n      var wrappedResult = DomQuery(result);\n\n      if (filter) {\n        return wrappedResult.filter(filter);\n      }\n\n      return wrappedResult;\n    };\n  });\n\n  DomQueryConstructor.fn.is = function (selector) {\n    return !!selector && this.filter(selector).length > 0;\n  };\n\n  DomQueryConstructor.fn.init.prototype = DomQueryConstructor.fn;\n\n  DomQueryConstructor.overrideDefaults = function (callback) {\n    var defaults;\n\n    var sub = function (selector, context) {\n      defaults = defaults || callback();\n\n      if (arguments.length === 0) {\n        selector = defaults.element;\n      }\n\n      if (!context) {\n        context = defaults.context;\n      }\n\n      return new sub.fn.init(selector, context);\n    };\n\n    DomQuery.extend(sub, this);\n    return sub;\n  };\n\n  DomQueryConstructor.attrHooks = attrHooks;\n  DomQueryConstructor.cssHooks = cssHooks;\n  var DomQuery = DomQueryConstructor;\n  var each$5 = Tools.each;\n  var grep$1 = Tools.grep;\n  var isIE = Env.ie;\n  var simpleSelectorRe = /^([a-z0-9],?)+$/i;\n\n  var setupAttrHooks = function (styles, settings, getContext) {\n    var keepValues = settings.keep_values;\n    var keepUrlHook = {\n      set: function ($elm, value, name) {\n        if (settings.url_converter) {\n          value = settings.url_converter.call(settings.url_converter_scope || getContext(), value, name, $elm[0]);\n        }\n\n        $elm.attr('data-mce-' + name, value).attr(name, value);\n      },\n      get: function ($elm, name) {\n        return $elm.attr('data-mce-' + name) || $elm.attr(name);\n      }\n    };\n    var attrHooks = {\n      style: {\n        set: function ($elm, value) {\n          if (value !== null && typeof value === 'object') {\n            $elm.css(value);\n            return;\n          }\n\n          if (keepValues) {\n            $elm.attr('data-mce-style', value);\n          }\n\n          if (value !== null && typeof value === 'string') {\n            $elm.removeAttr('style');\n            $elm.css(styles.parse(value));\n          } else {\n            $elm.attr('style', value);\n          }\n        },\n        get: function ($elm) {\n          var value = $elm.attr('data-mce-style') || $elm.attr('style');\n          value = styles.serialize(styles.parse(value), $elm[0].nodeName);\n          return value;\n        }\n      }\n    };\n\n    if (keepValues) {\n      attrHooks.href = attrHooks.src = keepUrlHook;\n    }\n\n    return attrHooks;\n  };\n\n  var updateInternalStyleAttr = function (styles, $elm) {\n    var rawValue = $elm.attr('style');\n    var value = styles.serialize(styles.parse(rawValue), $elm[0].nodeName);\n\n    if (!value) {\n      value = null;\n    }\n\n    $elm.attr('data-mce-style', value);\n  };\n\n  var findNodeIndex = function (node, normalized) {\n    var idx = 0,\n        lastNodeType,\n        nodeType;\n\n    if (node) {\n      for (lastNodeType = node.nodeType, node = node.previousSibling; node; node = node.previousSibling) {\n        nodeType = node.nodeType;\n\n        if (normalized && nodeType === 3) {\n          if (nodeType === lastNodeType || !node.nodeValue.length) {\n            continue;\n          }\n        }\n\n        idx++;\n        lastNodeType = nodeType;\n      }\n    }\n\n    return idx;\n  };\n\n  function DOMUtils(doc, settings) {\n    var _this = this;\n\n    if (settings === void 0) {\n      settings = {};\n    }\n\n    var addedStyles = {};\n    var win = window;\n    var files = {};\n    var counter = 0;\n    var stdMode = true;\n    var boxModel = true;\n    var styleSheetLoader = instance.forElement(SugarElement.fromDom(doc), {\n      contentCssCors: settings.contentCssCors,\n      referrerPolicy: settings.referrerPolicy\n    });\n    var boundEvents = [];\n    var schema = settings.schema ? settings.schema : Schema({});\n    var styles = Styles({\n      url_converter: settings.url_converter,\n      url_converter_scope: settings.url_converter_scope\n    }, settings.schema);\n    var events = settings.ownEvents ? new EventUtils() : EventUtils.Event;\n    var blockElementsMap = schema.getBlockElements();\n    var $ = DomQuery.overrideDefaults(function () {\n      return {\n        context: doc,\n        element: self.getRoot()\n      };\n    });\n\n    var isBlock = function (node) {\n      if (typeof node === 'string') {\n        return !!blockElementsMap[node];\n      } else if (node) {\n        var type = node.nodeType;\n\n        if (type) {\n          return !!(type === 1 && blockElementsMap[node.nodeName]);\n        }\n      }\n\n      return false;\n    };\n\n    var get = function (elm) {\n      return elm && doc && isString(elm) ? doc.getElementById(elm) : elm;\n    };\n\n    var $$ = function (elm) {\n      return $(typeof elm === 'string' ? get(elm) : elm);\n    };\n\n    var getAttrib = function (elm, name, defaultVal) {\n      var hook, value;\n      var $elm = $$(elm);\n\n      if ($elm.length) {\n        hook = attrHooks[name];\n\n        if (hook && hook.get) {\n          value = hook.get($elm, name);\n        } else {\n          value = $elm.attr(name);\n        }\n      }\n\n      if (typeof value === 'undefined') {\n        value = defaultVal || '';\n      }\n\n      return value;\n    };\n\n    var getAttribs = function (elm) {\n      var node = get(elm);\n\n      if (!node) {\n        return [];\n      }\n\n      return node.attributes;\n    };\n\n    var setAttrib = function (elm, name, value) {\n      if (value === '') {\n        value = null;\n      }\n\n      var $elm = $$(elm);\n      var originalValue = $elm.attr(name);\n\n      if (!$elm.length) {\n        return;\n      }\n\n      var hook = attrHooks[name];\n\n      if (hook && hook.set) {\n        hook.set($elm, value, name);\n      } else {\n        $elm.attr(name, value);\n      }\n\n      if (originalValue !== value && settings.onSetAttrib) {\n        settings.onSetAttrib({\n          attrElm: $elm,\n          attrName: name,\n          attrValue: value\n        });\n      }\n    };\n\n    var clone = function (node, deep) {\n      if (!isIE || node.nodeType !== 1 || deep) {\n        return node.cloneNode(deep);\n      } else {\n        var clone_1 = doc.createElement(node.nodeName);\n        each$5(getAttribs(node), function (attr) {\n          setAttrib(clone_1, attr.nodeName, getAttrib(node, attr.nodeName));\n        });\n        return clone_1;\n      }\n    };\n\n    var getRoot = function () {\n      return settings.root_element || doc.body;\n    };\n\n    var getViewPort = function (argWin) {\n      var vp = getBounds(argWin);\n      return {\n        x: vp.x,\n        y: vp.y,\n        w: vp.width,\n        h: vp.height\n      };\n    };\n\n    var getPos$1 = function (elm, rootElm) {\n      return getPos(doc.body, get(elm), rootElm);\n    };\n\n    var setStyle = function (elm, name, value) {\n      var $elm = isString(name) ? $$(elm).css(name, value) : $$(elm).css(name);\n\n      if (settings.update_styles) {\n        updateInternalStyleAttr(styles, $elm);\n      }\n    };\n\n    var setStyles = function (elm, stylesArg) {\n      var $elm = $$(elm).css(stylesArg);\n\n      if (settings.update_styles) {\n        updateInternalStyleAttr(styles, $elm);\n      }\n    };\n\n    var getStyle = function (elm, name, computed) {\n      var $elm = $$(elm);\n\n      if (computed) {\n        return $elm.css(name);\n      }\n\n      name = name.replace(/-(\\D)/g, function (a, b) {\n        return b.toUpperCase();\n      });\n\n      if (name === 'float') {\n        name = Env.browser.isIE() ? 'styleFloat' : 'cssFloat';\n      }\n\n      return $elm[0] && $elm[0].style ? $elm[0].style[name] : undefined;\n    };\n\n    var getSize = function (elm) {\n      var w, h;\n      elm = get(elm);\n      w = getStyle(elm, 'width');\n      h = getStyle(elm, 'height');\n\n      if (w.indexOf('px') === -1) {\n        w = 0;\n      }\n\n      if (h.indexOf('px') === -1) {\n        h = 0;\n      }\n\n      return {\n        w: parseInt(w, 10) || elm.offsetWidth || elm.clientWidth,\n        h: parseInt(h, 10) || elm.offsetHeight || elm.clientHeight\n      };\n    };\n\n    var getRect = function (elm) {\n      elm = get(elm);\n      var pos = getPos$1(elm);\n      var size = getSize(elm);\n      return {\n        x: pos.x,\n        y: pos.y,\n        w: size.w,\n        h: size.h\n      };\n    };\n\n    var is = function (elm, selector) {\n      var i;\n\n      if (!elm) {\n        return false;\n      }\n\n      if (!Array.isArray(elm)) {\n        if (selector === '*') {\n          return elm.nodeType === 1;\n        }\n\n        if (simpleSelectorRe.test(selector)) {\n          var selectors = selector.toLowerCase().split(/,/);\n          var elmName = elm.nodeName.toLowerCase();\n\n          for (i = selectors.length - 1; i >= 0; i--) {\n            if (selectors[i] === elmName) {\n              return true;\n            }\n          }\n\n          return false;\n        }\n\n        if (elm.nodeType && elm.nodeType !== 1) {\n          return false;\n        }\n      }\n\n      var elms = !Array.isArray(elm) ? [elm] : elm;\n      return Sizzle(selector, elms[0].ownerDocument || elms[0], null, elms).length > 0;\n    };\n\n    var getParents = function (elm, selector, root, collect) {\n      var result = [];\n      var selectorVal;\n      var node = get(elm);\n      collect = collect === undefined;\n      root = root || (getRoot().nodeName !== 'BODY' ? getRoot().parentNode : null);\n\n      if (Tools.is(selector, 'string')) {\n        selectorVal = selector;\n\n        if (selector === '*') {\n          selector = function (node) {\n            return node.nodeType === 1;\n          };\n        } else {\n          selector = function (node) {\n            return is(node, selectorVal);\n          };\n        }\n      }\n\n      while (node) {\n        if (node === root || isNullable(node.nodeType) || isDocument$1(node) || isDocumentFragment$1(node)) {\n          break;\n        }\n\n        if (!selector || typeof selector === 'function' && selector(node)) {\n          if (collect) {\n            result.push(node);\n          } else {\n            return [node];\n          }\n        }\n\n        node = node.parentNode;\n      }\n\n      return collect ? result : null;\n    };\n\n    var getParent = function (node, selector, root) {\n      var parents = getParents(node, selector, root, false);\n      return parents && parents.length > 0 ? parents[0] : null;\n    };\n\n    var _findSib = function (node, selector, name) {\n      var func = selector;\n\n      if (node) {\n        if (typeof selector === 'string') {\n          func = function (node) {\n            return is(node, selector);\n          };\n        }\n\n        for (node = node[name]; node; node = node[name]) {\n          if (typeof func === 'function' && func(node)) {\n            return node;\n          }\n        }\n      }\n\n      return null;\n    };\n\n    var getNext = function (node, selector) {\n      return _findSib(node, selector, 'nextSibling');\n    };\n\n    var getPrev = function (node, selector) {\n      return _findSib(node, selector, 'previousSibling');\n    };\n\n    var select = function (selector, scope) {\n      return Sizzle(selector, get(scope) || settings.root_element || doc, []);\n    };\n\n    var run = function (elm, func, scope) {\n      var result;\n      var node = typeof elm === 'string' ? get(elm) : elm;\n\n      if (!node) {\n        return false;\n      }\n\n      if (Tools.isArray(node) && (node.length || node.length === 0)) {\n        result = [];\n        each$5(node, function (elm, i) {\n          if (elm) {\n            result.push(func.call(scope, typeof elm === 'string' ? get(elm) : elm, i));\n          }\n        });\n        return result;\n      }\n\n      var context = scope ? scope : _this;\n      return func.call(context, node);\n    };\n\n    var setAttribs = function (elm, attrs) {\n      $$(elm).each(function (i, node) {\n        each$5(attrs, function (value, name) {\n          setAttrib(node, name, value);\n        });\n      });\n    };\n\n    var setHTML = function (elm, html) {\n      var $elm = $$(elm);\n\n      if (isIE) {\n        $elm.each(function (i, target) {\n          if (target.canHaveHTML === false) {\n            return;\n          }\n\n          while (target.firstChild) {\n            target.removeChild(target.firstChild);\n          }\n\n          try {\n            target.innerHTML = '<br>' + html;\n            target.removeChild(target.firstChild);\n          } catch (ex) {\n            DomQuery('<div></div>').html('<br>' + html).contents().slice(1).appendTo(target);\n          }\n\n          return html;\n        });\n      } else {\n        $elm.html(html);\n      }\n    };\n\n    var add = function (parentElm, name, attrs, html, create) {\n      return run(parentElm, function (parentElm) {\n        var newElm = typeof name === 'string' ? doc.createElement(name) : name;\n        setAttribs(newElm, attrs);\n\n        if (html) {\n          if (typeof html !== 'string' && html.nodeType) {\n            newElm.appendChild(html);\n          } else if (typeof html === 'string') {\n            setHTML(newElm, html);\n          }\n        }\n\n        return !create ? parentElm.appendChild(newElm) : newElm;\n      });\n    };\n\n    var create = function (name, attrs, html) {\n      return add(doc.createElement(name), name, attrs, html, true);\n    };\n\n    var decode = Entities.decode;\n    var encode = Entities.encodeAllRaw;\n\n    var createHTML = function (name, attrs, html) {\n      var outHtml = '',\n          key;\n      outHtml += '<' + name;\n\n      for (key in attrs) {\n        if (attrs.hasOwnProperty(key) && attrs[key] !== null && typeof attrs[key] !== 'undefined') {\n          outHtml += ' ' + key + '=\"' + encode(attrs[key]) + '\"';\n        }\n      }\n\n      if (typeof html !== 'undefined') {\n        return outHtml + '>' + html + '</' + name + '>';\n      }\n\n      return outHtml + ' />';\n    };\n\n    var createFragment = function (html) {\n      var node;\n      var container = doc.createElement('div');\n      var frag = doc.createDocumentFragment();\n      frag.appendChild(container);\n\n      if (html) {\n        container.innerHTML = html;\n      }\n\n      while (node = container.firstChild) {\n        frag.appendChild(node);\n      }\n\n      frag.removeChild(container);\n      return frag;\n    };\n\n    var remove = function (node, keepChildren) {\n      var $node = $$(node);\n\n      if (keepChildren) {\n        $node.each(function () {\n          var child;\n\n          while (child = this.firstChild) {\n            if (child.nodeType === 3 && child.data.length === 0) {\n              this.removeChild(child);\n            } else {\n              this.parentNode.insertBefore(child, this);\n            }\n          }\n        }).remove();\n      } else {\n        $node.remove();\n      }\n\n      return $node.length > 1 ? $node.toArray() : $node[0];\n    };\n\n    var removeAllAttribs = function (e) {\n      return run(e, function (e) {\n        var i;\n        var attrs = e.attributes;\n\n        for (i = attrs.length - 1; i >= 0; i--) {\n          e.removeAttributeNode(attrs.item(i));\n        }\n      });\n    };\n\n    var parseStyle = function (cssText) {\n      return styles.parse(cssText);\n    };\n\n    var serializeStyle = function (stylesArg, name) {\n      return styles.serialize(stylesArg, name);\n    };\n\n    var addStyle = function (cssText) {\n      var head, styleElm;\n\n      if (self !== DOMUtils.DOM && doc === document) {\n        if (addedStyles[cssText]) {\n          return;\n        }\n\n        addedStyles[cssText] = true;\n      }\n\n      styleElm = doc.getElementById('mceDefaultStyles');\n\n      if (!styleElm) {\n        styleElm = doc.createElement('style');\n        styleElm.id = 'mceDefaultStyles';\n        styleElm.type = 'text/css';\n        head = doc.getElementsByTagName('head')[0];\n\n        if (head.firstChild) {\n          head.insertBefore(styleElm, head.firstChild);\n        } else {\n          head.appendChild(styleElm);\n        }\n      }\n\n      if (styleElm.styleSheet) {\n        styleElm.styleSheet.cssText += cssText;\n      } else {\n        styleElm.appendChild(doc.createTextNode(cssText));\n      }\n    };\n\n    var loadCSS = function (urls) {\n      if (!urls) {\n        urls = '';\n      }\n\n      each(urls.split(','), function (url) {\n        files[url] = true;\n        styleSheetLoader.load(url, noop);\n      });\n    };\n\n    var toggleClass = function (elm, cls, state) {\n      $$(elm).toggleClass(cls, state).each(function () {\n        if (this.className === '') {\n          DomQuery(this).attr('class', null);\n        }\n      });\n    };\n\n    var addClass = function (elm, cls) {\n      $$(elm).addClass(cls);\n    };\n\n    var removeClass = function (elm, cls) {\n      toggleClass(elm, cls, false);\n    };\n\n    var hasClass = function (elm, cls) {\n      return $$(elm).hasClass(cls);\n    };\n\n    var show = function (elm) {\n      $$(elm).show();\n    };\n\n    var hide = function (elm) {\n      $$(elm).hide();\n    };\n\n    var isHidden = function (elm) {\n      return $$(elm).css('display') === 'none';\n    };\n\n    var uniqueId = function (prefix) {\n      return (!prefix ? 'mce_' : prefix) + counter++;\n    };\n\n    var getOuterHTML = function (elm) {\n      var node = typeof elm === 'string' ? get(elm) : elm;\n      return isElement$1(node) ? node.outerHTML : DomQuery('<div></div>').append(DomQuery(node).clone()).html();\n    };\n\n    var setOuterHTML = function (elm, html) {\n      $$(elm).each(function () {\n        try {\n          if ('outerHTML' in this) {\n            this.outerHTML = html;\n            return;\n          }\n        } catch (ex) {}\n\n        remove(DomQuery(this).html(html), true);\n      });\n    };\n\n    var insertAfter = function (node, reference) {\n      var referenceNode = get(reference);\n      return run(node, function (node) {\n        var parent = referenceNode.parentNode;\n        var nextSibling = referenceNode.nextSibling;\n\n        if (nextSibling) {\n          parent.insertBefore(node, nextSibling);\n        } else {\n          parent.appendChild(node);\n        }\n\n        return node;\n      });\n    };\n\n    var replace = function (newElm, oldElm, keepChildren) {\n      return run(oldElm, function (oldElm) {\n        if (Tools.is(oldElm, 'array')) {\n          newElm = newElm.cloneNode(true);\n        }\n\n        if (keepChildren) {\n          each$5(grep$1(oldElm.childNodes), function (node) {\n            newElm.appendChild(node);\n          });\n        }\n\n        return oldElm.parentNode.replaceChild(newElm, oldElm);\n      });\n    };\n\n    var rename = function (elm, name) {\n      var newElm;\n\n      if (elm.nodeName !== name.toUpperCase()) {\n        newElm = create(name);\n        each$5(getAttribs(elm), function (attrNode) {\n          setAttrib(newElm, attrNode.nodeName, getAttrib(elm, attrNode.nodeName));\n        });\n        replace(newElm, elm, true);\n      }\n\n      return newElm || elm;\n    };\n\n    var findCommonAncestor = function (a, b) {\n      var ps = a,\n          pe;\n\n      while (ps) {\n        pe = b;\n\n        while (pe && ps !== pe) {\n          pe = pe.parentNode;\n        }\n\n        if (ps === pe) {\n          break;\n        }\n\n        ps = ps.parentNode;\n      }\n\n      if (!ps && a.ownerDocument) {\n        return a.ownerDocument.documentElement;\n      }\n\n      return ps;\n    };\n\n    var toHex = function (rgbVal) {\n      return styles.toHex(Tools.trim(rgbVal));\n    };\n\n    var isNonEmptyElement = function (node) {\n      if (isElement$1(node)) {\n        var isNamedAnchor = node.nodeName.toLowerCase() === 'a' && !getAttrib(node, 'href') && getAttrib(node, 'id');\n\n        if (getAttrib(node, 'name') || getAttrib(node, 'data-mce-bookmark') || isNamedAnchor) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    var isEmpty = function (node, elements) {\n      var type,\n          name,\n          brCount = 0;\n\n      if (isNonEmptyElement(node)) {\n        return false;\n      }\n\n      node = node.firstChild;\n\n      if (node) {\n        var walker = new DomTreeWalker(node, node.parentNode);\n        var whitespace = schema ? schema.getWhiteSpaceElements() : {};\n        elements = elements || (schema ? schema.getNonEmptyElements() : null);\n\n        do {\n          type = node.nodeType;\n\n          if (isElement$1(node)) {\n            var bogusVal = node.getAttribute('data-mce-bogus');\n\n            if (bogusVal) {\n              node = walker.next(bogusVal === 'all');\n              continue;\n            }\n\n            name = node.nodeName.toLowerCase();\n\n            if (elements && elements[name]) {\n              if (name === 'br') {\n                brCount++;\n                node = walker.next();\n                continue;\n              }\n\n              return false;\n            }\n\n            if (isNonEmptyElement(node)) {\n              return false;\n            }\n          }\n\n          if (type === 8) {\n            return false;\n          }\n\n          if (type === 3 && !isWhitespaceText(node.nodeValue)) {\n            return false;\n          }\n\n          if (type === 3 && node.parentNode && whitespace[node.parentNode.nodeName] && isWhitespaceText(node.nodeValue)) {\n            return false;\n          }\n\n          node = walker.next();\n        } while (node);\n      }\n\n      return brCount <= 1;\n    };\n\n    var createRng = function () {\n      return doc.createRange();\n    };\n\n    var split = function (parentElm, splitElm, replacementElm) {\n      var range = createRng();\n      var beforeFragment;\n      var afterFragment;\n      var parentNode;\n\n      if (parentElm && splitElm) {\n        range.setStart(parentElm.parentNode, findNodeIndex(parentElm));\n        range.setEnd(splitElm.parentNode, findNodeIndex(splitElm));\n        beforeFragment = range.extractContents();\n        range = createRng();\n        range.setStart(splitElm.parentNode, findNodeIndex(splitElm) + 1);\n        range.setEnd(parentElm.parentNode, findNodeIndex(parentElm) + 1);\n        afterFragment = range.extractContents();\n        parentNode = parentElm.parentNode;\n        parentNode.insertBefore(trimNode(self, beforeFragment), parentElm);\n\n        if (replacementElm) {\n          parentNode.insertBefore(replacementElm, parentElm);\n        } else {\n          parentNode.insertBefore(splitElm, parentElm);\n        }\n\n        parentNode.insertBefore(trimNode(self, afterFragment), parentElm);\n        remove(parentElm);\n        return replacementElm || splitElm;\n      }\n    };\n\n    var bind = function (target, name, func, scope) {\n      if (Tools.isArray(target)) {\n        var i = target.length;\n        var rv = [];\n\n        while (i--) {\n          rv[i] = bind(target[i], name, func, scope);\n        }\n\n        return rv;\n      }\n\n      if (settings.collect && (target === doc || target === win)) {\n        boundEvents.push([target, name, func, scope]);\n      }\n\n      var output = events.bind(target, name, func, scope || self);\n      return output;\n    };\n\n    var unbind = function (target, name, func) {\n      if (Tools.isArray(target)) {\n        var i = target.length;\n        var rv = [];\n\n        while (i--) {\n          rv[i] = unbind(target[i], name, func);\n        }\n\n        return rv;\n      } else {\n        if (boundEvents.length > 0 && (target === doc || target === win)) {\n          var i = boundEvents.length;\n\n          while (i--) {\n            var item = boundEvents[i];\n\n            if (target === item[0] && (!name || name === item[1]) && (!func || func === item[2])) {\n              events.unbind(item[0], item[1], item[2]);\n            }\n          }\n        }\n\n        return events.unbind(target, name, func);\n      }\n    };\n\n    var fire = function (target, name, evt) {\n      return events.fire(target, name, evt);\n    };\n\n    var getContentEditable = function (node) {\n      if (node && isElement$1(node)) {\n        var contentEditable = node.getAttribute('data-mce-contenteditable');\n\n        if (contentEditable && contentEditable !== 'inherit') {\n          return contentEditable;\n        }\n\n        return node.contentEditable !== 'inherit' ? node.contentEditable : null;\n      } else {\n        return null;\n      }\n    };\n\n    var getContentEditableParent = function (node) {\n      var root = getRoot();\n      var state = null;\n\n      for (; node && node !== root; node = node.parentNode) {\n        state = getContentEditable(node);\n\n        if (state !== null) {\n          break;\n        }\n      }\n\n      return state;\n    };\n\n    var destroy = function () {\n      if (boundEvents.length > 0) {\n        var i = boundEvents.length;\n\n        while (i--) {\n          var item = boundEvents[i];\n          events.unbind(item[0], item[1], item[2]);\n        }\n      }\n\n      each$1(files, function (_, url) {\n        styleSheetLoader.unload(url);\n        delete files[url];\n      });\n\n      if (Sizzle.setDocument) {\n        Sizzle.setDocument();\n      }\n    };\n\n    var isChildOf = function (node, parent) {\n      while (node) {\n        if (parent === node) {\n          return true;\n        }\n\n        node = node.parentNode;\n      }\n\n      return false;\n    };\n\n    var dumpRng = function (r) {\n      return 'startContainer: ' + r.startContainer.nodeName + ', startOffset: ' + r.startOffset + ', endContainer: ' + r.endContainer.nodeName + ', endOffset: ' + r.endOffset;\n    };\n\n    var self = {\n      doc: doc,\n      settings: settings,\n      win: win,\n      files: files,\n      stdMode: stdMode,\n      boxModel: boxModel,\n      styleSheetLoader: styleSheetLoader,\n      boundEvents: boundEvents,\n      styles: styles,\n      schema: schema,\n      events: events,\n      isBlock: isBlock,\n      $: $,\n      $$: $$,\n      root: null,\n      clone: clone,\n      getRoot: getRoot,\n      getViewPort: getViewPort,\n      getRect: getRect,\n      getSize: getSize,\n      getParent: getParent,\n      getParents: getParents,\n      get: get,\n      getNext: getNext,\n      getPrev: getPrev,\n      select: select,\n      is: is,\n      add: add,\n      create: create,\n      createHTML: createHTML,\n      createFragment: createFragment,\n      remove: remove,\n      setStyle: setStyle,\n      getStyle: getStyle,\n      setStyles: setStyles,\n      removeAllAttribs: removeAllAttribs,\n      setAttrib: setAttrib,\n      setAttribs: setAttribs,\n      getAttrib: getAttrib,\n      getPos: getPos$1,\n      parseStyle: parseStyle,\n      serializeStyle: serializeStyle,\n      addStyle: addStyle,\n      loadCSS: loadCSS,\n      addClass: addClass,\n      removeClass: removeClass,\n      hasClass: hasClass,\n      toggleClass: toggleClass,\n      show: show,\n      hide: hide,\n      isHidden: isHidden,\n      uniqueId: uniqueId,\n      setHTML: setHTML,\n      getOuterHTML: getOuterHTML,\n      setOuterHTML: setOuterHTML,\n      decode: decode,\n      encode: encode,\n      insertAfter: insertAfter,\n      replace: replace,\n      rename: rename,\n      findCommonAncestor: findCommonAncestor,\n      toHex: toHex,\n      run: run,\n      getAttribs: getAttribs,\n      isEmpty: isEmpty,\n      createRng: createRng,\n      nodeIndex: findNodeIndex,\n      split: split,\n      bind: bind,\n      unbind: unbind,\n      fire: fire,\n      getContentEditable: getContentEditable,\n      getContentEditableParent: getContentEditableParent,\n      destroy: destroy,\n      isChildOf: isChildOf,\n      dumpRng: dumpRng\n    };\n    var attrHooks = setupAttrHooks(styles, settings, function () {\n      return self;\n    });\n    return self;\n  }\n\n  (function (DOMUtils) {\n    DOMUtils.DOM = DOMUtils(document);\n    DOMUtils.nodeIndex = findNodeIndex;\n  })(DOMUtils || (DOMUtils = {}));\n\n  var DOMUtils$1 = DOMUtils;\n  var DOM = DOMUtils$1.DOM;\n  var each$6 = Tools.each,\n      grep$2 = Tools.grep;\n  var QUEUED = 0;\n  var LOADING = 1;\n  var LOADED = 2;\n  var FAILED = 3;\n\n  var ScriptLoader = function () {\n    function ScriptLoader(settings) {\n      if (settings === void 0) {\n        settings = {};\n      }\n\n      this.states = {};\n      this.queue = [];\n      this.scriptLoadedCallbacks = {};\n      this.queueLoadedCallbacks = [];\n      this.loading = 0;\n      this.settings = settings;\n    }\n\n    ScriptLoader.prototype._setReferrerPolicy = function (referrerPolicy) {\n      this.settings.referrerPolicy = referrerPolicy;\n    };\n\n    ScriptLoader.prototype.loadScript = function (url, success, failure) {\n      var dom = DOM;\n      var elm;\n\n      var cleanup = function () {\n        dom.remove(id);\n\n        if (elm) {\n          elm.onerror = elm.onload = elm = null;\n        }\n      };\n\n      var done = function () {\n        cleanup();\n        success();\n      };\n\n      var error = function () {\n        cleanup();\n\n        if (isFunction(failure)) {\n          failure();\n        } else {\n          if (typeof console !== 'undefined' && console.log) {\n            console.log('Failed to load script: ' + url);\n          }\n        }\n      };\n\n      var id = dom.uniqueId();\n      elm = document.createElement('script');\n      elm.id = id;\n      elm.type = 'text/javascript';\n      elm.src = Tools._addCacheSuffix(url);\n\n      if (this.settings.referrerPolicy) {\n        dom.setAttrib(elm, 'referrerpolicy', this.settings.referrerPolicy);\n      }\n\n      elm.onload = done;\n      elm.onerror = error;\n      (document.getElementsByTagName('head')[0] || document.body).appendChild(elm);\n    };\n\n    ScriptLoader.prototype.isDone = function (url) {\n      return this.states[url] === LOADED;\n    };\n\n    ScriptLoader.prototype.markDone = function (url) {\n      this.states[url] = LOADED;\n    };\n\n    ScriptLoader.prototype.add = function (url, success, scope, failure) {\n      var state = this.states[url];\n      this.queue.push(url);\n\n      if (state === undefined) {\n        this.states[url] = QUEUED;\n      }\n\n      if (success) {\n        if (!this.scriptLoadedCallbacks[url]) {\n          this.scriptLoadedCallbacks[url] = [];\n        }\n\n        this.scriptLoadedCallbacks[url].push({\n          success: success,\n          failure: failure,\n          scope: scope || this\n        });\n      }\n    };\n\n    ScriptLoader.prototype.load = function (url, success, scope, failure) {\n      return this.add(url, success, scope, failure);\n    };\n\n    ScriptLoader.prototype.remove = function (url) {\n      delete this.states[url];\n      delete this.scriptLoadedCallbacks[url];\n    };\n\n    ScriptLoader.prototype.loadQueue = function (success, scope, failure) {\n      this.loadScripts(this.queue, success, scope, failure);\n    };\n\n    ScriptLoader.prototype.loadScripts = function (scripts, success, scope, failure) {\n      var self = this;\n      var failures = [];\n\n      var execCallbacks = function (name, url) {\n        each$6(self.scriptLoadedCallbacks[url], function (callback) {\n          if (isFunction(callback[name])) {\n            callback[name].call(callback.scope);\n          }\n        });\n        self.scriptLoadedCallbacks[url] = undefined;\n      };\n\n      self.queueLoadedCallbacks.push({\n        success: success,\n        failure: failure,\n        scope: scope || this\n      });\n\n      var loadScripts = function () {\n        var loadingScripts = grep$2(scripts);\n        scripts.length = 0;\n        each$6(loadingScripts, function (url) {\n          if (self.states[url] === LOADED) {\n            execCallbacks('success', url);\n            return;\n          }\n\n          if (self.states[url] === FAILED) {\n            execCallbacks('failure', url);\n            return;\n          }\n\n          if (self.states[url] !== LOADING) {\n            self.states[url] = LOADING;\n            self.loading++;\n            self.loadScript(url, function () {\n              self.states[url] = LOADED;\n              self.loading--;\n              execCallbacks('success', url);\n              loadScripts();\n            }, function () {\n              self.states[url] = FAILED;\n              self.loading--;\n              failures.push(url);\n              execCallbacks('failure', url);\n              loadScripts();\n            });\n          }\n        });\n\n        if (!self.loading) {\n          var notifyCallbacks = self.queueLoadedCallbacks.slice(0);\n          self.queueLoadedCallbacks.length = 0;\n          each$6(notifyCallbacks, function (callback) {\n            if (failures.length === 0) {\n              if (isFunction(callback.success)) {\n                callback.success.call(callback.scope);\n              }\n            } else {\n              if (isFunction(callback.failure)) {\n                callback.failure.call(callback.scope, failures);\n              }\n            }\n          });\n        }\n      };\n\n      loadScripts();\n    };\n\n    ScriptLoader.ScriptLoader = new ScriptLoader();\n    return ScriptLoader;\n  }();\n\n  var Cell = function (initial) {\n    var value = initial;\n\n    var get = function () {\n      return value;\n    };\n\n    var set = function (v) {\n      value = v;\n    };\n\n    return {\n      get: get,\n      set: set\n    };\n  };\n\n  var isRaw = function (str) {\n    return isObject(str) && has(str, 'raw');\n  };\n\n  var isTokenised = function (str) {\n    return isArray(str) && str.length > 1;\n  };\n\n  var data = {};\n  var currentCode = Cell('en');\n\n  var getLanguageData = function () {\n    return get$1(data, currentCode.get());\n  };\n\n  var getData = function () {\n    return map$1(data, function (value) {\n      return __assign({}, value);\n    });\n  };\n\n  var setCode = function (newCode) {\n    if (newCode) {\n      currentCode.set(newCode);\n    }\n  };\n\n  var getCode = function () {\n    return currentCode.get();\n  };\n\n  var add = function (code, items) {\n    var langData = data[code];\n\n    if (!langData) {\n      data[code] = langData = {};\n    }\n\n    each$1(items, function (translation, name) {\n      langData[name.toLowerCase()] = translation;\n    });\n  };\n\n  var translate = function (text) {\n    var langData = getLanguageData().getOr({});\n\n    var toString = function (obj) {\n      if (isFunction(obj)) {\n        return Object.prototype.toString.call(obj);\n      }\n\n      return !isEmpty(obj) ? '' + obj : '';\n    };\n\n    var isEmpty = function (text) {\n      return text === '' || text === null || text === undefined;\n    };\n\n    var getLangData = function (text) {\n      var textstr = toString(text);\n      return get$1(langData, textstr.toLowerCase()).map(toString).getOr(textstr);\n    };\n\n    var removeContext = function (str) {\n      return str.replace(/{context:\\w+}$/, '');\n    };\n\n    if (isEmpty(text)) {\n      return '';\n    }\n\n    if (isRaw(text)) {\n      return toString(text.raw);\n    }\n\n    if (isTokenised(text)) {\n      var values_1 = text.slice(1);\n      var substitued = getLangData(text[0]).replace(/\\{([0-9]+)\\}/g, function ($1, $2) {\n        return has(values_1, $2) ? toString(values_1[$2]) : $1;\n      });\n      return removeContext(substitued);\n    }\n\n    return removeContext(getLangData(text));\n  };\n\n  var isRtl = function () {\n    return getLanguageData().bind(function (items) {\n      return get$1(items, '_dir');\n    }).exists(function (dir) {\n      return dir === 'rtl';\n    });\n  };\n\n  var hasCode = function (code) {\n    return has(data, code);\n  };\n\n  var I18n = {\n    getData: getData,\n    setCode: setCode,\n    getCode: getCode,\n    add: add,\n    translate: translate,\n    isRtl: isRtl,\n    hasCode: hasCode\n  };\n\n  function AddOnManager() {\n    var _this = this;\n\n    var items = [];\n    var urls = {};\n    var lookup = {};\n    var _listeners = [];\n\n    var runListeners = function (name, state) {\n      var matchedListeners = filter(_listeners, function (listener) {\n        return listener.name === name && listener.state === state;\n      });\n      each(matchedListeners, function (listener) {\n        return listener.callback();\n      });\n    };\n\n    var get = function (name) {\n      if (lookup[name]) {\n        return lookup[name].instance;\n      }\n\n      return undefined;\n    };\n\n    var dependencies = function (name) {\n      var result;\n\n      if (lookup[name]) {\n        result = lookup[name].dependencies;\n      }\n\n      return result || [];\n    };\n\n    var requireLangPack = function (name, languages) {\n      if (AddOnManager.languageLoad !== false) {\n        waitFor(name, function () {\n          var language = I18n.getCode();\n          var wrappedLanguages = ',' + (languages || '') + ',';\n\n          if (!language || languages && wrappedLanguages.indexOf(',' + language + ',') === -1) {\n            return;\n          }\n\n          ScriptLoader.ScriptLoader.add(urls[name] + '/langs/' + language + '.js');\n        }, 'loaded');\n      }\n    };\n\n    var add = function (id, addOn, dependencies) {\n      var addOnConstructor = addOn;\n      items.push(addOnConstructor);\n      lookup[id] = {\n        instance: addOnConstructor,\n        dependencies: dependencies\n      };\n      runListeners(id, 'added');\n      return addOnConstructor;\n    };\n\n    var remove = function (name) {\n      delete urls[name];\n      delete lookup[name];\n    };\n\n    var createUrl = function (baseUrl, dep) {\n      if (typeof dep === 'object') {\n        return dep;\n      }\n\n      return typeof baseUrl === 'string' ? {\n        prefix: '',\n        resource: dep,\n        suffix: ''\n      } : {\n        prefix: baseUrl.prefix,\n        resource: dep,\n        suffix: baseUrl.suffix\n      };\n    };\n\n    var addComponents = function (pluginName, scripts) {\n      var pluginUrl = _this.urls[pluginName];\n      each(scripts, function (script) {\n        ScriptLoader.ScriptLoader.add(pluginUrl + '/' + script);\n      });\n    };\n\n    var loadDependencies = function (name, addOnUrl, success, scope) {\n      var deps = dependencies(name);\n      each(deps, function (dep) {\n        var newUrl = createUrl(addOnUrl, dep);\n        load(newUrl.resource, newUrl, undefined, undefined);\n      });\n\n      if (success) {\n        if (scope) {\n          success.call(scope);\n        } else {\n          success.call(ScriptLoader);\n        }\n      }\n    };\n\n    var load = function (name, addOnUrl, success, scope, failure) {\n      if (urls[name]) {\n        return;\n      }\n\n      var urlString = typeof addOnUrl === 'string' ? addOnUrl : addOnUrl.prefix + addOnUrl.resource + addOnUrl.suffix;\n\n      if (urlString.indexOf('/') !== 0 && urlString.indexOf('://') === -1) {\n        urlString = AddOnManager.baseURL + '/' + urlString;\n      }\n\n      urls[name] = urlString.substring(0, urlString.lastIndexOf('/'));\n\n      var done = function () {\n        runListeners(name, 'loaded');\n        loadDependencies(name, addOnUrl, success, scope);\n      };\n\n      if (lookup[name]) {\n        done();\n      } else {\n        ScriptLoader.ScriptLoader.add(urlString, done, scope, failure);\n      }\n    };\n\n    var waitFor = function (name, callback, state) {\n      if (state === void 0) {\n        state = 'added';\n      }\n\n      if (has(lookup, name) && state === 'added') {\n        callback();\n      } else if (has(urls, name) && state === 'loaded') {\n        callback();\n      } else {\n        _listeners.push({\n          name: name,\n          state: state,\n          callback: callback\n        });\n      }\n    };\n\n    return {\n      items: items,\n      urls: urls,\n      lookup: lookup,\n      _listeners: _listeners,\n      get: get,\n      dependencies: dependencies,\n      requireLangPack: requireLangPack,\n      add: add,\n      remove: remove,\n      createUrl: createUrl,\n      addComponents: addComponents,\n      load: load,\n      waitFor: waitFor\n    };\n  }\n\n  (function (AddOnManager) {\n    AddOnManager.PluginManager = AddOnManager();\n    AddOnManager.ThemeManager = AddOnManager();\n  })(AddOnManager || (AddOnManager = {}));\n\n  var AddOnManager$1 = AddOnManager;\n\n  var first = function (fn, rate) {\n    var timer = null;\n\n    var cancel = function () {\n      if (timer !== null) {\n        clearTimeout(timer);\n        timer = null;\n      }\n    };\n\n    var throttle = function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      if (timer === null) {\n        timer = setTimeout(function () {\n          fn.apply(null, args);\n          timer = null;\n        }, rate);\n      }\n    };\n\n    return {\n      cancel: cancel,\n      throttle: throttle\n    };\n  };\n\n  var last$2 = function (fn, rate) {\n    var timer = null;\n\n    var cancel = function () {\n      if (timer !== null) {\n        clearTimeout(timer);\n        timer = null;\n      }\n    };\n\n    var throttle = function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      if (timer !== null) {\n        clearTimeout(timer);\n      }\n\n      timer = setTimeout(function () {\n        fn.apply(null, args);\n        timer = null;\n      }, rate);\n    };\n\n    return {\n      cancel: cancel,\n      throttle: throttle\n    };\n  };\n\n  var read = function (element, attr) {\n    var value = get$4(element, attr);\n    return value === undefined || value === '' ? [] : value.split(' ');\n  };\n\n  var add$1 = function (element, attr, id) {\n    var old = read(element, attr);\n    var nu = old.concat([id]);\n    set(element, attr, nu.join(' '));\n    return true;\n  };\n\n  var remove$2 = function (element, attr, id) {\n    var nu = filter(read(element, attr), function (v) {\n      return v !== id;\n    });\n\n    if (nu.length > 0) {\n      set(element, attr, nu.join(' '));\n    } else {\n      remove$1(element, attr);\n    }\n\n    return false;\n  };\n\n  var supports = function (element) {\n    return element.dom.classList !== undefined;\n  };\n\n  var get$6 = function (element) {\n    return read(element, 'class');\n  };\n\n  var add$2 = function (element, clazz) {\n    return add$1(element, 'class', clazz);\n  };\n\n  var remove$3 = function (element, clazz) {\n    return remove$2(element, 'class', clazz);\n  };\n\n  var add$3 = function (element, clazz) {\n    if (supports(element)) {\n      element.dom.classList.add(clazz);\n    } else {\n      add$2(element, clazz);\n    }\n  };\n\n  var cleanClass = function (element) {\n    var classList = supports(element) ? element.dom.classList : get$6(element);\n\n    if (classList.length === 0) {\n      remove$1(element, 'class');\n    }\n  };\n\n  var remove$4 = function (element, clazz) {\n    if (supports(element)) {\n      var classList = element.dom.classList;\n      classList.remove(clazz);\n    } else {\n      remove$3(element, clazz);\n    }\n\n    cleanClass(element);\n  };\n\n  var has$2 = function (element, clazz) {\n    return supports(element) && element.dom.classList.contains(clazz);\n  };\n\n  var descendants = function (scope, predicate) {\n    var result = [];\n    each(children(scope), function (x) {\n      if (predicate(x)) {\n        result = result.concat([x]);\n      }\n\n      result = result.concat(descendants(x, predicate));\n    });\n    return result;\n  };\n\n  var descendants$1 = function (scope, selector) {\n    return all(selector, scope);\n  };\n\n  var annotation = constant('mce-annotation');\n  var dataAnnotation = constant('data-mce-annotation');\n  var dataAnnotationId = constant('data-mce-annotation-uid');\n\n  var identify = function (editor, annotationName) {\n    var rng = editor.selection.getRng();\n    var start = SugarElement.fromDom(rng.startContainer);\n    var root = SugarElement.fromDom(editor.getBody());\n    var selector = annotationName.fold(function () {\n      return '.' + annotation();\n    }, function (an) {\n      return '[' + dataAnnotation() + '=\"' + an + '\"]';\n    });\n    var newStart = child(start, rng.startOffset).getOr(start);\n    var closest = closest$1(newStart, selector, function (n) {\n      return eq$2(n, root);\n    });\n\n    var getAttr = function (c, property) {\n      if (has$1(c, property)) {\n        return Optional.some(get$4(c, property));\n      } else {\n        return Optional.none();\n      }\n    };\n\n    return closest.bind(function (c) {\n      return getAttr(c, '' + dataAnnotationId()).bind(function (uid) {\n        return getAttr(c, '' + dataAnnotation()).map(function (name) {\n          var elements = findMarkers(editor, uid);\n          return {\n            uid: uid,\n            name: name,\n            elements: elements\n          };\n        });\n      });\n    });\n  };\n\n  var isAnnotation = function (elem) {\n    return isElement(elem) && has$2(elem, annotation());\n  };\n\n  var findMarkers = function (editor, uid) {\n    var body = SugarElement.fromDom(editor.getBody());\n    return descendants$1(body, '[' + dataAnnotationId() + '=\"' + uid + '\"]');\n  };\n\n  var findAll = function (editor, name) {\n    var body = SugarElement.fromDom(editor.getBody());\n    var markers = descendants$1(body, '[' + dataAnnotation() + '=\"' + name + '\"]');\n    var directory = {};\n    each(markers, function (m) {\n      var uid = get$4(m, dataAnnotationId());\n      var nodesAlready = directory.hasOwnProperty(uid) ? directory[uid] : [];\n      directory[uid] = nodesAlready.concat([m]);\n    });\n    return directory;\n  };\n\n  var setup = function (editor, _registry) {\n    var changeCallbacks = Cell({});\n\n    var initData = function () {\n      return {\n        listeners: [],\n        previous: Cell(Optional.none())\n      };\n    };\n\n    var withCallbacks = function (name, f) {\n      updateCallbacks(name, function (data) {\n        f(data);\n        return data;\n      });\n    };\n\n    var updateCallbacks = function (name, f) {\n      var callbackMap = changeCallbacks.get();\n      var data = callbackMap.hasOwnProperty(name) ? callbackMap[name] : initData();\n      var outputData = f(data);\n      callbackMap[name] = outputData;\n      changeCallbacks.set(callbackMap);\n    };\n\n    var fireCallbacks = function (name, uid, elements) {\n      withCallbacks(name, function (data) {\n        each(data.listeners, function (f) {\n          return f(true, name, {\n            uid: uid,\n            nodes: map(elements, function (elem) {\n              return elem.dom;\n            })\n          });\n        });\n      });\n    };\n\n    var fireNoAnnotation = function (name) {\n      withCallbacks(name, function (data) {\n        each(data.listeners, function (f) {\n          return f(false, name);\n        });\n      });\n    };\n\n    var onNodeChange = last$2(function () {\n      var callbackMap = changeCallbacks.get();\n      var annotations = sort$1(keys(callbackMap));\n      each(annotations, function (name) {\n        updateCallbacks(name, function (data) {\n          var prev = data.previous.get();\n          identify(editor, Optional.some(name)).fold(function () {\n            if (prev.isSome()) {\n              fireNoAnnotation(name);\n              data.previous.set(Optional.none());\n            }\n          }, function (_a) {\n            var uid = _a.uid,\n                name = _a.name,\n                elements = _a.elements;\n\n            if (!prev.is(uid)) {\n              fireCallbacks(name, uid, elements);\n              data.previous.set(Optional.some(uid));\n            }\n          });\n          return {\n            previous: data.previous,\n            listeners: data.listeners\n          };\n        });\n      });\n    }, 30);\n    editor.on('remove', function () {\n      onNodeChange.cancel();\n    });\n    editor.on('NodeChange', function () {\n      onNodeChange.throttle();\n    });\n\n    var addListener = function (name, f) {\n      updateCallbacks(name, function (data) {\n        return {\n          previous: data.previous,\n          listeners: data.listeners.concat([f])\n        };\n      });\n    };\n\n    return {\n      addListener: addListener\n    };\n  };\n\n  var setup$1 = function (editor, registry) {\n    var identifyParserNode = function (span) {\n      return Optional.from(span.attr(dataAnnotation())).bind(registry.lookup);\n    };\n\n    editor.on('init', function () {\n      editor.serializer.addNodeFilter('span', function (spans) {\n        each(spans, function (span) {\n          identifyParserNode(span).each(function (settings) {\n            if (settings.persistent === false) {\n              span.unwrap();\n            }\n          });\n        });\n      });\n    });\n  };\n\n  var create$2 = function () {\n    var annotations = {};\n\n    var register = function (name, settings) {\n      annotations[name] = {\n        name: name,\n        settings: settings\n      };\n    };\n\n    var lookup = function (name) {\n      return annotations.hasOwnProperty(name) ? Optional.from(annotations[name]).map(function (a) {\n        return a.settings;\n      }) : Optional.none();\n    };\n\n    return {\n      register: register,\n      lookup: lookup\n    };\n  };\n\n  var unique = 0;\n\n  var generate$1 = function (prefix) {\n    var date = new Date();\n    var time = date.getTime();\n    var random = Math.floor(Math.random() * 1000000000);\n    unique++;\n    return prefix + '_' + random + unique + String(time);\n  };\n\n  var add$4 = function (element, classes) {\n    each(classes, function (x) {\n      add$3(element, x);\n    });\n  };\n\n  var fromHtml$1 = function (html, scope) {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n    return children(SugarElement.fromDom(div));\n  };\n\n  var get$7 = function (element) {\n    return element.dom.innerHTML;\n  };\n\n  var set$1 = function (element, content) {\n    var owner$1 = owner(element);\n    var docDom = owner$1.dom;\n    var fragment = SugarElement.fromDom(docDom.createDocumentFragment());\n    var contentElements = fromHtml$1(content, docDom);\n    append$1(fragment, contentElements);\n    empty(element);\n    append(element, fragment);\n  };\n\n  var clone$1 = function (original, isDeep) {\n    return SugarElement.fromDom(original.dom.cloneNode(isDeep));\n  };\n\n  var shallow = function (original) {\n    return clone$1(original, false);\n  };\n\n  var deep = function (original) {\n    return clone$1(original, true);\n  };\n\n  var TextWalker = function (startNode, rootNode, isBoundary) {\n    if (isBoundary === void 0) {\n      isBoundary = never;\n    }\n\n    var walker = new DomTreeWalker(startNode, rootNode);\n\n    var walk = function (direction) {\n      var next;\n\n      do {\n        next = walker[direction]();\n      } while (next && !isText$1(next) && !isBoundary(next));\n\n      return Optional.from(next).filter(isText$1);\n    };\n\n    return {\n      current: function () {\n        return Optional.from(walker.current()).filter(isText$1);\n      },\n      next: function () {\n        return walk('next');\n      },\n      prev: function () {\n        return walk('prev');\n      },\n      prev2: function () {\n        return walk('prev2');\n      }\n    };\n  };\n\n  var TextSeeker = function (dom, isBoundary) {\n    var isBlockBoundary = isBoundary ? isBoundary : function (node) {\n      return dom.isBlock(node) || isBr(node) || isContentEditableFalse(node);\n    };\n\n    var walk = function (node, offset, walker, process) {\n      if (isText$1(node)) {\n        var newOffset = process(node, offset, node.data);\n\n        if (newOffset !== -1) {\n          return Optional.some({\n            container: node,\n            offset: newOffset\n          });\n        }\n      }\n\n      return walker().bind(function (next) {\n        return walk(next.container, next.offset, walker, process);\n      });\n    };\n\n    var backwards = function (node, offset, process, root) {\n      var walker = TextWalker(node, root, isBlockBoundary);\n      return walk(node, offset, function () {\n        return walker.prev().map(function (prev) {\n          return {\n            container: prev,\n            offset: prev.length\n          };\n        });\n      }, process).getOrNull();\n    };\n\n    var forwards = function (node, offset, process, root) {\n      var walker = TextWalker(node, root, isBlockBoundary);\n      return walk(node, offset, function () {\n        return walker.next().map(function (next) {\n          return {\n            container: next,\n            offset: 0\n          };\n        });\n      }, process).getOrNull();\n    };\n\n    return {\n      backwards: backwards,\n      forwards: forwards\n    };\n  };\n\n  var cat = function (arr) {\n    var r = [];\n\n    var push = function (x) {\n      r.push(x);\n    };\n\n    for (var i = 0; i < arr.length; i++) {\n      arr[i].each(push);\n    }\n\n    return r;\n  };\n\n  var lift2 = function (oa, ob, f) {\n    return oa.isSome() && ob.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie())) : Optional.none();\n  };\n\n  var lift3 = function (oa, ob, oc, f) {\n    return oa.isSome() && ob.isSome() && oc.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie(), oc.getOrDie())) : Optional.none();\n  };\n\n  var someIf = function (b, a) {\n    return b ? Optional.some(a) : Optional.none();\n  };\n\n  var round = Math.round;\n\n  var clone$2 = function (rect) {\n    if (!rect) {\n      return {\n        left: 0,\n        top: 0,\n        bottom: 0,\n        right: 0,\n        width: 0,\n        height: 0\n      };\n    }\n\n    return {\n      left: round(rect.left),\n      top: round(rect.top),\n      bottom: round(rect.bottom),\n      right: round(rect.right),\n      width: round(rect.width),\n      height: round(rect.height)\n    };\n  };\n\n  var collapse = function (rect, toStart) {\n    rect = clone$2(rect);\n\n    if (toStart) {\n      rect.right = rect.left;\n    } else {\n      rect.left = rect.left + rect.width;\n      rect.right = rect.left;\n    }\n\n    rect.width = 0;\n    return rect;\n  };\n\n  var isEqual = function (rect1, rect2) {\n    return rect1.left === rect2.left && rect1.top === rect2.top && rect1.bottom === rect2.bottom && rect1.right === rect2.right;\n  };\n\n  var isValidOverflow = function (overflowY, rect1, rect2) {\n    return overflowY >= 0 && overflowY <= Math.min(rect1.height, rect2.height) / 2;\n  };\n\n  var isAbove = function (rect1, rect2) {\n    var halfHeight = Math.min(rect2.height / 2, rect1.height / 2);\n\n    if (rect1.bottom - halfHeight < rect2.top) {\n      return true;\n    }\n\n    if (rect1.top > rect2.bottom) {\n      return false;\n    }\n\n    return isValidOverflow(rect2.top - rect1.bottom, rect1, rect2);\n  };\n\n  var isBelow = function (rect1, rect2) {\n    if (rect1.top > rect2.bottom) {\n      return true;\n    }\n\n    if (rect1.bottom < rect2.top) {\n      return false;\n    }\n\n    return isValidOverflow(rect2.bottom - rect1.top, rect1, rect2);\n  };\n\n  var containsXY = function (rect, clientX, clientY) {\n    return clientX >= rect.left && clientX <= rect.right && clientY >= rect.top && clientY <= rect.bottom;\n  };\n\n  var getSelectedNode = function (range) {\n    var startContainer = range.startContainer,\n        startOffset = range.startOffset;\n\n    if (startContainer.hasChildNodes() && range.endOffset === startOffset + 1) {\n      return startContainer.childNodes[startOffset];\n    }\n\n    return null;\n  };\n\n  var getNode = function (container, offset) {\n    if (container.nodeType === 1 && container.hasChildNodes()) {\n      if (offset >= container.childNodes.length) {\n        offset = container.childNodes.length - 1;\n      }\n\n      container = container.childNodes[offset];\n    }\n\n    return container;\n  };\n\n  var extendingChars = new RegExp('[\\u0300-\\u036f\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1-\\u05c2\\u05c4-\\u05c5\\u05c7\\u0610-\\u061a' + '\\u064b-\\u065f\\u0670\\u06d6-\\u06dc\\u06df-\\u06e4\\u06e7-\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0' + '\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0859-\\u085b\\u08e3-\\u0902\\u093a\\u093c' + '\\u0941-\\u0948\\u094d\\u0951-\\u0957\\u0962-\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2-\\u09e3' + '\\u0a01-\\u0a02\\u0a3c\\u0a41-\\u0a42\\u0a47-\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70-\\u0a71\\u0a75\\u0a81-\\u0a82\\u0abc' + '\\u0ac1-\\u0ac5\\u0ac7-\\u0ac8\\u0acd\\u0ae2-\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57' + '\\u0b62-\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c00\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55-\\u0c56' + '\\u0c62-\\u0c63\\u0c81\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc-\\u0ccd\\u0cd5-\\u0cd6\\u0ce2-\\u0ce3\\u0d01\\u0d3e\\u0d41-\\u0d44' + '\\u0d4d\\u0d57\\u0d62-\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9' + '\\u0ebb-\\u0ebc\\u0ec8-\\u0ecd\\u0f18-\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97' + '\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039-\\u103a\\u103d-\\u103e\\u1058-\\u1059\\u105e-\\u1060\\u1071-\\u1074' + '\\u1082\\u1085-\\u1086\\u108d\\u109d\\u135d-\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752-\\u1753\\u1772-\\u1773\\u17b4-\\u17b5' + '\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927-\\u1928\\u1932\\u1939-\\u193b\\u1a17-\\u1a18' + '\\u1a1b\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1ab0-\\u1abd\\u1ABE\\u1b00-\\u1b03\\u1b34' + '\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80-\\u1b81\\u1ba2-\\u1ba5\\u1ba8-\\u1ba9\\u1bab-\\u1bad\\u1be6\\u1be8-\\u1be9' + '\\u1bed\\u1bef-\\u1bf1\\u1c2c-\\u1c33\\u1c36-\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1cf4\\u1cf8-\\u1cf9' + '\\u1dc0-\\u1df5\\u1dfc-\\u1dff\\u200c-\\u200d\\u20d0-\\u20dc\\u20DD-\\u20E0\\u20e1\\u20E2-\\u20E4\\u20e5-\\u20f0\\u2cef-\\u2cf1' + '\\u2d7f\\u2de0-\\u2dff\\u302a-\\u302d\\u302e-\\u302f\\u3099-\\u309a\\ua66f\\uA670-\\uA672\\ua674-\\ua67d\\ua69e-\\ua69f\\ua6f0-\\ua6f1' + '\\ua802\\ua806\\ua80b\\ua825-\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc' + '\\ua9e5\\uaa29-\\uaa2e\\uaa31-\\uaa32\\uaa35-\\uaa36\\uaa43\\uaa4c\\uaa7c\\uaab0\\uaab2-\\uaab4\\uaab7-\\uaab8\\uaabe-\\uaabf\\uaac1' + '\\uaaec-\\uaaed\\uaaf6\\uabe5\\uabe8\\uabed\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe2f\\uff9e-\\uff9f]');\n\n  var isExtendingChar = function (ch) {\n    return typeof ch === 'string' && ch.charCodeAt(0) >= 768 && extendingChars.test(ch);\n  };\n\n  var or = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return function (x) {\n      for (var i = 0; i < args.length; i++) {\n        if (args[i](x)) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n  };\n\n  var and = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return function (x) {\n      for (var i = 0; i < args.length; i++) {\n        if (!args[i](x)) {\n          return false;\n        }\n      }\n\n      return true;\n    };\n  };\n\n  var isElement$3 = isElement$1;\n  var isCaretCandidate$1 = isCaretCandidate;\n  var isBlock$1 = matchStyleValues('display', 'block table');\n  var isFloated = matchStyleValues('float', 'left right');\n  var isValidElementCaretCandidate = and(isElement$3, isCaretCandidate$1, not(isFloated));\n  var isNotPre = not(matchStyleValues('white-space', 'pre pre-line pre-wrap'));\n  var isText$4 = isText$1;\n  var isBr$3 = isBr;\n  var nodeIndex = DOMUtils$1.nodeIndex;\n  var resolveIndex = getNode;\n\n  var createRange = function (doc) {\n    return 'createRange' in doc ? doc.createRange() : DOMUtils$1.DOM.createRng();\n  };\n\n  var isWhiteSpace = function (chr) {\n    return chr && /[\\r\\n\\t ]/.test(chr);\n  };\n\n  var isRange = function (rng) {\n    return !!rng.setStart && !!rng.setEnd;\n  };\n\n  var isHiddenWhiteSpaceRange = function (range) {\n    var container = range.startContainer;\n    var offset = range.startOffset;\n    var text;\n\n    if (isWhiteSpace(range.toString()) && isNotPre(container.parentNode) && isText$1(container)) {\n      text = container.data;\n\n      if (isWhiteSpace(text[offset - 1]) || isWhiteSpace(text[offset + 1])) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var getBrClientRect = function (brNode) {\n    var doc = brNode.ownerDocument;\n    var rng = createRange(doc);\n    var nbsp$1 = doc.createTextNode(nbsp);\n    var parentNode = brNode.parentNode;\n    parentNode.insertBefore(nbsp$1, brNode);\n    rng.setStart(nbsp$1, 0);\n    rng.setEnd(nbsp$1, 1);\n    var clientRect = clone$2(rng.getBoundingClientRect());\n    parentNode.removeChild(nbsp$1);\n    return clientRect;\n  };\n\n  var getBoundingClientRectWebKitText = function (rng) {\n    var sc = rng.startContainer;\n    var ec = rng.endContainer;\n    var so = rng.startOffset;\n    var eo = rng.endOffset;\n\n    if (sc === ec && isText$1(ec) && so === 0 && eo === 1) {\n      var newRng = rng.cloneRange();\n      newRng.setEndAfter(ec);\n      return getBoundingClientRect(newRng);\n    } else {\n      return null;\n    }\n  };\n\n  var isZeroRect = function (r) {\n    return r.left === 0 && r.right === 0 && r.top === 0 && r.bottom === 0;\n  };\n\n  var getBoundingClientRect = function (item) {\n    var clientRect;\n    var clientRects = item.getClientRects();\n\n    if (clientRects.length > 0) {\n      clientRect = clone$2(clientRects[0]);\n    } else {\n      clientRect = clone$2(item.getBoundingClientRect());\n    }\n\n    if (!isRange(item) && isBr$3(item) && isZeroRect(clientRect)) {\n      return getBrClientRect(item);\n    }\n\n    if (isZeroRect(clientRect) && isRange(item)) {\n      return getBoundingClientRectWebKitText(item);\n    }\n\n    return clientRect;\n  };\n\n  var collapseAndInflateWidth = function (clientRect, toStart) {\n    var newClientRect = collapse(clientRect, toStart);\n    newClientRect.width = 1;\n    newClientRect.right = newClientRect.left + 1;\n    return newClientRect;\n  };\n\n  var getCaretPositionClientRects = function (caretPosition) {\n    var clientRects = [];\n    var beforeNode, node;\n\n    var addUniqueAndValidRect = function (clientRect) {\n      if (clientRect.height === 0) {\n        return;\n      }\n\n      if (clientRects.length > 0) {\n        if (isEqual(clientRect, clientRects[clientRects.length - 1])) {\n          return;\n        }\n      }\n\n      clientRects.push(clientRect);\n    };\n\n    var addCharacterOffset = function (container, offset) {\n      var range = createRange(container.ownerDocument);\n\n      if (offset < container.data.length) {\n        if (isExtendingChar(container.data[offset])) {\n          return clientRects;\n        }\n\n        if (isExtendingChar(container.data[offset - 1])) {\n          range.setStart(container, offset);\n          range.setEnd(container, offset + 1);\n\n          if (!isHiddenWhiteSpaceRange(range)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n            return clientRects;\n          }\n        }\n      }\n\n      if (offset > 0) {\n        range.setStart(container, offset - 1);\n        range.setEnd(container, offset);\n\n        if (!isHiddenWhiteSpaceRange(range)) {\n          addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n        }\n      }\n\n      if (offset < container.data.length) {\n        range.setStart(container, offset);\n        range.setEnd(container, offset + 1);\n\n        if (!isHiddenWhiteSpaceRange(range)) {\n          addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), true));\n        }\n      }\n    };\n\n    if (isText$4(caretPosition.container())) {\n      addCharacterOffset(caretPosition.container(), caretPosition.offset());\n      return clientRects;\n    }\n\n    if (isElement$3(caretPosition.container())) {\n      if (caretPosition.isAtEnd()) {\n        node = resolveIndex(caretPosition.container(), caretPosition.offset());\n\n        if (isText$4(node)) {\n          addCharacterOffset(node, node.data.length);\n        }\n\n        if (isValidElementCaretCandidate(node) && !isBr$3(node)) {\n          addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n        }\n      } else {\n        node = resolveIndex(caretPosition.container(), caretPosition.offset());\n\n        if (isText$4(node)) {\n          addCharacterOffset(node, 0);\n        }\n\n        if (isValidElementCaretCandidate(node) && caretPosition.isAtEnd()) {\n          addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n          return clientRects;\n        }\n\n        beforeNode = resolveIndex(caretPosition.container(), caretPosition.offset() - 1);\n\n        if (isValidElementCaretCandidate(beforeNode) && !isBr$3(beforeNode)) {\n          if (isBlock$1(beforeNode) || isBlock$1(node) || !isValidElementCaretCandidate(node)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode), false));\n          }\n        }\n\n        if (isValidElementCaretCandidate(node)) {\n          addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), true));\n        }\n      }\n    }\n\n    return clientRects;\n  };\n\n  function CaretPosition(container, offset, clientRects) {\n    var isAtStart = function () {\n      if (isText$4(container)) {\n        return offset === 0;\n      }\n\n      return offset === 0;\n    };\n\n    var isAtEnd = function () {\n      if (isText$4(container)) {\n        return offset >= container.data.length;\n      }\n\n      return offset >= container.childNodes.length;\n    };\n\n    var toRange = function () {\n      var range = createRange(container.ownerDocument);\n      range.setStart(container, offset);\n      range.setEnd(container, offset);\n      return range;\n    };\n\n    var getClientRects = function () {\n      if (!clientRects) {\n        clientRects = getCaretPositionClientRects(CaretPosition(container, offset));\n      }\n\n      return clientRects;\n    };\n\n    var isVisible = function () {\n      return getClientRects().length > 0;\n    };\n\n    var isEqual = function (caretPosition) {\n      return caretPosition && container === caretPosition.container() && offset === caretPosition.offset();\n    };\n\n    var getNode = function (before) {\n      return resolveIndex(container, before ? offset - 1 : offset);\n    };\n\n    return {\n      container: constant(container),\n      offset: constant(offset),\n      toRange: toRange,\n      getClientRects: getClientRects,\n      isVisible: isVisible,\n      isAtStart: isAtStart,\n      isAtEnd: isAtEnd,\n      isEqual: isEqual,\n      getNode: getNode\n    };\n  }\n\n  (function (CaretPosition) {\n    CaretPosition.fromRangeStart = function (range) {\n      return CaretPosition(range.startContainer, range.startOffset);\n    };\n\n    CaretPosition.fromRangeEnd = function (range) {\n      return CaretPosition(range.endContainer, range.endOffset);\n    };\n\n    CaretPosition.after = function (node) {\n      return CaretPosition(node.parentNode, nodeIndex(node) + 1);\n    };\n\n    CaretPosition.before = function (node) {\n      return CaretPosition(node.parentNode, nodeIndex(node));\n    };\n\n    CaretPosition.isAbove = function (pos1, pos2) {\n      return lift2(head(pos2.getClientRects()), last(pos1.getClientRects()), isAbove).getOr(false);\n    };\n\n    CaretPosition.isBelow = function (pos1, pos2) {\n      return lift2(last(pos2.getClientRects()), head(pos1.getClientRects()), isBelow).getOr(false);\n    };\n\n    CaretPosition.isAtStart = function (pos) {\n      return pos ? pos.isAtStart() : false;\n    };\n\n    CaretPosition.isAtEnd = function (pos) {\n      return pos ? pos.isAtEnd() : false;\n    };\n\n    CaretPosition.isTextPosition = function (pos) {\n      return pos ? isText$1(pos.container()) : false;\n    };\n\n    CaretPosition.isElementPosition = function (pos) {\n      return CaretPosition.isTextPosition(pos) === false;\n    };\n  })(CaretPosition || (CaretPosition = {}));\n\n  var CaretPosition$1 = CaretPosition;\n\n  var trimEmptyTextNode = function (dom, node) {\n    if (isText$1(node) && node.data.length === 0) {\n      dom.remove(node);\n    }\n  };\n\n  var insertNode = function (dom, rng, node) {\n    rng.insertNode(node);\n    trimEmptyTextNode(dom, node.previousSibling);\n    trimEmptyTextNode(dom, node.nextSibling);\n  };\n\n  var insertFragment = function (dom, rng, frag) {\n    var firstChild = Optional.from(frag.firstChild);\n    var lastChild = Optional.from(frag.lastChild);\n    rng.insertNode(frag);\n    firstChild.each(function (child) {\n      return trimEmptyTextNode(dom, child.previousSibling);\n    });\n    lastChild.each(function (child) {\n      return trimEmptyTextNode(dom, child.nextSibling);\n    });\n  };\n\n  var rangeInsertNode = function (dom, rng, node) {\n    if (isDocumentFragment$1(node)) {\n      insertFragment(dom, rng, node);\n    } else {\n      insertNode(dom, rng, node);\n    }\n  };\n\n  var isText$5 = isText$1;\n  var isBogus$2 = isBogus;\n  var nodeIndex$1 = DOMUtils$1.nodeIndex;\n\n  var normalizedParent = function (node) {\n    var parentNode = node.parentNode;\n\n    if (isBogus$2(parentNode)) {\n      return normalizedParent(parentNode);\n    }\n\n    return parentNode;\n  };\n\n  var getChildNodes = function (node) {\n    if (!node) {\n      return [];\n    }\n\n    return reduce(node.childNodes, function (result, node) {\n      if (isBogus$2(node) && node.nodeName !== 'BR') {\n        result = result.concat(getChildNodes(node));\n      } else {\n        result.push(node);\n      }\n\n      return result;\n    }, []);\n  };\n\n  var normalizedTextOffset = function (node, offset) {\n    while (node = node.previousSibling) {\n      if (!isText$5(node)) {\n        break;\n      }\n\n      offset += node.data.length;\n    }\n\n    return offset;\n  };\n\n  var equal$1 = function (a) {\n    return function (b) {\n      return a === b;\n    };\n  };\n\n  var normalizedNodeIndex = function (node) {\n    var nodes, index;\n    nodes = getChildNodes(normalizedParent(node));\n    index = findIndex$1(nodes, equal$1(node), node);\n    nodes = nodes.slice(0, index + 1);\n    var numTextFragments = reduce(nodes, function (result, node, i) {\n      if (isText$5(node) && isText$5(nodes[i - 1])) {\n        result++;\n      }\n\n      return result;\n    }, 0);\n    nodes = filter$2(nodes, matchNodeNames([node.nodeName]));\n    index = findIndex$1(nodes, equal$1(node), node);\n    return index - numTextFragments;\n  };\n\n  var createPathItem = function (node) {\n    var name;\n\n    if (isText$5(node)) {\n      name = 'text()';\n    } else {\n      name = node.nodeName.toLowerCase();\n    }\n\n    return name + '[' + normalizedNodeIndex(node) + ']';\n  };\n\n  var parentsUntil = function (root, node, predicate) {\n    var parents = [];\n\n    for (node = node.parentNode; node !== root; node = node.parentNode) {\n      if (predicate && predicate(node)) {\n        break;\n      }\n\n      parents.push(node);\n    }\n\n    return parents;\n  };\n\n  var create$3 = function (root, caretPosition) {\n    var container,\n        offset,\n        path = [],\n        outputOffset,\n        childNodes,\n        parents;\n    container = caretPosition.container();\n    offset = caretPosition.offset();\n\n    if (isText$5(container)) {\n      outputOffset = normalizedTextOffset(container, offset);\n    } else {\n      childNodes = container.childNodes;\n\n      if (offset >= childNodes.length) {\n        outputOffset = 'after';\n        offset = childNodes.length - 1;\n      } else {\n        outputOffset = 'before';\n      }\n\n      container = childNodes[offset];\n    }\n\n    path.push(createPathItem(container));\n    parents = parentsUntil(root, container);\n    parents = filter$2(parents, not(isBogus));\n    path = path.concat(map$2(parents, function (node) {\n      return createPathItem(node);\n    }));\n    return path.reverse().join('/') + ',' + outputOffset;\n  };\n\n  var resolvePathItem = function (node, name, index) {\n    var nodes = getChildNodes(node);\n    nodes = filter$2(nodes, function (node, index) {\n      return !isText$5(node) || !isText$5(nodes[index - 1]);\n    });\n    nodes = filter$2(nodes, matchNodeNames([name]));\n    return nodes[index];\n  };\n\n  var findTextPosition = function (container, offset) {\n    var node = container,\n        targetOffset = 0,\n        dataLen;\n\n    while (isText$5(node)) {\n      dataLen = node.data.length;\n\n      if (offset >= targetOffset && offset <= targetOffset + dataLen) {\n        container = node;\n        offset = offset - targetOffset;\n        break;\n      }\n\n      if (!isText$5(node.nextSibling)) {\n        container = node;\n        offset = dataLen;\n        break;\n      }\n\n      targetOffset += dataLen;\n      node = node.nextSibling;\n    }\n\n    if (isText$5(container) && offset > container.data.length) {\n      offset = container.data.length;\n    }\n\n    return CaretPosition$1(container, offset);\n  };\n\n  var resolve$1 = function (root, path) {\n    var offset;\n\n    if (!path) {\n      return null;\n    }\n\n    var parts = path.split(',');\n    var paths = parts[0].split('/');\n    offset = parts.length > 1 ? parts[1] : 'before';\n    var container = reduce(paths, function (result, value) {\n      var match = /([\\w\\-\\(\\)]+)\\[([0-9]+)\\]/.exec(value);\n\n      if (!match) {\n        return null;\n      }\n\n      if (match[1] === 'text()') {\n        match[1] = '#text';\n      }\n\n      return resolvePathItem(result, match[1], parseInt(match[2], 10));\n    }, root);\n\n    if (!container) {\n      return null;\n    }\n\n    if (!isText$5(container)) {\n      if (offset === 'after') {\n        offset = nodeIndex$1(container) + 1;\n      } else {\n        offset = nodeIndex$1(container);\n      }\n\n      return CaretPosition$1(container.parentNode, offset);\n    }\n\n    return findTextPosition(container, parseInt(offset, 10));\n  };\n\n  var isContentEditableFalse$2 = isContentEditableFalse;\n\n  var getNormalizedTextOffset = function (trim, container, offset) {\n    var node, trimmedOffset;\n    trimmedOffset = trim(container.data.slice(0, offset)).length;\n\n    for (node = container.previousSibling; node && isText$1(node); node = node.previousSibling) {\n      trimmedOffset += trim(node.data).length;\n    }\n\n    return trimmedOffset;\n  };\n\n  var getPoint = function (dom, trim, normalized, rng, start) {\n    var container = rng[start ? 'startContainer' : 'endContainer'];\n    var offset = rng[start ? 'startOffset' : 'endOffset'];\n    var point = [];\n    var childNodes,\n        after = 0;\n    var root = dom.getRoot();\n\n    if (isText$1(container)) {\n      point.push(normalized ? getNormalizedTextOffset(trim, container, offset) : offset);\n    } else {\n      childNodes = container.childNodes;\n\n      if (offset >= childNodes.length && childNodes.length) {\n        after = 1;\n        offset = Math.max(0, childNodes.length - 1);\n      }\n\n      point.push(dom.nodeIndex(childNodes[offset], normalized) + after);\n    }\n\n    for (; container && container !== root; container = container.parentNode) {\n      point.push(dom.nodeIndex(container, normalized));\n    }\n\n    return point;\n  };\n\n  var getLocation = function (trim, selection, normalized, rng) {\n    var dom = selection.dom,\n        bookmark = {};\n    bookmark.start = getPoint(dom, trim, normalized, rng, true);\n\n    if (!selection.isCollapsed()) {\n      bookmark.end = getPoint(dom, trim, normalized, rng, false);\n    }\n\n    return bookmark;\n  };\n\n  var findIndex$2 = function (dom, name, element) {\n    var count = 0;\n    Tools.each(dom.select(name), function (node) {\n      if (node.getAttribute('data-mce-bogus') === 'all') {\n        return;\n      }\n\n      if (node === element) {\n        return false;\n      }\n\n      count++;\n    });\n    return count;\n  };\n\n  var moveEndPoint = function (rng, start) {\n    var container, offset, childNodes;\n    var prefix = start ? 'start' : 'end';\n    container = rng[prefix + 'Container'];\n    offset = rng[prefix + 'Offset'];\n\n    if (isElement$1(container) && container.nodeName === 'TR') {\n      childNodes = container.childNodes;\n      container = childNodes[Math.min(start ? offset : offset - 1, childNodes.length - 1)];\n\n      if (container) {\n        offset = start ? 0 : container.childNodes.length;\n        rng['set' + (start ? 'Start' : 'End')](container, offset);\n      }\n    }\n  };\n\n  var normalizeTableCellSelection = function (rng) {\n    moveEndPoint(rng, true);\n    moveEndPoint(rng, false);\n    return rng;\n  };\n\n  var findSibling = function (node, offset) {\n    var sibling;\n\n    if (isElement$1(node)) {\n      node = getNode(node, offset);\n\n      if (isContentEditableFalse$2(node)) {\n        return node;\n      }\n    }\n\n    if (isCaretContainer(node)) {\n      if (isText$1(node) && isCaretContainerBlock(node)) {\n        node = node.parentNode;\n      }\n\n      sibling = node.previousSibling;\n\n      if (isContentEditableFalse$2(sibling)) {\n        return sibling;\n      }\n\n      sibling = node.nextSibling;\n\n      if (isContentEditableFalse$2(sibling)) {\n        return sibling;\n      }\n    }\n  };\n\n  var findAdjacentContentEditableFalseElm = function (rng) {\n    return findSibling(rng.startContainer, rng.startOffset) || findSibling(rng.endContainer, rng.endOffset);\n  };\n\n  var getOffsetBookmark = function (trim, normalized, selection) {\n    var element = selection.getNode();\n    var name = element ? element.nodeName : null;\n    var rng = selection.getRng();\n\n    if (isContentEditableFalse$2(element) || name === 'IMG') {\n      return {\n        name: name,\n        index: findIndex$2(selection.dom, name, element)\n      };\n    }\n\n    var sibling = findAdjacentContentEditableFalseElm(rng);\n\n    if (sibling) {\n      name = sibling.tagName;\n      return {\n        name: name,\n        index: findIndex$2(selection.dom, name, sibling)\n      };\n    }\n\n    return getLocation(trim, selection, normalized, rng);\n  };\n\n  var getCaretBookmark = function (selection) {\n    var rng = selection.getRng();\n    return {\n      start: create$3(selection.dom.getRoot(), CaretPosition$1.fromRangeStart(rng)),\n      end: create$3(selection.dom.getRoot(), CaretPosition$1.fromRangeEnd(rng))\n    };\n  };\n\n  var getRangeBookmark = function (selection) {\n    return {\n      rng: selection.getRng()\n    };\n  };\n\n  var createBookmarkSpan = function (dom, id, filled) {\n    var args = {\n      'data-mce-type': 'bookmark',\n      id: id,\n      'style': 'overflow:hidden;line-height:0px'\n    };\n    return filled ? dom.create('span', args, '&#xFEFF;') : dom.create('span', args);\n  };\n\n  var getPersistentBookmark = function (selection, filled) {\n    var dom = selection.dom;\n    var rng = selection.getRng();\n    var id = dom.uniqueId();\n    var collapsed = selection.isCollapsed();\n    var element = selection.getNode();\n    var name = element.nodeName;\n\n    if (name === 'IMG') {\n      return {\n        name: name,\n        index: findIndex$2(dom, name, element)\n      };\n    }\n\n    var rng2 = normalizeTableCellSelection(rng.cloneRange());\n\n    if (!collapsed) {\n      rng2.collapse(false);\n      var endBookmarkNode = createBookmarkSpan(dom, id + '_end', filled);\n      rangeInsertNode(dom, rng2, endBookmarkNode);\n    }\n\n    rng = normalizeTableCellSelection(rng);\n    rng.collapse(true);\n    var startBookmarkNode = createBookmarkSpan(dom, id + '_start', filled);\n    rangeInsertNode(dom, rng, startBookmarkNode);\n    selection.moveToBookmark({\n      id: id,\n      keep: true\n    });\n    return {\n      id: id\n    };\n  };\n\n  var getBookmark = function (selection, type, normalized) {\n    if (type === 2) {\n      return getOffsetBookmark(trim$2, normalized, selection);\n    } else if (type === 3) {\n      return getCaretBookmark(selection);\n    } else if (type) {\n      return getRangeBookmark(selection);\n    } else {\n      return getPersistentBookmark(selection, false);\n    }\n  };\n\n  var getUndoBookmark = curry(getOffsetBookmark, identity, true);\n  var DOM$1 = DOMUtils$1.DOM;\n  var defaultPreviewStyles = 'font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow';\n\n  var getBodySetting = function (editor, name, defaultValue) {\n    var value = editor.getParam(name, defaultValue);\n\n    if (value.indexOf('=') !== -1) {\n      var bodyObj = editor.getParam(name, '', 'hash');\n      return bodyObj.hasOwnProperty(editor.id) ? bodyObj[editor.id] : defaultValue;\n    } else {\n      return value;\n    }\n  };\n\n  var getIframeAttrs = function (editor) {\n    return editor.getParam('iframe_attrs', {});\n  };\n\n  var getDocType = function (editor) {\n    return editor.getParam('doctype', '<!DOCTYPE html>');\n  };\n\n  var getDocumentBaseUrl = function (editor) {\n    return editor.getParam('document_base_url', '');\n  };\n\n  var getBodyId = function (editor) {\n    return getBodySetting(editor, 'body_id', 'tinymce');\n  };\n\n  var getBodyClass = function (editor) {\n    return getBodySetting(editor, 'body_class', '');\n  };\n\n  var getContentSecurityPolicy = function (editor) {\n    return editor.getParam('content_security_policy', '');\n  };\n\n  var shouldPutBrInPre = function (editor) {\n    return editor.getParam('br_in_pre', true);\n  };\n\n  var getForcedRootBlock = function (editor) {\n    if (editor.getParam('force_p_newlines', false)) {\n      return 'p';\n    }\n\n    var block = editor.getParam('forced_root_block', 'p');\n\n    if (block === false) {\n      return '';\n    } else if (block === true) {\n      return 'p';\n    } else {\n      return block;\n    }\n  };\n\n  var getForcedRootBlockAttrs = function (editor) {\n    return editor.getParam('forced_root_block_attrs', {});\n  };\n\n  var getBrNewLineSelector = function (editor) {\n    return editor.getParam('br_newline_selector', '.mce-toc h2,figcaption,caption');\n  };\n\n  var getNoNewLineSelector = function (editor) {\n    return editor.getParam('no_newline_selector', '');\n  };\n\n  var shouldKeepStyles = function (editor) {\n    return editor.getParam('keep_styles', true);\n  };\n\n  var shouldEndContainerOnEmptyBlock = function (editor) {\n    return editor.getParam('end_container_on_empty_block', false);\n  };\n\n  var getFontStyleValues = function (editor) {\n    return Tools.explode(editor.getParam('font_size_style_values', 'xx-small,x-small,small,medium,large,x-large,xx-large'));\n  };\n\n  var getFontSizeClasses = function (editor) {\n    return Tools.explode(editor.getParam('font_size_classes', ''));\n  };\n\n  var getImagesDataImgFilter = function (editor) {\n    return editor.getParam('images_dataimg_filter', always, 'function');\n  };\n\n  var isAutomaticUploadsEnabled = function (editor) {\n    return editor.getParam('automatic_uploads', true, 'boolean');\n  };\n\n  var shouldReuseFileName = function (editor) {\n    return editor.getParam('images_reuse_filename', false, 'boolean');\n  };\n\n  var shouldReplaceBlobUris = function (editor) {\n    return editor.getParam('images_replace_blob_uris', true, 'boolean');\n  };\n\n  var getIconPackName = function (editor) {\n    return editor.getParam('icons', '', 'string');\n  };\n\n  var getIconsUrl = function (editor) {\n    return editor.getParam('icons_url', '', 'string');\n  };\n\n  var getImageUploadUrl = function (editor) {\n    return editor.getParam('images_upload_url', '', 'string');\n  };\n\n  var getImageUploadBasePath = function (editor) {\n    return editor.getParam('images_upload_base_path', '', 'string');\n  };\n\n  var getImagesUploadCredentials = function (editor) {\n    return editor.getParam('images_upload_credentials', false, 'boolean');\n  };\n\n  var getImagesUploadHandler = function (editor) {\n    return editor.getParam('images_upload_handler', null, 'function');\n  };\n\n  var shouldUseContentCssCors = function (editor) {\n    return editor.getParam('content_css_cors', false, 'boolean');\n  };\n\n  var getReferrerPolicy = function (editor) {\n    return editor.getParam('referrer_policy', '', 'string');\n  };\n\n  var getLanguageCode = function (editor) {\n    return editor.getParam('language', 'en', 'string');\n  };\n\n  var getLanguageUrl = function (editor) {\n    return editor.getParam('language_url', '', 'string');\n  };\n\n  var shouldIndentUseMargin = function (editor) {\n    return editor.getParam('indent_use_margin', false);\n  };\n\n  var getIndentation = function (editor) {\n    return editor.getParam('indentation', '40px', 'string');\n  };\n\n  var getContentCss = function (editor) {\n    var contentCss = editor.getParam('content_css');\n\n    if (isString(contentCss)) {\n      return map(contentCss.split(','), trim);\n    } else if (isArray(contentCss)) {\n      return contentCss;\n    } else if (contentCss === false || editor.inline) {\n      return [];\n    } else {\n      return ['default'];\n    }\n  };\n\n  var getDirectionality = function (editor) {\n    return editor.getParam('directionality', I18n.isRtl() ? 'rtl' : undefined);\n  };\n\n  var getInlineBoundarySelector = function (editor) {\n    return editor.getParam('inline_boundaries_selector', 'a[href],code,.mce-annotation', 'string');\n  };\n\n  var getObjectResizing = function (editor) {\n    var selector = editor.getParam('object_resizing');\n\n    if (selector === false || Env.iOS) {\n      return false;\n    } else {\n      return isString(selector) ? selector : 'table,img,figure.image,div';\n    }\n  };\n\n  var getResizeImgProportional = function (editor) {\n    return editor.getParam('resize_img_proportional', true, 'boolean');\n  };\n\n  var getPlaceholder = function (editor) {\n    return editor.getParam('placeholder', DOM$1.getAttrib(editor.getElement(), 'placeholder'), 'string');\n  };\n\n  var getEventRoot = function (editor) {\n    return editor.getParam('event_root');\n  };\n\n  var getServiceMessage = function (editor) {\n    return editor.getParam('service_message');\n  };\n\n  var getTheme = function (editor) {\n    return editor.getParam('theme');\n  };\n\n  var shouldValidate = function (editor) {\n    return editor.getParam('validate');\n  };\n\n  var isInlineBoundariesEnabled = function (editor) {\n    return editor.getParam('inline_boundaries') !== false;\n  };\n\n  var getFormats = function (editor) {\n    return editor.getParam('formats');\n  };\n\n  var getPreviewStyles = function (editor) {\n    var style = editor.getParam('preview_styles', defaultPreviewStyles);\n\n    if (isString(style)) {\n      return style;\n    } else {\n      return '';\n    }\n  };\n\n  var canFormatEmptyLines = function (editor) {\n    return editor.getParam('format_empty_lines', false, 'boolean');\n  };\n\n  var getCustomUiSelector = function (editor) {\n    return editor.getParam('custom_ui_selector', '', 'string');\n  };\n\n  var getThemeUrl = function (editor) {\n    return editor.getParam('theme_url');\n  };\n\n  var isInline$1 = function (editor) {\n    return editor.getParam('inline');\n  };\n\n  var hasHiddenInput = function (editor) {\n    return editor.getParam('hidden_input');\n  };\n\n  var shouldPatchSubmit = function (editor) {\n    return editor.getParam('submit_patch');\n  };\n\n  var isEncodingXml = function (editor) {\n    return editor.getParam('encoding') === 'xml';\n  };\n\n  var shouldAddFormSubmitTrigger = function (editor) {\n    return editor.getParam('add_form_submit_trigger');\n  };\n\n  var shouldAddUnloadTrigger = function (editor) {\n    return editor.getParam('add_unload_trigger');\n  };\n\n  var hasForcedRootBlock = function (editor) {\n    return getForcedRootBlock(editor) !== '';\n  };\n\n  var getCustomUndoRedoLevels = function (editor) {\n    return editor.getParam('custom_undo_redo_levels', 0, 'number');\n  };\n\n  var shouldDisableNodeChange = function (editor) {\n    return editor.getParam('disable_nodechange');\n  };\n\n  var isReadOnly = function (editor) {\n    return editor.getParam('readonly');\n  };\n\n  var hasContentCssCors = function (editor) {\n    return editor.getParam('content_css_cors');\n  };\n\n  var getPlugins = function (editor) {\n    return editor.getParam('plugins', '', 'string');\n  };\n\n  var getExternalPlugins = function (editor) {\n    return editor.getParam('external_plugins');\n  };\n\n  var shouldBlockUnsupportedDrop = function (editor) {\n    return editor.getParam('block_unsupported_drop', true, 'boolean');\n  };\n\n  var isVisualAidsEnabled = function (editor) {\n    return editor.getParam('visual', true, 'boolean');\n  };\n\n  var getVisualAidsTableClass = function (editor) {\n    return editor.getParam('visual_table_class', 'mce-item-table', 'string');\n  };\n\n  var getVisualAidsAnchorClass = function (editor) {\n    return editor.getParam('visual_anchor_class', 'mce-item-anchor', 'string');\n  };\n\n  var isElement$4 = isElement$1;\n  var isText$6 = isText$1;\n\n  var removeNode = function (node) {\n    var parentNode = node.parentNode;\n\n    if (parentNode) {\n      parentNode.removeChild(node);\n    }\n  };\n\n  var trimCount = function (text) {\n    var trimmedText = trim$2(text);\n    return {\n      count: text.length - trimmedText.length,\n      text: trimmedText\n    };\n  };\n\n  var deleteZwspChars = function (caretContainer) {\n    var idx;\n\n    while ((idx = caretContainer.data.lastIndexOf(ZWSP)) !== -1) {\n      caretContainer.deleteData(idx, 1);\n    }\n  };\n\n  var removeUnchanged = function (caretContainer, pos) {\n    remove$5(caretContainer);\n    return pos;\n  };\n\n  var removeTextAndReposition = function (caretContainer, pos) {\n    var before = trimCount(caretContainer.data.substr(0, pos.offset()));\n    var after = trimCount(caretContainer.data.substr(pos.offset()));\n    var text = before.text + after.text;\n\n    if (text.length > 0) {\n      deleteZwspChars(caretContainer);\n      return CaretPosition$1(caretContainer, pos.offset() - before.count);\n    } else {\n      return pos;\n    }\n  };\n\n  var removeElementAndReposition = function (caretContainer, pos) {\n    var parentNode = pos.container();\n    var newPosition = indexOf(from$1(parentNode.childNodes), caretContainer).map(function (index) {\n      return index < pos.offset() ? CaretPosition$1(parentNode, pos.offset() - 1) : pos;\n    }).getOr(pos);\n    remove$5(caretContainer);\n    return newPosition;\n  };\n\n  var removeTextCaretContainer = function (caretContainer, pos) {\n    return isText$6(caretContainer) && pos.container() === caretContainer ? removeTextAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\n  };\n\n  var removeElementCaretContainer = function (caretContainer, pos) {\n    return pos.container() === caretContainer.parentNode ? removeElementAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\n  };\n\n  var removeAndReposition = function (container, pos) {\n    return CaretPosition$1.isTextPosition(pos) ? removeTextCaretContainer(container, pos) : removeElementCaretContainer(container, pos);\n  };\n\n  var remove$5 = function (caretContainerNode) {\n    if (isElement$4(caretContainerNode) && isCaretContainer(caretContainerNode)) {\n      if (hasContent(caretContainerNode)) {\n        caretContainerNode.removeAttribute('data-mce-caret');\n      } else {\n        removeNode(caretContainerNode);\n      }\n    }\n\n    if (isText$6(caretContainerNode)) {\n      deleteZwspChars(caretContainerNode);\n\n      if (caretContainerNode.data.length === 0) {\n        removeNode(caretContainerNode);\n      }\n    }\n  };\n\n  var browser$2 = detect$3().browser;\n  var isContentEditableFalse$3 = isContentEditableFalse;\n  var isMedia$1 = isMedia;\n  var isTableCell$2 = isTableCell;\n  var inlineFakeCaretSelector = '*[contentEditable=false],video,audio,embed,object';\n\n  var getAbsoluteClientRect = function (root, element, before) {\n    var clientRect = collapse(element.getBoundingClientRect(), before);\n    var docElm, scrollX, scrollY, margin, rootRect;\n\n    if (root.tagName === 'BODY') {\n      docElm = root.ownerDocument.documentElement;\n      scrollX = root.scrollLeft || docElm.scrollLeft;\n      scrollY = root.scrollTop || docElm.scrollTop;\n    } else {\n      rootRect = root.getBoundingClientRect();\n      scrollX = root.scrollLeft - rootRect.left;\n      scrollY = root.scrollTop - rootRect.top;\n    }\n\n    clientRect.left += scrollX;\n    clientRect.right += scrollX;\n    clientRect.top += scrollY;\n    clientRect.bottom += scrollY;\n    clientRect.width = 1;\n    margin = element.offsetWidth - element.clientWidth;\n\n    if (margin > 0) {\n      if (before) {\n        margin *= -1;\n      }\n\n      clientRect.left += margin;\n      clientRect.right += margin;\n    }\n\n    return clientRect;\n  };\n\n  var trimInlineCaretContainers = function (root) {\n    var fakeCaretTargetNodes = descendants$1(SugarElement.fromDom(root), inlineFakeCaretSelector);\n\n    for (var i = 0; i < fakeCaretTargetNodes.length; i++) {\n      var node = fakeCaretTargetNodes[i].dom;\n      var sibling = node.previousSibling;\n\n      if (endsWithCaretContainer(sibling)) {\n        var data = sibling.data;\n\n        if (data.length === 1) {\n          sibling.parentNode.removeChild(sibling);\n        } else {\n          sibling.deleteData(data.length - 1, 1);\n        }\n      }\n\n      sibling = node.nextSibling;\n\n      if (startsWithCaretContainer(sibling)) {\n        var data = sibling.data;\n\n        if (data.length === 1) {\n          sibling.parentNode.removeChild(sibling);\n        } else {\n          sibling.deleteData(0, 1);\n        }\n      }\n    }\n  };\n\n  var FakeCaret = function (editor, root, isBlock, hasFocus) {\n    var lastVisualCaret = Cell(Optional.none());\n    var cursorInterval, caretContainerNode;\n    var rootBlock = getForcedRootBlock(editor);\n    var caretBlock = rootBlock.length > 0 ? rootBlock : 'p';\n\n    var show = function (before, element) {\n      var clientRect, rng;\n      hide();\n\n      if (isTableCell$2(element)) {\n        return null;\n      }\n\n      if (isBlock(element)) {\n        caretContainerNode = insertBlock(caretBlock, element, before);\n        clientRect = getAbsoluteClientRect(root, element, before);\n        DomQuery(caretContainerNode).css('top', clientRect.top);\n        var caret = DomQuery('<div class=\"mce-visual-caret\" data-mce-bogus=\"all\"></div>').css(clientRect).appendTo(root)[0];\n        lastVisualCaret.set(Optional.some({\n          caret: caret,\n          element: element,\n          before: before\n        }));\n        lastVisualCaret.get().each(function (caretState) {\n          if (before) {\n            DomQuery(caretState.caret).addClass('mce-visual-caret-before');\n          }\n        });\n        startBlink();\n        rng = element.ownerDocument.createRange();\n        rng.setStart(caretContainerNode, 0);\n        rng.setEnd(caretContainerNode, 0);\n      } else {\n        caretContainerNode = insertInline(element, before);\n        rng = element.ownerDocument.createRange();\n\n        if (isInlineFakeCaretTarget(caretContainerNode.nextSibling)) {\n          rng.setStart(caretContainerNode, 0);\n          rng.setEnd(caretContainerNode, 0);\n        } else {\n          rng.setStart(caretContainerNode, 1);\n          rng.setEnd(caretContainerNode, 1);\n        }\n\n        return rng;\n      }\n\n      return rng;\n    };\n\n    var hide = function () {\n      trimInlineCaretContainers(root);\n\n      if (caretContainerNode) {\n        remove$5(caretContainerNode);\n        caretContainerNode = null;\n      }\n\n      lastVisualCaret.get().each(function (caretState) {\n        DomQuery(caretState.caret).remove();\n        lastVisualCaret.set(Optional.none());\n      });\n\n      if (cursorInterval) {\n        Delay.clearInterval(cursorInterval);\n        cursorInterval = null;\n      }\n    };\n\n    var startBlink = function () {\n      cursorInterval = Delay.setInterval(function () {\n        if (hasFocus()) {\n          DomQuery('div.mce-visual-caret', root).toggleClass('mce-visual-caret-hidden');\n        } else {\n          DomQuery('div.mce-visual-caret', root).addClass('mce-visual-caret-hidden');\n        }\n      }, 500);\n    };\n\n    var reposition = function () {\n      lastVisualCaret.get().each(function (caretState) {\n        var clientRect = getAbsoluteClientRect(root, caretState.element, caretState.before);\n        DomQuery(caretState.caret).css(__assign({}, clientRect));\n      });\n    };\n\n    var destroy = function () {\n      return Delay.clearInterval(cursorInterval);\n    };\n\n    var getCss = function () {\n      return '.mce-visual-caret {' + 'position: absolute;' + 'background-color: black;' + 'background-color: currentcolor;' + '}' + '.mce-visual-caret-hidden {' + 'display: none;' + '}' + '*[data-mce-caret] {' + 'position: absolute;' + 'left: -1000px;' + 'right: auto;' + 'top: 0;' + 'margin: 0;' + 'padding: 0;' + '}';\n    };\n\n    return {\n      show: show,\n      hide: hide,\n      getCss: getCss,\n      reposition: reposition,\n      destroy: destroy\n    };\n  };\n\n  var isFakeCaretTableBrowser = function () {\n    return browser$2.isIE() || browser$2.isEdge() || browser$2.isFirefox();\n  };\n\n  var isInlineFakeCaretTarget = function (node) {\n    return isContentEditableFalse$3(node) || isMedia$1(node);\n  };\n\n  var isFakeCaretTarget = function (node) {\n    return isInlineFakeCaretTarget(node) || isTable(node) && isFakeCaretTableBrowser();\n  };\n\n  var isContentEditableFalse$4 = isContentEditableFalse;\n  var isMedia$2 = isMedia;\n  var isBlockLike = matchStyleValues('display', 'block table table-cell table-caption list-item');\n  var isCaretContainer$2 = isCaretContainer;\n  var isCaretContainerBlock$1 = isCaretContainerBlock;\n  var isElement$5 = isElement$1;\n  var isCaretCandidate$2 = isCaretCandidate;\n\n  var isForwards = function (direction) {\n    return direction > 0;\n  };\n\n  var isBackwards = function (direction) {\n    return direction < 0;\n  };\n\n  var skipCaretContainers = function (walk, shallow) {\n    var node;\n\n    while (node = walk(shallow)) {\n      if (!isCaretContainerBlock$1(node)) {\n        return node;\n      }\n    }\n\n    return null;\n  };\n\n  var findNode = function (node, direction, predicateFn, rootNode, shallow) {\n    var walker = new DomTreeWalker(node, rootNode);\n    var isCefOrCaretContainer = isContentEditableFalse$4(node) || isCaretContainerBlock$1(node);\n\n    if (isBackwards(direction)) {\n      if (isCefOrCaretContainer) {\n        node = skipCaretContainers(walker.prev, true);\n\n        if (predicateFn(node)) {\n          return node;\n        }\n      }\n\n      while (node = skipCaretContainers(walker.prev, shallow)) {\n        if (predicateFn(node)) {\n          return node;\n        }\n      }\n    }\n\n    if (isForwards(direction)) {\n      if (isCefOrCaretContainer) {\n        node = skipCaretContainers(walker.next, true);\n\n        if (predicateFn(node)) {\n          return node;\n        }\n      }\n\n      while (node = skipCaretContainers(walker.next, shallow)) {\n        if (predicateFn(node)) {\n          return node;\n        }\n      }\n    }\n\n    return null;\n  };\n\n  var getParentBlock = function (node, rootNode) {\n    while (node && node !== rootNode) {\n      if (isBlockLike(node)) {\n        return node;\n      }\n\n      node = node.parentNode;\n    }\n\n    return null;\n  };\n\n  var isInSameBlock = function (caretPosition1, caretPosition2, rootNode) {\n    return getParentBlock(caretPosition1.container(), rootNode) === getParentBlock(caretPosition2.container(), rootNode);\n  };\n\n  var getChildNodeAtRelativeOffset = function (relativeOffset, caretPosition) {\n    if (!caretPosition) {\n      return null;\n    }\n\n    var container = caretPosition.container();\n    var offset = caretPosition.offset();\n\n    if (!isElement$5(container)) {\n      return null;\n    }\n\n    return container.childNodes[offset + relativeOffset];\n  };\n\n  var beforeAfter = function (before, node) {\n    var range = node.ownerDocument.createRange();\n\n    if (before) {\n      range.setStartBefore(node);\n      range.setEndBefore(node);\n    } else {\n      range.setStartAfter(node);\n      range.setEndAfter(node);\n    }\n\n    return range;\n  };\n\n  var isNodesInSameBlock = function (root, node1, node2) {\n    return getParentBlock(node1, root) === getParentBlock(node2, root);\n  };\n\n  var lean = function (left, root, node) {\n    var sibling, siblingName;\n\n    if (left) {\n      siblingName = 'previousSibling';\n    } else {\n      siblingName = 'nextSibling';\n    }\n\n    while (node && node !== root) {\n      sibling = node[siblingName];\n\n      if (isCaretContainer$2(sibling)) {\n        sibling = sibling[siblingName];\n      }\n\n      if (isContentEditableFalse$4(sibling) || isMedia$2(sibling)) {\n        if (isNodesInSameBlock(root, sibling, node)) {\n          return sibling;\n        }\n\n        break;\n      }\n\n      if (isCaretCandidate$2(sibling)) {\n        break;\n      }\n\n      node = node.parentNode;\n    }\n\n    return null;\n  };\n\n  var before$2 = curry(beforeAfter, true);\n  var after$1 = curry(beforeAfter, false);\n\n  var normalizeRange = function (direction, root, range) {\n    var node, container, location;\n    var leanLeft = curry(lean, true, root);\n    var leanRight = curry(lean, false, root);\n    container = range.startContainer;\n    var offset = range.startOffset;\n\n    if (isCaretContainerBlock(container)) {\n      if (!isElement$5(container)) {\n        container = container.parentNode;\n      }\n\n      location = container.getAttribute('data-mce-caret');\n\n      if (location === 'before') {\n        node = container.nextSibling;\n\n        if (isFakeCaretTarget(node)) {\n          return before$2(node);\n        }\n      }\n\n      if (location === 'after') {\n        node = container.previousSibling;\n\n        if (isFakeCaretTarget(node)) {\n          return after$1(node);\n        }\n      }\n    }\n\n    if (!range.collapsed) {\n      return range;\n    }\n\n    if (isText$1(container)) {\n      if (isCaretContainer$2(container)) {\n        if (direction === 1) {\n          node = leanRight(container);\n\n          if (node) {\n            return before$2(node);\n          }\n\n          node = leanLeft(container);\n\n          if (node) {\n            return after$1(node);\n          }\n        }\n\n        if (direction === -1) {\n          node = leanLeft(container);\n\n          if (node) {\n            return after$1(node);\n          }\n\n          node = leanRight(container);\n\n          if (node) {\n            return before$2(node);\n          }\n        }\n\n        return range;\n      }\n\n      if (endsWithCaretContainer(container) && offset >= container.data.length - 1) {\n        if (direction === 1) {\n          node = leanRight(container);\n\n          if (node) {\n            return before$2(node);\n          }\n        }\n\n        return range;\n      }\n\n      if (startsWithCaretContainer(container) && offset <= 1) {\n        if (direction === -1) {\n          node = leanLeft(container);\n\n          if (node) {\n            return after$1(node);\n          }\n        }\n\n        return range;\n      }\n\n      if (offset === container.data.length) {\n        node = leanRight(container);\n\n        if (node) {\n          return before$2(node);\n        }\n\n        return range;\n      }\n\n      if (offset === 0) {\n        node = leanLeft(container);\n\n        if (node) {\n          return after$1(node);\n        }\n\n        return range;\n      }\n    }\n\n    return range;\n  };\n\n  var getRelativeCefElm = function (forward, caretPosition) {\n    return Optional.from(getChildNodeAtRelativeOffset(forward ? 0 : -1, caretPosition)).filter(isContentEditableFalse$4);\n  };\n\n  var getNormalizedRangeEndPoint = function (direction, root, range) {\n    var normalizedRange = normalizeRange(direction, root, range);\n\n    if (direction === -1) {\n      return CaretPosition.fromRangeStart(normalizedRange);\n    }\n\n    return CaretPosition.fromRangeEnd(normalizedRange);\n  };\n\n  var getElementFromPosition = function (pos) {\n    return Optional.from(pos.getNode()).map(SugarElement.fromDom);\n  };\n\n  var getElementFromPrevPosition = function (pos) {\n    return Optional.from(pos.getNode(true)).map(SugarElement.fromDom);\n  };\n\n  var getVisualCaretPosition = function (walkFn, caretPosition) {\n    while (caretPosition = walkFn(caretPosition)) {\n      if (caretPosition.isVisible()) {\n        return caretPosition;\n      }\n    }\n\n    return caretPosition;\n  };\n\n  var isMoveInsideSameBlock = function (from, to) {\n    var inSameBlock = isInSameBlock(from, to);\n\n    if (!inSameBlock && isBr(from.getNode())) {\n      return true;\n    }\n\n    return inSameBlock;\n  };\n\n  var HDirection;\n\n  (function (HDirection) {\n    HDirection[HDirection['Backwards'] = -1] = 'Backwards';\n    HDirection[HDirection['Forwards'] = 1] = 'Forwards';\n  })(HDirection || (HDirection = {}));\n\n  var isContentEditableFalse$5 = isContentEditableFalse;\n  var isText$7 = isText$1;\n  var isElement$6 = isElement$1;\n  var isBr$4 = isBr;\n  var isCaretCandidate$3 = isCaretCandidate;\n  var isAtomic$1 = isAtomic;\n  var isEditableCaretCandidate$1 = isEditableCaretCandidate;\n\n  var getParents = function (node, root) {\n    var parents = [];\n\n    while (node && node !== root) {\n      parents.push(node);\n      node = node.parentNode;\n    }\n\n    return parents;\n  };\n\n  var nodeAtIndex = function (container, offset) {\n    if (container.hasChildNodes() && offset < container.childNodes.length) {\n      return container.childNodes[offset];\n    }\n\n    return null;\n  };\n\n  var getCaretCandidatePosition = function (direction, node) {\n    if (isForwards(direction)) {\n      if (isCaretCandidate$3(node.previousSibling) && !isText$7(node.previousSibling)) {\n        return CaretPosition$1.before(node);\n      }\n\n      if (isText$7(node)) {\n        return CaretPosition$1(node, 0);\n      }\n    }\n\n    if (isBackwards(direction)) {\n      if (isCaretCandidate$3(node.nextSibling) && !isText$7(node.nextSibling)) {\n        return CaretPosition$1.after(node);\n      }\n\n      if (isText$7(node)) {\n        return CaretPosition$1(node, node.data.length);\n      }\n    }\n\n    if (isBackwards(direction)) {\n      if (isBr$4(node)) {\n        return CaretPosition$1.before(node);\n      }\n\n      return CaretPosition$1.after(node);\n    }\n\n    return CaretPosition$1.before(node);\n  };\n\n  var moveForwardFromBr = function (root, nextNode) {\n    var nextSibling = nextNode.nextSibling;\n\n    if (nextSibling && isCaretCandidate$3(nextSibling)) {\n      if (isText$7(nextSibling)) {\n        return CaretPosition$1(nextSibling, 0);\n      } else {\n        return CaretPosition$1.before(nextSibling);\n      }\n    } else {\n      return findCaretPosition(HDirection.Forwards, CaretPosition$1.after(nextNode), root);\n    }\n  };\n\n  var findCaretPosition = function (direction, startPos, root) {\n    var node, nextNode, innerNode;\n    var caretPosition;\n\n    if (!isElement$6(root) || !startPos) {\n      return null;\n    }\n\n    if (startPos.isEqual(CaretPosition$1.after(root)) && root.lastChild) {\n      caretPosition = CaretPosition$1.after(root.lastChild);\n\n      if (isBackwards(direction) && isCaretCandidate$3(root.lastChild) && isElement$6(root.lastChild)) {\n        return isBr$4(root.lastChild) ? CaretPosition$1.before(root.lastChild) : caretPosition;\n      }\n    } else {\n      caretPosition = startPos;\n    }\n\n    var container = caretPosition.container();\n    var offset = caretPosition.offset();\n\n    if (isText$7(container)) {\n      if (isBackwards(direction) && offset > 0) {\n        return CaretPosition$1(container, --offset);\n      }\n\n      if (isForwards(direction) && offset < container.length) {\n        return CaretPosition$1(container, ++offset);\n      }\n\n      node = container;\n    } else {\n      if (isBackwards(direction) && offset > 0) {\n        nextNode = nodeAtIndex(container, offset - 1);\n\n        if (isCaretCandidate$3(nextNode)) {\n          if (!isAtomic$1(nextNode)) {\n            innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\n\n            if (innerNode) {\n              if (isText$7(innerNode)) {\n                return CaretPosition$1(innerNode, innerNode.data.length);\n              }\n\n              return CaretPosition$1.after(innerNode);\n            }\n          }\n\n          if (isText$7(nextNode)) {\n            return CaretPosition$1(nextNode, nextNode.data.length);\n          }\n\n          return CaretPosition$1.before(nextNode);\n        }\n      }\n\n      if (isForwards(direction) && offset < container.childNodes.length) {\n        nextNode = nodeAtIndex(container, offset);\n\n        if (isCaretCandidate$3(nextNode)) {\n          if (isBr$4(nextNode)) {\n            return moveForwardFromBr(root, nextNode);\n          }\n\n          if (!isAtomic$1(nextNode)) {\n            innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\n\n            if (innerNode) {\n              if (isText$7(innerNode)) {\n                return CaretPosition$1(innerNode, 0);\n              }\n\n              return CaretPosition$1.before(innerNode);\n            }\n          }\n\n          if (isText$7(nextNode)) {\n            return CaretPosition$1(nextNode, 0);\n          }\n\n          return CaretPosition$1.after(nextNode);\n        }\n      }\n\n      node = nextNode ? nextNode : caretPosition.getNode();\n    }\n\n    if (isForwards(direction) && caretPosition.isAtEnd() || isBackwards(direction) && caretPosition.isAtStart()) {\n      node = findNode(node, direction, always, root, true);\n\n      if (isEditableCaretCandidate$1(node, root)) {\n        return getCaretCandidatePosition(direction, node);\n      }\n    }\n\n    nextNode = findNode(node, direction, isEditableCaretCandidate$1, root);\n    var rootContentEditableFalseElm = last$1(filter(getParents(container, root), isContentEditableFalse$5));\n\n    if (rootContentEditableFalseElm && (!nextNode || !rootContentEditableFalseElm.contains(nextNode))) {\n      if (isForwards(direction)) {\n        caretPosition = CaretPosition$1.after(rootContentEditableFalseElm);\n      } else {\n        caretPosition = CaretPosition$1.before(rootContentEditableFalseElm);\n      }\n\n      return caretPosition;\n    }\n\n    if (nextNode) {\n      return getCaretCandidatePosition(direction, nextNode);\n    }\n\n    return null;\n  };\n\n  var CaretWalker = function (root) {\n    return {\n      next: function (caretPosition) {\n        return findCaretPosition(HDirection.Forwards, caretPosition, root);\n      },\n      prev: function (caretPosition) {\n        return findCaretPosition(HDirection.Backwards, caretPosition, root);\n      }\n    };\n  };\n\n  var walkToPositionIn = function (forward, root, start) {\n    var position = forward ? CaretPosition$1.before(start) : CaretPosition$1.after(start);\n    return fromPosition(forward, root, position);\n  };\n\n  var afterElement = function (node) {\n    return isBr(node) ? CaretPosition$1.before(node) : CaretPosition$1.after(node);\n  };\n\n  var isBeforeOrStart = function (position) {\n    if (CaretPosition$1.isTextPosition(position)) {\n      return position.offset() === 0;\n    } else {\n      return isCaretCandidate(position.getNode());\n    }\n  };\n\n  var isAfterOrEnd = function (position) {\n    if (CaretPosition$1.isTextPosition(position)) {\n      var container = position.container();\n      return position.offset() === container.data.length;\n    } else {\n      return isCaretCandidate(position.getNode(true));\n    }\n  };\n\n  var isBeforeAfterSameElement = function (from, to) {\n    return !CaretPosition$1.isTextPosition(from) && !CaretPosition$1.isTextPosition(to) && from.getNode() === to.getNode(true);\n  };\n\n  var isAtBr = function (position) {\n    return !CaretPosition$1.isTextPosition(position) && isBr(position.getNode());\n  };\n\n  var shouldSkipPosition = function (forward, from, to) {\n    if (forward) {\n      return !isBeforeAfterSameElement(from, to) && !isAtBr(from) && isAfterOrEnd(from) && isBeforeOrStart(to);\n    } else {\n      return !isBeforeAfterSameElement(to, from) && isBeforeOrStart(from) && isAfterOrEnd(to);\n    }\n  };\n\n  var fromPosition = function (forward, root, pos) {\n    var walker = CaretWalker(root);\n    return Optional.from(forward ? walker.next(pos) : walker.prev(pos));\n  };\n\n  var navigate = function (forward, root, from) {\n    return fromPosition(forward, root, from).bind(function (to) {\n      if (isInSameBlock(from, to, root) && shouldSkipPosition(forward, from, to)) {\n        return fromPosition(forward, root, to);\n      } else {\n        return Optional.some(to);\n      }\n    });\n  };\n\n  var navigateIgnore = function (forward, root, from, ignoreFilter) {\n    return navigate(forward, root, from).bind(function (pos) {\n      return ignoreFilter(pos) ? navigateIgnore(forward, root, pos, ignoreFilter) : Optional.some(pos);\n    });\n  };\n\n  var positionIn = function (forward, element) {\n    var startNode = forward ? element.firstChild : element.lastChild;\n\n    if (isText$1(startNode)) {\n      return Optional.some(CaretPosition$1(startNode, forward ? 0 : startNode.data.length));\n    } else if (startNode) {\n      if (isCaretCandidate(startNode)) {\n        return Optional.some(forward ? CaretPosition$1.before(startNode) : afterElement(startNode));\n      } else {\n        return walkToPositionIn(forward, element, startNode);\n      }\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var nextPosition = curry(fromPosition, true);\n  var prevPosition = curry(fromPosition, false);\n  var firstPositionIn = curry(positionIn, true);\n  var lastPositionIn = curry(positionIn, false);\n  var CARET_ID = '_mce_caret';\n\n  var isCaretNode = function (node) {\n    return isElement$1(node) && node.id === CARET_ID;\n  };\n\n  var getParentCaretContainer = function (body, node) {\n    while (node && node !== body) {\n      if (node.id === CARET_ID) {\n        return node;\n      }\n\n      node = node.parentNode;\n    }\n\n    return null;\n  };\n\n  var isStringPathBookmark = function (bookmark) {\n    return typeof bookmark.start === 'string';\n  };\n\n  var isRangeBookmark = function (bookmark) {\n    return bookmark.hasOwnProperty('rng');\n  };\n\n  var isIdBookmark = function (bookmark) {\n    return bookmark.hasOwnProperty('id');\n  };\n\n  var isIndexBookmark = function (bookmark) {\n    return bookmark.hasOwnProperty('name');\n  };\n\n  var isPathBookmark = function (bookmark) {\n    return Tools.isArray(bookmark.start);\n  };\n\n  var addBogus = function (dom, node) {\n    if (isElement$1(node) && dom.isBlock(node) && !node.innerHTML && !Env.ie) {\n      node.innerHTML = '<br data-mce-bogus=\"1\" />';\n    }\n\n    return node;\n  };\n\n  var resolveCaretPositionBookmark = function (dom, bookmark) {\n    var pos;\n    var rng = dom.createRng();\n    pos = resolve$1(dom.getRoot(), bookmark.start);\n    rng.setStart(pos.container(), pos.offset());\n    pos = resolve$1(dom.getRoot(), bookmark.end);\n    rng.setEnd(pos.container(), pos.offset());\n    return rng;\n  };\n\n  var insertZwsp = function (node, rng) {\n    var textNode = node.ownerDocument.createTextNode(ZWSP);\n    node.appendChild(textNode);\n    rng.setStart(textNode, 0);\n    rng.setEnd(textNode, 0);\n  };\n\n  var isEmpty$1 = function (node) {\n    return node.hasChildNodes() === false;\n  };\n\n  var tryFindRangePosition = function (node, rng) {\n    return lastPositionIn(node).fold(function () {\n      return false;\n    }, function (pos) {\n      rng.setStart(pos.container(), pos.offset());\n      rng.setEnd(pos.container(), pos.offset());\n      return true;\n    });\n  };\n\n  var padEmptyCaretContainer = function (root, node, rng) {\n    if (isEmpty$1(node) && getParentCaretContainer(root, node)) {\n      insertZwsp(node, rng);\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  var setEndPoint = function (dom, start, bookmark, rng) {\n    var point = bookmark[start ? 'start' : 'end'];\n    var i, node, offset, children;\n    var root = dom.getRoot();\n\n    if (point) {\n      offset = point[0];\n\n      for (node = root, i = point.length - 1; i >= 1; i--) {\n        children = node.childNodes;\n\n        if (padEmptyCaretContainer(root, node, rng)) {\n          return true;\n        }\n\n        if (point[i] > children.length - 1) {\n          if (padEmptyCaretContainer(root, node, rng)) {\n            return true;\n          }\n\n          return tryFindRangePosition(node, rng);\n        }\n\n        node = children[point[i]];\n      }\n\n      if (node.nodeType === 3) {\n        offset = Math.min(point[0], node.nodeValue.length);\n      }\n\n      if (node.nodeType === 1) {\n        offset = Math.min(point[0], node.childNodes.length);\n      }\n\n      if (start) {\n        rng.setStart(node, offset);\n      } else {\n        rng.setEnd(node, offset);\n      }\n    }\n\n    return true;\n  };\n\n  var isValidTextNode = function (node) {\n    return isText$1(node) && node.data.length > 0;\n  };\n\n  var restoreEndPoint = function (dom, suffix, bookmark) {\n    var marker = dom.get(bookmark.id + '_' + suffix),\n        node,\n        idx,\n        next,\n        prev;\n    var keep = bookmark.keep;\n    var container, offset;\n\n    if (marker) {\n      node = marker.parentNode;\n\n      if (suffix === 'start') {\n        if (!keep) {\n          idx = dom.nodeIndex(marker);\n        } else {\n          if (marker.hasChildNodes()) {\n            node = marker.firstChild;\n            idx = 1;\n          } else if (isValidTextNode(marker.nextSibling)) {\n            node = marker.nextSibling;\n            idx = 0;\n          } else if (isValidTextNode(marker.previousSibling)) {\n            node = marker.previousSibling;\n            idx = marker.previousSibling.data.length;\n          } else {\n            node = marker.parentNode;\n            idx = dom.nodeIndex(marker) + 1;\n          }\n        }\n\n        container = node;\n        offset = idx;\n      } else {\n        if (!keep) {\n          idx = dom.nodeIndex(marker);\n        } else {\n          if (marker.hasChildNodes()) {\n            node = marker.firstChild;\n            idx = 1;\n          } else if (isValidTextNode(marker.previousSibling)) {\n            node = marker.previousSibling;\n            idx = marker.previousSibling.data.length;\n          } else {\n            node = marker.parentNode;\n            idx = dom.nodeIndex(marker);\n          }\n        }\n\n        container = node;\n        offset = idx;\n      }\n\n      if (!keep) {\n        prev = marker.previousSibling;\n        next = marker.nextSibling;\n        Tools.each(Tools.grep(marker.childNodes), function (node) {\n          if (isText$1(node)) {\n            node.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\n          }\n        });\n\n        while (marker = dom.get(bookmark.id + '_' + suffix)) {\n          dom.remove(marker, true);\n        }\n\n        if (prev && next && prev.nodeType === next.nodeType && isText$1(prev) && !Env.opera) {\n          idx = prev.nodeValue.length;\n          prev.appendData(next.nodeValue);\n          dom.remove(next);\n          container = prev;\n          offset = idx;\n        }\n      }\n\n      return Optional.some(CaretPosition$1(container, offset));\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var resolvePaths = function (dom, bookmark) {\n    var rng = dom.createRng();\n\n    if (setEndPoint(dom, true, bookmark, rng) && setEndPoint(dom, false, bookmark, rng)) {\n      return Optional.some(rng);\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var resolveId = function (dom, bookmark) {\n    var startPos = restoreEndPoint(dom, 'start', bookmark);\n    var endPos = restoreEndPoint(dom, 'end', bookmark);\n    return lift2(startPos, endPos.or(startPos), function (spos, epos) {\n      var rng = dom.createRng();\n      rng.setStart(addBogus(dom, spos.container()), spos.offset());\n      rng.setEnd(addBogus(dom, epos.container()), epos.offset());\n      return rng;\n    });\n  };\n\n  var resolveIndex$1 = function (dom, bookmark) {\n    return Optional.from(dom.select(bookmark.name)[bookmark.index]).map(function (elm) {\n      var rng = dom.createRng();\n      rng.selectNode(elm);\n      return rng;\n    });\n  };\n\n  var resolve$2 = function (selection, bookmark) {\n    var dom = selection.dom;\n\n    if (bookmark) {\n      if (isPathBookmark(bookmark)) {\n        return resolvePaths(dom, bookmark);\n      } else if (isStringPathBookmark(bookmark)) {\n        return Optional.some(resolveCaretPositionBookmark(dom, bookmark));\n      } else if (isIdBookmark(bookmark)) {\n        return resolveId(dom, bookmark);\n      } else if (isIndexBookmark(bookmark)) {\n        return resolveIndex$1(dom, bookmark);\n      } else if (isRangeBookmark(bookmark)) {\n        return Optional.some(bookmark.rng);\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var getBookmark$1 = function (selection, type, normalized) {\n    return getBookmark(selection, type, normalized);\n  };\n\n  var moveToBookmark = function (selection, bookmark) {\n    resolve$2(selection, bookmark).each(function (rng) {\n      selection.setRng(rng);\n    });\n  };\n\n  var isBookmarkNode$1 = function (node) {\n    return isElement$1(node) && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\n  };\n\n  var is$2 = function (expected) {\n    return function (actual) {\n      return expected === actual;\n    };\n  };\n\n  var isNbsp = is$2(nbsp);\n\n  var isWhiteSpace$1 = function (chr) {\n    return chr !== '' && ' \\f\\n\\r\\t\\x0B'.indexOf(chr) !== -1;\n  };\n\n  var isContent$1 = function (chr) {\n    return !isWhiteSpace$1(chr) && !isNbsp(chr);\n  };\n\n  var isNode = function (node) {\n    return !!node.nodeType;\n  };\n\n  var isInlineBlock = function (node) {\n    return node && /^(IMG)$/.test(node.nodeName);\n  };\n\n  var moveStart = function (dom, selection, rng) {\n    var offset = rng.startOffset;\n    var container = rng.startContainer,\n        walker,\n        node,\n        nodes;\n\n    if (rng.startContainer === rng.endContainer) {\n      if (isInlineBlock(rng.startContainer.childNodes[rng.startOffset])) {\n        return;\n      }\n    }\n\n    if (container.nodeType === 1) {\n      nodes = container.childNodes;\n\n      if (offset < nodes.length) {\n        container = nodes[offset];\n        walker = new DomTreeWalker(container, dom.getParent(container, dom.isBlock));\n      } else {\n        container = nodes[nodes.length - 1];\n        walker = new DomTreeWalker(container, dom.getParent(container, dom.isBlock));\n        walker.next(true);\n      }\n\n      for (node = walker.current(); node; node = walker.next()) {\n        if (node.nodeType === 3 && !isWhiteSpaceNode(node)) {\n          rng.setStart(node, 0);\n          selection.setRng(rng);\n          return;\n        }\n      }\n    }\n  };\n\n  var getNonWhiteSpaceSibling = function (node, next, inc) {\n    if (node) {\n      var nextName = next ? 'nextSibling' : 'previousSibling';\n\n      for (node = inc ? node : node[nextName]; node; node = node[nextName]) {\n        if (node.nodeType === 1 || !isWhiteSpaceNode(node)) {\n          return node;\n        }\n      }\n    }\n  };\n\n  var isTextBlock$1 = function (editor, name) {\n    if (isNode(name)) {\n      name = name.nodeName;\n    }\n\n    return !!editor.schema.getTextBlockElements()[name.toLowerCase()];\n  };\n\n  var isValid = function (ed, parent, child) {\n    return ed.schema.isValidChild(parent, child);\n  };\n\n  var isWhiteSpaceNode = function (node, allowSpaces) {\n    if (allowSpaces === void 0) {\n      allowSpaces = false;\n    }\n\n    if (isNonNullable(node) && isText$1(node)) {\n      var data = allowSpaces ? node.data.replace(/ /g, '\\xA0') : node.data;\n      return isWhitespaceText(data);\n    } else {\n      return false;\n    }\n  };\n\n  var isEmptyTextNode = function (node) {\n    return isNonNullable(node) && isText$1(node) && node.length === 0;\n  };\n\n  var replaceVars = function (value, vars) {\n    if (typeof value !== 'string') {\n      value = value(vars);\n    } else if (vars) {\n      value = value.replace(/%(\\w+)/g, function (str, name) {\n        return vars[name] || str;\n      });\n    }\n\n    return value;\n  };\n\n  var isEq = function (str1, str2) {\n    str1 = str1 || '';\n    str2 = str2 || '';\n    str1 = '' + (str1.nodeName || str1);\n    str2 = '' + (str2.nodeName || str2);\n    return str1.toLowerCase() === str2.toLowerCase();\n  };\n\n  var normalizeStyleValue = function (dom, value, name) {\n    if (name === 'color' || name === 'backgroundColor') {\n      value = dom.toHex(value);\n    }\n\n    if (name === 'fontWeight' && value === 700) {\n      value = 'bold';\n    }\n\n    if (name === 'fontFamily') {\n      value = value.replace(/[\\'\\\"]/g, '').replace(/,\\s+/g, ',');\n    }\n\n    return '' + value;\n  };\n\n  var getStyle = function (dom, node, name) {\n    return normalizeStyleValue(dom, dom.getStyle(node, name), name);\n  };\n\n  var getTextDecoration = function (dom, node) {\n    var decoration;\n    dom.getParent(node, function (n) {\n      decoration = dom.getStyle(n, 'text-decoration');\n      return decoration && decoration !== 'none';\n    });\n    return decoration;\n  };\n\n  var getParents$1 = function (dom, node, selector) {\n    return dom.getParents(node, selector, dom.getRoot());\n  };\n\n  var isVariableFormatName = function (editor, formatName) {\n    var hasVariableValues = function (format) {\n      var isVariableValue = function (val) {\n        return val.length > 1 && val.charAt(0) === '%';\n      };\n\n      return exists(['styles', 'attributes'], function (key) {\n        return get$1(format, key).exists(function (field) {\n          var fieldValues = isArray(field) ? field : values(field);\n          return exists(fieldValues, isVariableValue);\n        });\n      });\n    };\n\n    return exists(editor.formatter.get(formatName), hasVariableValues);\n  };\n\n  var areSimilarFormats = function (editor, formatName, otherFormatName) {\n    var validKeys = ['inline', 'block', 'selector', 'attributes', 'styles', 'classes'];\n\n    var filterObj = function (format) {\n      return filter$1(format, function (_, key) {\n        return exists(validKeys, function (validKey) {\n          return validKey === key;\n        });\n      });\n    };\n\n    return exists(editor.formatter.get(formatName), function (fmt1) {\n      var filteredFmt1 = filterObj(fmt1);\n      return exists(editor.formatter.get(otherFormatName), function (fmt2) {\n        var filteredFmt2 = filterObj(fmt2);\n        return equal(filteredFmt1, filteredFmt2);\n      });\n    });\n  };\n\n  var isBlockFormat = function (format) {\n    return hasNonNullableKey(format, 'block');\n  };\n\n  var isSelectorFormat = function (format) {\n    return hasNonNullableKey(format, 'selector');\n  };\n\n  var isInlineFormat = function (format) {\n    return hasNonNullableKey(format, 'inline');\n  };\n\n  var isBookmarkNode$2 = isBookmarkNode$1;\n  var getParents$2 = getParents$1;\n  var isWhiteSpaceNode$1 = isWhiteSpaceNode;\n  var isTextBlock$2 = isTextBlock$1;\n\n  var isBogusBr = function (node) {\n    return isBr(node) && node.getAttribute('data-mce-bogus') && !node.nextSibling;\n  };\n\n  var findParentContentEditable = function (dom, node) {\n    var parent = node;\n\n    while (parent) {\n      if (isElement$1(parent) && dom.getContentEditable(parent)) {\n        return dom.getContentEditable(parent) === 'false' ? parent : node;\n      }\n\n      parent = parent.parentNode;\n    }\n\n    return node;\n  };\n\n  var walkText = function (start, node, offset, predicate) {\n    var str = node.data;\n\n    for (var i = offset; start ? i >= 0 : i < str.length; start ? i-- : i++) {\n      if (predicate(str.charAt(i))) {\n        return start ? i + 1 : i;\n      }\n    }\n\n    return -1;\n  };\n\n  var findSpace = function (start, node, offset) {\n    return walkText(start, node, offset, function (c) {\n      return isNbsp(c) || isWhiteSpace$1(c);\n    });\n  };\n\n  var findContent = function (start, node, offset) {\n    return walkText(start, node, offset, isContent$1);\n  };\n\n  var findWordEndPoint = function (dom, body, container, offset, start, includeTrailingSpaces) {\n    var lastTextNode;\n    var rootNode = dom.getParent(container, dom.isBlock) || body;\n\n    var walk = function (container, offset, pred) {\n      var textSeeker = TextSeeker(dom);\n      var walker = start ? textSeeker.backwards : textSeeker.forwards;\n      return Optional.from(walker(container, offset, function (text, textOffset) {\n        if (isBookmarkNode$2(text.parentNode)) {\n          return -1;\n        } else {\n          lastTextNode = text;\n          return pred(start, text, textOffset);\n        }\n      }, rootNode));\n    };\n\n    var spaceResult = walk(container, offset, findSpace);\n    return spaceResult.bind(function (result) {\n      return includeTrailingSpaces ? walk(result.container, result.offset + (start ? -1 : 0), findContent) : Optional.some(result);\n    }).orThunk(function () {\n      return lastTextNode ? Optional.some({\n        container: lastTextNode,\n        offset: start ? 0 : lastTextNode.length\n      }) : Optional.none();\n    });\n  };\n\n  var findSelectorEndPoint = function (dom, format, rng, container, siblingName) {\n    if (isText$1(container) && container.nodeValue.length === 0 && container[siblingName]) {\n      container = container[siblingName];\n    }\n\n    var parents = getParents$2(dom, container);\n\n    for (var i = 0; i < parents.length; i++) {\n      for (var y = 0; y < format.length; y++) {\n        var curFormat = format[y];\n\n        if ('collapsed' in curFormat && curFormat.collapsed !== rng.collapsed) {\n          continue;\n        }\n\n        if (dom.is(parents[i], curFormat.selector)) {\n          return parents[i];\n        }\n      }\n    }\n\n    return container;\n  };\n\n  var findBlockEndPoint = function (editor, format, container, siblingName) {\n    var node;\n    var dom = editor.dom;\n    var root = dom.getRoot();\n\n    if (!format[0].wrapper) {\n      node = dom.getParent(container, format[0].block, root);\n    }\n\n    if (!node) {\n      var scopeRoot = dom.getParent(container, 'LI,TD,TH');\n      node = dom.getParent(isText$1(container) ? container.parentNode : container, function (node) {\n        return node !== root && isTextBlock$2(editor, node);\n      }, scopeRoot);\n    }\n\n    if (node && format[0].wrapper) {\n      node = getParents$2(dom, node, 'ul,ol').reverse()[0] || node;\n    }\n\n    if (!node) {\n      node = container;\n\n      while (node[siblingName] && !dom.isBlock(node[siblingName])) {\n        node = node[siblingName];\n\n        if (isEq(node, 'br')) {\n          break;\n        }\n      }\n    }\n\n    return node || container;\n  };\n\n  var isAtBlockBoundary = function (dom, root, container, siblingName) {\n    var parent = container.parentNode;\n\n    if (isNonNullable(container[siblingName])) {\n      return false;\n    } else if (parent === root || isNullable(parent) || dom.isBlock(parent)) {\n      return true;\n    } else {\n      return isAtBlockBoundary(dom, root, parent, siblingName);\n    }\n  };\n\n  var findParentContainer = function (dom, format, container, offset, start) {\n    var parent = container;\n    var sibling;\n    var siblingName = start ? 'previousSibling' : 'nextSibling';\n    var root = dom.getRoot();\n\n    if (isText$1(container) && !isWhiteSpaceNode$1(container)) {\n      if (start ? offset > 0 : offset < container.data.length) {\n        return container;\n      }\n    }\n\n    while (true) {\n      if (!format[0].block_expand && dom.isBlock(parent)) {\n        return parent;\n      }\n\n      for (sibling = parent[siblingName]; sibling; sibling = sibling[siblingName]) {\n        var allowSpaces = isText$1(sibling) && !isAtBlockBoundary(dom, root, sibling, siblingName);\n\n        if (!isBookmarkNode$2(sibling) && !isBogusBr(sibling) && !isWhiteSpaceNode$1(sibling, allowSpaces)) {\n          return parent;\n        }\n      }\n\n      if (parent === root || parent.parentNode === root) {\n        container = parent;\n        break;\n      }\n\n      parent = parent.parentNode;\n    }\n\n    return container;\n  };\n\n  var isSelfOrParentBookmark = function (container) {\n    return isBookmarkNode$2(container.parentNode) || isBookmarkNode$2(container);\n  };\n\n  var expandRng = function (editor, rng, format, includeTrailingSpace) {\n    if (includeTrailingSpace === void 0) {\n      includeTrailingSpace = false;\n    }\n\n    var startContainer = rng.startContainer,\n        startOffset = rng.startOffset,\n        endContainer = rng.endContainer,\n        endOffset = rng.endOffset;\n    var dom = editor.dom;\n\n    if (isElement$1(startContainer) && startContainer.hasChildNodes()) {\n      startContainer = getNode(startContainer, startOffset);\n\n      if (isText$1(startContainer)) {\n        startOffset = 0;\n      }\n    }\n\n    if (isElement$1(endContainer) && endContainer.hasChildNodes()) {\n      endContainer = getNode(endContainer, rng.collapsed ? endOffset : endOffset - 1);\n\n      if (isText$1(endContainer)) {\n        endOffset = endContainer.nodeValue.length;\n      }\n    }\n\n    startContainer = findParentContentEditable(dom, startContainer);\n    endContainer = findParentContentEditable(dom, endContainer);\n\n    if (isSelfOrParentBookmark(startContainer)) {\n      startContainer = isBookmarkNode$2(startContainer) ? startContainer : startContainer.parentNode;\n\n      if (rng.collapsed) {\n        startContainer = startContainer.previousSibling || startContainer;\n      } else {\n        startContainer = startContainer.nextSibling || startContainer;\n      }\n\n      if (isText$1(startContainer)) {\n        startOffset = rng.collapsed ? startContainer.length : 0;\n      }\n    }\n\n    if (isSelfOrParentBookmark(endContainer)) {\n      endContainer = isBookmarkNode$2(endContainer) ? endContainer : endContainer.parentNode;\n\n      if (rng.collapsed) {\n        endContainer = endContainer.nextSibling || endContainer;\n      } else {\n        endContainer = endContainer.previousSibling || endContainer;\n      }\n\n      if (isText$1(endContainer)) {\n        endOffset = rng.collapsed ? 0 : endContainer.length;\n      }\n    }\n\n    if (rng.collapsed) {\n      var startPoint = findWordEndPoint(dom, editor.getBody(), startContainer, startOffset, true, includeTrailingSpace);\n      startPoint.each(function (_a) {\n        var container = _a.container,\n            offset = _a.offset;\n        startContainer = container;\n        startOffset = offset;\n      });\n      var endPoint = findWordEndPoint(dom, editor.getBody(), endContainer, endOffset, false, includeTrailingSpace);\n      endPoint.each(function (_a) {\n        var container = _a.container,\n            offset = _a.offset;\n        endContainer = container;\n        endOffset = offset;\n      });\n    }\n\n    if (format[0].inline || format[0].block_expand) {\n      if (!format[0].inline || !isText$1(startContainer) || startOffset === 0) {\n        startContainer = findParentContainer(dom, format, startContainer, startOffset, true);\n      }\n\n      if (!format[0].inline || !isText$1(endContainer) || endOffset === endContainer.nodeValue.length) {\n        endContainer = findParentContainer(dom, format, endContainer, endOffset, false);\n      }\n    }\n\n    if (format[0].selector && format[0].expand !== false && !format[0].inline) {\n      startContainer = findSelectorEndPoint(dom, format, rng, startContainer, 'previousSibling');\n      endContainer = findSelectorEndPoint(dom, format, rng, endContainer, 'nextSibling');\n    }\n\n    if (format[0].block || format[0].selector) {\n      startContainer = findBlockEndPoint(editor, format, startContainer, 'previousSibling');\n      endContainer = findBlockEndPoint(editor, format, endContainer, 'nextSibling');\n\n      if (format[0].block) {\n        if (!dom.isBlock(startContainer)) {\n          startContainer = findParentContainer(dom, format, startContainer, startOffset, true);\n        }\n\n        if (!dom.isBlock(endContainer)) {\n          endContainer = findParentContainer(dom, format, endContainer, endOffset, false);\n        }\n      }\n    }\n\n    if (isElement$1(startContainer)) {\n      startOffset = dom.nodeIndex(startContainer);\n      startContainer = startContainer.parentNode;\n    }\n\n    if (isElement$1(endContainer)) {\n      endOffset = dom.nodeIndex(endContainer) + 1;\n      endContainer = endContainer.parentNode;\n    }\n\n    return {\n      startContainer: startContainer,\n      startOffset: startOffset,\n      endContainer: endContainer,\n      endOffset: endOffset\n    };\n  };\n\n  var clampToExistingChildren = function (container, index) {\n    var childNodes = container.childNodes;\n\n    if (index >= childNodes.length) {\n      index = childNodes.length - 1;\n    } else if (index < 0) {\n      index = 0;\n    }\n\n    return childNodes[index] || container;\n  };\n\n  var getEndChild = function (container, index) {\n    return clampToExistingChildren(container, index - 1);\n  };\n\n  var walk$1 = function (dom, rng, callback) {\n    var startContainer = rng.startContainer;\n    var startOffset = rng.startOffset;\n    var endContainer = rng.endContainer;\n    var endOffset = rng.endOffset;\n\n    var exclude = function (nodes) {\n      var node;\n      node = nodes[0];\n\n      if (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {\n        nodes.splice(0, 1);\n      }\n\n      node = nodes[nodes.length - 1];\n\n      if (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {\n        nodes.splice(nodes.length - 1, 1);\n      }\n\n      return nodes;\n    };\n\n    var collectSiblings = function (node, name, endNode) {\n      var siblings = [];\n\n      for (; node && node !== endNode; node = node[name]) {\n        siblings.push(node);\n      }\n\n      return siblings;\n    };\n\n    var findEndPoint = function (node, root) {\n      do {\n        if (node.parentNode === root) {\n          return node;\n        }\n\n        node = node.parentNode;\n      } while (node);\n    };\n\n    var walkBoundary = function (startNode, endNode, next) {\n      var siblingName = next ? 'nextSibling' : 'previousSibling';\n\n      for (var node = startNode, parent_1 = node.parentNode; node && node !== endNode; node = parent_1) {\n        parent_1 = node.parentNode;\n        var siblings_1 = collectSiblings(node === startNode ? node : node[siblingName], siblingName);\n\n        if (siblings_1.length) {\n          if (!next) {\n            siblings_1.reverse();\n          }\n\n          callback(exclude(siblings_1));\n        }\n      }\n    };\n\n    if (startContainer.nodeType === 1 && startContainer.hasChildNodes()) {\n      startContainer = clampToExistingChildren(startContainer, startOffset);\n    }\n\n    if (endContainer.nodeType === 1 && endContainer.hasChildNodes()) {\n      endContainer = getEndChild(endContainer, endOffset);\n    }\n\n    if (startContainer === endContainer) {\n      return callback(exclude([startContainer]));\n    }\n\n    var ancestor = dom.findCommonAncestor(startContainer, endContainer);\n\n    for (var node = startContainer; node; node = node.parentNode) {\n      if (node === endContainer) {\n        return walkBoundary(startContainer, ancestor, true);\n      }\n\n      if (node === ancestor) {\n        break;\n      }\n    }\n\n    for (var node = endContainer; node; node = node.parentNode) {\n      if (node === startContainer) {\n        return walkBoundary(endContainer, ancestor);\n      }\n\n      if (node === ancestor) {\n        break;\n      }\n    }\n\n    var startPoint = findEndPoint(startContainer, ancestor) || startContainer;\n    var endPoint = findEndPoint(endContainer, ancestor) || endContainer;\n    walkBoundary(startContainer, startPoint, true);\n    var siblings = collectSiblings(startPoint === startContainer ? startPoint : startPoint.nextSibling, 'nextSibling', endPoint === endContainer ? endPoint.nextSibling : endPoint);\n\n    if (siblings.length) {\n      callback(exclude(siblings));\n    }\n\n    walkBoundary(endContainer, endPoint);\n  };\n\n  var getRanges = function (selection) {\n    var ranges = [];\n\n    if (selection) {\n      for (var i = 0; i < selection.rangeCount; i++) {\n        ranges.push(selection.getRangeAt(i));\n      }\n    }\n\n    return ranges;\n  };\n\n  var getSelectedNodes = function (ranges) {\n    return bind(ranges, function (range) {\n      var node = getSelectedNode(range);\n      return node ? [SugarElement.fromDom(node)] : [];\n    });\n  };\n\n  var hasMultipleRanges = function (selection) {\n    return getRanges(selection).length > 1;\n  };\n\n  var getCellsFromRanges = function (ranges) {\n    return filter(getSelectedNodes(ranges), isTableCell$1);\n  };\n\n  var getCellsFromElement = function (elm) {\n    return descendants$1(elm, 'td[data-mce-selected],th[data-mce-selected]');\n  };\n\n  var getCellsFromElementOrRanges = function (ranges, element) {\n    var selectedCells = getCellsFromElement(element);\n    return selectedCells.length > 0 ? selectedCells : getCellsFromRanges(ranges);\n  };\n\n  var getCellsFromEditor = function (editor) {\n    return getCellsFromElementOrRanges(getRanges(editor.selection.getSel()), SugarElement.fromDom(editor.getBody()));\n  };\n\n  var getStartNode = function (rng) {\n    var sc = rng.startContainer,\n        so = rng.startOffset;\n\n    if (isText$1(sc)) {\n      return so === 0 ? Optional.some(SugarElement.fromDom(sc)) : Optional.none();\n    } else {\n      return Optional.from(sc.childNodes[so]).map(SugarElement.fromDom);\n    }\n  };\n\n  var getEndNode = function (rng) {\n    var ec = rng.endContainer,\n        eo = rng.endOffset;\n\n    if (isText$1(ec)) {\n      return eo === ec.data.length ? Optional.some(SugarElement.fromDom(ec)) : Optional.none();\n    } else {\n      return Optional.from(ec.childNodes[eo - 1]).map(SugarElement.fromDom);\n    }\n  };\n\n  var getFirstChildren = function (node) {\n    return firstChild(node).fold(constant([node]), function (child) {\n      return [node].concat(getFirstChildren(child));\n    });\n  };\n\n  var getLastChildren = function (node) {\n    return lastChild(node).fold(constant([node]), function (child) {\n      if (name(child) === 'br') {\n        return prevSibling(child).map(function (sibling) {\n          return [node].concat(getLastChildren(sibling));\n        }).getOr([]);\n      } else {\n        return [node].concat(getLastChildren(child));\n      }\n    });\n  };\n\n  var hasAllContentsSelected = function (elm, rng) {\n    return lift2(getStartNode(rng), getEndNode(rng), function (startNode, endNode) {\n      var start = find(getFirstChildren(elm), curry(eq$2, startNode));\n      var end = find(getLastChildren(elm), curry(eq$2, endNode));\n      return start.isSome() && end.isSome();\n    }).getOr(false);\n  };\n\n  var moveEndPoint$1 = function (dom, rng, node, start) {\n    var root = node,\n        walker = new DomTreeWalker(node, root);\n    var moveCaretBeforeOnEnterElementsMap = filter$1(dom.schema.getMoveCaretBeforeOnEnterElements(), function (_, name) {\n      return !contains(['td', 'th', 'table'], name.toLowerCase());\n    });\n\n    do {\n      if (isText$1(node) && Tools.trim(node.nodeValue).length !== 0) {\n        if (start) {\n          rng.setStart(node, 0);\n        } else {\n          rng.setEnd(node, node.nodeValue.length);\n        }\n\n        return;\n      }\n\n      if (moveCaretBeforeOnEnterElementsMap[node.nodeName]) {\n        if (start) {\n          rng.setStartBefore(node);\n        } else {\n          if (node.nodeName === 'BR') {\n            rng.setEndBefore(node);\n          } else {\n            rng.setEndAfter(node);\n          }\n        }\n\n        return;\n      }\n    } while (node = start ? walker.next() : walker.prev());\n\n    if (root.nodeName === 'BODY') {\n      if (start) {\n        rng.setStart(root, 0);\n      } else {\n        rng.setEnd(root, root.childNodes.length);\n      }\n    }\n  };\n\n  var hasAnyRanges = function (editor) {\n    var sel = editor.selection.getSel();\n    return sel && sel.rangeCount > 0;\n  };\n\n  var runOnRanges = function (editor, executor) {\n    var fakeSelectionNodes = getCellsFromEditor(editor);\n\n    if (fakeSelectionNodes.length > 0) {\n      each(fakeSelectionNodes, function (elem) {\n        var node = elem.dom;\n        var fakeNodeRng = editor.dom.createRng();\n        fakeNodeRng.setStartBefore(node);\n        fakeNodeRng.setEndAfter(node);\n        executor(fakeNodeRng, true);\n      });\n    } else {\n      executor(editor.selection.getRng(), false);\n    }\n  };\n\n  var preserve = function (selection, fillBookmark, executor) {\n    var bookmark = getPersistentBookmark(selection, fillBookmark);\n    executor(bookmark);\n    selection.moveToBookmark(bookmark);\n  };\n\n  function NodeValue(is, name) {\n    var get = function (element) {\n      if (!is(element)) {\n        throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\n      }\n\n      return getOption(element).getOr('');\n    };\n\n    var getOption = function (element) {\n      return is(element) ? Optional.from(element.dom.nodeValue) : Optional.none();\n    };\n\n    var set = function (element, value) {\n      if (!is(element)) {\n        throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\n      }\n\n      element.dom.nodeValue = value;\n    };\n\n    return {\n      get: get,\n      getOption: getOption,\n      set: set\n    };\n  }\n\n  var api = NodeValue(isText, 'text');\n\n  var get$8 = function (element) {\n    return api.get(element);\n  };\n\n  var isZeroWidth = function (elem) {\n    return isText(elem) && get$8(elem) === ZWSP;\n  };\n\n  var context = function (editor, elem, wrapName, nodeName) {\n    return parent(elem).fold(function () {\n      return 'skipping';\n    }, function (parent) {\n      if (nodeName === 'br' || isZeroWidth(elem)) {\n        return 'valid';\n      } else if (isAnnotation(elem)) {\n        return 'existing';\n      } else if (isCaretNode(elem.dom)) {\n        return 'caret';\n      } else if (!isValid(editor, wrapName, nodeName) || !isValid(editor, name(parent), wrapName)) {\n        return 'invalid-child';\n      } else {\n        return 'valid';\n      }\n    });\n  };\n\n  var applyWordGrab = function (editor, rng) {\n    var r = expandRng(editor, rng, [{\n      inline: true\n    }]);\n    rng.setStart(r.startContainer, r.startOffset);\n    rng.setEnd(r.endContainer, r.endOffset);\n    editor.selection.setRng(rng);\n  };\n\n  var makeAnnotation = function (eDoc, _a, annotationName, decorate) {\n    var _b = _a.uid,\n        uid = _b === void 0 ? generate$1('mce-annotation') : _b,\n        data = __rest(_a, ['uid']);\n\n    var master = SugarElement.fromTag('span', eDoc);\n    add$3(master, annotation());\n    set(master, '' + dataAnnotationId(), uid);\n    set(master, '' + dataAnnotation(), annotationName);\n\n    var _c = decorate(uid, data),\n        _d = _c.attributes,\n        attributes = _d === void 0 ? {} : _d,\n        _e = _c.classes,\n        classes = _e === void 0 ? [] : _e;\n\n    setAll(master, attributes);\n    add$4(master, classes);\n    return master;\n  };\n\n  var annotate = function (editor, rng, annotationName, decorate, data) {\n    var newWrappers = [];\n    var master = makeAnnotation(editor.getDoc(), data, annotationName, decorate);\n    var wrapper = Cell(Optional.none());\n\n    var finishWrapper = function () {\n      wrapper.set(Optional.none());\n    };\n\n    var getOrOpenWrapper = function () {\n      return wrapper.get().getOrThunk(function () {\n        var nu = shallow(master);\n        newWrappers.push(nu);\n        wrapper.set(Optional.some(nu));\n        return nu;\n      });\n    };\n\n    var processElements = function (elems) {\n      each(elems, processElement);\n    };\n\n    var processElement = function (elem) {\n      var ctx = context(editor, elem, 'span', name(elem));\n\n      switch (ctx) {\n        case 'invalid-child':\n          {\n            finishWrapper();\n            var children$1 = children(elem);\n            processElements(children$1);\n            finishWrapper();\n            break;\n          }\n\n        case 'valid':\n          {\n            var w = getOrOpenWrapper();\n            wrap(elem, w);\n            break;\n          }\n      }\n    };\n\n    var processNodes = function (nodes) {\n      var elems = map(nodes, SugarElement.fromDom);\n      processElements(elems);\n    };\n\n    walk$1(editor.dom, rng, function (nodes) {\n      finishWrapper();\n      processNodes(nodes);\n    });\n    return newWrappers;\n  };\n\n  var annotateWithBookmark = function (editor, name, settings, data) {\n    editor.undoManager.transact(function () {\n      var selection = editor.selection;\n      var initialRng = selection.getRng();\n      var hasFakeSelection = getCellsFromEditor(editor).length > 0;\n\n      if (initialRng.collapsed && !hasFakeSelection) {\n        applyWordGrab(editor, initialRng);\n      }\n\n      if (selection.getRng().collapsed && !hasFakeSelection) {\n        var wrapper = makeAnnotation(editor.getDoc(), data, name, settings.decorate);\n        set$1(wrapper, nbsp);\n        selection.getRng().insertNode(wrapper.dom);\n        selection.select(wrapper.dom);\n      } else {\n        preserve(selection, false, function () {\n          runOnRanges(editor, function (selectionRng) {\n            annotate(editor, selectionRng, name, settings.decorate, data);\n          });\n        });\n      }\n    });\n  };\n\n  var Annotator = function (editor) {\n    var registry = create$2();\n    setup$1(editor, registry);\n    var changes = setup(editor);\n    return {\n      register: function (name, settings) {\n        registry.register(name, settings);\n      },\n      annotate: function (name, data) {\n        registry.lookup(name).each(function (settings) {\n          annotateWithBookmark(editor, name, settings, data);\n        });\n      },\n      annotationChanged: function (name, callback) {\n        changes.addListener(name, callback);\n      },\n      remove: function (name) {\n        identify(editor, Optional.some(name)).each(function (_a) {\n          var elements = _a.elements;\n          each(elements, unwrap);\n        });\n      },\n      getAll: function (name) {\n        var directory = findAll(editor, name);\n        return map$1(directory, function (elems) {\n          return map(elems, function (elem) {\n            return elem.dom;\n          });\n        });\n      }\n    };\n  };\n\n  function BookmarkManager(selection) {\n    return {\n      getBookmark: curry(getBookmark$1, selection),\n      moveToBookmark: curry(moveToBookmark, selection)\n    };\n  }\n\n  (function (BookmarkManager) {\n    BookmarkManager.isBookmarkNode = isBookmarkNode$1;\n  })(BookmarkManager || (BookmarkManager = {}));\n\n  var BookmarkManager$1 = BookmarkManager;\n\n  var getContentEditableRoot = function (root, node) {\n    while (node && node !== root) {\n      if (isContentEditableTrue(node) || isContentEditableFalse(node)) {\n        return node;\n      }\n\n      node = node.parentNode;\n    }\n\n    return null;\n  };\n\n  var isXYWithinRange = function (clientX, clientY, range) {\n    if (range.collapsed) {\n      return false;\n    }\n\n    if (Env.browser.isIE() && range.startOffset === range.endOffset - 1 && range.startContainer === range.endContainer) {\n      var elm = range.startContainer.childNodes[range.startOffset];\n\n      if (isElement$1(elm)) {\n        return exists(elm.getClientRects(), function (rect) {\n          return containsXY(rect, clientX, clientY);\n        });\n      }\n    }\n\n    return exists(range.getClientRects(), function (rect) {\n      return containsXY(rect, clientX, clientY);\n    });\n  };\n\n  var firePreProcess = function (editor, args) {\n    return editor.fire('PreProcess', args);\n  };\n\n  var firePostProcess = function (editor, args) {\n    return editor.fire('PostProcess', args);\n  };\n\n  var fireRemove = function (editor) {\n    return editor.fire('remove');\n  };\n\n  var fireDetach = function (editor) {\n    return editor.fire('detach');\n  };\n\n  var fireSwitchMode = function (editor, mode) {\n    return editor.fire('SwitchMode', {\n      mode: mode\n    });\n  };\n\n  var fireObjectResizeStart = function (editor, target, width, height, origin) {\n    editor.fire('ObjectResizeStart', {\n      target: target,\n      width: width,\n      height: height,\n      origin: origin\n    });\n  };\n\n  var fireObjectResized = function (editor, target, width, height, origin) {\n    editor.fire('ObjectResized', {\n      target: target,\n      width: width,\n      height: height,\n      origin: origin\n    });\n  };\n\n  var firePreInit = function (editor) {\n    return editor.fire('PreInit');\n  };\n\n  var firePostRender = function (editor) {\n    return editor.fire('PostRender');\n  };\n\n  var fireInit = function (editor) {\n    return editor.fire('Init');\n  };\n\n  var firePlaceholderToggle = function (editor, state) {\n    return editor.fire('PlaceholderToggle', {\n      state: state\n    });\n  };\n\n  var fireError = function (editor, errorType, error) {\n    return editor.fire(errorType, error);\n  };\n\n  var VK = {\n    BACKSPACE: 8,\n    DELETE: 46,\n    DOWN: 40,\n    ENTER: 13,\n    LEFT: 37,\n    RIGHT: 39,\n    SPACEBAR: 32,\n    TAB: 9,\n    UP: 38,\n    END: 35,\n    HOME: 36,\n    modifierPressed: function (e) {\n      return e.shiftKey || e.ctrlKey || e.altKey || this.metaKeyPressed(e);\n    },\n    metaKeyPressed: function (e) {\n      return Env.mac ? e.metaKey : e.ctrlKey && !e.altKey;\n    }\n  };\n  var isContentEditableFalse$6 = isContentEditableFalse;\n\n  var ControlSelection = function (selection, editor) {\n    var dom = editor.dom,\n        each = Tools.each;\n    var selectedElm, selectedElmGhost, resizeHelper, selectedHandle;\n    var startX, startY, selectedElmX, selectedElmY, startW, startH, ratio, resizeStarted;\n    var width, height;\n    var editableDoc = editor.getDoc(),\n        rootDocument = document;\n    var abs = Math.abs,\n        round = Math.round,\n        rootElement = editor.getBody();\n    var startScrollWidth, startScrollHeight;\n    var resizeHandles = {\n      nw: [0, 0, -1, -1],\n      ne: [1, 0, 1, -1],\n      se: [1, 1, 1, 1],\n      sw: [0, 1, -1, 1]\n    };\n\n    var isImage = function (elm) {\n      return elm && (elm.nodeName === 'IMG' || editor.dom.is(elm, 'figure.image'));\n    };\n\n    var isEventOnImageOutsideRange = function (evt, range) {\n      if (evt.type === 'longpress' || evt.type.indexOf('touch') === 0) {\n        var touch = evt.touches[0];\n        return isImage(evt.target) && !isXYWithinRange(touch.clientX, touch.clientY, range);\n      } else {\n        return isImage(evt.target) && !isXYWithinRange(evt.clientX, evt.clientY, range);\n      }\n    };\n\n    var contextMenuSelectImage = function (evt) {\n      var target = evt.target;\n\n      if (isEventOnImageOutsideRange(evt, editor.selection.getRng()) && !evt.isDefaultPrevented()) {\n        editor.selection.select(target);\n      }\n    };\n\n    var getResizeTarget = function (elm) {\n      return editor.dom.is(elm, 'figure.image') ? elm.querySelector('img') : elm;\n    };\n\n    var isResizable = function (elm) {\n      var selector = getObjectResizing(editor);\n\n      if (!selector) {\n        return false;\n      }\n\n      if (elm.getAttribute('data-mce-resize') === 'false') {\n        return false;\n      }\n\n      if (elm === editor.getBody()) {\n        return false;\n      }\n\n      return is$1(SugarElement.fromDom(elm), selector);\n    };\n\n    var setGhostElmSize = function (ghostElm, width, height) {\n      dom.setStyles(getResizeTarget(ghostElm), {\n        width: width,\n        height: height\n      });\n    };\n\n    var resizeGhostElement = function (e) {\n      var deltaX, deltaY, proportional;\n      var resizeHelperX, resizeHelperY;\n      deltaX = e.screenX - startX;\n      deltaY = e.screenY - startY;\n      width = deltaX * selectedHandle[2] + startW;\n      height = deltaY * selectedHandle[3] + startH;\n      width = width < 5 ? 5 : width;\n      height = height < 5 ? 5 : height;\n\n      if (isImage(selectedElm) && getResizeImgProportional(editor) !== false) {\n        proportional = !VK.modifierPressed(e);\n      } else {\n        proportional = VK.modifierPressed(e);\n      }\n\n      if (proportional) {\n        if (abs(deltaX) > abs(deltaY)) {\n          height = round(width * ratio);\n          width = round(height / ratio);\n        } else {\n          width = round(height / ratio);\n          height = round(width * ratio);\n        }\n      }\n\n      setGhostElmSize(selectedElmGhost, width, height);\n      resizeHelperX = selectedHandle.startPos.x + deltaX;\n      resizeHelperY = selectedHandle.startPos.y + deltaY;\n      resizeHelperX = resizeHelperX > 0 ? resizeHelperX : 0;\n      resizeHelperY = resizeHelperY > 0 ? resizeHelperY : 0;\n      dom.setStyles(resizeHelper, {\n        left: resizeHelperX,\n        top: resizeHelperY,\n        display: 'block'\n      });\n      resizeHelper.innerHTML = width + ' &times; ' + height;\n\n      if (selectedHandle[2] < 0 && selectedElmGhost.clientWidth <= width) {\n        dom.setStyle(selectedElmGhost, 'left', selectedElmX + (startW - width));\n      }\n\n      if (selectedHandle[3] < 0 && selectedElmGhost.clientHeight <= height) {\n        dom.setStyle(selectedElmGhost, 'top', selectedElmY + (startH - height));\n      }\n\n      deltaX = rootElement.scrollWidth - startScrollWidth;\n      deltaY = rootElement.scrollHeight - startScrollHeight;\n\n      if (deltaX + deltaY !== 0) {\n        dom.setStyles(resizeHelper, {\n          left: resizeHelperX - deltaX,\n          top: resizeHelperY - deltaY\n        });\n      }\n\n      if (!resizeStarted) {\n        fireObjectResizeStart(editor, selectedElm, startW, startH, 'corner-' + selectedHandle.name);\n        resizeStarted = true;\n      }\n    };\n\n    var endGhostResize = function () {\n      var wasResizeStarted = resizeStarted;\n      resizeStarted = false;\n\n      var setSizeProp = function (name, value) {\n        if (value) {\n          if (selectedElm.style[name] || !editor.schema.isValid(selectedElm.nodeName.toLowerCase(), name)) {\n            dom.setStyle(getResizeTarget(selectedElm), name, value);\n          } else {\n            dom.setAttrib(getResizeTarget(selectedElm), name, '' + value);\n          }\n        }\n      };\n\n      if (wasResizeStarted) {\n        setSizeProp('width', width);\n        setSizeProp('height', height);\n      }\n\n      dom.unbind(editableDoc, 'mousemove', resizeGhostElement);\n      dom.unbind(editableDoc, 'mouseup', endGhostResize);\n\n      if (rootDocument !== editableDoc) {\n        dom.unbind(rootDocument, 'mousemove', resizeGhostElement);\n        dom.unbind(rootDocument, 'mouseup', endGhostResize);\n      }\n\n      dom.remove(selectedElmGhost);\n      dom.remove(resizeHelper);\n      showResizeRect(selectedElm);\n\n      if (wasResizeStarted) {\n        fireObjectResized(editor, selectedElm, width, height, 'corner-' + selectedHandle.name);\n        dom.setAttrib(selectedElm, 'style', dom.getAttrib(selectedElm, 'style'));\n      }\n\n      editor.nodeChanged();\n    };\n\n    var showResizeRect = function (targetElm) {\n      hideResizeRect();\n      unbindResizeHandleEvents();\n      var position = dom.getPos(targetElm, rootElement);\n      var selectedElmX = position.x;\n      var selectedElmY = position.y;\n      var rect = targetElm.getBoundingClientRect();\n      var targetWidth = rect.width || rect.right - rect.left;\n      var targetHeight = rect.height || rect.bottom - rect.top;\n\n      if (selectedElm !== targetElm) {\n        selectedElm = targetElm;\n        width = height = 0;\n      }\n\n      var e = editor.fire('ObjectSelected', {\n        target: targetElm\n      });\n\n      if (isResizable(targetElm) && !e.isDefaultPrevented()) {\n        each(resizeHandles, function (handle, name) {\n          var handleElm;\n\n          var startDrag = function (e) {\n            startX = e.screenX;\n            startY = e.screenY;\n            startW = getResizeTarget(selectedElm).clientWidth;\n            startH = getResizeTarget(selectedElm).clientHeight;\n            ratio = startH / startW;\n            selectedHandle = handle;\n            selectedHandle.name = name;\n            selectedHandle.startPos = {\n              x: targetWidth * handle[0] + selectedElmX,\n              y: targetHeight * handle[1] + selectedElmY\n            };\n            startScrollWidth = rootElement.scrollWidth;\n            startScrollHeight = rootElement.scrollHeight;\n            selectedElmGhost = selectedElm.cloneNode(true);\n            dom.addClass(selectedElmGhost, 'mce-clonedresizable');\n            dom.setAttrib(selectedElmGhost, 'data-mce-bogus', 'all');\n            selectedElmGhost.contentEditable = false;\n            selectedElmGhost.unSelectabe = true;\n            dom.setStyles(selectedElmGhost, {\n              left: selectedElmX,\n              top: selectedElmY,\n              margin: 0\n            });\n            setGhostElmSize(selectedElmGhost, targetWidth, targetHeight);\n            selectedElmGhost.removeAttribute('data-mce-selected');\n            rootElement.appendChild(selectedElmGhost);\n            dom.bind(editableDoc, 'mousemove', resizeGhostElement);\n            dom.bind(editableDoc, 'mouseup', endGhostResize);\n\n            if (rootDocument !== editableDoc) {\n              dom.bind(rootDocument, 'mousemove', resizeGhostElement);\n              dom.bind(rootDocument, 'mouseup', endGhostResize);\n            }\n\n            resizeHelper = dom.add(rootElement, 'div', {\n              'class': 'mce-resize-helper',\n              'data-mce-bogus': 'all'\n            }, startW + ' &times; ' + startH);\n          };\n\n          handleElm = dom.get('mceResizeHandle' + name);\n\n          if (handleElm) {\n            dom.remove(handleElm);\n          }\n\n          handleElm = dom.add(rootElement, 'div', {\n            'id': 'mceResizeHandle' + name,\n            'data-mce-bogus': 'all',\n            'class': 'mce-resizehandle',\n            'unselectable': true,\n            'style': 'cursor:' + name + '-resize; margin:0; padding:0'\n          });\n\n          if (Env.ie === 11) {\n            handleElm.contentEditable = false;\n          }\n\n          dom.bind(handleElm, 'mousedown', function (e) {\n            e.stopImmediatePropagation();\n            e.preventDefault();\n            startDrag(e);\n          });\n          handle.elm = handleElm;\n          dom.setStyles(handleElm, {\n            left: targetWidth * handle[0] + selectedElmX - handleElm.offsetWidth / 2,\n            top: targetHeight * handle[1] + selectedElmY - handleElm.offsetHeight / 2\n          });\n        });\n      } else {\n        hideResizeRect();\n      }\n\n      selectedElm.setAttribute('data-mce-selected', '1');\n    };\n\n    var hideResizeRect = function () {\n      unbindResizeHandleEvents();\n\n      if (selectedElm) {\n        selectedElm.removeAttribute('data-mce-selected');\n      }\n\n      each$1(resizeHandles, function (value, name) {\n        var handleElm = dom.get('mceResizeHandle' + name);\n\n        if (handleElm) {\n          dom.unbind(handleElm);\n          dom.remove(handleElm);\n        }\n      });\n    };\n\n    var updateResizeRect = function (e) {\n      var startElm, controlElm;\n\n      var isChildOrEqual = function (node, parent) {\n        if (node) {\n          do {\n            if (node === parent) {\n              return true;\n            }\n          } while (node = node.parentNode);\n        }\n      };\n\n      if (resizeStarted || editor.removed) {\n        return;\n      }\n\n      each(dom.select('img[data-mce-selected],hr[data-mce-selected]'), function (img) {\n        img.removeAttribute('data-mce-selected');\n      });\n      controlElm = e.type === 'mousedown' ? e.target : selection.getNode();\n      controlElm = dom.$(controlElm).closest('table,img,figure.image,hr')[0];\n\n      if (isChildOrEqual(controlElm, rootElement)) {\n        disableGeckoResize();\n        startElm = selection.getStart(true);\n\n        if (isChildOrEqual(startElm, controlElm) && isChildOrEqual(selection.getEnd(true), controlElm)) {\n          showResizeRect(controlElm);\n          return;\n        }\n      }\n\n      hideResizeRect();\n    };\n\n    var isWithinContentEditableFalse = function (elm) {\n      return isContentEditableFalse$6(getContentEditableRoot(editor.getBody(), elm));\n    };\n\n    var unbindResizeHandleEvents = function () {\n      each$1(resizeHandles, function (handle) {\n        if (handle.elm) {\n          dom.unbind(handle.elm);\n          delete handle.elm;\n        }\n      });\n    };\n\n    var disableGeckoResize = function () {\n      try {\n        editor.getDoc().execCommand('enableObjectResizing', false, 'false');\n      } catch (ex) {}\n    };\n\n    editor.on('init', function () {\n      disableGeckoResize();\n\n      if (Env.browser.isIE() || Env.browser.isEdge()) {\n        editor.on('mousedown click', function (e) {\n          var target = e.target,\n              nodeName = target.nodeName;\n\n          if (!resizeStarted && /^(TABLE|IMG|HR)$/.test(nodeName) && !isWithinContentEditableFalse(target)) {\n            if (e.button !== 2) {\n              editor.selection.select(target, nodeName === 'TABLE');\n            }\n\n            if (e.type === 'mousedown') {\n              editor.nodeChanged();\n            }\n          }\n        });\n\n        var handleMSControlSelect_1 = function (e) {\n          var delayedSelect = function (node) {\n            Delay.setEditorTimeout(editor, function () {\n              return editor.selection.select(node);\n            });\n          };\n\n          if (isWithinContentEditableFalse(e.target) || isMedia(e.target)) {\n            e.preventDefault();\n            delayedSelect(e.target);\n            return;\n          }\n\n          if (/^(TABLE|IMG|HR)$/.test(e.target.nodeName)) {\n            e.preventDefault();\n\n            if (e.target.tagName === 'IMG') {\n              delayedSelect(e.target);\n            }\n          }\n        };\n\n        dom.bind(rootElement, 'mscontrolselect', handleMSControlSelect_1);\n        editor.on('remove', function () {\n          return dom.unbind(rootElement, 'mscontrolselect', handleMSControlSelect_1);\n        });\n      }\n\n      var throttledUpdateResizeRect = Delay.throttle(function (e) {\n        if (!editor.composing) {\n          updateResizeRect(e);\n        }\n      });\n      editor.on('nodechange ResizeEditor ResizeWindow ResizeContent drop FullscreenStateChanged', throttledUpdateResizeRect);\n      editor.on('keyup compositionend', function (e) {\n        if (selectedElm && selectedElm.nodeName === 'TABLE') {\n          throttledUpdateResizeRect(e);\n        }\n      });\n      editor.on('hide blur', hideResizeRect);\n      editor.on('contextmenu longpress', contextMenuSelectImage, true);\n    });\n    editor.on('remove', unbindResizeHandleEvents);\n\n    var destroy = function () {\n      selectedElm = selectedElmGhost = null;\n    };\n\n    return {\n      isResizable: isResizable,\n      showResizeRect: showResizeRect,\n      hideResizeRect: hideResizeRect,\n      updateResizeRect: updateResizeRect,\n      destroy: destroy\n    };\n  };\n\n  var hasCeProperty = function (node) {\n    return isContentEditableTrue(node) || isContentEditableFalse(node);\n  };\n\n  var findParent = function (node, rootNode, predicate) {\n    while (node && node !== rootNode) {\n      if (predicate(node)) {\n        return node;\n      }\n\n      node = node.parentNode;\n    }\n\n    return null;\n  };\n\n  var findClosestIeRange = function (clientX, clientY, doc) {\n    var rects;\n    var element = doc.elementFromPoint(clientX, clientY);\n    var rng = doc.body.createTextRange();\n\n    if (!element || element.tagName === 'HTML') {\n      element = doc.body;\n    }\n\n    rng.moveToElementText(element);\n    rects = Tools.toArray(rng.getClientRects());\n    rects = rects.sort(function (a, b) {\n      a = Math.abs(Math.max(a.top - clientY, a.bottom - clientY));\n      b = Math.abs(Math.max(b.top - clientY, b.bottom - clientY));\n      return a - b;\n    });\n\n    if (rects.length > 0) {\n      clientY = (rects[0].bottom + rects[0].top) / 2;\n\n      try {\n        rng.moveToPoint(clientX, clientY);\n        rng.collapse(true);\n        return rng;\n      } catch (ex) {}\n    }\n\n    return null;\n  };\n\n  var moveOutOfContentEditableFalse = function (rng, rootNode) {\n    var parentElement = rng && rng.parentElement ? rng.parentElement() : null;\n    return isContentEditableFalse(findParent(parentElement, rootNode, hasCeProperty)) ? null : rng;\n  };\n\n  var fromPoint$1 = function (clientX, clientY, doc) {\n    var rng, point;\n    var pointDoc = doc;\n\n    if (pointDoc.caretPositionFromPoint) {\n      point = pointDoc.caretPositionFromPoint(clientX, clientY);\n\n      if (point) {\n        rng = doc.createRange();\n        rng.setStart(point.offsetNode, point.offset);\n        rng.collapse(true);\n      }\n    } else if (doc.caretRangeFromPoint) {\n      rng = doc.caretRangeFromPoint(clientX, clientY);\n    } else if (pointDoc.body.createTextRange) {\n      rng = pointDoc.body.createTextRange();\n\n      try {\n        rng.moveToPoint(clientX, clientY);\n        rng.collapse(true);\n      } catch (ex) {\n        rng = findClosestIeRange(clientX, clientY, doc);\n      }\n\n      return moveOutOfContentEditableFalse(rng, doc.body);\n    }\n\n    return rng;\n  };\n\n  var isEq$1 = function (rng1, rng2) {\n    return rng1 && rng2 && rng1.startContainer === rng2.startContainer && rng1.startOffset === rng2.startOffset && rng1.endContainer === rng2.endContainer && rng1.endOffset === rng2.endOffset;\n  };\n\n  var findParent$1 = function (node, rootNode, predicate) {\n    while (node && node !== rootNode) {\n      if (predicate(node)) {\n        return node;\n      }\n\n      node = node.parentNode;\n    }\n\n    return null;\n  };\n\n  var hasParent = function (node, rootNode, predicate) {\n    return findParent$1(node, rootNode, predicate) !== null;\n  };\n\n  var hasParentWithName = function (node, rootNode, name) {\n    return hasParent(node, rootNode, function (node) {\n      return node.nodeName === name;\n    });\n  };\n\n  var isTable$3 = function (node) {\n    return node && node.nodeName === 'TABLE';\n  };\n\n  var isTableCell$3 = function (node) {\n    return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n  };\n\n  var isCeFalseCaretContainer = function (node, rootNode) {\n    return isCaretContainer(node) && hasParent(node, rootNode, isCaretNode) === false;\n  };\n\n  var hasBrBeforeAfter = function (dom, node, left) {\n    var walker = new DomTreeWalker(node, dom.getParent(node.parentNode, dom.isBlock) || dom.getRoot());\n\n    while (node = walker[left ? 'prev' : 'next']()) {\n      if (isBr(node)) {\n        return true;\n      }\n    }\n  };\n\n  var isPrevNode = function (node, name) {\n    return node.previousSibling && node.previousSibling.nodeName === name;\n  };\n\n  var hasContentEditableFalseParent = function (body, node) {\n    while (node && node !== body) {\n      if (isContentEditableFalse(node)) {\n        return true;\n      }\n\n      node = node.parentNode;\n    }\n\n    return false;\n  };\n\n  var findTextNodeRelative = function (dom, isAfterNode, collapsed, left, startNode) {\n    var lastInlineElement;\n    var body = dom.getRoot();\n    var node;\n    var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n    var parentBlockContainer = dom.getParent(startNode.parentNode, dom.isBlock) || body;\n\n    if (left && isBr(startNode) && isAfterNode && dom.isEmpty(parentBlockContainer)) {\n      return Optional.some(CaretPosition(startNode.parentNode, dom.nodeIndex(startNode)));\n    }\n\n    var walker = new DomTreeWalker(startNode, parentBlockContainer);\n\n    while (node = walker[left ? 'prev' : 'next']()) {\n      if (dom.getContentEditableParent(node) === 'false' || isCeFalseCaretContainer(node, body)) {\n        return Optional.none();\n      }\n\n      if (isText$1(node) && node.nodeValue.length > 0) {\n        if (hasParentWithName(node, body, 'A') === false) {\n          return Optional.some(CaretPosition(node, left ? node.nodeValue.length : 0));\n        }\n\n        return Optional.none();\n      }\n\n      if (dom.isBlock(node) || nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n        return Optional.none();\n      }\n\n      lastInlineElement = node;\n    }\n\n    if (collapsed && lastInlineElement) {\n      return Optional.some(CaretPosition(lastInlineElement, 0));\n    }\n\n    return Optional.none();\n  };\n\n  var normalizeEndPoint = function (dom, collapsed, start, rng) {\n    var container, offset;\n    var body = dom.getRoot();\n    var node;\n    var directionLeft,\n        normalized = false;\n    container = rng[(start ? 'start' : 'end') + 'Container'];\n    offset = rng[(start ? 'start' : 'end') + 'Offset'];\n    var isAfterNode = isElement$1(container) && offset === container.childNodes.length;\n    var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n    directionLeft = start;\n\n    if (isCaretContainer(container)) {\n      return Optional.none();\n    }\n\n    if (isElement$1(container) && offset > container.childNodes.length - 1) {\n      directionLeft = false;\n    }\n\n    if (isDocument$1(container)) {\n      container = body;\n      offset = 0;\n    }\n\n    if (container === body) {\n      if (directionLeft) {\n        node = container.childNodes[offset > 0 ? offset - 1 : 0];\n\n        if (node) {\n          if (isCaretContainer(node)) {\n            return Optional.none();\n          }\n\n          if (nonEmptyElementsMap[node.nodeName] || isTable$3(node)) {\n            return Optional.none();\n          }\n        }\n      }\n\n      if (container.hasChildNodes()) {\n        offset = Math.min(!directionLeft && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1);\n        container = container.childNodes[offset];\n        offset = isText$1(container) && isAfterNode ? container.data.length : 0;\n\n        if (!collapsed && container === body.lastChild && isTable$3(container)) {\n          return Optional.none();\n        }\n\n        if (hasContentEditableFalseParent(body, container) || isCaretContainer(container)) {\n          return Optional.none();\n        }\n\n        if (container.hasChildNodes() && isTable$3(container) === false) {\n          node = container;\n          var walker = new DomTreeWalker(container, body);\n\n          do {\n            if (isContentEditableFalse(node) || isCaretContainer(node)) {\n              normalized = false;\n              break;\n            }\n\n            if (isText$1(node) && node.nodeValue.length > 0) {\n              offset = directionLeft ? 0 : node.nodeValue.length;\n              container = node;\n              normalized = true;\n              break;\n            }\n\n            if (nonEmptyElementsMap[node.nodeName.toLowerCase()] && !isTableCell$3(node)) {\n              offset = dom.nodeIndex(node);\n              container = node.parentNode;\n\n              if (!directionLeft) {\n                offset++;\n              }\n\n              normalized = true;\n              break;\n            }\n          } while (node = directionLeft ? walker.next() : walker.prev());\n        }\n      }\n    }\n\n    if (collapsed) {\n      if (isText$1(container) && offset === 0) {\n        findTextNodeRelative(dom, isAfterNode, collapsed, true, container).each(function (pos) {\n          container = pos.container();\n          offset = pos.offset();\n          normalized = true;\n        });\n      }\n\n      if (isElement$1(container)) {\n        node = container.childNodes[offset];\n\n        if (!node) {\n          node = container.childNodes[offset - 1];\n        }\n\n        if (node && isBr(node) && !isPrevNode(node, 'A') && !hasBrBeforeAfter(dom, node, false) && !hasBrBeforeAfter(dom, node, true)) {\n          findTextNodeRelative(dom, isAfterNode, collapsed, true, node).each(function (pos) {\n            container = pos.container();\n            offset = pos.offset();\n            normalized = true;\n          });\n        }\n      }\n    }\n\n    if (directionLeft && !collapsed && isText$1(container) && offset === container.nodeValue.length) {\n      findTextNodeRelative(dom, isAfterNode, collapsed, false, container).each(function (pos) {\n        container = pos.container();\n        offset = pos.offset();\n        normalized = true;\n      });\n    }\n\n    return normalized ? Optional.some(CaretPosition(container, offset)) : Optional.none();\n  };\n\n  var normalize = function (dom, rng) {\n    var collapsed = rng.collapsed,\n        normRng = rng.cloneRange();\n    var startPos = CaretPosition.fromRangeStart(rng);\n    normalizeEndPoint(dom, collapsed, true, normRng).each(function (pos) {\n      if (!collapsed || !CaretPosition.isAbove(startPos, pos)) {\n        normRng.setStart(pos.container(), pos.offset());\n      }\n    });\n\n    if (!collapsed) {\n      normalizeEndPoint(dom, collapsed, false, normRng).each(function (pos) {\n        normRng.setEnd(pos.container(), pos.offset());\n      });\n    }\n\n    if (collapsed) {\n      normRng.collapse(true);\n    }\n\n    return isEq$1(rng, normRng) ? Optional.none() : Optional.some(normRng);\n  };\n\n  var splitText = function (node, offset) {\n    return node.splitText(offset);\n  };\n\n  var split$1 = function (rng) {\n    var startContainer = rng.startContainer,\n        startOffset = rng.startOffset,\n        endContainer = rng.endContainer,\n        endOffset = rng.endOffset;\n\n    if (startContainer === endContainer && isText$1(startContainer)) {\n      if (startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n        endContainer = splitText(startContainer, startOffset);\n        startContainer = endContainer.previousSibling;\n\n        if (endOffset > startOffset) {\n          endOffset = endOffset - startOffset;\n          startContainer = endContainer = splitText(endContainer, endOffset).previousSibling;\n          endOffset = endContainer.nodeValue.length;\n          startOffset = 0;\n        } else {\n          endOffset = 0;\n        }\n      }\n    } else {\n      if (isText$1(startContainer) && startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n        startContainer = splitText(startContainer, startOffset);\n        startOffset = 0;\n      }\n\n      if (isText$1(endContainer) && endOffset > 0 && endOffset < endContainer.nodeValue.length) {\n        endContainer = splitText(endContainer, endOffset).previousSibling;\n        endOffset = endContainer.nodeValue.length;\n      }\n    }\n\n    return {\n      startContainer: startContainer,\n      startOffset: startOffset,\n      endContainer: endContainer,\n      endOffset: endOffset\n    };\n  };\n\n  function RangeUtils(dom) {\n    var walk = function (rng, callback) {\n      return walk$1(dom, rng, callback);\n    };\n\n    var split = split$1;\n\n    var normalize$1 = function (rng) {\n      return normalize(dom, rng).fold(never, function (normalizedRng) {\n        rng.setStart(normalizedRng.startContainer, normalizedRng.startOffset);\n        rng.setEnd(normalizedRng.endContainer, normalizedRng.endOffset);\n        return true;\n      });\n    };\n\n    return {\n      walk: walk,\n      split: split,\n      normalize: normalize$1\n    };\n  }\n\n  (function (RangeUtils) {\n    RangeUtils.compareRanges = isEq$1;\n    RangeUtils.getCaretRangeFromPoint = fromPoint$1;\n    RangeUtils.getSelectedNode = getSelectedNode;\n    RangeUtils.getNode = getNode;\n  })(RangeUtils || (RangeUtils = {}));\n\n  var RangeUtils$1 = RangeUtils;\n\n  function Dimension(name, getOffset) {\n    var set = function (element, h) {\n      if (!isNumber(h) && !h.match(/^[0-9]+$/)) {\n        throw new Error(name + '.set accepts only positive integer values. Value was ' + h);\n      }\n\n      var dom = element.dom;\n\n      if (isSupported$1(dom)) {\n        dom.style[name] = h + 'px';\n      }\n    };\n\n    var get = function (element) {\n      var r = getOffset(element);\n\n      if (r <= 0 || r === null) {\n        var css = get$5(element, name);\n        return parseFloat(css) || 0;\n      }\n\n      return r;\n    };\n\n    var getOuter = get;\n\n    var aggregate = function (element, properties) {\n      return foldl(properties, function (acc, property) {\n        var val = get$5(element, property);\n        var value = val === undefined ? 0 : parseInt(val, 10);\n        return isNaN(value) ? acc : acc + value;\n      }, 0);\n    };\n\n    var max = function (element, value, properties) {\n      var cumulativeInclusions = aggregate(element, properties);\n      var absoluteMax = value > cumulativeInclusions ? value - cumulativeInclusions : 0;\n      return absoluteMax;\n    };\n\n    return {\n      set: set,\n      get: get,\n      getOuter: getOuter,\n      aggregate: aggregate,\n      max: max\n    };\n  }\n\n  var api$1 = Dimension('height', function (element) {\n    var dom = element.dom;\n    return inBody(element) ? dom.getBoundingClientRect().height : dom.offsetHeight;\n  });\n\n  var get$9 = function (element) {\n    return api$1.get(element);\n  };\n\n  var walkUp = function (navigation, doc) {\n    var frame = navigation.view(doc);\n    return frame.fold(constant([]), function (f) {\n      var parent = navigation.owner(f);\n      var rest = walkUp(navigation, parent);\n      return [f].concat(rest);\n    });\n  };\n\n  var pathTo = function (element, navigation) {\n    var d = navigation.owner(element);\n    return walkUp(navigation, d);\n  };\n\n  var view = function (doc) {\n    var _a;\n\n    var element = doc.dom === document ? Optional.none() : Optional.from((_a = doc.dom.defaultView) === null || _a === void 0 ? void 0 : _a.frameElement);\n    return element.map(SugarElement.fromDom);\n  };\n\n  var owner$1 = function (element) {\n    return documentOrOwner(element);\n  };\n\n  var Navigation = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    view: view,\n    owner: owner$1\n  });\n\n  var find$2 = function (element) {\n    var doc = SugarElement.fromDom(document);\n    var scroll = get$2(doc);\n    var frames = pathTo(element, Navigation);\n    var offset = viewport(element);\n    var r = foldr(frames, function (b, a) {\n      var loc = viewport(a);\n      return {\n        left: b.left + loc.left,\n        top: b.top + loc.top\n      };\n    }, {\n      left: 0,\n      top: 0\n    });\n    return SugarPosition(r.left + offset.left + scroll.left, r.top + offset.top + scroll.top);\n  };\n\n  var excludeFromDescend = function (element) {\n    return name(element) === 'textarea';\n  };\n\n  var fireScrollIntoViewEvent = function (editor, data) {\n    var scrollEvent = editor.fire('ScrollIntoView', data);\n    return scrollEvent.isDefaultPrevented();\n  };\n\n  var fireAfterScrollIntoViewEvent = function (editor, data) {\n    editor.fire('AfterScrollIntoView', data);\n  };\n\n  var descend = function (element, offset) {\n    var children$1 = children(element);\n\n    if (children$1.length === 0 || excludeFromDescend(element)) {\n      return {\n        element: element,\n        offset: offset\n      };\n    } else if (offset < children$1.length && !excludeFromDescend(children$1[offset])) {\n      return {\n        element: children$1[offset],\n        offset: 0\n      };\n    } else {\n      var last = children$1[children$1.length - 1];\n\n      if (excludeFromDescend(last)) {\n        return {\n          element: element,\n          offset: offset\n        };\n      } else {\n        if (name(last) === 'img') {\n          return {\n            element: last,\n            offset: 1\n          };\n        } else if (isText(last)) {\n          return {\n            element: last,\n            offset: get$8(last).length\n          };\n        } else {\n          return {\n            element: last,\n            offset: children(last).length\n          };\n        }\n      }\n    }\n  };\n\n  var markerInfo = function (element, cleanupFun) {\n    var pos = absolute(element);\n    var height = get$9(element);\n    return {\n      element: element,\n      bottom: pos.top + height,\n      height: height,\n      pos: pos,\n      cleanup: cleanupFun\n    };\n  };\n\n  var createMarker = function (element, offset) {\n    var startPoint = descend(element, offset);\n    var span = SugarElement.fromHtml('<span data-mce-bogus=\"all\">' + ZWSP + '</span>');\n    before(startPoint.element, span);\n    return markerInfo(span, function () {\n      return remove(span);\n    });\n  };\n\n  var elementMarker = function (element) {\n    return markerInfo(SugarElement.fromDom(element), noop);\n  };\n\n  var withMarker = function (editor, f, rng, alignToTop) {\n    preserveWith(editor, function (_s, _e) {\n      return applyWithMarker(editor, f, rng, alignToTop);\n    }, rng);\n  };\n\n  var withScrollEvents = function (editor, doc, f, marker, alignToTop) {\n    var data = {\n      elm: marker.element.dom,\n      alignToTop: alignToTop\n    };\n\n    if (fireScrollIntoViewEvent(editor, data)) {\n      return;\n    }\n\n    var scrollTop = get$2(doc).top;\n    f(doc, scrollTop, marker, alignToTop);\n    fireAfterScrollIntoViewEvent(editor, data);\n  };\n\n  var applyWithMarker = function (editor, f, rng, alignToTop) {\n    var body = SugarElement.fromDom(editor.getBody());\n    var doc = SugarElement.fromDom(editor.getDoc());\n    reflow(body);\n    var marker = createMarker(SugarElement.fromDom(rng.startContainer), rng.startOffset);\n    withScrollEvents(editor, doc, f, marker, alignToTop);\n    marker.cleanup();\n  };\n\n  var withElement = function (editor, element, f, alignToTop) {\n    var doc = SugarElement.fromDom(editor.getDoc());\n    withScrollEvents(editor, doc, f, elementMarker(element), alignToTop);\n  };\n\n  var preserveWith = function (editor, f, rng) {\n    var startElement = rng.startContainer;\n    var startOffset = rng.startOffset;\n    var endElement = rng.endContainer;\n    var endOffset = rng.endOffset;\n    f(SugarElement.fromDom(startElement), SugarElement.fromDom(endElement));\n    var newRng = editor.dom.createRng();\n    newRng.setStart(startElement, startOffset);\n    newRng.setEnd(endElement, endOffset);\n    editor.selection.setRng(rng);\n  };\n\n  var scrollToMarker = function (marker, viewHeight, alignToTop, doc) {\n    var pos = marker.pos;\n\n    if (alignToTop) {\n      to(pos.left, pos.top, doc);\n    } else {\n      var y = pos.top - viewHeight + marker.height;\n      to(pos.left, y, doc);\n    }\n  };\n\n  var intoWindowIfNeeded = function (doc, scrollTop, viewHeight, marker, alignToTop) {\n    var viewportBottom = viewHeight + scrollTop;\n    var markerTop = marker.pos.top;\n    var markerBottom = marker.bottom;\n    var largerThanViewport = markerBottom - markerTop >= viewHeight;\n\n    if (markerTop < scrollTop) {\n      scrollToMarker(marker, viewHeight, alignToTop !== false, doc);\n    } else if (markerTop > viewportBottom) {\n      var align = largerThanViewport ? alignToTop !== false : alignToTop === true;\n      scrollToMarker(marker, viewHeight, align, doc);\n    } else if (markerBottom > viewportBottom && !largerThanViewport) {\n      scrollToMarker(marker, viewHeight, alignToTop === true, doc);\n    }\n  };\n\n  var intoWindow = function (doc, scrollTop, marker, alignToTop) {\n    var viewHeight = doc.dom.defaultView.innerHeight;\n    intoWindowIfNeeded(doc, scrollTop, viewHeight, marker, alignToTop);\n  };\n\n  var intoFrame = function (doc, scrollTop, marker, alignToTop) {\n    var frameViewHeight = doc.dom.defaultView.innerHeight;\n    intoWindowIfNeeded(doc, scrollTop, frameViewHeight, marker, alignToTop);\n    var op = find$2(marker.element);\n    var viewportBounds = getBounds(window);\n\n    if (op.top < viewportBounds.y) {\n      intoView(marker.element, alignToTop !== false);\n    } else if (op.top > viewportBounds.bottom) {\n      intoView(marker.element, alignToTop === true);\n    }\n  };\n\n  var rangeIntoWindow = function (editor, rng, alignToTop) {\n    return withMarker(editor, intoWindow, rng, alignToTop);\n  };\n\n  var elementIntoWindow = function (editor, element, alignToTop) {\n    return withElement(editor, element, intoWindow, alignToTop);\n  };\n\n  var rangeIntoFrame = function (editor, rng, alignToTop) {\n    return withMarker(editor, intoFrame, rng, alignToTop);\n  };\n\n  var elementIntoFrame = function (editor, element, alignToTop) {\n    return withElement(editor, element, intoFrame, alignToTop);\n  };\n\n  var scrollElementIntoView = function (editor, element, alignToTop) {\n    var scroller = editor.inline ? elementIntoWindow : elementIntoFrame;\n    scroller(editor, element, alignToTop);\n  };\n\n  var scrollRangeIntoView = function (editor, rng, alignToTop) {\n    var scroller = editor.inline ? rangeIntoWindow : rangeIntoFrame;\n    scroller(editor, rng, alignToTop);\n  };\n\n  var getDocument = function () {\n    return SugarElement.fromDom(document);\n  };\n\n  var focus = function (element) {\n    return element.dom.focus();\n  };\n\n  var hasFocus = function (element) {\n    var root = getRootNode(element).dom;\n    return element.dom === root.activeElement;\n  };\n\n  var active = function (root) {\n    if (root === void 0) {\n      root = getDocument();\n    }\n\n    return Optional.from(root.dom.activeElement).map(SugarElement.fromDom);\n  };\n\n  var search = function (element) {\n    return active(getRootNode(element)).filter(function (e) {\n      return element.dom.contains(e.dom);\n    });\n  };\n\n  var create$4 = function (start, soffset, finish, foffset) {\n    return {\n      start: start,\n      soffset: soffset,\n      finish: finish,\n      foffset: foffset\n    };\n  };\n\n  var SimRange = {\n    create: create$4\n  };\n  var adt = Adt.generate([{\n    before: ['element']\n  }, {\n    on: ['element', 'offset']\n  }, {\n    after: ['element']\n  }]);\n\n  var cata = function (subject, onBefore, onOn, onAfter) {\n    return subject.fold(onBefore, onOn, onAfter);\n  };\n\n  var getStart = function (situ) {\n    return situ.fold(identity, identity, identity);\n  };\n\n  var before$3 = adt.before;\n  var on = adt.on;\n  var after$2 = adt.after;\n  var Situ = {\n    before: before$3,\n    on: on,\n    after: after$2,\n    cata: cata,\n    getStart: getStart\n  };\n  var adt$1 = Adt.generate([{\n    domRange: ['rng']\n  }, {\n    relative: ['startSitu', 'finishSitu']\n  }, {\n    exact: ['start', 'soffset', 'finish', 'foffset']\n  }]);\n\n  var exactFromRange = function (simRange) {\n    return adt$1.exact(simRange.start, simRange.soffset, simRange.finish, simRange.foffset);\n  };\n\n  var getStart$1 = function (selection) {\n    return selection.match({\n      domRange: function (rng) {\n        return SugarElement.fromDom(rng.startContainer);\n      },\n      relative: function (startSitu, _finishSitu) {\n        return Situ.getStart(startSitu);\n      },\n      exact: function (start, _soffset, _finish, _foffset) {\n        return start;\n      }\n    });\n  };\n\n  var domRange = adt$1.domRange;\n  var relative = adt$1.relative;\n  var exact = adt$1.exact;\n\n  var getWin = function (selection) {\n    var start = getStart$1(selection);\n    return defaultView(start);\n  };\n\n  var range = SimRange.create;\n  var SimSelection = {\n    domRange: domRange,\n    relative: relative,\n    exact: exact,\n    exactFromRange: exactFromRange,\n    getWin: getWin,\n    range: range\n  };\n  var browser$3 = detect$3().browser;\n\n  var clamp = function (offset, element) {\n    var max = isText(element) ? get$8(element).length : children(element).length + 1;\n\n    if (offset > max) {\n      return max;\n    } else if (offset < 0) {\n      return 0;\n    }\n\n    return offset;\n  };\n\n  var normalizeRng = function (rng) {\n    return SimSelection.range(rng.start, clamp(rng.soffset, rng.start), rng.finish, clamp(rng.foffset, rng.finish));\n  };\n\n  var isOrContains = function (root, elm) {\n    return !isRestrictedNode(elm.dom) && (contains$2(root, elm) || eq$2(root, elm));\n  };\n\n  var isRngInRoot = function (root) {\n    return function (rng) {\n      return isOrContains(root, rng.start) && isOrContains(root, rng.finish);\n    };\n  };\n\n  var shouldStore = function (editor) {\n    return editor.inline === true || browser$3.isIE();\n  };\n\n  var nativeRangeToSelectionRange = function (r) {\n    return SimSelection.range(SugarElement.fromDom(r.startContainer), r.startOffset, SugarElement.fromDom(r.endContainer), r.endOffset);\n  };\n\n  var readRange = function (win) {\n    var selection = win.getSelection();\n    var rng = !selection || selection.rangeCount === 0 ? Optional.none() : Optional.from(selection.getRangeAt(0));\n    return rng.map(nativeRangeToSelectionRange);\n  };\n\n  var getBookmark$2 = function (root) {\n    var win = defaultView(root);\n    return readRange(win.dom).filter(isRngInRoot(root));\n  };\n\n  var validate = function (root, bookmark) {\n    return Optional.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng);\n  };\n\n  var bookmarkToNativeRng = function (bookmark) {\n    var rng = document.createRange();\n\n    try {\n      rng.setStart(bookmark.start.dom, bookmark.soffset);\n      rng.setEnd(bookmark.finish.dom, bookmark.foffset);\n      return Optional.some(rng);\n    } catch (_) {\n      return Optional.none();\n    }\n  };\n\n  var store = function (editor) {\n    var newBookmark = shouldStore(editor) ? getBookmark$2(SugarElement.fromDom(editor.getBody())) : Optional.none();\n    editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\n  };\n\n  var storeNative = function (editor, rng) {\n    var root = SugarElement.fromDom(editor.getBody());\n    var range = shouldStore(editor) ? Optional.from(rng) : Optional.none();\n    var newBookmark = range.map(nativeRangeToSelectionRange).filter(isRngInRoot(root));\n    editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\n  };\n\n  var getRng = function (editor) {\n    var bookmark = editor.bookmark ? editor.bookmark : Optional.none();\n    return bookmark.bind(function (x) {\n      return validate(SugarElement.fromDom(editor.getBody()), x);\n    }).bind(bookmarkToNativeRng);\n  };\n\n  var restore = function (editor) {\n    getRng(editor).each(function (rng) {\n      return editor.selection.setRng(rng);\n    });\n  };\n\n  var isEditorUIElement = function (elm) {\n    var className = elm.className.toString();\n    return className.indexOf('tox-') !== -1 || className.indexOf('mce-') !== -1;\n  };\n\n  var FocusManager = {\n    isEditorUIElement: isEditorUIElement\n  };\n\n  var isManualNodeChange = function (e) {\n    return e.type === 'nodechange' && e.selectionChange;\n  };\n\n  var registerPageMouseUp = function (editor, throttledStore) {\n    var mouseUpPage = function () {\n      throttledStore.throttle();\n    };\n\n    DOMUtils$1.DOM.bind(document, 'mouseup', mouseUpPage);\n    editor.on('remove', function () {\n      DOMUtils$1.DOM.unbind(document, 'mouseup', mouseUpPage);\n    });\n  };\n\n  var registerFocusOut = function (editor) {\n    editor.on('focusout', function () {\n      store(editor);\n    });\n  };\n\n  var registerMouseUp = function (editor, throttledStore) {\n    editor.on('mouseup touchend', function (_e) {\n      throttledStore.throttle();\n    });\n  };\n\n  var registerEditorEvents = function (editor, throttledStore) {\n    var browser = detect$3().browser;\n\n    if (browser.isIE()) {\n      registerFocusOut(editor);\n    } else {\n      registerMouseUp(editor, throttledStore);\n    }\n\n    editor.on('keyup NodeChange', function (e) {\n      if (!isManualNodeChange(e)) {\n        store(editor);\n      }\n    });\n  };\n\n  var register = function (editor) {\n    var throttledStore = first(function () {\n      store(editor);\n    }, 0);\n    editor.on('init', function () {\n      if (editor.inline) {\n        registerPageMouseUp(editor, throttledStore);\n      }\n\n      registerEditorEvents(editor, throttledStore);\n    });\n    editor.on('remove', function () {\n      throttledStore.cancel();\n    });\n  };\n\n  var documentFocusInHandler;\n  var DOM$2 = DOMUtils$1.DOM;\n\n  var isEditorUIElement$1 = function (elm) {\n    return FocusManager.isEditorUIElement(elm);\n  };\n\n  var isEditorContentAreaElement = function (elm) {\n    var classList = elm.classList;\n\n    if (classList !== undefined) {\n      return classList.contains('tox-edit-area') || classList.contains('tox-edit-area__iframe') || classList.contains('mce-content-body');\n    } else {\n      return false;\n    }\n  };\n\n  var isUIElement = function (editor, elm) {\n    var customSelector = getCustomUiSelector(editor);\n    var parent = DOM$2.getParent(elm, function (elm) {\n      return isEditorUIElement$1(elm) || (customSelector ? editor.dom.is(elm, customSelector) : false);\n    });\n    return parent !== null;\n  };\n\n  var getActiveElement = function (editor) {\n    try {\n      var root = getRootNode(SugarElement.fromDom(editor.getElement()));\n      return active(root).fold(function () {\n        return document.body;\n      }, function (x) {\n        return x.dom;\n      });\n    } catch (ex) {\n      return document.body;\n    }\n  };\n\n  var registerEvents = function (editorManager, e) {\n    var editor = e.editor;\n    register(editor);\n    editor.on('focusin', function () {\n      var self = this;\n      var focusedEditor = editorManager.focusedEditor;\n\n      if (focusedEditor !== self) {\n        if (focusedEditor) {\n          focusedEditor.fire('blur', {\n            focusedEditor: self\n          });\n        }\n\n        editorManager.setActive(self);\n        editorManager.focusedEditor = self;\n        self.fire('focus', {\n          blurredEditor: focusedEditor\n        });\n        self.focus(true);\n      }\n    });\n    editor.on('focusout', function () {\n      var self = this;\n      Delay.setEditorTimeout(self, function () {\n        var focusedEditor = editorManager.focusedEditor;\n\n        if (!isUIElement(self, getActiveElement(self)) && focusedEditor === self) {\n          self.fire('blur', {\n            focusedEditor: null\n          });\n          editorManager.focusedEditor = null;\n        }\n      });\n    });\n\n    if (!documentFocusInHandler) {\n      documentFocusInHandler = function (e) {\n        var activeEditor = editorManager.activeEditor;\n\n        if (activeEditor) {\n          getOriginalEventTarget(e).each(function (target) {\n            if (target.ownerDocument === document) {\n              if (target !== document.body && !isUIElement(activeEditor, target) && editorManager.focusedEditor === activeEditor) {\n                activeEditor.fire('blur', {\n                  focusedEditor: null\n                });\n                editorManager.focusedEditor = null;\n              }\n            }\n          });\n        }\n      };\n\n      DOM$2.bind(document, 'focusin', documentFocusInHandler);\n    }\n  };\n\n  var unregisterDocumentEvents = function (editorManager, e) {\n    if (editorManager.focusedEditor === e.editor) {\n      editorManager.focusedEditor = null;\n    }\n\n    if (!editorManager.activeEditor) {\n      DOM$2.unbind(document, 'focusin', documentFocusInHandler);\n      documentFocusInHandler = null;\n    }\n  };\n\n  var setup$2 = function (editorManager) {\n    editorManager.on('AddEditor', curry(registerEvents, editorManager));\n    editorManager.on('RemoveEditor', curry(unregisterDocumentEvents, editorManager));\n  };\n\n  var getContentEditableHost = function (editor, node) {\n    return editor.dom.getParent(node, function (node) {\n      return editor.dom.getContentEditable(node) === 'true';\n    });\n  };\n\n  var getCollapsedNode = function (rng) {\n    return rng.collapsed ? Optional.from(getNode(rng.startContainer, rng.startOffset)).map(SugarElement.fromDom) : Optional.none();\n  };\n\n  var getFocusInElement = function (root, rng) {\n    return getCollapsedNode(rng).bind(function (node) {\n      if (isTableSection(node)) {\n        return Optional.some(node);\n      } else if (contains$2(root, node) === false) {\n        return Optional.some(root);\n      } else {\n        return Optional.none();\n      }\n    });\n  };\n\n  var normalizeSelection = function (editor, rng) {\n    getFocusInElement(SugarElement.fromDom(editor.getBody()), rng).bind(function (elm) {\n      return firstPositionIn(elm.dom);\n    }).fold(function () {\n      editor.selection.normalize();\n      return;\n    }, function (caretPos) {\n      return editor.selection.setRng(caretPos.toRange());\n    });\n  };\n\n  var focusBody = function (body) {\n    if (body.setActive) {\n      try {\n        body.setActive();\n      } catch (ex) {\n        body.focus();\n      }\n    } else {\n      body.focus();\n    }\n  };\n\n  var hasElementFocus = function (elm) {\n    return hasFocus(elm) || search(elm).isSome();\n  };\n\n  var hasIframeFocus = function (editor) {\n    return editor.iframeElement && hasFocus(SugarElement.fromDom(editor.iframeElement));\n  };\n\n  var hasInlineFocus = function (editor) {\n    var rawBody = editor.getBody();\n    return rawBody && hasElementFocus(SugarElement.fromDom(rawBody));\n  };\n\n  var hasUiFocus = function (editor) {\n    return active().filter(function (elem) {\n      return !isEditorContentAreaElement(elem.dom) && isUIElement(editor, elem.dom);\n    }).isSome();\n  };\n\n  var hasFocus$1 = function (editor) {\n    return editor.inline ? hasInlineFocus(editor) : hasIframeFocus(editor);\n  };\n\n  var hasEditorOrUiFocus = function (editor) {\n    return hasFocus$1(editor) || hasUiFocus(editor);\n  };\n\n  var focusEditor = function (editor) {\n    var selection = editor.selection;\n    var body = editor.getBody();\n    var rng = selection.getRng();\n    editor.quirks.refreshContentEditable();\n\n    if (editor.bookmark !== undefined && hasFocus$1(editor) === false) {\n      getRng(editor).each(function (bookmarkRng) {\n        editor.selection.setRng(bookmarkRng);\n        rng = bookmarkRng;\n      });\n    }\n\n    var contentEditableHost = getContentEditableHost(editor, selection.getNode());\n\n    if (editor.$.contains(body, contentEditableHost)) {\n      focusBody(contentEditableHost);\n      normalizeSelection(editor, rng);\n      activateEditor(editor);\n      return;\n    }\n\n    if (!editor.inline) {\n      if (!Env.opera) {\n        focusBody(body);\n      }\n\n      editor.getWin().focus();\n    }\n\n    if (Env.gecko || editor.inline) {\n      focusBody(body);\n      normalizeSelection(editor, rng);\n    }\n\n    activateEditor(editor);\n  };\n\n  var activateEditor = function (editor) {\n    return editor.editorManager.setActive(editor);\n  };\n\n  var focus$1 = function (editor, skipFocus) {\n    if (editor.removed) {\n      return;\n    }\n\n    skipFocus ? activateEditor(editor) : focusEditor(editor);\n  };\n\n  var getEndpointElement = function (root, rng, start, real, resolve) {\n    var container = start ? rng.startContainer : rng.endContainer;\n    var offset = start ? rng.startOffset : rng.endOffset;\n    return Optional.from(container).map(SugarElement.fromDom).map(function (elm) {\n      return !real || !rng.collapsed ? child(elm, resolve(elm, offset)).getOr(elm) : elm;\n    }).bind(function (elm) {\n      return isElement(elm) ? Optional.some(elm) : parent(elm).filter(isElement);\n    }).map(function (elm) {\n      return elm.dom;\n    }).getOr(root);\n  };\n\n  var getStart$2 = function (root, rng, real) {\n    return getEndpointElement(root, rng, true, real, function (elm, offset) {\n      return Math.min(childNodesCount(elm), offset);\n    });\n  };\n\n  var getEnd = function (root, rng, real) {\n    return getEndpointElement(root, rng, false, real, function (elm, offset) {\n      return offset > 0 ? offset - 1 : offset;\n    });\n  };\n\n  var skipEmptyTextNodes = function (node, forwards) {\n    var orig = node;\n\n    while (node && isText$1(node) && node.length === 0) {\n      node = forwards ? node.nextSibling : node.previousSibling;\n    }\n\n    return node || orig;\n  };\n\n  var getNode$1 = function (root, rng) {\n    var elm, startContainer, endContainer;\n\n    if (!rng) {\n      return root;\n    }\n\n    startContainer = rng.startContainer;\n    endContainer = rng.endContainer;\n    var startOffset = rng.startOffset;\n    var endOffset = rng.endOffset;\n    elm = rng.commonAncestorContainer;\n\n    if (!rng.collapsed) {\n      if (startContainer === endContainer) {\n        if (endOffset - startOffset < 2) {\n          if (startContainer.hasChildNodes()) {\n            elm = startContainer.childNodes[startOffset];\n          }\n        }\n      }\n\n      if (startContainer.nodeType === 3 && endContainer.nodeType === 3) {\n        if (startContainer.length === startOffset) {\n          startContainer = skipEmptyTextNodes(startContainer.nextSibling, true);\n        } else {\n          startContainer = startContainer.parentNode;\n        }\n\n        if (endOffset === 0) {\n          endContainer = skipEmptyTextNodes(endContainer.previousSibling, false);\n        } else {\n          endContainer = endContainer.parentNode;\n        }\n\n        if (startContainer && startContainer === endContainer) {\n          return startContainer;\n        }\n      }\n    }\n\n    if (elm && elm.nodeType === 3) {\n      return elm.parentNode;\n    }\n\n    return elm;\n  };\n\n  var getSelectedBlocks = function (dom, rng, startElm, endElm) {\n    var node;\n    var selectedBlocks = [];\n    var root = dom.getRoot();\n    startElm = dom.getParent(startElm || getStart$2(root, rng, rng.collapsed), dom.isBlock);\n    endElm = dom.getParent(endElm || getEnd(root, rng, rng.collapsed), dom.isBlock);\n\n    if (startElm && startElm !== root) {\n      selectedBlocks.push(startElm);\n    }\n\n    if (startElm && endElm && startElm !== endElm) {\n      node = startElm;\n      var walker = new DomTreeWalker(startElm, root);\n\n      while ((node = walker.next()) && node !== endElm) {\n        if (dom.isBlock(node)) {\n          selectedBlocks.push(node);\n        }\n      }\n    }\n\n    if (endElm && startElm !== endElm && endElm !== root) {\n      selectedBlocks.push(endElm);\n    }\n\n    return selectedBlocks;\n  };\n\n  var select$1 = function (dom, node, content) {\n    return Optional.from(node).map(function (node) {\n      var idx = dom.nodeIndex(node);\n      var rng = dom.createRng();\n      rng.setStart(node.parentNode, idx);\n      rng.setEnd(node.parentNode, idx + 1);\n\n      if (content) {\n        moveEndPoint$1(dom, rng, node, true);\n        moveEndPoint$1(dom, rng, node, false);\n      }\n\n      return rng;\n    });\n  };\n\n  var processRanges = function (editor, ranges) {\n    return map(ranges, function (range) {\n      var evt = editor.fire('GetSelectionRange', {\n        range: range\n      });\n      return evt.range !== range ? evt.range : range;\n    });\n  };\n\n  var ensureIsRoot = function (isRoot) {\n    return isFunction(isRoot) ? isRoot : never;\n  };\n\n  var ancestor$3 = function (scope, transform, isRoot) {\n    var element = scope.dom;\n    var stop = ensureIsRoot(isRoot);\n\n    while (element.parentNode) {\n      element = element.parentNode;\n      var el = SugarElement.fromDom(element);\n      var transformed = transform(el);\n\n      if (transformed.isSome()) {\n        return transformed;\n      } else if (stop(el)) {\n        break;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var closest$2 = function (scope, transform, isRoot) {\n    var current = transform(scope);\n    var stop = ensureIsRoot(isRoot);\n    return current.orThunk(function () {\n      return stop(scope) ? Optional.none() : ancestor$3(scope, transform, stop);\n    });\n  };\n\n  var isEq$2 = isEq;\n\n  var matchesUnInheritedFormatSelector = function (ed, node, name) {\n    var formatList = ed.formatter.get(name);\n\n    if (formatList) {\n      for (var i = 0; i < formatList.length; i++) {\n        if (formatList[i].inherit === false && ed.dom.is(node, formatList[i].selector)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  var matchParents = function (editor, node, name, vars) {\n    var root = editor.dom.getRoot();\n\n    if (node === root) {\n      return false;\n    }\n\n    node = editor.dom.getParent(node, function (node) {\n      if (matchesUnInheritedFormatSelector(editor, node, name)) {\n        return true;\n      }\n\n      return node.parentNode === root || !!matchNode(editor, node, name, vars, true);\n    });\n    return matchNode(editor, node, name, vars);\n  };\n\n  var matchName = function (dom, node, format) {\n    if (isEq$2(node, format.inline)) {\n      return true;\n    }\n\n    if (isEq$2(node, format.block)) {\n      return true;\n    }\n\n    if (format.selector) {\n      return node.nodeType === 1 && dom.is(node, format.selector);\n    }\n  };\n\n  var matchItems = function (dom, node, format, itemName, similar, vars) {\n    var key, value;\n    var items = format[itemName];\n    var i;\n\n    if (format.onmatch) {\n      return format.onmatch(node, format, itemName);\n    }\n\n    if (items) {\n      if (typeof items.length === 'undefined') {\n        for (key in items) {\n          if (items.hasOwnProperty(key)) {\n            if (itemName === 'attributes') {\n              value = dom.getAttrib(node, key);\n            } else {\n              value = getStyle(dom, node, key);\n            }\n\n            if (similar && !value && !format.exact) {\n              return;\n            }\n\n            if ((!similar || format.exact) && !isEq$2(value, normalizeStyleValue(dom, replaceVars(items[key], vars), key))) {\n              return;\n            }\n          }\n        }\n      } else {\n        for (i = 0; i < items.length; i++) {\n          if (itemName === 'attributes' ? dom.getAttrib(node, items[i]) : getStyle(dom, node, items[i])) {\n            return format;\n          }\n        }\n      }\n    }\n\n    return format;\n  };\n\n  var matchNode = function (ed, node, name, vars, similar) {\n    var formatList = ed.formatter.get(name);\n    var format, i, x, classes;\n    var dom = ed.dom;\n\n    if (formatList && node) {\n      for (i = 0; i < formatList.length; i++) {\n        format = formatList[i];\n\n        if (matchName(ed.dom, node, format) && matchItems(dom, node, format, 'attributes', similar, vars) && matchItems(dom, node, format, 'styles', similar, vars)) {\n          if (classes = format.classes) {\n            for (x = 0; x < classes.length; x++) {\n              if (!ed.dom.hasClass(node, classes[x])) {\n                return;\n              }\n            }\n          }\n\n          return format;\n        }\n      }\n    }\n  };\n\n  var match = function (editor, name, vars, node) {\n    if (node) {\n      return matchParents(editor, node, name, vars);\n    }\n\n    node = editor.selection.getNode();\n\n    if (matchParents(editor, node, name, vars)) {\n      return true;\n    }\n\n    var startNode = editor.selection.getStart();\n\n    if (startNode !== node) {\n      if (matchParents(editor, startNode, name, vars)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var matchAll = function (editor, names, vars) {\n    var matchedFormatNames = [];\n    var checkedMap = {};\n    var startElement = editor.selection.getStart();\n    editor.dom.getParent(startElement, function (node) {\n      for (var i = 0; i < names.length; i++) {\n        var name_1 = names[i];\n\n        if (!checkedMap[name_1] && matchNode(editor, node, name_1, vars)) {\n          checkedMap[name_1] = true;\n          matchedFormatNames.push(name_1);\n        }\n      }\n    }, editor.dom.getRoot());\n    return matchedFormatNames;\n  };\n\n  var closest$3 = function (editor, names) {\n    var isRoot = function (elm) {\n      return eq$2(elm, SugarElement.fromDom(editor.getBody()));\n    };\n\n    var match = function (elm, name) {\n      return matchNode(editor, elm.dom, name) ? Optional.some(name) : Optional.none();\n    };\n\n    return Optional.from(editor.selection.getStart(true)).bind(function (rawElm) {\n      return closest$2(SugarElement.fromDom(rawElm), function (elm) {\n        return findMap(names, function (name) {\n          return match(elm, name);\n        });\n      }, isRoot);\n    }).getOrNull();\n  };\n\n  var canApply = function (editor, name) {\n    var formatList = editor.formatter.get(name);\n    var startNode, parents, i, x, selector;\n    var dom = editor.dom;\n\n    if (formatList) {\n      startNode = editor.selection.getStart();\n      parents = getParents$1(dom, startNode);\n\n      for (x = formatList.length - 1; x >= 0; x--) {\n        selector = formatList[x].selector;\n\n        if (!selector || formatList[x].defaultBlock) {\n          return true;\n        }\n\n        for (i = parents.length - 1; i >= 0; i--) {\n          if (dom.is(parents[i], selector)) {\n            return true;\n          }\n        }\n      }\n    }\n\n    return false;\n  };\n\n  var matchAllOnNode = function (editor, node, formatNames) {\n    return foldl(formatNames, function (acc, name) {\n      var matchSimilar = isVariableFormatName(editor, name);\n\n      if (editor.formatter.matchNode(node, name, {}, matchSimilar)) {\n        return acc.concat([name]);\n      } else {\n        return acc;\n      }\n    }, []);\n  };\n\n  var typeLookup = {\n    '#text': 3,\n    '#comment': 8,\n    '#cdata': 4,\n    '#pi': 7,\n    '#doctype': 10,\n    '#document-fragment': 11\n  };\n\n  var walk$2 = function (node, root, prev) {\n    var startName = prev ? 'lastChild' : 'firstChild';\n    var siblingName = prev ? 'prev' : 'next';\n\n    if (node[startName]) {\n      return node[startName];\n    }\n\n    if (node !== root) {\n      var sibling = node[siblingName];\n\n      if (sibling) {\n        return sibling;\n      }\n\n      for (var parent_1 = node.parent; parent_1 && parent_1 !== root; parent_1 = parent_1.parent) {\n        sibling = parent_1[siblingName];\n\n        if (sibling) {\n          return sibling;\n        }\n      }\n    }\n  };\n\n  var isEmptyTextNode$1 = function (node) {\n    if (!isWhitespaceText(node.value)) {\n      return false;\n    }\n\n    var parentNode = node.parent;\n\n    if (parentNode && (parentNode.name !== 'span' || parentNode.attr('style')) && /^[ ]+$/.test(node.value)) {\n      return false;\n    }\n\n    return true;\n  };\n\n  var isNonEmptyElement = function (node) {\n    var isNamedAnchor = node.name === 'a' && !node.attr('href') && node.attr('id');\n    return node.attr('name') || node.attr('id') && !node.firstChild || node.attr('data-mce-bookmark') || isNamedAnchor;\n  };\n\n  var AstNode = function () {\n    function AstNode(name, type) {\n      this.name = name;\n      this.type = type;\n\n      if (type === 1) {\n        this.attributes = [];\n        this.attributes.map = {};\n      }\n    }\n\n    AstNode.create = function (name, attrs) {\n      var node = new AstNode(name, typeLookup[name] || 1);\n\n      if (attrs) {\n        each$1(attrs, function (value, attrName) {\n          node.attr(attrName, value);\n        });\n      }\n\n      return node;\n    };\n\n    AstNode.prototype.replace = function (node) {\n      var self = this;\n\n      if (node.parent) {\n        node.remove();\n      }\n\n      self.insert(node, self);\n      self.remove();\n      return self;\n    };\n\n    AstNode.prototype.attr = function (name, value) {\n      var self = this;\n      var attrs;\n\n      if (typeof name !== 'string') {\n        if (name !== undefined && name !== null) {\n          each$1(name, function (value, key) {\n            self.attr(key, value);\n          });\n        }\n\n        return self;\n      }\n\n      if (attrs = self.attributes) {\n        if (value !== undefined) {\n          if (value === null) {\n            if (name in attrs.map) {\n              delete attrs.map[name];\n              var i = attrs.length;\n\n              while (i--) {\n                if (attrs[i].name === name) {\n                  attrs.splice(i, 1);\n                  return self;\n                }\n              }\n            }\n\n            return self;\n          }\n\n          if (name in attrs.map) {\n            var i = attrs.length;\n\n            while (i--) {\n              if (attrs[i].name === name) {\n                attrs[i].value = value;\n                break;\n              }\n            }\n          } else {\n            attrs.push({\n              name: name,\n              value: value\n            });\n          }\n\n          attrs.map[name] = value;\n          return self;\n        }\n\n        return attrs.map[name];\n      }\n    };\n\n    AstNode.prototype.clone = function () {\n      var self = this;\n      var clone = new AstNode(self.name, self.type);\n      var selfAttrs;\n\n      if (selfAttrs = self.attributes) {\n        var cloneAttrs = [];\n        cloneAttrs.map = {};\n\n        for (var i = 0, l = selfAttrs.length; i < l; i++) {\n          var selfAttr = selfAttrs[i];\n\n          if (selfAttr.name !== 'id') {\n            cloneAttrs[cloneAttrs.length] = {\n              name: selfAttr.name,\n              value: selfAttr.value\n            };\n            cloneAttrs.map[selfAttr.name] = selfAttr.value;\n          }\n        }\n\n        clone.attributes = cloneAttrs;\n      }\n\n      clone.value = self.value;\n      clone.shortEnded = self.shortEnded;\n      return clone;\n    };\n\n    AstNode.prototype.wrap = function (wrapper) {\n      var self = this;\n      self.parent.insert(wrapper, self);\n      wrapper.append(self);\n      return self;\n    };\n\n    AstNode.prototype.unwrap = function () {\n      var self = this;\n\n      for (var node = self.firstChild; node;) {\n        var next = node.next;\n        self.insert(node, self, true);\n        node = next;\n      }\n\n      self.remove();\n    };\n\n    AstNode.prototype.remove = function () {\n      var self = this,\n          parent = self.parent,\n          next = self.next,\n          prev = self.prev;\n\n      if (parent) {\n        if (parent.firstChild === self) {\n          parent.firstChild = next;\n\n          if (next) {\n            next.prev = null;\n          }\n        } else {\n          prev.next = next;\n        }\n\n        if (parent.lastChild === self) {\n          parent.lastChild = prev;\n\n          if (prev) {\n            prev.next = null;\n          }\n        } else {\n          next.prev = prev;\n        }\n\n        self.parent = self.next = self.prev = null;\n      }\n\n      return self;\n    };\n\n    AstNode.prototype.append = function (node) {\n      var self = this;\n\n      if (node.parent) {\n        node.remove();\n      }\n\n      var last = self.lastChild;\n\n      if (last) {\n        last.next = node;\n        node.prev = last;\n        self.lastChild = node;\n      } else {\n        self.lastChild = self.firstChild = node;\n      }\n\n      node.parent = self;\n      return node;\n    };\n\n    AstNode.prototype.insert = function (node, refNode, before) {\n      if (node.parent) {\n        node.remove();\n      }\n\n      var parent = refNode.parent || this;\n\n      if (before) {\n        if (refNode === parent.firstChild) {\n          parent.firstChild = node;\n        } else {\n          refNode.prev.next = node;\n        }\n\n        node.prev = refNode.prev;\n        node.next = refNode;\n        refNode.prev = node;\n      } else {\n        if (refNode === parent.lastChild) {\n          parent.lastChild = node;\n        } else {\n          refNode.next.prev = node;\n        }\n\n        node.next = refNode.next;\n        node.prev = refNode;\n        refNode.next = node;\n      }\n\n      node.parent = parent;\n      return node;\n    };\n\n    AstNode.prototype.getAll = function (name) {\n      var self = this;\n      var collection = [];\n\n      for (var node = self.firstChild; node; node = walk$2(node, self)) {\n        if (node.name === name) {\n          collection.push(node);\n        }\n      }\n\n      return collection;\n    };\n\n    AstNode.prototype.empty = function () {\n      var self = this;\n\n      if (self.firstChild) {\n        var nodes = [];\n\n        for (var node = self.firstChild; node; node = walk$2(node, self)) {\n          nodes.push(node);\n        }\n\n        var i = nodes.length;\n\n        while (i--) {\n          var node = nodes[i];\n          node.parent = node.firstChild = node.lastChild = node.next = node.prev = null;\n        }\n      }\n\n      self.firstChild = self.lastChild = null;\n      return self;\n    };\n\n    AstNode.prototype.isEmpty = function (elements, whitespace, predicate) {\n      if (whitespace === void 0) {\n        whitespace = {};\n      }\n\n      var self = this;\n      var node = self.firstChild;\n\n      if (isNonEmptyElement(self)) {\n        return false;\n      }\n\n      if (node) {\n        do {\n          if (node.type === 1) {\n            if (node.attr('data-mce-bogus')) {\n              continue;\n            }\n\n            if (elements[node.name]) {\n              return false;\n            }\n\n            if (isNonEmptyElement(node)) {\n              return false;\n            }\n          }\n\n          if (node.type === 8) {\n            return false;\n          }\n\n          if (node.type === 3 && !isEmptyTextNode$1(node)) {\n            return false;\n          }\n\n          if (node.type === 3 && node.parent && whitespace[node.parent.name] && isWhitespaceText(node.value)) {\n            return false;\n          }\n\n          if (predicate && predicate(node)) {\n            return false;\n          }\n        } while (node = walk$2(node, self));\n      }\n\n      return true;\n    };\n\n    AstNode.prototype.walk = function (prev) {\n      return walk$2(this, null, prev);\n    };\n\n    return AstNode;\n  }();\n\n  var makeMap$3 = Tools.makeMap;\n\n  var Writer = function (settings) {\n    var html = [];\n    settings = settings || {};\n    var indent = settings.indent;\n    var indentBefore = makeMap$3(settings.indent_before || '');\n    var indentAfter = makeMap$3(settings.indent_after || '');\n    var encode = Entities.getEncodeFunc(settings.entity_encoding || 'raw', settings.entities);\n    var htmlOutput = settings.element_format === 'html';\n    return {\n      start: function (name, attrs, empty) {\n        var i, l, attr, value;\n\n        if (indent && indentBefore[name] && html.length > 0) {\n          value = html[html.length - 1];\n\n          if (value.length > 0 && value !== '\\n') {\n            html.push('\\n');\n          }\n        }\n\n        html.push('<', name);\n\n        if (attrs) {\n          for (i = 0, l = attrs.length; i < l; i++) {\n            attr = attrs[i];\n            html.push(' ', attr.name, '=\"', encode(attr.value, true), '\"');\n          }\n        }\n\n        if (!empty || htmlOutput) {\n          html[html.length] = '>';\n        } else {\n          html[html.length] = ' />';\n        }\n\n        if (empty && indent && indentAfter[name] && html.length > 0) {\n          value = html[html.length - 1];\n\n          if (value.length > 0 && value !== '\\n') {\n            html.push('\\n');\n          }\n        }\n      },\n      end: function (name) {\n        var value;\n        html.push('</', name, '>');\n\n        if (indent && indentAfter[name] && html.length > 0) {\n          value = html[html.length - 1];\n\n          if (value.length > 0 && value !== '\\n') {\n            html.push('\\n');\n          }\n        }\n      },\n      text: function (text, raw) {\n        if (text.length > 0) {\n          html[html.length] = raw ? text : encode(text);\n        }\n      },\n      cdata: function (text) {\n        html.push('<![CDATA[', text, ']]>');\n      },\n      comment: function (text) {\n        html.push('<!--', text, '-->');\n      },\n      pi: function (name, text) {\n        if (text) {\n          html.push('<?', name, ' ', encode(text), '?>');\n        } else {\n          html.push('<?', name, '?>');\n        }\n\n        if (indent) {\n          html.push('\\n');\n        }\n      },\n      doctype: function (text) {\n        html.push('<!DOCTYPE', text, '>', indent ? '\\n' : '');\n      },\n      reset: function () {\n        html.length = 0;\n      },\n      getContent: function () {\n        return html.join('').replace(/\\n$/, '');\n      }\n    };\n  };\n\n  var HtmlSerializer = function (settings, schema) {\n    if (schema === void 0) {\n      schema = Schema();\n    }\n\n    var writer = Writer(settings);\n    settings = settings || {};\n    settings.validate = 'validate' in settings ? settings.validate : true;\n\n    var serialize = function (node) {\n      var validate = settings.validate;\n      var handlers = {\n        3: function (node) {\n          writer.text(node.value, node.raw);\n        },\n        8: function (node) {\n          writer.comment(node.value);\n        },\n        7: function (node) {\n          writer.pi(node.name, node.value);\n        },\n        10: function (node) {\n          writer.doctype(node.value);\n        },\n        4: function (node) {\n          writer.cdata(node.value);\n        },\n        11: function (node) {\n          if (node = node.firstChild) {\n            do {\n              walk(node);\n            } while (node = node.next);\n          }\n        }\n      };\n      writer.reset();\n\n      var walk = function (node) {\n        var handler = handlers[node.type];\n        var name, isEmpty, attrs, attrName, attrValue, sortedAttrs, i, l, elementRule;\n\n        if (!handler) {\n          name = node.name;\n          isEmpty = node.shortEnded;\n          attrs = node.attributes;\n\n          if (validate && attrs && attrs.length > 1) {\n            sortedAttrs = [];\n            sortedAttrs.map = {};\n            elementRule = schema.getElementRule(node.name);\n\n            if (elementRule) {\n              for (i = 0, l = elementRule.attributesOrder.length; i < l; i++) {\n                attrName = elementRule.attributesOrder[i];\n\n                if (attrName in attrs.map) {\n                  attrValue = attrs.map[attrName];\n                  sortedAttrs.map[attrName] = attrValue;\n                  sortedAttrs.push({\n                    name: attrName,\n                    value: attrValue\n                  });\n                }\n              }\n\n              for (i = 0, l = attrs.length; i < l; i++) {\n                attrName = attrs[i].name;\n\n                if (!(attrName in sortedAttrs.map)) {\n                  attrValue = attrs.map[attrName];\n                  sortedAttrs.map[attrName] = attrValue;\n                  sortedAttrs.push({\n                    name: attrName,\n                    value: attrValue\n                  });\n                }\n              }\n\n              attrs = sortedAttrs;\n            }\n          }\n\n          writer.start(node.name, attrs, isEmpty);\n\n          if (!isEmpty) {\n            if (node = node.firstChild) {\n              do {\n                walk(node);\n              } while (node = node.next);\n            }\n\n            writer.end(name);\n          }\n        } else {\n          handler(node);\n        }\n      };\n\n      if (node.type === 1 && !settings.inner) {\n        walk(node);\n      } else {\n        handlers[11](node);\n      }\n\n      return writer.getContent();\n    };\n\n    return {\n      serialize: serialize\n    };\n  };\n\n  var extractBase64DataUris = function (html) {\n    var dataImageUri = /data:[^;]+;base64,([a-z0-9\\+\\/=]+)/gi;\n    var chunks = [];\n    var uris = {};\n    var prefix = generate$1('img');\n    var matches;\n    var index = 0;\n    var count = 0;\n\n    while (matches = dataImageUri.exec(html)) {\n      var uri = matches[0];\n      var imageId = prefix + '_' + count++;\n      uris[imageId] = uri;\n\n      if (index < matches.index) {\n        chunks.push(html.substr(index, matches.index - index));\n      }\n\n      chunks.push(imageId);\n      index = matches.index + uri.length;\n    }\n\n    if (index === 0) {\n      return {\n        prefix: prefix,\n        uris: uris,\n        html: html\n      };\n    } else {\n      if (index < html.length) {\n        chunks.push(html.substr(index));\n      }\n\n      return {\n        prefix: prefix,\n        uris: uris,\n        html: chunks.join('')\n      };\n    }\n  };\n\n  var restoreDataUris = function (html, result) {\n    return html.replace(new RegExp(result.prefix + '_[0-9]+', 'g'), function (imageId) {\n      return get$1(result.uris, imageId).getOr(imageId);\n    });\n  };\n\n  var parseDataUri = function (uri) {\n    var matches = /data:([^;]+);base64,([a-z0-9\\+\\/=]+)/i.exec(uri);\n\n    if (matches) {\n      return Optional.some({\n        type: matches[1],\n        data: decodeURIComponent(matches[2])\n      });\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var safeSvgDataUrlElements = ['img', 'video'];\n\n  var isValidPrefixAttrName = function (name) {\n    return name.indexOf('data-') === 0 || name.indexOf('aria-') === 0;\n  };\n\n  var blockSvgDataUris = function (allowSvgDataUrls, tagName) {\n    var allowed = isNullable(allowSvgDataUrls) ? contains(safeSvgDataUrlElements, tagName) : allowSvgDataUrls;\n    return !allowed;\n  };\n\n  var isInvalidUri = function (settings, uri, tagName) {\n    if (settings.allow_html_data_urls) {\n      return false;\n    } else if (/^data:image\\//i.test(uri)) {\n      return blockSvgDataUris(settings.allow_svg_data_urls, tagName) && /^data:image\\/svg\\+xml/i.test(uri);\n    } else {\n      return /^data:/i.test(uri);\n    }\n  };\n\n  var findEndTagIndex = function (schema, html, startIndex) {\n    var count = 1,\n        index,\n        matches;\n    var shortEndedElements = schema.getShortEndedElements();\n    var tokenRegExp = /<([!?\\/])?([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\/|\\s+)>/g;\n    tokenRegExp.lastIndex = index = startIndex;\n\n    while (matches = tokenRegExp.exec(html)) {\n      index = tokenRegExp.lastIndex;\n\n      if (matches[1] === '/') {\n        count--;\n      } else if (!matches[1]) {\n        if (matches[2] in shortEndedElements) {\n          continue;\n        }\n\n        count++;\n      }\n\n      if (count === 0) {\n        break;\n      }\n    }\n\n    return index;\n  };\n\n  var isConditionalComment = function (html, startIndex) {\n    return /^\\s*\\[if [\\w\\W]+\\]>.*<!\\[endif\\](--!?)?>/.test(html.substr(startIndex));\n  };\n\n  var findCommentEndIndex = function (html, isBogus, startIndex) {\n    if (startIndex === void 0) {\n      startIndex = 0;\n    }\n\n    var lcHtml = html.toLowerCase();\n\n    if (lcHtml.indexOf('[if ', startIndex) !== -1 && isConditionalComment(lcHtml, startIndex)) {\n      var endIfIndex = lcHtml.indexOf('[endif]', startIndex);\n      return lcHtml.indexOf('>', endIfIndex);\n    } else {\n      if (isBogus) {\n        var endIndex = lcHtml.indexOf('>', startIndex);\n        return endIndex !== -1 ? endIndex : lcHtml.length;\n      } else {\n        var endCommentRegexp = /--!?>/;\n        endCommentRegexp.lastIndex = startIndex;\n        var match = endCommentRegexp.exec(html);\n        return match ? match.index + match[0].length : lcHtml.length;\n      }\n    }\n  };\n\n  var checkBogusAttribute = function (regExp, attrString) {\n    var matches = regExp.exec(attrString);\n\n    if (matches) {\n      var name_1 = matches[1];\n      var value = matches[2];\n      return typeof name_1 === 'string' && name_1.toLowerCase() === 'data-mce-bogus' ? value : null;\n    } else {\n      return null;\n    }\n  };\n\n  function SaxParser(settings, schema) {\n    if (schema === void 0) {\n      schema = Schema();\n    }\n\n    var noop = function () {};\n\n    settings = settings || {};\n\n    if (settings.fix_self_closing !== false) {\n      settings.fix_self_closing = true;\n    }\n\n    var comment = settings.comment ? settings.comment : noop;\n    var cdata = settings.cdata ? settings.cdata : noop;\n    var text = settings.text ? settings.text : noop;\n    var start = settings.start ? settings.start : noop;\n    var end = settings.end ? settings.end : noop;\n    var pi = settings.pi ? settings.pi : noop;\n    var doctype = settings.doctype ? settings.doctype : noop;\n\n    var parseInternal = function (base64Extract, format) {\n      if (format === void 0) {\n        format = 'html';\n      }\n\n      var html = base64Extract.html;\n      var matches,\n          index = 0,\n          value,\n          endRegExp;\n      var stack = [];\n      var attrList, i, textData, name;\n      var isInternalElement, isShortEnded;\n      var elementRule, isValidElement, attr, attribsValue, validAttributesMap, validAttributePatterns;\n      var attributesRequired, attributesDefault, attributesForced;\n      var anyAttributesRequired,\n          attrValue,\n          idCount = 0;\n      var decode = Entities.decode;\n      var filteredUrlAttrs = Tools.makeMap('src,href,data,background,formaction,poster,xlink:href');\n      var scriptUriRegExp = /((java|vb)script|mhtml):/i;\n      var parsingMode = format === 'html' ? 0 : 1;\n\n      var processEndTag = function (name) {\n        var pos, i;\n        pos = stack.length;\n\n        while (pos--) {\n          if (stack[pos].name === name) {\n            break;\n          }\n        }\n\n        if (pos >= 0) {\n          for (i = stack.length - 1; i >= pos; i--) {\n            name = stack[i];\n\n            if (name.valid) {\n              end(name.name);\n            }\n          }\n\n          stack.length = pos;\n        }\n      };\n\n      var processText = function (value, raw) {\n        return text(restoreDataUris(value, base64Extract), raw);\n      };\n\n      var processComment = function (value) {\n        if (value === '') {\n          return;\n        }\n\n        if (value.charAt(0) === '>') {\n          value = ' ' + value;\n        }\n\n        if (!settings.allow_conditional_comments && value.substr(0, 3).toLowerCase() === '[if') {\n          value = ' ' + value;\n        }\n\n        comment(restoreDataUris(value, base64Extract));\n      };\n\n      var processAttr = function (value) {\n        return get$1(base64Extract.uris, value).getOr(value);\n      };\n\n      var processMalformedComment = function (value, startIndex) {\n        var startTag = value || '';\n        var isBogus = !startsWith(startTag, '--');\n        var endIndex = findCommentEndIndex(html, isBogus, startIndex);\n        value = html.substr(startIndex, endIndex - startIndex);\n        processComment(isBogus ? startTag + value : value);\n        return endIndex + 1;\n      };\n\n      var parseAttribute = function (tagName, name, value, val2, val3) {\n        var attrRule, i;\n        var trimRegExp = /[\\s\\u0000-\\u001F]+/g;\n        name = name.toLowerCase();\n        value = processAttr(name in fillAttrsMap ? name : decode(value || val2 || val3 || ''));\n\n        if (validate && !isInternalElement && isValidPrefixAttrName(name) === false) {\n          attrRule = validAttributesMap[name];\n\n          if (!attrRule && validAttributePatterns) {\n            i = validAttributePatterns.length;\n\n            while (i--) {\n              attrRule = validAttributePatterns[i];\n\n              if (attrRule.pattern.test(name)) {\n                break;\n              }\n            }\n\n            if (i === -1) {\n              attrRule = null;\n            }\n          }\n\n          if (!attrRule) {\n            return;\n          }\n\n          if (attrRule.validValues && !(value in attrRule.validValues)) {\n            return;\n          }\n        }\n\n        if (filteredUrlAttrs[name] && !settings.allow_script_urls) {\n          var uri = value.replace(trimRegExp, '');\n\n          try {\n            uri = decodeURIComponent(uri);\n          } catch (ex) {\n            uri = unescape(uri);\n          }\n\n          if (scriptUriRegExp.test(uri)) {\n            return;\n          }\n\n          if (isInvalidUri(settings, uri, tagName)) {\n            return;\n          }\n        }\n\n        if (isInternalElement && (name in filteredUrlAttrs || name.indexOf('on') === 0)) {\n          return;\n        }\n\n        attrList.map[name] = value;\n        attrList.push({\n          name: name,\n          value: value\n        });\n      };\n\n      var tokenRegExp = new RegExp('<(?:' + '(?:!--([\\\\w\\\\W]*?)--!?>)|' + '(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|' + '(?:![Dd][Oo][Cc][Tt][Yy][Pp][Ee]([\\\\w\\\\W]*?)>)|' + '(?:!(--)?)|' + '(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|' + '(?:\\\\/([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)>)|' + '(?:([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)((?:\\\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\\\/|\\\\s+)>)' + ')', 'g');\n      var attrRegExp = /([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:[^\\\"])*)\\\")|(?:\\'((?:[^\\'])*)\\')|([^>\\s]+)))?/g;\n      var shortEndedElements = schema.getShortEndedElements();\n      var selfClosing = settings.self_closing_elements || schema.getSelfClosingElements();\n      var fillAttrsMap = schema.getBoolAttrs();\n      var validate = settings.validate;\n      var removeInternalElements = settings.remove_internals;\n      var fixSelfClosing = settings.fix_self_closing;\n      var specialElements = schema.getSpecialElements();\n      var processHtml = html + '>';\n\n      while (matches = tokenRegExp.exec(processHtml)) {\n        var matchText = matches[0];\n\n        if (index < matches.index) {\n          processText(decode(html.substr(index, matches.index - index)));\n        }\n\n        if (value = matches[7]) {\n          value = value.toLowerCase();\n\n          if (value.charAt(0) === ':') {\n            value = value.substr(1);\n          }\n\n          processEndTag(value);\n        } else if (value = matches[8]) {\n          if (matches.index + matchText.length > html.length) {\n            processText(decode(html.substr(matches.index)));\n            index = matches.index + matchText.length;\n            continue;\n          }\n\n          value = value.toLowerCase();\n\n          if (value.charAt(0) === ':') {\n            value = value.substr(1);\n          }\n\n          isShortEnded = value in shortEndedElements;\n\n          if (fixSelfClosing && selfClosing[value] && stack.length > 0 && stack[stack.length - 1].name === value) {\n            processEndTag(value);\n          }\n\n          var bogusValue = checkBogusAttribute(attrRegExp, matches[9]);\n\n          if (bogusValue !== null) {\n            if (bogusValue === 'all') {\n              index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\n              tokenRegExp.lastIndex = index;\n              continue;\n            }\n\n            isValidElement = false;\n          }\n\n          if (!validate || (elementRule = schema.getElementRule(value))) {\n            isValidElement = true;\n\n            if (validate) {\n              validAttributesMap = elementRule.attributes;\n              validAttributePatterns = elementRule.attributePatterns;\n            }\n\n            if (attribsValue = matches[9]) {\n              isInternalElement = attribsValue.indexOf('data-mce-type') !== -1;\n\n              if (isInternalElement && removeInternalElements) {\n                isValidElement = false;\n              }\n\n              attrList = [];\n              attrList.map = {};\n              attribsValue.replace(attrRegExp, function (match, name, val, val2, val3) {\n                parseAttribute(value, name, val, val2, val3);\n                return '';\n              });\n            } else {\n              attrList = [];\n              attrList.map = {};\n            }\n\n            if (validate && !isInternalElement) {\n              attributesRequired = elementRule.attributesRequired;\n              attributesDefault = elementRule.attributesDefault;\n              attributesForced = elementRule.attributesForced;\n              anyAttributesRequired = elementRule.removeEmptyAttrs;\n\n              if (anyAttributesRequired && !attrList.length) {\n                isValidElement = false;\n              }\n\n              if (attributesForced) {\n                i = attributesForced.length;\n\n                while (i--) {\n                  attr = attributesForced[i];\n                  name = attr.name;\n                  attrValue = attr.value;\n\n                  if (attrValue === '{$uid}') {\n                    attrValue = 'mce_' + idCount++;\n                  }\n\n                  attrList.map[name] = attrValue;\n                  attrList.push({\n                    name: name,\n                    value: attrValue\n                  });\n                }\n              }\n\n              if (attributesDefault) {\n                i = attributesDefault.length;\n\n                while (i--) {\n                  attr = attributesDefault[i];\n                  name = attr.name;\n\n                  if (!(name in attrList.map)) {\n                    attrValue = attr.value;\n\n                    if (attrValue === '{$uid}') {\n                      attrValue = 'mce_' + idCount++;\n                    }\n\n                    attrList.map[name] = attrValue;\n                    attrList.push({\n                      name: name,\n                      value: attrValue\n                    });\n                  }\n                }\n              }\n\n              if (attributesRequired) {\n                i = attributesRequired.length;\n\n                while (i--) {\n                  if (attributesRequired[i] in attrList.map) {\n                    break;\n                  }\n                }\n\n                if (i === -1) {\n                  isValidElement = false;\n                }\n              }\n\n              if (attr = attrList.map['data-mce-bogus']) {\n                if (attr === 'all') {\n                  index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\n                  tokenRegExp.lastIndex = index;\n                  continue;\n                }\n\n                isValidElement = false;\n              }\n            }\n\n            if (isValidElement) {\n              start(value, attrList, isShortEnded);\n            }\n          } else {\n            isValidElement = false;\n          }\n\n          if (endRegExp = specialElements[value]) {\n            endRegExp.lastIndex = index = matches.index + matchText.length;\n\n            if (matches = endRegExp.exec(html)) {\n              if (isValidElement) {\n                textData = html.substr(index, matches.index - index);\n              }\n\n              index = matches.index + matches[0].length;\n            } else {\n              textData = html.substr(index);\n              index = html.length;\n            }\n\n            if (isValidElement) {\n              if (textData.length > 0) {\n                processText(textData, true);\n              }\n\n              end(value);\n            }\n\n            tokenRegExp.lastIndex = index;\n            continue;\n          }\n\n          if (!isShortEnded) {\n            if (!attribsValue || attribsValue.indexOf('/') !== attribsValue.length - 1) {\n              stack.push({\n                name: value,\n                valid: isValidElement\n              });\n            } else if (isValidElement) {\n              end(value);\n            }\n          }\n        } else if (value = matches[1]) {\n          processComment(value);\n        } else if (value = matches[2]) {\n          var isValidCdataSection = parsingMode === 1 || settings.preserve_cdata || stack.length > 0 && schema.isValidChild(stack[stack.length - 1].name, '#cdata');\n\n          if (isValidCdataSection) {\n            cdata(value);\n          } else {\n            index = processMalformedComment('', matches.index + 2);\n            tokenRegExp.lastIndex = index;\n            continue;\n          }\n        } else if (value = matches[3]) {\n          doctype(value);\n        } else if ((value = matches[4]) || matchText === '<!') {\n          index = processMalformedComment(value, matches.index + matchText.length);\n          tokenRegExp.lastIndex = index;\n          continue;\n        } else if (value = matches[5]) {\n          if (parsingMode === 1) {\n            pi(value, matches[6]);\n          } else {\n            index = processMalformedComment('?', matches.index + 2);\n            tokenRegExp.lastIndex = index;\n            continue;\n          }\n        }\n\n        index = matches.index + matchText.length;\n      }\n\n      if (index < html.length) {\n        processText(decode(html.substr(index)));\n      }\n\n      for (i = stack.length - 1; i >= 0; i--) {\n        value = stack[i];\n\n        if (value.valid) {\n          end(value.name);\n        }\n      }\n    };\n\n    var parse = function (html, format) {\n      if (format === void 0) {\n        format = 'html';\n      }\n\n      parseInternal(extractBase64DataUris(html), format);\n    };\n\n    return {\n      parse: parse\n    };\n  }\n\n  (function (SaxParser) {\n    SaxParser.findEndTag = findEndTagIndex;\n  })(SaxParser || (SaxParser = {}));\n\n  var SaxParser$1 = SaxParser;\n\n  var trimHtml = function (tempAttrs, html) {\n    var trimContentRegExp = new RegExp(['\\\\s?(' + tempAttrs.join('|') + ')=\"[^\"]+\"'].join('|'), 'gi');\n    return html.replace(trimContentRegExp, '');\n  };\n\n  var trimInternal = function (serializer, html) {\n    var content = html;\n    var bogusAllRegExp = /<(\\w+) [^>]*data-mce-bogus=\"all\"[^>]*>/g;\n    var endTagIndex, index, matchLength, matches;\n    var schema = serializer.schema;\n    content = trimHtml(serializer.getTempAttrs(), content);\n    var shortEndedElements = schema.getShortEndedElements();\n\n    while (matches = bogusAllRegExp.exec(content)) {\n      index = bogusAllRegExp.lastIndex;\n      matchLength = matches[0].length;\n\n      if (shortEndedElements[matches[1]]) {\n        endTagIndex = index;\n      } else {\n        endTagIndex = SaxParser$1.findEndTag(schema, content, index);\n      }\n\n      content = content.substring(0, index - matchLength) + content.substring(endTagIndex);\n      bogusAllRegExp.lastIndex = index - matchLength;\n    }\n\n    return trim$2(content);\n  };\n\n  var trimExternal = trimInternal;\n\n  var trimEmptyContents = function (editor, html) {\n    var blockName = getForcedRootBlock(editor);\n    var emptyRegExp = new RegExp('^(<' + blockName + '[^>]*>(&nbsp;|&#160;|\\\\s|\\xA0|<br \\\\/>|)<\\\\/' + blockName + '>[\\r\\n]*|<br \\\\/>[\\r\\n]*)$');\n    return html.replace(emptyRegExp, '');\n  };\n\n  var getContentFromBody = function (editor, args, format, body) {\n    var content;\n    args.format = format;\n    args.get = true;\n    args.getInner = true;\n\n    if (!args.no_events) {\n      editor.fire('BeforeGetContent', args);\n    }\n\n    if (args.format === 'raw') {\n      content = Tools.trim(trimExternal(editor.serializer, body.innerHTML));\n    } else if (args.format === 'text') {\n      content = editor.dom.isEmpty(body) ? '' : trim$2(body.innerText || body.textContent);\n    } else if (args.format === 'tree') {\n      content = editor.serializer.serialize(body, args);\n    } else {\n      content = trimEmptyContents(editor, editor.serializer.serialize(body, args));\n    }\n\n    if (!contains(['text', 'tree'], args.format) && !isWsPreserveElement(SugarElement.fromDom(body))) {\n      args.content = Tools.trim(content);\n    } else {\n      args.content = content;\n    }\n\n    if (!args.no_events) {\n      editor.fire('GetContent', args);\n    }\n\n    return args.content;\n  };\n\n  var getContentInternal = function (editor, args, format) {\n    return Optional.from(editor.getBody()).fold(constant(args.format === 'tree' ? new AstNode('body', 11) : ''), function (body) {\n      return getContentFromBody(editor, args, format, body);\n    });\n  };\n\n  var each$7 = Tools.each;\n\n  var ElementUtils = function (dom) {\n    this.compare = function (node1, node2) {\n      if (node1.nodeName !== node2.nodeName) {\n        return false;\n      }\n\n      var getAttribs = function (node) {\n        var attribs = {};\n        each$7(dom.getAttribs(node), function (attr) {\n          var name = attr.nodeName.toLowerCase();\n\n          if (name.indexOf('_') !== 0 && name !== 'style' && name.indexOf('data-') !== 0) {\n            attribs[name] = dom.getAttrib(node, name);\n          }\n        });\n        return attribs;\n      };\n\n      var compareObjects = function (obj1, obj2) {\n        var value, name;\n\n        for (name in obj1) {\n          if (obj1.hasOwnProperty(name)) {\n            value = obj2[name];\n\n            if (typeof value === 'undefined') {\n              return false;\n            }\n\n            if (obj1[name] !== value) {\n              return false;\n            }\n\n            delete obj2[name];\n          }\n        }\n\n        for (name in obj2) {\n          if (obj2.hasOwnProperty(name)) {\n            return false;\n          }\n        }\n\n        return true;\n      };\n\n      if (!compareObjects(getAttribs(node1), getAttribs(node2))) {\n        return false;\n      }\n\n      if (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style')))) {\n        return false;\n      }\n\n      return !isBookmarkNode$1(node1) && !isBookmarkNode$1(node2);\n    };\n  };\n\n  var isChar = function (forward, predicate, pos) {\n    return Optional.from(pos.container()).filter(isText$1).exists(function (text) {\n      var delta = forward ? 0 : -1;\n      return predicate(text.data.charAt(pos.offset() + delta));\n    });\n  };\n\n  var isBeforeSpace = curry(isChar, true, isWhiteSpace$1);\n  var isAfterSpace = curry(isChar, false, isWhiteSpace$1);\n\n  var isEmptyText = function (pos) {\n    var container = pos.container();\n    return isText$1(container) && (container.data.length === 0 || isZwsp$1(container.data) && BookmarkManager$1.isBookmarkNode(container.parentNode));\n  };\n\n  var matchesElementPosition = function (before, predicate) {\n    return function (pos) {\n      return Optional.from(getChildNodeAtRelativeOffset(before ? 0 : -1, pos)).filter(predicate).isSome();\n    };\n  };\n\n  var isImageBlock = function (node) {\n    return isImg(node) && get$5(SugarElement.fromDom(node), 'display') === 'block';\n  };\n\n  var isCefNode = function (node) {\n    return isContentEditableFalse(node) && !isBogusAll(node);\n  };\n\n  var isBeforeImageBlock = matchesElementPosition(true, isImageBlock);\n  var isAfterImageBlock = matchesElementPosition(false, isImageBlock);\n  var isBeforeMedia = matchesElementPosition(true, isMedia);\n  var isAfterMedia = matchesElementPosition(false, isMedia);\n  var isBeforeTable = matchesElementPosition(true, isTable);\n  var isAfterTable = matchesElementPosition(false, isTable);\n  var isBeforeContentEditableFalse = matchesElementPosition(true, isCefNode);\n  var isAfterContentEditableFalse = matchesElementPosition(false, isCefNode);\n\n  var getLastChildren$1 = function (elm) {\n    var children = [];\n    var rawNode = elm.dom;\n\n    while (rawNode) {\n      children.push(SugarElement.fromDom(rawNode));\n      rawNode = rawNode.lastChild;\n    }\n\n    return children;\n  };\n\n  var removeTrailingBr = function (elm) {\n    var allBrs = descendants$1(elm, 'br');\n    var brs = filter(getLastChildren$1(elm).slice(-1), isBr$1);\n\n    if (allBrs.length === brs.length) {\n      each(brs, remove);\n    }\n  };\n\n  var fillWithPaddingBr = function (elm) {\n    empty(elm);\n    append(elm, SugarElement.fromHtml('<br data-mce-bogus=\"1\">'));\n  };\n\n  var trimBlockTrailingBr = function (elm) {\n    lastChild(elm).each(function (lastChild) {\n      prevSibling(lastChild).each(function (lastChildPrevSibling) {\n        if (isBlock(elm) && isBr$1(lastChild) && isBlock(lastChildPrevSibling)) {\n          remove(lastChild);\n        }\n      });\n    });\n  };\n\n  var dropLast = function (xs) {\n    return xs.slice(0, -1);\n  };\n\n  var parentsUntil$1 = function (start, root, predicate) {\n    if (contains$2(root, start)) {\n      return dropLast(parents(start, function (elm) {\n        return predicate(elm) || eq$2(elm, root);\n      }));\n    } else {\n      return [];\n    }\n  };\n\n  var parents$1 = function (start, root) {\n    return parentsUntil$1(start, root, never);\n  };\n\n  var parentsAndSelf = function (start, root) {\n    return [start].concat(parents$1(start, root));\n  };\n\n  var navigateIgnoreEmptyTextNodes = function (forward, root, from) {\n    return navigateIgnore(forward, root, from, isEmptyText);\n  };\n\n  var getClosestBlock = function (root, pos) {\n    return find(parentsAndSelf(SugarElement.fromDom(pos.container()), root), isBlock);\n  };\n\n  var isAtBeforeAfterBlockBoundary = function (forward, root, pos) {\n    return navigateIgnoreEmptyTextNodes(forward, root.dom, pos).forall(function (newPos) {\n      return getClosestBlock(root, pos).fold(function () {\n        return isInSameBlock(newPos, pos, root.dom) === false;\n      }, function (fromBlock) {\n        return isInSameBlock(newPos, pos, root.dom) === false && contains$2(fromBlock, SugarElement.fromDom(newPos.container()));\n      });\n    });\n  };\n\n  var isAtBlockBoundary$1 = function (forward, root, pos) {\n    return getClosestBlock(root, pos).fold(function () {\n      return navigateIgnoreEmptyTextNodes(forward, root.dom, pos).forall(function (newPos) {\n        return isInSameBlock(newPos, pos, root.dom) === false;\n      });\n    }, function (parent) {\n      return navigateIgnoreEmptyTextNodes(forward, parent.dom, pos).isNone();\n    });\n  };\n\n  var isAtStartOfBlock = curry(isAtBlockBoundary$1, false);\n  var isAtEndOfBlock = curry(isAtBlockBoundary$1, true);\n  var isBeforeBlock = curry(isAtBeforeAfterBlockBoundary, false);\n  var isAfterBlock = curry(isAtBeforeAfterBlockBoundary, true);\n\n  var isBr$5 = function (pos) {\n    return getElementFromPosition(pos).exists(isBr$1);\n  };\n\n  var findBr = function (forward, root, pos) {\n    var parentBlocks = filter(parentsAndSelf(SugarElement.fromDom(pos.container()), root), isBlock);\n    var scope = head(parentBlocks).getOr(root);\n    return fromPosition(forward, scope.dom, pos).filter(isBr$5);\n  };\n\n  var isBeforeBr = function (root, pos) {\n    return getElementFromPosition(pos).exists(isBr$1) || findBr(true, root, pos).isSome();\n  };\n\n  var isAfterBr = function (root, pos) {\n    return getElementFromPrevPosition(pos).exists(isBr$1) || findBr(false, root, pos).isSome();\n  };\n\n  var findPreviousBr = curry(findBr, false);\n  var findNextBr = curry(findBr, true);\n\n  var isInMiddleOfText = function (pos) {\n    return CaretPosition.isTextPosition(pos) && !pos.isAtStart() && !pos.isAtEnd();\n  };\n\n  var getClosestBlock$1 = function (root, pos) {\n    var parentBlocks = filter(parentsAndSelf(SugarElement.fromDom(pos.container()), root), isBlock);\n    return head(parentBlocks).getOr(root);\n  };\n\n  var hasSpaceBefore = function (root, pos) {\n    if (isInMiddleOfText(pos)) {\n      return isAfterSpace(pos);\n    } else {\n      return isAfterSpace(pos) || prevPosition(getClosestBlock$1(root, pos).dom, pos).exists(isAfterSpace);\n    }\n  };\n\n  var hasSpaceAfter = function (root, pos) {\n    if (isInMiddleOfText(pos)) {\n      return isBeforeSpace(pos);\n    } else {\n      return isBeforeSpace(pos) || nextPosition(getClosestBlock$1(root, pos).dom, pos).exists(isBeforeSpace);\n    }\n  };\n\n  var isPreValue = function (value) {\n    return contains(['pre', 'pre-wrap'], value);\n  };\n\n  var isInPre = function (pos) {\n    return getElementFromPosition(pos).bind(function (elm) {\n      return closest(elm, isElement);\n    }).exists(function (elm) {\n      return isPreValue(get$5(elm, 'white-space'));\n    });\n  };\n\n  var isAtBeginningOfBody = function (root, pos) {\n    return prevPosition(root.dom, pos).isNone();\n  };\n\n  var isAtEndOfBody = function (root, pos) {\n    return nextPosition(root.dom, pos).isNone();\n  };\n\n  var isAtLineBoundary = function (root, pos) {\n    return isAtBeginningOfBody(root, pos) || isAtEndOfBody(root, pos) || isAtStartOfBlock(root, pos) || isAtEndOfBlock(root, pos) || isAfterBr(root, pos) || isBeforeBr(root, pos);\n  };\n\n  var needsToHaveNbsp = function (root, pos) {\n    if (isInPre(pos)) {\n      return false;\n    } else {\n      return isAtLineBoundary(root, pos) || hasSpaceBefore(root, pos) || hasSpaceAfter(root, pos);\n    }\n  };\n\n  var needsToBeNbspLeft = function (root, pos) {\n    if (isInPre(pos)) {\n      return false;\n    } else {\n      return isAtStartOfBlock(root, pos) || isBeforeBlock(root, pos) || isAfterBr(root, pos) || hasSpaceBefore(root, pos);\n    }\n  };\n\n  var leanRight = function (pos) {\n    var container = pos.container();\n    var offset = pos.offset();\n\n    if (isText$1(container) && offset < container.data.length) {\n      return CaretPosition(container, offset + 1);\n    } else {\n      return pos;\n    }\n  };\n\n  var needsToBeNbspRight = function (root, pos) {\n    if (isInPre(pos)) {\n      return false;\n    } else {\n      return isAtEndOfBlock(root, pos) || isAfterBlock(root, pos) || isBeforeBr(root, pos) || hasSpaceAfter(root, pos);\n    }\n  };\n\n  var needsToBeNbsp = function (root, pos) {\n    return needsToBeNbspLeft(root, pos) || needsToBeNbspRight(root, leanRight(pos));\n  };\n\n  var isNbspAt = function (text, offset) {\n    return isNbsp(text.charAt(offset));\n  };\n\n  var hasNbsp = function (pos) {\n    var container = pos.container();\n    return isText$1(container) && contains$1(container.data, nbsp);\n  };\n\n  var normalizeNbspMiddle = function (text) {\n    var chars = text.split('');\n    return map(chars, function (chr, i) {\n      if (isNbsp(chr) && i > 0 && i < chars.length - 1 && isContent$1(chars[i - 1]) && isContent$1(chars[i + 1])) {\n        return ' ';\n      } else {\n        return chr;\n      }\n    }).join('');\n  };\n\n  var normalizeNbspAtStart = function (root, node) {\n    var text = node.data;\n    var firstPos = CaretPosition(node, 0);\n\n    if (isNbspAt(text, 0) && !needsToBeNbsp(root, firstPos)) {\n      node.data = ' ' + text.slice(1);\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  var normalizeNbspInMiddleOfTextNode = function (node) {\n    var text = node.data;\n    var newText = normalizeNbspMiddle(text);\n\n    if (newText !== text) {\n      node.data = newText;\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  var normalizeNbspAtEnd = function (root, node) {\n    var text = node.data;\n    var lastPos = CaretPosition(node, text.length - 1);\n\n    if (isNbspAt(text, text.length - 1) && !needsToBeNbsp(root, lastPos)) {\n      node.data = text.slice(0, -1) + ' ';\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  var normalizeNbsps = function (root, pos) {\n    return Optional.some(pos).filter(hasNbsp).bind(function (pos) {\n      var container = pos.container();\n      var normalized = normalizeNbspAtStart(root, container) || normalizeNbspInMiddleOfTextNode(container) || normalizeNbspAtEnd(root, container);\n      return normalized ? Optional.some(pos) : Optional.none();\n    });\n  };\n\n  var normalizeNbspsInEditor = function (editor) {\n    var root = SugarElement.fromDom(editor.getBody());\n\n    if (editor.selection.isCollapsed()) {\n      normalizeNbsps(root, CaretPosition.fromRangeStart(editor.selection.getRng())).each(function (pos) {\n        editor.selection.setRng(pos.toRange());\n      });\n    }\n  };\n\n  var normalizeContent = function (content, isStartOfContent, isEndOfContent) {\n    var result = foldl(content, function (acc, c) {\n      if (isWhiteSpace$1(c) || isNbsp(c)) {\n        if (acc.previousCharIsSpace || acc.str === '' && isStartOfContent || acc.str.length === content.length - 1 && isEndOfContent) {\n          return {\n            previousCharIsSpace: false,\n            str: acc.str + nbsp\n          };\n        } else {\n          return {\n            previousCharIsSpace: true,\n            str: acc.str + ' '\n          };\n        }\n      } else {\n        return {\n          previousCharIsSpace: false,\n          str: acc.str + c\n        };\n      }\n    }, {\n      previousCharIsSpace: false,\n      str: ''\n    });\n    return result.str;\n  };\n\n  var normalize$1 = function (node, offset, count) {\n    if (count === 0) {\n      return;\n    }\n\n    var elm = SugarElement.fromDom(node);\n    var root = ancestor(elm, isBlock).getOr(elm);\n    var whitespace = node.data.slice(offset, offset + count);\n    var isEndOfContent = offset + count >= node.data.length && needsToBeNbspRight(root, CaretPosition$1(node, node.data.length));\n    var isStartOfContent = offset === 0 && needsToBeNbspLeft(root, CaretPosition$1(node, 0));\n    node.replaceData(offset, count, normalizeContent(whitespace, isStartOfContent, isEndOfContent));\n  };\n\n  var normalizeWhitespaceAfter = function (node, offset) {\n    var content = node.data.slice(offset);\n    var whitespaceCount = content.length - lTrim(content).length;\n    return normalize$1(node, offset, whitespaceCount);\n  };\n\n  var normalizeWhitespaceBefore = function (node, offset) {\n    var content = node.data.slice(0, offset);\n    var whitespaceCount = content.length - rTrim(content).length;\n    return normalize$1(node, offset - whitespaceCount, whitespaceCount);\n  };\n\n  var mergeTextNodes = function (prevNode, nextNode, normalizeWhitespace, mergeToPrev) {\n    if (mergeToPrev === void 0) {\n      mergeToPrev = true;\n    }\n\n    var whitespaceOffset = rTrim(prevNode.data).length;\n    var newNode = mergeToPrev ? prevNode : nextNode;\n    var removeNode = mergeToPrev ? nextNode : prevNode;\n\n    if (mergeToPrev) {\n      newNode.appendData(removeNode.data);\n    } else {\n      newNode.insertData(0, removeNode.data);\n    }\n\n    remove(SugarElement.fromDom(removeNode));\n\n    if (normalizeWhitespace) {\n      normalizeWhitespaceAfter(newNode, whitespaceOffset);\n    }\n\n    return newNode;\n  };\n\n  var needsReposition = function (pos, elm) {\n    var container = pos.container();\n    var offset = pos.offset();\n    return CaretPosition$1.isTextPosition(pos) === false && container === elm.parentNode && offset > CaretPosition$1.before(elm).offset();\n  };\n\n  var reposition = function (elm, pos) {\n    return needsReposition(pos, elm) ? CaretPosition$1(pos.container(), pos.offset() - 1) : pos;\n  };\n\n  var beforeOrStartOf = function (node) {\n    return isText$1(node) ? CaretPosition$1(node, 0) : CaretPosition$1.before(node);\n  };\n\n  var afterOrEndOf = function (node) {\n    return isText$1(node) ? CaretPosition$1(node, node.data.length) : CaretPosition$1.after(node);\n  };\n\n  var getPreviousSiblingCaretPosition = function (elm) {\n    if (isCaretCandidate(elm.previousSibling)) {\n      return Optional.some(afterOrEndOf(elm.previousSibling));\n    } else {\n      return elm.previousSibling ? lastPositionIn(elm.previousSibling) : Optional.none();\n    }\n  };\n\n  var getNextSiblingCaretPosition = function (elm) {\n    if (isCaretCandidate(elm.nextSibling)) {\n      return Optional.some(beforeOrStartOf(elm.nextSibling));\n    } else {\n      return elm.nextSibling ? firstPositionIn(elm.nextSibling) : Optional.none();\n    }\n  };\n\n  var findCaretPositionBackwardsFromElm = function (rootElement, elm) {\n    var startPosition = CaretPosition$1.before(elm.previousSibling ? elm.previousSibling : elm.parentNode);\n    return prevPosition(rootElement, startPosition).fold(function () {\n      return nextPosition(rootElement, CaretPosition$1.after(elm));\n    }, Optional.some);\n  };\n\n  var findCaretPositionForwardsFromElm = function (rootElement, elm) {\n    return nextPosition(rootElement, CaretPosition$1.after(elm)).fold(function () {\n      return prevPosition(rootElement, CaretPosition$1.before(elm));\n    }, Optional.some);\n  };\n\n  var findCaretPositionBackwards = function (rootElement, elm) {\n    return getPreviousSiblingCaretPosition(elm).orThunk(function () {\n      return getNextSiblingCaretPosition(elm);\n    }).orThunk(function () {\n      return findCaretPositionBackwardsFromElm(rootElement, elm);\n    });\n  };\n\n  var findCaretPositionForward = function (rootElement, elm) {\n    return getNextSiblingCaretPosition(elm).orThunk(function () {\n      return getPreviousSiblingCaretPosition(elm);\n    }).orThunk(function () {\n      return findCaretPositionForwardsFromElm(rootElement, elm);\n    });\n  };\n\n  var findCaretPosition$1 = function (forward, rootElement, elm) {\n    return forward ? findCaretPositionForward(rootElement, elm) : findCaretPositionBackwards(rootElement, elm);\n  };\n\n  var findCaretPosOutsideElmAfterDelete = function (forward, rootElement, elm) {\n    return findCaretPosition$1(forward, rootElement, elm).map(curry(reposition, elm));\n  };\n\n  var setSelection = function (editor, forward, pos) {\n    pos.fold(function () {\n      editor.focus();\n    }, function (pos) {\n      editor.selection.setRng(pos.toRange(), forward);\n    });\n  };\n\n  var eqRawNode = function (rawNode) {\n    return function (elm) {\n      return elm.dom === rawNode;\n    };\n  };\n\n  var isBlock$2 = function (editor, elm) {\n    return elm && has(editor.schema.getBlockElements(), name(elm));\n  };\n\n  var paddEmptyBlock = function (elm) {\n    if (isEmpty(elm)) {\n      var br = SugarElement.fromHtml('<br data-mce-bogus=\"1\">');\n      empty(elm);\n      append(elm, br);\n      return Optional.some(CaretPosition$1.before(br.dom));\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var deleteNormalized = function (elm, afterDeletePosOpt, normalizeWhitespace) {\n    var prevTextOpt = prevSibling(elm).filter(isText);\n    var nextTextOpt = nextSibling(elm).filter(isText);\n    remove(elm);\n    return lift3(prevTextOpt, nextTextOpt, afterDeletePosOpt, function (prev, next, pos) {\n      var prevNode = prev.dom,\n          nextNode = next.dom;\n      var offset = prevNode.data.length;\n      mergeTextNodes(prevNode, nextNode, normalizeWhitespace);\n      return pos.container() === nextNode ? CaretPosition$1(prevNode, offset) : pos;\n    }).orThunk(function () {\n      if (normalizeWhitespace) {\n        prevTextOpt.each(function (elm) {\n          return normalizeWhitespaceBefore(elm.dom, elm.dom.length);\n        });\n        nextTextOpt.each(function (elm) {\n          return normalizeWhitespaceAfter(elm.dom, 0);\n        });\n      }\n\n      return afterDeletePosOpt;\n    });\n  };\n\n  var isInlineElement = function (editor, element) {\n    return has(editor.schema.getTextInlineElements(), name(element));\n  };\n\n  var deleteElement = function (editor, forward, elm, moveCaret) {\n    if (moveCaret === void 0) {\n      moveCaret = true;\n    }\n\n    var afterDeletePos = findCaretPosOutsideElmAfterDelete(forward, editor.getBody(), elm.dom);\n    var parentBlock = ancestor(elm, curry(isBlock$2, editor), eqRawNode(editor.getBody()));\n    var normalizedAfterDeletePos = deleteNormalized(elm, afterDeletePos, isInlineElement(editor, elm));\n\n    if (editor.dom.isEmpty(editor.getBody())) {\n      editor.setContent('');\n      editor.selection.setCursorLocation();\n    } else {\n      parentBlock.bind(paddEmptyBlock).fold(function () {\n        if (moveCaret) {\n          setSelection(editor, forward, normalizedAfterDeletePos);\n        }\n      }, function (paddPos) {\n        if (moveCaret) {\n          setSelection(editor, forward, Optional.some(paddPos));\n        }\n      });\n    }\n  };\n\n  var tableCellRng = function (start, end) {\n    return {\n      start: start,\n      end: end\n    };\n  };\n\n  var tableSelection = function (rng, table, cells) {\n    return {\n      rng: rng,\n      table: table,\n      cells: cells\n    };\n  };\n\n  var deleteAction = Adt.generate([{\n    removeTable: ['element']\n  }, {\n    emptyCells: ['cells']\n  }, {\n    deleteCellSelection: ['rng', 'cell']\n  }]);\n\n  var isRootFromElement = function (root) {\n    return function (cur) {\n      return eq$2(root, cur);\n    };\n  };\n\n  var getClosestCell = function (container, isRoot) {\n    return closest$1(SugarElement.fromDom(container), 'td,th', isRoot);\n  };\n\n  var getClosestTable = function (cell, isRoot) {\n    return ancestor$1(cell, 'table', isRoot);\n  };\n\n  var isExpandedCellRng = function (cellRng) {\n    return !eq$2(cellRng.start, cellRng.end);\n  };\n\n  var getTableFromCellRng = function (cellRng, isRoot) {\n    return getClosestTable(cellRng.start, isRoot).bind(function (startParentTable) {\n      return getClosestTable(cellRng.end, isRoot).bind(function (endParentTable) {\n        return someIf(eq$2(startParentTable, endParentTable), startParentTable);\n      });\n    });\n  };\n\n  var isSingleCellTable = function (cellRng, isRoot) {\n    return !isExpandedCellRng(cellRng) && getTableFromCellRng(cellRng, isRoot).exists(function (table) {\n      var rows = table.dom.rows;\n      return rows.length === 1 && rows[0].cells.length === 1;\n    });\n  };\n\n  var getTableCells = function (table) {\n    return descendants$1(table, 'td,th');\n  };\n\n  var getCellRng = function (rng, isRoot) {\n    var startCell = getClosestCell(rng.startContainer, isRoot);\n    var endCell = getClosestCell(rng.endContainer, isRoot);\n    return lift2(startCell, endCell, tableCellRng);\n  };\n\n  var getCellRangeFromStartTable = function (cellRng, isRoot) {\n    return getClosestTable(cellRng.start, isRoot).bind(function (table) {\n      return last(getTableCells(table)).map(function (endCell) {\n        return tableCellRng(cellRng.start, endCell);\n      });\n    });\n  };\n\n  var partialSelection = function (isRoot, rng) {\n    var startCell = getClosestCell(rng.startContainer, isRoot);\n    var endCell = getClosestCell(rng.endContainer, isRoot);\n    return rng.collapsed ? Optional.none() : lift2(startCell, endCell, tableCellRng).fold(function () {\n      return startCell.fold(function () {\n        return endCell.bind(function (endCell) {\n          return getClosestTable(endCell, isRoot).bind(function (table) {\n            return head(getTableCells(table)).map(function (startCell) {\n              return tableCellRng(startCell, endCell);\n            });\n          });\n        });\n      }, function (startCell) {\n        return getClosestTable(startCell, isRoot).bind(function (table) {\n          return last(getTableCells(table)).map(function (endCell) {\n            return tableCellRng(startCell, endCell);\n          });\n        });\n      });\n    }, function (cellRng) {\n      return isWithinSameTable(isRoot, cellRng) ? Optional.none() : getCellRangeFromStartTable(cellRng, isRoot);\n    });\n  };\n\n  var isWithinSameTable = function (isRoot, cellRng) {\n    return getTableFromCellRng(cellRng, isRoot).isSome();\n  };\n\n  var getTableSelectionFromCellRng = function (cellRng, isRoot) {\n    return getTableFromCellRng(cellRng, isRoot).map(function (table) {\n      return tableSelection(cellRng, table, getTableCells(table));\n    });\n  };\n\n  var getTableSelection = function (optCellRng, rng, isRoot) {\n    return optCellRng.filter(function (cellRng) {\n      return isExpandedCellRng(cellRng) && isWithinSameTable(isRoot, cellRng);\n    }).orThunk(function () {\n      return partialSelection(isRoot, rng);\n    }).bind(function (cRng) {\n      return getTableSelectionFromCellRng(cRng, isRoot);\n    });\n  };\n\n  var getCellIndex = function (cells, cell) {\n    return findIndex(cells, function (x) {\n      return eq$2(x, cell);\n    });\n  };\n\n  var getSelectedCells = function (tableSelection) {\n    return lift2(getCellIndex(tableSelection.cells, tableSelection.rng.start), getCellIndex(tableSelection.cells, tableSelection.rng.end), function (startIndex, endIndex) {\n      return tableSelection.cells.slice(startIndex, endIndex + 1);\n    });\n  };\n\n  var isSingleCellTableContentSelected = function (optCellRng, rng, isRoot) {\n    return optCellRng.filter(function (cellRng) {\n      return isSingleCellTable(cellRng, isRoot) && hasAllContentsSelected(cellRng.start, rng);\n    }).map(function (cellRng) {\n      return cellRng.start;\n    });\n  };\n\n  var getAction = function (tableSelection) {\n    return getSelectedCells(tableSelection).map(function (selected) {\n      var cells = tableSelection.cells;\n      return selected.length === cells.length ? deleteAction.removeTable(tableSelection.table) : deleteAction.emptyCells(selected);\n    });\n  };\n\n  var getActionFromRange = function (root, rng) {\n    var isRoot = isRootFromElement(root);\n    var optCellRng = getCellRng(rng, isRoot);\n    return isSingleCellTableContentSelected(optCellRng, rng, isRoot).map(function (cell) {\n      return deleteAction.deleteCellSelection(rng, cell);\n    }).orThunk(function () {\n      return getTableSelection(optCellRng, rng, isRoot).bind(getAction);\n    });\n  };\n\n  var freefallRtl = function (root) {\n    var child = isComment(root) ? prevSibling(root) : lastChild(root);\n    return child.bind(freefallRtl).orThunk(function () {\n      return Optional.some(root);\n    });\n  };\n\n  var emptyCells = function (editor, cells) {\n    each(cells, fillWithPaddingBr);\n    editor.selection.setCursorLocation(cells[0].dom, 0);\n    return true;\n  };\n\n  var deleteCellContents = function (editor, rng, cell) {\n    rng.deleteContents();\n    var lastNode = freefallRtl(cell).getOr(cell);\n    var lastBlock = SugarElement.fromDom(editor.dom.getParent(lastNode.dom, editor.dom.isBlock));\n\n    if (isEmpty(lastBlock)) {\n      fillWithPaddingBr(lastBlock);\n      editor.selection.setCursorLocation(lastBlock.dom, 0);\n    }\n\n    if (!eq$2(cell, lastBlock)) {\n      var additionalCleanupNodes = parent(lastBlock).is(cell) ? [] : siblings(lastBlock);\n      each(additionalCleanupNodes.concat(children(cell)), function (node) {\n        if (!eq$2(node, lastBlock) && !contains$2(node, lastBlock)) {\n          remove(node);\n        }\n      });\n    }\n\n    return true;\n  };\n\n  var deleteTableElement = function (editor, table) {\n    deleteElement(editor, false, table);\n    return true;\n  };\n\n  var deleteCellRange = function (editor, rootElm, rng) {\n    return getActionFromRange(rootElm, rng).map(function (action) {\n      return action.fold(curry(deleteTableElement, editor), curry(emptyCells, editor), curry(deleteCellContents, editor));\n    });\n  };\n\n  var deleteCaptionRange = function (editor, caption) {\n    return emptyElement(editor, caption);\n  };\n\n  var deleteTableRange = function (editor, rootElm, rng, startElm) {\n    return getParentCaption(rootElm, startElm).fold(function () {\n      return deleteCellRange(editor, rootElm, rng);\n    }, function (caption) {\n      return deleteCaptionRange(editor, caption);\n    }).getOr(false);\n  };\n\n  var deleteRange = function (editor, startElm) {\n    var rootNode = SugarElement.fromDom(editor.getBody());\n    var rng = editor.selection.getRng();\n    var selectedCells = getCellsFromEditor(editor);\n    return selectedCells.length !== 0 ? emptyCells(editor, selectedCells) : deleteTableRange(editor, rootNode, rng, startElm);\n  };\n\n  var getParentCell = function (rootElm, elm) {\n    return find(parentsAndSelf(elm, rootElm), isTableCell$1);\n  };\n\n  var getParentCaption = function (rootElm, elm) {\n    return find(parentsAndSelf(elm, rootElm), function (elm) {\n      return name(elm) === 'caption';\n    });\n  };\n\n  var deleteBetweenCells = function (editor, rootElm, forward, fromCell, from) {\n    return navigate(forward, editor.getBody(), from).bind(function (to) {\n      return getParentCell(rootElm, SugarElement.fromDom(to.getNode())).map(function (toCell) {\n        return eq$2(toCell, fromCell) === false;\n      });\n    });\n  };\n\n  var emptyElement = function (editor, elm) {\n    fillWithPaddingBr(elm);\n    editor.selection.setCursorLocation(elm.dom, 0);\n    return Optional.some(true);\n  };\n\n  var isDeleteOfLastCharPos = function (fromCaption, forward, from, to) {\n    return firstPositionIn(fromCaption.dom).bind(function (first) {\n      return lastPositionIn(fromCaption.dom).map(function (last) {\n        return forward ? from.isEqual(first) && to.isEqual(last) : from.isEqual(last) && to.isEqual(first);\n      });\n    }).getOr(true);\n  };\n\n  var emptyCaretCaption = function (editor, elm) {\n    return emptyElement(editor, elm);\n  };\n\n  var validateCaretCaption = function (rootElm, fromCaption, to) {\n    return getParentCaption(rootElm, SugarElement.fromDom(to.getNode())).map(function (toCaption) {\n      return eq$2(toCaption, fromCaption) === false;\n    });\n  };\n\n  var deleteCaretInsideCaption = function (editor, rootElm, forward, fromCaption, from) {\n    return navigate(forward, editor.getBody(), from).bind(function (to) {\n      return isDeleteOfLastCharPos(fromCaption, forward, from, to) ? emptyCaretCaption(editor, fromCaption) : validateCaretCaption(rootElm, fromCaption, to);\n    }).or(Optional.some(true));\n  };\n\n  var deleteCaretCells = function (editor, forward, rootElm, startElm) {\n    var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    return getParentCell(rootElm, startElm).bind(function (fromCell) {\n      return isEmpty(fromCell) ? emptyElement(editor, fromCell) : deleteBetweenCells(editor, rootElm, forward, fromCell, from);\n    }).getOr(false);\n  };\n\n  var deleteCaretCaption = function (editor, forward, rootElm, fromCaption) {\n    var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    return isEmpty(fromCaption) ? emptyElement(editor, fromCaption) : deleteCaretInsideCaption(editor, rootElm, forward, fromCaption, from);\n  };\n\n  var isNearTable = function (forward, pos) {\n    return forward ? isBeforeTable(pos) : isAfterTable(pos);\n  };\n\n  var isBeforeOrAfterTable = function (editor, forward) {\n    var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    return isNearTable(forward, fromPos) || fromPosition(forward, editor.getBody(), fromPos).exists(function (pos) {\n      return isNearTable(forward, pos);\n    });\n  };\n\n  var deleteCaret = function (editor, forward, startElm) {\n    var rootElm = SugarElement.fromDom(editor.getBody());\n    return getParentCaption(rootElm, startElm).fold(function () {\n      return deleteCaretCells(editor, forward, rootElm, startElm) || isBeforeOrAfterTable(editor, forward);\n    }, function (fromCaption) {\n      return deleteCaretCaption(editor, forward, rootElm, fromCaption).getOr(false);\n    });\n  };\n\n  var backspaceDelete = function (editor, forward) {\n    var startElm = SugarElement.fromDom(editor.selection.getStart(true));\n    var cells = getCellsFromEditor(editor);\n    return editor.selection.isCollapsed() && cells.length === 0 ? deleteCaret(editor, forward, startElm) : deleteRange(editor, startElm);\n  };\n\n  var createRange$1 = function (sc, so, ec, eo) {\n    var rng = document.createRange();\n    rng.setStart(sc, so);\n    rng.setEnd(ec, eo);\n    return rng;\n  };\n\n  var normalizeBlockSelectionRange = function (rng) {\n    var startPos = CaretPosition$1.fromRangeStart(rng);\n    var endPos = CaretPosition$1.fromRangeEnd(rng);\n    var rootNode = rng.commonAncestorContainer;\n    return fromPosition(false, rootNode, endPos).map(function (newEndPos) {\n      if (!isInSameBlock(startPos, endPos, rootNode) && isInSameBlock(startPos, newEndPos, rootNode)) {\n        return createRange$1(startPos.container(), startPos.offset(), newEndPos.container(), newEndPos.offset());\n      } else {\n        return rng;\n      }\n    }).getOr(rng);\n  };\n\n  var normalize$2 = function (rng) {\n    return rng.collapsed ? rng : normalizeBlockSelectionRange(rng);\n  };\n\n  var hasOnlyOneChild = function (node) {\n    return node.firstChild && node.firstChild === node.lastChild;\n  };\n\n  var isPaddingNode = function (node) {\n    return node.name === 'br' || node.value === nbsp;\n  };\n\n  var isPaddedEmptyBlock = function (schema, node) {\n    var blockElements = schema.getBlockElements();\n    return blockElements[node.name] && hasOnlyOneChild(node) && isPaddingNode(node.firstChild);\n  };\n\n  var isEmptyFragmentElement = function (schema, node) {\n    var nonEmptyElements = schema.getNonEmptyElements();\n    return node && (node.isEmpty(nonEmptyElements) || isPaddedEmptyBlock(schema, node));\n  };\n\n  var isListFragment = function (schema, fragment) {\n    var firstChild = fragment.firstChild;\n    var lastChild = fragment.lastChild;\n\n    if (firstChild && firstChild.name === 'meta') {\n      firstChild = firstChild.next;\n    }\n\n    if (lastChild && lastChild.attr('id') === 'mce_marker') {\n      lastChild = lastChild.prev;\n    }\n\n    if (isEmptyFragmentElement(schema, lastChild)) {\n      lastChild = lastChild.prev;\n    }\n\n    if (!firstChild || firstChild !== lastChild) {\n      return false;\n    }\n\n    return firstChild.name === 'ul' || firstChild.name === 'ol';\n  };\n\n  var cleanupDomFragment = function (domFragment) {\n    var firstChild = domFragment.firstChild;\n    var lastChild = domFragment.lastChild;\n\n    if (firstChild && firstChild.nodeName === 'META') {\n      firstChild.parentNode.removeChild(firstChild);\n    }\n\n    if (lastChild && lastChild.id === 'mce_marker') {\n      lastChild.parentNode.removeChild(lastChild);\n    }\n\n    return domFragment;\n  };\n\n  var toDomFragment = function (dom, serializer, fragment) {\n    var html = serializer.serialize(fragment);\n    var domFragment = dom.createFragment(html);\n    return cleanupDomFragment(domFragment);\n  };\n\n  var listItems$1 = function (elm) {\n    return Tools.grep(elm.childNodes, function (child) {\n      return child.nodeName === 'LI';\n    });\n  };\n\n  var isPadding = function (node) {\n    return node.data === nbsp || isBr(node);\n  };\n\n  var isListItemPadded = function (node) {\n    return node && node.firstChild && node.firstChild === node.lastChild && isPadding(node.firstChild);\n  };\n\n  var isEmptyOrPadded = function (elm) {\n    return !elm.firstChild || isListItemPadded(elm);\n  };\n\n  var trimListItems = function (elms) {\n    return elms.length > 0 && isEmptyOrPadded(elms[elms.length - 1]) ? elms.slice(0, -1) : elms;\n  };\n\n  var getParentLi = function (dom, node) {\n    var parentBlock = dom.getParent(node, dom.isBlock);\n    return parentBlock && parentBlock.nodeName === 'LI' ? parentBlock : null;\n  };\n\n  var isParentBlockLi = function (dom, node) {\n    return !!getParentLi(dom, node);\n  };\n\n  var getSplit = function (parentNode, rng) {\n    var beforeRng = rng.cloneRange();\n    var afterRng = rng.cloneRange();\n    beforeRng.setStartBefore(parentNode);\n    afterRng.setEndAfter(parentNode);\n    return [beforeRng.cloneContents(), afterRng.cloneContents()];\n  };\n\n  var findFirstIn = function (node, rootNode) {\n    var caretPos = CaretPosition$1.before(node);\n    var caretWalker = CaretWalker(rootNode);\n    var newCaretPos = caretWalker.next(caretPos);\n    return newCaretPos ? newCaretPos.toRange() : null;\n  };\n\n  var findLastOf = function (node, rootNode) {\n    var caretPos = CaretPosition$1.after(node);\n    var caretWalker = CaretWalker(rootNode);\n    var newCaretPos = caretWalker.prev(caretPos);\n    return newCaretPos ? newCaretPos.toRange() : null;\n  };\n\n  var insertMiddle = function (target, elms, rootNode, rng) {\n    var parts = getSplit(target, rng);\n    var parentElm = target.parentNode;\n    parentElm.insertBefore(parts[0], target);\n    Tools.each(elms, function (li) {\n      parentElm.insertBefore(li, target);\n    });\n    parentElm.insertBefore(parts[1], target);\n    parentElm.removeChild(target);\n    return findLastOf(elms[elms.length - 1], rootNode);\n  };\n\n  var insertBefore = function (target, elms, rootNode) {\n    var parentElm = target.parentNode;\n    Tools.each(elms, function (elm) {\n      parentElm.insertBefore(elm, target);\n    });\n    return findFirstIn(target, rootNode);\n  };\n\n  var insertAfter = function (target, elms, rootNode, dom) {\n    dom.insertAfter(elms.reverse(), target);\n    return findLastOf(elms[0], rootNode);\n  };\n\n  var insertAtCaret = function (serializer, dom, rng, fragment) {\n    var domFragment = toDomFragment(dom, serializer, fragment);\n    var liTarget = getParentLi(dom, rng.startContainer);\n    var liElms = trimListItems(listItems$1(domFragment.firstChild));\n    var BEGINNING = 1,\n        END = 2;\n    var rootNode = dom.getRoot();\n\n    var isAt = function (location) {\n      var caretPos = CaretPosition$1.fromRangeStart(rng);\n      var caretWalker = CaretWalker(dom.getRoot());\n      var newPos = location === BEGINNING ? caretWalker.prev(caretPos) : caretWalker.next(caretPos);\n      return newPos ? getParentLi(dom, newPos.getNode()) !== liTarget : true;\n    };\n\n    if (isAt(BEGINNING)) {\n      return insertBefore(liTarget, liElms, rootNode);\n    } else if (isAt(END)) {\n      return insertAfter(liTarget, liElms, rootNode, dom);\n    }\n\n    return insertMiddle(liTarget, liElms, rootNode, rng);\n  };\n\n  var trimOrPadLeftRight = function (dom, rng, html) {\n    var root = SugarElement.fromDom(dom.getRoot());\n\n    if (needsToBeNbspLeft(root, CaretPosition$1.fromRangeStart(rng))) {\n      html = html.replace(/^ /, '&nbsp;');\n    } else {\n      html = html.replace(/^&nbsp;/, ' ');\n    }\n\n    if (needsToBeNbspRight(root, CaretPosition$1.fromRangeEnd(rng))) {\n      html = html.replace(/(&nbsp;| )(<br( \\/)>)?$/, '&nbsp;');\n    } else {\n      html = html.replace(/&nbsp;(<br( \\/)?>)?$/, ' ');\n    }\n\n    return html;\n  };\n\n  var isTableCell$4 = isTableCell;\n\n  var isTableCellContentSelected = function (dom, rng, cell) {\n    if (cell !== null) {\n      var endCell = dom.getParent(rng.endContainer, isTableCell$4);\n      return cell === endCell && hasAllContentsSelected(SugarElement.fromDom(cell), rng);\n    } else {\n      return false;\n    }\n  };\n\n  var validInsertion = function (editor, value, parentNode) {\n    if (parentNode.getAttribute('data-mce-bogus') === 'all') {\n      parentNode.parentNode.insertBefore(editor.dom.createFragment(value), parentNode);\n    } else {\n      var node = parentNode.firstChild;\n      var node2 = parentNode.lastChild;\n\n      if (!node || node === node2 && node.nodeName === 'BR') {\n        editor.dom.setHTML(parentNode, value);\n      } else {\n        editor.selection.setContent(value);\n      }\n    }\n  };\n\n  var trimBrsFromTableCell = function (dom, elm) {\n    Optional.from(dom.getParent(elm, 'td,th')).map(SugarElement.fromDom).each(trimBlockTrailingBr);\n  };\n\n  var reduceInlineTextElements = function (editor, merge) {\n    var textInlineElements = editor.schema.getTextInlineElements();\n    var dom = editor.dom;\n\n    if (merge) {\n      var root_1 = editor.getBody(),\n          elementUtils_1 = new ElementUtils(dom);\n      Tools.each(dom.select('*[data-mce-fragment]'), function (node) {\n        for (var testNode = node.parentNode; testNode && testNode !== root_1; testNode = testNode.parentNode) {\n          if (textInlineElements[node.nodeName.toLowerCase()] && elementUtils_1.compare(testNode, node)) {\n            dom.remove(node, true);\n          }\n        }\n      });\n    }\n  };\n\n  var markFragmentElements = function (fragment) {\n    var node = fragment;\n\n    while (node = node.walk()) {\n      if (node.type === 1) {\n        node.attr('data-mce-fragment', '1');\n      }\n    }\n  };\n\n  var unmarkFragmentElements = function (elm) {\n    Tools.each(elm.getElementsByTagName('*'), function (elm) {\n      elm.removeAttribute('data-mce-fragment');\n    });\n  };\n\n  var isPartOfFragment = function (node) {\n    return !!node.getAttribute('data-mce-fragment');\n  };\n\n  var canHaveChildren = function (editor, node) {\n    return node && !editor.schema.getShortEndedElements()[node.nodeName];\n  };\n\n  var moveSelectionToMarker = function (editor, marker) {\n    var nextRng;\n    var dom = editor.dom,\n        selection = editor.selection;\n    var node2;\n\n    var getContentEditableFalseParent = function (node) {\n      var root = editor.getBody();\n\n      for (; node && node !== root; node = node.parentNode) {\n        if (dom.getContentEditable(node) === 'false') {\n          return node;\n        }\n      }\n\n      return null;\n    };\n\n    if (!marker) {\n      return;\n    }\n\n    selection.scrollIntoView(marker);\n    var parentEditableFalseElm = getContentEditableFalseParent(marker);\n\n    if (parentEditableFalseElm) {\n      dom.remove(marker);\n      selection.select(parentEditableFalseElm);\n      return;\n    }\n\n    var rng = dom.createRng();\n    var node = marker.previousSibling;\n\n    if (node && node.nodeType === 3) {\n      rng.setStart(node, node.nodeValue.length);\n\n      if (!Env.ie) {\n        node2 = marker.nextSibling;\n\n        if (node2 && node2.nodeType === 3) {\n          node.appendData(node2.data);\n          node2.parentNode.removeChild(node2);\n        }\n      }\n    } else {\n      rng.setStartBefore(marker);\n      rng.setEndBefore(marker);\n    }\n\n    var findNextCaretRng = function (rng) {\n      var caretPos = CaretPosition$1.fromRangeStart(rng);\n      var caretWalker = CaretWalker(editor.getBody());\n      caretPos = caretWalker.next(caretPos);\n\n      if (caretPos) {\n        return caretPos.toRange();\n      }\n    };\n\n    var parentBlock = dom.getParent(marker, dom.isBlock);\n    dom.remove(marker);\n\n    if (parentBlock && dom.isEmpty(parentBlock)) {\n      editor.$(parentBlock).empty();\n      rng.setStart(parentBlock, 0);\n      rng.setEnd(parentBlock, 0);\n\n      if (!isTableCell$4(parentBlock) && !isPartOfFragment(parentBlock) && (nextRng = findNextCaretRng(rng))) {\n        rng = nextRng;\n        dom.remove(parentBlock);\n      } else {\n        dom.add(parentBlock, dom.create('br', {\n          'data-mce-bogus': '1'\n        }));\n      }\n    }\n\n    selection.setRng(rng);\n  };\n\n  var deleteSelectedContent = function (editor) {\n    var dom = editor.dom;\n    var rng = normalize$2(editor.selection.getRng());\n    editor.selection.setRng(rng);\n    var startCell = dom.getParent(rng.startContainer, isTableCell$4);\n\n    if (isTableCellContentSelected(dom, rng, startCell)) {\n      deleteCellContents(editor, rng, SugarElement.fromDom(startCell));\n    } else {\n      editor.getDoc().execCommand('Delete', false, null);\n    }\n  };\n\n  var insertHtmlAtCaret = function (editor, value, details) {\n    var parentNode, rootNode, args;\n    var marker, rng, node;\n    var selection = editor.selection,\n        dom = editor.dom;\n\n    if (/^ | $/.test(value)) {\n      value = trimOrPadLeftRight(dom, selection.getRng(), value);\n    }\n\n    var parser = editor.parser;\n    var merge = details.merge;\n    var serializer = HtmlSerializer({\n      validate: shouldValidate(editor)\n    }, editor.schema);\n    var bookmarkHtml = '<span id=\"mce_marker\" data-mce-type=\"bookmark\">&#xFEFF;</span>';\n    args = {\n      content: value,\n      format: 'html',\n      selection: true,\n      paste: details.paste\n    };\n    args = editor.fire('BeforeSetContent', args);\n\n    if (args.isDefaultPrevented()) {\n      editor.fire('SetContent', {\n        content: args.content,\n        format: 'html',\n        selection: true,\n        paste: details.paste\n      });\n      return;\n    }\n\n    value = args.content;\n\n    if (value.indexOf('{$caret}') === -1) {\n      value += '{$caret}';\n    }\n\n    value = value.replace(/\\{\\$caret\\}/, bookmarkHtml);\n    rng = selection.getRng();\n    var caretElement = rng.startContainer || (rng.parentElement ? rng.parentElement() : null);\n    var body = editor.getBody();\n\n    if (caretElement === body && selection.isCollapsed()) {\n      if (dom.isBlock(body.firstChild) && canHaveChildren(editor, body.firstChild) && dom.isEmpty(body.firstChild)) {\n        rng = dom.createRng();\n        rng.setStart(body.firstChild, 0);\n        rng.setEnd(body.firstChild, 0);\n        selection.setRng(rng);\n      }\n    }\n\n    if (!selection.isCollapsed()) {\n      deleteSelectedContent(editor);\n    }\n\n    parentNode = selection.getNode();\n    var parserArgs = {\n      context: parentNode.nodeName.toLowerCase(),\n      data: details.data,\n      insert: true\n    };\n    var fragment = parser.parse(value, parserArgs);\n\n    if (details.paste === true && isListFragment(editor.schema, fragment) && isParentBlockLi(dom, parentNode)) {\n      rng = insertAtCaret(serializer, dom, selection.getRng(), fragment);\n      selection.setRng(rng);\n      editor.fire('SetContent', args);\n      return;\n    }\n\n    markFragmentElements(fragment);\n    node = fragment.lastChild;\n\n    if (node.attr('id') === 'mce_marker') {\n      marker = node;\n\n      for (node = node.prev; node; node = node.walk(true)) {\n        if (node.type === 3 || !dom.isBlock(node.name)) {\n          if (editor.schema.isValidChild(node.parent.name, 'span')) {\n            node.parent.insert(marker, node, node.name === 'br');\n          }\n\n          break;\n        }\n      }\n    }\n\n    editor._selectionOverrides.showBlockCaretContainer(parentNode);\n\n    if (!parserArgs.invalid) {\n      value = serializer.serialize(fragment);\n      validInsertion(editor, value, parentNode);\n    } else {\n      editor.selection.setContent(bookmarkHtml);\n      parentNode = selection.getNode();\n      rootNode = editor.getBody();\n\n      if (parentNode.nodeType === 9) {\n        parentNode = node = rootNode;\n      } else {\n        node = parentNode;\n      }\n\n      while (node !== rootNode) {\n        parentNode = node;\n        node = node.parentNode;\n      }\n\n      value = parentNode === rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);\n      value = serializer.serialize(parser.parse(value.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i, function () {\n        return serializer.serialize(fragment);\n      })));\n\n      if (parentNode === rootNode) {\n        dom.setHTML(rootNode, value);\n      } else {\n        dom.setOuterHTML(parentNode, value);\n      }\n    }\n\n    reduceInlineTextElements(editor, merge);\n    moveSelectionToMarker(editor, dom.get('mce_marker'));\n    unmarkFragmentElements(editor.getBody());\n    trimBrsFromTableCell(dom, selection.getStart());\n    editor.fire('SetContent', args);\n    editor.addVisual();\n  };\n\n  var traverse = function (node, fn) {\n    fn(node);\n\n    if (node.firstChild) {\n      traverse(node.firstChild, fn);\n    }\n\n    if (node.next) {\n      traverse(node.next, fn);\n    }\n  };\n\n  var findMatchingNodes = function (nodeFilters, attributeFilters, node) {\n    var nodeMatches = {};\n    var attrMatches = {};\n    var matches = [];\n\n    if (node.firstChild) {\n      traverse(node.firstChild, function (node) {\n        each(nodeFilters, function (filter) {\n          if (filter.name === node.name) {\n            if (nodeMatches[filter.name]) {\n              nodeMatches[filter.name].nodes.push(node);\n            } else {\n              nodeMatches[filter.name] = {\n                filter: filter,\n                nodes: [node]\n              };\n            }\n          }\n        });\n        each(attributeFilters, function (filter) {\n          if (typeof node.attr(filter.name) === 'string') {\n            if (attrMatches[filter.name]) {\n              attrMatches[filter.name].nodes.push(node);\n            } else {\n              attrMatches[filter.name] = {\n                filter: filter,\n                nodes: [node]\n              };\n            }\n          }\n        });\n      });\n    }\n\n    for (var name_1 in nodeMatches) {\n      if (nodeMatches.hasOwnProperty(name_1)) {\n        matches.push(nodeMatches[name_1]);\n      }\n    }\n\n    for (var name_2 in attrMatches) {\n      if (attrMatches.hasOwnProperty(name_2)) {\n        matches.push(attrMatches[name_2]);\n      }\n    }\n\n    return matches;\n  };\n\n  var filter$3 = function (nodeFilters, attributeFilters, node) {\n    var matches = findMatchingNodes(nodeFilters, attributeFilters, node);\n    each(matches, function (match) {\n      each(match.filter.callbacks, function (callback) {\n        callback(match.nodes, match.filter.name, {});\n      });\n    });\n  };\n\n  var defaultFormat = 'html';\n\n  var isTreeNode = function (content) {\n    return content instanceof AstNode;\n  };\n\n  var moveSelection = function (editor) {\n    if (hasFocus$1(editor)) {\n      firstPositionIn(editor.getBody()).each(function (pos) {\n        var node = pos.getNode();\n        var caretPos = isTable(node) ? firstPositionIn(node).getOr(pos) : pos;\n        editor.selection.setRng(caretPos.toRange());\n      });\n    }\n  };\n\n  var setEditorHtml = function (editor, html) {\n    editor.dom.setHTML(editor.getBody(), html);\n    moveSelection(editor);\n  };\n\n  var setContentString = function (editor, body, content, args) {\n    var forcedRootBlockName, padd;\n\n    if (content.length === 0 || /^\\s+$/.test(content)) {\n      padd = '<br data-mce-bogus=\"1\">';\n\n      if (body.nodeName === 'TABLE') {\n        content = '<tr><td>' + padd + '</td></tr>';\n      } else if (/^(UL|OL)$/.test(body.nodeName)) {\n        content = '<li>' + padd + '</li>';\n      }\n\n      forcedRootBlockName = getForcedRootBlock(editor);\n\n      if (forcedRootBlockName && editor.schema.isValidChild(body.nodeName.toLowerCase(), forcedRootBlockName.toLowerCase())) {\n        content = padd;\n        content = editor.dom.createHTML(forcedRootBlockName, getForcedRootBlockAttrs(editor), content);\n      } else if (!content) {\n        content = '<br data-mce-bogus=\"1\">';\n      }\n\n      setEditorHtml(editor, content);\n      editor.fire('SetContent', args);\n    } else {\n      if (args.format !== 'raw') {\n        content = HtmlSerializer({\n          validate: editor.validate\n        }, editor.schema).serialize(editor.parser.parse(content, {\n          isRootContent: true,\n          insert: true\n        }));\n      }\n\n      args.content = isWsPreserveElement(SugarElement.fromDom(body)) ? content : Tools.trim(content);\n      setEditorHtml(editor, args.content);\n\n      if (!args.no_events) {\n        editor.fire('SetContent', args);\n      }\n    }\n\n    return args.content;\n  };\n\n  var setContentTree = function (editor, body, content, args) {\n    filter$3(editor.parser.getNodeFilters(), editor.parser.getAttributeFilters(), content);\n    var html = HtmlSerializer({\n      validate: editor.validate\n    }, editor.schema).serialize(content);\n    args.content = isWsPreserveElement(SugarElement.fromDom(body)) ? html : Tools.trim(html);\n    setEditorHtml(editor, args.content);\n\n    if (!args.no_events) {\n      editor.fire('SetContent', args);\n    }\n\n    return content;\n  };\n\n  var setContentInternal = function (editor, content, args) {\n    args.format = args.format ? args.format : defaultFormat;\n    args.set = true;\n    args.content = isTreeNode(content) ? '' : content;\n\n    if (!args.no_events) {\n      editor.fire('BeforeSetContent', args);\n    }\n\n    if (!isTreeNode(content)) {\n      content = args.content;\n    }\n\n    return Optional.from(editor.getBody()).fold(constant(content), function (body) {\n      return isTreeNode(content) ? setContentTree(editor, body, content, args) : setContentString(editor, body, content, args);\n    });\n  };\n\n  var addVisualInternal = function (editor, elm) {\n    var dom = editor.dom;\n    var scope = isNonNullable(elm) ? elm : editor.getBody();\n\n    if (isUndefined(editor.hasVisual)) {\n      editor.hasVisual = isVisualAidsEnabled(editor);\n    }\n\n    each(dom.select('table,a', scope), function (matchedElm) {\n      switch (matchedElm.nodeName) {\n        case 'TABLE':\n          var cls = getVisualAidsTableClass(editor);\n          var value = dom.getAttrib(matchedElm, 'border');\n\n          if ((!value || value === '0') && editor.hasVisual) {\n            dom.addClass(matchedElm, cls);\n          } else {\n            dom.removeClass(matchedElm, cls);\n          }\n\n          break;\n\n        case 'A':\n          if (!dom.getAttrib(matchedElm, 'href')) {\n            var value_1 = dom.getAttrib(matchedElm, 'name') || matchedElm.id;\n            var cls_1 = getVisualAidsAnchorClass(editor);\n\n            if (value_1 && editor.hasVisual) {\n              dom.addClass(matchedElm, cls_1);\n            } else {\n              dom.removeClass(matchedElm, cls_1);\n            }\n          }\n\n          break;\n      }\n    });\n    editor.fire('VisualAid', {\n      element: elm,\n      hasVisual: editor.hasVisual\n    });\n  };\n\n  var sibling$2 = function (scope, predicate) {\n    return sibling(scope, predicate).isSome();\n  };\n\n  var ZWSP$1 = ZWSP,\n      CARET_ID$1 = '_mce_caret';\n\n  var importNode = function (ownerDocument, node) {\n    return ownerDocument.importNode(node, true);\n  };\n\n  var getEmptyCaretContainers = function (node) {\n    var nodes = [];\n\n    while (node) {\n      if (node.nodeType === 3 && node.nodeValue !== ZWSP$1 || node.childNodes.length > 1) {\n        return [];\n      }\n\n      if (node.nodeType === 1) {\n        nodes.push(node);\n      }\n\n      node = node.firstChild;\n    }\n\n    return nodes;\n  };\n\n  var isCaretContainerEmpty = function (node) {\n    return getEmptyCaretContainers(node).length > 0;\n  };\n\n  var findFirstTextNode = function (node) {\n    if (node) {\n      var walker = new DomTreeWalker(node, node);\n\n      for (node = walker.current(); node; node = walker.next()) {\n        if (isText$1(node)) {\n          return node;\n        }\n      }\n    }\n\n    return null;\n  };\n\n  var createCaretContainer = function (fill) {\n    var caretContainer = SugarElement.fromTag('span');\n    setAll(caretContainer, {\n      'id': CARET_ID$1,\n      'data-mce-bogus': '1',\n      'data-mce-type': 'format-caret'\n    });\n\n    if (fill) {\n      append(caretContainer, SugarElement.fromText(ZWSP$1));\n    }\n\n    return caretContainer;\n  };\n\n  var trimZwspFromCaretContainer = function (caretContainerNode) {\n    var textNode = findFirstTextNode(caretContainerNode);\n\n    if (textNode && textNode.nodeValue.charAt(0) === ZWSP$1) {\n      textNode.deleteData(0, 1);\n    }\n\n    return textNode;\n  };\n\n  var removeCaretContainerNode = function (editor, node, moveCaret) {\n    if (moveCaret === void 0) {\n      moveCaret = true;\n    }\n\n    var dom = editor.dom,\n        selection = editor.selection;\n\n    if (isCaretContainerEmpty(node)) {\n      deleteElement(editor, false, SugarElement.fromDom(node), moveCaret);\n    } else {\n      var rng = selection.getRng();\n      var block = dom.getParent(node, dom.isBlock);\n      var startContainer = rng.startContainer;\n      var startOffset = rng.startOffset;\n      var endContainer = rng.endContainer;\n      var endOffset = rng.endOffset;\n      var textNode = trimZwspFromCaretContainer(node);\n      dom.remove(node, true);\n\n      if (startContainer === textNode && startOffset > 0) {\n        rng.setStart(textNode, startOffset - 1);\n      }\n\n      if (endContainer === textNode && endOffset > 0) {\n        rng.setEnd(textNode, endOffset - 1);\n      }\n\n      if (block && dom.isEmpty(block)) {\n        fillWithPaddingBr(SugarElement.fromDom(block));\n      }\n\n      selection.setRng(rng);\n    }\n  };\n\n  var removeCaretContainer = function (editor, node, moveCaret) {\n    if (moveCaret === void 0) {\n      moveCaret = true;\n    }\n\n    var dom = editor.dom,\n        selection = editor.selection;\n\n    if (!node) {\n      node = getParentCaretContainer(editor.getBody(), selection.getStart());\n\n      if (!node) {\n        while (node = dom.get(CARET_ID$1)) {\n          removeCaretContainerNode(editor, node, false);\n        }\n      }\n    } else {\n      removeCaretContainerNode(editor, node, moveCaret);\n    }\n  };\n\n  var insertCaretContainerNode = function (editor, caretContainer, formatNode) {\n    var dom = editor.dom,\n        block = dom.getParent(formatNode, curry(isTextBlock$1, editor));\n\n    if (block && dom.isEmpty(block)) {\n      formatNode.parentNode.replaceChild(caretContainer, formatNode);\n    } else {\n      removeTrailingBr(SugarElement.fromDom(formatNode));\n\n      if (dom.isEmpty(formatNode)) {\n        formatNode.parentNode.replaceChild(caretContainer, formatNode);\n      } else {\n        dom.insertAfter(caretContainer, formatNode);\n      }\n    }\n  };\n\n  var appendNode = function (parentNode, node) {\n    parentNode.appendChild(node);\n    return node;\n  };\n\n  var insertFormatNodesIntoCaretContainer = function (formatNodes, caretContainer) {\n    var innerMostFormatNode = foldr(formatNodes, function (parentNode, formatNode) {\n      return appendNode(parentNode, formatNode.cloneNode(false));\n    }, caretContainer);\n    return appendNode(innerMostFormatNode, innerMostFormatNode.ownerDocument.createTextNode(ZWSP$1));\n  };\n\n  var cleanFormatNode = function (editor, caretContainer, formatNode, name, vars, similar) {\n    var formatter = editor.formatter;\n    var dom = editor.dom;\n    var validFormats = filter(keys(formatter.get()), function (formatName) {\n      return formatName !== name && !contains$1(formatName, 'removeformat');\n    });\n    var matchedFormats = matchAllOnNode(editor, formatNode, validFormats);\n    var uniqueFormats = filter(matchedFormats, function (fmtName) {\n      return !areSimilarFormats(editor, fmtName, name);\n    });\n\n    if (uniqueFormats.length > 0) {\n      var clonedFormatNode = formatNode.cloneNode(false);\n      dom.add(caretContainer, clonedFormatNode);\n      formatter.remove(name, vars, clonedFormatNode, similar);\n      dom.remove(clonedFormatNode);\n      return Optional.some(clonedFormatNode);\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var applyCaretFormat = function (editor, name, vars) {\n    var caretContainer, textNode;\n    var selection = editor.selection;\n    var selectionRng = selection.getRng();\n    var offset = selectionRng.startOffset;\n    var container = selectionRng.startContainer;\n    var text = container.nodeValue;\n    caretContainer = getParentCaretContainer(editor.getBody(), selection.getStart());\n\n    if (caretContainer) {\n      textNode = findFirstTextNode(caretContainer);\n    }\n\n    var wordcharRegex = /[^\\s\\u00a0\\u00ad\\u200b\\ufeff]/;\n\n    if (text && offset > 0 && offset < text.length && wordcharRegex.test(text.charAt(offset)) && wordcharRegex.test(text.charAt(offset - 1))) {\n      var bookmark = selection.getBookmark();\n      selectionRng.collapse(true);\n      var rng = expandRng(editor, selectionRng, editor.formatter.get(name));\n      rng = split$1(rng);\n      editor.formatter.apply(name, vars, rng);\n      selection.moveToBookmark(bookmark);\n    } else {\n      if (!caretContainer || textNode.nodeValue !== ZWSP$1) {\n        caretContainer = importNode(editor.getDoc(), createCaretContainer(true).dom);\n        textNode = caretContainer.firstChild;\n        selectionRng.insertNode(caretContainer);\n        offset = 1;\n        editor.formatter.apply(name, vars, caretContainer);\n      } else {\n        editor.formatter.apply(name, vars, caretContainer);\n      }\n\n      selection.setCursorLocation(textNode, offset);\n    }\n  };\n\n  var removeCaretFormat = function (editor, name, vars, similar) {\n    var dom = editor.dom;\n    var selection = editor.selection;\n    var hasContentAfter, node, formatNode;\n    var parents = [];\n    var rng = selection.getRng();\n    var container = rng.startContainer;\n    var offset = rng.startOffset;\n    node = container;\n\n    if (container.nodeType === 3) {\n      if (offset !== container.nodeValue.length) {\n        hasContentAfter = true;\n      }\n\n      node = node.parentNode;\n    }\n\n    while (node) {\n      if (matchNode(editor, node, name, vars, similar)) {\n        formatNode = node;\n        break;\n      }\n\n      if (node.nextSibling) {\n        hasContentAfter = true;\n      }\n\n      parents.push(node);\n      node = node.parentNode;\n    }\n\n    if (!formatNode) {\n      return;\n    }\n\n    if (hasContentAfter) {\n      var bookmark = selection.getBookmark();\n      rng.collapse(true);\n      var expandedRng = expandRng(editor, rng, editor.formatter.get(name), true);\n      expandedRng = split$1(expandedRng);\n      editor.formatter.remove(name, vars, expandedRng, similar);\n      selection.moveToBookmark(bookmark);\n    } else {\n      var caretContainer = getParentCaretContainer(editor.getBody(), formatNode);\n      var newCaretContainer = createCaretContainer(false).dom;\n      insertCaretContainerNode(editor, newCaretContainer, caretContainer !== null ? caretContainer : formatNode);\n      var cleanedFormatNode = cleanFormatNode(editor, newCaretContainer, formatNode, name, vars, similar);\n      var caretTextNode = insertFormatNodesIntoCaretContainer(parents.concat(cleanedFormatNode.toArray()), newCaretContainer);\n      removeCaretContainerNode(editor, caretContainer, false);\n      selection.setCursorLocation(caretTextNode, 1);\n\n      if (dom.isEmpty(formatNode)) {\n        dom.remove(formatNode);\n      }\n    }\n  };\n\n  var disableCaretContainer = function (editor, keyCode) {\n    var selection = editor.selection,\n        body = editor.getBody();\n    removeCaretContainer(editor, null, false);\n\n    if ((keyCode === 8 || keyCode === 46) && selection.isCollapsed() && selection.getStart().innerHTML === ZWSP$1) {\n      removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\n    }\n\n    if (keyCode === 37 || keyCode === 39) {\n      removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\n    }\n  };\n\n  var setup$3 = function (editor) {\n    editor.on('mouseup keydown', function (e) {\n      disableCaretContainer(editor, e.keyCode);\n    });\n  };\n\n  var replaceWithCaretFormat = function (targetNode, formatNodes) {\n    var caretContainer = createCaretContainer(false);\n    var innerMost = insertFormatNodesIntoCaretContainer(formatNodes, caretContainer.dom);\n    before(SugarElement.fromDom(targetNode), caretContainer);\n    remove(SugarElement.fromDom(targetNode));\n    return CaretPosition$1(innerMost, 0);\n  };\n\n  var isFormatElement = function (editor, element) {\n    var inlineElements = editor.schema.getTextInlineElements();\n    return inlineElements.hasOwnProperty(name(element)) && !isCaretNode(element.dom) && !isBogus(element.dom);\n  };\n\n  var isEmptyCaretFormatElement = function (element) {\n    return isCaretNode(element.dom) && isCaretContainerEmpty(element.dom);\n  };\n\n  var postProcessHooks = {};\n  var filter$4 = filter$2;\n  var each$8 = each$2;\n\n  var addPostProcessHook = function (name, hook) {\n    var hooks = postProcessHooks[name];\n\n    if (!hooks) {\n      postProcessHooks[name] = [];\n    }\n\n    postProcessHooks[name].push(hook);\n  };\n\n  var postProcess = function (name, editor) {\n    each$8(postProcessHooks[name], function (hook) {\n      hook(editor);\n    });\n  };\n\n  addPostProcessHook('pre', function (editor) {\n    var rng = editor.selection.getRng();\n    var blocks;\n\n    var hasPreSibling = function (pre) {\n      return isPre(pre.previousSibling) && indexOf$1(blocks, pre.previousSibling) !== -1;\n    };\n\n    var joinPre = function (pre1, pre2) {\n      DomQuery(pre2).remove();\n      DomQuery(pre1).append('<br><br>').append(pre2.childNodes);\n    };\n\n    var isPre = matchNodeNames(['pre']);\n\n    if (!rng.collapsed) {\n      blocks = editor.selection.getSelectedBlocks();\n      each$8(filter$4(filter$4(blocks, isPre), hasPreSibling), function (pre) {\n        joinPre(pre.previousSibling, pre);\n      });\n    }\n  });\n  var each$9 = Tools.each;\n\n  var isElementNode = function (node) {\n    return isElement$1(node) && !isBookmarkNode$1(node) && !isCaretNode(node) && !isBogus(node);\n  };\n\n  var findElementSibling = function (node, siblingName) {\n    var sibling;\n\n    for (sibling = node; sibling; sibling = sibling[siblingName]) {\n      if (isText$1(sibling) && sibling.nodeValue.length !== 0) {\n        return node;\n      }\n\n      if (isElement$1(sibling) && !isBookmarkNode$1(sibling)) {\n        return sibling;\n      }\n    }\n\n    return node;\n  };\n\n  var mergeSiblingsNodes = function (dom, prev, next) {\n    var sibling, tmpSibling;\n    var elementUtils = new ElementUtils(dom);\n\n    if (prev && next) {\n      prev = findElementSibling(prev, 'previousSibling');\n      next = findElementSibling(next, 'nextSibling');\n\n      if (elementUtils.compare(prev, next)) {\n        for (sibling = prev.nextSibling; sibling && sibling !== next;) {\n          tmpSibling = sibling;\n          sibling = sibling.nextSibling;\n          prev.appendChild(tmpSibling);\n        }\n\n        dom.remove(next);\n        Tools.each(Tools.grep(next.childNodes), function (node) {\n          prev.appendChild(node);\n        });\n        return prev;\n      }\n    }\n\n    return next;\n  };\n\n  var mergeSiblings = function (dom, format, vars, node) {\n    if (node && format.merge_siblings !== false) {\n      var newNode = mergeSiblingsNodes(dom, getNonWhiteSpaceSibling(node), node);\n      mergeSiblingsNodes(dom, newNode, getNonWhiteSpaceSibling(newNode, true));\n    }\n  };\n\n  var clearChildStyles = function (dom, format, node) {\n    if (format.clear_child_styles) {\n      var selector = format.links ? '*:not(a)' : '*';\n      each$9(dom.select(selector, node), function (node) {\n        if (isElementNode(node)) {\n          each$9(format.styles, function (value, name) {\n            dom.setStyle(node, name, '');\n          });\n        }\n      });\n    }\n  };\n\n  var processChildElements = function (node, filter, process) {\n    each$9(node.childNodes, function (node) {\n      if (isElementNode(node)) {\n        if (filter(node)) {\n          process(node);\n        }\n\n        if (node.hasChildNodes()) {\n          processChildElements(node, filter, process);\n        }\n      }\n    });\n  };\n\n  var unwrapEmptySpan = function (dom, node) {\n    if (node.nodeName === 'SPAN' && dom.getAttribs(node).length === 0) {\n      dom.remove(node, true);\n    }\n  };\n\n  var hasStyle = function (dom, name) {\n    return function (node) {\n      return !!(node && getStyle(dom, node, name));\n    };\n  };\n\n  var applyStyle = function (dom, name, value) {\n    return function (node) {\n      dom.setStyle(node, name, value);\n\n      if (node.getAttribute('style') === '') {\n        node.removeAttribute('style');\n      }\n\n      unwrapEmptySpan(dom, node);\n    };\n  };\n\n  var removeResult = Adt.generate([{\n    keep: []\n  }, {\n    rename: ['name']\n  }, {\n    removed: []\n  }]);\n  var MCE_ATTR_RE = /^(src|href|style)$/;\n  var each$a = Tools.each;\n  var isEq$3 = isEq;\n\n  var isTableCellOrRow = function (node) {\n    return /^(TR|TH|TD)$/.test(node.nodeName);\n  };\n\n  var isChildOfInlineParent = function (dom, node, parent) {\n    return dom.isChildOf(node, parent) && node !== parent && !dom.isBlock(parent);\n  };\n\n  var getContainer = function (ed, rng, start) {\n    var container, offset;\n    container = rng[start ? 'startContainer' : 'endContainer'];\n    offset = rng[start ? 'startOffset' : 'endOffset'];\n\n    if (isElement$1(container)) {\n      var lastIdx = container.childNodes.length - 1;\n\n      if (!start && offset) {\n        offset--;\n      }\n\n      container = container.childNodes[offset > lastIdx ? lastIdx : offset];\n    }\n\n    if (isText$1(container) && start && offset >= container.nodeValue.length) {\n      container = new DomTreeWalker(container, ed.getBody()).next() || container;\n    }\n\n    if (isText$1(container) && !start && offset === 0) {\n      container = new DomTreeWalker(container, ed.getBody()).prev() || container;\n    }\n\n    return container;\n  };\n\n  var normalizeTableSelection = function (node, start) {\n    var prop = start ? 'firstChild' : 'lastChild';\n\n    if (isTableCellOrRow(node) && node[prop]) {\n      var childNode = node[prop];\n\n      if (node.nodeName === 'TR') {\n        return childNode[prop] || childNode;\n      } else {\n        return childNode;\n      }\n    }\n\n    return node;\n  };\n\n  var wrap$2 = function (dom, node, name, attrs) {\n    var wrapper = dom.create(name, attrs);\n    node.parentNode.insertBefore(wrapper, node);\n    wrapper.appendChild(node);\n    return wrapper;\n  };\n\n  var wrapWithSiblings = function (dom, node, next, name, attrs) {\n    var start = SugarElement.fromDom(node);\n    var wrapper = SugarElement.fromDom(dom.create(name, attrs));\n    var siblings = next ? nextSiblings(start) : prevSiblings(start);\n    append$1(wrapper, siblings);\n\n    if (next) {\n      before(start, wrapper);\n      prepend(wrapper, start);\n    } else {\n      after(start, wrapper);\n      append(wrapper, start);\n    }\n\n    return wrapper.dom;\n  };\n\n  var matchName$1 = function (dom, node, format) {\n    if (isEq$3(node, format.inline)) {\n      return true;\n    }\n\n    if (isEq$3(node, format.block)) {\n      return true;\n    }\n\n    if (format.selector) {\n      return isElement$1(node) && dom.is(node, format.selector);\n    }\n  };\n\n  var isColorFormatAndAnchor = function (node, format) {\n    return format.links && node.nodeName === 'A';\n  };\n\n  var find$3 = function (dom, node, next, inc) {\n    node = getNonWhiteSpaceSibling(node, next, inc);\n    return !node || node.nodeName === 'BR' || dom.isBlock(node);\n  };\n\n  var removeNode$1 = function (ed, node, format) {\n    var parentNode = node.parentNode;\n    var rootBlockElm;\n    var dom = ed.dom,\n        forcedRootBlock = getForcedRootBlock(ed);\n\n    if (format.block) {\n      if (!forcedRootBlock) {\n        if (dom.isBlock(node) && !dom.isBlock(parentNode)) {\n          if (!find$3(dom, node, false) && !find$3(dom, node.firstChild, true, true)) {\n            node.insertBefore(dom.create('br'), node.firstChild);\n          }\n\n          if (!find$3(dom, node, true) && !find$3(dom, node.lastChild, false, true)) {\n            node.appendChild(dom.create('br'));\n          }\n        }\n      } else {\n        if (parentNode === dom.getRoot()) {\n          if (!format.list_block || !isEq$3(node, format.list_block)) {\n            each(from$1(node.childNodes), function (node) {\n              if (isValid(ed, forcedRootBlock, node.nodeName.toLowerCase())) {\n                if (!rootBlockElm) {\n                  rootBlockElm = wrap$2(dom, node, forcedRootBlock);\n                  dom.setAttribs(rootBlockElm, ed.settings.forced_root_block_attrs);\n                } else {\n                  rootBlockElm.appendChild(node);\n                }\n              } else {\n                rootBlockElm = 0;\n              }\n            });\n          }\n        }\n      }\n    }\n\n    if (format.selector && format.inline && !isEq$3(format.inline, node)) {\n      return;\n    }\n\n    dom.remove(node, true);\n  };\n\n  var removeFormatInternal = function (ed, format, vars, node, compareNode) {\n    var stylesModified;\n    var dom = ed.dom;\n\n    if (!matchName$1(dom, node, format) && !isColorFormatAndAnchor(node, format)) {\n      return removeResult.keep();\n    }\n\n    var elm = node;\n\n    if (format.inline && format.remove === 'all' && isArray(format.preserve_attributes)) {\n      var attrsToPreserve = filter(dom.getAttribs(elm), function (attr) {\n        return contains(format.preserve_attributes, attr.name.toLowerCase());\n      });\n      dom.removeAllAttribs(elm);\n      each(attrsToPreserve, function (attr) {\n        return dom.setAttrib(elm, attr.name, attr.value);\n      });\n\n      if (attrsToPreserve.length > 0) {\n        return removeResult.rename('span');\n      }\n    }\n\n    if (format.remove !== 'all') {\n      each$a(format.styles, function (value, name) {\n        value = normalizeStyleValue(dom, replaceVars(value, vars), name + '');\n\n        if (isNumber(name)) {\n          name = value;\n          compareNode = null;\n        }\n\n        if (format.remove_similar || !compareNode || isEq$3(getStyle(dom, compareNode, name), value)) {\n          dom.setStyle(elm, name, '');\n        }\n\n        stylesModified = true;\n      });\n\n      if (stylesModified && dom.getAttrib(elm, 'style') === '') {\n        elm.removeAttribute('style');\n        elm.removeAttribute('data-mce-style');\n      }\n\n      each$a(format.attributes, function (value, name) {\n        var valueOut;\n        value = replaceVars(value, vars);\n\n        if (isNumber(name)) {\n          name = value;\n          compareNode = null;\n        }\n\n        if (format.remove_similar || !compareNode || isEq$3(dom.getAttrib(compareNode, name), value)) {\n          if (name === 'class') {\n            value = dom.getAttrib(elm, name);\n\n            if (value) {\n              valueOut = '';\n              each(value.split(/\\s+/), function (cls) {\n                if (/mce\\-\\w+/.test(cls)) {\n                  valueOut += (valueOut ? ' ' : '') + cls;\n                }\n              });\n\n              if (valueOut) {\n                dom.setAttrib(elm, name, valueOut);\n                return;\n              }\n            }\n          }\n\n          if (name === 'class') {\n            elm.removeAttribute('className');\n          }\n\n          if (MCE_ATTR_RE.test(name)) {\n            elm.removeAttribute('data-mce-' + name);\n          }\n\n          elm.removeAttribute(name);\n        }\n      });\n      each$a(format.classes, function (value) {\n        value = replaceVars(value, vars);\n\n        if (!compareNode || dom.hasClass(compareNode, value)) {\n          dom.removeClass(elm, value);\n        }\n      });\n      var attrs = dom.getAttribs(elm);\n\n      for (var i = 0; i < attrs.length; i++) {\n        var attrName = attrs[i].nodeName;\n\n        if (attrName.indexOf('_') !== 0 && attrName.indexOf('data-') !== 0) {\n          return removeResult.keep();\n        }\n      }\n    }\n\n    if (format.remove !== 'none') {\n      removeNode$1(ed, elm, format);\n      return removeResult.removed();\n    }\n\n    return removeResult.keep();\n  };\n\n  var removeFormat = function (ed, format, vars, node, compareNode) {\n    return removeFormatInternal(ed, format, vars, node, compareNode).fold(never, function (newName) {\n      ed.dom.rename(node, newName);\n      return true;\n    }, always);\n  };\n\n  var findFormatRoot = function (editor, container, name, vars, similar) {\n    var formatRoot;\n    each(getParents$1(editor.dom, container.parentNode).reverse(), function (parent) {\n      if (!formatRoot && parent.id !== '_start' && parent.id !== '_end') {\n        var format = matchNode(editor, parent, name, vars, similar);\n\n        if (format && format.split !== false) {\n          formatRoot = parent;\n        }\n      }\n    });\n    return formatRoot;\n  };\n\n  var removeFormatFromClone = function (editor, format, vars, clone) {\n    return removeFormatInternal(editor, format, vars, clone, clone).fold(constant(clone), function (newName) {\n      var fragment = editor.dom.createFragment();\n      fragment.appendChild(clone);\n      return editor.dom.rename(clone, newName);\n    }, constant(null));\n  };\n\n  var wrapAndSplit = function (editor, formatList, formatRoot, container, target, split, format, vars) {\n    var clone, lastClone, firstClone;\n    var dom = editor.dom;\n\n    if (formatRoot) {\n      var formatRootParent = formatRoot.parentNode;\n\n      for (var parent_1 = container.parentNode; parent_1 && parent_1 !== formatRootParent; parent_1 = parent_1.parentNode) {\n        clone = dom.clone(parent_1, false);\n\n        for (var i = 0; i < formatList.length; i++) {\n          clone = removeFormatFromClone(editor, formatList[i], vars, clone);\n\n          if (clone === null) {\n            break;\n          }\n        }\n\n        if (clone) {\n          if (lastClone) {\n            clone.appendChild(lastClone);\n          }\n\n          if (!firstClone) {\n            firstClone = clone;\n          }\n\n          lastClone = clone;\n        }\n      }\n\n      if (split && (!format.mixed || !dom.isBlock(formatRoot))) {\n        container = dom.split(formatRoot, container);\n      }\n\n      if (lastClone) {\n        target.parentNode.insertBefore(lastClone, target);\n        firstClone.appendChild(target);\n\n        if (format.inline) {\n          mergeSiblings(dom, format, vars, lastClone);\n        }\n      }\n    }\n\n    return container;\n  };\n\n  var remove$6 = function (ed, name, vars, node, similar) {\n    var formatList = ed.formatter.get(name);\n    var format = formatList[0];\n    var contentEditable = true;\n    var dom = ed.dom;\n    var selection = ed.selection;\n\n    var splitToFormatRoot = function (container) {\n      var formatRoot = findFormatRoot(ed, container, name, vars, similar);\n      return wrapAndSplit(ed, formatList, formatRoot, container, container, true, format, vars);\n    };\n\n    var isRemoveBookmarkNode = function (node) {\n      return isBookmarkNode$1(node) && isElement$1(node) && (node.id === '_start' || node.id === '_end');\n    };\n\n    var process = function (node) {\n      var lastContentEditable, hasContentEditableState;\n\n      if (isElement$1(node) && dom.getContentEditable(node)) {\n        lastContentEditable = contentEditable;\n        contentEditable = dom.getContentEditable(node) === 'true';\n        hasContentEditableState = true;\n      }\n\n      var children = from$1(node.childNodes);\n\n      if (contentEditable && !hasContentEditableState) {\n        for (var i = 0; i < formatList.length; i++) {\n          if (removeFormat(ed, formatList[i], vars, node, node)) {\n            break;\n          }\n        }\n      }\n\n      if (format.deep) {\n        if (children.length) {\n          for (var i = 0; i < children.length; i++) {\n            process(children[i]);\n          }\n\n          if (hasContentEditableState) {\n            contentEditable = lastContentEditable;\n          }\n        }\n      }\n    };\n\n    var unwrap = function (start) {\n      var node = dom.get(start ? '_start' : '_end');\n      var out = node[start ? 'firstChild' : 'lastChild'];\n\n      if (isRemoveBookmarkNode(out)) {\n        out = out[start ? 'firstChild' : 'lastChild'];\n      }\n\n      if (isText$1(out) && out.data.length === 0) {\n        out = start ? node.previousSibling || node.nextSibling : node.nextSibling || node.previousSibling;\n      }\n\n      dom.remove(node, true);\n      return out;\n    };\n\n    var removeRngStyle = function (rng) {\n      var startContainer, endContainer;\n      var expandedRng = expandRng(ed, rng, formatList, rng.collapsed);\n\n      if (format.split) {\n        expandedRng = split$1(expandedRng);\n        startContainer = getContainer(ed, expandedRng, true);\n        endContainer = getContainer(ed, expandedRng);\n\n        if (startContainer !== endContainer) {\n          startContainer = normalizeTableSelection(startContainer, true);\n          endContainer = normalizeTableSelection(endContainer, false);\n\n          if (isChildOfInlineParent(dom, startContainer, endContainer)) {\n            var marker = Optional.from(startContainer.firstChild).getOr(startContainer);\n            splitToFormatRoot(wrapWithSiblings(dom, marker, true, 'span', {\n              'id': '_start',\n              'data-mce-type': 'bookmark'\n            }));\n            unwrap(true);\n            return;\n          }\n\n          if (isChildOfInlineParent(dom, endContainer, startContainer)) {\n            var marker = Optional.from(endContainer.lastChild).getOr(endContainer);\n            splitToFormatRoot(wrapWithSiblings(dom, marker, false, 'span', {\n              'id': '_end',\n              'data-mce-type': 'bookmark'\n            }));\n            unwrap(false);\n            return;\n          }\n\n          startContainer = wrap$2(dom, startContainer, 'span', {\n            'id': '_start',\n            'data-mce-type': 'bookmark'\n          });\n          endContainer = wrap$2(dom, endContainer, 'span', {\n            'id': '_end',\n            'data-mce-type': 'bookmark'\n          });\n          var newRng = dom.createRng();\n          newRng.setStartAfter(startContainer);\n          newRng.setEndBefore(endContainer);\n          walk$1(dom, newRng, function (nodes) {\n            each(nodes, function (n) {\n              if (!isBookmarkNode$1(n) && !isBookmarkNode$1(n.parentNode)) {\n                splitToFormatRoot(n);\n              }\n            });\n          });\n          splitToFormatRoot(startContainer);\n          splitToFormatRoot(endContainer);\n          startContainer = unwrap(true);\n          endContainer = unwrap();\n        } else {\n          startContainer = endContainer = splitToFormatRoot(startContainer);\n        }\n\n        expandedRng.startContainer = startContainer.parentNode ? startContainer.parentNode : startContainer;\n        expandedRng.startOffset = dom.nodeIndex(startContainer);\n        expandedRng.endContainer = endContainer.parentNode ? endContainer.parentNode : endContainer;\n        expandedRng.endOffset = dom.nodeIndex(endContainer) + 1;\n      }\n\n      walk$1(dom, expandedRng, function (nodes) {\n        each(nodes, function (node) {\n          process(node);\n          var textDecorations = ['underline', 'line-through', 'overline'];\n          each(textDecorations, function (decoration) {\n            if (isElement$1(node) && ed.dom.getStyle(node, 'text-decoration') === decoration && node.parentNode && getTextDecoration(dom, node.parentNode) === decoration) {\n              removeFormat(ed, {\n                deep: false,\n                exact: true,\n                inline: 'span',\n                styles: {\n                  textDecoration: decoration\n                }\n              }, null, node);\n            }\n          });\n        });\n      });\n    };\n\n    if (node) {\n      if (isNode(node)) {\n        var rng = dom.createRng();\n        rng.setStartBefore(node);\n        rng.setEndAfter(node);\n        removeRngStyle(rng);\n      } else {\n        removeRngStyle(node);\n      }\n\n      return;\n    }\n\n    if (dom.getContentEditable(selection.getNode()) === 'false') {\n      node = selection.getNode();\n\n      for (var i = 0; i < formatList.length; i++) {\n        if (formatList[i].ceFalseOverride) {\n          if (removeFormat(ed, formatList[i], vars, node, node)) {\n            break;\n          }\n        }\n      }\n\n      return;\n    }\n\n    if (!selection.isCollapsed() || !format.inline || getCellsFromEditor(ed).length) {\n      preserve(selection, true, function () {\n        runOnRanges(ed, removeRngStyle);\n      });\n\n      if (format.inline && match(ed, name, vars, selection.getStart())) {\n        moveStart(dom, selection, selection.getRng());\n      }\n\n      ed.nodeChanged();\n    } else {\n      removeCaretFormat(ed, name, vars, similar);\n    }\n  };\n\n  var each$b = Tools.each;\n\n  var mergeTextDecorationsAndColor = function (dom, format, vars, node) {\n    var processTextDecorationsAndColor = function (n) {\n      if (n.nodeType === 1 && n.parentNode && n.parentNode.nodeType === 1) {\n        var textDecoration = getTextDecoration(dom, n.parentNode);\n\n        if (dom.getStyle(n, 'color') && textDecoration) {\n          dom.setStyle(n, 'text-decoration', textDecoration);\n        } else if (dom.getStyle(n, 'text-decoration') === textDecoration) {\n          dom.setStyle(n, 'text-decoration', null);\n        }\n      }\n    };\n\n    if (format.styles && (format.styles.color || format.styles.textDecoration)) {\n      Tools.walk(node, processTextDecorationsAndColor, 'childNodes');\n      processTextDecorationsAndColor(node);\n    }\n  };\n\n  var mergeBackgroundColorAndFontSize = function (dom, format, vars, node) {\n    if (format.styles && format.styles.backgroundColor) {\n      processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'backgroundColor', replaceVars(format.styles.backgroundColor, vars)));\n    }\n  };\n\n  var mergeSubSup = function (dom, format, vars, node) {\n    if (format.inline === 'sub' || format.inline === 'sup') {\n      processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'fontSize', ''));\n      dom.remove(dom.select(format.inline === 'sup' ? 'sub' : 'sup', node), true);\n    }\n  };\n\n  var mergeWithChildren = function (editor, formatList, vars, node) {\n    each$b(formatList, function (format) {\n      each$b(editor.dom.select(format.inline, node), function (child) {\n        if (!isElementNode(child)) {\n          return;\n        }\n\n        removeFormat(editor, format, vars, child, format.exact ? child : null);\n      });\n      clearChildStyles(editor.dom, format, node);\n    });\n  };\n\n  var mergeWithParents = function (editor, format, name, vars, node) {\n    if (matchNode(editor, node.parentNode, name, vars)) {\n      if (removeFormat(editor, format, vars, node)) {\n        return;\n      }\n    }\n\n    if (format.merge_with_parents) {\n      editor.dom.getParent(node.parentNode, function (parent) {\n        if (matchNode(editor, parent, name, vars)) {\n          removeFormat(editor, format, vars, node);\n          return true;\n        }\n      });\n    }\n  };\n\n  var each$c = Tools.each;\n\n  var hasFormatProperty = function (format, prop) {\n    return hasNonNullableKey(format, prop);\n  };\n\n  var isElementNode$1 = function (node) {\n    return node && node.nodeType === 1 && !isBookmarkNode$1(node) && !isCaretNode(node) && !isBogus(node);\n  };\n\n  var canFormatBR = function (editor, format, node, parentName) {\n    if (canFormatEmptyLines(editor) && isInlineFormat(format)) {\n      var validBRParentElements = __assign(__assign({}, editor.schema.getTextBlockElements()), {\n        td: {},\n        th: {},\n        li: {},\n        dt: {},\n        dd: {},\n        figcaption: {},\n        caption: {},\n        details: {},\n        summary: {}\n      });\n\n      var hasCaretNodeSibling = sibling$2(SugarElement.fromDom(node), function (sibling) {\n        return isCaretNode(sibling.dom);\n      });\n      return hasNonNullableKey(validBRParentElements, parentName) && isEmpty(SugarElement.fromDom(node.parentNode), false) && !hasCaretNodeSibling;\n    } else {\n      return false;\n    }\n  };\n\n  var applyFormat = function (ed, name, vars, node) {\n    var formatList = ed.formatter.get(name);\n    var format = formatList[0];\n    var isCollapsed = !node && ed.selection.isCollapsed();\n    var dom = ed.dom;\n    var selection = ed.selection;\n\n    var setElementFormat = function (elm, fmt) {\n      fmt = fmt || format;\n\n      if (elm) {\n        if (fmt.onformat) {\n          fmt.onformat(elm, fmt, vars, node);\n        }\n\n        each$c(fmt.styles, function (value, name) {\n          dom.setStyle(elm, name, replaceVars(value, vars));\n        });\n\n        if (fmt.styles) {\n          var styleVal = dom.getAttrib(elm, 'style');\n\n          if (styleVal) {\n            dom.setAttrib(elm, 'data-mce-style', styleVal);\n          }\n        }\n\n        each$c(fmt.attributes, function (value, name) {\n          dom.setAttrib(elm, name, replaceVars(value, vars));\n        });\n        each$c(fmt.classes, function (value) {\n          value = replaceVars(value, vars);\n\n          if (!dom.hasClass(elm, value)) {\n            dom.addClass(elm, value);\n          }\n        });\n      }\n    };\n\n    var applyNodeStyle = function (formatList, node) {\n      var found = false;\n\n      if (!isSelectorFormat(format)) {\n        return false;\n      }\n\n      each$c(formatList, function (format) {\n        if ('collapsed' in format && format.collapsed !== isCollapsed) {\n          return;\n        }\n\n        if (dom.is(node, format.selector) && !isCaretNode(node)) {\n          setElementFormat(node, format);\n          found = true;\n          return false;\n        }\n      });\n      return found;\n    };\n\n    var applyRngStyle = function (dom, rng, bookmark, nodeSpecific) {\n      var newWrappers = [];\n      var contentEditable = true;\n      var wrapName = format.inline || format.block;\n      var wrapElm = dom.create(wrapName);\n      setElementFormat(wrapElm);\n      walk$1(dom, rng, function (nodes) {\n        var currentWrapElm;\n\n        var process = function (node) {\n          var hasContentEditableState = false;\n          var lastContentEditable = contentEditable;\n          var nodeName = node.nodeName.toLowerCase();\n          var parentName = node.parentNode.nodeName.toLowerCase();\n\n          if (isElement$1(node) && dom.getContentEditable(node)) {\n            lastContentEditable = contentEditable;\n            contentEditable = dom.getContentEditable(node) === 'true';\n            hasContentEditableState = true;\n          }\n\n          if (isBr(node) && !canFormatBR(ed, format, node, parentName)) {\n            currentWrapElm = null;\n\n            if (isBlockFormat(format)) {\n              dom.remove(node);\n            }\n\n            return;\n          }\n\n          if (format.wrapper && matchNode(ed, node, name, vars)) {\n            currentWrapElm = null;\n            return;\n          }\n\n          if (contentEditable && !hasContentEditableState && isBlockFormat(format) && !format.wrapper && isTextBlock$1(ed, nodeName) && isValid(ed, parentName, wrapName)) {\n            var elm = dom.rename(node, wrapName);\n            setElementFormat(elm);\n            newWrappers.push(elm);\n            currentWrapElm = null;\n            return;\n          }\n\n          if (isSelectorFormat(format)) {\n            var found = applyNodeStyle(formatList, node);\n\n            if (!hasFormatProperty(format, 'inline') || found) {\n              currentWrapElm = null;\n              return;\n            }\n          }\n\n          if (contentEditable && !hasContentEditableState && isValid(ed, wrapName, nodeName) && isValid(ed, parentName, wrapName) && !(!nodeSpecific && node.nodeType === 3 && node.nodeValue.length === 1 && node.nodeValue.charCodeAt(0) === 65279) && !isCaretNode(node) && (!hasFormatProperty(format, 'inline') || !dom.isBlock(node))) {\n            if (!currentWrapElm) {\n              currentWrapElm = dom.clone(wrapElm, false);\n              node.parentNode.insertBefore(currentWrapElm, node);\n              newWrappers.push(currentWrapElm);\n            }\n\n            currentWrapElm.appendChild(node);\n          } else {\n            currentWrapElm = null;\n            each$c(Tools.grep(node.childNodes), process);\n\n            if (hasContentEditableState) {\n              contentEditable = lastContentEditable;\n            }\n\n            currentWrapElm = null;\n          }\n        };\n\n        each$c(nodes, process);\n      });\n\n      if (format.links === true) {\n        each$c(newWrappers, function (node) {\n          var process = function (node) {\n            if (node.nodeName === 'A') {\n              setElementFormat(node, format);\n            }\n\n            each$c(Tools.grep(node.childNodes), process);\n          };\n\n          process(node);\n        });\n      }\n\n      each$c(newWrappers, function (node) {\n        var getChildCount = function (node) {\n          var count = 0;\n          each$c(node.childNodes, function (node) {\n            if (!isEmptyTextNode(node) && !isBookmarkNode$1(node)) {\n              count++;\n            }\n          });\n          return count;\n        };\n\n        var getChildElementNode = function (root) {\n          var child = false;\n          each$c(root.childNodes, function (node) {\n            if (isElementNode$1(node)) {\n              child = node;\n              return false;\n            }\n          });\n          return child;\n        };\n\n        var mergeStyles = function (node) {\n          var clone;\n          var child = getChildElementNode(node);\n\n          if (child && !isBookmarkNode$1(child) && matchName(dom, child, format)) {\n            clone = dom.clone(child, false);\n            setElementFormat(clone);\n            dom.replace(clone, node, true);\n            dom.remove(child, true);\n          }\n\n          return clone || node;\n        };\n\n        var childCount = getChildCount(node);\n\n        if ((newWrappers.length > 1 || !dom.isBlock(node)) && childCount === 0) {\n          dom.remove(node, true);\n          return;\n        }\n\n        if (isInlineFormat(format) || format.wrapper) {\n          if (!format.exact && childCount === 1) {\n            node = mergeStyles(node);\n          }\n\n          mergeWithChildren(ed, formatList, vars, node);\n          mergeWithParents(ed, format, name, vars, node);\n          mergeBackgroundColorAndFontSize(dom, format, vars, node);\n          mergeTextDecorationsAndColor(dom, format, vars, node);\n          mergeSubSup(dom, format, vars, node);\n          mergeSiblings(dom, format, vars, node);\n        }\n      });\n    };\n\n    if (dom.getContentEditable(selection.getNode()) === 'false') {\n      node = selection.getNode();\n\n      for (var i = 0, l = formatList.length; i < l; i++) {\n        var formatItem = formatList[i];\n\n        if (formatItem.ceFalseOverride && isSelectorFormat(formatItem) && dom.is(node, formatItem.selector)) {\n          setElementFormat(node, formatItem);\n          return;\n        }\n      }\n\n      return;\n    }\n\n    if (format) {\n      if (node) {\n        if (isNode(node)) {\n          if (!applyNodeStyle(formatList, node)) {\n            var rng = dom.createRng();\n            rng.setStartBefore(node);\n            rng.setEndAfter(node);\n            applyRngStyle(dom, expandRng(ed, rng, formatList), null, true);\n          }\n        } else {\n          applyRngStyle(dom, node, null, true);\n        }\n      } else {\n        if (!isCollapsed || !isInlineFormat(format) || getCellsFromEditor(ed).length) {\n          var curSelNode = selection.getNode();\n          var firstFormat = formatList[0];\n\n          if (!ed.settings.forced_root_block && firstFormat.defaultBlock && !dom.getParent(curSelNode, dom.isBlock)) {\n            applyFormat(ed, firstFormat.defaultBlock);\n          }\n\n          selection.setRng(normalize$2(selection.getRng()));\n          preserve(selection, true, function (bookmark) {\n            runOnRanges(ed, function (selectionRng, fake) {\n              var expandedRng = fake ? selectionRng : expandRng(ed, selectionRng, formatList);\n              applyRngStyle(dom, expandedRng);\n            });\n          });\n          moveStart(dom, selection, selection.getRng());\n          ed.nodeChanged();\n        } else {\n          applyCaretFormat(ed, name, vars);\n        }\n      }\n\n      postProcess(name, ed);\n    }\n  };\n\n  var setup$4 = function (registeredFormatListeners, editor) {\n    var currentFormats = Cell({});\n    registeredFormatListeners.set({});\n    editor.on('NodeChange', function (e) {\n      updateAndFireChangeCallbacks(editor, e.element, currentFormats, registeredFormatListeners.get());\n    });\n  };\n\n  var updateAndFireChangeCallbacks = function (editor, elm, currentFormats, formatChangeData) {\n    var formatsList = keys(currentFormats.get());\n    var newFormats = {};\n    var matchedFormats = {};\n    var parents = filter(getParents$1(editor.dom, elm), function (node) {\n      return node.nodeType === 1 && !node.getAttribute('data-mce-bogus');\n    });\n    each$1(formatChangeData, function (data, format) {\n      Tools.each(parents, function (node) {\n        if (editor.formatter.matchNode(node, format, {}, data.similar)) {\n          if (formatsList.indexOf(format) === -1) {\n            each(data.callbacks, function (callback) {\n              callback(true, {\n                node: node,\n                format: format,\n                parents: parents\n              });\n            });\n            newFormats[format] = data.callbacks;\n          }\n\n          matchedFormats[format] = data.callbacks;\n          return false;\n        }\n\n        if (matchesUnInheritedFormatSelector(editor, node, format)) {\n          return false;\n        }\n      });\n    });\n    var remainingFormats = filterRemainingFormats(currentFormats.get(), matchedFormats, elm, parents);\n    currentFormats.set(__assign(__assign({}, newFormats), remainingFormats));\n  };\n\n  var filterRemainingFormats = function (currentFormats, matchedFormats, elm, parents) {\n    return bifilter(currentFormats, function (callbacks, format) {\n      if (!has(matchedFormats, format)) {\n        each(callbacks, function (callback) {\n          callback(false, {\n            node: elm,\n            format: format,\n            parents: parents\n          });\n        });\n        return false;\n      } else {\n        return true;\n      }\n    }).t;\n  };\n\n  var addListeners = function (registeredFormatListeners, formats, callback, similar) {\n    var formatChangeItems = registeredFormatListeners.get();\n    each(formats.split(','), function (format) {\n      if (!formatChangeItems[format]) {\n        formatChangeItems[format] = {\n          similar: similar,\n          callbacks: []\n        };\n      }\n\n      formatChangeItems[format].callbacks.push(callback);\n    });\n    registeredFormatListeners.set(formatChangeItems);\n  };\n\n  var removeListeners = function (registeredFormatListeners, formats, callback) {\n    var formatChangeItems = registeredFormatListeners.get();\n    each(formats.split(','), function (format) {\n      formatChangeItems[format].callbacks = filter(formatChangeItems[format].callbacks, function (c) {\n        return c !== callback;\n      });\n\n      if (formatChangeItems[format].callbacks.length === 0) {\n        delete formatChangeItems[format];\n      }\n    });\n    registeredFormatListeners.set(formatChangeItems);\n  };\n\n  var formatChangedInternal = function (editor, registeredFormatListeners, formats, callback, similar) {\n    if (registeredFormatListeners.get() === null) {\n      setup$4(registeredFormatListeners, editor);\n    }\n\n    addListeners(registeredFormatListeners, formats, callback, similar);\n    return {\n      unbind: function () {\n        return removeListeners(registeredFormatListeners, formats, callback);\n      }\n    };\n  };\n\n  var toggle = function (editor, name, vars, node) {\n    var fmt = editor.formatter.get(name);\n\n    if (match(editor, name, vars, node) && (!('toggle' in fmt[0]) || fmt[0].toggle)) {\n      remove$6(editor, name, vars, node);\n    } else {\n      applyFormat(editor, name, vars, node);\n    }\n  };\n\n  var fromElements = function (elements, scope) {\n    var doc = scope || document;\n    var fragment = doc.createDocumentFragment();\n    each(elements, function (element) {\n      fragment.appendChild(element.dom);\n    });\n    return SugarElement.fromDom(fragment);\n  };\n\n  var tableModel = function (element, width, rows) {\n    return {\n      element: element,\n      width: width,\n      rows: rows\n    };\n  };\n\n  var tableRow = function (element, cells) {\n    return {\n      element: element,\n      cells: cells\n    };\n  };\n\n  var cellPosition = function (x, y) {\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  var getSpan = function (td, key) {\n    var value = parseInt(get$4(td, key), 10);\n    return isNaN(value) ? 1 : value;\n  };\n\n  var fillout = function (table, x, y, tr, td) {\n    var rowspan = getSpan(td, 'rowspan');\n    var colspan = getSpan(td, 'colspan');\n    var rows = table.rows;\n\n    for (var y2 = y; y2 < y + rowspan; y2++) {\n      if (!rows[y2]) {\n        rows[y2] = tableRow(deep(tr), []);\n      }\n\n      for (var x2 = x; x2 < x + colspan; x2++) {\n        var cells = rows[y2].cells;\n        cells[x2] = y2 === y && x2 === x ? td : shallow(td);\n      }\n    }\n  };\n\n  var cellExists = function (table, x, y) {\n    var rows = table.rows;\n    var cells = rows[y] ? rows[y].cells : [];\n    return !!cells[x];\n  };\n\n  var skipCellsX = function (table, x, y) {\n    while (cellExists(table, x, y)) {\n      x++;\n    }\n\n    return x;\n  };\n\n  var getWidth = function (rows) {\n    return foldl(rows, function (acc, row) {\n      return row.cells.length > acc ? row.cells.length : acc;\n    }, 0);\n  };\n\n  var findElementPos = function (table, element) {\n    var rows = table.rows;\n\n    for (var y = 0; y < rows.length; y++) {\n      var cells = rows[y].cells;\n\n      for (var x = 0; x < cells.length; x++) {\n        if (eq$2(cells[x], element)) {\n          return Optional.some(cellPosition(x, y));\n        }\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var extractRows = function (table, sx, sy, ex, ey) {\n    var newRows = [];\n    var rows = table.rows;\n\n    for (var y = sy; y <= ey; y++) {\n      var cells = rows[y].cells;\n      var slice = sx < ex ? cells.slice(sx, ex + 1) : cells.slice(ex, sx + 1);\n      newRows.push(tableRow(rows[y].element, slice));\n    }\n\n    return newRows;\n  };\n\n  var subTable = function (table, startPos, endPos) {\n    var sx = startPos.x,\n        sy = startPos.y;\n    var ex = endPos.x,\n        ey = endPos.y;\n    var newRows = sy < ey ? extractRows(table, sx, sy, ex, ey) : extractRows(table, sx, ey, ex, sy);\n    return tableModel(table.element, getWidth(newRows), newRows);\n  };\n\n  var createDomTable = function (table, rows) {\n    var tableElement = shallow(table.element);\n    var tableBody = SugarElement.fromTag('tbody');\n    append$1(tableBody, rows);\n    append(tableElement, tableBody);\n    return tableElement;\n  };\n\n  var modelRowsToDomRows = function (table) {\n    return map(table.rows, function (row) {\n      var cells = map(row.cells, function (cell) {\n        var td = deep(cell);\n        remove$1(td, 'colspan');\n        remove$1(td, 'rowspan');\n        return td;\n      });\n      var tr = shallow(row.element);\n      append$1(tr, cells);\n      return tr;\n    });\n  };\n\n  var fromDom$1 = function (tableElm) {\n    var table = tableModel(shallow(tableElm), 0, []);\n    each(descendants$1(tableElm, 'tr'), function (tr, y) {\n      each(descendants$1(tr, 'td,th'), function (td, x) {\n        fillout(table, skipCellsX(table, x, y), y, tr, td);\n      });\n    });\n    return tableModel(table.element, getWidth(table.rows), table.rows);\n  };\n\n  var toDom = function (table) {\n    return createDomTable(table, modelRowsToDomRows(table));\n  };\n\n  var subsection = function (table, startElement, endElement) {\n    return findElementPos(table, startElement).bind(function (startPos) {\n      return findElementPos(table, endElement).map(function (endPos) {\n        return subTable(table, startPos, endPos);\n      });\n    });\n  };\n\n  var findParentListContainer = function (parents) {\n    return find(parents, function (elm) {\n      return name(elm) === 'ul' || name(elm) === 'ol';\n    });\n  };\n\n  var getFullySelectedListWrappers = function (parents, rng) {\n    return find(parents, function (elm) {\n      return name(elm) === 'li' && hasAllContentsSelected(elm, rng);\n    }).fold(constant([]), function (_li) {\n      return findParentListContainer(parents).map(function (listCont) {\n        var listElm = SugarElement.fromTag(name(listCont));\n        var listStyles = filter$1(getAllRaw(listCont), function (_style, name) {\n          return startsWith(name, 'list-style');\n        });\n        setAll$1(listElm, listStyles);\n        return [SugarElement.fromTag('li'), listElm];\n      }).getOr([]);\n    });\n  };\n\n  var wrap$3 = function (innerElm, elms) {\n    var wrapped = foldl(elms, function (acc, elm) {\n      append(elm, acc);\n      return elm;\n    }, innerElm);\n    return elms.length > 0 ? fromElements([wrapped]) : wrapped;\n  };\n\n  var directListWrappers = function (commonAnchorContainer) {\n    if (isListItem(commonAnchorContainer)) {\n      return parent(commonAnchorContainer).filter(isList).fold(constant([]), function (listElm) {\n        return [commonAnchorContainer, listElm];\n      });\n    } else {\n      return isList(commonAnchorContainer) ? [commonAnchorContainer] : [];\n    }\n  };\n\n  var getWrapElements = function (rootNode, rng) {\n    var commonAnchorContainer = SugarElement.fromDom(rng.commonAncestorContainer);\n    var parents = parentsAndSelf(commonAnchorContainer, rootNode);\n    var wrapElements = filter(parents, function (elm) {\n      return isInline(elm) || isHeading(elm);\n    });\n    var listWrappers = getFullySelectedListWrappers(parents, rng);\n    var allWrappers = wrapElements.concat(listWrappers.length ? listWrappers : directListWrappers(commonAnchorContainer));\n    return map(allWrappers, shallow);\n  };\n\n  var emptyFragment = function () {\n    return fromElements([]);\n  };\n\n  var getFragmentFromRange = function (rootNode, rng) {\n    return wrap$3(SugarElement.fromDom(rng.cloneContents()), getWrapElements(rootNode, rng));\n  };\n\n  var getParentTable = function (rootElm, cell) {\n    return ancestor$1(cell, 'table', curry(eq$2, rootElm));\n  };\n\n  var getTableFragment = function (rootNode, selectedTableCells) {\n    return getParentTable(rootNode, selectedTableCells[0]).bind(function (tableElm) {\n      var firstCell = selectedTableCells[0];\n      var lastCell = selectedTableCells[selectedTableCells.length - 1];\n      var fullTableModel = fromDom$1(tableElm);\n      return subsection(fullTableModel, firstCell, lastCell).map(function (sectionedTableModel) {\n        return fromElements([toDom(sectionedTableModel)]);\n      });\n    }).getOrThunk(emptyFragment);\n  };\n\n  var getSelectionFragment = function (rootNode, ranges) {\n    return ranges.length > 0 && ranges[0].collapsed ? emptyFragment() : getFragmentFromRange(rootNode, ranges[0]);\n  };\n\n  var read$1 = function (rootNode, ranges) {\n    var selectedCells = getCellsFromElementOrRanges(ranges, rootNode);\n    return selectedCells.length > 0 ? getTableFragment(rootNode, selectedCells) : getSelectionFragment(rootNode, ranges);\n  };\n\n  var trimLeadingCollapsibleText = function (text) {\n    return text.replace(/^[ \\f\\n\\r\\t\\v]+/, '');\n  };\n\n  var isCollapsibleWhitespace = function (text, index) {\n    return index >= 0 && index < text.length && isWhiteSpace$1(text.charAt(index));\n  };\n\n  var getInnerText = function (bin, shouldTrim) {\n    var text = trim$2(bin.innerText);\n    return shouldTrim ? trimLeadingCollapsibleText(text) : text;\n  };\n\n  var getContextNodeName = function (parentBlockOpt) {\n    return parentBlockOpt.map(function (block) {\n      return block.nodeName;\n    }).getOr('div').toLowerCase();\n  };\n\n  var getTextContent = function (editor) {\n    return Optional.from(editor.selection.getRng()).map(function (rng) {\n      var parentBlockOpt = Optional.from(editor.dom.getParent(rng.commonAncestorContainer, editor.dom.isBlock));\n      var body = editor.getBody();\n      var contextNodeName = getContextNodeName(parentBlockOpt);\n      var shouldTrimSpaces = Env.browser.isIE() && contextNodeName !== 'pre';\n      var bin = editor.dom.add(body, contextNodeName, {\n        'data-mce-bogus': 'all',\n        'style': 'overflow: hidden; opacity: 0;'\n      }, rng.cloneContents());\n      var text = getInnerText(bin, shouldTrimSpaces);\n      var nonRenderedText = trim$2(bin.textContent);\n      editor.dom.remove(bin);\n\n      if (isCollapsibleWhitespace(nonRenderedText, 0) || isCollapsibleWhitespace(nonRenderedText, nonRenderedText.length - 1)) {\n        var parentBlock = parentBlockOpt.getOr(body);\n        var parentBlockText = getInnerText(parentBlock, shouldTrimSpaces);\n        var textIndex = parentBlockText.indexOf(text);\n\n        if (textIndex === -1) {\n          return text;\n        } else {\n          var hasProceedingSpace = isCollapsibleWhitespace(parentBlockText, textIndex - 1);\n          var hasTrailingSpace = isCollapsibleWhitespace(parentBlockText, textIndex + text.length);\n          return (hasProceedingSpace ? ' ' : '') + text + (hasTrailingSpace ? ' ' : '');\n        }\n      } else {\n        return text;\n      }\n    }).getOr('');\n  };\n\n  var getSerializedContent = function (editor, args) {\n    var rng = editor.selection.getRng(),\n        tmpElm = editor.dom.create('body');\n    var sel = editor.selection.getSel();\n    var ranges = processRanges(editor, getRanges(sel));\n    var fragment = args.contextual ? read$1(SugarElement.fromDom(editor.getBody()), ranges).dom : rng.cloneContents();\n\n    if (fragment) {\n      tmpElm.appendChild(fragment);\n    }\n\n    return editor.selection.serializer.serialize(tmpElm, args);\n  };\n\n  var getSelectedContentInternal = function (editor, format, args) {\n    if (args === void 0) {\n      args = {};\n    }\n\n    args.get = true;\n    args.format = format;\n    args.selection = true;\n    args = editor.fire('BeforeGetContent', args);\n\n    if (args.isDefaultPrevented()) {\n      editor.fire('GetContent', args);\n      return args.content;\n    }\n\n    if (args.format === 'text') {\n      return getTextContent(editor);\n    } else {\n      args.getInner = true;\n      var content = getSerializedContent(editor, args);\n\n      if (args.format === 'tree') {\n        return content;\n      } else {\n        args.content = editor.selection.isCollapsed() ? '' : content;\n        editor.fire('GetContent', args);\n        return args.content;\n      }\n    }\n  };\n\n  var KEEP = 0,\n      INSERT = 1,\n      DELETE = 2;\n\n  var diff = function (left, right) {\n    var size = left.length + right.length + 2;\n    var vDown = new Array(size);\n    var vUp = new Array(size);\n\n    var snake = function (start, end, diag) {\n      return {\n        start: start,\n        end: end,\n        diag: diag\n      };\n    };\n\n    var buildScript = function (start1, end1, start2, end2, script) {\n      var middle = getMiddleSnake(start1, end1, start2, end2);\n\n      if (middle === null || middle.start === end1 && middle.diag === end1 - end2 || middle.end === start1 && middle.diag === start1 - start2) {\n        var i = start1;\n        var j = start2;\n\n        while (i < end1 || j < end2) {\n          if (i < end1 && j < end2 && left[i] === right[j]) {\n            script.push([KEEP, left[i]]);\n            ++i;\n            ++j;\n          } else {\n            if (end1 - start1 > end2 - start2) {\n              script.push([DELETE, left[i]]);\n              ++i;\n            } else {\n              script.push([INSERT, right[j]]);\n              ++j;\n            }\n          }\n        }\n      } else {\n        buildScript(start1, middle.start, start2, middle.start - middle.diag, script);\n\n        for (var i2 = middle.start; i2 < middle.end; ++i2) {\n          script.push([KEEP, left[i2]]);\n        }\n\n        buildScript(middle.end, end1, middle.end - middle.diag, end2, script);\n      }\n    };\n\n    var buildSnake = function (start, diag, end1, end2) {\n      var end = start;\n\n      while (end - diag < end2 && end < end1 && left[end] === right[end - diag]) {\n        ++end;\n      }\n\n      return snake(start, end, diag);\n    };\n\n    var getMiddleSnake = function (start1, end1, start2, end2) {\n      var m = end1 - start1;\n      var n = end2 - start2;\n\n      if (m === 0 || n === 0) {\n        return null;\n      }\n\n      var delta = m - n;\n      var sum = n + m;\n      var offset = (sum % 2 === 0 ? sum : sum + 1) / 2;\n      vDown[1 + offset] = start1;\n      vUp[1 + offset] = end1 + 1;\n      var d, k, i, x, y;\n\n      for (d = 0; d <= offset; ++d) {\n        for (k = -d; k <= d; k += 2) {\n          i = k + offset;\n\n          if (k === -d || k !== d && vDown[i - 1] < vDown[i + 1]) {\n            vDown[i] = vDown[i + 1];\n          } else {\n            vDown[i] = vDown[i - 1] + 1;\n          }\n\n          x = vDown[i];\n          y = x - start1 + start2 - k;\n\n          while (x < end1 && y < end2 && left[x] === right[y]) {\n            vDown[i] = ++x;\n            ++y;\n          }\n\n          if (delta % 2 !== 0 && delta - d <= k && k <= delta + d) {\n            if (vUp[i - delta] <= vDown[i]) {\n              return buildSnake(vUp[i - delta], k + start1 - start2, end1, end2);\n            }\n          }\n        }\n\n        for (k = delta - d; k <= delta + d; k += 2) {\n          i = k + offset - delta;\n\n          if (k === delta - d || k !== delta + d && vUp[i + 1] <= vUp[i - 1]) {\n            vUp[i] = vUp[i + 1] - 1;\n          } else {\n            vUp[i] = vUp[i - 1];\n          }\n\n          x = vUp[i] - 1;\n          y = x - start1 + start2 - k;\n\n          while (x >= start1 && y >= start2 && left[x] === right[y]) {\n            vUp[i] = x--;\n            y--;\n          }\n\n          if (delta % 2 === 0 && -d <= k && k <= d) {\n            if (vUp[i] <= vDown[i + delta]) {\n              return buildSnake(vUp[i], k + start1 - start2, end1, end2);\n            }\n          }\n        }\n      }\n    };\n\n    var script = [];\n    buildScript(0, left.length, 0, right.length, script);\n    return script;\n  };\n\n  var getOuterHtml = function (elm) {\n    if (isElement$1(elm)) {\n      return elm.outerHTML;\n    } else if (isText$1(elm)) {\n      return Entities.encodeRaw(elm.data, false);\n    } else if (isComment$1(elm)) {\n      return '<!--' + elm.data + '-->';\n    }\n\n    return '';\n  };\n\n  var createFragment$1 = function (html) {\n    var node;\n    var container = document.createElement('div');\n    var frag = document.createDocumentFragment();\n\n    if (html) {\n      container.innerHTML = html;\n    }\n\n    while (node = container.firstChild) {\n      frag.appendChild(node);\n    }\n\n    return frag;\n  };\n\n  var insertAt = function (elm, html, index) {\n    var fragment = createFragment$1(html);\n\n    if (elm.hasChildNodes() && index < elm.childNodes.length) {\n      var target = elm.childNodes[index];\n      target.parentNode.insertBefore(fragment, target);\n    } else {\n      elm.appendChild(fragment);\n    }\n  };\n\n  var removeAt = function (elm, index) {\n    if (elm.hasChildNodes() && index < elm.childNodes.length) {\n      var target = elm.childNodes[index];\n      target.parentNode.removeChild(target);\n    }\n  };\n\n  var applyDiff = function (diff, elm) {\n    var index = 0;\n    each(diff, function (action) {\n      if (action[0] === KEEP) {\n        index++;\n      } else if (action[0] === INSERT) {\n        insertAt(elm, action[1], index);\n        index++;\n      } else if (action[0] === DELETE) {\n        removeAt(elm, index);\n      }\n    });\n  };\n\n  var read$2 = function (elm) {\n    return filter(map(from$1(elm.childNodes), getOuterHtml), function (item) {\n      return item.length > 0;\n    });\n  };\n\n  var write = function (fragments, elm) {\n    var currentFragments = map(from$1(elm.childNodes), getOuterHtml);\n    applyDiff(diff(currentFragments, fragments), elm);\n    return elm;\n  };\n\n  var undoLevelDocument = Cell(Optional.none());\n\n  var lazyTempDocument = function () {\n    return undoLevelDocument.get().getOrThunk(function () {\n      var doc = document.implementation.createHTMLDocument('undo');\n      undoLevelDocument.set(Optional.some(doc));\n      return doc;\n    });\n  };\n\n  var hasIframes = function (html) {\n    return html.indexOf('</iframe>') !== -1;\n  };\n\n  var createFragmentedLevel = function (fragments) {\n    return {\n      type: 'fragmented',\n      fragments: fragments,\n      content: '',\n      bookmark: null,\n      beforeBookmark: null\n    };\n  };\n\n  var createCompleteLevel = function (content) {\n    return {\n      type: 'complete',\n      fragments: null,\n      content: content,\n      bookmark: null,\n      beforeBookmark: null\n    };\n  };\n\n  var createFromEditor = function (editor) {\n    var fragments = read$2(editor.getBody());\n    var trimmedFragments = bind(fragments, function (html) {\n      var trimmed = trimInternal(editor.serializer, html);\n      return trimmed.length > 0 ? [trimmed] : [];\n    });\n    var content = trimmedFragments.join('');\n    return hasIframes(content) ? createFragmentedLevel(trimmedFragments) : createCompleteLevel(content);\n  };\n\n  var applyToEditor = function (editor, level, before) {\n    if (level.type === 'fragmented') {\n      write(level.fragments, editor.getBody());\n    } else {\n      editor.setContent(level.content, {\n        format: 'raw'\n      });\n    }\n\n    editor.selection.moveToBookmark(before ? level.beforeBookmark : level.bookmark);\n  };\n\n  var getLevelContent = function (level) {\n    return level.type === 'fragmented' ? level.fragments.join('') : level.content;\n  };\n\n  var getCleanLevelContent = function (level) {\n    var elm = SugarElement.fromTag('body', lazyTempDocument());\n    set$1(elm, getLevelContent(level));\n    each(descendants$1(elm, '*[data-mce-bogus]'), unwrap);\n    return get$7(elm);\n  };\n\n  var hasEqualContent = function (level1, level2) {\n    return getLevelContent(level1) === getLevelContent(level2);\n  };\n\n  var hasEqualCleanedContent = function (level1, level2) {\n    return getCleanLevelContent(level1) === getCleanLevelContent(level2);\n  };\n\n  var isEq$4 = function (level1, level2) {\n    if (!level1 || !level2) {\n      return false;\n    } else if (hasEqualContent(level1, level2)) {\n      return true;\n    } else {\n      return hasEqualCleanedContent(level1, level2);\n    }\n  };\n\n  var isUnlocked = function (locks) {\n    return locks.get() === 0;\n  };\n\n  var setTyping = function (undoManager, typing, locks) {\n    if (isUnlocked(locks)) {\n      undoManager.typing = typing;\n    }\n  };\n\n  var endTyping = function (undoManager, locks) {\n    if (undoManager.typing) {\n      setTyping(undoManager, false, locks);\n      undoManager.add();\n    }\n  };\n\n  var endTypingLevelIgnoreLocks = function (undoManager) {\n    if (undoManager.typing) {\n      undoManager.typing = false;\n      undoManager.add();\n    }\n  };\n\n  var beforeChange = function (editor, locks, beforeBookmark) {\n    if (isUnlocked(locks)) {\n      beforeBookmark.set(Optional.some(getUndoBookmark(editor.selection)));\n    }\n  };\n\n  var addUndoLevel = function (editor, undoManager, index, locks, beforeBookmark, level, event) {\n    var currentLevel = createFromEditor(editor);\n    level = level || {};\n    level = Tools.extend(level, currentLevel);\n\n    if (isUnlocked(locks) === false || editor.removed) {\n      return null;\n    }\n\n    var lastLevel = undoManager.data[index.get()];\n\n    if (editor.fire('BeforeAddUndo', {\n      level: level,\n      lastLevel: lastLevel,\n      originalEvent: event\n    }).isDefaultPrevented()) {\n      return null;\n    }\n\n    if (lastLevel && isEq$4(lastLevel, level)) {\n      return null;\n    }\n\n    if (undoManager.data[index.get()]) {\n      beforeBookmark.get().each(function (bm) {\n        undoManager.data[index.get()].beforeBookmark = bm;\n      });\n    }\n\n    var customUndoRedoLevels = getCustomUndoRedoLevels(editor);\n\n    if (customUndoRedoLevels) {\n      if (undoManager.data.length > customUndoRedoLevels) {\n        for (var i = 0; i < undoManager.data.length - 1; i++) {\n          undoManager.data[i] = undoManager.data[i + 1];\n        }\n\n        undoManager.data.length--;\n        index.set(undoManager.data.length);\n      }\n    }\n\n    level.bookmark = getUndoBookmark(editor.selection);\n\n    if (index.get() < undoManager.data.length - 1) {\n      undoManager.data.length = index.get() + 1;\n    }\n\n    undoManager.data.push(level);\n    index.set(undoManager.data.length - 1);\n    var args = {\n      level: level,\n      lastLevel: lastLevel,\n      originalEvent: event\n    };\n\n    if (index.get() > 0) {\n      editor.setDirty(true);\n      editor.fire('AddUndo', args);\n      editor.fire('change', args);\n    } else {\n      editor.fire('AddUndo', args);\n    }\n\n    return level;\n  };\n\n  var clear = function (editor, undoManager, index) {\n    undoManager.data = [];\n    index.set(0);\n    undoManager.typing = false;\n    editor.fire('ClearUndos');\n  };\n\n  var extra = function (editor, undoManager, index, callback1, callback2) {\n    if (undoManager.transact(callback1)) {\n      var bookmark = undoManager.data[index.get()].bookmark;\n      var lastLevel = undoManager.data[index.get() - 1];\n      applyToEditor(editor, lastLevel, true);\n\n      if (undoManager.transact(callback2)) {\n        undoManager.data[index.get() - 1].beforeBookmark = bookmark;\n      }\n    }\n  };\n\n  var redo = function (editor, index, data) {\n    var level;\n\n    if (index.get() < data.length - 1) {\n      index.set(index.get() + 1);\n      level = data[index.get()];\n      applyToEditor(editor, level, false);\n      editor.setDirty(true);\n      editor.fire('Redo', {\n        level: level\n      });\n    }\n\n    return level;\n  };\n\n  var undo = function (editor, undoManager, locks, index) {\n    var level;\n\n    if (undoManager.typing) {\n      undoManager.add();\n      undoManager.typing = false;\n      setTyping(undoManager, false, locks);\n    }\n\n    if (index.get() > 0) {\n      index.set(index.get() - 1);\n      level = undoManager.data[index.get()];\n      applyToEditor(editor, level, true);\n      editor.setDirty(true);\n      editor.fire('Undo', {\n        level: level\n      });\n    }\n\n    return level;\n  };\n\n  var reset = function (undoManager) {\n    undoManager.clear();\n    undoManager.add();\n  };\n\n  var hasUndo = function (editor, undoManager, index) {\n    return index.get() > 0 || undoManager.typing && undoManager.data[0] && !isEq$4(createFromEditor(editor), undoManager.data[0]);\n  };\n\n  var hasRedo = function (undoManager, index) {\n    return index.get() < undoManager.data.length - 1 && !undoManager.typing;\n  };\n\n  var transact = function (undoManager, locks, callback) {\n    endTyping(undoManager, locks);\n    undoManager.beforeChange();\n    undoManager.ignore(callback);\n    return undoManager.add();\n  };\n\n  var ignore = function (locks, callback) {\n    try {\n      locks.set(locks.get() + 1);\n      callback();\n    } finally {\n      locks.set(locks.get() - 1);\n    }\n  };\n\n  var isTreeNode$1 = function (content) {\n    return content instanceof AstNode;\n  };\n\n  var runSerializerFiltersOnFragment = function (editor, fragment) {\n    filter$3(editor.serializer.getNodeFilters(), editor.serializer.getAttributeFilters(), fragment);\n  };\n\n  var getInsertContext = function (editor) {\n    return Optional.from(editor.selection.getStart(true)).map(function (elm) {\n      return elm.nodeName.toLowerCase();\n    });\n  };\n\n  var createDummyUndoLevel = function () {\n    return {\n      type: 'complete',\n      fragments: [],\n      content: '',\n      bookmark: null,\n      beforeBookmark: null\n    };\n  };\n\n  var makePlainAdaptor = function (editor) {\n    return {\n      undoManager: {\n        beforeChange: function (locks, beforeBookmark) {\n          return beforeChange(editor, locks, beforeBookmark);\n        },\n        addUndoLevel: function (undoManager, index, locks, beforeBookmark, level, event) {\n          return addUndoLevel(editor, undoManager, index, locks, beforeBookmark, level, event);\n        },\n        undo: function (undoManager, locks, index) {\n          return undo(editor, undoManager, locks, index);\n        },\n        redo: function (index, data) {\n          return redo(editor, index, data);\n        },\n        clear: function (undoManager, index) {\n          return clear(editor, undoManager, index);\n        },\n        reset: function (undoManager) {\n          return reset(undoManager);\n        },\n        hasUndo: function (undoManager, index) {\n          return hasUndo(editor, undoManager, index);\n        },\n        hasRedo: function (undoManager, index) {\n          return hasRedo(undoManager, index);\n        },\n        transact: function (undoManager, locks, callback) {\n          return transact(undoManager, locks, callback);\n        },\n        ignore: function (locks, callback) {\n          return ignore(locks, callback);\n        },\n        extra: function (undoManager, index, callback1, callback2) {\n          return extra(editor, undoManager, index, callback1, callback2);\n        }\n      },\n      formatter: {\n        match: function (name, vars, node) {\n          return match(editor, name, vars, node);\n        },\n        matchAll: function (names, vars) {\n          return matchAll(editor, names, vars);\n        },\n        matchNode: function (node, name, vars, similar) {\n          return matchNode(editor, node, name, vars, similar);\n        },\n        canApply: function (name) {\n          return canApply(editor, name);\n        },\n        closest: function (names) {\n          return closest$3(editor, names);\n        },\n        apply: function (name, vars, node) {\n          return applyFormat(editor, name, vars, node);\n        },\n        remove: function (name, vars, node, similar) {\n          return remove$6(editor, name, vars, node, similar);\n        },\n        toggle: function (name, vars, node) {\n          return toggle(editor, name, vars, node);\n        },\n        formatChanged: function (registeredFormatListeners, formats, callback, similar) {\n          return formatChangedInternal(editor, registeredFormatListeners, formats, callback, similar);\n        }\n      },\n      editor: {\n        getContent: function (args, format) {\n          return getContentInternal(editor, args, format);\n        },\n        setContent: function (content, args) {\n          return setContentInternal(editor, content, args);\n        },\n        insertContent: function (value, details) {\n          return insertHtmlAtCaret(editor, value, details);\n        },\n        addVisual: function (elm) {\n          return addVisualInternal(editor, elm);\n        }\n      },\n      selection: {\n        getContent: function (format, args) {\n          return getSelectedContentInternal(editor, format, args);\n        }\n      },\n      raw: {\n        getModel: function () {\n          return Optional.none();\n        }\n      }\n    };\n  };\n\n  var makeRtcAdaptor = function (tinymceEditor, rtcEditor) {\n    var defaultVars = function (vars) {\n      return isObject(vars) ? vars : {};\n    };\n\n    var unsupported = die('Unimplemented feature for rtc');\n    var ignore = noop;\n    return {\n      undoManager: {\n        beforeChange: ignore,\n        addUndoLevel: unsupported,\n        undo: function () {\n          rtcEditor.undo();\n          return createDummyUndoLevel();\n        },\n        redo: function () {\n          rtcEditor.redo();\n          return createDummyUndoLevel();\n        },\n        clear: unsupported,\n        reset: unsupported,\n        hasUndo: function () {\n          return rtcEditor.hasUndo();\n        },\n        hasRedo: function () {\n          return rtcEditor.hasRedo();\n        },\n        transact: function (_undoManager, _locks, fn) {\n          rtcEditor.transact(fn);\n          return createDummyUndoLevel();\n        },\n        ignore: unsupported,\n        extra: unsupported\n      },\n      formatter: {\n        match: function (name, vars, _node) {\n          return rtcEditor.matchFormat(name, defaultVars(vars));\n        },\n        matchAll: unsupported,\n        matchNode: unsupported,\n        canApply: function (name) {\n          return rtcEditor.canApplyFormat(name);\n        },\n        closest: function (names) {\n          return rtcEditor.closestFormat(names);\n        },\n        apply: function (name, vars, _node) {\n          return rtcEditor.applyFormat(name, defaultVars(vars));\n        },\n        remove: function (name, vars, _node, _similar) {\n          return rtcEditor.removeFormat(name, defaultVars(vars));\n        },\n        toggle: function (name, vars, _node) {\n          return rtcEditor.toggleFormat(name, defaultVars(vars));\n        },\n        formatChanged: function (_rfl, formats, callback, similar) {\n          return rtcEditor.formatChanged(formats, callback, similar);\n        }\n      },\n      editor: {\n        getContent: function (args, format) {\n          if (format === 'html' || format === 'tree') {\n            var fragment = rtcEditor.getContent();\n            var serializer = HtmlSerializer({\n              inner: true\n            });\n            runSerializerFiltersOnFragment(tinymceEditor, fragment);\n            return format === 'tree' ? fragment : serializer.serialize(fragment);\n          } else {\n            return makePlainAdaptor(tinymceEditor).editor.getContent(args, format);\n          }\n        },\n        setContent: function (content, _args) {\n          var fragment = isTreeNode$1(content) ? content : tinymceEditor.parser.parse(content, {\n            isRootContent: true,\n            insert: true\n          });\n          rtcEditor.setContent(fragment);\n          return content;\n        },\n        insertContent: function (value, _details) {\n          var contextArgs = getInsertContext(tinymceEditor).fold(function () {\n            return {};\n          }, function (context) {\n            return {\n              context: context\n            };\n          });\n          var fragment = isTreeNode$1(value) ? value : tinymceEditor.parser.parse(value, __assign(__assign({}, contextArgs), {\n            insert: true\n          }));\n          rtcEditor.insertContent(fragment);\n        },\n        addVisual: function (_elm) {}\n      },\n      selection: {\n        getContent: function (format, args) {\n          if (format === 'html' || format === 'tree') {\n            var fragment = rtcEditor.getSelectedContent();\n            var serializer = HtmlSerializer({});\n            runSerializerFiltersOnFragment(tinymceEditor, fragment);\n            return format === 'tree' ? fragment : serializer.serialize(fragment);\n          } else {\n            return makePlainAdaptor(tinymceEditor).selection.getContent(format, args);\n          }\n        }\n      },\n      raw: {\n        getModel: function () {\n          return Optional.some(rtcEditor.getRawModel());\n        }\n      }\n    };\n  };\n\n  var isRtc = function (editor) {\n    return has(editor.plugins, 'rtc');\n  };\n\n  var setup$5 = function (editor) {\n    var editorCast = editor;\n    return get$1(editor.plugins, 'rtc').fold(function () {\n      editorCast.rtcInstance = makePlainAdaptor(editor);\n      return Optional.none();\n    }, function (rtc) {\n      return Optional.some(rtc.setup().then(function (rtcEditor) {\n        editorCast.rtcInstance = makeRtcAdaptor(editor, rtcEditor);\n        return rtcEditor.isRemote;\n      }));\n    });\n  };\n\n  var getRtcInstanceWithFallback = function (editor) {\n    return editor.rtcInstance ? editor.rtcInstance : makePlainAdaptor(editor);\n  };\n\n  var getRtcInstanceWithError = function (editor) {\n    var rtcInstance = editor.rtcInstance;\n\n    if (!rtcInstance) {\n      throw new Error('Failed to get RTC instance not yet initialized.');\n    } else {\n      return rtcInstance;\n    }\n  };\n\n  var beforeChange$1 = function (editor, locks, beforeBookmark) {\n    getRtcInstanceWithError(editor).undoManager.beforeChange(locks, beforeBookmark);\n  };\n\n  var addUndoLevel$1 = function (editor, undoManager, index, locks, beforeBookmark, level, event) {\n    return getRtcInstanceWithError(editor).undoManager.addUndoLevel(undoManager, index, locks, beforeBookmark, level, event);\n  };\n\n  var undo$1 = function (editor, undoManager, locks, index) {\n    return getRtcInstanceWithError(editor).undoManager.undo(undoManager, locks, index);\n  };\n\n  var redo$1 = function (editor, index, data) {\n    return getRtcInstanceWithError(editor).undoManager.redo(index, data);\n  };\n\n  var clear$1 = function (editor, undoManager, index) {\n    getRtcInstanceWithError(editor).undoManager.clear(undoManager, index);\n  };\n\n  var reset$1 = function (editor, undoManager) {\n    getRtcInstanceWithError(editor).undoManager.reset(undoManager);\n  };\n\n  var hasUndo$1 = function (editor, undoManager, index) {\n    return getRtcInstanceWithError(editor).undoManager.hasUndo(undoManager, index);\n  };\n\n  var hasRedo$1 = function (editor, undoManager, index) {\n    return getRtcInstanceWithError(editor).undoManager.hasRedo(undoManager, index);\n  };\n\n  var transact$1 = function (editor, undoManager, locks, callback) {\n    return getRtcInstanceWithError(editor).undoManager.transact(undoManager, locks, callback);\n  };\n\n  var ignore$1 = function (editor, locks, callback) {\n    getRtcInstanceWithError(editor).undoManager.ignore(locks, callback);\n  };\n\n  var extra$1 = function (editor, undoManager, index, callback1, callback2) {\n    getRtcInstanceWithError(editor).undoManager.extra(undoManager, index, callback1, callback2);\n  };\n\n  var matchFormat = function (editor, name, vars, node) {\n    return getRtcInstanceWithError(editor).formatter.match(name, vars, node);\n  };\n\n  var matchAllFormats = function (editor, names, vars) {\n    return getRtcInstanceWithError(editor).formatter.matchAll(names, vars);\n  };\n\n  var matchNodeFormat = function (editor, node, name, vars, similar) {\n    return getRtcInstanceWithError(editor).formatter.matchNode(node, name, vars, similar);\n  };\n\n  var canApplyFormat = function (editor, name) {\n    return getRtcInstanceWithError(editor).formatter.canApply(name);\n  };\n\n  var closestFormat = function (editor, names) {\n    return getRtcInstanceWithError(editor).formatter.closest(names);\n  };\n\n  var applyFormat$1 = function (editor, name, vars, node) {\n    getRtcInstanceWithError(editor).formatter.apply(name, vars, node);\n  };\n\n  var removeFormat$1 = function (editor, name, vars, node, similar) {\n    getRtcInstanceWithError(editor).formatter.remove(name, vars, node, similar);\n  };\n\n  var toggleFormat = function (editor, name, vars, node) {\n    getRtcInstanceWithError(editor).formatter.toggle(name, vars, node);\n  };\n\n  var formatChanged = function (editor, registeredFormatListeners, formats, callback, similar) {\n    if (similar === void 0) {\n      similar = false;\n    }\n\n    return getRtcInstanceWithError(editor).formatter.formatChanged(registeredFormatListeners, formats, callback, similar);\n  };\n\n  var getContent = function (editor, args, format) {\n    return getRtcInstanceWithFallback(editor).editor.getContent(args, format);\n  };\n\n  var setContent = function (editor, content, args) {\n    return getRtcInstanceWithFallback(editor).editor.setContent(content, args);\n  };\n\n  var insertContent = function (editor, value, details) {\n    return getRtcInstanceWithFallback(editor).editor.insertContent(value, details);\n  };\n\n  var getSelectedContent = function (editor, format, args) {\n    return getRtcInstanceWithError(editor).selection.getContent(format, args);\n  };\n\n  var addVisual = function (editor, elm) {\n    return getRtcInstanceWithError(editor).editor.addVisual(elm);\n  };\n\n  var getContent$1 = function (editor, args) {\n    if (args === void 0) {\n      args = {};\n    }\n\n    var format = args.format ? args.format : 'html';\n    return getSelectedContent(editor, format, args);\n  };\n\n  var removeEmpty = function (text) {\n    if (text.dom.length === 0) {\n      remove(text);\n      return Optional.none();\n    } else {\n      return Optional.some(text);\n    }\n  };\n\n  var walkPastBookmark = function (node, start) {\n    return node.filter(function (elm) {\n      return BookmarkManager$1.isBookmarkNode(elm.dom);\n    }).bind(start ? nextSibling : prevSibling);\n  };\n\n  var merge = function (outer, inner, rng, start) {\n    var outerElm = outer.dom;\n    var innerElm = inner.dom;\n    var oldLength = start ? outerElm.length : innerElm.length;\n\n    if (start) {\n      mergeTextNodes(outerElm, innerElm, false, !start);\n      rng.setStart(innerElm, oldLength);\n    } else {\n      mergeTextNodes(innerElm, outerElm, false, !start);\n      rng.setEnd(innerElm, oldLength);\n    }\n  };\n\n  var normalizeTextIfRequired = function (inner, start) {\n    parent(inner).each(function (root) {\n      var text = inner.dom;\n\n      if (start && needsToBeNbspLeft(root, CaretPosition$1(text, 0))) {\n        normalizeWhitespaceAfter(text, 0);\n      } else if (!start && needsToBeNbspRight(root, CaretPosition$1(text, text.length))) {\n        normalizeWhitespaceBefore(text, text.length);\n      }\n    });\n  };\n\n  var mergeAndNormalizeText = function (outerNode, innerNode, rng, start) {\n    outerNode.bind(function (outer) {\n      var normalizer = start ? normalizeWhitespaceBefore : normalizeWhitespaceAfter;\n      normalizer(outer.dom, start ? outer.dom.length : 0);\n      return innerNode.filter(isText).map(function (inner) {\n        return merge(outer, inner, rng, start);\n      });\n    }).orThunk(function () {\n      var innerTextNode = walkPastBookmark(innerNode, start).or(innerNode).filter(isText);\n      return innerTextNode.map(function (inner) {\n        return normalizeTextIfRequired(inner, start);\n      });\n    });\n  };\n\n  var rngSetContent = function (rng, fragment) {\n    var firstChild = Optional.from(fragment.firstChild).map(SugarElement.fromDom);\n    var lastChild = Optional.from(fragment.lastChild).map(SugarElement.fromDom);\n    rng.deleteContents();\n    rng.insertNode(fragment);\n    var prevText = firstChild.bind(prevSibling).filter(isText).bind(removeEmpty);\n    var nextText = lastChild.bind(nextSibling).filter(isText).bind(removeEmpty);\n    mergeAndNormalizeText(prevText, firstChild, rng, true);\n    mergeAndNormalizeText(nextText, lastChild, rng, false);\n    rng.collapse(false);\n  };\n\n  var setupArgs = function (args, content) {\n    return __assign(__assign({\n      format: 'html'\n    }, args), {\n      set: true,\n      selection: true,\n      content: content\n    });\n  };\n\n  var cleanContent = function (editor, args) {\n    if (args.format !== 'raw') {\n      var rng = editor.selection.getRng();\n      var contextBlock = editor.dom.getParent(rng.commonAncestorContainer, editor.dom.isBlock);\n      var contextArgs = contextBlock ? {\n        context: contextBlock.nodeName.toLowerCase()\n      } : {};\n      var node = editor.parser.parse(args.content, __assign(__assign({\n        isRootContent: true,\n        forced_root_block: false\n      }, contextArgs), args));\n      return HtmlSerializer({\n        validate: editor.validate\n      }, editor.schema).serialize(node);\n    } else {\n      return args.content;\n    }\n  };\n\n  var setContent$1 = function (editor, content, args) {\n    if (args === void 0) {\n      args = {};\n    }\n\n    var contentArgs = setupArgs(args, content);\n\n    if (!contentArgs.no_events) {\n      contentArgs = editor.fire('BeforeSetContent', contentArgs);\n\n      if (contentArgs.isDefaultPrevented()) {\n        editor.fire('SetContent', contentArgs);\n        return;\n      }\n    }\n\n    args.content = cleanContent(editor, contentArgs);\n    var rng = editor.selection.getRng();\n    rngSetContent(rng, rng.createContextualFragment(args.content));\n    editor.selection.setRng(rng);\n    scrollRangeIntoView(editor, rng);\n\n    if (!contentArgs.no_events) {\n      editor.fire('SetContent', contentArgs);\n    }\n  };\n\n  var deleteFromCallbackMap = function (callbackMap, selector, callback) {\n    if (callbackMap && callbackMap.hasOwnProperty(selector)) {\n      var newCallbacks = filter(callbackMap[selector], function (cb) {\n        return cb !== callback;\n      });\n\n      if (newCallbacks.length === 0) {\n        delete callbackMap[selector];\n      } else {\n        callbackMap[selector] = newCallbacks;\n      }\n    }\n  };\n\n  function SelectorChanged(dom, editor) {\n    var selectorChangedData;\n    var currentSelectors;\n    return {\n      selectorChangedWithUnbind: function (selector, callback) {\n        if (!selectorChangedData) {\n          selectorChangedData = {};\n          currentSelectors = {};\n          editor.on('NodeChange', function (e) {\n            var node = e.element,\n                parents = dom.getParents(node, null, dom.getRoot()),\n                matchedSelectors = {};\n            Tools.each(selectorChangedData, function (callbacks, selector) {\n              Tools.each(parents, function (node) {\n                if (dom.is(node, selector)) {\n                  if (!currentSelectors[selector]) {\n                    Tools.each(callbacks, function (callback) {\n                      callback(true, {\n                        node: node,\n                        selector: selector,\n                        parents: parents\n                      });\n                    });\n                    currentSelectors[selector] = callbacks;\n                  }\n\n                  matchedSelectors[selector] = callbacks;\n                  return false;\n                }\n              });\n            });\n            Tools.each(currentSelectors, function (callbacks, selector) {\n              if (!matchedSelectors[selector]) {\n                delete currentSelectors[selector];\n                Tools.each(callbacks, function (callback) {\n                  callback(false, {\n                    node: node,\n                    selector: selector,\n                    parents: parents\n                  });\n                });\n              }\n            });\n          });\n        }\n\n        if (!selectorChangedData[selector]) {\n          selectorChangedData[selector] = [];\n        }\n\n        selectorChangedData[selector].push(callback);\n        return {\n          unbind: function () {\n            deleteFromCallbackMap(selectorChangedData, selector, callback);\n            deleteFromCallbackMap(currentSelectors, selector, callback);\n          }\n        };\n      }\n    };\n  }\n\n  var isNativeIeSelection = function (rng) {\n    return !!rng.select;\n  };\n\n  var isAttachedToDom = function (node) {\n    return !!(node && node.ownerDocument) && contains$2(SugarElement.fromDom(node.ownerDocument), SugarElement.fromDom(node));\n  };\n\n  var isValidRange = function (rng) {\n    if (!rng) {\n      return false;\n    } else if (isNativeIeSelection(rng)) {\n      return true;\n    } else {\n      return isAttachedToDom(rng.startContainer) && isAttachedToDom(rng.endContainer);\n    }\n  };\n\n  var EditorSelection = function (dom, win, serializer, editor) {\n    var selectedRange;\n    var explicitRange;\n    var selectorChangedWithUnbind = SelectorChanged(dom, editor).selectorChangedWithUnbind;\n\n    var setCursorLocation = function (node, offset) {\n      var rng = dom.createRng();\n\n      if (!node) {\n        moveEndPoint$1(dom, rng, editor.getBody(), true);\n        setRng(rng);\n      } else {\n        rng.setStart(node, offset);\n        rng.setEnd(node, offset);\n        setRng(rng);\n        collapse(false);\n      }\n    };\n\n    var getContent = function (args) {\n      return getContent$1(editor, args);\n    };\n\n    var setContent = function (content, args) {\n      return setContent$1(editor, content, args);\n    };\n\n    var getStart = function (real) {\n      return getStart$2(editor.getBody(), getRng$1(), real);\n    };\n\n    var getEnd$1 = function (real) {\n      return getEnd(editor.getBody(), getRng$1(), real);\n    };\n\n    var getBookmark = function (type, normalized) {\n      return bookmarkManager.getBookmark(type, normalized);\n    };\n\n    var moveToBookmark = function (bookmark) {\n      return bookmarkManager.moveToBookmark(bookmark);\n    };\n\n    var select = function (node, content) {\n      select$1(dom, node, content).each(setRng);\n      return node;\n    };\n\n    var isCollapsed = function () {\n      var rng = getRng$1(),\n          sel = getSel();\n\n      if (!rng || rng.item) {\n        return false;\n      }\n\n      if (rng.compareEndPoints) {\n        return rng.compareEndPoints('StartToEnd', rng) === 0;\n      }\n\n      return !sel || rng.collapsed;\n    };\n\n    var collapse = function (toStart) {\n      var rng = getRng$1();\n      rng.collapse(!!toStart);\n      setRng(rng);\n    };\n\n    var getSel = function () {\n      return win.getSelection ? win.getSelection() : win.document.selection;\n    };\n\n    var getRng$1 = function () {\n      var selection, rng, elm;\n\n      var tryCompareBoundaryPoints = function (how, sourceRange, destinationRange) {\n        try {\n          return sourceRange.compareBoundaryPoints(how, destinationRange);\n        } catch (ex) {\n          return -1;\n        }\n      };\n\n      if (!win) {\n        return null;\n      }\n\n      var doc = win.document;\n\n      if (typeof doc === 'undefined' || doc === null) {\n        return null;\n      }\n\n      if (editor.bookmark !== undefined && hasFocus$1(editor) === false) {\n        var bookmark = getRng(editor);\n\n        if (bookmark.isSome()) {\n          return bookmark.map(function (r) {\n            return processRanges(editor, [r])[0];\n          }).getOr(doc.createRange());\n        }\n      }\n\n      try {\n        if ((selection = getSel()) && !isRestrictedNode(selection.anchorNode)) {\n          if (selection.rangeCount > 0) {\n            rng = selection.getRangeAt(0);\n          } else {\n            rng = selection.createRange ? selection.createRange() : doc.createRange();\n          }\n\n          rng = processRanges(editor, [rng])[0];\n        }\n      } catch (ex) {}\n\n      if (!rng) {\n        rng = doc.createRange ? doc.createRange() : doc.body.createTextRange();\n      }\n\n      if (rng.setStart && rng.startContainer.nodeType === 9 && rng.collapsed) {\n        elm = dom.getRoot();\n        rng.setStart(elm, 0);\n        rng.setEnd(elm, 0);\n      }\n\n      if (selectedRange && explicitRange) {\n        if (tryCompareBoundaryPoints(rng.START_TO_START, rng, selectedRange) === 0 && tryCompareBoundaryPoints(rng.END_TO_END, rng, selectedRange) === 0) {\n          rng = explicitRange;\n        } else {\n          selectedRange = null;\n          explicitRange = null;\n        }\n      }\n\n      return rng;\n    };\n\n    var setRng = function (rng, forward) {\n      var node;\n\n      if (!isValidRange(rng)) {\n        return;\n      }\n\n      var ieRange = isNativeIeSelection(rng) ? rng : null;\n\n      if (ieRange) {\n        explicitRange = null;\n\n        try {\n          ieRange.select();\n        } catch (ex) {}\n\n        return;\n      }\n\n      var sel = getSel();\n      var evt = editor.fire('SetSelectionRange', {\n        range: rng,\n        forward: forward\n      });\n      rng = evt.range;\n\n      if (sel) {\n        explicitRange = rng;\n\n        try {\n          sel.removeAllRanges();\n          sel.addRange(rng);\n        } catch (ex) {}\n\n        if (forward === false && sel.extend) {\n          sel.collapse(rng.endContainer, rng.endOffset);\n          sel.extend(rng.startContainer, rng.startOffset);\n        }\n\n        selectedRange = sel.rangeCount > 0 ? sel.getRangeAt(0) : null;\n      }\n\n      if (!rng.collapsed && rng.startContainer === rng.endContainer && sel.setBaseAndExtent && !Env.ie) {\n        if (rng.endOffset - rng.startOffset < 2) {\n          if (rng.startContainer.hasChildNodes()) {\n            node = rng.startContainer.childNodes[rng.startOffset];\n\n            if (node && node.tagName === 'IMG') {\n              sel.setBaseAndExtent(rng.startContainer, rng.startOffset, rng.endContainer, rng.endOffset);\n\n              if (sel.anchorNode !== rng.startContainer || sel.focusNode !== rng.endContainer) {\n                sel.setBaseAndExtent(node, 0, node, 1);\n              }\n            }\n          }\n        }\n      }\n\n      editor.fire('AfterSetSelectionRange', {\n        range: rng,\n        forward: forward\n      });\n    };\n\n    var setNode = function (elm) {\n      setContent(dom.getOuterHTML(elm));\n      return elm;\n    };\n\n    var getNode = function () {\n      return getNode$1(editor.getBody(), getRng$1());\n    };\n\n    var getSelectedBlocks$1 = function (startElm, endElm) {\n      return getSelectedBlocks(dom, getRng$1(), startElm, endElm);\n    };\n\n    var isForward = function () {\n      var sel = getSel();\n      var anchorNode = sel === null || sel === void 0 ? void 0 : sel.anchorNode;\n      var focusNode = sel === null || sel === void 0 ? void 0 : sel.focusNode;\n\n      if (!sel || !anchorNode || !focusNode || isRestrictedNode(anchorNode) || isRestrictedNode(focusNode)) {\n        return true;\n      }\n\n      var anchorRange = dom.createRng();\n      anchorRange.setStart(anchorNode, sel.anchorOffset);\n      anchorRange.collapse(true);\n      var focusRange = dom.createRng();\n      focusRange.setStart(focusNode, sel.focusOffset);\n      focusRange.collapse(true);\n      return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START, focusRange) <= 0;\n    };\n\n    var normalize$1 = function () {\n      var rng = getRng$1();\n      var sel = getSel();\n\n      if (!hasMultipleRanges(sel) && hasAnyRanges(editor)) {\n        var normRng = normalize(dom, rng);\n        normRng.each(function (normRng) {\n          setRng(normRng, isForward());\n        });\n        return normRng.getOr(rng);\n      }\n\n      return rng;\n    };\n\n    var selectorChanged = function (selector, callback) {\n      selectorChangedWithUnbind(selector, callback);\n      return exports;\n    };\n\n    var getScrollContainer = function () {\n      var scrollContainer;\n      var node = dom.getRoot();\n\n      while (node && node.nodeName !== 'BODY') {\n        if (node.scrollHeight > node.clientHeight) {\n          scrollContainer = node;\n          break;\n        }\n\n        node = node.parentNode;\n      }\n\n      return scrollContainer;\n    };\n\n    var scrollIntoView = function (elm, alignToTop) {\n      return scrollElementIntoView(editor, elm, alignToTop);\n    };\n\n    var placeCaretAt = function (clientX, clientY) {\n      return setRng(fromPoint$1(clientX, clientY, editor.getDoc()));\n    };\n\n    var getBoundingClientRect = function () {\n      var rng = getRng$1();\n      return rng.collapsed ? CaretPosition$1.fromRangeStart(rng).getClientRects()[0] : rng.getBoundingClientRect();\n    };\n\n    var destroy = function () {\n      win = selectedRange = explicitRange = null;\n      controlSelection.destroy();\n    };\n\n    var exports = {\n      bookmarkManager: null,\n      controlSelection: null,\n      dom: dom,\n      win: win,\n      serializer: serializer,\n      editor: editor,\n      collapse: collapse,\n      setCursorLocation: setCursorLocation,\n      getContent: getContent,\n      setContent: setContent,\n      getBookmark: getBookmark,\n      moveToBookmark: moveToBookmark,\n      select: select,\n      isCollapsed: isCollapsed,\n      isForward: isForward,\n      setNode: setNode,\n      getNode: getNode,\n      getSel: getSel,\n      setRng: setRng,\n      getRng: getRng$1,\n      getStart: getStart,\n      getEnd: getEnd$1,\n      getSelectedBlocks: getSelectedBlocks$1,\n      normalize: normalize$1,\n      selectorChanged: selectorChanged,\n      selectorChangedWithUnbind: selectorChangedWithUnbind,\n      getScrollContainer: getScrollContainer,\n      scrollIntoView: scrollIntoView,\n      placeCaretAt: placeCaretAt,\n      getBoundingClientRect: getBoundingClientRect,\n      destroy: destroy\n    };\n    var bookmarkManager = BookmarkManager$1(exports);\n    var controlSelection = ControlSelection(exports, editor);\n    exports.bookmarkManager = bookmarkManager;\n    exports.controlSelection = controlSelection;\n    return exports;\n  };\n\n  var removeAttrs = function (node, names) {\n    each(names, function (name) {\n      node.attr(name, null);\n    });\n  };\n\n  var addFontToSpansFilter = function (domParser, styles, fontSizes) {\n    domParser.addNodeFilter('font', function (nodes) {\n      each(nodes, function (node) {\n        var props = styles.parse(node.attr('style'));\n        var color = node.attr('color');\n        var face = node.attr('face');\n        var size = node.attr('size');\n\n        if (color) {\n          props.color = color;\n        }\n\n        if (face) {\n          props['font-family'] = face;\n        }\n\n        if (size) {\n          props['font-size'] = fontSizes[parseInt(node.attr('size'), 10) - 1];\n        }\n\n        node.name = 'span';\n        node.attr('style', styles.serialize(props));\n        removeAttrs(node, ['color', 'face', 'size']);\n      });\n    });\n  };\n\n  var addStrikeToSpanFilter = function (domParser, styles) {\n    domParser.addNodeFilter('strike', function (nodes) {\n      each(nodes, function (node) {\n        var props = styles.parse(node.attr('style'));\n        props['text-decoration'] = 'line-through';\n        node.name = 'span';\n        node.attr('style', styles.serialize(props));\n      });\n    });\n  };\n\n  var addFilters = function (domParser, settings) {\n    var styles = Styles();\n\n    if (settings.convert_fonts_to_spans) {\n      addFontToSpansFilter(domParser, styles, Tools.explode(settings.font_size_legacy_values));\n    }\n\n    addStrikeToSpanFilter(domParser, styles);\n  };\n\n  var register$1 = function (domParser, settings) {\n    if (settings.inline_styles) {\n      addFilters(domParser, settings);\n    }\n  };\n\n  var blobUriToBlob = function (url) {\n    return new promiseObj(function (resolve, reject) {\n      var rejectWithError = function () {\n        reject('Cannot convert ' + url + ' to Blob. Resource might not exist or is inaccessible.');\n      };\n\n      try {\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', url, true);\n        xhr.responseType = 'blob';\n\n        xhr.onload = function () {\n          if (this.status === 200) {\n            resolve(this.response);\n          } else {\n            rejectWithError();\n          }\n        };\n\n        xhr.onerror = rejectWithError;\n        xhr.send();\n      } catch (ex) {\n        rejectWithError();\n      }\n    });\n  };\n\n  var parseDataUri$1 = function (uri) {\n    var type;\n    var uriParts = decodeURIComponent(uri).split(',');\n    var matches = /data:([^;]+)/.exec(uriParts[0]);\n\n    if (matches) {\n      type = matches[1];\n    }\n\n    return {\n      type: type,\n      data: uriParts[1]\n    };\n  };\n\n  var buildBlob = function (type, data) {\n    var str;\n\n    try {\n      str = atob(data);\n    } catch (e) {\n      return Optional.none();\n    }\n\n    var arr = new Uint8Array(str.length);\n\n    for (var i = 0; i < arr.length; i++) {\n      arr[i] = str.charCodeAt(i);\n    }\n\n    return Optional.some(new Blob([arr], {\n      type: type\n    }));\n  };\n\n  var dataUriToBlob = function (uri) {\n    return new promiseObj(function (resolve) {\n      var _a = parseDataUri$1(uri),\n          type = _a.type,\n          data = _a.data;\n\n      buildBlob(type, data).fold(function () {\n        return resolve(new Blob([]));\n      }, resolve);\n    });\n  };\n\n  var uriToBlob = function (url) {\n    if (url.indexOf('blob:') === 0) {\n      return blobUriToBlob(url);\n    }\n\n    if (url.indexOf('data:') === 0) {\n      return dataUriToBlob(url);\n    }\n\n    return null;\n  };\n\n  var blobToDataUri = function (blob) {\n    return new promiseObj(function (resolve) {\n      var reader = new FileReader();\n\n      reader.onloadend = function () {\n        resolve(reader.result);\n      };\n\n      reader.readAsDataURL(blob);\n    });\n  };\n\n  var count = 0;\n\n  var uniqueId = function (prefix) {\n    return (prefix || 'blobid') + count++;\n  };\n\n  var imageToBlobInfo = function (blobCache, img, resolve, reject) {\n    var base64, blobInfo;\n\n    if (img.src.indexOf('blob:') === 0) {\n      blobInfo = blobCache.getByUri(img.src);\n\n      if (blobInfo) {\n        resolve({\n          image: img,\n          blobInfo: blobInfo\n        });\n      } else {\n        uriToBlob(img.src).then(function (blob) {\n          blobToDataUri(blob).then(function (dataUri) {\n            base64 = parseDataUri$1(dataUri).data;\n            blobInfo = blobCache.create(uniqueId(), blob, base64);\n            blobCache.add(blobInfo);\n            resolve({\n              image: img,\n              blobInfo: blobInfo\n            });\n          });\n        }, function (err) {\n          reject(err);\n        });\n      }\n\n      return;\n    }\n\n    var _a = parseDataUri$1(img.src),\n        data = _a.data,\n        type = _a.type;\n\n    base64 = data;\n    blobInfo = blobCache.getByData(base64, type);\n\n    if (blobInfo) {\n      resolve({\n        image: img,\n        blobInfo: blobInfo\n      });\n    } else {\n      uriToBlob(img.src).then(function (blob) {\n        blobInfo = blobCache.create(uniqueId(), blob, base64);\n        blobCache.add(blobInfo);\n        resolve({\n          image: img,\n          blobInfo: blobInfo\n        });\n      }, function (err) {\n        reject(err);\n      });\n    }\n  };\n\n  var getAllImages = function (elm) {\n    return elm ? from$1(elm.getElementsByTagName('img')) : [];\n  };\n\n  function ImageScanner(uploadStatus, blobCache) {\n    var cachedPromises = {};\n\n    var findAll = function (elm, predicate) {\n      if (!predicate) {\n        predicate = always;\n      }\n\n      var images = filter(getAllImages(elm), function (img) {\n        var src = img.src;\n\n        if (!Env.fileApi) {\n          return false;\n        }\n\n        if (img.hasAttribute('data-mce-bogus')) {\n          return false;\n        }\n\n        if (img.hasAttribute('data-mce-placeholder')) {\n          return false;\n        }\n\n        if (!src || src === Env.transparentSrc) {\n          return false;\n        }\n\n        if (src.indexOf('blob:') === 0) {\n          return !uploadStatus.isUploaded(src) && predicate(img);\n        }\n\n        if (src.indexOf('data:') === 0) {\n          return predicate(img);\n        }\n\n        return false;\n      });\n      var promises = map(images, function (img) {\n        if (cachedPromises[img.src] !== undefined) {\n          return new promiseObj(function (resolve) {\n            cachedPromises[img.src].then(function (imageInfo) {\n              if (typeof imageInfo === 'string') {\n                return imageInfo;\n              }\n\n              resolve({\n                image: img,\n                blobInfo: imageInfo.blobInfo\n              });\n            });\n          });\n        }\n\n        var newPromise = new promiseObj(function (resolve, reject) {\n          imageToBlobInfo(blobCache, img, resolve, reject);\n        }).then(function (result) {\n          delete cachedPromises[result.image.src];\n          return result;\n        }).catch(function (error) {\n          delete cachedPromises[img.src];\n          return error;\n        });\n        cachedPromises[img.src] = newPromise;\n        return newPromise;\n      });\n      return promiseObj.all(promises);\n    };\n\n    return {\n      findAll: findAll\n    };\n  }\n\n  var paddEmptyNode = function (settings, args, blockElements, node) {\n    var brPreferred = settings.padd_empty_with_br || args.insert;\n\n    if (brPreferred && blockElements[node.name]) {\n      node.empty().append(new AstNode('br', 1)).shortEnded = true;\n    } else {\n      node.empty().append(new AstNode('#text', 3)).value = nbsp;\n    }\n  };\n\n  var isPaddedWithNbsp = function (node) {\n    return hasOnlyChild(node, '#text') && node.firstChild.value === nbsp;\n  };\n\n  var hasOnlyChild = function (node, name) {\n    return node && node.firstChild && node.firstChild === node.lastChild && node.firstChild.name === name;\n  };\n\n  var isPadded = function (schema, node) {\n    var rule = schema.getElementRule(node.name);\n    return rule && rule.paddEmpty;\n  };\n\n  var isEmpty$2 = function (schema, nonEmptyElements, whitespaceElements, node) {\n    return node.isEmpty(nonEmptyElements, whitespaceElements, function (node) {\n      return isPadded(schema, node);\n    });\n  };\n\n  var isLineBreakNode = function (node, blockElements) {\n    return node && (blockElements[node.name] || node.name === 'br');\n  };\n\n  var isBogusImage = function (img) {\n    return img.attr('data-mce-bogus');\n  };\n\n  var isInternalImageSource = function (img) {\n    return img.attr('src') === Env.transparentSrc || img.attr('data-mce-placeholder');\n  };\n\n  var isValidDataImg = function (img, settings) {\n    if (settings.images_dataimg_filter) {\n      var imgElem_1 = new Image();\n      imgElem_1.src = img.attr('src');\n      each$1(img.attributes.map, function (value, key) {\n        imgElem_1.setAttribute(key, value);\n      });\n      return settings.images_dataimg_filter(imgElem_1);\n    } else {\n      return true;\n    }\n  };\n\n  var registerBase64ImageFilter = function (parser, settings) {\n    var blobCache = settings.blob_cache;\n\n    var processImage = function (img) {\n      var inputSrc = img.attr('src');\n\n      if (isInternalImageSource(img) || isBogusImage(img)) {\n        return;\n      }\n\n      parseDataUri(inputSrc).filter(function () {\n        return isValidDataImg(img, settings);\n      }).bind(function (_a) {\n        var type = _a.type,\n            data = _a.data;\n        return Optional.from(blobCache.getByData(data, type)).orThunk(function () {\n          return buildBlob(type, data).map(function (blob) {\n            var blobInfo = blobCache.create(uniqueId(), blob, data);\n            blobCache.add(blobInfo);\n            return blobInfo;\n          });\n        });\n      }).each(function (blobInfo) {\n        img.attr('src', blobInfo.blobUri());\n      });\n    };\n\n    if (blobCache) {\n      parser.addAttributeFilter('src', function (nodes) {\n        return each(nodes, processImage);\n      });\n    }\n  };\n\n  var register$2 = function (parser, settings) {\n    var schema = parser.schema;\n\n    if (settings.remove_trailing_brs) {\n      parser.addNodeFilter('br', function (nodes, _, args) {\n        var i;\n        var l = nodes.length;\n        var node;\n        var blockElements = Tools.extend({}, schema.getBlockElements());\n        var nonEmptyElements = schema.getNonEmptyElements();\n        var parent, lastParent, prev, prevName;\n        var whiteSpaceElements = schema.getWhiteSpaceElements();\n        var elementRule, textNode;\n        blockElements.body = 1;\n\n        for (i = 0; i < l; i++) {\n          node = nodes[i];\n          parent = node.parent;\n\n          if (blockElements[node.parent.name] && node === parent.lastChild) {\n            prev = node.prev;\n\n            while (prev) {\n              prevName = prev.name;\n\n              if (prevName !== 'span' || prev.attr('data-mce-type') !== 'bookmark') {\n                if (prevName === 'br') {\n                  node = null;\n                }\n\n                break;\n              }\n\n              prev = prev.prev;\n            }\n\n            if (node) {\n              node.remove();\n\n              if (isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, parent)) {\n                elementRule = schema.getElementRule(parent.name);\n\n                if (elementRule) {\n                  if (elementRule.removeEmpty) {\n                    parent.remove();\n                  } else if (elementRule.paddEmpty) {\n                    paddEmptyNode(settings, args, blockElements, parent);\n                  }\n                }\n              }\n            }\n          } else {\n            lastParent = node;\n\n            while (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {\n              lastParent = parent;\n\n              if (blockElements[parent.name]) {\n                break;\n              }\n\n              parent = parent.parent;\n            }\n\n            if (lastParent === parent && settings.padd_empty_with_br !== true) {\n              textNode = new AstNode('#text', 3);\n              textNode.value = nbsp;\n              node.replace(textNode);\n            }\n          }\n        }\n      });\n    }\n\n    parser.addAttributeFilter('href', function (nodes) {\n      var i = nodes.length;\n\n      var appendRel = function (rel) {\n        var parts = rel.split(' ').filter(function (p) {\n          return p.length > 0;\n        });\n        return parts.concat(['noopener']).sort().join(' ');\n      };\n\n      var addNoOpener = function (rel) {\n        var newRel = rel ? Tools.trim(rel) : '';\n\n        if (!/\\b(noopener)\\b/g.test(newRel)) {\n          return appendRel(newRel);\n        } else {\n          return newRel;\n        }\n      };\n\n      if (!settings.allow_unsafe_link_target) {\n        while (i--) {\n          var node = nodes[i];\n\n          if (node.name === 'a' && node.attr('target') === '_blank') {\n            node.attr('rel', addNoOpener(node.attr('rel')));\n          }\n        }\n      }\n    });\n\n    if (!settings.allow_html_in_named_anchor) {\n      parser.addAttributeFilter('id,name', function (nodes) {\n        var i = nodes.length,\n            sibling,\n            prevSibling,\n            parent,\n            node;\n\n        while (i--) {\n          node = nodes[i];\n\n          if (node.name === 'a' && node.firstChild && !node.attr('href')) {\n            parent = node.parent;\n            sibling = node.lastChild;\n\n            do {\n              prevSibling = sibling.prev;\n              parent.insert(sibling, node);\n              sibling = prevSibling;\n            } while (sibling);\n          }\n        }\n      });\n    }\n\n    if (settings.fix_list_elements) {\n      parser.addNodeFilter('ul,ol', function (nodes) {\n        var i = nodes.length,\n            node,\n            parentNode;\n\n        while (i--) {\n          node = nodes[i];\n          parentNode = node.parent;\n\n          if (parentNode.name === 'ul' || parentNode.name === 'ol') {\n            if (node.prev && node.prev.name === 'li') {\n              node.prev.append(node);\n            } else {\n              var li = new AstNode('li', 1);\n              li.attr('style', 'list-style-type: none');\n              node.wrap(li);\n            }\n          }\n        }\n      });\n    }\n\n    if (settings.validate && schema.getValidClasses()) {\n      parser.addAttributeFilter('class', function (nodes) {\n        var i = nodes.length,\n            node,\n            classList,\n            ci,\n            className,\n            classValue;\n        var validClasses = schema.getValidClasses();\n        var validClassesMap, valid;\n\n        while (i--) {\n          node = nodes[i];\n          classList = node.attr('class').split(' ');\n          classValue = '';\n\n          for (ci = 0; ci < classList.length; ci++) {\n            className = classList[ci];\n            valid = false;\n            validClassesMap = validClasses['*'];\n\n            if (validClassesMap && validClassesMap[className]) {\n              valid = true;\n            }\n\n            validClassesMap = validClasses[node.name];\n\n            if (!valid && validClassesMap && validClassesMap[className]) {\n              valid = true;\n            }\n\n            if (valid) {\n              if (classValue) {\n                classValue += ' ';\n              }\n\n              classValue += className;\n            }\n          }\n\n          if (!classValue.length) {\n            classValue = null;\n          }\n\n          node.attr('class', classValue);\n        }\n      });\n    }\n\n    registerBase64ImageFilter(parser, settings);\n  };\n\n  var makeMap$4 = Tools.makeMap,\n      each$d = Tools.each,\n      explode$2 = Tools.explode,\n      extend$2 = Tools.extend;\n\n  var DomParser = function (settings, schema) {\n    if (schema === void 0) {\n      schema = Schema();\n    }\n\n    var nodeFilters = {};\n    var attributeFilters = [];\n    var matchedNodes = {};\n    var matchedAttributes = {};\n    settings = settings || {};\n    settings.validate = 'validate' in settings ? settings.validate : true;\n    settings.root_name = settings.root_name || 'body';\n\n    var fixInvalidChildren = function (nodes) {\n      var ni, node, parent, parents, newParent, currentNode, tempNode, childNode, i;\n      var sibling, nextNode;\n      var nonSplitableElements = makeMap$4('tr,td,th,tbody,thead,tfoot,table');\n      var nonEmptyElements = schema.getNonEmptyElements();\n      var whitespaceElements = schema.getWhiteSpaceElements();\n      var textBlockElements = schema.getTextBlockElements();\n      var specialElements = schema.getSpecialElements();\n\n      for (ni = 0; ni < nodes.length; ni++) {\n        node = nodes[ni];\n\n        if (!node.parent || node.fixed) {\n          continue;\n        }\n\n        if (textBlockElements[node.name] && node.parent.name === 'li') {\n          sibling = node.next;\n\n          while (sibling) {\n            if (textBlockElements[sibling.name]) {\n              sibling.name = 'li';\n              sibling.fixed = true;\n              node.parent.insert(sibling, node.parent);\n            } else {\n              break;\n            }\n\n            sibling = sibling.next;\n          }\n\n          node.unwrap(node);\n          continue;\n        }\n\n        parents = [node];\n\n        for (parent = node.parent; parent && !schema.isValidChild(parent.name, node.name) && !nonSplitableElements[parent.name]; parent = parent.parent) {\n          parents.push(parent);\n        }\n\n        if (parent && parents.length > 1) {\n          parents.reverse();\n          newParent = currentNode = filterNode(parents[0].clone());\n\n          for (i = 0; i < parents.length - 1; i++) {\n            if (schema.isValidChild(currentNode.name, parents[i].name)) {\n              tempNode = filterNode(parents[i].clone());\n              currentNode.append(tempNode);\n            } else {\n              tempNode = currentNode;\n            }\n\n            for (childNode = parents[i].firstChild; childNode && childNode !== parents[i + 1];) {\n              nextNode = childNode.next;\n              tempNode.append(childNode);\n              childNode = nextNode;\n            }\n\n            currentNode = tempNode;\n          }\n\n          if (!isEmpty$2(schema, nonEmptyElements, whitespaceElements, newParent)) {\n            parent.insert(newParent, parents[0], true);\n            parent.insert(node, newParent);\n          } else {\n            parent.insert(node, parents[0], true);\n          }\n\n          parent = parents[0];\n\n          if (isEmpty$2(schema, nonEmptyElements, whitespaceElements, parent) || hasOnlyChild(parent, 'br')) {\n            parent.empty().remove();\n          }\n        } else if (node.parent) {\n          if (node.name === 'li') {\n            sibling = node.prev;\n\n            if (sibling && (sibling.name === 'ul' || sibling.name === 'ol')) {\n              sibling.append(node);\n              continue;\n            }\n\n            sibling = node.next;\n\n            if (sibling && (sibling.name === 'ul' || sibling.name === 'ol')) {\n              sibling.insert(node, sibling.firstChild, true);\n              continue;\n            }\n\n            node.wrap(filterNode(new AstNode('ul', 1)));\n            continue;\n          }\n\n          if (schema.isValidChild(node.parent.name, 'div') && schema.isValidChild('div', node.name)) {\n            node.wrap(filterNode(new AstNode('div', 1)));\n          } else {\n            if (specialElements[node.name]) {\n              node.empty().remove();\n            } else {\n              node.unwrap();\n            }\n          }\n        }\n      }\n    };\n\n    var filterNode = function (node) {\n      var i, name, list;\n      name = node.name;\n\n      if (name in nodeFilters) {\n        list = matchedNodes[name];\n\n        if (list) {\n          list.push(node);\n        } else {\n          matchedNodes[name] = [node];\n        }\n      }\n\n      i = attributeFilters.length;\n\n      while (i--) {\n        name = attributeFilters[i].name;\n\n        if (name in node.attributes.map) {\n          list = matchedAttributes[name];\n\n          if (list) {\n            list.push(node);\n          } else {\n            matchedAttributes[name] = [node];\n          }\n        }\n      }\n\n      return node;\n    };\n\n    var addNodeFilter = function (name, callback) {\n      each$d(explode$2(name), function (name) {\n        var list = nodeFilters[name];\n\n        if (!list) {\n          nodeFilters[name] = list = [];\n        }\n\n        list.push(callback);\n      });\n    };\n\n    var getNodeFilters = function () {\n      var out = [];\n\n      for (var name_1 in nodeFilters) {\n        if (nodeFilters.hasOwnProperty(name_1)) {\n          out.push({\n            name: name_1,\n            callbacks: nodeFilters[name_1]\n          });\n        }\n      }\n\n      return out;\n    };\n\n    var addAttributeFilter = function (name, callback) {\n      each$d(explode$2(name), function (name) {\n        var i;\n\n        for (i = 0; i < attributeFilters.length; i++) {\n          if (attributeFilters[i].name === name) {\n            attributeFilters[i].callbacks.push(callback);\n            return;\n          }\n        }\n\n        attributeFilters.push({\n          name: name,\n          callbacks: [callback]\n        });\n      });\n    };\n\n    var getAttributeFilters = function () {\n      return [].concat(attributeFilters);\n    };\n\n    var parse = function (html, args) {\n      var nodes, i, l, fi, fl, list, name;\n      var invalidChildren = [];\n      var isInWhiteSpacePreservedElement;\n      var node;\n\n      var getRootBlockName = function (name) {\n        if (name === false) {\n          return '';\n        } else if (name === true) {\n          return 'p';\n        } else {\n          return name;\n        }\n      };\n\n      args = args || {};\n      matchedNodes = {};\n      matchedAttributes = {};\n      var blockElements = extend$2(makeMap$4('script,style,head,html,body,title,meta,param'), schema.getBlockElements());\n      var nonEmptyElements = schema.getNonEmptyElements();\n      var children = schema.children;\n      var validate = settings.validate;\n      var forcedRootBlockName = 'forced_root_block' in args ? args.forced_root_block : settings.forced_root_block;\n      var rootBlockName = getRootBlockName(forcedRootBlockName);\n      var whiteSpaceElements = schema.getWhiteSpaceElements();\n      var startWhiteSpaceRegExp = /^[ \\t\\r\\n]+/;\n      var endWhiteSpaceRegExp = /[ \\t\\r\\n]+$/;\n      var allWhiteSpaceRegExp = /[ \\t\\r\\n]+/g;\n      var isAllWhiteSpaceRegExp = /^[ \\t\\r\\n]+$/;\n      isInWhiteSpacePreservedElement = whiteSpaceElements.hasOwnProperty(args.context) || whiteSpaceElements.hasOwnProperty(settings.root_name);\n\n      var addRootBlocks = function () {\n        var node = rootNode.firstChild,\n            next,\n            rootBlockNode;\n\n        var trim = function (rootBlockNode) {\n          if (rootBlockNode) {\n            node = rootBlockNode.firstChild;\n\n            if (node && node.type === 3) {\n              node.value = node.value.replace(startWhiteSpaceRegExp, '');\n            }\n\n            node = rootBlockNode.lastChild;\n\n            if (node && node.type === 3) {\n              node.value = node.value.replace(endWhiteSpaceRegExp, '');\n            }\n          }\n        };\n\n        if (!schema.isValidChild(rootNode.name, rootBlockName.toLowerCase())) {\n          return;\n        }\n\n        while (node) {\n          next = node.next;\n\n          if (node.type === 3 || node.type === 1 && node.name !== 'p' && !blockElements[node.name] && !node.attr('data-mce-type')) {\n            if (!rootBlockNode) {\n              rootBlockNode = createNode(rootBlockName, 1);\n              rootBlockNode.attr(settings.forced_root_block_attrs);\n              rootNode.insert(rootBlockNode, node);\n              rootBlockNode.append(node);\n            } else {\n              rootBlockNode.append(node);\n            }\n          } else {\n            trim(rootBlockNode);\n            rootBlockNode = null;\n          }\n\n          node = next;\n        }\n\n        trim(rootBlockNode);\n      };\n\n      var createNode = function (name, type) {\n        var node = new AstNode(name, type);\n        var list;\n\n        if (name in nodeFilters) {\n          list = matchedNodes[name];\n\n          if (list) {\n            list.push(node);\n          } else {\n            matchedNodes[name] = [node];\n          }\n        }\n\n        return node;\n      };\n\n      var removeWhitespaceBefore = function (node) {\n        var textNode, textNodeNext, textVal, sibling;\n        var blockElements = schema.getBlockElements();\n\n        for (textNode = node.prev; textNode && textNode.type === 3;) {\n          textVal = textNode.value.replace(endWhiteSpaceRegExp, '');\n\n          if (textVal.length > 0) {\n            textNode.value = textVal;\n            return;\n          }\n\n          textNodeNext = textNode.next;\n\n          if (textNodeNext) {\n            if (textNodeNext.type === 3 && textNodeNext.value.length) {\n              textNode = textNode.prev;\n              continue;\n            }\n\n            if (!blockElements[textNodeNext.name] && textNodeNext.name !== 'script' && textNodeNext.name !== 'style') {\n              textNode = textNode.prev;\n              continue;\n            }\n          }\n\n          sibling = textNode.prev;\n          textNode.remove();\n          textNode = sibling;\n        }\n      };\n\n      var cloneAndExcludeBlocks = function (input) {\n        var name;\n        var output = {};\n\n        for (name in input) {\n          if (name !== 'li' && name !== 'p') {\n            output[name] = input[name];\n          }\n        }\n\n        return output;\n      };\n\n      var parser = SaxParser$1({\n        validate: validate,\n        allow_html_data_urls: settings.allow_html_data_urls,\n        allow_svg_data_urls: settings.allow_svg_data_urls,\n        allow_script_urls: settings.allow_script_urls,\n        allow_conditional_comments: settings.allow_conditional_comments,\n        preserve_cdata: settings.preserve_cdata,\n        self_closing_elements: cloneAndExcludeBlocks(schema.getSelfClosingElements()),\n        cdata: function (text) {\n          node.append(createNode('#cdata', 4)).value = text;\n        },\n        text: function (text, raw) {\n          var textNode;\n\n          if (!isInWhiteSpacePreservedElement) {\n            text = text.replace(allWhiteSpaceRegExp, ' ');\n\n            if (isLineBreakNode(node.lastChild, blockElements)) {\n              text = text.replace(startWhiteSpaceRegExp, '');\n            }\n          }\n\n          if (text.length !== 0) {\n            textNode = createNode('#text', 3);\n            textNode.raw = !!raw;\n            node.append(textNode).value = text;\n          }\n        },\n        comment: function (text) {\n          node.append(createNode('#comment', 8)).value = text;\n        },\n        pi: function (name, text) {\n          node.append(createNode(name, 7)).value = text;\n          removeWhitespaceBefore(node);\n        },\n        doctype: function (text) {\n          var newNode = node.append(createNode('#doctype', 10));\n          newNode.value = text;\n          removeWhitespaceBefore(node);\n        },\n        start: function (name, attrs, empty) {\n          var newNode, attrFiltersLen, attrName, parent;\n          var elementRule = validate ? schema.getElementRule(name) : {};\n\n          if (elementRule) {\n            newNode = createNode(elementRule.outputName || name, 1);\n            newNode.attributes = attrs;\n            newNode.shortEnded = empty;\n            node.append(newNode);\n            parent = children[node.name];\n\n            if (parent && children[newNode.name] && !parent[newNode.name]) {\n              invalidChildren.push(newNode);\n            }\n\n            attrFiltersLen = attributeFilters.length;\n\n            while (attrFiltersLen--) {\n              attrName = attributeFilters[attrFiltersLen].name;\n\n              if (attrName in attrs.map) {\n                list = matchedAttributes[attrName];\n\n                if (list) {\n                  list.push(newNode);\n                } else {\n                  matchedAttributes[attrName] = [newNode];\n                }\n              }\n            }\n\n            if (blockElements[name]) {\n              removeWhitespaceBefore(newNode);\n            }\n\n            if (!empty) {\n              node = newNode;\n            }\n\n            if (!isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n              isInWhiteSpacePreservedElement = true;\n            }\n          }\n        },\n        end: function (name) {\n          var textNode, text, sibling, tempNode;\n          var elementRule = validate ? schema.getElementRule(name) : {};\n\n          if (elementRule) {\n            if (blockElements[name]) {\n              if (!isInWhiteSpacePreservedElement) {\n                textNode = node.firstChild;\n\n                if (textNode && textNode.type === 3) {\n                  text = textNode.value.replace(startWhiteSpaceRegExp, '');\n\n                  if (text.length > 0) {\n                    textNode.value = text;\n                    textNode = textNode.next;\n                  } else {\n                    sibling = textNode.next;\n                    textNode.remove();\n                    textNode = sibling;\n\n                    while (textNode && textNode.type === 3) {\n                      text = textNode.value;\n                      sibling = textNode.next;\n\n                      if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n                        textNode.remove();\n                        textNode = sibling;\n                      }\n\n                      textNode = sibling;\n                    }\n                  }\n                }\n\n                textNode = node.lastChild;\n\n                if (textNode && textNode.type === 3) {\n                  text = textNode.value.replace(endWhiteSpaceRegExp, '');\n\n                  if (text.length > 0) {\n                    textNode.value = text;\n                    textNode = textNode.prev;\n                  } else {\n                    sibling = textNode.prev;\n                    textNode.remove();\n                    textNode = sibling;\n\n                    while (textNode && textNode.type === 3) {\n                      text = textNode.value;\n                      sibling = textNode.prev;\n\n                      if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n                        textNode.remove();\n                        textNode = sibling;\n                      }\n\n                      textNode = sibling;\n                    }\n                  }\n                }\n              }\n            }\n\n            if (isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n              isInWhiteSpacePreservedElement = false;\n            }\n\n            if (elementRule.removeEmpty && isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node)) {\n              tempNode = node.parent;\n\n              if (blockElements[node.name]) {\n                node.empty().remove();\n              } else {\n                node.unwrap();\n              }\n\n              node = tempNode;\n              return;\n            }\n\n            if (elementRule.paddEmpty && (isPaddedWithNbsp(node) || isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node))) {\n              paddEmptyNode(settings, args, blockElements, node);\n            }\n\n            node = node.parent;\n          }\n        }\n      }, schema);\n      var rootNode = node = new AstNode(args.context || settings.root_name, 11);\n      parser.parse(html, args.format);\n\n      if (validate && invalidChildren.length) {\n        if (!args.context) {\n          fixInvalidChildren(invalidChildren);\n        } else {\n          args.invalid = true;\n        }\n      }\n\n      if (rootBlockName && (rootNode.name === 'body' || args.isRootContent)) {\n        addRootBlocks();\n      }\n\n      if (!args.invalid) {\n        for (name in matchedNodes) {\n          if (!matchedNodes.hasOwnProperty(name)) {\n            continue;\n          }\n\n          list = nodeFilters[name];\n          nodes = matchedNodes[name];\n          fi = nodes.length;\n\n          while (fi--) {\n            if (!nodes[fi].parent) {\n              nodes.splice(fi, 1);\n            }\n          }\n\n          for (i = 0, l = list.length; i < l; i++) {\n            list[i](nodes, name, args);\n          }\n        }\n\n        for (i = 0, l = attributeFilters.length; i < l; i++) {\n          list = attributeFilters[i];\n\n          if (list.name in matchedAttributes) {\n            nodes = matchedAttributes[list.name];\n            fi = nodes.length;\n\n            while (fi--) {\n              if (!nodes[fi].parent) {\n                nodes.splice(fi, 1);\n              }\n            }\n\n            for (fi = 0, fl = list.callbacks.length; fi < fl; fi++) {\n              list.callbacks[fi](nodes, list.name, args);\n            }\n          }\n        }\n      }\n\n      return rootNode;\n    };\n\n    var exports = {\n      schema: schema,\n      addAttributeFilter: addAttributeFilter,\n      getAttributeFilters: getAttributeFilters,\n      addNodeFilter: addNodeFilter,\n      getNodeFilters: getNodeFilters,\n      filterNode: filterNode,\n      parse: parse\n    };\n    register$2(exports, settings);\n    register$1(exports, settings);\n    return exports;\n  };\n\n  var register$3 = function (htmlParser, settings, dom) {\n    htmlParser.addAttributeFilter('data-mce-tabindex', function (nodes, name) {\n      var i = nodes.length,\n          node;\n\n      while (i--) {\n        node = nodes[i];\n        node.attr('tabindex', node.attr('data-mce-tabindex'));\n        node.attr(name, null);\n      }\n    });\n    htmlParser.addAttributeFilter('src,href,style', function (nodes, name) {\n      var i = nodes.length,\n          node,\n          value;\n      var internalName = 'data-mce-' + name;\n      var urlConverter = settings.url_converter;\n      var urlConverterScope = settings.url_converter_scope;\n\n      while (i--) {\n        node = nodes[i];\n        value = node.attr(internalName);\n\n        if (value !== undefined) {\n          node.attr(name, value.length > 0 ? value : null);\n          node.attr(internalName, null);\n        } else {\n          value = node.attr(name);\n\n          if (name === 'style') {\n            value = dom.serializeStyle(dom.parseStyle(value), node.name);\n          } else if (urlConverter) {\n            value = urlConverter.call(urlConverterScope, value, name, node.name);\n          }\n\n          node.attr(name, value.length > 0 ? value : null);\n        }\n      }\n    });\n    htmlParser.addAttributeFilter('class', function (nodes) {\n      var i = nodes.length,\n          node,\n          value;\n\n      while (i--) {\n        node = nodes[i];\n        value = node.attr('class');\n\n        if (value) {\n          value = node.attr('class').replace(/(?:^|\\s)mce-item-\\w+(?!\\S)/g, '');\n          node.attr('class', value.length > 0 ? value : null);\n        }\n      }\n    });\n    htmlParser.addAttributeFilter('data-mce-type', function (nodes, name, args) {\n      var i = nodes.length,\n          node;\n\n      while (i--) {\n        node = nodes[i];\n\n        if (node.attr('data-mce-type') === 'bookmark' && !args.cleanup) {\n          var hasChildren = Optional.from(node.firstChild).exists(function (firstChild) {\n            return !isZwsp$1(firstChild.value);\n          });\n\n          if (hasChildren) {\n            node.unwrap();\n          } else {\n            node.remove();\n          }\n        }\n      }\n    });\n    htmlParser.addNodeFilter('noscript', function (nodes) {\n      var i = nodes.length,\n          node;\n\n      while (i--) {\n        node = nodes[i].firstChild;\n\n        if (node) {\n          node.value = Entities.decode(node.value);\n        }\n      }\n    });\n    htmlParser.addNodeFilter('script,style', function (nodes, name) {\n      var i = nodes.length,\n          node,\n          value,\n          type;\n\n      var trim = function (value) {\n        return value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n').replace(/^[\\r\\n]*|[\\r\\n]*$/g, '').replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi, '').replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g, '');\n      };\n\n      while (i--) {\n        node = nodes[i];\n        value = node.firstChild ? node.firstChild.value : '';\n\n        if (name === 'script') {\n          type = node.attr('type');\n\n          if (type) {\n            node.attr('type', type === 'mce-no/type' ? null : type.replace(/^mce\\-/, ''));\n          }\n\n          if (settings.element_format === 'xhtml' && value.length > 0) {\n            node.firstChild.value = '// <![CDATA[\\n' + trim(value) + '\\n// ]]>';\n          }\n        } else {\n          if (settings.element_format === 'xhtml' && value.length > 0) {\n            node.firstChild.value = '<!--\\n' + trim(value) + '\\n-->';\n          }\n        }\n      }\n    });\n    htmlParser.addNodeFilter('#comment', function (nodes) {\n      var i = nodes.length,\n          node;\n\n      while (i--) {\n        node = nodes[i];\n\n        if (settings.preserve_cdata && node.value.indexOf('[CDATA[') === 0) {\n          node.name = '#cdata';\n          node.type = 4;\n          node.value = dom.decode(node.value.replace(/^\\[CDATA\\[|\\]\\]$/g, ''));\n        } else if (node.value.indexOf('mce:protected ') === 0) {\n          node.name = '#text';\n          node.type = 3;\n          node.raw = true;\n          node.value = unescape(node.value).substr(14);\n        }\n      }\n    });\n    htmlParser.addNodeFilter('xml:namespace,input', function (nodes, name) {\n      var i = nodes.length,\n          node;\n\n      while (i--) {\n        node = nodes[i];\n\n        if (node.type === 7) {\n          node.remove();\n        } else if (node.type === 1) {\n          if (name === 'input' && !node.attr('type')) {\n            node.attr('type', 'text');\n          }\n        }\n      }\n    });\n    htmlParser.addAttributeFilter('data-mce-type', function (nodes) {\n      each(nodes, function (node) {\n        if (node.attr('data-mce-type') === 'format-caret') {\n          if (node.isEmpty(htmlParser.schema.getNonEmptyElements())) {\n            node.remove();\n          } else {\n            node.unwrap();\n          }\n        }\n      });\n    });\n    htmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style,' + 'data-mce-selected,data-mce-expando,' + 'data-mce-type,data-mce-resize,data-mce-placeholder', function (nodes, name) {\n      var i = nodes.length;\n\n      while (i--) {\n        nodes[i].attr(name, null);\n      }\n    });\n  };\n\n  var trimTrailingBr = function (rootNode) {\n    var isBr = function (node) {\n      return node && node.name === 'br';\n    };\n\n    var brNode1 = rootNode.lastChild;\n\n    if (isBr(brNode1)) {\n      var brNode2 = brNode1.prev;\n\n      if (isBr(brNode2)) {\n        brNode1.remove();\n        brNode2.remove();\n      }\n    }\n  };\n\n  var preProcess = function (editor, node, args) {\n    var doc, oldDoc;\n    var dom = editor.dom;\n    node = node.cloneNode(true);\n    var impl = document.implementation;\n\n    if (impl.createHTMLDocument) {\n      doc = impl.createHTMLDocument('');\n      Tools.each(node.nodeName === 'BODY' ? node.childNodes : [node], function (node) {\n        doc.body.appendChild(doc.importNode(node, true));\n      });\n\n      if (node.nodeName !== 'BODY') {\n        node = doc.body.firstChild;\n      } else {\n        node = doc.body;\n      }\n\n      oldDoc = dom.doc;\n      dom.doc = doc;\n    }\n\n    firePreProcess(editor, __assign(__assign({}, args), {\n      node: node\n    }));\n\n    if (oldDoc) {\n      dom.doc = oldDoc;\n    }\n\n    return node;\n  };\n\n  var shouldFireEvent = function (editor, args) {\n    return editor && editor.hasEventListeners('PreProcess') && !args.no_events;\n  };\n\n  var process = function (editor, node, args) {\n    return shouldFireEvent(editor, args) ? preProcess(editor, node, args) : node;\n  };\n\n  var addTempAttr = function (htmlParser, tempAttrs, name) {\n    if (Tools.inArray(tempAttrs, name) === -1) {\n      htmlParser.addAttributeFilter(name, function (nodes, name) {\n        var i = nodes.length;\n\n        while (i--) {\n          nodes[i].attr(name, null);\n        }\n      });\n      tempAttrs.push(name);\n    }\n  };\n\n  var postProcess$1 = function (editor, args, content) {\n    if (!args.no_events && editor) {\n      var outArgs = firePostProcess(editor, __assign(__assign({}, args), {\n        content: content\n      }));\n      return outArgs.content;\n    } else {\n      return content;\n    }\n  };\n\n  var getHtmlFromNode = function (dom, node, args) {\n    var html = trim$2(args.getInner ? node.innerHTML : dom.getOuterHTML(node));\n    return args.selection || isWsPreserveElement(SugarElement.fromDom(node)) ? html : Tools.trim(html);\n  };\n\n  var parseHtml = function (htmlParser, html, args) {\n    var parserArgs = args.selection ? __assign({\n      forced_root_block: false\n    }, args) : args;\n    var rootNode = htmlParser.parse(html, parserArgs);\n    trimTrailingBr(rootNode);\n    return rootNode;\n  };\n\n  var serializeNode = function (settings, schema, node) {\n    var htmlSerializer = HtmlSerializer(settings, schema);\n    return htmlSerializer.serialize(node);\n  };\n\n  var toHtml = function (editor, settings, schema, rootNode, args) {\n    var content = serializeNode(settings, schema, rootNode);\n    return postProcess$1(editor, args, content);\n  };\n\n  var DomSerializerImpl = function (settings, editor) {\n    var tempAttrs = ['data-mce-selected'];\n    var dom = editor && editor.dom ? editor.dom : DOMUtils$1.DOM;\n    var schema = editor && editor.schema ? editor.schema : Schema(settings);\n    settings.entity_encoding = settings.entity_encoding || 'named';\n    settings.remove_trailing_brs = 'remove_trailing_brs' in settings ? settings.remove_trailing_brs : true;\n    var htmlParser = DomParser(settings, schema);\n    register$3(htmlParser, settings, dom);\n\n    var serialize = function (node, parserArgs) {\n      if (parserArgs === void 0) {\n        parserArgs = {};\n      }\n\n      var args = __assign({\n        format: 'html'\n      }, parserArgs);\n\n      var targetNode = process(editor, node, args);\n      var html = getHtmlFromNode(dom, targetNode, args);\n      var rootNode = parseHtml(htmlParser, html, args);\n      return args.format === 'tree' ? rootNode : toHtml(editor, settings, schema, rootNode, args);\n    };\n\n    return {\n      schema: schema,\n      addNodeFilter: htmlParser.addNodeFilter,\n      addAttributeFilter: htmlParser.addAttributeFilter,\n      serialize: serialize,\n      addRules: function (rules) {\n        schema.addValidElements(rules);\n      },\n      setRules: function (rules) {\n        schema.setValidElements(rules);\n      },\n      addTempAttr: curry(addTempAttr, htmlParser, tempAttrs),\n      getTempAttrs: function () {\n        return tempAttrs;\n      },\n      getNodeFilters: htmlParser.getNodeFilters,\n      getAttributeFilters: htmlParser.getAttributeFilters\n    };\n  };\n\n  var DomSerializer = function (settings, editor) {\n    var domSerializer = DomSerializerImpl(settings, editor);\n    return {\n      schema: domSerializer.schema,\n      addNodeFilter: domSerializer.addNodeFilter,\n      addAttributeFilter: domSerializer.addAttributeFilter,\n      serialize: domSerializer.serialize,\n      addRules: domSerializer.addRules,\n      setRules: domSerializer.setRules,\n      addTempAttr: domSerializer.addTempAttr,\n      getTempAttrs: domSerializer.getTempAttrs,\n      getNodeFilters: domSerializer.getNodeFilters,\n      getAttributeFilters: domSerializer.getAttributeFilters\n    };\n  };\n\n  var defaultFormat$1 = 'html';\n\n  var getContent$2 = function (editor, args) {\n    if (args === void 0) {\n      args = {};\n    }\n\n    var format = args.format ? args.format : defaultFormat$1;\n    return getContent(editor, args, format);\n  };\n\n  var setContent$2 = function (editor, content, args) {\n    if (args === void 0) {\n      args = {};\n    }\n\n    return setContent(editor, content, args);\n  };\n\n  var DOM$3 = DOMUtils$1.DOM;\n\n  var restoreOriginalStyles = function (editor) {\n    DOM$3.setStyle(editor.id, 'display', editor.orgDisplay);\n  };\n\n  var safeDestroy = function (x) {\n    return Optional.from(x).each(function (x) {\n      return x.destroy();\n    });\n  };\n\n  var clearDomReferences = function (editor) {\n    editor.contentAreaContainer = editor.formElement = editor.container = editor.editorContainer = null;\n    editor.bodyElement = editor.contentDocument = editor.contentWindow = null;\n    editor.iframeElement = editor.targetElm = null;\n\n    if (editor.selection) {\n      editor.selection = editor.selection.win = editor.selection.dom = editor.selection.dom.doc = null;\n    }\n  };\n\n  var restoreForm = function (editor) {\n    var form = editor.formElement;\n\n    if (form) {\n      if (form._mceOldSubmit) {\n        form.submit = form._mceOldSubmit;\n        form._mceOldSubmit = null;\n      }\n\n      DOM$3.unbind(form, 'submit reset', editor.formEventDelegate);\n    }\n  };\n\n  var remove$7 = function (editor) {\n    if (!editor.removed) {\n      var _selectionOverrides = editor._selectionOverrides,\n          editorUpload = editor.editorUpload;\n      var body = editor.getBody();\n      var element = editor.getElement();\n\n      if (body) {\n        editor.save({\n          is_removing: true\n        });\n      }\n\n      editor.removed = true;\n      editor.unbindAllNativeEvents();\n\n      if (editor.hasHiddenInput && element) {\n        DOM$3.remove(element.nextSibling);\n      }\n\n      fireRemove(editor);\n      editor.editorManager.remove(editor);\n\n      if (!editor.inline && body) {\n        restoreOriginalStyles(editor);\n      }\n\n      fireDetach(editor);\n      DOM$3.remove(editor.getContainer());\n      safeDestroy(_selectionOverrides);\n      safeDestroy(editorUpload);\n      editor.destroy();\n    }\n  };\n\n  var destroy = function (editor, automatic) {\n    var selection = editor.selection,\n        dom = editor.dom;\n\n    if (editor.destroyed) {\n      return;\n    }\n\n    if (!automatic && !editor.removed) {\n      editor.remove();\n      return;\n    }\n\n    if (!automatic) {\n      editor.editorManager.off('beforeunload', editor._beforeUnload);\n\n      if (editor.theme && editor.theme.destroy) {\n        editor.theme.destroy();\n      }\n\n      safeDestroy(selection);\n      safeDestroy(dom);\n    }\n\n    restoreForm(editor);\n    clearDomReferences(editor);\n    editor.destroyed = true;\n  };\n\n  var hasOwnProperty$2 = Object.prototype.hasOwnProperty;\n\n  var deep$1 = function (old, nu) {\n    var bothObjects = isObject(old) && isObject(nu);\n    return bothObjects ? deepMerge(old, nu) : nu;\n  };\n\n  var baseMerge = function (merger) {\n    return function () {\n      var objects = new Array(arguments.length);\n\n      for (var i = 0; i < objects.length; i++) {\n        objects[i] = arguments[i];\n      }\n\n      if (objects.length === 0) {\n        throw new Error('Can\\'t merge zero objects');\n      }\n\n      var ret = {};\n\n      for (var j = 0; j < objects.length; j++) {\n        var curObject = objects[j];\n\n        for (var key in curObject) {\n          if (hasOwnProperty$2.call(curObject, key)) {\n            ret[key] = merger(ret[key], curObject[key]);\n          }\n        }\n      }\n\n      return ret;\n    };\n  };\n\n  var deepMerge = baseMerge(deep$1);\n\n  var sectionResult = function (sections, settings) {\n    return {\n      sections: constant(sections),\n      settings: constant(settings)\n    };\n  };\n\n  var deviceDetection = detect$3().deviceType;\n  var isTouch = deviceDetection.isTouch();\n  var isPhone = deviceDetection.isPhone();\n  var isTablet = deviceDetection.isTablet();\n  var legacyMobilePlugins = ['lists', 'autolink', 'autosave'];\n  var defaultTouchSettings = {\n    table_grid: false,\n    object_resizing: false,\n    resize: false\n  };\n\n  var normalizePlugins = function (plugins) {\n    var pluginNames = isArray(plugins) ? plugins.join(' ') : plugins;\n    var trimmedPlugins = map(isString(pluginNames) ? pluginNames.split(' ') : [], trim);\n    return filter(trimmedPlugins, function (item) {\n      return item.length > 0;\n    });\n  };\n\n  var filterLegacyMobilePlugins = function (plugins) {\n    return filter(plugins, curry(contains, legacyMobilePlugins));\n  };\n\n  var extractSections = function (keys, settings) {\n    var result = bifilter(settings, function (value, key) {\n      return contains(keys, key);\n    });\n    return sectionResult(result.t, result.f);\n  };\n\n  var getSection = function (sectionResult, name, defaults) {\n    if (defaults === void 0) {\n      defaults = {};\n    }\n\n    var sections = sectionResult.sections();\n    var sectionSettings = sections.hasOwnProperty(name) ? sections[name] : {};\n    return Tools.extend({}, defaults, sectionSettings);\n  };\n\n  var hasSection = function (sectionResult, name) {\n    return sectionResult.sections().hasOwnProperty(name);\n  };\n\n  var isSectionTheme = function (sectionResult, name, theme) {\n    var section = sectionResult.sections();\n    return hasSection(sectionResult, name) && section[name].theme === theme;\n  };\n\n  var getSectionConfig = function (sectionResult, name) {\n    return hasSection(sectionResult, name) ? sectionResult.sections()[name] : {};\n  };\n\n  var getToolbarMode = function (settings, defaultVal) {\n    return get$1(settings, 'toolbar_mode').orThunk(function () {\n      return get$1(settings, 'toolbar_drawer').map(function (val) {\n        return val === false ? 'wrap' : val;\n      });\n    }).getOr(defaultVal);\n  };\n\n  var getDefaultSettings = function (settings, id, documentBaseUrl, isTouch, editor) {\n    var baseDefaults = {\n      id: id,\n      theme: 'silver',\n      toolbar_mode: getToolbarMode(settings, 'floating'),\n      plugins: '',\n      document_base_url: documentBaseUrl,\n      add_form_submit_trigger: true,\n      submit_patch: true,\n      add_unload_trigger: true,\n      convert_urls: true,\n      relative_urls: true,\n      remove_script_host: true,\n      object_resizing: true,\n      doctype: '<!DOCTYPE html>',\n      visual: true,\n      font_size_legacy_values: 'xx-small,small,medium,large,x-large,xx-large,300%',\n      forced_root_block: 'p',\n      hidden_input: true,\n      inline_styles: true,\n      convert_fonts_to_spans: true,\n      indent: true,\n      indent_before: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n      indent_after: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n      entity_encoding: 'named',\n      url_converter: editor.convertURL,\n      url_converter_scope: editor\n    };\n    return __assign(__assign({}, baseDefaults), isTouch ? defaultTouchSettings : {});\n  };\n\n  var getDefaultMobileSettings = function (mobileSettings, isPhone) {\n    var defaultMobileSettings = {\n      resize: false,\n      toolbar_mode: getToolbarMode(mobileSettings, 'scrolling'),\n      toolbar_sticky: false\n    };\n    var defaultPhoneSettings = {\n      menubar: false\n    };\n    return __assign(__assign(__assign({}, defaultTouchSettings), defaultMobileSettings), isPhone ? defaultPhoneSettings : {});\n  };\n\n  var getExternalPlugins$1 = function (overrideSettings, settings) {\n    var userDefinedExternalPlugins = settings.external_plugins ? settings.external_plugins : {};\n\n    if (overrideSettings && overrideSettings.external_plugins) {\n      return Tools.extend({}, overrideSettings.external_plugins, userDefinedExternalPlugins);\n    } else {\n      return userDefinedExternalPlugins;\n    }\n  };\n\n  var combinePlugins = function (forcedPlugins, plugins) {\n    return [].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins));\n  };\n\n  var getPlatformPlugins = function (isMobileDevice, sectionResult, desktopPlugins, mobilePlugins) {\n    if (isMobileDevice && isSectionTheme(sectionResult, 'mobile', 'mobile')) {\n      return filterLegacyMobilePlugins(mobilePlugins);\n    } else if (isMobileDevice && hasSection(sectionResult, 'mobile')) {\n      return mobilePlugins;\n    } else {\n      return desktopPlugins;\n    }\n  };\n\n  var processPlugins = function (isMobileDevice, sectionResult, defaultOverrideSettings, settings) {\n    var forcedPlugins = normalizePlugins(defaultOverrideSettings.forced_plugins);\n    var desktopPlugins = normalizePlugins(settings.plugins);\n    var mobileConfig = getSectionConfig(sectionResult, 'mobile');\n    var mobilePlugins = mobileConfig.plugins ? normalizePlugins(mobileConfig.plugins) : desktopPlugins;\n    var platformPlugins = getPlatformPlugins(isMobileDevice, sectionResult, desktopPlugins, mobilePlugins);\n    var combinedPlugins = combinePlugins(forcedPlugins, platformPlugins);\n\n    if (Env.browser.isIE() && contains(combinedPlugins, 'rtc')) {\n      throw new Error('RTC plugin is not supported on IE 11.');\n    }\n\n    return Tools.extend(settings, {\n      plugins: combinedPlugins.join(' ')\n    });\n  };\n\n  var isOnMobile = function (isMobileDevice, sectionResult) {\n    return isMobileDevice && hasSection(sectionResult, 'mobile');\n  };\n\n  var combineSettings = function (isMobileDevice, isPhone, defaultSettings, defaultOverrideSettings, settings) {\n    var defaultDeviceSettings = isMobileDevice ? {\n      mobile: getDefaultMobileSettings(settings.mobile || {}, isPhone)\n    } : {};\n    var sectionResult = extractSections(['mobile'], deepMerge(defaultDeviceSettings, settings));\n    var extendedSettings = Tools.extend(defaultSettings, defaultOverrideSettings, sectionResult.settings(), isOnMobile(isMobileDevice, sectionResult) ? getSection(sectionResult, 'mobile') : {}, {\n      validate: true,\n      external_plugins: getExternalPlugins$1(defaultOverrideSettings, sectionResult.settings())\n    });\n    return processPlugins(isMobileDevice, sectionResult, defaultOverrideSettings, extendedSettings);\n  };\n\n  var getEditorSettings = function (editor, id, documentBaseUrl, defaultOverrideSettings, settings) {\n    var defaultSettings = getDefaultSettings(settings, id, documentBaseUrl, isTouch, editor);\n    return combineSettings(isPhone || isTablet, isPhone, defaultSettings, defaultOverrideSettings, settings);\n  };\n\n  var getFiltered = function (predicate, editor, name) {\n    return Optional.from(editor.settings[name]).filter(predicate);\n  };\n\n  var getParamObject = function (value) {\n    var output = {};\n\n    if (typeof value === 'string') {\n      each(value.indexOf('=') > 0 ? value.split(/[;,](?![^=;,]*(?:[;,]|$))/) : value.split(','), function (val) {\n        var arr = val.split('=');\n\n        if (arr.length > 1) {\n          output[Tools.trim(arr[0])] = Tools.trim(arr[1]);\n        } else {\n          output[Tools.trim(arr[0])] = Tools.trim(arr[0]);\n        }\n      });\n    } else {\n      output = value;\n    }\n\n    return output;\n  };\n\n  var isArrayOf = function (p) {\n    return function (a) {\n      return isArray(a) && forall(a, p);\n    };\n  };\n\n  var getParam = function (editor, name, defaultVal, type) {\n    var value = name in editor.settings ? editor.settings[name] : defaultVal;\n\n    if (type === 'hash') {\n      return getParamObject(value);\n    } else if (type === 'string') {\n      return getFiltered(isString, editor, name).getOr(defaultVal);\n    } else if (type === 'number') {\n      return getFiltered(isNumber, editor, name).getOr(defaultVal);\n    } else if (type === 'boolean') {\n      return getFiltered(isBoolean, editor, name).getOr(defaultVal);\n    } else if (type === 'object') {\n      return getFiltered(isObject, editor, name).getOr(defaultVal);\n    } else if (type === 'array') {\n      return getFiltered(isArray, editor, name).getOr(defaultVal);\n    } else if (type === 'string[]') {\n      return getFiltered(isArrayOf(isString), editor, name).getOr(defaultVal);\n    } else if (type === 'function') {\n      return getFiltered(isFunction, editor, name).getOr(defaultVal);\n    } else {\n      return value;\n    }\n  };\n\n  var CreateIconManager = function () {\n    var lookup = {};\n\n    var add = function (id, iconPack) {\n      lookup[id] = iconPack;\n    };\n\n    var get = function (id) {\n      if (lookup[id]) {\n        return lookup[id];\n      }\n\n      return {\n        icons: {}\n      };\n    };\n\n    var has$1 = function (id) {\n      return has(lookup, id);\n    };\n\n    return {\n      add: add,\n      get: get,\n      has: has$1\n    };\n  };\n\n  var IconManager = CreateIconManager();\n\n  var getProp = function (propName, elm) {\n    var rawElm = elm.dom;\n    return rawElm[propName];\n  };\n\n  var getComputedSizeProp = function (propName, elm) {\n    return parseInt(get$5(elm, propName), 10);\n  };\n\n  var getClientWidth = curry(getProp, 'clientWidth');\n  var getClientHeight = curry(getProp, 'clientHeight');\n  var getMarginTop = curry(getComputedSizeProp, 'margin-top');\n  var getMarginLeft = curry(getComputedSizeProp, 'margin-left');\n\n  var getBoundingClientRect$1 = function (elm) {\n    return elm.dom.getBoundingClientRect();\n  };\n\n  var isInsideElementContentArea = function (bodyElm, clientX, clientY) {\n    var clientWidth = getClientWidth(bodyElm);\n    var clientHeight = getClientHeight(bodyElm);\n    return clientX >= 0 && clientY >= 0 && clientX <= clientWidth && clientY <= clientHeight;\n  };\n\n  var transpose = function (inline, elm, clientX, clientY) {\n    var clientRect = getBoundingClientRect$1(elm);\n    var deltaX = inline ? clientRect.left + elm.dom.clientLeft + getMarginLeft(elm) : 0;\n    var deltaY = inline ? clientRect.top + elm.dom.clientTop + getMarginTop(elm) : 0;\n    var x = clientX - deltaX;\n    var y = clientY - deltaY;\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  var isXYInContentArea = function (editor, clientX, clientY) {\n    var bodyElm = SugarElement.fromDom(editor.getBody());\n    var targetElm = editor.inline ? bodyElm : documentElement(bodyElm);\n    var transposedPoint = transpose(editor.inline, targetElm, clientX, clientY);\n    return isInsideElementContentArea(targetElm, transposedPoint.x, transposedPoint.y);\n  };\n\n  var fromDomSafe = function (node) {\n    return Optional.from(node).map(SugarElement.fromDom);\n  };\n\n  var isEditorAttachedToDom = function (editor) {\n    var rawContainer = editor.inline ? editor.getBody() : editor.getContentAreaContainer();\n    return fromDomSafe(rawContainer).map(inBody).getOr(false);\n  };\n\n  function NotificationManagerImpl() {\n    var unimplemented = function () {\n      throw new Error('Theme did not provide a NotificationManager implementation.');\n    };\n\n    return {\n      open: unimplemented,\n      close: unimplemented,\n      reposition: unimplemented,\n      getArgs: unimplemented\n    };\n  }\n\n  function NotificationManager(editor) {\n    var notifications = [];\n\n    var getImplementation = function () {\n      var theme = editor.theme;\n      return theme && theme.getNotificationManagerImpl ? theme.getNotificationManagerImpl() : NotificationManagerImpl();\n    };\n\n    var getTopNotification = function () {\n      return Optional.from(notifications[0]);\n    };\n\n    var isEqual = function (a, b) {\n      return a.type === b.type && a.text === b.text && !a.progressBar && !a.timeout && !b.progressBar && !b.timeout;\n    };\n\n    var reposition = function () {\n      if (notifications.length > 0) {\n        getImplementation().reposition(notifications);\n      }\n    };\n\n    var addNotification = function (notification) {\n      notifications.push(notification);\n    };\n\n    var closeNotification = function (notification) {\n      findIndex(notifications, function (otherNotification) {\n        return otherNotification === notification;\n      }).each(function (index) {\n        notifications.splice(index, 1);\n      });\n    };\n\n    var open = function (spec, fireEvent) {\n      if (fireEvent === void 0) {\n        fireEvent = true;\n      }\n\n      if (editor.removed || !isEditorAttachedToDom(editor)) {\n        return;\n      }\n\n      if (fireEvent) {\n        editor.fire('BeforeOpenNotification', {\n          notification: spec\n        });\n      }\n\n      return find(notifications, function (notification) {\n        return isEqual(getImplementation().getArgs(notification), spec);\n      }).getOrThunk(function () {\n        editor.editorManager.setActive(editor);\n        var notification = getImplementation().open(spec, function () {\n          closeNotification(notification);\n          reposition();\n          getTopNotification().fold(function () {\n            return editor.focus();\n          }, function (top) {\n            return focus(SugarElement.fromDom(top.getEl()));\n          });\n        });\n        addNotification(notification);\n        reposition();\n        editor.fire('OpenNotification', __assign({}, notification));\n        return notification;\n      });\n    };\n\n    var close = function () {\n      getTopNotification().each(function (notification) {\n        getImplementation().close(notification);\n        closeNotification(notification);\n        reposition();\n      });\n    };\n\n    var getNotifications = function () {\n      return notifications;\n    };\n\n    var registerEvents = function (editor) {\n      editor.on('SkinLoaded', function () {\n        var serviceMessage = getServiceMessage(editor);\n\n        if (serviceMessage) {\n          open({\n            text: serviceMessage,\n            type: 'warning',\n            timeout: 0\n          }, false);\n        }\n      });\n      editor.on('ResizeEditor ResizeWindow NodeChange', function () {\n        Delay.requestAnimationFrame(reposition);\n      });\n      editor.on('remove', function () {\n        each(notifications.slice(), function (notification) {\n          getImplementation().close(notification);\n        });\n      });\n    };\n\n    registerEvents(editor);\n    return {\n      open: open,\n      close: close,\n      getNotifications: getNotifications\n    };\n  }\n\n  var PluginManager = AddOnManager$1.PluginManager;\n  var ThemeManager = AddOnManager$1.ThemeManager;\n\n  function WindowManagerImpl() {\n    var unimplemented = function () {\n      throw new Error('Theme did not provide a WindowManager implementation.');\n    };\n\n    return {\n      open: unimplemented,\n      openUrl: unimplemented,\n      alert: unimplemented,\n      confirm: unimplemented,\n      close: unimplemented,\n      getParams: unimplemented,\n      setParams: unimplemented\n    };\n  }\n\n  var WindowManager = function (editor) {\n    var dialogs = [];\n\n    var getImplementation = function () {\n      var theme = editor.theme;\n      return theme && theme.getWindowManagerImpl ? theme.getWindowManagerImpl() : WindowManagerImpl();\n    };\n\n    var funcBind = function (scope, f) {\n      return function () {\n        return f ? f.apply(scope, arguments) : undefined;\n      };\n    };\n\n    var fireOpenEvent = function (dialog) {\n      editor.fire('OpenWindow', {\n        dialog: dialog\n      });\n    };\n\n    var fireCloseEvent = function (dialog) {\n      editor.fire('CloseWindow', {\n        dialog: dialog\n      });\n    };\n\n    var addDialog = function (dialog) {\n      dialogs.push(dialog);\n      fireOpenEvent(dialog);\n    };\n\n    var closeDialog = function (dialog) {\n      fireCloseEvent(dialog);\n      dialogs = filter(dialogs, function (otherDialog) {\n        return otherDialog !== dialog;\n      });\n\n      if (dialogs.length === 0) {\n        editor.focus();\n      }\n    };\n\n    var getTopDialog = function () {\n      return Optional.from(dialogs[dialogs.length - 1]);\n    };\n\n    var storeSelectionAndOpenDialog = function (openDialog) {\n      editor.editorManager.setActive(editor);\n      store(editor);\n      var dialog = openDialog();\n      addDialog(dialog);\n      return dialog;\n    };\n\n    var open = function (args, params) {\n      return storeSelectionAndOpenDialog(function () {\n        return getImplementation().open(args, params, closeDialog);\n      });\n    };\n\n    var openUrl = function (args) {\n      return storeSelectionAndOpenDialog(function () {\n        return getImplementation().openUrl(args, closeDialog);\n      });\n    };\n\n    var alert = function (message, callback, scope) {\n      getImplementation().alert(message, funcBind(scope ? scope : this, callback));\n    };\n\n    var confirm = function (message, callback, scope) {\n      getImplementation().confirm(message, funcBind(scope ? scope : this, callback));\n    };\n\n    var close = function () {\n      getTopDialog().each(function (dialog) {\n        getImplementation().close(dialog);\n        closeDialog(dialog);\n      });\n    };\n\n    editor.on('remove', function () {\n      each(dialogs, function (dialog) {\n        getImplementation().close(dialog);\n      });\n    });\n    return {\n      open: open,\n      openUrl: openUrl,\n      alert: alert,\n      confirm: confirm,\n      close: close\n    };\n  };\n\n  var displayNotification = function (editor, message) {\n    editor.notificationManager.open({\n      type: 'error',\n      text: message\n    });\n  };\n\n  var displayError = function (editor, message) {\n    if (editor._skinLoaded) {\n      displayNotification(editor, message);\n    } else {\n      editor.on('SkinLoaded', function () {\n        displayNotification(editor, message);\n      });\n    }\n  };\n\n  var uploadError = function (editor, message) {\n    displayError(editor, I18n.translate(['Failed to upload image: {0}', message]));\n  };\n\n  var logError = function (editor, errorType, msg) {\n    fireError(editor, errorType, {\n      message: msg\n    });\n    console.error(msg);\n  };\n\n  var createLoadError = function (type, url, name) {\n    return name ? 'Failed to load ' + type + ': ' + name + ' from url ' + url : 'Failed to load ' + type + ' url: ' + url;\n  };\n\n  var pluginLoadError = function (editor, url, name) {\n    logError(editor, 'PluginLoadError', createLoadError('plugin', url, name));\n  };\n\n  var iconsLoadError = function (editor, url, name) {\n    logError(editor, 'IconsLoadError', createLoadError('icons', url, name));\n  };\n\n  var languageLoadError = function (editor, url, name) {\n    logError(editor, 'LanguageLoadError', createLoadError('language', url, name));\n  };\n\n  var pluginInitError = function (editor, name, err) {\n    var message = I18n.translate(['Failed to initialize plugin: {0}', name]);\n    initError(message, err);\n    displayError(editor, message);\n  };\n\n  var initError = function (message) {\n    var x = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      x[_i - 1] = arguments[_i];\n    }\n\n    var console = window.console;\n\n    if (console) {\n      if (console.error) {\n        console.error.apply(console, __spreadArrays([message], x));\n      } else {\n        console.log.apply(console, __spreadArrays([message], x));\n      }\n    }\n  };\n\n  var isContentCssSkinName = function (url) {\n    return /^[a-z0-9\\-]+$/i.test(url);\n  };\n\n  var getContentCssUrls = function (editor) {\n    var contentCss = getContentCss(editor);\n    var skinUrl = editor.editorManager.baseURL + '/skins/content';\n    var suffix = editor.editorManager.suffix;\n    var contentCssFile = 'content' + suffix + '.css';\n    var inline = editor.inline === true;\n    return map(contentCss, function (url) {\n      if (isContentCssSkinName(url) && !inline) {\n        return skinUrl + '/' + url + '/' + contentCssFile;\n      } else {\n        return editor.documentBaseURI.toAbsolute(url);\n      }\n    });\n  };\n\n  var appendContentCssFromSettings = function (editor) {\n    editor.contentCSS = editor.contentCSS.concat(getContentCssUrls(editor));\n  };\n\n  function Uploader(uploadStatus, settings) {\n    var pendingPromises = {};\n\n    var pathJoin = function (path1, path2) {\n      if (path1) {\n        return path1.replace(/\\/$/, '') + '/' + path2.replace(/^\\//, '');\n      }\n\n      return path2;\n    };\n\n    var defaultHandler = function (blobInfo, success, failure, progress) {\n      var xhr = new XMLHttpRequest();\n      xhr.open('POST', settings.url);\n      xhr.withCredentials = settings.credentials;\n\n      xhr.upload.onprogress = function (e) {\n        progress(e.loaded / e.total * 100);\n      };\n\n      xhr.onerror = function () {\n        failure('Image upload failed due to a XHR Transport error. Code: ' + xhr.status);\n      };\n\n      xhr.onload = function () {\n        if (xhr.status < 200 || xhr.status >= 300) {\n          failure('HTTP Error: ' + xhr.status);\n          return;\n        }\n\n        var json = JSON.parse(xhr.responseText);\n\n        if (!json || typeof json.location !== 'string') {\n          failure('Invalid JSON: ' + xhr.responseText);\n          return;\n        }\n\n        success(pathJoin(settings.basePath, json.location));\n      };\n\n      var formData = new FormData();\n      formData.append('file', blobInfo.blob(), blobInfo.filename());\n      xhr.send(formData);\n    };\n\n    var noUpload = function () {\n      return new promiseObj(function (resolve) {\n        resolve([]);\n      });\n    };\n\n    var handlerSuccess = function (blobInfo, url) {\n      return {\n        url: url,\n        blobInfo: blobInfo,\n        status: true\n      };\n    };\n\n    var handlerFailure = function (blobInfo, message, options) {\n      return {\n        url: '',\n        blobInfo: blobInfo,\n        status: false,\n        error: {\n          message: message,\n          options: options\n        }\n      };\n    };\n\n    var resolvePending = function (blobUri, result) {\n      Tools.each(pendingPromises[blobUri], function (resolve) {\n        resolve(result);\n      });\n      delete pendingPromises[blobUri];\n    };\n\n    var uploadBlobInfo = function (blobInfo, handler, openNotification) {\n      uploadStatus.markPending(blobInfo.blobUri());\n      return new promiseObj(function (resolve) {\n        var notification, progress;\n\n        var noop = function () {};\n\n        try {\n          var closeNotification_1 = function () {\n            if (notification) {\n              notification.close();\n              progress = noop;\n            }\n          };\n\n          var success = function (url) {\n            closeNotification_1();\n            uploadStatus.markUploaded(blobInfo.blobUri(), url);\n            resolvePending(blobInfo.blobUri(), handlerSuccess(blobInfo, url));\n            resolve(handlerSuccess(blobInfo, url));\n          };\n\n          var failure = function (error, options) {\n            var failureOptions = options ? options : {};\n            closeNotification_1();\n            uploadStatus.removeFailed(blobInfo.blobUri());\n            resolvePending(blobInfo.blobUri(), handlerFailure(blobInfo, error, failureOptions));\n            resolve(handlerFailure(blobInfo, error, failureOptions));\n          };\n\n          progress = function (percent) {\n            if (percent < 0 || percent > 100) {\n              return;\n            }\n\n            if (!notification) {\n              notification = openNotification();\n            }\n\n            notification.progressBar.value(percent);\n          };\n\n          handler(blobInfo, success, failure, progress);\n        } catch (ex) {\n          resolve(handlerFailure(blobInfo, ex.message, {}));\n        }\n      });\n    };\n\n    var isDefaultHandler = function (handler) {\n      return handler === defaultHandler;\n    };\n\n    var pendingUploadBlobInfo = function (blobInfo) {\n      var blobUri = blobInfo.blobUri();\n      return new promiseObj(function (resolve) {\n        pendingPromises[blobUri] = pendingPromises[blobUri] || [];\n        pendingPromises[blobUri].push(resolve);\n      });\n    };\n\n    var uploadBlobs = function (blobInfos, openNotification) {\n      blobInfos = Tools.grep(blobInfos, function (blobInfo) {\n        return !uploadStatus.isUploaded(blobInfo.blobUri());\n      });\n      return promiseObj.all(Tools.map(blobInfos, function (blobInfo) {\n        return uploadStatus.isPending(blobInfo.blobUri()) ? pendingUploadBlobInfo(blobInfo) : uploadBlobInfo(blobInfo, settings.handler, openNotification);\n      }));\n    };\n\n    var upload = function (blobInfos, openNotification) {\n      return !settings.url && isDefaultHandler(settings.handler) ? noUpload() : uploadBlobs(blobInfos, openNotification);\n    };\n\n    if (isFunction(settings.handler) === false) {\n      settings.handler = defaultHandler;\n    }\n\n    return {\n      upload: upload\n    };\n  }\n\n  function UploadStatus() {\n    var PENDING = 1,\n        UPLOADED = 2;\n    var blobUriStatuses = {};\n\n    var createStatus = function (status, resultUri) {\n      return {\n        status: status,\n        resultUri: resultUri\n      };\n    };\n\n    var hasBlobUri = function (blobUri) {\n      return blobUri in blobUriStatuses;\n    };\n\n    var getResultUri = function (blobUri) {\n      var result = blobUriStatuses[blobUri];\n      return result ? result.resultUri : null;\n    };\n\n    var isPending = function (blobUri) {\n      return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === PENDING : false;\n    };\n\n    var isUploaded = function (blobUri) {\n      return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === UPLOADED : false;\n    };\n\n    var markPending = function (blobUri) {\n      blobUriStatuses[blobUri] = createStatus(PENDING, null);\n    };\n\n    var markUploaded = function (blobUri, resultUri) {\n      blobUriStatuses[blobUri] = createStatus(UPLOADED, resultUri);\n    };\n\n    var removeFailed = function (blobUri) {\n      delete blobUriStatuses[blobUri];\n    };\n\n    var destroy = function () {\n      blobUriStatuses = {};\n    };\n\n    return {\n      hasBlobUri: hasBlobUri,\n      getResultUri: getResultUri,\n      isPending: isPending,\n      isUploaded: isUploaded,\n      markPending: markPending,\n      markUploaded: markUploaded,\n      removeFailed: removeFailed,\n      destroy: destroy\n    };\n  }\n\n  var count$1 = 0;\n\n  var seed = function () {\n    var rnd = function () {\n      return Math.round(Math.random() * 4294967295).toString(36);\n    };\n\n    var now = new Date().getTime();\n    return 's' + now.toString(36) + rnd() + rnd() + rnd();\n  };\n\n  var uuid = function (prefix) {\n    return prefix + count$1++ + seed();\n  };\n\n  var BlobCache = function () {\n    var cache = [];\n\n    var mimeToExt = function (mime) {\n      var mimes = {\n        'image/jpeg': 'jpg',\n        'image/jpg': 'jpg',\n        'image/gif': 'gif',\n        'image/png': 'png',\n        'image/apng': 'apng',\n        'image/avif': 'avif',\n        'image/svg+xml': 'svg',\n        'image/webp': 'webp',\n        'image/bmp': 'bmp',\n        'image/tiff': 'tiff'\n      };\n      return mimes[mime.toLowerCase()] || 'dat';\n    };\n\n    var create = function (o, blob, base64, name, filename) {\n      if (isString(o)) {\n        var id = o;\n        return toBlobInfo({\n          id: id,\n          name: name,\n          filename: filename,\n          blob: blob,\n          base64: base64\n        });\n      } else if (isObject(o)) {\n        return toBlobInfo(o);\n      } else {\n        throw new Error('Unknown input type');\n      }\n    };\n\n    var toBlobInfo = function (o) {\n      if (!o.blob || !o.base64) {\n        throw new Error('blob and base64 representations of the image are required for BlobInfo to be created');\n      }\n\n      var id = o.id || uuid('blobid');\n      var name = o.name || id;\n      var blob = o.blob;\n      return {\n        id: constant(id),\n        name: constant(name),\n        filename: constant(o.filename || name + '.' + mimeToExt(blob.type)),\n        blob: constant(blob),\n        base64: constant(o.base64),\n        blobUri: constant(o.blobUri || URL.createObjectURL(blob)),\n        uri: constant(o.uri)\n      };\n    };\n\n    var add = function (blobInfo) {\n      if (!get(blobInfo.id())) {\n        cache.push(blobInfo);\n      }\n    };\n\n    var findFirst = function (predicate) {\n      return find(cache, predicate).getOrUndefined();\n    };\n\n    var get = function (id) {\n      return findFirst(function (cachedBlobInfo) {\n        return cachedBlobInfo.id() === id;\n      });\n    };\n\n    var getByUri = function (blobUri) {\n      return findFirst(function (blobInfo) {\n        return blobInfo.blobUri() === blobUri;\n      });\n    };\n\n    var getByData = function (base64, type) {\n      return findFirst(function (blobInfo) {\n        return blobInfo.base64() === base64 && blobInfo.blob().type === type;\n      });\n    };\n\n    var removeByUri = function (blobUri) {\n      cache = filter(cache, function (blobInfo) {\n        if (blobInfo.blobUri() === blobUri) {\n          URL.revokeObjectURL(blobInfo.blobUri());\n          return false;\n        }\n\n        return true;\n      });\n    };\n\n    var destroy = function () {\n      each(cache, function (cachedBlobInfo) {\n        URL.revokeObjectURL(cachedBlobInfo.blobUri());\n      });\n      cache = [];\n    };\n\n    return {\n      create: create,\n      add: add,\n      get: get,\n      getByUri: getByUri,\n      getByData: getByData,\n      findFirst: findFirst,\n      removeByUri: removeByUri,\n      destroy: destroy\n    };\n  };\n\n  var UploadChangeHandler = function (editor) {\n    var lastChangedLevel = Cell(null);\n    editor.on('change AddUndo', function (e) {\n      lastChangedLevel.set(__assign({}, e.level));\n    });\n\n    var fireIfChanged = function () {\n      var data = editor.undoManager.data;\n      last(data).filter(function (level) {\n        return !isEq$4(lastChangedLevel.get(), level);\n      }).each(function (level) {\n        editor.setDirty(true);\n        editor.fire('change', {\n          level: level,\n          lastLevel: get(data, data.length - 2).getOrNull()\n        });\n      });\n    };\n\n    return {\n      fireIfChanged: fireIfChanged\n    };\n  };\n\n  var EditorUpload = function (editor) {\n    var blobCache = BlobCache();\n    var uploader, imageScanner;\n    var uploadStatus = UploadStatus();\n    var urlFilters = [];\n    var changeHandler = UploadChangeHandler(editor);\n\n    var aliveGuard = function (callback) {\n      return function (result) {\n        if (editor.selection) {\n          return callback(result);\n        }\n\n        return [];\n      };\n    };\n\n    var cacheInvalidator = function (url) {\n      return url + (url.indexOf('?') === -1 ? '?' : '&') + new Date().getTime();\n    };\n\n    var replaceString = function (content, search, replace) {\n      var index = 0;\n\n      do {\n        index = content.indexOf(search, index);\n\n        if (index !== -1) {\n          content = content.substring(0, index) + replace + content.substr(index + search.length);\n          index += replace.length - search.length + 1;\n        }\n      } while (index !== -1);\n\n      return content;\n    };\n\n    var replaceImageUrl = function (content, targetUrl, replacementUrl) {\n      var replacementString = 'src=\"' + replacementUrl + '\"' + (replacementUrl === Env.transparentSrc ? ' data-mce-placeholder=\"1\"' : '');\n      content = replaceString(content, 'src=\"' + targetUrl + '\"', replacementString);\n      content = replaceString(content, 'data-mce-src=\"' + targetUrl + '\"', 'data-mce-src=\"' + replacementUrl + '\"');\n      return content;\n    };\n\n    var replaceUrlInUndoStack = function (targetUrl, replacementUrl) {\n      each(editor.undoManager.data, function (level) {\n        if (level.type === 'fragmented') {\n          level.fragments = map(level.fragments, function (fragment) {\n            return replaceImageUrl(fragment, targetUrl, replacementUrl);\n          });\n        } else {\n          level.content = replaceImageUrl(level.content, targetUrl, replacementUrl);\n        }\n      });\n    };\n\n    var openNotification = function () {\n      return editor.notificationManager.open({\n        text: editor.translate('Image uploading...'),\n        type: 'info',\n        timeout: -1,\n        progressBar: true\n      });\n    };\n\n    var replaceImageUriInView = function (image, resultUri) {\n      var src = editor.convertURL(resultUri, 'src');\n      replaceUrlInUndoStack(image.src, resultUri);\n      editor.$(image).attr({\n        'src': shouldReuseFileName(editor) ? cacheInvalidator(resultUri) : resultUri,\n        'data-mce-src': src\n      });\n    };\n\n    var uploadImages = function (callback) {\n      if (!uploader) {\n        uploader = Uploader(uploadStatus, {\n          url: getImageUploadUrl(editor),\n          basePath: getImageUploadBasePath(editor),\n          credentials: getImagesUploadCredentials(editor),\n          handler: getImagesUploadHandler(editor)\n        });\n      }\n\n      return scanForImages().then(aliveGuard(function (imageInfos) {\n        var blobInfos = map(imageInfos, function (imageInfo) {\n          return imageInfo.blobInfo;\n        });\n        return uploader.upload(blobInfos, openNotification).then(aliveGuard(function (result) {\n          var imagesToRemove = [];\n          var filteredResult = map(result, function (uploadInfo, index) {\n            var blobInfo = imageInfos[index].blobInfo;\n            var image = imageInfos[index].image;\n\n            if (uploadInfo.status && shouldReplaceBlobUris(editor)) {\n              blobCache.removeByUri(image.src);\n              replaceImageUriInView(image, uploadInfo.url);\n            } else if (uploadInfo.error) {\n              if (uploadInfo.error.options.remove) {\n                replaceUrlInUndoStack(image.getAttribute('src'), Env.transparentSrc);\n                imagesToRemove.push(image);\n              }\n\n              uploadError(editor, uploadInfo.error.message);\n            }\n\n            return {\n              element: image,\n              status: uploadInfo.status,\n              uploadUri: uploadInfo.url,\n              blobInfo: blobInfo\n            };\n          });\n\n          if (filteredResult.length > 0) {\n            changeHandler.fireIfChanged();\n          }\n\n          if (imagesToRemove.length > 0) {\n            if (isRtc(editor)) {\n              console.error('Removing images on failed uploads is currently unsupported for RTC');\n            } else {\n              editor.undoManager.transact(function () {\n                each(imagesToRemove, function (element) {\n                  editor.dom.remove(element);\n                  blobCache.removeByUri(element.src);\n                });\n              });\n            }\n          }\n\n          if (callback) {\n            callback(filteredResult);\n          }\n\n          return filteredResult;\n        }));\n      }));\n    };\n\n    var uploadImagesAuto = function (callback) {\n      if (isAutomaticUploadsEnabled(editor)) {\n        return uploadImages(callback);\n      }\n    };\n\n    var isValidDataUriImage = function (imgElm) {\n      if (forall(urlFilters, function (filter) {\n        return filter(imgElm);\n      }) === false) {\n        return false;\n      }\n\n      if (imgElm.getAttribute('src').indexOf('data:') === 0) {\n        var dataImgFilter = getImagesDataImgFilter(editor);\n        return dataImgFilter(imgElm);\n      }\n\n      return true;\n    };\n\n    var addFilter = function (filter) {\n      urlFilters.push(filter);\n    };\n\n    var scanForImages = function () {\n      if (!imageScanner) {\n        imageScanner = ImageScanner(uploadStatus, blobCache);\n      }\n\n      return imageScanner.findAll(editor.getBody(), isValidDataUriImage).then(aliveGuard(function (result) {\n        result = filter(result, function (resultItem) {\n          if (typeof resultItem === 'string') {\n            displayError(editor, resultItem);\n            return false;\n          }\n\n          return true;\n        });\n        each(result, function (resultItem) {\n          replaceUrlInUndoStack(resultItem.image.src, resultItem.blobInfo.blobUri());\n          resultItem.image.src = resultItem.blobInfo.blobUri();\n          resultItem.image.removeAttribute('data-mce-src');\n        });\n        return result;\n      }));\n    };\n\n    var destroy = function () {\n      blobCache.destroy();\n      uploadStatus.destroy();\n      imageScanner = uploader = null;\n    };\n\n    var replaceBlobUris = function (content) {\n      return content.replace(/src=\"(blob:[^\"]+)\"/g, function (match, blobUri) {\n        var resultUri = uploadStatus.getResultUri(blobUri);\n\n        if (resultUri) {\n          return 'src=\"' + resultUri + '\"';\n        }\n\n        var blobInfo = blobCache.getByUri(blobUri);\n\n        if (!blobInfo) {\n          blobInfo = foldl(editor.editorManager.get(), function (result, editor) {\n            return result || editor.editorUpload && editor.editorUpload.blobCache.getByUri(blobUri);\n          }, null);\n        }\n\n        if (blobInfo) {\n          var blob = blobInfo.blob();\n          return 'src=\"data:' + blob.type + ';base64,' + blobInfo.base64() + '\"';\n        }\n\n        return match;\n      });\n    };\n\n    editor.on('SetContent', function () {\n      if (isAutomaticUploadsEnabled(editor)) {\n        uploadImagesAuto();\n      } else {\n        scanForImages();\n      }\n    });\n    editor.on('RawSaveContent', function (e) {\n      e.content = replaceBlobUris(e.content);\n    });\n    editor.on('GetContent', function (e) {\n      if (e.source_view || e.format === 'raw' || e.format === 'tree') {\n        return;\n      }\n\n      e.content = replaceBlobUris(e.content);\n    });\n    editor.on('PostRender', function () {\n      editor.parser.addNodeFilter('img', function (images) {\n        each(images, function (img) {\n          var src = img.attr('src');\n\n          if (blobCache.getByUri(src)) {\n            return;\n          }\n\n          var resultUri = uploadStatus.getResultUri(src);\n\n          if (resultUri) {\n            img.attr('src', resultUri);\n          }\n        });\n      });\n    });\n    return {\n      blobCache: blobCache,\n      addFilter: addFilter,\n      uploadImages: uploadImages,\n      uploadImagesAuto: uploadImagesAuto,\n      scanForImages: scanForImages,\n      destroy: destroy\n    };\n  };\n\n  var get$a = function (dom) {\n    var formats = {\n      valigntop: [{\n        selector: 'td,th',\n        styles: {\n          verticalAlign: 'top'\n        }\n      }],\n      valignmiddle: [{\n        selector: 'td,th',\n        styles: {\n          verticalAlign: 'middle'\n        }\n      }],\n      valignbottom: [{\n        selector: 'td,th',\n        styles: {\n          verticalAlign: 'bottom'\n        }\n      }],\n      alignleft: [{\n        selector: 'figure.image',\n        collapsed: false,\n        classes: 'align-left',\n        ceFalseOverride: true,\n        preview: 'font-family font-size'\n      }, {\n        selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n        styles: {\n          textAlign: 'left'\n        },\n        inherit: false,\n        preview: false,\n        defaultBlock: 'div'\n      }, {\n        selector: 'img,table',\n        collapsed: false,\n        styles: {\n          float: 'left'\n        },\n        preview: 'font-family font-size'\n      }],\n      aligncenter: [{\n        selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n        styles: {\n          textAlign: 'center'\n        },\n        inherit: false,\n        preview: 'font-family font-size',\n        defaultBlock: 'div'\n      }, {\n        selector: 'figure.image',\n        collapsed: false,\n        classes: 'align-center',\n        ceFalseOverride: true,\n        preview: 'font-family font-size'\n      }, {\n        selector: 'img',\n        collapsed: false,\n        styles: {\n          display: 'block',\n          marginLeft: 'auto',\n          marginRight: 'auto'\n        },\n        preview: false\n      }, {\n        selector: 'table',\n        collapsed: false,\n        styles: {\n          marginLeft: 'auto',\n          marginRight: 'auto'\n        },\n        preview: 'font-family font-size'\n      }],\n      alignright: [{\n        selector: 'figure.image',\n        collapsed: false,\n        classes: 'align-right',\n        ceFalseOverride: true,\n        preview: 'font-family font-size'\n      }, {\n        selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n        styles: {\n          textAlign: 'right'\n        },\n        inherit: false,\n        preview: 'font-family font-size',\n        defaultBlock: 'div'\n      }, {\n        selector: 'img,table',\n        collapsed: false,\n        styles: {\n          float: 'right'\n        },\n        preview: 'font-family font-size'\n      }],\n      alignjustify: [{\n        selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n        styles: {\n          textAlign: 'justify'\n        },\n        inherit: false,\n        defaultBlock: 'div',\n        preview: 'font-family font-size'\n      }],\n      bold: [{\n        inline: 'strong',\n        remove: 'all',\n        preserve_attributes: ['class', 'style']\n      }, {\n        inline: 'span',\n        styles: {\n          fontWeight: 'bold'\n        }\n      }, {\n        inline: 'b',\n        remove: 'all',\n        preserve_attributes: ['class', 'style']\n      }],\n      italic: [{\n        inline: 'em',\n        remove: 'all',\n        preserve_attributes: ['class', 'style']\n      }, {\n        inline: 'span',\n        styles: {\n          fontStyle: 'italic'\n        }\n      }, {\n        inline: 'i',\n        remove: 'all',\n        preserve_attributes: ['class', 'style']\n      }],\n      underline: [{\n        inline: 'span',\n        styles: {\n          textDecoration: 'underline'\n        },\n        exact: true\n      }, {\n        inline: 'u',\n        remove: 'all',\n        preserve_attributes: ['class', 'style']\n      }],\n      strikethrough: [{\n        inline: 'span',\n        styles: {\n          textDecoration: 'line-through'\n        },\n        exact: true\n      }, {\n        inline: 'strike',\n        remove: 'all',\n        preserve_attributes: ['class', 'style']\n      }, {\n        inline: 's',\n        remove: 'all',\n        preserve_attributes: ['class', 'style']\n      }],\n      forecolor: {\n        inline: 'span',\n        styles: {\n          color: '%value'\n        },\n        links: true,\n        remove_similar: true,\n        clear_child_styles: true\n      },\n      hilitecolor: {\n        inline: 'span',\n        styles: {\n          backgroundColor: '%value'\n        },\n        links: true,\n        remove_similar: true,\n        clear_child_styles: true\n      },\n      fontname: {\n        inline: 'span',\n        toggle: false,\n        styles: {\n          fontFamily: '%value'\n        },\n        clear_child_styles: true\n      },\n      fontsize: {\n        inline: 'span',\n        toggle: false,\n        styles: {\n          fontSize: '%value'\n        },\n        clear_child_styles: true\n      },\n      lineheight: {\n        selector: 'h1,h2,h3,h4,h5,h6,p,li,td,th,div',\n        defaultBlock: 'p',\n        styles: {\n          lineHeight: '%value'\n        }\n      },\n      fontsize_class: {\n        inline: 'span',\n        attributes: {\n          class: '%value'\n        }\n      },\n      blockquote: {\n        block: 'blockquote',\n        wrapper: true,\n        remove: 'all'\n      },\n      subscript: {\n        inline: 'sub'\n      },\n      superscript: {\n        inline: 'sup'\n      },\n      code: {\n        inline: 'code'\n      },\n      link: {\n        inline: 'a',\n        selector: 'a',\n        remove: 'all',\n        split: true,\n        deep: true,\n        onmatch: function (node, _fmt, _itemName) {\n          return isElement$1(node) && node.hasAttribute('href');\n        },\n        onformat: function (elm, _fmt, vars) {\n          Tools.each(vars, function (value, key) {\n            dom.setAttrib(elm, key, value);\n          });\n        }\n      },\n      removeformat: [{\n        selector: 'b,strong,em,i,font,u,strike,s,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',\n        remove: 'all',\n        split: true,\n        expand: false,\n        block_expand: true,\n        deep: true\n      }, {\n        selector: 'span',\n        attributes: ['style', 'class'],\n        remove: 'empty',\n        split: true,\n        expand: false,\n        deep: true\n      }, {\n        selector: '*',\n        attributes: ['style', 'class'],\n        split: false,\n        expand: false,\n        deep: true\n      }]\n    };\n    Tools.each('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\\s/), function (name) {\n      formats[name] = {\n        block: name,\n        remove: 'all'\n      };\n    });\n    return formats;\n  };\n\n  function FormatRegistry(editor) {\n    var formats = {};\n\n    var get = function (name) {\n      return name ? formats[name] : formats;\n    };\n\n    var has$1 = function (name) {\n      return has(formats, name);\n    };\n\n    var register = function (name, format) {\n      if (name) {\n        if (typeof name !== 'string') {\n          Tools.each(name, function (format, name) {\n            register(name, format);\n          });\n        } else {\n          if (!isArray(format)) {\n            format = [format];\n          }\n\n          Tools.each(format, function (format) {\n            if (typeof format.deep === 'undefined') {\n              format.deep = !format.selector;\n            }\n\n            if (typeof format.split === 'undefined') {\n              format.split = !format.selector || format.inline;\n            }\n\n            if (typeof format.remove === 'undefined' && format.selector && !format.inline) {\n              format.remove = 'none';\n            }\n\n            if (format.selector && format.inline) {\n              format.mixed = true;\n              format.block_expand = true;\n            }\n\n            if (typeof format.classes === 'string') {\n              format.classes = format.classes.split(/\\s+/);\n            }\n          });\n          formats[name] = format;\n        }\n      }\n    };\n\n    var unregister = function (name) {\n      if (name && formats[name]) {\n        delete formats[name];\n      }\n\n      return formats;\n    };\n\n    register(get$a(editor.dom));\n    register(getFormats(editor));\n    return {\n      get: get,\n      has: has$1,\n      register: register,\n      unregister: unregister\n    };\n  }\n\n  var each$e = Tools.each;\n  var dom = DOMUtils$1.DOM;\n\n  var parsedSelectorToHtml = function (ancestry, editor) {\n    var elm, item, fragment;\n    var schema = editor && editor.schema || Schema({});\n\n    var decorate = function (elm, item) {\n      if (item.classes.length) {\n        dom.addClass(elm, item.classes.join(' '));\n      }\n\n      dom.setAttribs(elm, item.attrs);\n    };\n\n    var createElement = function (sItem) {\n      item = typeof sItem === 'string' ? {\n        name: sItem,\n        classes: [],\n        attrs: {}\n      } : sItem;\n      var elm = dom.create(item.name);\n      decorate(elm, item);\n      return elm;\n    };\n\n    var getRequiredParent = function (elm, candidate) {\n      var name = typeof elm !== 'string' ? elm.nodeName.toLowerCase() : elm;\n      var elmRule = schema.getElementRule(name);\n      var parentsRequired = elmRule && elmRule.parentsRequired;\n\n      if (parentsRequired && parentsRequired.length) {\n        return candidate && Tools.inArray(parentsRequired, candidate) !== -1 ? candidate : parentsRequired[0];\n      } else {\n        return false;\n      }\n    };\n\n    var wrapInHtml = function (elm, ancestry, siblings) {\n      var parent, parentCandidate;\n      var ancestor = ancestry.length > 0 && ancestry[0];\n      var ancestorName = ancestor && ancestor.name;\n      var parentRequired = getRequiredParent(elm, ancestorName);\n\n      if (parentRequired) {\n        if (ancestorName === parentRequired) {\n          parentCandidate = ancestry[0];\n          ancestry = ancestry.slice(1);\n        } else {\n          parentCandidate = parentRequired;\n        }\n      } else if (ancestor) {\n        parentCandidate = ancestry[0];\n        ancestry = ancestry.slice(1);\n      } else if (!siblings) {\n        return elm;\n      }\n\n      if (parentCandidate) {\n        parent = createElement(parentCandidate);\n        parent.appendChild(elm);\n      }\n\n      if (siblings) {\n        if (!parent) {\n          parent = dom.create('div');\n          parent.appendChild(elm);\n        }\n\n        Tools.each(siblings, function (sibling) {\n          var siblingElm = createElement(sibling);\n          parent.insertBefore(siblingElm, elm);\n        });\n      }\n\n      return wrapInHtml(parent, ancestry, parentCandidate && parentCandidate.siblings);\n    };\n\n    if (ancestry && ancestry.length) {\n      item = ancestry[0];\n      elm = createElement(item);\n      fragment = dom.create('div');\n      fragment.appendChild(wrapInHtml(elm, ancestry.slice(1), item.siblings));\n      return fragment;\n    } else {\n      return '';\n    }\n  };\n\n  var parseSelectorItem = function (item) {\n    var tagName;\n    var obj = {\n      classes: [],\n      attrs: {}\n    };\n    item = obj.selector = Tools.trim(item);\n\n    if (item !== '*') {\n      tagName = item.replace(/(?:([#\\.]|::?)([\\w\\-]+)|(\\[)([^\\]]+)\\]?)/g, function ($0, $1, $2, $3, $4) {\n        switch ($1) {\n          case '#':\n            obj.attrs.id = $2;\n            break;\n\n          case '.':\n            obj.classes.push($2);\n            break;\n\n          case ':':\n            if (Tools.inArray('checked disabled enabled read-only required'.split(' '), $2) !== -1) {\n              obj.attrs[$2] = $2;\n            }\n\n            break;\n        }\n\n        if ($3 === '[') {\n          var m = $4.match(/([\\w\\-]+)(?:\\=\\\"([^\\\"]+))?/);\n\n          if (m) {\n            obj.attrs[m[1]] = m[2];\n          }\n        }\n\n        return '';\n      });\n    }\n\n    obj.name = tagName || 'div';\n    return obj;\n  };\n\n  var parseSelector = function (selector) {\n    if (!selector || typeof selector !== 'string') {\n      return [];\n    }\n\n    selector = selector.split(/\\s*,\\s*/)[0];\n    selector = selector.replace(/\\s*(~\\+|~|\\+|>)\\s*/g, '$1');\n    return Tools.map(selector.split(/(?:>|\\s+(?![^\\[\\]]+\\]))/), function (item) {\n      var siblings = Tools.map(item.split(/(?:~\\+|~|\\+)/), parseSelectorItem);\n      var obj = siblings.pop();\n\n      if (siblings.length) {\n        obj.siblings = siblings;\n      }\n\n      return obj;\n    }).reverse();\n  };\n\n  var getCssText = function (editor, format) {\n    var name, previewFrag;\n    var previewCss = '',\n        parentFontSize;\n    var previewStyles = getPreviewStyles(editor);\n\n    if (previewStyles === '') {\n      return '';\n    }\n\n    var removeVars = function (val) {\n      return val.replace(/%(\\w+)/g, '');\n    };\n\n    if (typeof format === 'string') {\n      format = editor.formatter.get(format);\n\n      if (!format) {\n        return;\n      }\n\n      format = format[0];\n    }\n\n    if ('preview' in format) {\n      var previewOpt = get$1(format, 'preview');\n\n      if (previewOpt.is(false)) {\n        return '';\n      } else {\n        previewStyles = previewOpt.getOr(previewStyles);\n      }\n    }\n\n    name = format.block || format.inline || 'span';\n    var items = parseSelector(format.selector);\n\n    if (items.length) {\n      if (!items[0].name) {\n        items[0].name = name;\n      }\n\n      name = format.selector;\n      previewFrag = parsedSelectorToHtml(items, editor);\n    } else {\n      previewFrag = parsedSelectorToHtml([name], editor);\n    }\n\n    var previewElm = dom.select(name, previewFrag)[0] || previewFrag.firstChild;\n    each$e(format.styles, function (value, name) {\n      var newValue = removeVars(value);\n\n      if (newValue) {\n        dom.setStyle(previewElm, name, newValue);\n      }\n    });\n    each$e(format.attributes, function (value, name) {\n      var newValue = removeVars(value);\n\n      if (newValue) {\n        dom.setAttrib(previewElm, name, newValue);\n      }\n    });\n    each$e(format.classes, function (value) {\n      var newValue = removeVars(value);\n\n      if (!dom.hasClass(previewElm, newValue)) {\n        dom.addClass(previewElm, newValue);\n      }\n    });\n    editor.fire('PreviewFormats');\n    dom.setStyles(previewFrag, {\n      position: 'absolute',\n      left: -65535\n    });\n    editor.getBody().appendChild(previewFrag);\n    parentFontSize = dom.getStyle(editor.getBody(), 'fontSize', true);\n    parentFontSize = /px$/.test(parentFontSize) ? parseInt(parentFontSize, 10) : 0;\n    each$e(previewStyles.split(' '), function (name) {\n      var value = dom.getStyle(previewElm, name, true);\n\n      if (name === 'background-color' && /transparent|rgba\\s*\\([^)]+,\\s*0\\)/.test(value)) {\n        value = dom.getStyle(editor.getBody(), name, true);\n\n        if (dom.toHex(value).toLowerCase() === '#ffffff') {\n          return;\n        }\n      }\n\n      if (name === 'color') {\n        if (dom.toHex(value).toLowerCase() === '#000000') {\n          return;\n        }\n      }\n\n      if (name === 'font-size') {\n        if (/em|%$/.test(value)) {\n          if (parentFontSize === 0) {\n            return;\n          }\n\n          var numValue = parseFloat(value) / (/%$/.test(value) ? 100 : 1);\n          value = numValue * parentFontSize + 'px';\n        }\n      }\n\n      if (name === 'border' && value) {\n        previewCss += 'padding:0 2px;';\n      }\n\n      previewCss += name + ':' + value + ';';\n    });\n    editor.fire('AfterPreviewFormats');\n    dom.remove(previewFrag);\n    return previewCss;\n  };\n\n  var setup$6 = function (editor) {\n    editor.addShortcut('meta+b', '', 'Bold');\n    editor.addShortcut('meta+i', '', 'Italic');\n    editor.addShortcut('meta+u', '', 'Underline');\n\n    for (var i = 1; i <= 6; i++) {\n      editor.addShortcut('access+' + i, '', ['FormatBlock', false, 'h' + i]);\n    }\n\n    editor.addShortcut('access+7', '', ['FormatBlock', false, 'p']);\n    editor.addShortcut('access+8', '', ['FormatBlock', false, 'div']);\n    editor.addShortcut('access+9', '', ['FormatBlock', false, 'address']);\n  };\n\n  var Formatter = function (editor) {\n    var formats = FormatRegistry(editor);\n    var formatChangeState = Cell(null);\n    setup$6(editor);\n    setup$3(editor);\n    return {\n      get: formats.get,\n      has: formats.has,\n      register: formats.register,\n      unregister: formats.unregister,\n      apply: function (name, vars, node) {\n        applyFormat$1(editor, name, vars, node);\n      },\n      remove: function (name, vars, node, similar) {\n        removeFormat$1(editor, name, vars, node, similar);\n      },\n      toggle: function (name, vars, node) {\n        toggleFormat(editor, name, vars, node);\n      },\n      match: function (name, vars, node) {\n        return matchFormat(editor, name, vars, node);\n      },\n      closest: function (names) {\n        return closestFormat(editor, names);\n      },\n      matchAll: function (names, vars) {\n        return matchAllFormats(editor, names, vars);\n      },\n      matchNode: function (node, names, vars, similar) {\n        return matchNodeFormat(editor, node, names, vars, similar);\n      },\n      canApply: function (name) {\n        return canApplyFormat(editor, name);\n      },\n      formatChanged: function (formats, callback, similar) {\n        return formatChanged(editor, formatChangeState, formats, callback, similar);\n      },\n      getCssText: curry(getCssText, editor)\n    };\n  };\n\n  var registerEvents$1 = function (editor, undoManager, locks) {\n    var isFirstTypedCharacter = Cell(false);\n\n    var addNonTypingUndoLevel = function (e) {\n      setTyping(undoManager, false, locks);\n      undoManager.add({}, e);\n    };\n\n    editor.on('init', function () {\n      undoManager.add();\n    });\n    editor.on('BeforeExecCommand', function (e) {\n      var cmd = e.command.toLowerCase();\n\n      if (cmd !== 'undo' && cmd !== 'redo' && cmd !== 'mcerepaint') {\n        endTyping(undoManager, locks);\n        undoManager.beforeChange();\n      }\n    });\n    editor.on('ExecCommand', function (e) {\n      var cmd = e.command.toLowerCase();\n\n      if (cmd !== 'undo' && cmd !== 'redo' && cmd !== 'mcerepaint') {\n        addNonTypingUndoLevel(e);\n      }\n    });\n    editor.on('ObjectResizeStart cut', function () {\n      undoManager.beforeChange();\n    });\n    editor.on('SaveContent ObjectResized blur', addNonTypingUndoLevel);\n    editor.on('dragend', addNonTypingUndoLevel);\n    editor.on('keyup', function (e) {\n      var keyCode = e.keyCode;\n\n      if (e.isDefaultPrevented()) {\n        return;\n      }\n\n      if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45 || e.ctrlKey) {\n        addNonTypingUndoLevel();\n        editor.nodeChanged();\n      }\n\n      if (keyCode === 46 || keyCode === 8) {\n        editor.nodeChanged();\n      }\n\n      if (isFirstTypedCharacter.get() && undoManager.typing && isEq$4(createFromEditor(editor), undoManager.data[0]) === false) {\n        if (editor.isDirty() === false) {\n          editor.setDirty(true);\n          editor.fire('change', {\n            level: undoManager.data[0],\n            lastLevel: null\n          });\n        }\n\n        editor.fire('TypingUndo');\n        isFirstTypedCharacter.set(false);\n        editor.nodeChanged();\n      }\n    });\n    editor.on('keydown', function (e) {\n      var keyCode = e.keyCode;\n\n      if (e.isDefaultPrevented()) {\n        return;\n      }\n\n      if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45) {\n        if (undoManager.typing) {\n          addNonTypingUndoLevel(e);\n        }\n\n        return;\n      }\n\n      var modKey = e.ctrlKey && !e.altKey || e.metaKey;\n\n      if ((keyCode < 16 || keyCode > 20) && keyCode !== 224 && keyCode !== 91 && !undoManager.typing && !modKey) {\n        undoManager.beforeChange();\n        setTyping(undoManager, true, locks);\n        undoManager.add({}, e);\n        isFirstTypedCharacter.set(true);\n      }\n    });\n    editor.on('mousedown', function (e) {\n      if (undoManager.typing) {\n        addNonTypingUndoLevel(e);\n      }\n    });\n\n    var isInsertReplacementText = function (event) {\n      return event.inputType === 'insertReplacementText';\n    };\n\n    var isInsertTextDataNull = function (event) {\n      return event.inputType === 'insertText' && event.data === null;\n    };\n\n    var isInsertFromPasteOrDrop = function (event) {\n      return event.inputType === 'insertFromPaste' || event.inputType === 'insertFromDrop';\n    };\n\n    editor.on('input', function (e) {\n      if (e.inputType && (isInsertReplacementText(e) || isInsertTextDataNull(e) || isInsertFromPasteOrDrop(e))) {\n        addNonTypingUndoLevel(e);\n      }\n    });\n    editor.on('AddUndo Undo Redo ClearUndos', function (e) {\n      if (!e.isDefaultPrevented()) {\n        editor.nodeChanged();\n      }\n    });\n  };\n\n  var addKeyboardShortcuts = function (editor) {\n    editor.addShortcut('meta+z', '', 'Undo');\n    editor.addShortcut('meta+y,meta+shift+z', '', 'Redo');\n  };\n\n  var UndoManager = function (editor) {\n    var beforeBookmark = Cell(Optional.none());\n    var locks = Cell(0);\n    var index = Cell(0);\n    var undoManager = {\n      data: [],\n      typing: false,\n      beforeChange: function () {\n        beforeChange$1(editor, locks, beforeBookmark);\n      },\n      add: function (level, event) {\n        return addUndoLevel$1(editor, undoManager, index, locks, beforeBookmark, level, event);\n      },\n      undo: function () {\n        return undo$1(editor, undoManager, locks, index);\n      },\n      redo: function () {\n        return redo$1(editor, index, undoManager.data);\n      },\n      clear: function () {\n        clear$1(editor, undoManager, index);\n      },\n      reset: function () {\n        reset$1(editor, undoManager);\n      },\n      hasUndo: function () {\n        return hasUndo$1(editor, undoManager, index);\n      },\n      hasRedo: function () {\n        return hasRedo$1(editor, undoManager, index);\n      },\n      transact: function (callback) {\n        return transact$1(editor, undoManager, locks, callback);\n      },\n      ignore: function (callback) {\n        ignore$1(editor, locks, callback);\n      },\n      extra: function (callback1, callback2) {\n        extra$1(editor, undoManager, index, callback1, callback2);\n      }\n    };\n\n    if (!isRtc(editor)) {\n      registerEvents$1(editor, undoManager, locks);\n    }\n\n    addKeyboardShortcuts(editor);\n    return undoManager;\n  };\n\n  var nonTypingKeycodes = [9, 27, VK.HOME, VK.END, 19, 20, 44, 144, 145, 33, 34, 45, 16, 17, 18, 91, 92, 93, VK.DOWN, VK.UP, VK.LEFT, VK.RIGHT].concat(Env.browser.isFirefox() ? [224] : []);\n  var placeholderAttr = 'data-mce-placeholder';\n\n  var isKeyboardEvent = function (e) {\n    return e.type === 'keydown' || e.type === 'keyup';\n  };\n\n  var isDeleteEvent = function (e) {\n    var keyCode = e.keyCode;\n    return keyCode === VK.BACKSPACE || keyCode === VK.DELETE;\n  };\n\n  var isNonTypingKeyboardEvent = function (e) {\n    if (isKeyboardEvent(e)) {\n      var keyCode = e.keyCode;\n      return !isDeleteEvent(e) && (VK.metaKeyPressed(e) || e.altKey || keyCode >= 112 && keyCode <= 123 || contains(nonTypingKeycodes, keyCode));\n    } else {\n      return false;\n    }\n  };\n\n  var isTypingKeyboardEvent = function (e) {\n    return isKeyboardEvent(e) && !(isDeleteEvent(e) || e.type === 'keyup' && e.keyCode === 229);\n  };\n\n  var isVisuallyEmpty = function (dom, rootElm, forcedRootBlock) {\n    if (isEmpty(SugarElement.fromDom(rootElm), false)) {\n      var isForcedRootBlockFalse = forcedRootBlock === '';\n      var firstElement = rootElm.firstElementChild;\n\n      if (!firstElement) {\n        return true;\n      } else if (dom.getStyle(rootElm.firstElementChild, 'padding-left') || dom.getStyle(rootElm.firstElementChild, 'padding-right')) {\n        return false;\n      } else {\n        return isForcedRootBlockFalse ? !dom.isBlock(firstElement) : forcedRootBlock === firstElement.nodeName.toLowerCase();\n      }\n    } else {\n      return false;\n    }\n  };\n\n  var setup$7 = function (editor) {\n    var dom = editor.dom;\n    var rootBlock = getForcedRootBlock(editor);\n    var placeholder = getPlaceholder(editor);\n\n    var updatePlaceholder = function (e, initial) {\n      if (isNonTypingKeyboardEvent(e)) {\n        return;\n      }\n\n      var body = editor.getBody();\n      var showPlaceholder = isTypingKeyboardEvent(e) ? false : isVisuallyEmpty(dom, body, rootBlock);\n      var isPlaceholderShown = dom.getAttrib(body, placeholderAttr) !== '';\n\n      if (isPlaceholderShown !== showPlaceholder || initial) {\n        dom.setAttrib(body, placeholderAttr, showPlaceholder ? placeholder : null);\n        dom.setAttrib(body, 'aria-placeholder', showPlaceholder ? placeholder : null);\n        firePlaceholderToggle(editor, showPlaceholder);\n        editor.on(showPlaceholder ? 'keydown' : 'keyup', updatePlaceholder);\n        editor.off(showPlaceholder ? 'keyup' : 'keydown', updatePlaceholder);\n      }\n    };\n\n    if (placeholder) {\n      editor.on('init', function (e) {\n        updatePlaceholder(e, true);\n        editor.on('change SetContent ExecCommand', updatePlaceholder);\n        editor.on('paste', function (e) {\n          return Delay.setEditorTimeout(editor, function () {\n            return updatePlaceholder(e);\n          });\n        });\n      });\n    }\n  };\n\n  var strongRtl = /[\\u0591-\\u07FF\\uFB1D-\\uFDFF\\uFE70-\\uFEFC]/;\n\n  var hasStrongRtl = function (text) {\n    return strongRtl.test(text);\n  };\n\n  var isInlineTarget = function (editor, elm) {\n    return is$1(SugarElement.fromDom(elm), getInlineBoundarySelector(editor));\n  };\n\n  var isRtl$1 = function (element) {\n    return DOMUtils$1.DOM.getStyle(element, 'direction', true) === 'rtl' || hasStrongRtl(element.textContent);\n  };\n\n  var findInlineParents = function (isInlineTarget, rootNode, pos) {\n    return filter(DOMUtils$1.DOM.getParents(pos.container(), '*', rootNode), isInlineTarget);\n  };\n\n  var findRootInline = function (isInlineTarget, rootNode, pos) {\n    var parents = findInlineParents(isInlineTarget, rootNode, pos);\n    return Optional.from(parents[parents.length - 1]);\n  };\n\n  var hasSameParentBlock = function (rootNode, node1, node2) {\n    var block1 = getParentBlock(node1, rootNode);\n    var block2 = getParentBlock(node2, rootNode);\n    return block1 && block1 === block2;\n  };\n\n  var isAtZwsp = function (pos) {\n    return isBeforeInline(pos) || isAfterInline(pos);\n  };\n\n  var normalizePosition = function (forward, pos) {\n    if (!pos) {\n      return pos;\n    }\n\n    var container = pos.container(),\n        offset = pos.offset();\n\n    if (forward) {\n      if (isCaretContainerInline(container)) {\n        if (isText$1(container.nextSibling)) {\n          return CaretPosition$1(container.nextSibling, 0);\n        } else {\n          return CaretPosition$1.after(container);\n        }\n      } else {\n        return isBeforeInline(pos) ? CaretPosition$1(container, offset + 1) : pos;\n      }\n    } else {\n      if (isCaretContainerInline(container)) {\n        if (isText$1(container.previousSibling)) {\n          return CaretPosition$1(container.previousSibling, container.previousSibling.data.length);\n        } else {\n          return CaretPosition$1.before(container);\n        }\n      } else {\n        return isAfterInline(pos) ? CaretPosition$1(container, offset - 1) : pos;\n      }\n    }\n  };\n\n  var normalizeForwards = curry(normalizePosition, true);\n  var normalizeBackwards = curry(normalizePosition, false);\n\n  var isBeforeRoot = function (rootNode) {\n    return function (elm) {\n      return eq$2(rootNode, SugarElement.fromDom(elm.dom.parentNode));\n    };\n  };\n\n  var getParentBlock$1 = function (rootNode, elm) {\n    return contains$2(rootNode, elm) ? closest(elm, function (element) {\n      return isTextBlock(element) || isListItem(element);\n    }, isBeforeRoot(rootNode)) : Optional.none();\n  };\n\n  var placeCaretInEmptyBody = function (editor) {\n    var body = editor.getBody();\n    var node = body.firstChild && editor.dom.isBlock(body.firstChild) ? body.firstChild : body;\n    editor.selection.setCursorLocation(node, 0);\n  };\n\n  var paddEmptyBody = function (editor) {\n    if (editor.dom.isEmpty(editor.getBody())) {\n      editor.setContent('');\n      placeCaretInEmptyBody(editor);\n    }\n  };\n\n  var willDeleteLastPositionInElement = function (forward, fromPos, elm) {\n    return lift2(firstPositionIn(elm), lastPositionIn(elm), function (firstPos, lastPos) {\n      var normalizedFirstPos = normalizePosition(true, firstPos);\n      var normalizedLastPos = normalizePosition(false, lastPos);\n      var normalizedFromPos = normalizePosition(false, fromPos);\n\n      if (forward) {\n        return nextPosition(elm, normalizedFromPos).exists(function (nextPos) {\n          return nextPos.isEqual(normalizedLastPos) && fromPos.isEqual(normalizedFirstPos);\n        });\n      } else {\n        return prevPosition(elm, normalizedFromPos).exists(function (prevPos) {\n          return prevPos.isEqual(normalizedFirstPos) && fromPos.isEqual(normalizedLastPos);\n        });\n      }\n    }).getOr(true);\n  };\n\n  var blockPosition = function (block, position) {\n    return {\n      block: block,\n      position: position\n    };\n  };\n\n  var blockBoundary = function (from, to) {\n    return {\n      from: from,\n      to: to\n    };\n  };\n\n  var getBlockPosition = function (rootNode, pos) {\n    var rootElm = SugarElement.fromDom(rootNode);\n    var containerElm = SugarElement.fromDom(pos.container());\n    return getParentBlock$1(rootElm, containerElm).map(function (block) {\n      return blockPosition(block, pos);\n    });\n  };\n\n  var isDifferentBlocks = function (blockBoundary) {\n    return eq$2(blockBoundary.from.block, blockBoundary.to.block) === false;\n  };\n\n  var hasSameParent = function (blockBoundary) {\n    return parent(blockBoundary.from.block).bind(function (parent1) {\n      return parent(blockBoundary.to.block).filter(function (parent2) {\n        return eq$2(parent1, parent2);\n      });\n    }).isSome();\n  };\n\n  var isEditable = function (blockBoundary) {\n    return isContentEditableFalse(blockBoundary.from.block.dom) === false && isContentEditableFalse(blockBoundary.to.block.dom) === false;\n  };\n\n  var skipLastBr = function (rootNode, forward, blockPosition) {\n    if (isBr(blockPosition.position.getNode()) && isEmpty(blockPosition.block) === false) {\n      return positionIn(false, blockPosition.block.dom).bind(function (lastPositionInBlock) {\n        if (lastPositionInBlock.isEqual(blockPosition.position)) {\n          return fromPosition(forward, rootNode, lastPositionInBlock).bind(function (to) {\n            return getBlockPosition(rootNode, to);\n          });\n        } else {\n          return Optional.some(blockPosition);\n        }\n      }).getOr(blockPosition);\n    } else {\n      return blockPosition;\n    }\n  };\n\n  var readFromRange = function (rootNode, forward, rng) {\n    var fromBlockPos = getBlockPosition(rootNode, CaretPosition$1.fromRangeStart(rng));\n    var toBlockPos = fromBlockPos.bind(function (blockPos) {\n      return fromPosition(forward, rootNode, blockPos.position).bind(function (to) {\n        return getBlockPosition(rootNode, to).map(function (blockPos) {\n          return skipLastBr(rootNode, forward, blockPos);\n        });\n      });\n    });\n    return lift2(fromBlockPos, toBlockPos, blockBoundary).filter(function (blockBoundary) {\n      return isDifferentBlocks(blockBoundary) && hasSameParent(blockBoundary) && isEditable(blockBoundary);\n    });\n  };\n\n  var read$3 = function (rootNode, forward, rng) {\n    return rng.collapsed ? readFromRange(rootNode, forward, rng) : Optional.none();\n  };\n\n  var getChildrenUntilBlockBoundary = function (block) {\n    var children$1 = children(block);\n    return findIndex(children$1, isBlock).fold(function () {\n      return children$1;\n    }, function (index) {\n      return children$1.slice(0, index);\n    });\n  };\n\n  var extractChildren = function (block) {\n    var children = getChildrenUntilBlockBoundary(block);\n    each(children, remove);\n    return children;\n  };\n\n  var removeEmptyRoot = function (rootNode, block) {\n    var parents = parentsAndSelf(block, rootNode);\n    return find(parents.reverse(), function (element) {\n      return isEmpty(element);\n    }).each(remove);\n  };\n\n  var isEmptyBefore = function (el) {\n    return filter(prevSiblings(el), function (el) {\n      return !isEmpty(el);\n    }).length === 0;\n  };\n\n  var nestedBlockMerge = function (rootNode, fromBlock, toBlock, insertionPoint) {\n    if (isEmpty(toBlock)) {\n      fillWithPaddingBr(toBlock);\n      return firstPositionIn(toBlock.dom);\n    }\n\n    if (isEmptyBefore(insertionPoint) && isEmpty(fromBlock)) {\n      before(insertionPoint, SugarElement.fromTag('br'));\n    }\n\n    var position = prevPosition(toBlock.dom, CaretPosition$1.before(insertionPoint.dom));\n    each(extractChildren(fromBlock), function (child) {\n      before(insertionPoint, child);\n    });\n    removeEmptyRoot(rootNode, fromBlock);\n    return position;\n  };\n\n  var sidelongBlockMerge = function (rootNode, fromBlock, toBlock) {\n    if (isEmpty(toBlock)) {\n      remove(toBlock);\n\n      if (isEmpty(fromBlock)) {\n        fillWithPaddingBr(fromBlock);\n      }\n\n      return firstPositionIn(fromBlock.dom);\n    }\n\n    var position = lastPositionIn(toBlock.dom);\n    each(extractChildren(fromBlock), function (child) {\n      append(toBlock, child);\n    });\n    removeEmptyRoot(rootNode, fromBlock);\n    return position;\n  };\n\n  var findInsertionPoint = function (toBlock, block) {\n    var parentsAndSelf$1 = parentsAndSelf(block, toBlock);\n    return Optional.from(parentsAndSelf$1[parentsAndSelf$1.length - 1]);\n  };\n\n  var getInsertionPoint = function (fromBlock, toBlock) {\n    return contains$2(toBlock, fromBlock) ? findInsertionPoint(toBlock, fromBlock) : Optional.none();\n  };\n\n  var trimBr = function (first, block) {\n    positionIn(first, block.dom).map(function (position) {\n      return position.getNode();\n    }).map(SugarElement.fromDom).filter(isBr$1).each(remove);\n  };\n\n  var mergeBlockInto = function (rootNode, fromBlock, toBlock) {\n    trimBr(true, fromBlock);\n    trimBr(false, toBlock);\n    return getInsertionPoint(fromBlock, toBlock).fold(curry(sidelongBlockMerge, rootNode, fromBlock, toBlock), curry(nestedBlockMerge, rootNode, fromBlock, toBlock));\n  };\n\n  var mergeBlocks = function (rootNode, forward, block1, block2) {\n    return forward ? mergeBlockInto(rootNode, block2, block1) : mergeBlockInto(rootNode, block1, block2);\n  };\n\n  var backspaceDelete$1 = function (editor, forward) {\n    var rootNode = SugarElement.fromDom(editor.getBody());\n    var position = read$3(rootNode.dom, forward, editor.selection.getRng()).bind(function (blockBoundary) {\n      return mergeBlocks(rootNode, forward, blockBoundary.from.block, blockBoundary.to.block);\n    });\n    position.each(function (pos) {\n      editor.selection.setRng(pos.toRange());\n    });\n    return position.isSome();\n  };\n\n  var deleteRangeMergeBlocks = function (rootNode, selection) {\n    var rng = selection.getRng();\n    return lift2(getParentBlock$1(rootNode, SugarElement.fromDom(rng.startContainer)), getParentBlock$1(rootNode, SugarElement.fromDom(rng.endContainer)), function (block1, block2) {\n      if (eq$2(block1, block2) === false) {\n        rng.deleteContents();\n        mergeBlocks(rootNode, true, block1, block2).each(function (pos) {\n          selection.setRng(pos.toRange());\n        });\n        return true;\n      } else {\n        return false;\n      }\n    }).getOr(false);\n  };\n\n  var isRawNodeInTable = function (root, rawNode) {\n    var node = SugarElement.fromDom(rawNode);\n    var isRoot = curry(eq$2, root);\n    return ancestor(node, isTableCell$1, isRoot).isSome();\n  };\n\n  var isSelectionInTable = function (root, rng) {\n    return isRawNodeInTable(root, rng.startContainer) || isRawNodeInTable(root, rng.endContainer);\n  };\n\n  var isEverythingSelected = function (root, rng) {\n    var noPrevious = prevPosition(root.dom, CaretPosition$1.fromRangeStart(rng)).isNone();\n    var noNext = nextPosition(root.dom, CaretPosition$1.fromRangeEnd(rng)).isNone();\n    return !isSelectionInTable(root, rng) && noPrevious && noNext;\n  };\n\n  var emptyEditor = function (editor) {\n    editor.setContent('');\n    editor.selection.setCursorLocation();\n    return true;\n  };\n\n  var deleteRange$1 = function (editor) {\n    var rootNode = SugarElement.fromDom(editor.getBody());\n    var rng = editor.selection.getRng();\n    return isEverythingSelected(rootNode, rng) ? emptyEditor(editor) : deleteRangeMergeBlocks(rootNode, editor.selection);\n  };\n\n  var backspaceDelete$2 = function (editor, _forward) {\n    return editor.selection.isCollapsed() ? false : deleteRange$1(editor);\n  };\n\n  var isContentEditableTrue$2 = isContentEditableTrue;\n  var isContentEditableFalse$7 = isContentEditableFalse;\n\n  var showCaret = function (direction, editor, node, before, scrollIntoView) {\n    return Optional.from(editor._selectionOverrides.showCaret(direction, node, before, scrollIntoView));\n  };\n\n  var getNodeRange = function (node) {\n    var rng = node.ownerDocument.createRange();\n    rng.selectNode(node);\n    return rng;\n  };\n\n  var selectNode = function (editor, node) {\n    var e = editor.fire('BeforeObjectSelected', {\n      target: node\n    });\n\n    if (e.isDefaultPrevented()) {\n      return Optional.none();\n    }\n\n    return Optional.some(getNodeRange(node));\n  };\n\n  var renderCaretAtRange = function (editor, range, scrollIntoView) {\n    var normalizedRange = normalizeRange(1, editor.getBody(), range);\n    var caretPosition = CaretPosition$1.fromRangeStart(normalizedRange);\n    var caretPositionNode = caretPosition.getNode();\n\n    if (isInlineFakeCaretTarget(caretPositionNode)) {\n      return showCaret(1, editor, caretPositionNode, !caretPosition.isAtEnd(), false);\n    }\n\n    var caretPositionBeforeNode = caretPosition.getNode(true);\n\n    if (isInlineFakeCaretTarget(caretPositionBeforeNode)) {\n      return showCaret(1, editor, caretPositionBeforeNode, false, false);\n    }\n\n    var ceRoot = editor.dom.getParent(caretPosition.getNode(), function (node) {\n      return isContentEditableFalse$7(node) || isContentEditableTrue$2(node);\n    });\n\n    if (isInlineFakeCaretTarget(ceRoot)) {\n      return showCaret(1, editor, ceRoot, false, scrollIntoView);\n    }\n\n    return Optional.none();\n  };\n\n  var renderRangeCaret = function (editor, range, scrollIntoView) {\n    return range.collapsed ? renderCaretAtRange(editor, range, scrollIntoView).getOr(range) : range;\n  };\n\n  var isBeforeBoundary = function (pos) {\n    return isBeforeContentEditableFalse(pos) || isBeforeMedia(pos);\n  };\n\n  var isAfterBoundary = function (pos) {\n    return isAfterContentEditableFalse(pos) || isAfterMedia(pos);\n  };\n\n  var trimEmptyTextNode$1 = function (dom, node) {\n    if (isText$1(node) && node.data.length === 0) {\n      dom.remove(node);\n    }\n  };\n\n  var deleteContentAndShowCaret = function (editor, range, node, direction, forward, peekCaretPosition) {\n    showCaret(direction, editor, peekCaretPosition.getNode(!forward), forward, true).each(function (caretRange) {\n      if (range.collapsed) {\n        var deleteRange = range.cloneRange();\n\n        if (forward) {\n          deleteRange.setEnd(caretRange.startContainer, caretRange.startOffset);\n        } else {\n          deleteRange.setStart(caretRange.endContainer, caretRange.endOffset);\n        }\n\n        deleteRange.deleteContents();\n      } else {\n        range.deleteContents();\n      }\n\n      editor.selection.setRng(caretRange);\n    });\n    trimEmptyTextNode$1(editor.dom, node);\n    return true;\n  };\n\n  var deleteBoundaryText = function (editor, forward) {\n    var range = editor.selection.getRng();\n\n    if (!isText$1(range.commonAncestorContainer)) {\n      return false;\n    }\n\n    var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n    var caretWalker = CaretWalker(editor.getBody());\n    var getNextPosFn = curry(getVisualCaretPosition, forward ? caretWalker.next : caretWalker.prev);\n    var isBeforeFn = forward ? isBeforeBoundary : isAfterBoundary;\n    var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n    var nextCaretPosition = normalizePosition(forward, getNextPosFn(caretPosition));\n\n    if (!nextCaretPosition || !isMoveInsideSameBlock(caretPosition, nextCaretPosition)) {\n      return false;\n    } else if (isBeforeFn(nextCaretPosition)) {\n      return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, nextCaretPosition);\n    }\n\n    var peekCaretPosition = getNextPosFn(nextCaretPosition);\n\n    if (peekCaretPosition && isBeforeFn(peekCaretPosition)) {\n      if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\n        return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, peekCaretPosition);\n      }\n    }\n\n    return false;\n  };\n\n  var backspaceDelete$3 = function (editor, forward) {\n    return deleteBoundaryText(editor, forward);\n  };\n\n  var isCompoundElement = function (node) {\n    return isTableCell$1(SugarElement.fromDom(node)) || isListItem(SugarElement.fromDom(node));\n  };\n\n  var DeleteAction = Adt.generate([{\n    remove: ['element']\n  }, {\n    moveToElement: ['element']\n  }, {\n    moveToPosition: ['position']\n  }]);\n\n  var isAtContentEditableBlockCaret = function (forward, from) {\n    var elm = from.getNode(forward === false);\n    var caretLocation = forward ? 'after' : 'before';\n    return isElement$1(elm) && elm.getAttribute('data-mce-caret') === caretLocation;\n  };\n\n  var isDeleteFromCefDifferentBlocks = function (root, forward, from, to) {\n    var inSameBlock = function (elm) {\n      return isInline(SugarElement.fromDom(elm)) && !isInSameBlock(from, to, root);\n    };\n\n    return getRelativeCefElm(!forward, from).fold(function () {\n      return getRelativeCefElm(forward, to).fold(never, inSameBlock);\n    }, inSameBlock);\n  };\n\n  var deleteEmptyBlockOrMoveToCef = function (root, forward, from, to) {\n    var toCefElm = to.getNode(forward === false);\n    return getParentBlock$1(SugarElement.fromDom(root), SugarElement.fromDom(from.getNode())).map(function (blockElm) {\n      return isEmpty(blockElm) ? DeleteAction.remove(blockElm.dom) : DeleteAction.moveToElement(toCefElm);\n    }).orThunk(function () {\n      return Optional.some(DeleteAction.moveToElement(toCefElm));\n    });\n  };\n\n  var findCefPosition = function (root, forward, from) {\n    return fromPosition(forward, root, from).bind(function (to) {\n      if (isCompoundElement(to.getNode())) {\n        return Optional.none();\n      } else if (isDeleteFromCefDifferentBlocks(root, forward, from, to)) {\n        return Optional.none();\n      } else if (forward && isContentEditableFalse(to.getNode())) {\n        return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\n      } else if (forward === false && isContentEditableFalse(to.getNode(true))) {\n        return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\n      } else if (forward && isAfterContentEditableFalse(from)) {\n        return Optional.some(DeleteAction.moveToPosition(to));\n      } else if (forward === false && isBeforeContentEditableFalse(from)) {\n        return Optional.some(DeleteAction.moveToPosition(to));\n      } else {\n        return Optional.none();\n      }\n    });\n  };\n\n  var getContentEditableBlockAction = function (forward, elm) {\n    if (forward && isContentEditableFalse(elm.nextSibling)) {\n      return Optional.some(DeleteAction.moveToElement(elm.nextSibling));\n    } else if (forward === false && isContentEditableFalse(elm.previousSibling)) {\n      return Optional.some(DeleteAction.moveToElement(elm.previousSibling));\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var skipMoveToActionFromInlineCefToContent = function (root, from, deleteAction) {\n    return deleteAction.fold(function (elm) {\n      return Optional.some(DeleteAction.remove(elm));\n    }, function (elm) {\n      return Optional.some(DeleteAction.moveToElement(elm));\n    }, function (to) {\n      if (isInSameBlock(from, to, root)) {\n        return Optional.none();\n      } else {\n        return Optional.some(DeleteAction.moveToPosition(to));\n      }\n    });\n  };\n\n  var getContentEditableAction = function (root, forward, from) {\n    if (isAtContentEditableBlockCaret(forward, from)) {\n      return getContentEditableBlockAction(forward, from.getNode(forward === false)).fold(function () {\n        return findCefPosition(root, forward, from);\n      }, Optional.some);\n    } else {\n      return findCefPosition(root, forward, from).bind(function (deleteAction) {\n        return skipMoveToActionFromInlineCefToContent(root, from, deleteAction);\n      });\n    }\n  };\n\n  var read$4 = function (root, forward, rng) {\n    var normalizedRange = normalizeRange(forward ? 1 : -1, root, rng);\n    var from = CaretPosition$1.fromRangeStart(normalizedRange);\n    var rootElement = SugarElement.fromDom(root);\n\n    if (forward === false && isAfterContentEditableFalse(from)) {\n      return Optional.some(DeleteAction.remove(from.getNode(true)));\n    } else if (forward && isBeforeContentEditableFalse(from)) {\n      return Optional.some(DeleteAction.remove(from.getNode()));\n    } else if (forward === false && isBeforeContentEditableFalse(from) && isAfterBr(rootElement, from)) {\n      return findPreviousBr(rootElement, from).map(function (br) {\n        return DeleteAction.remove(br.getNode());\n      });\n    } else if (forward && isAfterContentEditableFalse(from) && isBeforeBr(rootElement, from)) {\n      return findNextBr(rootElement, from).map(function (br) {\n        return DeleteAction.remove(br.getNode());\n      });\n    } else {\n      return getContentEditableAction(root, forward, from);\n    }\n  };\n\n  var deleteElement$1 = function (editor, forward) {\n    return function (element) {\n      editor._selectionOverrides.hideFakeCaret();\n\n      deleteElement(editor, forward, SugarElement.fromDom(element));\n      return true;\n    };\n  };\n\n  var moveToElement = function (editor, forward) {\n    return function (element) {\n      var pos = forward ? CaretPosition$1.before(element) : CaretPosition$1.after(element);\n      editor.selection.setRng(pos.toRange());\n      return true;\n    };\n  };\n\n  var moveToPosition = function (editor) {\n    return function (pos) {\n      editor.selection.setRng(pos.toRange());\n      return true;\n    };\n  };\n\n  var getAncestorCe = function (editor, node) {\n    return Optional.from(getContentEditableRoot(editor.getBody(), node));\n  };\n\n  var backspaceDeleteCaret = function (editor, forward) {\n    var selectedNode = editor.selection.getNode();\n    return getAncestorCe(editor, selectedNode).filter(isContentEditableFalse).fold(function () {\n      return read$4(editor.getBody(), forward, editor.selection.getRng()).exists(function (deleteAction) {\n        return deleteAction.fold(deleteElement$1(editor, forward), moveToElement(editor, forward), moveToPosition(editor));\n      });\n    }, always);\n  };\n\n  var deleteOffscreenSelection = function (rootElement) {\n    each(descendants$1(rootElement, '.mce-offscreen-selection'), remove);\n  };\n\n  var backspaceDeleteRange = function (editor, forward) {\n    var selectedNode = editor.selection.getNode();\n\n    if (isContentEditableFalse(selectedNode)) {\n      var hasCefAncestor = getAncestorCe(editor, selectedNode.parentNode).filter(isContentEditableFalse);\n      return hasCefAncestor.fold(function () {\n        deleteOffscreenSelection(SugarElement.fromDom(editor.getBody()));\n        deleteElement(editor, forward, SugarElement.fromDom(editor.selection.getNode()));\n        paddEmptyBody(editor);\n        return true;\n      }, function () {\n        return true;\n      });\n    }\n\n    return false;\n  };\n\n  var paddEmptyElement = function (editor) {\n    var dom = editor.dom,\n        selection = editor.selection;\n    var ceRoot = getContentEditableRoot(editor.getBody(), selection.getNode());\n\n    if (isContentEditableTrue(ceRoot) && dom.isBlock(ceRoot) && dom.isEmpty(ceRoot)) {\n      var br = dom.create('br', {\n        'data-mce-bogus': '1'\n      });\n      dom.setHTML(ceRoot, '');\n      ceRoot.appendChild(br);\n      selection.setRng(CaretPosition$1.before(br).toRange());\n    }\n\n    return true;\n  };\n\n  var backspaceDelete$4 = function (editor, forward) {\n    if (editor.selection.isCollapsed()) {\n      return backspaceDeleteCaret(editor, forward);\n    } else {\n      return backspaceDeleteRange(editor, forward);\n    }\n  };\n\n  var deleteCaret$1 = function (editor, forward) {\n    var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    return fromPosition(forward, editor.getBody(), fromPos).filter(function (pos) {\n      return forward ? isBeforeImageBlock(pos) : isAfterImageBlock(pos);\n    }).bind(function (pos) {\n      return Optional.from(getChildNodeAtRelativeOffset(forward ? 0 : -1, pos));\n    }).exists(function (elm) {\n      editor.selection.select(elm);\n      return true;\n    });\n  };\n\n  var backspaceDelete$5 = function (editor, forward) {\n    return editor.selection.isCollapsed() ? deleteCaret$1(editor, forward) : false;\n  };\n\n  var isText$8 = isText$1;\n\n  var startsWithCaretContainer$1 = function (node) {\n    return isText$8(node) && node.data[0] === ZWSP;\n  };\n\n  var endsWithCaretContainer$1 = function (node) {\n    return isText$8(node) && node.data[node.data.length - 1] === ZWSP;\n  };\n\n  var createZwsp = function (node) {\n    return node.ownerDocument.createTextNode(ZWSP);\n  };\n\n  var insertBefore$1 = function (node) {\n    if (isText$8(node.previousSibling)) {\n      if (endsWithCaretContainer$1(node.previousSibling)) {\n        return node.previousSibling;\n      } else {\n        node.previousSibling.appendData(ZWSP);\n        return node.previousSibling;\n      }\n    } else if (isText$8(node)) {\n      if (startsWithCaretContainer$1(node)) {\n        return node;\n      } else {\n        node.insertData(0, ZWSP);\n        return node;\n      }\n    } else {\n      var newNode = createZwsp(node);\n      node.parentNode.insertBefore(newNode, node);\n      return newNode;\n    }\n  };\n\n  var insertAfter$1 = function (node) {\n    if (isText$8(node.nextSibling)) {\n      if (startsWithCaretContainer$1(node.nextSibling)) {\n        return node.nextSibling;\n      } else {\n        node.nextSibling.insertData(0, ZWSP);\n        return node.nextSibling;\n      }\n    } else if (isText$8(node)) {\n      if (endsWithCaretContainer$1(node)) {\n        return node;\n      } else {\n        node.appendData(ZWSP);\n        return node;\n      }\n    } else {\n      var newNode = createZwsp(node);\n\n      if (node.nextSibling) {\n        node.parentNode.insertBefore(newNode, node.nextSibling);\n      } else {\n        node.parentNode.appendChild(newNode);\n      }\n\n      return newNode;\n    }\n  };\n\n  var insertInline$1 = function (before, node) {\n    return before ? insertBefore$1(node) : insertAfter$1(node);\n  };\n\n  var insertInlineBefore = curry(insertInline$1, true);\n  var insertInlineAfter = curry(insertInline$1, false);\n\n  var insertInlinePos = function (pos, before) {\n    if (isText$1(pos.container())) {\n      return insertInline$1(before, pos.container());\n    } else {\n      return insertInline$1(before, pos.getNode());\n    }\n  };\n\n  var isPosCaretContainer = function (pos, caret) {\n    var caretNode = caret.get();\n    return caretNode && pos.container() === caretNode && isCaretContainerInline(caretNode);\n  };\n\n  var renderCaret = function (caret, location) {\n    return location.fold(function (element) {\n      remove$5(caret.get());\n      var text = insertInlineBefore(element);\n      caret.set(text);\n      return Optional.some(CaretPosition$1(text, text.length - 1));\n    }, function (element) {\n      return firstPositionIn(element).map(function (pos) {\n        if (!isPosCaretContainer(pos, caret)) {\n          remove$5(caret.get());\n          var text = insertInlinePos(pos, true);\n          caret.set(text);\n          return CaretPosition$1(text, 1);\n        } else {\n          return CaretPosition$1(caret.get(), 1);\n        }\n      });\n    }, function (element) {\n      return lastPositionIn(element).map(function (pos) {\n        if (!isPosCaretContainer(pos, caret)) {\n          remove$5(caret.get());\n          var text = insertInlinePos(pos, false);\n          caret.set(text);\n          return CaretPosition$1(text, text.length - 1);\n        } else {\n          return CaretPosition$1(caret.get(), caret.get().length - 1);\n        }\n      });\n    }, function (element) {\n      remove$5(caret.get());\n      var text = insertInlineAfter(element);\n      caret.set(text);\n      return Optional.some(CaretPosition$1(text, 1));\n    });\n  };\n\n  var evaluateUntil = function (fns, args) {\n    for (var i = 0; i < fns.length; i++) {\n      var result = fns[i].apply(null, args);\n\n      if (result.isSome()) {\n        return result;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var Location = Adt.generate([{\n    before: ['element']\n  }, {\n    start: ['element']\n  }, {\n    end: ['element']\n  }, {\n    after: ['element']\n  }]);\n\n  var rescope = function (rootNode, node) {\n    var parentBlock = getParentBlock(node, rootNode);\n    return parentBlock ? parentBlock : rootNode;\n  };\n\n  var before$4 = function (isInlineTarget, rootNode, pos) {\n    var nPos = normalizeForwards(pos);\n    var scope = rescope(rootNode, nPos.container());\n    return findRootInline(isInlineTarget, scope, nPos).fold(function () {\n      return nextPosition(scope, nPos).bind(curry(findRootInline, isInlineTarget, scope)).map(function (inline) {\n        return Location.before(inline);\n      });\n    }, Optional.none);\n  };\n\n  var isNotInsideFormatCaretContainer = function (rootNode, elm) {\n    return getParentCaretContainer(rootNode, elm) === null;\n  };\n\n  var findInsideRootInline = function (isInlineTarget, rootNode, pos) {\n    return findRootInline(isInlineTarget, rootNode, pos).filter(curry(isNotInsideFormatCaretContainer, rootNode));\n  };\n\n  var start = function (isInlineTarget, rootNode, pos) {\n    var nPos = normalizeBackwards(pos);\n    return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\n      var prevPos = prevPosition(inline, nPos);\n      return prevPos.isNone() ? Optional.some(Location.start(inline)) : Optional.none();\n    });\n  };\n\n  var end = function (isInlineTarget, rootNode, pos) {\n    var nPos = normalizeForwards(pos);\n    return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\n      var nextPos = nextPosition(inline, nPos);\n      return nextPos.isNone() ? Optional.some(Location.end(inline)) : Optional.none();\n    });\n  };\n\n  var after$3 = function (isInlineTarget, rootNode, pos) {\n    var nPos = normalizeBackwards(pos);\n    var scope = rescope(rootNode, nPos.container());\n    return findRootInline(isInlineTarget, scope, nPos).fold(function () {\n      return prevPosition(scope, nPos).bind(curry(findRootInline, isInlineTarget, scope)).map(function (inline) {\n        return Location.after(inline);\n      });\n    }, Optional.none);\n  };\n\n  var isValidLocation = function (location) {\n    return isRtl$1(getElement(location)) === false;\n  };\n\n  var readLocation = function (isInlineTarget, rootNode, pos) {\n    var location = evaluateUntil([before$4, start, end, after$3], [isInlineTarget, rootNode, pos]);\n    return location.filter(isValidLocation);\n  };\n\n  var getElement = function (location) {\n    return location.fold(identity, identity, identity, identity);\n  };\n\n  var getName = function (location) {\n    return location.fold(constant('before'), constant('start'), constant('end'), constant('after'));\n  };\n\n  var outside = function (location) {\n    return location.fold(Location.before, Location.before, Location.after, Location.after);\n  };\n\n  var inside = function (location) {\n    return location.fold(Location.start, Location.start, Location.end, Location.end);\n  };\n\n  var isEq$5 = function (location1, location2) {\n    return getName(location1) === getName(location2) && getElement(location1) === getElement(location2);\n  };\n\n  var betweenInlines = function (forward, isInlineTarget, rootNode, from, to, location) {\n    return lift2(findRootInline(isInlineTarget, rootNode, from), findRootInline(isInlineTarget, rootNode, to), function (fromInline, toInline) {\n      if (fromInline !== toInline && hasSameParentBlock(rootNode, fromInline, toInline)) {\n        return Location.after(forward ? fromInline : toInline);\n      } else {\n        return location;\n      }\n    }).getOr(location);\n  };\n\n  var skipNoMovement = function (fromLocation, toLocation) {\n    return fromLocation.fold(always, function (fromLocation) {\n      return !isEq$5(fromLocation, toLocation);\n    });\n  };\n\n  var findLocationTraverse = function (forward, isInlineTarget, rootNode, fromLocation, pos) {\n    var from = normalizePosition(forward, pos);\n    var to = fromPosition(forward, rootNode, from).map(curry(normalizePosition, forward));\n    var location = to.fold(function () {\n      return fromLocation.map(outside);\n    }, function (to) {\n      return readLocation(isInlineTarget, rootNode, to).map(curry(betweenInlines, forward, isInlineTarget, rootNode, from, to)).filter(curry(skipNoMovement, fromLocation));\n    });\n    return location.filter(isValidLocation);\n  };\n\n  var findLocationSimple = function (forward, location) {\n    if (forward) {\n      return location.fold(compose(Optional.some, Location.start), Optional.none, compose(Optional.some, Location.after), Optional.none);\n    } else {\n      return location.fold(Optional.none, compose(Optional.some, Location.before), Optional.none, compose(Optional.some, Location.end));\n    }\n  };\n\n  var findLocation = function (forward, isInlineTarget, rootNode, pos) {\n    var from = normalizePosition(forward, pos);\n    var fromLocation = readLocation(isInlineTarget, rootNode, from);\n    return readLocation(isInlineTarget, rootNode, from).bind(curry(findLocationSimple, forward)).orThunk(function () {\n      return findLocationTraverse(forward, isInlineTarget, rootNode, fromLocation, pos);\n    });\n  };\n\n  var prevLocation = curry(findLocation, false);\n  var nextLocation = curry(findLocation, true);\n\n  var hasSelectionModifyApi = function (editor) {\n    return isFunction(editor.selection.getSel().modify);\n  };\n\n  var moveRel = function (forward, selection, pos) {\n    var delta = forward ? 1 : -1;\n    selection.setRng(CaretPosition$1(pos.container(), pos.offset() + delta).toRange());\n    selection.getSel().modify('move', forward ? 'forward' : 'backward', 'word');\n    return true;\n  };\n\n  var moveByWord = function (forward, editor) {\n    var rng = editor.selection.getRng();\n    var pos = forward ? CaretPosition$1.fromRangeEnd(rng) : CaretPosition$1.fromRangeStart(rng);\n\n    if (!hasSelectionModifyApi(editor)) {\n      return false;\n    } else if (forward && isBeforeInline(pos)) {\n      return moveRel(true, editor.selection, pos);\n    } else if (!forward && isAfterInline(pos)) {\n      return moveRel(false, editor.selection, pos);\n    } else {\n      return false;\n    }\n  };\n\n  var setCaretPosition = function (editor, pos) {\n    var rng = editor.dom.createRng();\n    rng.setStart(pos.container(), pos.offset());\n    rng.setEnd(pos.container(), pos.offset());\n    editor.selection.setRng(rng);\n  };\n\n  var setSelected = function (state, elm) {\n    if (state) {\n      elm.setAttribute('data-mce-selected', 'inline-boundary');\n    } else {\n      elm.removeAttribute('data-mce-selected');\n    }\n  };\n\n  var renderCaretLocation = function (editor, caret, location) {\n    return renderCaret(caret, location).map(function (pos) {\n      setCaretPosition(editor, pos);\n      return location;\n    });\n  };\n\n  var findLocation$1 = function (editor, caret, forward) {\n    var rootNode = editor.getBody();\n    var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    var isInlineTarget$1 = curry(isInlineTarget, editor);\n    var location = findLocation(forward, isInlineTarget$1, rootNode, from);\n    return location.bind(function (location) {\n      return renderCaretLocation(editor, caret, location);\n    });\n  };\n\n  var toggleInlines = function (isInlineTarget, dom, elms) {\n    var inlineBoundaries = map(descendants$1(SugarElement.fromDom(dom.getRoot()), '*[data-mce-selected=\"inline-boundary\"]'), function (e) {\n      return e.dom;\n    });\n    var selectedInlines = filter(inlineBoundaries, isInlineTarget);\n    var targetInlines = filter(elms, isInlineTarget);\n    each(difference(selectedInlines, targetInlines), curry(setSelected, false));\n    each(difference(targetInlines, selectedInlines), curry(setSelected, true));\n  };\n\n  var safeRemoveCaretContainer = function (editor, caret) {\n    if (editor.selection.isCollapsed() && editor.composing !== true && caret.get()) {\n      var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n\n      if (CaretPosition$1.isTextPosition(pos) && isAtZwsp(pos) === false) {\n        setCaretPosition(editor, removeAndReposition(caret.get(), pos));\n        caret.set(null);\n      }\n    }\n  };\n\n  var renderInsideInlineCaret = function (isInlineTarget, editor, caret, elms) {\n    if (editor.selection.isCollapsed()) {\n      var inlines = filter(elms, isInlineTarget);\n      each(inlines, function (_inline) {\n        var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        readLocation(isInlineTarget, editor.getBody(), pos).bind(function (location) {\n          return renderCaretLocation(editor, caret, location);\n        });\n      });\n    }\n  };\n\n  var move = function (editor, caret, forward) {\n    return isInlineBoundariesEnabled(editor) ? findLocation$1(editor, caret, forward).isSome() : false;\n  };\n\n  var moveWord = function (forward, editor, _caret) {\n    return isInlineBoundariesEnabled(editor) ? moveByWord(forward, editor) : false;\n  };\n\n  var setupSelectedState = function (editor) {\n    var caret = Cell(null);\n    var isInlineTarget$1 = curry(isInlineTarget, editor);\n    editor.on('NodeChange', function (e) {\n      if (isInlineBoundariesEnabled(editor) && !(Env.browser.isIE() && e.initial)) {\n        toggleInlines(isInlineTarget$1, editor.dom, e.parents);\n        safeRemoveCaretContainer(editor, caret);\n        renderInsideInlineCaret(isInlineTarget$1, editor, caret, e.parents);\n      }\n    });\n    return caret;\n  };\n\n  var moveNextWord = curry(moveWord, true);\n  var movePrevWord = curry(moveWord, false);\n\n  var rangeFromPositions = function (from, to) {\n    var range = document.createRange();\n    range.setStart(from.container(), from.offset());\n    range.setEnd(to.container(), to.offset());\n    return range;\n  };\n\n  var hasOnlyTwoOrLessPositionsLeft = function (elm) {\n    return lift2(firstPositionIn(elm), lastPositionIn(elm), function (firstPos, lastPos) {\n      var normalizedFirstPos = normalizePosition(true, firstPos);\n      var normalizedLastPos = normalizePosition(false, lastPos);\n      return nextPosition(elm, normalizedFirstPos).forall(function (pos) {\n        return pos.isEqual(normalizedLastPos);\n      });\n    }).getOr(true);\n  };\n\n  var setCaretLocation = function (editor, caret) {\n    return function (location) {\n      return renderCaret(caret, location).exists(function (pos) {\n        setCaretPosition(editor, pos);\n        return true;\n      });\n    };\n  };\n\n  var deleteFromTo = function (editor, caret, from, to) {\n    var rootNode = editor.getBody();\n    var isInlineTarget$1 = curry(isInlineTarget, editor);\n    editor.undoManager.ignore(function () {\n      editor.selection.setRng(rangeFromPositions(from, to));\n      editor.execCommand('Delete');\n      readLocation(isInlineTarget$1, rootNode, CaretPosition$1.fromRangeStart(editor.selection.getRng())).map(inside).map(setCaretLocation(editor, caret));\n    });\n    editor.nodeChanged();\n  };\n\n  var rescope$1 = function (rootNode, node) {\n    var parentBlock = getParentBlock(node, rootNode);\n    return parentBlock ? parentBlock : rootNode;\n  };\n\n  var backspaceDeleteCollapsed = function (editor, caret, forward, from) {\n    var rootNode = rescope$1(editor.getBody(), from.container());\n    var isInlineTarget$1 = curry(isInlineTarget, editor);\n    var fromLocation = readLocation(isInlineTarget$1, rootNode, from);\n    return fromLocation.bind(function (location) {\n      if (forward) {\n        return location.fold(constant(Optional.some(inside(location))), Optional.none, constant(Optional.some(outside(location))), Optional.none);\n      } else {\n        return location.fold(Optional.none, constant(Optional.some(outside(location))), Optional.none, constant(Optional.some(inside(location))));\n      }\n    }).map(setCaretLocation(editor, caret)).getOrThunk(function () {\n      var toPosition = navigate(forward, rootNode, from);\n      var toLocation = toPosition.bind(function (pos) {\n        return readLocation(isInlineTarget$1, rootNode, pos);\n      });\n      return lift2(fromLocation, toLocation, function () {\n        return findRootInline(isInlineTarget$1, rootNode, from).exists(function (elm) {\n          if (hasOnlyTwoOrLessPositionsLeft(elm)) {\n            deleteElement(editor, forward, SugarElement.fromDom(elm));\n            return true;\n          } else {\n            return false;\n          }\n        });\n      }).orThunk(function () {\n        return toLocation.bind(function (_) {\n          return toPosition.map(function (to) {\n            if (forward) {\n              deleteFromTo(editor, caret, from, to);\n            } else {\n              deleteFromTo(editor, caret, to, from);\n            }\n\n            return true;\n          });\n        });\n      }).getOr(false);\n    });\n  };\n\n  var backspaceDelete$6 = function (editor, caret, forward) {\n    if (editor.selection.isCollapsed() && isInlineBoundariesEnabled(editor)) {\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return backspaceDeleteCollapsed(editor, caret, forward, from);\n    }\n\n    return false;\n  };\n\n  var getParentInlines = function (rootElm, startElm) {\n    var parents = parentsAndSelf(startElm, rootElm);\n    return findIndex(parents, isBlock).fold(constant(parents), function (index) {\n      return parents.slice(0, index);\n    });\n  };\n\n  var hasOnlyOneChild$1 = function (elm) {\n    return children(elm).length === 1;\n  };\n\n  var deleteLastPosition = function (forward, editor, target, parentInlines) {\n    var isFormatElement$1 = curry(isFormatElement, editor);\n    var formatNodes = map(filter(parentInlines, isFormatElement$1), function (elm) {\n      return elm.dom;\n    });\n\n    if (formatNodes.length === 0) {\n      deleteElement(editor, forward, target);\n    } else {\n      var pos = replaceWithCaretFormat(target.dom, formatNodes);\n      editor.selection.setRng(pos.toRange());\n    }\n  };\n\n  var deleteCaret$2 = function (editor, forward) {\n    var rootElm = SugarElement.fromDom(editor.getBody());\n    var startElm = SugarElement.fromDom(editor.selection.getStart());\n    var parentInlines = filter(getParentInlines(rootElm, startElm), hasOnlyOneChild$1);\n    return last(parentInlines).exists(function (target) {\n      var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n\n      if (willDeleteLastPositionInElement(forward, fromPos, target.dom) && !isEmptyCaretFormatElement(target)) {\n        deleteLastPosition(forward, editor, target, parentInlines);\n        return true;\n      } else {\n        return false;\n      }\n    });\n  };\n\n  var backspaceDelete$7 = function (editor, forward) {\n    return editor.selection.isCollapsed() ? deleteCaret$2(editor, forward) : false;\n  };\n\n  var deleteElement$2 = function (editor, forward, element) {\n    editor._selectionOverrides.hideFakeCaret();\n\n    deleteElement(editor, forward, SugarElement.fromDom(element));\n    return true;\n  };\n\n  var deleteCaret$3 = function (editor, forward) {\n    var isNearMedia = forward ? isBeforeMedia : isAfterMedia;\n    var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n    var fromPos = getNormalizedRangeEndPoint(direction, editor.getBody(), editor.selection.getRng());\n\n    if (isNearMedia(fromPos)) {\n      return deleteElement$2(editor, forward, fromPos.getNode(!forward));\n    } else {\n      return Optional.from(normalizePosition(forward, fromPos)).filter(function (pos) {\n        return isNearMedia(pos) && isMoveInsideSameBlock(fromPos, pos);\n      }).exists(function (pos) {\n        return deleteElement$2(editor, forward, pos.getNode(!forward));\n      });\n    }\n  };\n\n  var deleteRange$2 = function (editor, forward) {\n    var selectedNode = editor.selection.getNode();\n    return isMedia(selectedNode) ? deleteElement$2(editor, forward, selectedNode) : false;\n  };\n\n  var backspaceDelete$8 = function (editor, forward) {\n    return editor.selection.isCollapsed() ? deleteCaret$3(editor, forward) : deleteRange$2(editor, forward);\n  };\n\n  var isEditable$1 = function (target) {\n    return closest(target, function (elm) {\n      return isContentEditableTrue(elm.dom) || isContentEditableFalse(elm.dom);\n    }).exists(function (elm) {\n      return isContentEditableTrue(elm.dom);\n    });\n  };\n\n  var parseIndentValue = function (value) {\n    var number = parseInt(value, 10);\n    return isNaN(number) ? 0 : number;\n  };\n\n  var getIndentStyleName = function (useMargin, element) {\n    var indentStyleName = useMargin || isTable$1(element) ? 'margin' : 'padding';\n    var suffix = get$5(element, 'direction') === 'rtl' ? '-right' : '-left';\n    return indentStyleName + suffix;\n  };\n\n  var indentElement = function (dom, command, useMargin, value, unit, element) {\n    var indentStyleName = getIndentStyleName(useMargin, SugarElement.fromDom(element));\n\n    if (command === 'outdent') {\n      var styleValue = Math.max(0, parseIndentValue(element.style[indentStyleName]) - value);\n      dom.setStyle(element, indentStyleName, styleValue ? styleValue + unit : '');\n    } else {\n      var styleValue = parseIndentValue(element.style[indentStyleName]) + value + unit;\n      dom.setStyle(element, indentStyleName, styleValue);\n    }\n  };\n\n  var validateBlocks = function (editor, blocks) {\n    return forall(blocks, function (block) {\n      var indentStyleName = getIndentStyleName(shouldIndentUseMargin(editor), block);\n      var intentValue = getRaw(block, indentStyleName).map(parseIndentValue).getOr(0);\n      var contentEditable = editor.dom.getContentEditable(block.dom);\n      return contentEditable !== 'false' && intentValue > 0;\n    });\n  };\n\n  var canOutdent = function (editor) {\n    var blocks = getBlocksToIndent(editor);\n    return !editor.mode.isReadOnly() && (blocks.length > 1 || validateBlocks(editor, blocks));\n  };\n\n  var isListComponent = function (el) {\n    return isList(el) || isListItem(el);\n  };\n\n  var parentIsListComponent = function (el) {\n    return parent(el).map(isListComponent).getOr(false);\n  };\n\n  var getBlocksToIndent = function (editor) {\n    return filter(map(editor.selection.getSelectedBlocks(), SugarElement.fromDom), function (el) {\n      return !isListComponent(el) && !parentIsListComponent(el) && isEditable$1(el);\n    });\n  };\n\n  var handle = function (editor, command) {\n    var dom = editor.dom,\n        selection = editor.selection,\n        formatter = editor.formatter;\n    var indentation = getIndentation(editor);\n    var indentUnit = /[a-z%]+$/i.exec(indentation)[0];\n    var indentValue = parseInt(indentation, 10);\n    var useMargin = shouldIndentUseMargin(editor);\n    var forcedRootBlock = getForcedRootBlock(editor);\n\n    if (!editor.queryCommandState('InsertUnorderedList') && !editor.queryCommandState('InsertOrderedList')) {\n      if (forcedRootBlock === '' && !dom.getParent(selection.getNode(), dom.isBlock)) {\n        formatter.apply('div');\n      }\n    }\n\n    each(getBlocksToIndent(editor), function (block) {\n      indentElement(dom, command, useMargin, indentValue, indentUnit, block.dom);\n    });\n  };\n\n  var backspaceDelete$9 = function (editor, _forward) {\n    if (editor.selection.isCollapsed() && canOutdent(editor)) {\n      var dom = editor.dom;\n      var rng = editor.selection.getRng();\n      var pos = CaretPosition$1.fromRangeStart(rng);\n      var block = dom.getParent(rng.startContainer, dom.isBlock);\n\n      if (block !== null && isAtStartOfBlock(SugarElement.fromDom(block), pos)) {\n        handle(editor, 'outdent');\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var nativeCommand = function (editor, command) {\n    editor.getDoc().execCommand(command, false, null);\n  };\n\n  var deleteCommand = function (editor, caret) {\n    if (backspaceDelete$9(editor)) {\n      return;\n    } else if (backspaceDelete$4(editor, false)) {\n      return;\n    } else if (backspaceDelete$3(editor, false)) {\n      return;\n    } else if (backspaceDelete$6(editor, caret, false)) {\n      return;\n    } else if (backspaceDelete$1(editor, false)) {\n      return;\n    } else if (backspaceDelete(editor)) {\n      return;\n    } else if (backspaceDelete$5(editor, false)) {\n      return;\n    } else if (backspaceDelete$8(editor, false)) {\n      return;\n    } else if (backspaceDelete$2(editor)) {\n      return;\n    } else if (backspaceDelete$7(editor, false)) {\n      return;\n    } else {\n      nativeCommand(editor, 'Delete');\n      paddEmptyBody(editor);\n    }\n  };\n\n  var forwardDeleteCommand = function (editor, caret) {\n    if (backspaceDelete$4(editor, true)) {\n      return;\n    } else if (backspaceDelete$3(editor, true)) {\n      return;\n    } else if (backspaceDelete$6(editor, caret, true)) {\n      return;\n    } else if (backspaceDelete$1(editor, true)) {\n      return;\n    } else if (backspaceDelete(editor)) {\n      return;\n    } else if (backspaceDelete$5(editor, true)) {\n      return;\n    } else if (backspaceDelete$8(editor, true)) {\n      return;\n    } else if (backspaceDelete$2(editor)) {\n      return;\n    } else if (backspaceDelete$7(editor, true)) {\n      return;\n    } else {\n      nativeCommand(editor, 'ForwardDelete');\n    }\n  };\n\n  var setup$8 = function (editor, caret) {\n    editor.addCommand('delete', function () {\n      deleteCommand(editor, caret);\n    });\n    editor.addCommand('forwardDelete', function () {\n      forwardDeleteCommand(editor, caret);\n    });\n  };\n\n  var SIGNIFICANT_MOVE = 5;\n  var LONGPRESS_DELAY = 400;\n\n  var getTouch = function (event) {\n    if (event.touches === undefined || event.touches.length !== 1) {\n      return Optional.none();\n    }\n\n    return Optional.some(event.touches[0]);\n  };\n\n  var isFarEnough = function (touch, data) {\n    var distX = Math.abs(touch.clientX - data.x);\n    var distY = Math.abs(touch.clientY - data.y);\n    return distX > SIGNIFICANT_MOVE || distY > SIGNIFICANT_MOVE;\n  };\n\n  var setup$9 = function (editor) {\n    var startData = Cell(Optional.none());\n    var longpressFired = Cell(false);\n    var debounceLongpress = last$2(function (e) {\n      editor.fire('longpress', __assign(__assign({}, e), {\n        type: 'longpress'\n      }));\n      longpressFired.set(true);\n    }, LONGPRESS_DELAY);\n    editor.on('touchstart', function (e) {\n      getTouch(e).each(function (touch) {\n        debounceLongpress.cancel();\n        var data = {\n          x: touch.clientX,\n          y: touch.clientY,\n          target: e.target\n        };\n        debounceLongpress.throttle(e);\n        longpressFired.set(false);\n        startData.set(Optional.some(data));\n      });\n    }, true);\n    editor.on('touchmove', function (e) {\n      debounceLongpress.cancel();\n      getTouch(e).each(function (touch) {\n        startData.get().each(function (data) {\n          if (isFarEnough(touch, data)) {\n            startData.set(Optional.none());\n            longpressFired.set(false);\n            editor.fire('longpresscancel');\n          }\n        });\n      });\n    }, true);\n    editor.on('touchend touchcancel', function (e) {\n      debounceLongpress.cancel();\n\n      if (e.type === 'touchcancel') {\n        return;\n      }\n\n      startData.get().filter(function (data) {\n        return data.target.isEqualNode(e.target);\n      }).each(function () {\n        if (longpressFired.get()) {\n          e.preventDefault();\n        } else {\n          editor.fire('tap', __assign(__assign({}, e), {\n            type: 'tap'\n          }));\n        }\n      });\n    }, true);\n  };\n\n  var isBlockElement = function (blockElements, node) {\n    return blockElements.hasOwnProperty(node.nodeName);\n  };\n\n  var isValidTarget = function (blockElements, node) {\n    if (isText$1(node)) {\n      return true;\n    } else if (isElement$1(node)) {\n      return !isBlockElement(blockElements, node) && !isBookmarkNode$1(node);\n    } else {\n      return false;\n    }\n  };\n\n  var hasBlockParent = function (blockElements, root, node) {\n    return exists(parents$1(SugarElement.fromDom(node), SugarElement.fromDom(root)), function (elm) {\n      return isBlockElement(blockElements, elm.dom);\n    });\n  };\n\n  var shouldRemoveTextNode = function (blockElements, node) {\n    if (isText$1(node)) {\n      if (node.nodeValue.length === 0) {\n        return true;\n      } else if (/^\\s+$/.test(node.nodeValue) && (!node.nextSibling || isBlockElement(blockElements, node.nextSibling))) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var addRootBlocks = function (editor) {\n    var dom = editor.dom,\n        selection = editor.selection;\n    var schema = editor.schema,\n        blockElements = schema.getBlockElements();\n    var node = selection.getStart();\n    var rootNode = editor.getBody();\n    var rootBlockNode, tempNode, wrapped;\n    var forcedRootBlock = getForcedRootBlock(editor);\n\n    if (!node || !isElement$1(node) || !forcedRootBlock) {\n      return;\n    }\n\n    var rootNodeName = rootNode.nodeName.toLowerCase();\n\n    if (!schema.isValidChild(rootNodeName, forcedRootBlock.toLowerCase()) || hasBlockParent(blockElements, rootNode, node)) {\n      return;\n    }\n\n    var rng = selection.getRng();\n    var startContainer = rng.startContainer;\n    var startOffset = rng.startOffset;\n    var endContainer = rng.endContainer;\n    var endOffset = rng.endOffset;\n    var restoreSelection = hasFocus$1(editor);\n    node = rootNode.firstChild;\n\n    while (node) {\n      if (isValidTarget(blockElements, node)) {\n        if (shouldRemoveTextNode(blockElements, node)) {\n          tempNode = node;\n          node = node.nextSibling;\n          dom.remove(tempNode);\n          continue;\n        }\n\n        if (!rootBlockNode) {\n          rootBlockNode = dom.create(forcedRootBlock, getForcedRootBlockAttrs(editor));\n          node.parentNode.insertBefore(rootBlockNode, node);\n          wrapped = true;\n        }\n\n        tempNode = node;\n        node = node.nextSibling;\n        rootBlockNode.appendChild(tempNode);\n      } else {\n        rootBlockNode = null;\n        node = node.nextSibling;\n      }\n    }\n\n    if (wrapped && restoreSelection) {\n      rng.setStart(startContainer, startOffset);\n      rng.setEnd(endContainer, endOffset);\n      selection.setRng(rng);\n      editor.nodeChanged();\n    }\n  };\n\n  var setup$a = function (editor) {\n    if (getForcedRootBlock(editor)) {\n      editor.on('NodeChange', curry(addRootBlocks, editor));\n    }\n  };\n\n  var findBlockCaretContainer = function (editor) {\n    return descendant(SugarElement.fromDom(editor.getBody()), '*[data-mce-caret]').fold(constant(null), function (elm) {\n      return elm.dom;\n    });\n  };\n\n  var removeIeControlRect = function (editor) {\n    editor.selection.setRng(editor.selection.getRng());\n  };\n\n  var showBlockCaretContainer = function (editor, blockCaretContainer) {\n    if (blockCaretContainer.hasAttribute('data-mce-caret')) {\n      showCaretContainerBlock(blockCaretContainer);\n      removeIeControlRect(editor);\n      editor.selection.scrollIntoView(blockCaretContainer);\n    }\n  };\n\n  var handleBlockContainer = function (editor, e) {\n    var blockCaretContainer = findBlockCaretContainer(editor);\n\n    if (!blockCaretContainer) {\n      return;\n    }\n\n    if (e.type === 'compositionstart') {\n      e.preventDefault();\n      e.stopPropagation();\n      showBlockCaretContainer(editor, blockCaretContainer);\n      return;\n    }\n\n    if (hasContent(blockCaretContainer)) {\n      showBlockCaretContainer(editor, blockCaretContainer);\n      editor.undoManager.add();\n    }\n  };\n\n  var setup$b = function (editor) {\n    editor.on('keyup compositionstart', curry(handleBlockContainer, editor));\n  };\n\n  var BreakType;\n\n  (function (BreakType) {\n    BreakType[BreakType['Br'] = 0] = 'Br';\n    BreakType[BreakType['Block'] = 1] = 'Block';\n    BreakType[BreakType['Wrap'] = 2] = 'Wrap';\n    BreakType[BreakType['Eol'] = 3] = 'Eol';\n  })(BreakType || (BreakType = {}));\n\n  var flip = function (direction, positions) {\n    return direction === HDirection.Backwards ? reverse(positions) : positions;\n  };\n\n  var walk$3 = function (direction, caretWalker, pos) {\n    return direction === HDirection.Forwards ? caretWalker.next(pos) : caretWalker.prev(pos);\n  };\n\n  var getBreakType = function (scope, direction, currentPos, nextPos) {\n    if (isBr(nextPos.getNode(direction === HDirection.Forwards))) {\n      return BreakType.Br;\n    } else if (isInSameBlock(currentPos, nextPos) === false) {\n      return BreakType.Block;\n    } else {\n      return BreakType.Wrap;\n    }\n  };\n\n  var getPositionsUntil = function (predicate, direction, scope, start) {\n    var caretWalker = CaretWalker(scope);\n    var currentPos = start,\n        nextPos;\n    var positions = [];\n\n    while (currentPos) {\n      nextPos = walk$3(direction, caretWalker, currentPos);\n\n      if (!nextPos) {\n        break;\n      }\n\n      if (isBr(nextPos.getNode(false))) {\n        if (direction === HDirection.Forwards) {\n          return {\n            positions: flip(direction, positions).concat([nextPos]),\n            breakType: BreakType.Br,\n            breakAt: Optional.some(nextPos)\n          };\n        } else {\n          return {\n            positions: flip(direction, positions),\n            breakType: BreakType.Br,\n            breakAt: Optional.some(nextPos)\n          };\n        }\n      }\n\n      if (!nextPos.isVisible()) {\n        currentPos = nextPos;\n        continue;\n      }\n\n      if (predicate(currentPos, nextPos)) {\n        var breakType = getBreakType(scope, direction, currentPos, nextPos);\n        return {\n          positions: flip(direction, positions),\n          breakType: breakType,\n          breakAt: Optional.some(nextPos)\n        };\n      }\n\n      positions.push(nextPos);\n      currentPos = nextPos;\n    }\n\n    return {\n      positions: flip(direction, positions),\n      breakType: BreakType.Eol,\n      breakAt: Optional.none()\n    };\n  };\n\n  var getAdjacentLinePositions = function (direction, getPositionsUntilBreak, scope, start) {\n    return getPositionsUntilBreak(scope, start).breakAt.map(function (pos) {\n      var positions = getPositionsUntilBreak(scope, pos).positions;\n      return direction === HDirection.Backwards ? positions.concat(pos) : [pos].concat(positions);\n    }).getOr([]);\n  };\n\n  var findClosestHorizontalPositionFromPoint = function (positions, x) {\n    return foldl(positions, function (acc, newPos) {\n      return acc.fold(function () {\n        return Optional.some(newPos);\n      }, function (lastPos) {\n        return lift2(head(lastPos.getClientRects()), head(newPos.getClientRects()), function (lastRect, newRect) {\n          var lastDist = Math.abs(x - lastRect.left);\n          var newDist = Math.abs(x - newRect.left);\n          return newDist <= lastDist ? newPos : lastPos;\n        }).or(acc);\n      });\n    }, Optional.none());\n  };\n\n  var findClosestHorizontalPosition = function (positions, pos) {\n    return head(pos.getClientRects()).bind(function (targetRect) {\n      return findClosestHorizontalPositionFromPoint(positions, targetRect.left);\n    });\n  };\n\n  var getPositionsUntilPreviousLine = curry(getPositionsUntil, CaretPosition.isAbove, -1);\n  var getPositionsUntilNextLine = curry(getPositionsUntil, CaretPosition.isBelow, 1);\n\n  var isAtFirstLine = function (scope, pos) {\n    return getPositionsUntilPreviousLine(scope, pos).breakAt.isNone();\n  };\n\n  var isAtLastLine = function (scope, pos) {\n    return getPositionsUntilNextLine(scope, pos).breakAt.isNone();\n  };\n\n  var getPositionsAbove = curry(getAdjacentLinePositions, -1, getPositionsUntilPreviousLine);\n  var getPositionsBelow = curry(getAdjacentLinePositions, 1, getPositionsUntilNextLine);\n\n  var getFirstLinePositions = function (scope) {\n    return firstPositionIn(scope).map(function (pos) {\n      return [pos].concat(getPositionsUntilNextLine(scope, pos).positions);\n    }).getOr([]);\n  };\n\n  var getLastLinePositions = function (scope) {\n    return lastPositionIn(scope).map(function (pos) {\n      return getPositionsUntilPreviousLine(scope, pos).positions.concat(pos);\n    }).getOr([]);\n  };\n\n  var getNodeClientRects = function (node) {\n    var toArrayWithNode = function (clientRects) {\n      return map(clientRects, function (clientRect) {\n        clientRect = clone$2(clientRect);\n        clientRect.node = node;\n        return clientRect;\n      });\n    };\n\n    if (isElement$1(node)) {\n      return toArrayWithNode(node.getClientRects());\n    }\n\n    if (isText$1(node)) {\n      var rng = node.ownerDocument.createRange();\n      rng.setStart(node, 0);\n      rng.setEnd(node, node.data.length);\n      return toArrayWithNode(rng.getClientRects());\n    }\n  };\n\n  var getClientRects = function (nodes) {\n    return bind(nodes, getNodeClientRects);\n  };\n\n  var VDirection;\n\n  (function (VDirection) {\n    VDirection[VDirection['Up'] = -1] = 'Up';\n    VDirection[VDirection['Down'] = 1] = 'Down';\n  })(VDirection || (VDirection = {}));\n\n  var findUntil$1 = function (direction, root, predicateFn, node) {\n    while (node = findNode(node, direction, isEditableCaretCandidate, root)) {\n      if (predicateFn(node)) {\n        return;\n      }\n    }\n  };\n\n  var walkUntil = function (direction, isAboveFn, isBeflowFn, root, predicateFn, caretPosition) {\n    var line = 0;\n    var result = [];\n\n    var add = function (node) {\n      var i, clientRect, clientRects;\n      clientRects = getClientRects([node]);\n\n      if (direction === -1) {\n        clientRects = clientRects.reverse();\n      }\n\n      for (i = 0; i < clientRects.length; i++) {\n        clientRect = clientRects[i];\n\n        if (isBeflowFn(clientRect, targetClientRect)) {\n          continue;\n        }\n\n        if (result.length > 0 && isAboveFn(clientRect, last$1(result))) {\n          line++;\n        }\n\n        clientRect.line = line;\n\n        if (predicateFn(clientRect)) {\n          return true;\n        }\n\n        result.push(clientRect);\n      }\n    };\n\n    var targetClientRect = last$1(caretPosition.getClientRects());\n\n    if (!targetClientRect) {\n      return result;\n    }\n\n    var node = caretPosition.getNode();\n    add(node);\n    findUntil$1(direction, root, add, node);\n    return result;\n  };\n\n  var aboveLineNumber = function (lineNumber, clientRect) {\n    return clientRect.line > lineNumber;\n  };\n\n  var isLineNumber = function (lineNumber, clientRect) {\n    return clientRect.line === lineNumber;\n  };\n\n  var upUntil = curry(walkUntil, VDirection.Up, isAbove, isBelow);\n  var downUntil = curry(walkUntil, VDirection.Down, isBelow, isAbove);\n\n  var positionsUntil = function (direction, root, predicateFn, node) {\n    var caretWalker = CaretWalker(root);\n    var walkFn, isBelowFn, isAboveFn, caretPosition;\n    var result = [];\n    var line = 0,\n        clientRect;\n\n    var getClientRect = function (caretPosition) {\n      if (direction === 1) {\n        return last$1(caretPosition.getClientRects());\n      }\n\n      return last$1(caretPosition.getClientRects());\n    };\n\n    if (direction === 1) {\n      walkFn = caretWalker.next;\n      isBelowFn = isBelow;\n      isAboveFn = isAbove;\n      caretPosition = CaretPosition$1.after(node);\n    } else {\n      walkFn = caretWalker.prev;\n      isBelowFn = isAbove;\n      isAboveFn = isBelow;\n      caretPosition = CaretPosition$1.before(node);\n    }\n\n    var targetClientRect = getClientRect(caretPosition);\n\n    do {\n      if (!caretPosition.isVisible()) {\n        continue;\n      }\n\n      clientRect = getClientRect(caretPosition);\n\n      if (isAboveFn(clientRect, targetClientRect)) {\n        continue;\n      }\n\n      if (result.length > 0 && isBelowFn(clientRect, last$1(result))) {\n        line++;\n      }\n\n      clientRect = clone$2(clientRect);\n      clientRect.position = caretPosition;\n      clientRect.line = line;\n\n      if (predicateFn(clientRect)) {\n        return result;\n      }\n\n      result.push(clientRect);\n    } while (caretPosition = walkFn(caretPosition));\n\n    return result;\n  };\n\n  var isAboveLine = function (lineNumber) {\n    return function (clientRect) {\n      return aboveLineNumber(lineNumber, clientRect);\n    };\n  };\n\n  var isLine = function (lineNumber) {\n    return function (clientRect) {\n      return isLineNumber(lineNumber, clientRect);\n    };\n  };\n\n  var isContentEditableFalse$8 = isContentEditableFalse;\n  var findNode$1 = findNode;\n\n  var distanceToRectLeft = function (clientRect, clientX) {\n    return Math.abs(clientRect.left - clientX);\n  };\n\n  var distanceToRectRight = function (clientRect, clientX) {\n    return Math.abs(clientRect.right - clientX);\n  };\n\n  var isInsideX = function (clientX, clientRect) {\n    return clientX >= clientRect.left && clientX <= clientRect.right;\n  };\n\n  var isInsideY = function (clientY, clientRect) {\n    return clientY >= clientRect.top && clientY <= clientRect.bottom;\n  };\n\n  var findClosestClientRect = function (clientRects, clientX) {\n    return reduce(clientRects, function (oldClientRect, clientRect) {\n      var oldDistance = Math.min(distanceToRectLeft(oldClientRect, clientX), distanceToRectRight(oldClientRect, clientX));\n      var newDistance = Math.min(distanceToRectLeft(clientRect, clientX), distanceToRectRight(clientRect, clientX));\n\n      if (isInsideX(clientX, clientRect)) {\n        return clientRect;\n      }\n\n      if (isInsideX(clientX, oldClientRect)) {\n        return oldClientRect;\n      }\n\n      if (newDistance === oldDistance && isContentEditableFalse$8(clientRect.node)) {\n        return clientRect;\n      }\n\n      if (newDistance < oldDistance) {\n        return clientRect;\n      }\n\n      return oldClientRect;\n    });\n  };\n\n  var walkUntil$1 = function (direction, root, predicateFn, startNode, includeChildren) {\n    var node = findNode$1(startNode, direction, isEditableCaretCandidate, root, !includeChildren);\n\n    do {\n      if (!node || predicateFn(node)) {\n        return;\n      }\n    } while (node = findNode$1(node, direction, isEditableCaretCandidate, root));\n  };\n\n  var findLineNodeRects = function (root, targetNodeRect, includeChildren) {\n    if (includeChildren === void 0) {\n      includeChildren = true;\n    }\n\n    var clientRects = [];\n\n    var collect = function (checkPosFn, node) {\n      var lineRects = filter(getClientRects([node]), function (clientRect) {\n        return !checkPosFn(clientRect, targetNodeRect);\n      });\n      clientRects = clientRects.concat(lineRects);\n      return lineRects.length === 0;\n    };\n\n    clientRects.push(targetNodeRect);\n    walkUntil$1(VDirection.Up, root, curry(collect, isAbove), targetNodeRect.node, includeChildren);\n    walkUntil$1(VDirection.Down, root, curry(collect, isBelow), targetNodeRect.node, includeChildren);\n    return clientRects;\n  };\n\n  var getFakeCaretTargets = function (root) {\n    return filter(from$1(root.getElementsByTagName('*')), isFakeCaretTarget);\n  };\n\n  var caretInfo = function (clientRect, clientX) {\n    return {\n      node: clientRect.node,\n      before: distanceToRectLeft(clientRect, clientX) < distanceToRectRight(clientRect, clientX)\n    };\n  };\n\n  var closestFakeCaret = function (root, clientX, clientY) {\n    var fakeTargetNodeRects = getClientRects(getFakeCaretTargets(root));\n    var targetNodeRects = filter(fakeTargetNodeRects, curry(isInsideY, clientY));\n    var closestNodeRect = findClosestClientRect(targetNodeRects, clientX);\n\n    if (closestNodeRect) {\n      var includeChildren = !isTable(closestNodeRect.node) && !isMedia(closestNodeRect.node);\n      closestNodeRect = findClosestClientRect(findLineNodeRects(root, closestNodeRect, includeChildren), clientX);\n\n      if (closestNodeRect && isFakeCaretTarget(closestNodeRect.node)) {\n        return caretInfo(closestNodeRect, clientX);\n      }\n    }\n\n    return null;\n  };\n\n  var moveToRange = function (editor, rng) {\n    editor.selection.setRng(rng);\n    scrollRangeIntoView(editor, editor.selection.getRng());\n  };\n\n  var renderRangeCaretOpt = function (editor, range, scrollIntoView) {\n    return Optional.some(renderRangeCaret(editor, range, scrollIntoView));\n  };\n\n  var moveHorizontally = function (editor, direction, range, isBefore, isAfter, isElement) {\n    var forwards = direction === HDirection.Forwards;\n    var caretWalker = CaretWalker(editor.getBody());\n    var getNextPosFn = curry(getVisualCaretPosition, forwards ? caretWalker.next : caretWalker.prev);\n    var isBeforeFn = forwards ? isBefore : isAfter;\n\n    if (!range.collapsed) {\n      var node = getSelectedNode(range);\n\n      if (isElement(node)) {\n        return showCaret(direction, editor, node, direction === HDirection.Backwards, false);\n      }\n    }\n\n    var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n\n    if (isBeforeFn(caretPosition)) {\n      return selectNode(editor, caretPosition.getNode(!forwards));\n    }\n\n    var nextCaretPosition = normalizePosition(forwards, getNextPosFn(caretPosition));\n    var rangeIsInContainerBlock = isRangeInCaretContainerBlock(range);\n\n    if (!nextCaretPosition) {\n      return rangeIsInContainerBlock ? Optional.some(range) : Optional.none();\n    }\n\n    if (isBeforeFn(nextCaretPosition)) {\n      return showCaret(direction, editor, nextCaretPosition.getNode(!forwards), forwards, false);\n    }\n\n    var peekCaretPosition = getNextPosFn(nextCaretPosition);\n\n    if (peekCaretPosition && isBeforeFn(peekCaretPosition)) {\n      if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\n        return showCaret(direction, editor, peekCaretPosition.getNode(!forwards), forwards, false);\n      }\n    }\n\n    if (rangeIsInContainerBlock) {\n      return renderRangeCaretOpt(editor, nextCaretPosition.toRange(), false);\n    }\n\n    return Optional.none();\n  };\n\n  var moveVertically = function (editor, direction, range, isBefore, isAfter, isElement) {\n    var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n    var caretClientRect = last$1(caretPosition.getClientRects());\n    var forwards = direction === VDirection.Down;\n\n    if (!caretClientRect) {\n      return Optional.none();\n    }\n\n    var walkerFn = forwards ? downUntil : upUntil;\n    var linePositions = walkerFn(editor.getBody(), isAboveLine(1), caretPosition);\n    var nextLinePositions = filter(linePositions, isLine(1));\n    var clientX = caretClientRect.left;\n    var nextLineRect = findClosestClientRect(nextLinePositions, clientX);\n\n    if (nextLineRect && isElement(nextLineRect.node)) {\n      var dist1 = Math.abs(clientX - nextLineRect.left);\n      var dist2 = Math.abs(clientX - nextLineRect.right);\n      return showCaret(direction, editor, nextLineRect.node, dist1 < dist2, false);\n    }\n\n    var currentNode;\n\n    if (isBefore(caretPosition)) {\n      currentNode = caretPosition.getNode();\n    } else if (isAfter(caretPosition)) {\n      currentNode = caretPosition.getNode(true);\n    } else {\n      currentNode = getSelectedNode(range);\n    }\n\n    if (currentNode) {\n      var caretPositions = positionsUntil(direction, editor.getBody(), isAboveLine(1), currentNode);\n      var closestNextLineRect = findClosestClientRect(filter(caretPositions, isLine(1)), clientX);\n\n      if (closestNextLineRect) {\n        return renderRangeCaretOpt(editor, closestNextLineRect.position.toRange(), false);\n      }\n\n      closestNextLineRect = last$1(filter(caretPositions, isLine(0)));\n\n      if (closestNextLineRect) {\n        return renderRangeCaretOpt(editor, closestNextLineRect.position.toRange(), false);\n      }\n    }\n\n    if (nextLinePositions.length === 0) {\n      return getLineEndPoint(editor, forwards).filter(forwards ? isAfter : isBefore).map(function (pos) {\n        return renderRangeCaret(editor, pos.toRange(), false);\n      });\n    }\n\n    return Optional.none();\n  };\n\n  var getLineEndPoint = function (editor, forward) {\n    var rng = editor.selection.getRng();\n    var body = editor.getBody();\n\n    if (forward) {\n      var from = CaretPosition$1.fromRangeEnd(rng);\n      var result = getPositionsUntilNextLine(body, from);\n      return last(result.positions);\n    } else {\n      var from = CaretPosition$1.fromRangeStart(rng);\n      var result = getPositionsUntilPreviousLine(body, from);\n      return head(result.positions);\n    }\n  };\n\n  var moveToLineEndPoint = function (editor, forward, isElementPosition) {\n    return getLineEndPoint(editor, forward).filter(isElementPosition).exists(function (pos) {\n      editor.selection.setRng(pos.toRange());\n      return true;\n    });\n  };\n\n  var isContentEditableFalse$9 = isContentEditableFalse;\n\n  var moveToCeFalseHorizontally = function (direction, editor, range) {\n    return moveHorizontally(editor, direction, range, isBeforeContentEditableFalse, isAfterContentEditableFalse, isContentEditableFalse$9);\n  };\n\n  var moveToCeFalseVertically = function (direction, editor, range) {\n    var isBefore = function (caretPosition) {\n      return isBeforeContentEditableFalse(caretPosition) || isBeforeTable(caretPosition);\n    };\n\n    var isAfter = function (caretPosition) {\n      return isAfterContentEditableFalse(caretPosition) || isAfterTable(caretPosition);\n    };\n\n    return moveVertically(editor, direction, range, isBefore, isAfter, isContentEditableFalse$9);\n  };\n\n  var createTextBlock = function (editor) {\n    var textBlock = editor.dom.create(getForcedRootBlock(editor));\n\n    if (!Env.ie || Env.ie >= 11) {\n      textBlock.innerHTML = '<br data-mce-bogus=\"1\">';\n    }\n\n    return textBlock;\n  };\n\n  var exitPreBlock = function (editor, direction, range) {\n    var caretWalker = CaretWalker(editor.getBody());\n    var getVisualCaretPosition$1 = curry(getVisualCaretPosition, direction === 1 ? caretWalker.next : caretWalker.prev);\n\n    if (range.collapsed && hasForcedRootBlock(editor)) {\n      var pre = editor.dom.getParent(range.startContainer, 'PRE');\n\n      if (!pre) {\n        return;\n      }\n\n      var caretPos = getVisualCaretPosition$1(CaretPosition$1.fromRangeStart(range));\n\n      if (!caretPos) {\n        var newBlock = createTextBlock(editor);\n\n        if (direction === 1) {\n          editor.$(pre).after(newBlock);\n        } else {\n          editor.$(pre).before(newBlock);\n        }\n\n        editor.selection.select(newBlock, true);\n        editor.selection.collapse();\n      }\n    }\n  };\n\n  var getHorizontalRange = function (editor, forward) {\n    var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n    var range = editor.selection.getRng();\n    return moveToCeFalseHorizontally(direction, editor, range).orThunk(function () {\n      exitPreBlock(editor, direction, range);\n      return Optional.none();\n    });\n  };\n\n  var getVerticalRange = function (editor, down) {\n    var direction = down ? 1 : -1;\n    var range = editor.selection.getRng();\n    return moveToCeFalseVertically(direction, editor, range).orThunk(function () {\n      exitPreBlock(editor, direction, range);\n      return Optional.none();\n    });\n  };\n\n  var moveH = function (editor, forward) {\n    return getHorizontalRange(editor, forward).exists(function (newRange) {\n      moveToRange(editor, newRange);\n      return true;\n    });\n  };\n\n  var moveV = function (editor, down) {\n    return getVerticalRange(editor, down).exists(function (newRange) {\n      moveToRange(editor, newRange);\n      return true;\n    });\n  };\n\n  var moveToLineEndPoint$1 = function (editor, forward) {\n    var isCefPosition = forward ? isAfterContentEditableFalse : isBeforeContentEditableFalse;\n    return moveToLineEndPoint(editor, forward, isCefPosition);\n  };\n\n  var isTarget = function (node) {\n    return contains(['figcaption'], name(node));\n  };\n\n  var rangeBefore = function (target) {\n    var rng = document.createRange();\n    rng.setStartBefore(target.dom);\n    rng.setEndBefore(target.dom);\n    return rng;\n  };\n\n  var insertElement = function (root, elm, forward) {\n    if (forward) {\n      append(root, elm);\n    } else {\n      prepend(root, elm);\n    }\n  };\n\n  var insertBr = function (root, forward) {\n    var br = SugarElement.fromTag('br');\n    insertElement(root, br, forward);\n    return rangeBefore(br);\n  };\n\n  var insertBlock$1 = function (root, forward, blockName, attrs) {\n    var block = SugarElement.fromTag(blockName);\n    var br = SugarElement.fromTag('br');\n    setAll(block, attrs);\n    append(block, br);\n    insertElement(root, block, forward);\n    return rangeBefore(br);\n  };\n\n  var insertEmptyLine = function (root, rootBlockName, attrs, forward) {\n    if (rootBlockName === '') {\n      return insertBr(root, forward);\n    } else {\n      return insertBlock$1(root, forward, rootBlockName, attrs);\n    }\n  };\n\n  var getClosestTargetBlock = function (pos, root) {\n    var isRoot = curry(eq$2, root);\n    return closest(SugarElement.fromDom(pos.container()), isBlock, isRoot).filter(isTarget);\n  };\n\n  var isAtFirstOrLastLine = function (root, forward, pos) {\n    return forward ? isAtLastLine(root.dom, pos) : isAtFirstLine(root.dom, pos);\n  };\n\n  var moveCaretToNewEmptyLine = function (editor, forward) {\n    var root = SugarElement.fromDom(editor.getBody());\n    var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    var rootBlock = getForcedRootBlock(editor);\n    var rootBlockAttrs = getForcedRootBlockAttrs(editor);\n    return getClosestTargetBlock(pos, root).exists(function () {\n      if (isAtFirstOrLastLine(root, forward, pos)) {\n        var rng = insertEmptyLine(root, rootBlock, rootBlockAttrs, forward);\n        editor.selection.setRng(rng);\n        return true;\n      } else {\n        return false;\n      }\n    });\n  };\n\n  var moveV$1 = function (editor, forward) {\n    if (editor.selection.isCollapsed()) {\n      return moveCaretToNewEmptyLine(editor, forward);\n    } else {\n      return false;\n    }\n  };\n\n  var defaultPatterns = function (patterns) {\n    return map(patterns, function (pattern) {\n      return __assign({\n        shiftKey: false,\n        altKey: false,\n        ctrlKey: false,\n        metaKey: false,\n        keyCode: 0,\n        action: noop\n      }, pattern);\n    });\n  };\n\n  var matchesEvent = function (pattern, evt) {\n    return evt.keyCode === pattern.keyCode && evt.shiftKey === pattern.shiftKey && evt.altKey === pattern.altKey && evt.ctrlKey === pattern.ctrlKey && evt.metaKey === pattern.metaKey;\n  };\n\n  var match$1 = function (patterns, evt) {\n    return bind(defaultPatterns(patterns), function (pattern) {\n      return matchesEvent(pattern, evt) ? [pattern] : [];\n    });\n  };\n\n  var action = function (f) {\n    var x = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      x[_i - 1] = arguments[_i];\n    }\n\n    return function () {\n      return f.apply(null, x);\n    };\n  };\n\n  var execute = function (patterns, evt) {\n    return find(match$1(patterns, evt), function (pattern) {\n      return pattern.action();\n    });\n  };\n\n  var moveH$1 = function (editor, forward) {\n    var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n    var range = editor.selection.getRng();\n    return moveHorizontally(editor, direction, range, isBeforeMedia, isAfterMedia, isMedia).exists(function (newRange) {\n      moveToRange(editor, newRange);\n      return true;\n    });\n  };\n\n  var moveV$2 = function (editor, down) {\n    var direction = down ? 1 : -1;\n    var range = editor.selection.getRng();\n    return moveVertically(editor, direction, range, isBeforeMedia, isAfterMedia, isMedia).exists(function (newRange) {\n      moveToRange(editor, newRange);\n      return true;\n    });\n  };\n\n  var moveToLineEndPoint$2 = function (editor, forward) {\n    var isNearMedia = forward ? isAfterMedia : isBeforeMedia;\n    return moveToLineEndPoint(editor, forward, isNearMedia);\n  };\n\n  var deflate = function (rect, delta) {\n    return {\n      left: rect.left - delta,\n      top: rect.top - delta,\n      right: rect.right + delta * 2,\n      bottom: rect.bottom + delta * 2,\n      width: rect.width + delta,\n      height: rect.height + delta\n    };\n  };\n\n  var getCorners = function (getYAxisValue, tds) {\n    return bind(tds, function (td) {\n      var rect = deflate(clone$2(td.getBoundingClientRect()), -1);\n      return [{\n        x: rect.left,\n        y: getYAxisValue(rect),\n        cell: td\n      }, {\n        x: rect.right,\n        y: getYAxisValue(rect),\n        cell: td\n      }];\n    });\n  };\n\n  var findClosestCorner = function (corners, x, y) {\n    return foldl(corners, function (acc, newCorner) {\n      return acc.fold(function () {\n        return Optional.some(newCorner);\n      }, function (oldCorner) {\n        var oldDist = Math.sqrt(Math.abs(oldCorner.x - x) + Math.abs(oldCorner.y - y));\n        var newDist = Math.sqrt(Math.abs(newCorner.x - x) + Math.abs(newCorner.y - y));\n        return Optional.some(newDist < oldDist ? newCorner : oldCorner);\n      });\n    }, Optional.none());\n  };\n\n  var getClosestCell$1 = function (getYAxisValue, isTargetCorner, table, x, y) {\n    var cells = descendants$1(SugarElement.fromDom(table), 'td,th,caption').map(function (e) {\n      return e.dom;\n    });\n    var corners = filter(getCorners(getYAxisValue, cells), function (corner) {\n      return isTargetCorner(corner, y);\n    });\n    return findClosestCorner(corners, x, y).map(function (corner) {\n      return corner.cell;\n    });\n  };\n\n  var getBottomValue = function (rect) {\n    return rect.bottom;\n  };\n\n  var getTopValue = function (rect) {\n    return rect.top;\n  };\n\n  var isAbove$1 = function (corner, y) {\n    return corner.y < y;\n  };\n\n  var isBelow$1 = function (corner, y) {\n    return corner.y > y;\n  };\n\n  var getClosestCellAbove = curry(getClosestCell$1, getBottomValue, isAbove$1);\n  var getClosestCellBelow = curry(getClosestCell$1, getTopValue, isBelow$1);\n\n  var findClosestPositionInAboveCell = function (table, pos) {\n    return head(pos.getClientRects()).bind(function (rect) {\n      return getClosestCellAbove(table, rect.left, rect.top);\n    }).bind(function (cell) {\n      return findClosestHorizontalPosition(getLastLinePositions(cell), pos);\n    });\n  };\n\n  var findClosestPositionInBelowCell = function (table, pos) {\n    return last(pos.getClientRects()).bind(function (rect) {\n      return getClosestCellBelow(table, rect.left, rect.top);\n    }).bind(function (cell) {\n      return findClosestHorizontalPosition(getFirstLinePositions(cell), pos);\n    });\n  };\n\n  var hasNextBreak = function (getPositionsUntil, scope, lineInfo) {\n    return lineInfo.breakAt.exists(function (breakPos) {\n      return getPositionsUntil(scope, breakPos).breakAt.isSome();\n    });\n  };\n\n  var startsWithWrapBreak = function (lineInfo) {\n    return lineInfo.breakType === BreakType.Wrap && lineInfo.positions.length === 0;\n  };\n\n  var startsWithBrBreak = function (lineInfo) {\n    return lineInfo.breakType === BreakType.Br && lineInfo.positions.length === 1;\n  };\n\n  var isAtTableCellLine = function (getPositionsUntil, scope, pos) {\n    var lineInfo = getPositionsUntil(scope, pos);\n\n    if (startsWithWrapBreak(lineInfo) || !isBr(pos.getNode()) && startsWithBrBreak(lineInfo)) {\n      return !hasNextBreak(getPositionsUntil, scope, lineInfo);\n    } else {\n      return lineInfo.breakAt.isNone();\n    }\n  };\n\n  var isAtFirstTableCellLine = curry(isAtTableCellLine, getPositionsUntilPreviousLine);\n  var isAtLastTableCellLine = curry(isAtTableCellLine, getPositionsUntilNextLine);\n\n  var isCaretAtStartOrEndOfTable = function (forward, rng, table) {\n    var caretPos = CaretPosition$1.fromRangeStart(rng);\n    return positionIn(!forward, table).exists(function (pos) {\n      return pos.isEqual(caretPos);\n    });\n  };\n\n  var navigateHorizontally = function (editor, forward, table, _td) {\n    var rng = editor.selection.getRng();\n    var direction = forward ? 1 : -1;\n\n    if (isFakeCaretTableBrowser() && isCaretAtStartOrEndOfTable(forward, rng, table)) {\n      showCaret(direction, editor, table, !forward, false).each(function (newRng) {\n        moveToRange(editor, newRng);\n      });\n      return true;\n    }\n\n    return false;\n  };\n\n  var getClosestAbovePosition = function (root, table, start) {\n    return findClosestPositionInAboveCell(table, start).orThunk(function () {\n      return head(start.getClientRects()).bind(function (rect) {\n        return findClosestHorizontalPositionFromPoint(getPositionsAbove(root, CaretPosition$1.before(table)), rect.left);\n      });\n    }).getOr(CaretPosition$1.before(table));\n  };\n\n  var getClosestBelowPosition = function (root, table, start) {\n    return findClosestPositionInBelowCell(table, start).orThunk(function () {\n      return head(start.getClientRects()).bind(function (rect) {\n        return findClosestHorizontalPositionFromPoint(getPositionsBelow(root, CaretPosition$1.after(table)), rect.left);\n      });\n    }).getOr(CaretPosition$1.after(table));\n  };\n\n  var getTable = function (previous, pos) {\n    var node = pos.getNode(previous);\n    return isElement$1(node) && node.nodeName === 'TABLE' ? Optional.some(node) : Optional.none();\n  };\n\n  var renderBlock = function (down, editor, table, pos) {\n    var forcedRootBlock = getForcedRootBlock(editor);\n\n    if (forcedRootBlock) {\n      editor.undoManager.transact(function () {\n        var element = SugarElement.fromTag(forcedRootBlock);\n        setAll(element, getForcedRootBlockAttrs(editor));\n        append(element, SugarElement.fromTag('br'));\n\n        if (down) {\n          after(SugarElement.fromDom(table), element);\n        } else {\n          before(SugarElement.fromDom(table), element);\n        }\n\n        var rng = editor.dom.createRng();\n        rng.setStart(element.dom, 0);\n        rng.setEnd(element.dom, 0);\n        moveToRange(editor, rng);\n      });\n    } else {\n      moveToRange(editor, pos.toRange());\n    }\n  };\n\n  var moveCaret = function (editor, down, pos) {\n    var table = down ? getTable(true, pos) : getTable(false, pos);\n    var last = down === false;\n    table.fold(function () {\n      return moveToRange(editor, pos.toRange());\n    }, function (table) {\n      return positionIn(last, editor.getBody()).filter(function (lastPos) {\n        return lastPos.isEqual(pos);\n      }).fold(function () {\n        return moveToRange(editor, pos.toRange());\n      }, function (_) {\n        return renderBlock(down, editor, table, pos);\n      });\n    });\n  };\n\n  var navigateVertically = function (editor, down, table, td) {\n    var rng = editor.selection.getRng();\n    var pos = CaretPosition$1.fromRangeStart(rng);\n    var root = editor.getBody();\n\n    if (!down && isAtFirstTableCellLine(td, pos)) {\n      var newPos = getClosestAbovePosition(root, table, pos);\n      moveCaret(editor, down, newPos);\n      return true;\n    } else if (down && isAtLastTableCellLine(td, pos)) {\n      var newPos = getClosestBelowPosition(root, table, pos);\n      moveCaret(editor, down, newPos);\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  var move$1 = function (editor, forward, mover) {\n    return Optional.from(editor.dom.getParent(editor.selection.getNode(), 'td,th')).bind(function (td) {\n      return Optional.from(editor.dom.getParent(td, 'table')).map(function (table) {\n        return mover(editor, forward, table, td);\n      });\n    }).getOr(false);\n  };\n\n  var moveH$2 = function (editor, forward) {\n    return move$1(editor, forward, navigateHorizontally);\n  };\n\n  var moveV$3 = function (editor, forward) {\n    return move$1(editor, forward, navigateVertically);\n  };\n\n  var executeKeydownOverride = function (editor, caret, evt) {\n    var os = detect$3().os;\n    execute([{\n      keyCode: VK.RIGHT,\n      action: action(moveH, editor, true)\n    }, {\n      keyCode: VK.LEFT,\n      action: action(moveH, editor, false)\n    }, {\n      keyCode: VK.UP,\n      action: action(moveV, editor, false)\n    }, {\n      keyCode: VK.DOWN,\n      action: action(moveV, editor, true)\n    }, {\n      keyCode: VK.RIGHT,\n      action: action(moveH$2, editor, true)\n    }, {\n      keyCode: VK.LEFT,\n      action: action(moveH$2, editor, false)\n    }, {\n      keyCode: VK.UP,\n      action: action(moveV$3, editor, false)\n    }, {\n      keyCode: VK.DOWN,\n      action: action(moveV$3, editor, true)\n    }, {\n      keyCode: VK.RIGHT,\n      action: action(moveH$1, editor, true)\n    }, {\n      keyCode: VK.LEFT,\n      action: action(moveH$1, editor, false)\n    }, {\n      keyCode: VK.UP,\n      action: action(moveV$2, editor, false)\n    }, {\n      keyCode: VK.DOWN,\n      action: action(moveV$2, editor, true)\n    }, {\n      keyCode: VK.RIGHT,\n      action: action(move, editor, caret, true)\n    }, {\n      keyCode: VK.LEFT,\n      action: action(move, editor, caret, false)\n    }, {\n      keyCode: VK.RIGHT,\n      ctrlKey: !os.isOSX(),\n      altKey: os.isOSX(),\n      action: action(moveNextWord, editor, caret)\n    }, {\n      keyCode: VK.LEFT,\n      ctrlKey: !os.isOSX(),\n      altKey: os.isOSX(),\n      action: action(movePrevWord, editor, caret)\n    }, {\n      keyCode: VK.UP,\n      action: action(moveV$1, editor, false)\n    }, {\n      keyCode: VK.DOWN,\n      action: action(moveV$1, editor, true)\n    }], evt).each(function (_) {\n      evt.preventDefault();\n    });\n  };\n\n  var setup$c = function (editor, caret) {\n    editor.on('keydown', function (evt) {\n      if (evt.isDefaultPrevented() === false) {\n        executeKeydownOverride(editor, caret, evt);\n      }\n    });\n  };\n\n  var executeKeydownOverride$1 = function (editor, caret, evt) {\n    execute([{\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$9, editor, false)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$4, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$4, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$3, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$3, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$6, editor, caret, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$6, editor, caret, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$5, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$5, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$8, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$8, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$2, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$2, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$1, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$1, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$7, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$7, editor, true)\n    }], evt).each(function (_) {\n      evt.preventDefault();\n    });\n  };\n\n  var executeKeyupOverride = function (editor, evt) {\n    execute([{\n      keyCode: VK.BACKSPACE,\n      action: action(paddEmptyElement, editor)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(paddEmptyElement, editor)\n    }], evt);\n  };\n\n  var setup$d = function (editor, caret) {\n    editor.on('keydown', function (evt) {\n      if (evt.isDefaultPrevented() === false) {\n        executeKeydownOverride$1(editor, caret, evt);\n      }\n    });\n    editor.on('keyup', function (evt) {\n      if (evt.isDefaultPrevented() === false) {\n        executeKeyupOverride(editor, evt);\n      }\n    });\n  };\n\n  var firstNonWhiteSpaceNodeSibling = function (node) {\n    while (node) {\n      if (node.nodeType === 1 || node.nodeType === 3 && node.data && /[\\r\\n\\s]/.test(node.data)) {\n        return node;\n      }\n\n      node = node.nextSibling;\n    }\n  };\n\n  var moveToCaretPosition = function (editor, root) {\n    var node,\n        lastNode = root;\n    var dom = editor.dom;\n    var moveCaretBeforeOnEnterElementsMap = editor.schema.getMoveCaretBeforeOnEnterElements();\n\n    if (!root) {\n      return;\n    }\n\n    if (/^(LI|DT|DD)$/.test(root.nodeName)) {\n      var firstChild = firstNonWhiteSpaceNodeSibling(root.firstChild);\n\n      if (firstChild && /^(UL|OL|DL)$/.test(firstChild.nodeName)) {\n        root.insertBefore(dom.doc.createTextNode(nbsp), root.firstChild);\n      }\n    }\n\n    var rng = dom.createRng();\n    root.normalize();\n\n    if (root.hasChildNodes()) {\n      var walker = new DomTreeWalker(root, root);\n\n      while (node = walker.current()) {\n        if (isText$1(node)) {\n          rng.setStart(node, 0);\n          rng.setEnd(node, 0);\n          break;\n        }\n\n        if (moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]) {\n          rng.setStartBefore(node);\n          rng.setEndBefore(node);\n          break;\n        }\n\n        lastNode = node;\n        node = walker.next();\n      }\n\n      if (!node) {\n        rng.setStart(lastNode, 0);\n        rng.setEnd(lastNode, 0);\n      }\n    } else {\n      if (isBr(root)) {\n        if (root.nextSibling && dom.isBlock(root.nextSibling)) {\n          rng.setStartBefore(root);\n          rng.setEndBefore(root);\n        } else {\n          rng.setStartAfter(root);\n          rng.setEndAfter(root);\n        }\n      } else {\n        rng.setStart(root, 0);\n        rng.setEnd(root, 0);\n      }\n    }\n\n    editor.selection.setRng(rng);\n    scrollRangeIntoView(editor, rng);\n  };\n\n  var getEditableRoot = function (dom, node) {\n    var root = dom.getRoot();\n    var parent, editableRoot;\n    parent = node;\n\n    while (parent !== root && dom.getContentEditable(parent) !== 'false') {\n      if (dom.getContentEditable(parent) === 'true') {\n        editableRoot = parent;\n      }\n\n      parent = parent.parentNode;\n    }\n\n    return parent !== root ? editableRoot : root;\n  };\n\n  var getParentBlock$2 = function (editor) {\n    return Optional.from(editor.dom.getParent(editor.selection.getStart(true), editor.dom.isBlock));\n  };\n\n  var getParentBlockName = function (editor) {\n    return getParentBlock$2(editor).fold(constant(''), function (parentBlock) {\n      return parentBlock.nodeName.toUpperCase();\n    });\n  };\n\n  var isListItemParentBlock = function (editor) {\n    return getParentBlock$2(editor).filter(function (elm) {\n      return isListItem(SugarElement.fromDom(elm));\n    }).isSome();\n  };\n\n  var hasFirstChild = function (elm, name) {\n    return elm.firstChild && elm.firstChild.nodeName === name;\n  };\n\n  var hasParent$1 = function (elm, parentName) {\n    return elm && elm.parentNode && elm.parentNode.nodeName === parentName;\n  };\n\n  var isListBlock = function (elm) {\n    return elm && /^(OL|UL|LI)$/.test(elm.nodeName);\n  };\n\n  var isNestedList = function (elm) {\n    return isListBlock(elm) && isListBlock(elm.parentNode);\n  };\n\n  var getContainerBlock = function (containerBlock) {\n    var containerBlockParent = containerBlock.parentNode;\n\n    if (/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)) {\n      return containerBlockParent;\n    }\n\n    return containerBlock;\n  };\n\n  var isFirstOrLastLi = function (containerBlock, parentBlock, first) {\n    var node = containerBlock[first ? 'firstChild' : 'lastChild'];\n\n    while (node) {\n      if (isElement$1(node)) {\n        break;\n      }\n\n      node = node[first ? 'nextSibling' : 'previousSibling'];\n    }\n\n    return node === parentBlock;\n  };\n\n  var insert = function (editor, createNewBlock, containerBlock, parentBlock, newBlockName) {\n    var dom = editor.dom;\n    var rng = editor.selection.getRng();\n\n    if (containerBlock === editor.getBody()) {\n      return;\n    }\n\n    if (isNestedList(containerBlock)) {\n      newBlockName = 'LI';\n    }\n\n    var newBlock = newBlockName ? createNewBlock(newBlockName) : dom.create('BR');\n\n    if (isFirstOrLastLi(containerBlock, parentBlock, true) && isFirstOrLastLi(containerBlock, parentBlock, false)) {\n      if (hasParent$1(containerBlock, 'LI')) {\n        dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n      } else {\n        dom.replace(newBlock, containerBlock);\n      }\n    } else if (isFirstOrLastLi(containerBlock, parentBlock, true)) {\n      if (hasParent$1(containerBlock, 'LI')) {\n        dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n        newBlock.appendChild(dom.doc.createTextNode(' '));\n        newBlock.appendChild(containerBlock);\n      } else {\n        containerBlock.parentNode.insertBefore(newBlock, containerBlock);\n      }\n    } else if (isFirstOrLastLi(containerBlock, parentBlock, false)) {\n      dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n    } else {\n      containerBlock = getContainerBlock(containerBlock);\n      var tmpRng = rng.cloneRange();\n      tmpRng.setStartAfter(parentBlock);\n      tmpRng.setEndAfter(containerBlock);\n      var fragment = tmpRng.extractContents();\n\n      if (newBlockName === 'LI' && hasFirstChild(fragment, 'LI')) {\n        newBlock = fragment.firstChild;\n        dom.insertAfter(fragment, containerBlock);\n      } else {\n        dom.insertAfter(fragment, containerBlock);\n        dom.insertAfter(newBlock, containerBlock);\n      }\n    }\n\n    dom.remove(parentBlock);\n    moveToCaretPosition(editor, newBlock);\n  };\n\n  var trimZwsp = function (fragment) {\n    each(descendants(SugarElement.fromDom(fragment), isText), function (text) {\n      var rawNode = text.dom;\n      rawNode.nodeValue = trim$2(rawNode.nodeValue);\n    });\n  };\n\n  var isEmptyAnchor = function (dom, elm) {\n    return elm && elm.nodeName === 'A' && dom.isEmpty(elm);\n  };\n\n  var isTableCell$5 = function (node) {\n    return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n  };\n\n  var emptyBlock = function (elm) {\n    elm.innerHTML = '<br data-mce-bogus=\"1\">';\n  };\n\n  var containerAndSiblingName = function (container, nodeName) {\n    return container.nodeName === nodeName || container.previousSibling && container.previousSibling.nodeName === nodeName;\n  };\n\n  var canSplitBlock = function (dom, node) {\n    return node && dom.isBlock(node) && !/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName) && !/^(fixed|absolute)/i.test(node.style.position) && dom.getContentEditable(node) !== 'true';\n  };\n\n  var trimInlineElementsOnLeftSideOfBlock = function (dom, nonEmptyElementsMap, block) {\n    var node = block;\n    var firstChilds = [];\n    var i;\n\n    if (!node) {\n      return;\n    }\n\n    while (node = node.firstChild) {\n      if (dom.isBlock(node)) {\n        return;\n      }\n\n      if (isElement$1(node) && !nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n        firstChilds.push(node);\n      }\n    }\n\n    i = firstChilds.length;\n\n    while (i--) {\n      node = firstChilds[i];\n\n      if (!node.hasChildNodes() || node.firstChild === node.lastChild && node.firstChild.nodeValue === '') {\n        dom.remove(node);\n      } else {\n        if (isEmptyAnchor(dom, node)) {\n          dom.remove(node);\n        }\n      }\n    }\n  };\n\n  var normalizeZwspOffset = function (start, container, offset) {\n    if (isText$1(container) === false) {\n      return offset;\n    } else if (start) {\n      return offset === 1 && container.data.charAt(offset - 1) === ZWSP ? 0 : offset;\n    } else {\n      return offset === container.data.length - 1 && container.data.charAt(offset) === ZWSP ? container.data.length : offset;\n    }\n  };\n\n  var includeZwspInRange = function (rng) {\n    var newRng = rng.cloneRange();\n    newRng.setStart(rng.startContainer, normalizeZwspOffset(true, rng.startContainer, rng.startOffset));\n    newRng.setEnd(rng.endContainer, normalizeZwspOffset(false, rng.endContainer, rng.endOffset));\n    return newRng;\n  };\n\n  var trimLeadingLineBreaks = function (node) {\n    do {\n      if (isText$1(node)) {\n        node.nodeValue = node.nodeValue.replace(/^[\\r\\n]+/, '');\n      }\n\n      node = node.firstChild;\n    } while (node);\n  };\n\n  var getEditableRoot$1 = function (dom, node) {\n    var root = dom.getRoot();\n    var parent, editableRoot;\n    parent = node;\n\n    while (parent !== root && dom.getContentEditable(parent) !== 'false') {\n      if (dom.getContentEditable(parent) === 'true') {\n        editableRoot = parent;\n      }\n\n      parent = parent.parentNode;\n    }\n\n    return parent !== root ? editableRoot : root;\n  };\n\n  var applyAttributes = function (editor, node, forcedRootBlockAttrs) {\n    var dom = editor.dom;\n    Optional.from(forcedRootBlockAttrs.style).map(dom.parseStyle).each(function (attrStyles) {\n      var currentStyles = getAllRaw(SugarElement.fromDom(node));\n\n      var newStyles = __assign(__assign({}, currentStyles), attrStyles);\n\n      dom.setStyles(node, newStyles);\n    });\n    var attrClassesOpt = Optional.from(forcedRootBlockAttrs.class).map(function (attrClasses) {\n      return attrClasses.split(/\\s+/);\n    });\n    var currentClassesOpt = Optional.from(node.className).map(function (currentClasses) {\n      return filter(currentClasses.split(/\\s+/), function (clazz) {\n        return clazz !== '';\n      });\n    });\n    lift2(attrClassesOpt, currentClassesOpt, function (attrClasses, currentClasses) {\n      var filteredClasses = filter(currentClasses, function (clazz) {\n        return !contains(attrClasses, clazz);\n      });\n\n      var newClasses = __spreadArrays(attrClasses, filteredClasses);\n\n      dom.setAttrib(node, 'class', newClasses.join(' '));\n    });\n    var appliedAttrs = ['style', 'class'];\n    var remainingAttrs = filter$1(forcedRootBlockAttrs, function (_, attrs) {\n      return !contains(appliedAttrs, attrs);\n    });\n    dom.setAttribs(node, remainingAttrs);\n  };\n\n  var setForcedBlockAttrs = function (editor, node) {\n    var forcedRootBlockName = getForcedRootBlock(editor);\n\n    if (forcedRootBlockName && forcedRootBlockName.toLowerCase() === node.tagName.toLowerCase()) {\n      var forcedRootBlockAttrs = getForcedRootBlockAttrs(editor);\n      applyAttributes(editor, node, forcedRootBlockAttrs);\n    }\n  };\n\n  var wrapSelfAndSiblingsInDefaultBlock = function (editor, newBlockName, rng, container, offset) {\n    var newBlock, parentBlock, startNode, node, next, rootBlockName;\n    var blockName = newBlockName || 'P';\n    var dom = editor.dom,\n        editableRoot = getEditableRoot$1(dom, container);\n    parentBlock = dom.getParent(container, dom.isBlock);\n\n    if (!parentBlock || !canSplitBlock(dom, parentBlock)) {\n      parentBlock = parentBlock || editableRoot;\n\n      if (parentBlock === editor.getBody() || isTableCell$5(parentBlock)) {\n        rootBlockName = parentBlock.nodeName.toLowerCase();\n      } else {\n        rootBlockName = parentBlock.parentNode.nodeName.toLowerCase();\n      }\n\n      if (!parentBlock.hasChildNodes()) {\n        newBlock = dom.create(blockName);\n        setForcedBlockAttrs(editor, newBlock);\n        parentBlock.appendChild(newBlock);\n        rng.setStart(newBlock, 0);\n        rng.setEnd(newBlock, 0);\n        return newBlock;\n      }\n\n      node = container;\n\n      while (node.parentNode !== parentBlock) {\n        node = node.parentNode;\n      }\n\n      while (node && !dom.isBlock(node)) {\n        startNode = node;\n        node = node.previousSibling;\n      }\n\n      if (startNode && editor.schema.isValidChild(rootBlockName, blockName.toLowerCase())) {\n        newBlock = dom.create(blockName);\n        setForcedBlockAttrs(editor, newBlock);\n        startNode.parentNode.insertBefore(newBlock, startNode);\n        node = startNode;\n\n        while (node && !dom.isBlock(node)) {\n          next = node.nextSibling;\n          newBlock.appendChild(node);\n          node = next;\n        }\n\n        rng.setStart(container, offset);\n        rng.setEnd(container, offset);\n      }\n    }\n\n    return container;\n  };\n\n  var addBrToBlockIfNeeded = function (dom, block) {\n    block.normalize();\n    var lastChild = block.lastChild;\n\n    if (!lastChild || /^(left|right)$/gi.test(dom.getStyle(lastChild, 'float', true))) {\n      dom.add(block, 'br');\n    }\n  };\n\n  var insert$1 = function (editor, evt) {\n    var tmpRng, container, offset, parentBlock;\n    var newBlock, fragment, containerBlock, parentBlockName, newBlockName, isAfterLastNodeInContainer;\n    var dom = editor.dom;\n    var schema = editor.schema,\n        nonEmptyElementsMap = schema.getNonEmptyElements();\n    var rng = editor.selection.getRng();\n\n    var createNewBlock = function (name) {\n      var node = container,\n          block,\n          clonedNode,\n          caretNode;\n      var textInlineElements = schema.getTextInlineElements();\n\n      if (name || parentBlockName === 'TABLE' || parentBlockName === 'HR') {\n        block = dom.create(name || newBlockName);\n      } else {\n        block = parentBlock.cloneNode(false);\n      }\n\n      caretNode = block;\n\n      if (shouldKeepStyles(editor) === false) {\n        dom.setAttrib(block, 'style', null);\n        dom.setAttrib(block, 'class', null);\n      } else {\n        do {\n          if (textInlineElements[node.nodeName]) {\n            if (isCaretNode(node) || isBookmarkNode$1(node)) {\n              continue;\n            }\n\n            clonedNode = node.cloneNode(false);\n            dom.setAttrib(clonedNode, 'id', '');\n\n            if (block.hasChildNodes()) {\n              clonedNode.appendChild(block.firstChild);\n              block.appendChild(clonedNode);\n            } else {\n              caretNode = clonedNode;\n              block.appendChild(clonedNode);\n            }\n          }\n        } while ((node = node.parentNode) && node !== editableRoot);\n      }\n\n      setForcedBlockAttrs(editor, block);\n      emptyBlock(caretNode);\n      return block;\n    };\n\n    var isCaretAtStartOrEndOfBlock = function (start) {\n      var node, name;\n      var normalizedOffset = normalizeZwspOffset(start, container, offset);\n\n      if (isText$1(container) && (start ? normalizedOffset > 0 : normalizedOffset < container.nodeValue.length)) {\n        return false;\n      }\n\n      if (container.parentNode === parentBlock && isAfterLastNodeInContainer && !start) {\n        return true;\n      }\n\n      if (start && isElement$1(container) && container === parentBlock.firstChild) {\n        return true;\n      }\n\n      if (containerAndSiblingName(container, 'TABLE') || containerAndSiblingName(container, 'HR')) {\n        return isAfterLastNodeInContainer && !start || !isAfterLastNodeInContainer && start;\n      }\n\n      var walker = new DomTreeWalker(container, parentBlock);\n\n      if (isText$1(container)) {\n        if (start && normalizedOffset === 0) {\n          walker.prev();\n        } else if (!start && normalizedOffset === container.nodeValue.length) {\n          walker.next();\n        }\n      }\n\n      while (node = walker.current()) {\n        if (isElement$1(node)) {\n          if (!node.getAttribute('data-mce-bogus')) {\n            name = node.nodeName.toLowerCase();\n\n            if (nonEmptyElementsMap[name] && name !== 'br') {\n              return false;\n            }\n          }\n        } else if (isText$1(node) && !isWhitespaceText(node.nodeValue)) {\n          return false;\n        }\n\n        if (start) {\n          walker.prev();\n        } else {\n          walker.next();\n        }\n      }\n\n      return true;\n    };\n\n    var insertNewBlockAfter = function () {\n      if (/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName) && containerBlockName !== 'HGROUP') {\n        newBlock = createNewBlock(newBlockName);\n      } else {\n        newBlock = createNewBlock();\n      }\n\n      if (shouldEndContainerOnEmptyBlock(editor) && canSplitBlock(dom, containerBlock) && dom.isEmpty(parentBlock)) {\n        newBlock = dom.split(containerBlock, parentBlock);\n      } else {\n        dom.insertAfter(newBlock, parentBlock);\n      }\n\n      moveToCaretPosition(editor, newBlock);\n    };\n\n    normalize(dom, rng).each(function (normRng) {\n      rng.setStart(normRng.startContainer, normRng.startOffset);\n      rng.setEnd(normRng.endContainer, normRng.endOffset);\n    });\n    container = rng.startContainer;\n    offset = rng.startOffset;\n    newBlockName = getForcedRootBlock(editor);\n    var shiftKey = !!(evt && evt.shiftKey);\n    var ctrlKey = !!(evt && evt.ctrlKey);\n\n    if (isElement$1(container) && container.hasChildNodes()) {\n      isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n      container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n\n      if (isAfterLastNodeInContainer && isText$1(container)) {\n        offset = container.nodeValue.length;\n      } else {\n        offset = 0;\n      }\n    }\n\n    var editableRoot = getEditableRoot$1(dom, container);\n\n    if (!editableRoot) {\n      return;\n    }\n\n    if (newBlockName && !shiftKey || !newBlockName && shiftKey) {\n      container = wrapSelfAndSiblingsInDefaultBlock(editor, newBlockName, rng, container, offset);\n    }\n\n    parentBlock = dom.getParent(container, dom.isBlock);\n    containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n    parentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : '';\n    var containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\n\n    if (containerBlockName === 'LI' && !ctrlKey) {\n      parentBlock = containerBlock;\n      containerBlock = containerBlock.parentNode;\n      parentBlockName = containerBlockName;\n    }\n\n    if (/^(LI|DT|DD)$/.test(parentBlockName)) {\n      if (dom.isEmpty(parentBlock)) {\n        insert(editor, createNewBlock, containerBlock, parentBlock, newBlockName);\n        return;\n      }\n    }\n\n    if (newBlockName && parentBlock === editor.getBody()) {\n      return;\n    }\n\n    newBlockName = newBlockName || 'P';\n\n    if (isCaretContainerBlock(parentBlock)) {\n      newBlock = showCaretContainerBlock(parentBlock);\n\n      if (dom.isEmpty(parentBlock)) {\n        emptyBlock(parentBlock);\n      }\n\n      setForcedBlockAttrs(editor, newBlock);\n      moveToCaretPosition(editor, newBlock);\n    } else if (isCaretAtStartOrEndOfBlock()) {\n      insertNewBlockAfter();\n    } else if (isCaretAtStartOrEndOfBlock(true)) {\n      newBlock = parentBlock.parentNode.insertBefore(createNewBlock(), parentBlock);\n      moveToCaretPosition(editor, containerAndSiblingName(parentBlock, 'HR') ? newBlock : parentBlock);\n    } else {\n      tmpRng = includeZwspInRange(rng).cloneRange();\n      tmpRng.setEndAfter(parentBlock);\n      fragment = tmpRng.extractContents();\n      trimZwsp(fragment);\n      trimLeadingLineBreaks(fragment);\n      newBlock = fragment.firstChild;\n      dom.insertAfter(fragment, parentBlock);\n      trimInlineElementsOnLeftSideOfBlock(dom, nonEmptyElementsMap, newBlock);\n      addBrToBlockIfNeeded(dom, parentBlock);\n\n      if (dom.isEmpty(parentBlock)) {\n        emptyBlock(parentBlock);\n      }\n\n      newBlock.normalize();\n\n      if (dom.isEmpty(newBlock)) {\n        dom.remove(newBlock);\n        insertNewBlockAfter();\n      } else {\n        setForcedBlockAttrs(editor, newBlock);\n        moveToCaretPosition(editor, newBlock);\n      }\n    }\n\n    dom.setAttrib(newBlock, 'id', '');\n    editor.fire('NewBlock', {\n      newBlock: newBlock\n    });\n  };\n\n  var hasRightSideContent = function (schema, container, parentBlock) {\n    var walker = new DomTreeWalker(container, parentBlock);\n    var node;\n    var nonEmptyElementsMap = schema.getNonEmptyElements();\n\n    while (node = walker.next()) {\n      if (nonEmptyElementsMap[node.nodeName.toLowerCase()] || node.length > 0) {\n        return true;\n      }\n    }\n  };\n\n  var scrollToBr = function (dom, selection, brElm) {\n    var marker = dom.create('span', {}, '&nbsp;');\n    brElm.parentNode.insertBefore(marker, brElm);\n    selection.scrollIntoView(marker);\n    dom.remove(marker);\n  };\n\n  var moveSelectionToBr = function (dom, selection, brElm, extraBr) {\n    var rng = dom.createRng();\n\n    if (!extraBr) {\n      rng.setStartAfter(brElm);\n      rng.setEndAfter(brElm);\n    } else {\n      rng.setStartBefore(brElm);\n      rng.setEndBefore(brElm);\n    }\n\n    selection.setRng(rng);\n  };\n\n  var insertBrAtCaret = function (editor, evt) {\n    var selection = editor.selection;\n    var dom = editor.dom;\n    var rng = selection.getRng();\n    var brElm;\n    var extraBr;\n    normalize(dom, rng).each(function (normRng) {\n      rng.setStart(normRng.startContainer, normRng.startOffset);\n      rng.setEnd(normRng.endContainer, normRng.endOffset);\n    });\n    var offset = rng.startOffset;\n    var container = rng.startContainer;\n\n    if (container.nodeType === 1 && container.hasChildNodes()) {\n      var isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n      container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n\n      if (isAfterLastNodeInContainer && container.nodeType === 3) {\n        offset = container.nodeValue.length;\n      } else {\n        offset = 0;\n      }\n    }\n\n    var parentBlock = dom.getParent(container, dom.isBlock);\n    var containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n    var containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\n    var isControlKey = !!(evt && evt.ctrlKey);\n\n    if (containerBlockName === 'LI' && !isControlKey) {\n      parentBlock = containerBlock;\n    }\n\n    if (container && container.nodeType === 3 && offset >= container.nodeValue.length) {\n      if (!hasRightSideContent(editor.schema, container, parentBlock)) {\n        brElm = dom.create('br');\n        rng.insertNode(brElm);\n        rng.setStartAfter(brElm);\n        rng.setEndAfter(brElm);\n        extraBr = true;\n      }\n    }\n\n    brElm = dom.create('br');\n    rangeInsertNode(dom, rng, brElm);\n    scrollToBr(dom, selection, brElm);\n    moveSelectionToBr(dom, selection, brElm, extraBr);\n    editor.undoManager.add();\n  };\n\n  var insertBrBefore = function (editor, inline) {\n    var br = SugarElement.fromTag('br');\n    before(SugarElement.fromDom(inline), br);\n    editor.undoManager.add();\n  };\n\n  var insertBrAfter = function (editor, inline) {\n    if (!hasBrAfter(editor.getBody(), inline)) {\n      after(SugarElement.fromDom(inline), SugarElement.fromTag('br'));\n    }\n\n    var br = SugarElement.fromTag('br');\n    after(SugarElement.fromDom(inline), br);\n    scrollToBr(editor.dom, editor.selection, br.dom);\n    moveSelectionToBr(editor.dom, editor.selection, br.dom, false);\n    editor.undoManager.add();\n  };\n\n  var isBeforeBr$1 = function (pos) {\n    return isBr(pos.getNode());\n  };\n\n  var hasBrAfter = function (rootNode, startNode) {\n    if (isBeforeBr$1(CaretPosition$1.after(startNode))) {\n      return true;\n    } else {\n      return nextPosition(rootNode, CaretPosition$1.after(startNode)).map(function (pos) {\n        return isBr(pos.getNode());\n      }).getOr(false);\n    }\n  };\n\n  var isAnchorLink = function (elm) {\n    return elm && elm.nodeName === 'A' && 'href' in elm;\n  };\n\n  var isInsideAnchor = function (location) {\n    return location.fold(never, isAnchorLink, isAnchorLink, never);\n  };\n\n  var readInlineAnchorLocation = function (editor) {\n    var isInlineTarget$1 = curry(isInlineTarget, editor);\n    var position = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    return readLocation(isInlineTarget$1, editor.getBody(), position).filter(isInsideAnchor);\n  };\n\n  var insertBrOutsideAnchor = function (editor, location) {\n    location.fold(noop, curry(insertBrBefore, editor), curry(insertBrAfter, editor), noop);\n  };\n\n  var insert$2 = function (editor, evt) {\n    var anchorLocation = readInlineAnchorLocation(editor);\n\n    if (anchorLocation.isSome()) {\n      anchorLocation.each(curry(insertBrOutsideAnchor, editor));\n    } else {\n      insertBrAtCaret(editor, evt);\n    }\n  };\n\n  var matchesSelector = function (editor, selector) {\n    return getParentBlock$2(editor).filter(function (parentBlock) {\n      return selector.length > 0 && is$1(SugarElement.fromDom(parentBlock), selector);\n    }).isSome();\n  };\n\n  var shouldInsertBr = function (editor) {\n    return matchesSelector(editor, getBrNewLineSelector(editor));\n  };\n\n  var shouldBlockNewLine = function (editor) {\n    return matchesSelector(editor, getNoNewLineSelector(editor));\n  };\n\n  var newLineAction = Adt.generate([{\n    br: []\n  }, {\n    block: []\n  }, {\n    none: []\n  }]);\n\n  var shouldBlockNewLine$1 = function (editor, _shiftKey) {\n    return shouldBlockNewLine(editor);\n  };\n\n  var isBrMode = function (requiredState) {\n    return function (editor, _shiftKey) {\n      var brMode = getForcedRootBlock(editor) === '';\n      return brMode === requiredState;\n    };\n  };\n\n  var inListBlock = function (requiredState) {\n    return function (editor, _shiftKey) {\n      return isListItemParentBlock(editor) === requiredState;\n    };\n  };\n\n  var inBlock = function (blockName, requiredState) {\n    return function (editor, _shiftKey) {\n      var state = getParentBlockName(editor) === blockName.toUpperCase();\n      return state === requiredState;\n    };\n  };\n\n  var inPreBlock = function (requiredState) {\n    return inBlock('pre', requiredState);\n  };\n\n  var inSummaryBlock = function () {\n    return inBlock('summary', true);\n  };\n\n  var shouldPutBrInPre$1 = function (requiredState) {\n    return function (editor, _shiftKey) {\n      return shouldPutBrInPre(editor) === requiredState;\n    };\n  };\n\n  var inBrContext = function (editor, _shiftKey) {\n    return shouldInsertBr(editor);\n  };\n\n  var hasShiftKey = function (_editor, shiftKey) {\n    return shiftKey;\n  };\n\n  var canInsertIntoEditableRoot = function (editor) {\n    var forcedRootBlock = getForcedRootBlock(editor);\n    var rootEditable = getEditableRoot(editor.dom, editor.selection.getStart());\n    return rootEditable && editor.schema.isValidChild(rootEditable.nodeName, forcedRootBlock ? forcedRootBlock : 'P');\n  };\n\n  var match$2 = function (predicates, action) {\n    return function (editor, shiftKey) {\n      var isMatch = foldl(predicates, function (res, p) {\n        return res && p(editor, shiftKey);\n      }, true);\n      return isMatch ? Optional.some(action) : Optional.none();\n    };\n  };\n\n  var getAction$1 = function (editor, evt) {\n    return evaluateUntil([match$2([shouldBlockNewLine$1], newLineAction.none()), match$2([inSummaryBlock()], newLineAction.br()), match$2([inPreBlock(true), shouldPutBrInPre$1(false), hasShiftKey], newLineAction.br()), match$2([inPreBlock(true), shouldPutBrInPre$1(false)], newLineAction.block()), match$2([inPreBlock(true), shouldPutBrInPre$1(true), hasShiftKey], newLineAction.block()), match$2([inPreBlock(true), shouldPutBrInPre$1(true)], newLineAction.br()), match$2([inListBlock(true), hasShiftKey], newLineAction.br()), match$2([inListBlock(true)], newLineAction.block()), match$2([isBrMode(true), hasShiftKey, canInsertIntoEditableRoot], newLineAction.block()), match$2([isBrMode(true)], newLineAction.br()), match$2([inBrContext], newLineAction.br()), match$2([isBrMode(false), hasShiftKey], newLineAction.br()), match$2([canInsertIntoEditableRoot], newLineAction.block())], [editor, !!(evt && evt.shiftKey)]).getOr(newLineAction.none());\n  };\n\n  var insert$3 = function (editor, evt) {\n    getAction$1(editor, evt).fold(function () {\n      insert$2(editor, evt);\n    }, function () {\n      insert$1(editor, evt);\n    }, noop);\n  };\n\n  var handleEnterKeyEvent = function (editor, event) {\n    if (event.isDefaultPrevented()) {\n      return;\n    }\n\n    event.preventDefault();\n    endTypingLevelIgnoreLocks(editor.undoManager);\n    editor.undoManager.transact(function () {\n      if (editor.selection.isCollapsed() === false) {\n        editor.execCommand('Delete');\n      }\n\n      insert$3(editor, event);\n    });\n  };\n\n  var setup$e = function (editor) {\n    editor.on('keydown', function (event) {\n      if (event.keyCode === VK.ENTER) {\n        handleEnterKeyEvent(editor, event);\n      }\n    });\n  };\n\n  var executeKeydownOverride$2 = function (editor, evt) {\n    execute([{\n      keyCode: VK.END,\n      action: action(moveToLineEndPoint$1, editor, true)\n    }, {\n      keyCode: VK.HOME,\n      action: action(moveToLineEndPoint$1, editor, false)\n    }, {\n      keyCode: VK.END,\n      action: action(moveToLineEndPoint$2, editor, true)\n    }, {\n      keyCode: VK.HOME,\n      action: action(moveToLineEndPoint$2, editor, false)\n    }], evt).each(function (_) {\n      evt.preventDefault();\n    });\n  };\n\n  var setup$f = function (editor) {\n    editor.on('keydown', function (evt) {\n      if (evt.isDefaultPrevented() === false) {\n        executeKeydownOverride$2(editor, evt);\n      }\n    });\n  };\n\n  var browser$4 = detect$3().browser;\n\n  var setupIeInput = function (editor) {\n    var keypressThrotter = first(function () {\n      if (!editor.composing) {\n        normalizeNbspsInEditor(editor);\n      }\n    }, 0);\n\n    if (browser$4.isIE()) {\n      editor.on('keypress', function (_e) {\n        keypressThrotter.throttle();\n      });\n      editor.on('remove', function (_e) {\n        keypressThrotter.cancel();\n      });\n    }\n  };\n\n  var setup$g = function (editor) {\n    setupIeInput(editor);\n    editor.on('input', function (e) {\n      if (e.isComposing === false) {\n        normalizeNbspsInEditor(editor);\n      }\n    });\n  };\n\n  var insertTextAtPosition = function (text, pos) {\n    var container = pos.container();\n    var offset = pos.offset();\n\n    if (isText$1(container)) {\n      container.insertData(offset, text);\n      return Optional.some(CaretPosition(container, offset + text.length));\n    } else {\n      return getElementFromPosition(pos).map(function (elm) {\n        var textNode = SugarElement.fromText(text);\n\n        if (pos.isAtEnd()) {\n          after(elm, textNode);\n        } else {\n          before(elm, textNode);\n        }\n\n        return CaretPosition(textNode.dom, text.length);\n      });\n    }\n  };\n\n  var insertNbspAtPosition = curry(insertTextAtPosition, nbsp);\n  var insertSpaceAtPosition = curry(insertTextAtPosition, ' ');\n\n  var locationToCaretPosition = function (root) {\n    return function (location) {\n      return location.fold(function (element) {\n        return prevPosition(root.dom, CaretPosition$1.before(element));\n      }, function (element) {\n        return firstPositionIn(element);\n      }, function (element) {\n        return lastPositionIn(element);\n      }, function (element) {\n        return nextPosition(root.dom, CaretPosition$1.after(element));\n      });\n    };\n  };\n\n  var insertInlineBoundarySpaceOrNbsp = function (root, pos) {\n    return function (checkPos) {\n      return needsToHaveNbsp(root, checkPos) ? insertNbspAtPosition(pos) : insertSpaceAtPosition(pos);\n    };\n  };\n\n  var setSelection$1 = function (editor) {\n    return function (pos) {\n      editor.selection.setRng(pos.toRange());\n      editor.nodeChanged();\n      return true;\n    };\n  };\n\n  var insertSpaceOrNbspAtSelection = function (editor) {\n    var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    var root = SugarElement.fromDom(editor.getBody());\n\n    if (editor.selection.isCollapsed()) {\n      var isInlineTarget$1 = curry(isInlineTarget, editor);\n      var caretPosition = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return readLocation(isInlineTarget$1, editor.getBody(), caretPosition).bind(locationToCaretPosition(root)).bind(insertInlineBoundarySpaceOrNbsp(root, pos)).exists(setSelection$1(editor));\n    } else {\n      return false;\n    }\n  };\n\n  var executeKeydownOverride$3 = function (editor, evt) {\n    execute([{\n      keyCode: VK.SPACEBAR,\n      action: action(insertSpaceOrNbspAtSelection, editor)\n    }], evt).each(function (_) {\n      evt.preventDefault();\n    });\n  };\n\n  var setup$h = function (editor) {\n    editor.on('keydown', function (evt) {\n      if (evt.isDefaultPrevented() === false) {\n        executeKeydownOverride$3(editor, evt);\n      }\n    });\n  };\n\n  var registerKeyboardOverrides = function (editor) {\n    var caret = setupSelectedState(editor);\n    setup$b(editor);\n    setup$c(editor, caret);\n    setup$d(editor, caret);\n    setup$e(editor);\n    setup$h(editor);\n    setup$g(editor);\n    setup$f(editor);\n    return caret;\n  };\n\n  var setup$i = function (editor) {\n    if (!isRtc(editor)) {\n      return registerKeyboardOverrides(editor);\n    } else {\n      return Cell(null);\n    }\n  };\n\n  var NodeChange = function () {\n    function NodeChange(editor) {\n      this.lastPath = [];\n      this.editor = editor;\n      var lastRng;\n      var self = this;\n\n      if (!('onselectionchange' in editor.getDoc())) {\n        editor.on('NodeChange click mouseup keyup focus', function (e) {\n          var nativeRng = editor.selection.getRng();\n          var fakeRng = {\n            startContainer: nativeRng.startContainer,\n            startOffset: nativeRng.startOffset,\n            endContainer: nativeRng.endContainer,\n            endOffset: nativeRng.endOffset\n          };\n\n          if (e.type === 'nodechange' || !isEq$1(fakeRng, lastRng)) {\n            editor.fire('SelectionChange');\n          }\n\n          lastRng = fakeRng;\n        });\n      }\n\n      editor.on('contextmenu', function () {\n        editor.fire('SelectionChange');\n      });\n      editor.on('SelectionChange', function () {\n        var startElm = editor.selection.getStart(true);\n\n        if (!startElm || !Env.range && editor.selection.isCollapsed()) {\n          return;\n        }\n\n        if (hasAnyRanges(editor) && !self.isSameElementPath(startElm) && editor.dom.isChildOf(startElm, editor.getBody())) {\n          editor.nodeChanged({\n            selectionChange: true\n          });\n        }\n      });\n      editor.on('mouseup', function (e) {\n        if (!e.isDefaultPrevented() && hasAnyRanges(editor)) {\n          if (editor.selection.getNode().nodeName === 'IMG') {\n            Delay.setEditorTimeout(editor, function () {\n              editor.nodeChanged();\n            });\n          } else {\n            editor.nodeChanged();\n          }\n        }\n      });\n    }\n\n    NodeChange.prototype.nodeChanged = function (args) {\n      var selection = this.editor.selection;\n      var node, parents, root;\n\n      if (this.editor.initialized && selection && !shouldDisableNodeChange(this.editor) && !this.editor.mode.isReadOnly()) {\n        root = this.editor.getBody();\n        node = selection.getStart(true) || root;\n\n        if (node.ownerDocument !== this.editor.getDoc() || !this.editor.dom.isChildOf(node, root)) {\n          node = root;\n        }\n\n        parents = [];\n        this.editor.dom.getParent(node, function (node) {\n          if (node === root) {\n            return true;\n          }\n\n          parents.push(node);\n        });\n        args = args || {};\n        args.element = node;\n        args.parents = parents;\n        this.editor.fire('NodeChange', args);\n      }\n    };\n\n    NodeChange.prototype.isSameElementPath = function (startElm) {\n      var i;\n      var currentPath = this.editor.$(startElm).parentsUntil(this.editor.getBody()).add(startElm);\n\n      if (currentPath.length === this.lastPath.length) {\n        for (i = currentPath.length; i >= 0; i--) {\n          if (currentPath[i] !== this.lastPath[i]) {\n            break;\n          }\n        }\n\n        if (i === -1) {\n          this.lastPath = currentPath;\n          return true;\n        }\n      }\n\n      this.lastPath = currentPath;\n      return false;\n    };\n\n    return NodeChange;\n  }();\n\n  var preventSummaryToggle = function (editor) {\n    editor.on('click', function (e) {\n      if (editor.dom.getParent(e.target, 'details')) {\n        e.preventDefault();\n      }\n    });\n  };\n\n  var filterDetails = function (editor) {\n    editor.parser.addNodeFilter('details', function (elms) {\n      each(elms, function (details) {\n        details.attr('data-mce-open', details.attr('open'));\n        details.attr('open', 'open');\n      });\n    });\n    editor.serializer.addNodeFilter('details', function (elms) {\n      each(elms, function (details) {\n        var open = details.attr('data-mce-open');\n        details.attr('open', isString(open) ? open : null);\n        details.attr('data-mce-open', null);\n      });\n    });\n  };\n\n  var setup$j = function (editor) {\n    preventSummaryToggle(editor);\n    filterDetails(editor);\n  };\n\n  var isTextBlockNode = function (node) {\n    return isElement$1(node) && isTextBlock(SugarElement.fromDom(node));\n  };\n\n  var normalizeSelection$1 = function (editor) {\n    var rng = editor.selection.getRng();\n    var startPos = CaretPosition.fromRangeStart(rng);\n    var endPos = CaretPosition.fromRangeEnd(rng);\n\n    if (CaretPosition.isElementPosition(startPos)) {\n      var container = startPos.container();\n\n      if (isTextBlockNode(container)) {\n        firstPositionIn(container).each(function (pos) {\n          return rng.setStart(pos.container(), pos.offset());\n        });\n      }\n    }\n\n    if (CaretPosition.isElementPosition(endPos)) {\n      var container = startPos.container();\n\n      if (isTextBlockNode(container)) {\n        lastPositionIn(container).each(function (pos) {\n          return rng.setEnd(pos.container(), pos.offset());\n        });\n      }\n    }\n\n    editor.selection.setRng(normalize$2(rng));\n  };\n\n  var setup$k = function (editor) {\n    editor.on('click', function (e) {\n      if (e.detail >= 3) {\n        normalizeSelection$1(editor);\n      }\n    });\n  };\n\n  var value$1 = function () {\n    var subject = Cell(Optional.none());\n\n    var clear = function () {\n      return subject.set(Optional.none());\n    };\n\n    var set = function (s) {\n      return subject.set(Optional.some(s));\n    };\n\n    var isSet = function () {\n      return subject.get().isSome();\n    };\n\n    var on = function (f) {\n      return subject.get().each(f);\n    };\n\n    return {\n      clear: clear,\n      set: set,\n      isSet: isSet,\n      on: on\n    };\n  };\n\n  var getAbsolutePosition = function (elm) {\n    var clientRect = elm.getBoundingClientRect();\n    var doc = elm.ownerDocument;\n    var docElem = doc.documentElement;\n    var win = doc.defaultView;\n    return {\n      top: clientRect.top + win.pageYOffset - docElem.clientTop,\n      left: clientRect.left + win.pageXOffset - docElem.clientLeft\n    };\n  };\n\n  var getBodyPosition = function (editor) {\n    return editor.inline ? getAbsolutePosition(editor.getBody()) : {\n      left: 0,\n      top: 0\n    };\n  };\n\n  var getScrollPosition = function (editor) {\n    var body = editor.getBody();\n    return editor.inline ? {\n      left: body.scrollLeft,\n      top: body.scrollTop\n    } : {\n      left: 0,\n      top: 0\n    };\n  };\n\n  var getBodyScroll = function (editor) {\n    var body = editor.getBody(),\n        docElm = editor.getDoc().documentElement;\n    var inlineScroll = {\n      left: body.scrollLeft,\n      top: body.scrollTop\n    };\n    var iframeScroll = {\n      left: body.scrollLeft || docElm.scrollLeft,\n      top: body.scrollTop || docElm.scrollTop\n    };\n    return editor.inline ? inlineScroll : iframeScroll;\n  };\n\n  var getMousePosition = function (editor, event) {\n    if (event.target.ownerDocument !== editor.getDoc()) {\n      var iframePosition = getAbsolutePosition(editor.getContentAreaContainer());\n      var scrollPosition = getBodyScroll(editor);\n      return {\n        left: event.pageX - iframePosition.left + scrollPosition.left,\n        top: event.pageY - iframePosition.top + scrollPosition.top\n      };\n    }\n\n    return {\n      left: event.pageX,\n      top: event.pageY\n    };\n  };\n\n  var calculatePosition = function (bodyPosition, scrollPosition, mousePosition) {\n    return {\n      pageX: mousePosition.left - bodyPosition.left + scrollPosition.left,\n      pageY: mousePosition.top - bodyPosition.top + scrollPosition.top\n    };\n  };\n\n  var calc = function (editor, event) {\n    return calculatePosition(getBodyPosition(editor), getScrollPosition(editor), getMousePosition(editor, event));\n  };\n\n  var isContentEditableFalse$a = isContentEditableFalse,\n      isContentEditableTrue$3 = isContentEditableTrue;\n\n  var isDraggable = function (rootElm, elm) {\n    return isContentEditableFalse$a(elm) && elm !== rootElm;\n  };\n\n  var isValidDropTarget = function (editor, targetElement, dragElement) {\n    if (targetElement === dragElement || editor.dom.isChildOf(targetElement, dragElement)) {\n      return false;\n    }\n\n    return !isContentEditableFalse$a(targetElement);\n  };\n\n  var cloneElement = function (elm) {\n    var cloneElm = elm.cloneNode(true);\n    cloneElm.removeAttribute('data-mce-selected');\n    return cloneElm;\n  };\n\n  var createGhost = function (editor, elm, width, height) {\n    var dom = editor.dom;\n    var clonedElm = elm.cloneNode(true);\n    dom.setStyles(clonedElm, {\n      width: width,\n      height: height\n    });\n    dom.setAttrib(clonedElm, 'data-mce-selected', null);\n    var ghostElm = dom.create('div', {\n      'class': 'mce-drag-container',\n      'data-mce-bogus': 'all',\n      'unselectable': 'on',\n      'contenteditable': 'false'\n    });\n    dom.setStyles(ghostElm, {\n      position: 'absolute',\n      opacity: 0.5,\n      overflow: 'hidden',\n      border: 0,\n      padding: 0,\n      margin: 0,\n      width: width,\n      height: height\n    });\n    dom.setStyles(clonedElm, {\n      margin: 0,\n      boxSizing: 'border-box'\n    });\n    ghostElm.appendChild(clonedElm);\n    return ghostElm;\n  };\n\n  var appendGhostToBody = function (ghostElm, bodyElm) {\n    if (ghostElm.parentNode !== bodyElm) {\n      bodyElm.appendChild(ghostElm);\n    }\n  };\n\n  var moveGhost = function (ghostElm, position, width, height, maxX, maxY) {\n    var overflowX = 0,\n        overflowY = 0;\n    ghostElm.style.left = position.pageX + 'px';\n    ghostElm.style.top = position.pageY + 'px';\n\n    if (position.pageX + width > maxX) {\n      overflowX = position.pageX + width - maxX;\n    }\n\n    if (position.pageY + height > maxY) {\n      overflowY = position.pageY + height - maxY;\n    }\n\n    ghostElm.style.width = width - overflowX + 'px';\n    ghostElm.style.height = height - overflowY + 'px';\n  };\n\n  var removeElement = function (elm) {\n    if (elm && elm.parentNode) {\n      elm.parentNode.removeChild(elm);\n    }\n  };\n\n  var isLeftMouseButtonPressed = function (e) {\n    return e.button === 0;\n  };\n\n  var applyRelPos = function (state, position) {\n    return {\n      pageX: position.pageX - state.relX,\n      pageY: position.pageY + 5\n    };\n  };\n\n  var start$1 = function (state, editor) {\n    return function (e) {\n      if (isLeftMouseButtonPressed(e)) {\n        var ceElm = find(editor.dom.getParents(e.target), or(isContentEditableFalse$a, isContentEditableTrue$3)).getOr(null);\n\n        if (isDraggable(editor.getBody(), ceElm)) {\n          var elmPos = editor.dom.getPos(ceElm);\n          var bodyElm = editor.getBody();\n          var docElm = editor.getDoc().documentElement;\n          state.set({\n            element: ceElm,\n            dragging: false,\n            screenX: e.screenX,\n            screenY: e.screenY,\n            maxX: (editor.inline ? bodyElm.scrollWidth : docElm.offsetWidth) - 2,\n            maxY: (editor.inline ? bodyElm.scrollHeight : docElm.offsetHeight) - 2,\n            relX: e.pageX - elmPos.x,\n            relY: e.pageY - elmPos.y,\n            width: ceElm.offsetWidth,\n            height: ceElm.offsetHeight,\n            ghost: createGhost(editor, ceElm, ceElm.offsetWidth, ceElm.offsetHeight)\n          });\n        }\n      }\n    };\n  };\n\n  var move$2 = function (state, editor) {\n    var throttledPlaceCaretAt = Delay.throttle(function (clientX, clientY) {\n      editor._selectionOverrides.hideFakeCaret();\n\n      editor.selection.placeCaretAt(clientX, clientY);\n    }, 0);\n    editor.on('remove', throttledPlaceCaretAt.stop);\n    return function (e) {\n      return state.on(function (state) {\n        var movement = Math.max(Math.abs(e.screenX - state.screenX), Math.abs(e.screenY - state.screenY));\n\n        if (!state.dragging && movement > 10) {\n          var args = editor.fire('dragstart', {\n            target: state.element\n          });\n\n          if (args.isDefaultPrevented()) {\n            return;\n          }\n\n          state.dragging = true;\n          editor.focus();\n        }\n\n        if (state.dragging) {\n          var targetPos = applyRelPos(state, calc(editor, e));\n          appendGhostToBody(state.ghost, editor.getBody());\n          moveGhost(state.ghost, targetPos, state.width, state.height, state.maxX, state.maxY);\n          throttledPlaceCaretAt(e.clientX, e.clientY);\n        }\n      });\n    };\n  };\n\n  var getRawTarget = function (selection) {\n    var rng = selection.getSel().getRangeAt(0);\n    var startContainer = rng.startContainer;\n    return startContainer.nodeType === 3 ? startContainer.parentNode : startContainer;\n  };\n\n  var drop = function (state, editor) {\n    return function (e) {\n      state.on(function (state) {\n        if (state.dragging) {\n          if (isValidDropTarget(editor, getRawTarget(editor.selection), state.element)) {\n            var targetClone_1 = cloneElement(state.element);\n            var args = editor.fire('drop', {\n              clientX: e.clientX,\n              clientY: e.clientY\n            });\n\n            if (!args.isDefaultPrevented()) {\n              editor.undoManager.transact(function () {\n                removeElement(state.element);\n                editor.insertContent(editor.dom.getOuterHTML(targetClone_1));\n\n                editor._selectionOverrides.hideFakeCaret();\n              });\n            }\n          }\n        }\n      });\n      removeDragState(state);\n    };\n  };\n\n  var stop = function (state, editor) {\n    return function () {\n      state.on(function (state) {\n        if (state.dragging) {\n          editor.fire('dragend');\n        }\n      });\n      removeDragState(state);\n    };\n  };\n\n  var removeDragState = function (state) {\n    state.on(function (state) {\n      removeElement(state.ghost);\n    });\n    state.clear();\n  };\n\n  var bindFakeDragEvents = function (editor) {\n    var state = value$1();\n    var pageDom = DOMUtils$1.DOM;\n    var rootDocument = document;\n    var dragStartHandler = start$1(state, editor);\n    var dragHandler = move$2(state, editor);\n    var dropHandler = drop(state, editor);\n    var dragEndHandler = stop(state, editor);\n    editor.on('mousedown', dragStartHandler);\n    editor.on('mousemove', dragHandler);\n    editor.on('mouseup', dropHandler);\n    pageDom.bind(rootDocument, 'mousemove', dragHandler);\n    pageDom.bind(rootDocument, 'mouseup', dragEndHandler);\n    editor.on('remove', function () {\n      pageDom.unbind(rootDocument, 'mousemove', dragHandler);\n      pageDom.unbind(rootDocument, 'mouseup', dragEndHandler);\n    });\n  };\n\n  var blockIeDrop = function (editor) {\n    editor.on('drop', function (e) {\n      var realTarget = typeof e.clientX !== 'undefined' ? editor.getDoc().elementFromPoint(e.clientX, e.clientY) : null;\n\n      if (isContentEditableFalse$a(realTarget) || editor.dom.getContentEditableParent(realTarget) === 'false') {\n        e.preventDefault();\n      }\n    });\n  };\n\n  var blockUnsupportedFileDrop = function (editor) {\n    var preventFileDrop = function (e) {\n      if (!e.defaultPrevented) {\n        var dataTransfer = e.dataTransfer;\n\n        if (dataTransfer && (contains(dataTransfer.types, 'Files') || dataTransfer.files.length > 0)) {\n          e.preventDefault();\n\n          if (e.type === 'drop') {\n            displayError(editor, 'Dropped file type is not supported');\n          }\n        }\n      }\n    };\n\n    var preventFileDropIfUIElement = function (e) {\n      if (isUIElement(editor, e.target)) {\n        preventFileDrop(e);\n      }\n    };\n\n    var setup = function () {\n      var pageDom = DOMUtils$1.DOM;\n      var dom = editor.dom;\n      var doc = document;\n      var editorRoot = editor.inline ? editor.getBody() : editor.getDoc();\n      var eventNames = ['drop', 'dragover'];\n      each(eventNames, function (name) {\n        pageDom.bind(doc, name, preventFileDropIfUIElement);\n        dom.bind(editorRoot, name, preventFileDrop);\n      });\n      editor.on('remove', function () {\n        each(eventNames, function (name) {\n          pageDom.unbind(doc, name, preventFileDropIfUIElement);\n          dom.unbind(editorRoot, name, preventFileDrop);\n        });\n      });\n    };\n\n    editor.on('init', function () {\n      Delay.setEditorTimeout(editor, setup, 0);\n    });\n  };\n\n  var init = function (editor) {\n    bindFakeDragEvents(editor);\n    blockIeDrop(editor);\n\n    if (shouldBlockUnsupportedDrop(editor)) {\n      blockUnsupportedFileDrop(editor);\n    }\n  };\n\n  var setup$l = function (editor) {\n    var renderFocusCaret = first(function () {\n      if (!editor.removed && editor.getBody().contains(document.activeElement)) {\n        var rng = editor.selection.getRng();\n\n        if (rng.collapsed) {\n          var caretRange = renderRangeCaret(editor, rng, false);\n          editor.selection.setRng(caretRange);\n        }\n      }\n    }, 0);\n    editor.on('focus', function () {\n      renderFocusCaret.throttle();\n    });\n    editor.on('blur', function () {\n      renderFocusCaret.cancel();\n    });\n  };\n\n  var setup$m = function (editor) {\n    editor.on('init', function () {\n      editor.on('focusin', function (e) {\n        var target = e.target;\n\n        if (isMedia(target)) {\n          var ceRoot = getContentEditableRoot(editor.getBody(), target);\n          var node = isContentEditableFalse(ceRoot) ? ceRoot : target;\n\n          if (editor.selection.getNode() !== node) {\n            selectNode(editor, node).each(function (rng) {\n              return editor.selection.setRng(rng);\n            });\n          }\n        }\n      });\n    });\n  };\n\n  var isContentEditableTrue$4 = isContentEditableTrue;\n  var isContentEditableFalse$b = isContentEditableFalse;\n\n  var getContentEditableRoot$1 = function (editor, node) {\n    return getContentEditableRoot(editor.getBody(), node);\n  };\n\n  var SelectionOverrides = function (editor) {\n    var selection = editor.selection,\n        dom = editor.dom;\n    var isBlock = dom.isBlock;\n    var rootNode = editor.getBody();\n    var fakeCaret = FakeCaret(editor, rootNode, isBlock, function () {\n      return hasFocus$1(editor);\n    });\n    var realSelectionId = 'sel-' + dom.uniqueId();\n    var elementSelectionAttr = 'data-mce-selected';\n    var selectedElement;\n\n    var isFakeSelectionElement = function (node) {\n      return dom.hasClass(node, 'mce-offscreen-selection');\n    };\n\n    var isFakeSelectionTargetElement = function (node) {\n      return node !== rootNode && (isContentEditableFalse$b(node) || isMedia(node)) && dom.isChildOf(node, rootNode);\n    };\n\n    var isNearFakeSelectionElement = function (pos) {\n      return isBeforeContentEditableFalse(pos) || isAfterContentEditableFalse(pos) || isBeforeMedia(pos) || isAfterMedia(pos);\n    };\n\n    var getRealSelectionElement = function () {\n      var container = dom.get(realSelectionId);\n      return container ? container.getElementsByTagName('*')[0] : container;\n    };\n\n    var setRange = function (range) {\n      if (range) {\n        selection.setRng(range);\n      }\n    };\n\n    var getRange = selection.getRng;\n\n    var showCaret = function (direction, node, before, scrollIntoView) {\n      if (scrollIntoView === void 0) {\n        scrollIntoView = true;\n      }\n\n      var e = editor.fire('ShowCaret', {\n        target: node,\n        direction: direction,\n        before: before\n      });\n\n      if (e.isDefaultPrevented()) {\n        return null;\n      }\n\n      if (scrollIntoView) {\n        selection.scrollIntoView(node, direction === -1);\n      }\n\n      return fakeCaret.show(before, node);\n    };\n\n    var showBlockCaretContainer = function (blockCaretContainer) {\n      if (blockCaretContainer.hasAttribute('data-mce-caret')) {\n        showCaretContainerBlock(blockCaretContainer);\n        setRange(getRange());\n        selection.scrollIntoView(blockCaretContainer);\n      }\n    };\n\n    var registerEvents = function () {\n      editor.on('mouseup', function (e) {\n        var range = getRange();\n\n        if (range.collapsed && isXYInContentArea(editor, e.clientX, e.clientY)) {\n          renderCaretAtRange(editor, range, false).each(setRange);\n        }\n      });\n      editor.on('click', function (e) {\n        var contentEditableRoot = getContentEditableRoot$1(editor, e.target);\n\n        if (contentEditableRoot) {\n          if (isContentEditableFalse$b(contentEditableRoot)) {\n            e.preventDefault();\n            editor.focus();\n          }\n\n          if (isContentEditableTrue$4(contentEditableRoot)) {\n            if (dom.isChildOf(contentEditableRoot, selection.getNode())) {\n              removeElementSelection();\n            }\n          }\n        }\n      });\n      editor.on('blur NewBlock', removeElementSelection);\n      editor.on('ResizeWindow FullscreenStateChanged', fakeCaret.reposition);\n\n      var hasNormalCaretPosition = function (elm) {\n        var caretWalker = CaretWalker(elm);\n\n        if (!elm.firstChild) {\n          return false;\n        }\n\n        var startPos = CaretPosition$1.before(elm.firstChild);\n        var newPos = caretWalker.next(startPos);\n        return newPos && !isNearFakeSelectionElement(newPos);\n      };\n\n      var isInSameBlock = function (node1, node2) {\n        var block1 = dom.getParent(node1, isBlock);\n        var block2 = dom.getParent(node2, isBlock);\n        return block1 === block2;\n      };\n\n      var hasBetterMouseTarget = function (targetNode, caretNode) {\n        var targetBlock = dom.getParent(targetNode, isBlock);\n        var caretBlock = dom.getParent(caretNode, isBlock);\n\n        if (targetBlock && targetNode !== caretBlock && dom.isChildOf(targetBlock, caretBlock) && isContentEditableFalse$b(getContentEditableRoot$1(editor, targetBlock)) === false) {\n          return true;\n        }\n\n        return targetBlock && !isInSameBlock(targetBlock, caretBlock) && hasNormalCaretPosition(targetBlock);\n      };\n\n      editor.on('tap', function (e) {\n        var targetElm = e.target;\n        var contentEditableRoot = getContentEditableRoot$1(editor, targetElm);\n\n        if (isContentEditableFalse$b(contentEditableRoot)) {\n          e.preventDefault();\n          selectNode(editor, contentEditableRoot).each(setElementSelection);\n        } else if (isFakeSelectionTargetElement(targetElm)) {\n          selectNode(editor, targetElm).each(setElementSelection);\n        }\n      }, true);\n      editor.on('mousedown', function (e) {\n        var targetElm = e.target;\n\n        if (targetElm !== rootNode && targetElm.nodeName !== 'HTML' && !dom.isChildOf(targetElm, rootNode)) {\n          return;\n        }\n\n        if (isXYInContentArea(editor, e.clientX, e.clientY) === false) {\n          return;\n        }\n\n        var contentEditableRoot = getContentEditableRoot$1(editor, targetElm);\n\n        if (contentEditableRoot) {\n          if (isContentEditableFalse$b(contentEditableRoot)) {\n            e.preventDefault();\n            selectNode(editor, contentEditableRoot).each(setElementSelection);\n          } else {\n            removeElementSelection();\n\n            if (!(isContentEditableTrue$4(contentEditableRoot) && e.shiftKey) && !isXYWithinRange(e.clientX, e.clientY, selection.getRng())) {\n              hideFakeCaret();\n              selection.placeCaretAt(e.clientX, e.clientY);\n            }\n          }\n        } else if (isFakeSelectionTargetElement(targetElm)) {\n          selectNode(editor, targetElm).each(setElementSelection);\n        } else if (isFakeCaretTarget(targetElm) === false) {\n          removeElementSelection();\n          hideFakeCaret();\n          var fakeCaretInfo = closestFakeCaret(rootNode, e.clientX, e.clientY);\n\n          if (fakeCaretInfo) {\n            if (!hasBetterMouseTarget(targetElm, fakeCaretInfo.node)) {\n              e.preventDefault();\n              var range = showCaret(1, fakeCaretInfo.node, fakeCaretInfo.before, false);\n              editor.getBody().focus();\n              setRange(range);\n            }\n          }\n        }\n      });\n      editor.on('keypress', function (e) {\n        if (VK.modifierPressed(e)) {\n          return;\n        }\n\n        if (isContentEditableFalse$b(selection.getNode())) {\n          e.preventDefault();\n        }\n      });\n      editor.on('GetSelectionRange', function (e) {\n        var rng = e.range;\n\n        if (selectedElement) {\n          if (!selectedElement.parentNode) {\n            selectedElement = null;\n            return;\n          }\n\n          rng = rng.cloneRange();\n          rng.selectNode(selectedElement);\n          e.range = rng;\n        }\n      });\n      editor.on('SetSelectionRange', function (e) {\n        e.range = normalizeShortEndedElementSelection(e.range);\n        var rng = setElementSelection(e.range, e.forward);\n\n        if (rng) {\n          e.range = rng;\n        }\n      });\n\n      var isPasteBin = function (node) {\n        return node.id === 'mcepastebin';\n      };\n\n      editor.on('AfterSetSelectionRange', function (e) {\n        var rng = e.range;\n        var parentNode = rng.startContainer.parentNode;\n\n        if (!isRangeInCaretContainer(rng) && !isPasteBin(parentNode)) {\n          hideFakeCaret();\n        }\n\n        if (!isFakeSelectionElement(parentNode)) {\n          removeElementSelection();\n        }\n      });\n      editor.on('copy', function (e) {\n        var clipboardData = e.clipboardData;\n\n        if (!e.isDefaultPrevented() && e.clipboardData && !Env.ie) {\n          var realSelectionElement = getRealSelectionElement();\n\n          if (realSelectionElement) {\n            e.preventDefault();\n            clipboardData.clearData();\n            clipboardData.setData('text/html', realSelectionElement.outerHTML);\n            clipboardData.setData('text/plain', realSelectionElement.outerText || realSelectionElement.innerText);\n          }\n        }\n      });\n      init(editor);\n      setup$l(editor);\n      setup$m(editor);\n    };\n\n    var isWithinCaretContainer = function (node) {\n      return isCaretContainer(node) || startsWithCaretContainer(node) || endsWithCaretContainer(node);\n    };\n\n    var isRangeInCaretContainer = function (rng) {\n      return isWithinCaretContainer(rng.startContainer) || isWithinCaretContainer(rng.endContainer);\n    };\n\n    var normalizeShortEndedElementSelection = function (rng) {\n      var shortEndedElements = editor.schema.getShortEndedElements();\n      var newRng = dom.createRng();\n      var startContainer = rng.startContainer;\n      var startOffset = rng.startOffset;\n      var endContainer = rng.endContainer;\n      var endOffset = rng.endOffset;\n\n      if (has(shortEndedElements, startContainer.nodeName.toLowerCase())) {\n        if (startOffset === 0) {\n          newRng.setStartBefore(startContainer);\n        } else {\n          newRng.setStartAfter(startContainer);\n        }\n      } else {\n        newRng.setStart(startContainer, startOffset);\n      }\n\n      if (has(shortEndedElements, endContainer.nodeName.toLowerCase())) {\n        if (endOffset === 0) {\n          newRng.setEndBefore(endContainer);\n        } else {\n          newRng.setEndAfter(endContainer);\n        }\n      } else {\n        newRng.setEnd(endContainer, endOffset);\n      }\n\n      return newRng;\n    };\n\n    var setupOffscreenSelection = function (node, targetClone, origTargetClone) {\n      var $ = editor.$;\n      var $realSelectionContainer = descendant(SugarElement.fromDom(editor.getBody()), '#' + realSelectionId).fold(function () {\n        return $([]);\n      }, function (elm) {\n        return $([elm.dom]);\n      });\n\n      if ($realSelectionContainer.length === 0) {\n        $realSelectionContainer = $('<div data-mce-bogus=\"all\" class=\"mce-offscreen-selection\"></div>').attr('id', realSelectionId);\n        $realSelectionContainer.appendTo(editor.getBody());\n      }\n\n      var newRange = dom.createRng();\n\n      if (targetClone === origTargetClone && Env.ie) {\n        $realSelectionContainer.empty().append('<p style=\"font-size: 0\" data-mce-bogus=\"all\">\\xA0</p>').append(targetClone);\n        newRange.setStartAfter($realSelectionContainer[0].firstChild.firstChild);\n        newRange.setEndAfter(targetClone);\n      } else {\n        $realSelectionContainer.empty().append(nbsp).append(targetClone).append(nbsp);\n        newRange.setStart($realSelectionContainer[0].firstChild, 1);\n        newRange.setEnd($realSelectionContainer[0].lastChild, 0);\n      }\n\n      $realSelectionContainer.css({\n        top: dom.getPos(node, editor.getBody()).y\n      });\n      $realSelectionContainer[0].focus();\n      var sel = selection.getSel();\n      sel.removeAllRanges();\n      sel.addRange(newRange);\n      return newRange;\n    };\n\n    var selectElement = function (elm) {\n      var targetClone = elm.cloneNode(true);\n      var e = editor.fire('ObjectSelected', {\n        target: elm,\n        targetClone: targetClone\n      });\n\n      if (e.isDefaultPrevented()) {\n        return null;\n      }\n\n      var range = setupOffscreenSelection(elm, e.targetClone, targetClone);\n      var nodeElm = SugarElement.fromDom(elm);\n      each(descendants$1(SugarElement.fromDom(editor.getBody()), '*[data-mce-selected]'), function (elm) {\n        if (!eq$2(nodeElm, elm)) {\n          remove$1(elm, elementSelectionAttr);\n        }\n      });\n\n      if (!dom.getAttrib(elm, elementSelectionAttr)) {\n        elm.setAttribute(elementSelectionAttr, '1');\n      }\n\n      selectedElement = elm;\n      hideFakeCaret();\n      return range;\n    };\n\n    var setElementSelection = function (range, forward) {\n      if (!range) {\n        return null;\n      }\n\n      if (range.collapsed) {\n        if (!isRangeInCaretContainer(range)) {\n          var dir = forward ? 1 : -1;\n          var caretPosition = getNormalizedRangeEndPoint(dir, rootNode, range);\n          var beforeNode = caretPosition.getNode(!forward);\n\n          if (isFakeCaretTarget(beforeNode)) {\n            return showCaret(dir, beforeNode, forward ? !caretPosition.isAtEnd() : false, false);\n          }\n\n          var afterNode = caretPosition.getNode(forward);\n\n          if (isFakeCaretTarget(afterNode)) {\n            return showCaret(dir, afterNode, forward ? false : !caretPosition.isAtEnd(), false);\n          }\n        }\n\n        return null;\n      }\n\n      var startContainer = range.startContainer;\n      var startOffset = range.startOffset;\n      var endOffset = range.endOffset;\n\n      if (startContainer.nodeType === 3 && startOffset === 0 && isContentEditableFalse$b(startContainer.parentNode)) {\n        startContainer = startContainer.parentNode;\n        startOffset = dom.nodeIndex(startContainer);\n        startContainer = startContainer.parentNode;\n      }\n\n      if (startContainer.nodeType !== 1) {\n        return null;\n      }\n\n      if (endOffset === startOffset + 1 && startContainer === range.endContainer) {\n        var node = startContainer.childNodes[startOffset];\n\n        if (isFakeSelectionTargetElement(node)) {\n          return selectElement(node);\n        }\n      }\n\n      return null;\n    };\n\n    var removeElementSelection = function () {\n      if (selectedElement) {\n        selectedElement.removeAttribute(elementSelectionAttr);\n      }\n\n      descendant(SugarElement.fromDom(editor.getBody()), '#' + realSelectionId).each(remove);\n      selectedElement = null;\n    };\n\n    var destroy = function () {\n      fakeCaret.destroy();\n      selectedElement = null;\n    };\n\n    var hideFakeCaret = function () {\n      fakeCaret.hide();\n    };\n\n    if (Env.ceFalse) {\n      registerEvents();\n    }\n\n    return {\n      showCaret: showCaret,\n      showBlockCaretContainer: showBlockCaretContainer,\n      hideFakeCaret: hideFakeCaret,\n      destroy: destroy\n    };\n  };\n\n  var Quirks = function (editor) {\n    var each = Tools.each;\n    var BACKSPACE = VK.BACKSPACE,\n        DELETE = VK.DELETE,\n        dom = editor.dom,\n        selection = editor.selection,\n        parser = editor.parser;\n    var isGecko = Env.gecko,\n        isIE = Env.ie,\n        isWebKit = Env.webkit;\n    var mceInternalUrlPrefix = 'data:text/mce-internal,';\n    var mceInternalDataType = isIE ? 'Text' : 'URL';\n\n    var setEditorCommandState = function (cmd, state) {\n      try {\n        editor.getDoc().execCommand(cmd, false, state);\n      } catch (ex) {}\n    };\n\n    var isDefaultPrevented = function (e) {\n      return e.isDefaultPrevented();\n    };\n\n    var setMceInternalContent = function (e) {\n      var selectionHtml, internalContent;\n\n      if (e.dataTransfer) {\n        if (editor.selection.isCollapsed() && e.target.tagName === 'IMG') {\n          selection.select(e.target);\n        }\n\n        selectionHtml = editor.selection.getContent();\n\n        if (selectionHtml.length > 0) {\n          internalContent = mceInternalUrlPrefix + escape(editor.id) + ',' + escape(selectionHtml);\n          e.dataTransfer.setData(mceInternalDataType, internalContent);\n        }\n      }\n    };\n\n    var getMceInternalContent = function (e) {\n      var internalContent;\n\n      if (e.dataTransfer) {\n        internalContent = e.dataTransfer.getData(mceInternalDataType);\n\n        if (internalContent && internalContent.indexOf(mceInternalUrlPrefix) >= 0) {\n          internalContent = internalContent.substr(mceInternalUrlPrefix.length).split(',');\n          return {\n            id: unescape(internalContent[0]),\n            html: unescape(internalContent[1])\n          };\n        }\n      }\n\n      return null;\n    };\n\n    var insertClipboardContents = function (content, internal) {\n      if (editor.queryCommandSupported('mceInsertClipboardContent')) {\n        editor.execCommand('mceInsertClipboardContent', false, {\n          content: content,\n          internal: internal\n        });\n      } else {\n        editor.execCommand('mceInsertContent', false, content);\n      }\n    };\n\n    var emptyEditorWhenDeleting = function () {\n      var serializeRng = function (rng) {\n        var body = dom.create('body');\n        var contents = rng.cloneContents();\n        body.appendChild(contents);\n        return selection.serializer.serialize(body, {\n          format: 'html'\n        });\n      };\n\n      var allContentsSelected = function (rng) {\n        var selection = serializeRng(rng);\n        var allRng = dom.createRng();\n        allRng.selectNode(editor.getBody());\n        var allSelection = serializeRng(allRng);\n        return selection === allSelection;\n      };\n\n      editor.on('keydown', function (e) {\n        var keyCode = e.keyCode;\n        var isCollapsed, body;\n\n        if (!isDefaultPrevented(e) && (keyCode === DELETE || keyCode === BACKSPACE)) {\n          isCollapsed = editor.selection.isCollapsed();\n          body = editor.getBody();\n\n          if (isCollapsed && !dom.isEmpty(body)) {\n            return;\n          }\n\n          if (!isCollapsed && !allContentsSelected(editor.selection.getRng())) {\n            return;\n          }\n\n          e.preventDefault();\n          editor.setContent('');\n\n          if (body.firstChild && dom.isBlock(body.firstChild)) {\n            editor.selection.setCursorLocation(body.firstChild, 0);\n          } else {\n            editor.selection.setCursorLocation(body, 0);\n          }\n\n          editor.nodeChanged();\n        }\n      });\n    };\n\n    var selectAll = function () {\n      editor.shortcuts.add('meta+a', null, 'SelectAll');\n    };\n\n    var inputMethodFocus = function () {\n      if (!editor.inline) {\n        dom.bind(editor.getDoc(), 'mousedown mouseup', function (e) {\n          var rng;\n\n          if (e.target === editor.getDoc().documentElement) {\n            rng = selection.getRng();\n            editor.getBody().focus();\n\n            if (e.type === 'mousedown') {\n              if (isCaretContainer(rng.startContainer)) {\n                return;\n              }\n\n              selection.placeCaretAt(e.clientX, e.clientY);\n            } else {\n              selection.setRng(rng);\n            }\n          }\n        });\n      }\n    };\n\n    var removeHrOnBackspace = function () {\n      editor.on('keydown', function (e) {\n        if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n          if (!editor.getBody().getElementsByTagName('hr').length) {\n            return;\n          }\n\n          if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\n            var node = selection.getNode();\n            var previousSibling = node.previousSibling;\n\n            if (node.nodeName === 'HR') {\n              dom.remove(node);\n              e.preventDefault();\n              return;\n            }\n\n            if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'hr') {\n              dom.remove(previousSibling);\n              e.preventDefault();\n            }\n          }\n        }\n      });\n    };\n\n    var focusBody = function () {\n      if (!Range.prototype.getClientRects) {\n        editor.on('mousedown', function (e) {\n          if (!isDefaultPrevented(e) && e.target.nodeName === 'HTML') {\n            var body_1 = editor.getBody();\n            body_1.blur();\n            Delay.setEditorTimeout(editor, function () {\n              body_1.focus();\n            });\n          }\n        });\n      }\n    };\n\n    var selectControlElements = function () {\n      editor.on('click', function (e) {\n        var target = e.target;\n\n        if (/^(IMG|HR)$/.test(target.nodeName) && dom.getContentEditableParent(target) !== 'false') {\n          e.preventDefault();\n          editor.selection.select(target);\n          editor.nodeChanged();\n        }\n\n        if (target.nodeName === 'A' && dom.hasClass(target, 'mce-item-anchor')) {\n          e.preventDefault();\n          selection.select(target);\n        }\n      });\n    };\n\n    var removeStylesWhenDeletingAcrossBlockElements = function () {\n      var getAttributeApplyFunction = function () {\n        var template = dom.getAttribs(selection.getStart().cloneNode(false));\n        return function () {\n          var target = selection.getStart();\n\n          if (target !== editor.getBody()) {\n            dom.setAttrib(target, 'style', null);\n            each(template, function (attr) {\n              target.setAttributeNode(attr.cloneNode(true));\n            });\n          }\n        };\n      };\n\n      var isSelectionAcrossElements = function () {\n        return !selection.isCollapsed() && dom.getParent(selection.getStart(), dom.isBlock) !== dom.getParent(selection.getEnd(), dom.isBlock);\n      };\n\n      editor.on('keypress', function (e) {\n        var applyAttributes;\n\n        if (!isDefaultPrevented(e) && (e.keyCode === 8 || e.keyCode === 46) && isSelectionAcrossElements()) {\n          applyAttributes = getAttributeApplyFunction();\n          editor.getDoc().execCommand('delete', false, null);\n          applyAttributes();\n          e.preventDefault();\n          return false;\n        }\n      });\n      dom.bind(editor.getDoc(), 'cut', function (e) {\n        var applyAttributes;\n\n        if (!isDefaultPrevented(e) && isSelectionAcrossElements()) {\n          applyAttributes = getAttributeApplyFunction();\n          Delay.setEditorTimeout(editor, function () {\n            applyAttributes();\n          });\n        }\n      });\n    };\n\n    var disableBackspaceIntoATable = function () {\n      editor.on('keydown', function (e) {\n        if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n          if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\n            var previousSibling = selection.getNode().previousSibling;\n\n            if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'table') {\n              e.preventDefault();\n              return false;\n            }\n          }\n        }\n      });\n    };\n\n    var removeBlockQuoteOnBackSpace = function () {\n      editor.on('keydown', function (e) {\n        var rng, parent;\n\n        if (isDefaultPrevented(e) || e.keyCode !== VK.BACKSPACE) {\n          return;\n        }\n\n        rng = selection.getRng();\n        var container = rng.startContainer;\n        var offset = rng.startOffset;\n        var root = dom.getRoot();\n        parent = container;\n\n        if (!rng.collapsed || offset !== 0) {\n          return;\n        }\n\n        while (parent && parent.parentNode && parent.parentNode.firstChild === parent && parent.parentNode !== root) {\n          parent = parent.parentNode;\n        }\n\n        if (parent.tagName === 'BLOCKQUOTE') {\n          editor.formatter.toggle('blockquote', null, parent);\n          rng = dom.createRng();\n          rng.setStart(container, 0);\n          rng.setEnd(container, 0);\n          selection.setRng(rng);\n        }\n      });\n    };\n\n    var setGeckoEditingOptions = function () {\n      var setOpts = function () {\n        setEditorCommandState('StyleWithCSS', false);\n        setEditorCommandState('enableInlineTableEditing', false);\n\n        if (!getObjectResizing(editor)) {\n          setEditorCommandState('enableObjectResizing', false);\n        }\n      };\n\n      if (!isReadOnly(editor)) {\n        editor.on('BeforeExecCommand mousedown', setOpts);\n      }\n    };\n\n    var addBrAfterLastLinks = function () {\n      var fixLinks = function () {\n        each(dom.select('a'), function (node) {\n          var parentNode = node.parentNode;\n          var root = dom.getRoot();\n\n          if (parentNode.lastChild === node) {\n            while (parentNode && !dom.isBlock(parentNode)) {\n              if (parentNode.parentNode.lastChild !== parentNode || parentNode === root) {\n                return;\n              }\n\n              parentNode = parentNode.parentNode;\n            }\n\n            dom.add(parentNode, 'br', {\n              'data-mce-bogus': 1\n            });\n          }\n        });\n      };\n\n      editor.on('SetContent ExecCommand', function (e) {\n        if (e.type === 'setcontent' || e.command === 'mceInsertLink') {\n          fixLinks();\n        }\n      });\n    };\n\n    var setDefaultBlockType = function () {\n      if (getForcedRootBlock(editor)) {\n        editor.on('init', function () {\n          setEditorCommandState('DefaultParagraphSeparator', getForcedRootBlock(editor));\n        });\n      }\n    };\n\n    var normalizeSelection = function () {\n      editor.on('keyup focusin mouseup', function (e) {\n        if (!VK.modifierPressed(e)) {\n          selection.normalize();\n        }\n      }, true);\n    };\n\n    var showBrokenImageIcon = function () {\n      editor.contentStyles.push('img:-moz-broken {' + '-moz-force-broken-image-icon:1;' + 'min-width:24px;' + 'min-height:24px' + '}');\n    };\n\n    var restoreFocusOnKeyDown = function () {\n      if (!editor.inline) {\n        editor.on('keydown', function () {\n          if (document.activeElement === document.body) {\n            editor.getWin().focus();\n          }\n        });\n      }\n    };\n\n    var bodyHeight = function () {\n      if (!editor.inline) {\n        editor.contentStyles.push('body {min-height: 150px}');\n        editor.on('click', function (e) {\n          var rng;\n\n          if (e.target.nodeName === 'HTML') {\n            if (Env.ie > 11) {\n              editor.getBody().focus();\n              return;\n            }\n\n            rng = editor.selection.getRng();\n            editor.getBody().focus();\n            editor.selection.setRng(rng);\n            editor.selection.normalize();\n            editor.nodeChanged();\n          }\n        });\n      }\n    };\n\n    var blockCmdArrowNavigation = function () {\n      if (Env.mac) {\n        editor.on('keydown', function (e) {\n          if (VK.metaKeyPressed(e) && !e.shiftKey && (e.keyCode === 37 || e.keyCode === 39)) {\n            e.preventDefault();\n            var selection_1 = editor.selection.getSel();\n            selection_1.modify('move', e.keyCode === 37 ? 'backward' : 'forward', 'lineboundary');\n          }\n        });\n      }\n    };\n\n    var disableAutoUrlDetect = function () {\n      setEditorCommandState('AutoUrlDetect', false);\n    };\n\n    var tapLinksAndImages = function () {\n      editor.on('click', function (e) {\n        var elm = e.target;\n\n        do {\n          if (elm.tagName === 'A') {\n            e.preventDefault();\n            return;\n          }\n        } while (elm = elm.parentNode);\n      });\n      editor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');\n    };\n\n    var blockFormSubmitInsideEditor = function () {\n      editor.on('init', function () {\n        editor.dom.bind(editor.getBody(), 'submit', function (e) {\n          e.preventDefault();\n        });\n      });\n    };\n\n    var removeAppleInterchangeBrs = function () {\n      parser.addNodeFilter('br', function (nodes) {\n        var i = nodes.length;\n\n        while (i--) {\n          if (nodes[i].attr('class') === 'Apple-interchange-newline') {\n            nodes[i].remove();\n          }\n        }\n      });\n    };\n\n    var ieInternalDragAndDrop = function () {\n      editor.on('dragstart', function (e) {\n        setMceInternalContent(e);\n      });\n      editor.on('drop', function (e) {\n        if (!isDefaultPrevented(e)) {\n          var internalContent = getMceInternalContent(e);\n\n          if (internalContent && internalContent.id !== editor.id) {\n            e.preventDefault();\n            var rng = fromPoint$1(e.x, e.y, editor.getDoc());\n            selection.setRng(rng);\n            insertClipboardContents(internalContent.html, true);\n          }\n        }\n      });\n    };\n\n    var refreshContentEditable = function () {};\n\n    var isHidden = function () {\n      if (!isGecko || editor.removed) {\n        return false;\n      }\n\n      var sel = editor.selection.getSel();\n      return !sel || !sel.rangeCount || sel.rangeCount === 0;\n    };\n\n    removeBlockQuoteOnBackSpace();\n    emptyEditorWhenDeleting();\n\n    if (!Env.windowsPhone) {\n      normalizeSelection();\n    }\n\n    if (isWebKit) {\n      inputMethodFocus();\n      selectControlElements();\n      setDefaultBlockType();\n      blockFormSubmitInsideEditor();\n      disableBackspaceIntoATable();\n      removeAppleInterchangeBrs();\n\n      if (Env.iOS) {\n        restoreFocusOnKeyDown();\n        bodyHeight();\n        tapLinksAndImages();\n      } else {\n        selectAll();\n      }\n    }\n\n    if (Env.ie >= 11) {\n      bodyHeight();\n      disableBackspaceIntoATable();\n    }\n\n    if (Env.ie) {\n      selectAll();\n      disableAutoUrlDetect();\n      ieInternalDragAndDrop();\n    }\n\n    if (isGecko) {\n      removeHrOnBackspace();\n      focusBody();\n      removeStylesWhenDeletingAcrossBlockElements();\n      setGeckoEditingOptions();\n      addBrAfterLastLinks();\n      showBrokenImageIcon();\n      blockCmdArrowNavigation();\n      disableBackspaceIntoATable();\n    }\n\n    return {\n      refreshContentEditable: refreshContentEditable,\n      isHidden: isHidden\n    };\n  };\n\n  var DOM$4 = DOMUtils$1.DOM;\n\n  var appendStyle = function (editor, text) {\n    var body = SugarElement.fromDom(editor.getBody());\n    var container = getStyleContainer(getRootNode(body));\n    var style = SugarElement.fromTag('style');\n    set(style, 'type', 'text/css');\n    append(style, SugarElement.fromText(text));\n    append(container, style);\n    editor.on('remove', function () {\n      remove(style);\n    });\n  };\n\n  var getRootName = function (editor) {\n    return editor.inline ? editor.getElement().nodeName.toLowerCase() : undefined;\n  };\n\n  var removeUndefined = function (obj) {\n    return filter$1(obj, function (v) {\n      return isUndefined(v) === false;\n    });\n  };\n\n  var mkParserSettings = function (editor) {\n    var settings = editor.settings;\n    var blobCache = editor.editorUpload.blobCache;\n    return removeUndefined({\n      allow_conditional_comments: settings.allow_conditional_comments,\n      allow_html_data_urls: settings.allow_html_data_urls,\n      allow_svg_data_urls: settings.allow_svg_data_urls,\n      allow_html_in_named_anchor: settings.allow_html_in_named_anchor,\n      allow_script_urls: settings.allow_script_urls,\n      allow_unsafe_link_target: settings.allow_unsafe_link_target,\n      convert_fonts_to_spans: settings.convert_fonts_to_spans,\n      fix_list_elements: settings.fix_list_elements,\n      font_size_legacy_values: settings.font_size_legacy_values,\n      forced_root_block: settings.forced_root_block,\n      forced_root_block_attrs: settings.forced_root_block_attrs,\n      padd_empty_with_br: settings.padd_empty_with_br,\n      preserve_cdata: settings.preserve_cdata,\n      remove_trailing_brs: settings.remove_trailing_brs,\n      inline_styles: settings.inline_styles,\n      root_name: getRootName(editor),\n      validate: true,\n      blob_cache: blobCache,\n      images_dataimg_filter: settings.images_dataimg_filter\n    });\n  };\n\n  var mkSerializerSettings = function (editor) {\n    var settings = editor.settings;\n    return __assign(__assign({}, mkParserSettings(editor)), removeUndefined({\n      url_converter: settings.url_converter,\n      url_converter_scope: settings.url_converter_scope,\n      element_format: settings.element_format,\n      entities: settings.entities,\n      entity_encoding: settings.entity_encoding,\n      indent: settings.indent,\n      indent_after: settings.indent_after,\n      indent_before: settings.indent_before,\n      block_elements: settings.block_elements,\n      boolean_attributes: settings.boolean_attributes,\n      custom_elements: settings.custom_elements,\n      extended_valid_elements: settings.extended_valid_elements,\n      invalid_elements: settings.invalid_elements,\n      invalid_styles: settings.invalid_styles,\n      move_caret_before_on_enter_elements: settings.move_caret_before_on_enter_elements,\n      non_empty_elements: settings.non_empty_elements,\n      schema: settings.schema,\n      self_closing_elements: settings.self_closing_elements,\n      short_ended_elements: settings.short_ended_elements,\n      special: settings.special,\n      text_block_elements: settings.text_block_elements,\n      text_inline_elements: settings.text_inline_elements,\n      valid_children: settings.valid_children,\n      valid_classes: settings.valid_classes,\n      valid_elements: settings.valid_elements,\n      valid_styles: settings.valid_styles,\n      verify_html: settings.verify_html,\n      whitespace_elements: settings.whitespace_elements\n    }));\n  };\n\n  var createParser = function (editor) {\n    var parser = DomParser(mkParserSettings(editor), editor.schema);\n    parser.addAttributeFilter('src,href,style,tabindex', function (nodes, name) {\n      var i = nodes.length,\n          node,\n          value;\n      var dom = editor.dom;\n      var internalName = 'data-mce-' + name;\n\n      while (i--) {\n        node = nodes[i];\n        value = node.attr(name);\n\n        if (value && !node.attr(internalName)) {\n          if (value.indexOf('data:') === 0 || value.indexOf('blob:') === 0) {\n            continue;\n          }\n\n          if (name === 'style') {\n            value = dom.serializeStyle(dom.parseStyle(value), node.name);\n\n            if (!value.length) {\n              value = null;\n            }\n\n            node.attr(internalName, value);\n            node.attr(name, value);\n          } else if (name === 'tabindex') {\n            node.attr(internalName, value);\n            node.attr(name, null);\n          } else {\n            node.attr(internalName, editor.convertURL(value, name, node.name));\n          }\n        }\n      }\n    });\n    parser.addNodeFilter('script', function (nodes) {\n      var i = nodes.length;\n\n      while (i--) {\n        var node = nodes[i];\n        var type = node.attr('type') || 'no/type';\n\n        if (type.indexOf('mce-') !== 0) {\n          node.attr('type', 'mce-' + type);\n        }\n      }\n    });\n\n    if (editor.settings.preserve_cdata) {\n      parser.addNodeFilter('#cdata', function (nodes) {\n        var i = nodes.length;\n\n        while (i--) {\n          var node = nodes[i];\n          node.type = 8;\n          node.name = '#comment';\n          node.value = '[CDATA[' + editor.dom.encode(node.value) + ']]';\n        }\n      });\n    }\n\n    parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function (nodes) {\n      var i = nodes.length;\n      var nonEmptyElements = editor.schema.getNonEmptyElements();\n\n      while (i--) {\n        var node = nodes[i];\n\n        if (node.isEmpty(nonEmptyElements) && node.getAll('br').length === 0) {\n          node.append(new AstNode('br', 1)).shortEnded = true;\n        }\n      }\n    });\n    return parser;\n  };\n\n  var autoFocus = function (editor) {\n    if (editor.settings.auto_focus) {\n      Delay.setEditorTimeout(editor, function () {\n        var focusEditor;\n\n        if (editor.settings.auto_focus === true) {\n          focusEditor = editor;\n        } else {\n          focusEditor = editor.editorManager.get(editor.settings.auto_focus);\n        }\n\n        if (!focusEditor.destroyed) {\n          focusEditor.focus();\n        }\n      }, 100);\n    }\n  };\n\n  var moveSelectionToFirstCaretPosition = function (editor) {\n    var root = editor.dom.getRoot();\n\n    if (!editor.inline && (!hasAnyRanges(editor) || editor.selection.getStart(true) === root)) {\n      firstPositionIn(root).each(function (pos) {\n        var node = pos.getNode();\n        var caretPos = isTable(node) ? firstPositionIn(node).getOr(pos) : pos;\n\n        if (Env.browser.isIE()) {\n          storeNative(editor, caretPos.toRange());\n        } else {\n          editor.selection.setRng(caretPos.toRange());\n        }\n      });\n    }\n  };\n\n  var initEditor = function (editor) {\n    editor.bindPendingEventDelegates();\n    editor.initialized = true;\n    fireInit(editor);\n    editor.focus(true);\n    moveSelectionToFirstCaretPosition(editor);\n    editor.nodeChanged({\n      initial: true\n    });\n    editor.execCallback('init_instance_callback', editor);\n    autoFocus(editor);\n  };\n\n  var getStyleSheetLoader = function (editor) {\n    return editor.inline ? editor.ui.styleSheetLoader : editor.dom.styleSheetLoader;\n  };\n\n  var loadContentCss = function (editor, css) {\n    var styleSheetLoader = getStyleSheetLoader(editor);\n\n    var loaded = function () {\n      editor.on('remove', function () {\n        return styleSheetLoader.unloadAll(css);\n      });\n      initEditor(editor);\n    };\n\n    styleSheetLoader.loadAll(css, loaded, loaded);\n  };\n\n  var preInit = function (editor, rtcMode) {\n    var settings = editor.settings,\n        doc = editor.getDoc(),\n        body = editor.getBody();\n\n    if (!settings.browser_spellcheck && !settings.gecko_spellcheck) {\n      doc.body.spellcheck = false;\n      DOM$4.setAttrib(body, 'spellcheck', 'false');\n    }\n\n    editor.quirks = Quirks(editor);\n    firePostRender(editor);\n    var directionality = getDirectionality(editor);\n\n    if (directionality !== undefined) {\n      body.dir = directionality;\n    }\n\n    if (settings.protect) {\n      editor.on('BeforeSetContent', function (e) {\n        Tools.each(settings.protect, function (pattern) {\n          e.content = e.content.replace(pattern, function (str) {\n            return '<!--mce:protected ' + escape(str) + '-->';\n          });\n        });\n      });\n    }\n\n    editor.on('SetContent', function () {\n      editor.addVisual(editor.getBody());\n    });\n\n    if (rtcMode === false) {\n      editor.load({\n        initial: true,\n        format: 'html'\n      });\n    }\n\n    editor.startContent = editor.getContent({\n      format: 'raw'\n    });\n    editor.on('compositionstart compositionend', function (e) {\n      editor.composing = e.type === 'compositionstart';\n    });\n\n    if (editor.contentStyles.length > 0) {\n      var contentCssText_1 = '';\n      Tools.each(editor.contentStyles, function (style) {\n        contentCssText_1 += style + '\\r\\n';\n      });\n      editor.dom.addStyle(contentCssText_1);\n    }\n\n    loadContentCss(editor, editor.contentCSS);\n\n    if (settings.content_style) {\n      appendStyle(editor, settings.content_style);\n    }\n  };\n\n  var initContentBody = function (editor, skipWrite) {\n    var settings = editor.settings;\n    var targetElm = editor.getElement();\n    var doc = editor.getDoc();\n\n    if (!settings.inline) {\n      editor.getElement().style.visibility = editor.orgVisibility;\n    }\n\n    if (!skipWrite && !editor.inline) {\n      doc.open();\n      doc.write(editor.iframeHTML);\n      doc.close();\n    }\n\n    if (editor.inline) {\n      DOM$4.addClass(targetElm, 'mce-content-body');\n      editor.contentDocument = doc = document;\n      editor.contentWindow = window;\n      editor.bodyElement = targetElm;\n      editor.contentAreaContainer = targetElm;\n    }\n\n    var body = editor.getBody();\n    body.disabled = true;\n    editor.readonly = !!settings.readonly;\n\n    if (!editor.readonly) {\n      if (editor.inline && DOM$4.getStyle(body, 'position', true) === 'static') {\n        body.style.position = 'relative';\n      }\n\n      body.contentEditable = editor.getParam('content_editable_state', true);\n    }\n\n    body.disabled = false;\n    editor.editorUpload = EditorUpload(editor);\n    editor.schema = Schema(settings);\n    editor.dom = DOMUtils$1(doc, {\n      keep_values: true,\n      url_converter: editor.convertURL,\n      url_converter_scope: editor,\n      hex_colors: settings.force_hex_style_colors,\n      update_styles: true,\n      root_element: editor.inline ? editor.getBody() : null,\n      collect: function () {\n        return editor.inline;\n      },\n      schema: editor.schema,\n      contentCssCors: shouldUseContentCssCors(editor),\n      referrerPolicy: getReferrerPolicy(editor),\n      onSetAttrib: function (e) {\n        editor.fire('SetAttrib', e);\n      }\n    });\n    editor.parser = createParser(editor);\n    editor.serializer = DomSerializer(mkSerializerSettings(editor), editor);\n    editor.selection = EditorSelection(editor.dom, editor.getWin(), editor.serializer, editor);\n    editor.annotator = Annotator(editor);\n    editor.formatter = Formatter(editor);\n    editor.undoManager = UndoManager(editor);\n    editor._nodeChangeDispatcher = new NodeChange(editor);\n    editor._selectionOverrides = SelectionOverrides(editor);\n    setup$9(editor);\n    setup$j(editor);\n\n    if (!isRtc(editor)) {\n      setup$k(editor);\n    }\n\n    var caret = setup$i(editor);\n    setup$8(editor, caret);\n    setup$a(editor);\n    setup$7(editor);\n    firePreInit(editor);\n    setup$5(editor).fold(function () {\n      preInit(editor, false);\n    }, function (loadingRtc) {\n      editor.setProgressState(true);\n      loadingRtc.then(function (rtcMode) {\n        editor.setProgressState(false);\n        preInit(editor, rtcMode);\n      });\n    });\n  };\n\n  var DOM$5 = DOMUtils$1.DOM;\n\n  var relaxDomain = function (editor, ifr) {\n    if (document.domain !== window.location.hostname && Env.browser.isIE()) {\n      var bodyUuid = uuid('mce');\n\n      editor[bodyUuid] = function () {\n        initContentBody(editor);\n      };\n\n      var domainRelaxUrl = 'javascript:(function(){' + 'document.open();document.domain=\"' + document.domain + '\";' + 'var ed = window.parent.tinymce.get(\"' + editor.id + '\");document.write(ed.iframeHTML);' + 'document.close();ed.' + bodyUuid + '(true);})()';\n      DOM$5.setAttrib(ifr, 'src', domainRelaxUrl);\n      return true;\n    }\n\n    return false;\n  };\n\n  var createIframeElement = function (id, title, height, customAttrs) {\n    var iframe = SugarElement.fromTag('iframe');\n    setAll(iframe, customAttrs);\n    setAll(iframe, {\n      id: id + '_ifr',\n      frameBorder: '0',\n      allowTransparency: 'true',\n      title: title\n    });\n    add$3(iframe, 'tox-edit-area__iframe');\n    return iframe;\n  };\n\n  var getIframeHtml = function (editor) {\n    var iframeHTML = getDocType(editor) + '<html><head>';\n\n    if (getDocumentBaseUrl(editor) !== editor.documentBaseUrl) {\n      iframeHTML += '<base href=\"' + editor.documentBaseURI.getURI() + '\" />';\n    }\n\n    iframeHTML += '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\n    var bodyId = getBodyId(editor);\n    var bodyClass = getBodyClass(editor);\n\n    if (getContentSecurityPolicy(editor)) {\n      iframeHTML += '<meta http-equiv=\"Content-Security-Policy\" content=\"' + getContentSecurityPolicy(editor) + '\" />';\n    }\n\n    iframeHTML += '</head><body id=\"' + bodyId + '\" class=\"mce-content-body ' + bodyClass + '\" data-id=\"' + editor.id + '\"><br></body></html>';\n    return iframeHTML;\n  };\n\n  var createIframe = function (editor, o) {\n    var title = editor.editorManager.translate('Rich Text Area. Press ALT-0 for help.');\n    var ifr = createIframeElement(editor.id, title, o.height, getIframeAttrs(editor)).dom;\n\n    ifr.onload = function () {\n      ifr.onload = null;\n      editor.fire('load');\n    };\n\n    var isDomainRelaxed = relaxDomain(editor, ifr);\n    editor.contentAreaContainer = o.iframeContainer;\n    editor.iframeElement = ifr;\n    editor.iframeHTML = getIframeHtml(editor);\n    DOM$5.add(o.iframeContainer, ifr);\n    return isDomainRelaxed;\n  };\n\n  var init$1 = function (editor, boxInfo) {\n    var isDomainRelaxed = createIframe(editor, boxInfo);\n\n    if (boxInfo.editorContainer) {\n      DOM$5.get(boxInfo.editorContainer).style.display = editor.orgDisplay;\n      editor.hidden = DOM$5.isHidden(boxInfo.editorContainer);\n    }\n\n    editor.getElement().style.display = 'none';\n    DOM$5.setAttrib(editor.id, 'aria-hidden', 'true');\n\n    if (!isDomainRelaxed) {\n      initContentBody(editor);\n    }\n  };\n\n  var DOM$6 = DOMUtils$1.DOM;\n\n  var initPlugin = function (editor, initializedPlugins, plugin) {\n    var Plugin = PluginManager.get(plugin);\n    var pluginUrl = PluginManager.urls[plugin] || editor.documentBaseUrl.replace(/\\/$/, '');\n    plugin = Tools.trim(plugin);\n\n    if (Plugin && Tools.inArray(initializedPlugins, plugin) === -1) {\n      Tools.each(PluginManager.dependencies(plugin), function (dep) {\n        initPlugin(editor, initializedPlugins, dep);\n      });\n\n      if (editor.plugins[plugin]) {\n        return;\n      }\n\n      try {\n        var pluginInstance = new Plugin(editor, pluginUrl, editor.$);\n        editor.plugins[plugin] = pluginInstance;\n\n        if (pluginInstance.init) {\n          pluginInstance.init(editor, pluginUrl);\n          initializedPlugins.push(plugin);\n        }\n      } catch (e) {\n        pluginInitError(editor, plugin, e);\n      }\n    }\n  };\n\n  var trimLegacyPrefix = function (name) {\n    return name.replace(/^\\-/, '');\n  };\n\n  var initPlugins = function (editor) {\n    var initializedPlugins = [];\n    Tools.each(getPlugins(editor).split(/[ ,]/), function (name) {\n      initPlugin(editor, initializedPlugins, trimLegacyPrefix(name));\n    });\n  };\n\n  var initIcons = function (editor) {\n    var iconPackName = Tools.trim(getIconPackName(editor));\n    var currentIcons = editor.ui.registry.getAll().icons;\n\n    var loadIcons = __assign(__assign({}, IconManager.get('default').icons), IconManager.get(iconPackName).icons);\n\n    each$1(loadIcons, function (svgData, icon) {\n      if (!has(currentIcons, icon)) {\n        editor.ui.registry.addIcon(icon, svgData);\n      }\n    });\n  };\n\n  var initTheme = function (editor) {\n    var theme = getTheme(editor);\n\n    if (isString(theme)) {\n      editor.settings.theme = trimLegacyPrefix(theme);\n      var Theme = ThemeManager.get(theme);\n      editor.theme = new Theme(editor, ThemeManager.urls[theme]);\n\n      if (editor.theme.init) {\n        editor.theme.init(editor, ThemeManager.urls[theme] || editor.documentBaseUrl.replace(/\\/$/, ''), editor.$);\n      }\n    } else {\n      editor.theme = {};\n    }\n  };\n\n  var renderFromLoadedTheme = function (editor) {\n    return editor.theme.renderUI();\n  };\n\n  var renderFromThemeFunc = function (editor) {\n    var elm = editor.getElement();\n    var theme = getTheme(editor);\n    var info = theme(editor, elm);\n\n    if (info.editorContainer.nodeType) {\n      info.editorContainer.id = info.editorContainer.id || editor.id + '_parent';\n    }\n\n    if (info.iframeContainer && info.iframeContainer.nodeType) {\n      info.iframeContainer.id = info.iframeContainer.id || editor.id + '_iframecontainer';\n    }\n\n    info.height = info.iframeHeight ? info.iframeHeight : elm.offsetHeight;\n    return info;\n  };\n\n  var createThemeFalseResult = function (element) {\n    return {\n      editorContainer: element,\n      iframeContainer: element,\n      api: {}\n    };\n  };\n\n  var renderThemeFalseIframe = function (targetElement) {\n    var iframeContainer = DOM$6.create('div');\n    DOM$6.insertAfter(iframeContainer, targetElement);\n    return createThemeFalseResult(iframeContainer);\n  };\n\n  var renderThemeFalse = function (editor) {\n    var targetElement = editor.getElement();\n    return editor.inline ? createThemeFalseResult(null) : renderThemeFalseIframe(targetElement);\n  };\n\n  var renderThemeUi = function (editor) {\n    var elm = editor.getElement();\n    editor.orgDisplay = elm.style.display;\n\n    if (isString(getTheme(editor))) {\n      return renderFromLoadedTheme(editor);\n    } else if (isFunction(getTheme(editor))) {\n      return renderFromThemeFunc(editor);\n    } else {\n      return renderThemeFalse(editor);\n    }\n  };\n\n  var augmentEditorUiApi = function (editor, api) {\n    var uiApiFacade = {\n      show: Optional.from(api.show).getOr(noop),\n      hide: Optional.from(api.hide).getOr(noop),\n      disable: Optional.from(api.disable).getOr(noop),\n      isDisabled: Optional.from(api.isDisabled).getOr(never),\n      enable: function () {\n        if (!editor.mode.isReadOnly()) {\n          Optional.from(api.enable).map(call);\n        }\n      }\n    };\n    editor.ui = __assign(__assign({}, editor.ui), uiApiFacade);\n  };\n\n  var init$2 = function (editor) {\n    editor.fire('ScriptsLoaded');\n    initIcons(editor);\n    initTheme(editor);\n    initPlugins(editor);\n    var renderInfo = renderThemeUi(editor);\n    augmentEditorUiApi(editor, Optional.from(renderInfo.api).getOr({}));\n    var boxInfo = {\n      editorContainer: renderInfo.editorContainer,\n      iframeContainer: renderInfo.iframeContainer\n    };\n    editor.editorContainer = boxInfo.editorContainer ? boxInfo.editorContainer : null;\n    appendContentCssFromSettings(editor);\n\n    if (editor.inline) {\n      return initContentBody(editor);\n    } else {\n      return init$1(editor, boxInfo);\n    }\n  };\n\n  var DOM$7 = DOMUtils$1.DOM;\n\n  var hasSkipLoadPrefix = function (name) {\n    return name.charAt(0) === '-';\n  };\n\n  var loadLanguage = function (scriptLoader, editor) {\n    var languageCode = getLanguageCode(editor);\n    var languageUrl = getLanguageUrl(editor);\n\n    if (I18n.hasCode(languageCode) === false && languageCode !== 'en') {\n      var url_1 = languageUrl !== '' ? languageUrl : editor.editorManager.baseURL + '/langs/' + languageCode + '.js';\n      scriptLoader.add(url_1, noop, undefined, function () {\n        languageLoadError(editor, url_1, languageCode);\n      });\n    }\n  };\n\n  var loadTheme = function (scriptLoader, editor, suffix, callback) {\n    var theme = getTheme(editor);\n\n    if (isString(theme)) {\n      if (!hasSkipLoadPrefix(theme) && !ThemeManager.urls.hasOwnProperty(theme)) {\n        var themeUrl = getThemeUrl(editor);\n\n        if (themeUrl) {\n          ThemeManager.load(theme, editor.documentBaseURI.toAbsolute(themeUrl));\n        } else {\n          ThemeManager.load(theme, 'themes/' + theme + '/theme' + suffix + '.js');\n        }\n      }\n\n      scriptLoader.loadQueue(function () {\n        ThemeManager.waitFor(theme, callback);\n      });\n    } else {\n      callback();\n    }\n  };\n\n  var getIconsUrlMetaFromUrl = function (editor) {\n    return Optional.from(getIconsUrl(editor)).filter(function (url) {\n      return url.length > 0;\n    }).map(function (url) {\n      return {\n        url: url,\n        name: Optional.none()\n      };\n    });\n  };\n\n  var getIconsUrlMetaFromName = function (editor, name, suffix) {\n    return Optional.from(name).filter(function (name) {\n      return name.length > 0 && !IconManager.has(name);\n    }).map(function (name) {\n      return {\n        url: editor.editorManager.baseURL + '/icons/' + name + '/icons' + suffix + '.js',\n        name: Optional.some(name)\n      };\n    });\n  };\n\n  var loadIcons = function (scriptLoader, editor, suffix) {\n    var defaultIconsUrl = getIconsUrlMetaFromName(editor, 'default', suffix);\n    var customIconsUrl = getIconsUrlMetaFromUrl(editor).orThunk(function () {\n      return getIconsUrlMetaFromName(editor, getIconPackName(editor), '');\n    });\n    each(cat([defaultIconsUrl, customIconsUrl]), function (urlMeta) {\n      scriptLoader.add(urlMeta.url, noop, undefined, function () {\n        iconsLoadError(editor, urlMeta.url, urlMeta.name.getOrUndefined());\n      });\n    });\n  };\n\n  var loadPlugins = function (editor, suffix) {\n    Tools.each(getExternalPlugins(editor), function (url, name) {\n      PluginManager.load(name, url, noop, undefined, function () {\n        pluginLoadError(editor, url, name);\n      });\n      editor.settings.plugins += ' ' + name;\n    });\n    Tools.each(getPlugins(editor).split(/[ ,]/), function (plugin) {\n      plugin = Tools.trim(plugin);\n\n      if (plugin && !PluginManager.urls[plugin]) {\n        if (hasSkipLoadPrefix(plugin)) {\n          plugin = plugin.substr(1, plugin.length);\n          var dependencies = PluginManager.dependencies(plugin);\n          Tools.each(dependencies, function (depPlugin) {\n            var defaultSettings = {\n              prefix: 'plugins/',\n              resource: depPlugin,\n              suffix: '/plugin' + suffix + '.js'\n            };\n            var dep = PluginManager.createUrl(defaultSettings, depPlugin);\n            PluginManager.load(dep.resource, dep, noop, undefined, function () {\n              pluginLoadError(editor, dep.prefix + dep.resource + dep.suffix, dep.resource);\n            });\n          });\n        } else {\n          var url_2 = {\n            prefix: 'plugins/',\n            resource: plugin,\n            suffix: '/plugin' + suffix + '.js'\n          };\n          PluginManager.load(plugin, url_2, noop, undefined, function () {\n            pluginLoadError(editor, url_2.prefix + url_2.resource + url_2.suffix, plugin);\n          });\n        }\n      }\n    });\n  };\n\n  var loadScripts = function (editor, suffix) {\n    var scriptLoader = ScriptLoader.ScriptLoader;\n    loadTheme(scriptLoader, editor, suffix, function () {\n      loadLanguage(scriptLoader, editor);\n      loadIcons(scriptLoader, editor, suffix);\n      loadPlugins(editor, suffix);\n      scriptLoader.loadQueue(function () {\n        if (!editor.removed) {\n          init$2(editor);\n        }\n      }, editor, function () {\n        if (!editor.removed) {\n          init$2(editor);\n        }\n      });\n    });\n  };\n\n  var getStyleSheetLoader$1 = function (element, editor) {\n    return instance.forElement(element, {\n      contentCssCors: hasContentCssCors(editor),\n      referrerPolicy: getReferrerPolicy(editor)\n    });\n  };\n\n  var render = function (editor) {\n    var id = editor.id;\n    I18n.setCode(getLanguageCode(editor));\n\n    var readyHandler = function () {\n      DOM$7.unbind(window, 'ready', readyHandler);\n      editor.render();\n    };\n\n    if (!EventUtils.Event.domLoaded) {\n      DOM$7.bind(window, 'ready', readyHandler);\n      return;\n    }\n\n    if (!editor.getElement()) {\n      return;\n    }\n\n    if (!Env.contentEditable) {\n      return;\n    }\n\n    var element = SugarElement.fromDom(editor.getElement());\n    var snapshot = clone(element);\n    editor.on('remove', function () {\n      eachr(element.dom.attributes, function (attr) {\n        return remove$1(element, attr.name);\n      });\n      setAll(element, snapshot);\n    });\n    editor.ui.styleSheetLoader = getStyleSheetLoader$1(element, editor);\n\n    if (!isInline$1(editor)) {\n      editor.orgVisibility = editor.getElement().style.visibility;\n      editor.getElement().style.visibility = 'hidden';\n    } else {\n      editor.inline = true;\n    }\n\n    var form = editor.getElement().form || DOM$7.getParent(id, 'form');\n\n    if (form) {\n      editor.formElement = form;\n\n      if (hasHiddenInput(editor) && !isTextareaOrInput(editor.getElement())) {\n        DOM$7.insertAfter(DOM$7.create('input', {\n          type: 'hidden',\n          name: id\n        }), id);\n        editor.hasHiddenInput = true;\n      }\n\n      editor.formEventDelegate = function (e) {\n        editor.fire(e.type, e);\n      };\n\n      DOM$7.bind(form, 'submit reset', editor.formEventDelegate);\n      editor.on('reset', function () {\n        editor.resetContent();\n      });\n\n      if (shouldPatchSubmit(editor) && !form.submit.nodeType && !form.submit.length && !form._mceOldSubmit) {\n        form._mceOldSubmit = form.submit;\n\n        form.submit = function () {\n          editor.editorManager.triggerSave();\n          editor.setDirty(false);\n          return form._mceOldSubmit(form);\n        };\n      }\n    }\n\n    editor.windowManager = WindowManager(editor);\n    editor.notificationManager = NotificationManager(editor);\n\n    if (isEncodingXml(editor)) {\n      editor.on('GetContent', function (e) {\n        if (e.save) {\n          e.content = DOM$7.encode(e.content);\n        }\n      });\n    }\n\n    if (shouldAddFormSubmitTrigger(editor)) {\n      editor.on('submit', function () {\n        if (editor.initialized) {\n          editor.save();\n        }\n      });\n    }\n\n    if (shouldAddUnloadTrigger(editor)) {\n      editor._beforeUnload = function () {\n        if (editor.initialized && !editor.destroyed && !editor.isHidden()) {\n          editor.save({\n            format: 'raw',\n            no_events: true,\n            set_dirty: false\n          });\n        }\n      };\n\n      editor.editorManager.on('BeforeUnload', editor._beforeUnload);\n    }\n\n    editor.editorManager.add(editor);\n    loadScripts(editor, editor.suffix);\n  };\n\n  var addVisual$1 = function (editor, elm) {\n    return addVisual(editor, elm);\n  };\n\n  var legacyPropNames = {\n    'font-size': 'size',\n    'font-family': 'face'\n  };\n\n  var getSpecifiedFontProp = function (propName, rootElm, elm) {\n    var getProperty = function (elm) {\n      return getRaw(elm, propName).orThunk(function () {\n        if (name(elm) === 'font') {\n          return get$1(legacyPropNames, propName).bind(function (legacyPropName) {\n            return getOpt(elm, legacyPropName);\n          });\n        } else {\n          return Optional.none();\n        }\n      });\n    };\n\n    var isRoot = function (elm) {\n      return eq$2(SugarElement.fromDom(rootElm), elm);\n    };\n\n    return closest$2(SugarElement.fromDom(elm), function (elm) {\n      return getProperty(elm);\n    }, isRoot);\n  };\n\n  var normalizeFontFamily = function (fontFamily) {\n    return fontFamily.replace(/[\\'\\\"\\\\]/g, '').replace(/,\\s+/g, ',');\n  };\n\n  var getComputedFontProp = function (propName, elm) {\n    return Optional.from(DOMUtils$1.DOM.getStyle(elm, propName, true));\n  };\n\n  var getFontProp = function (propName) {\n    return function (rootElm, elm) {\n      return Optional.from(elm).map(SugarElement.fromDom).filter(isElement).bind(function (element) {\n        return getSpecifiedFontProp(propName, rootElm, element.dom).or(getComputedFontProp(propName, element.dom));\n      }).getOr('');\n    };\n  };\n\n  var getFontSize = getFontProp('font-size');\n  var getFontFamily = compose(normalizeFontFamily, getFontProp('font-family'));\n\n  var findFirstCaretElement = function (editor) {\n    return firstPositionIn(editor.getBody()).map(function (caret) {\n      var container = caret.container();\n      return isText$1(container) ? container.parentNode : container;\n    });\n  };\n\n  var getCaretElement = function (editor) {\n    return Optional.from(editor.selection.getRng()).bind(function (rng) {\n      var root = editor.getBody();\n      var atStartOfNode = rng.startContainer === root && rng.startOffset === 0;\n      return atStartOfNode ? Optional.none() : Optional.from(editor.selection.getStart(true));\n    });\n  };\n\n  var mapRange = function (editor, mapper) {\n    return getCaretElement(editor).orThunk(curry(findFirstCaretElement, editor)).map(SugarElement.fromDom).filter(isElement).map(mapper);\n  };\n\n  var fromFontSizeNumber = function (editor, value) {\n    if (/^[0-9.]+$/.test(value)) {\n      var fontSizeNumber = parseInt(value, 10);\n\n      if (fontSizeNumber >= 1 && fontSizeNumber <= 7) {\n        var fontSizes = getFontStyleValues(editor);\n        var fontClasses = getFontSizeClasses(editor);\n\n        if (fontClasses) {\n          return fontClasses[fontSizeNumber - 1] || value;\n        } else {\n          return fontSizes[fontSizeNumber - 1] || value;\n        }\n      } else {\n        return value;\n      }\n    } else {\n      return value;\n    }\n  };\n\n  var normalizeFontNames = function (font) {\n    var fonts = font.split(/\\s*,\\s*/);\n    return map(fonts, function (font) {\n      if (font.indexOf(' ') !== -1 && !(startsWith(font, '\"') || startsWith(font, '\\''))) {\n        return '\\'' + font + '\\'';\n      } else {\n        return font;\n      }\n    }).join(',');\n  };\n\n  var fontNameAction = function (editor, value) {\n    var font = fromFontSizeNumber(editor, value);\n    editor.formatter.toggle('fontname', {\n      value: normalizeFontNames(font)\n    });\n    editor.nodeChanged();\n  };\n\n  var fontNameQuery = function (editor) {\n    return mapRange(editor, function (elm) {\n      return getFontFamily(editor.getBody(), elm.dom);\n    }).getOr('');\n  };\n\n  var fontSizeAction = function (editor, value) {\n    editor.formatter.toggle('fontsize', {\n      value: fromFontSizeNumber(editor, value)\n    });\n    editor.nodeChanged();\n  };\n\n  var fontSizeQuery = function (editor) {\n    return mapRange(editor, function (elm) {\n      return getFontSize(editor.getBody(), elm.dom);\n    }).getOr('');\n  };\n\n  var lineHeightQuery = function (editor) {\n    return mapRange(editor, function (elm) {\n      var root = SugarElement.fromDom(editor.getBody());\n      var specifiedStyle = closest$2(elm, function (elm) {\n        return getRaw(elm, 'line-height');\n      }, curry(eq$2, root));\n\n      var computedStyle = function () {\n        var lineHeight = parseFloat(get$5(elm, 'line-height'));\n        var fontSize = parseFloat(get$5(elm, 'font-size'));\n        return String(lineHeight / fontSize);\n      };\n\n      return specifiedStyle.getOrThunk(computedStyle);\n    }).getOr('');\n  };\n\n  var lineHeightAction = function (editor, lineHeight) {\n    editor.undoManager.transact(function () {\n      editor.formatter.toggle('lineheight', {\n        value: String(lineHeight)\n      });\n      editor.nodeChanged();\n    });\n  };\n\n  var processValue = function (value) {\n    var details;\n\n    if (typeof value !== 'string') {\n      details = Tools.extend({\n        paste: value.paste,\n        data: {\n          paste: value.paste\n        }\n      }, value);\n      return {\n        content: value.content,\n        details: details\n      };\n    }\n\n    return {\n      content: value,\n      details: {}\n    };\n  };\n\n  var insertAtCaret$1 = function (editor, value) {\n    var result = processValue(value);\n    insertContent(editor, result.content, result.details);\n  };\n\n  var each$f = Tools.each;\n  var map$3 = Tools.map,\n      inArray$2 = Tools.inArray;\n\n  var EditorCommands = function () {\n    function EditorCommands(editor) {\n      this.commands = {\n        state: {},\n        exec: {},\n        value: {}\n      };\n      this.editor = editor;\n      this.setupCommands(editor);\n    }\n\n    EditorCommands.prototype.execCommand = function (command, ui, value, args) {\n      var func,\n          state = false;\n      var self = this;\n\n      if (self.editor.removed) {\n        return;\n      }\n\n      if (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command) && (!args || !args.skip_focus)) {\n        self.editor.focus();\n      } else {\n        restore(self.editor);\n      }\n\n      args = self.editor.fire('BeforeExecCommand', {\n        command: command,\n        ui: ui,\n        value: value\n      });\n\n      if (args.isDefaultPrevented()) {\n        return false;\n      }\n\n      var customCommand = command.toLowerCase();\n\n      if (func = self.commands.exec[customCommand]) {\n        func(customCommand, ui, value);\n        self.editor.fire('ExecCommand', {\n          command: command,\n          ui: ui,\n          value: value\n        });\n        return true;\n      }\n\n      each$f(this.editor.plugins, function (p) {\n        if (p.execCommand && p.execCommand(command, ui, value)) {\n          self.editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          state = true;\n          return false;\n        }\n      });\n\n      if (state) {\n        return state;\n      }\n\n      if (self.editor.theme && self.editor.theme.execCommand && self.editor.theme.execCommand(command, ui, value)) {\n        self.editor.fire('ExecCommand', {\n          command: command,\n          ui: ui,\n          value: value\n        });\n        return true;\n      }\n\n      try {\n        state = self.editor.getDoc().execCommand(command, ui, value);\n      } catch (ex) {}\n\n      if (state) {\n        self.editor.fire('ExecCommand', {\n          command: command,\n          ui: ui,\n          value: value\n        });\n        return true;\n      }\n\n      return false;\n    };\n\n    EditorCommands.prototype.queryCommandState = function (command) {\n      var func;\n\n      if (this.editor.quirks.isHidden() || this.editor.removed) {\n        return;\n      }\n\n      command = command.toLowerCase();\n\n      if (func = this.commands.state[command]) {\n        return func(command);\n      }\n\n      try {\n        return this.editor.getDoc().queryCommandState(command);\n      } catch (ex) {}\n\n      return false;\n    };\n\n    EditorCommands.prototype.queryCommandValue = function (command) {\n      var func;\n\n      if (this.editor.quirks.isHidden() || this.editor.removed) {\n        return;\n      }\n\n      command = command.toLowerCase();\n\n      if (func = this.commands.value[command]) {\n        return func(command);\n      }\n\n      try {\n        return this.editor.getDoc().queryCommandValue(command);\n      } catch (ex) {}\n    };\n\n    EditorCommands.prototype.addCommands = function (commandList, type) {\n      if (type === void 0) {\n        type = 'exec';\n      }\n\n      var self = this;\n      each$f(commandList, function (callback, command) {\n        each$f(command.toLowerCase().split(','), function (command) {\n          self.commands[type][command] = callback;\n        });\n      });\n    };\n\n    EditorCommands.prototype.addCommand = function (command, callback, scope) {\n      var _this = this;\n\n      command = command.toLowerCase();\n\n      this.commands.exec[command] = function (command, ui, value, args) {\n        return callback.call(scope || _this.editor, ui, value, args);\n      };\n    };\n\n    EditorCommands.prototype.queryCommandSupported = function (command) {\n      command = command.toLowerCase();\n\n      if (this.commands.exec[command]) {\n        return true;\n      }\n\n      try {\n        return this.editor.getDoc().queryCommandSupported(command);\n      } catch (ex) {}\n\n      return false;\n    };\n\n    EditorCommands.prototype.addQueryStateHandler = function (command, callback, scope) {\n      var _this = this;\n\n      command = command.toLowerCase();\n\n      this.commands.state[command] = function () {\n        return callback.call(scope || _this.editor);\n      };\n    };\n\n    EditorCommands.prototype.addQueryValueHandler = function (command, callback, scope) {\n      var _this = this;\n\n      command = command.toLowerCase();\n\n      this.commands.value[command] = function () {\n        return callback.call(scope || _this.editor);\n      };\n    };\n\n    EditorCommands.prototype.hasCustomCommand = function (command) {\n      command = command.toLowerCase();\n      return !!this.commands.exec[command];\n    };\n\n    EditorCommands.prototype.execNativeCommand = function (command, ui, value) {\n      if (ui === undefined) {\n        ui = false;\n      }\n\n      if (value === undefined) {\n        value = null;\n      }\n\n      return this.editor.getDoc().execCommand(command, ui, value);\n    };\n\n    EditorCommands.prototype.isFormatMatch = function (name) {\n      return this.editor.formatter.match(name);\n    };\n\n    EditorCommands.prototype.toggleFormat = function (name, value) {\n      this.editor.formatter.toggle(name, value ? {\n        value: value\n      } : undefined);\n      this.editor.nodeChanged();\n    };\n\n    EditorCommands.prototype.storeSelection = function (type) {\n      this.selectionBookmark = this.editor.selection.getBookmark(type);\n    };\n\n    EditorCommands.prototype.restoreSelection = function () {\n      this.editor.selection.moveToBookmark(this.selectionBookmark);\n    };\n\n    EditorCommands.prototype.setupCommands = function (editor) {\n      var self = this;\n      this.addCommands({\n        'mceResetDesignMode,mceBeginUndoLevel': function () {},\n        'mceEndUndoLevel,mceAddUndoLevel': function () {\n          editor.undoManager.add();\n        },\n        'Cut,Copy,Paste': function (command) {\n          var doc = editor.getDoc();\n          var failed;\n\n          try {\n            self.execNativeCommand(command);\n          } catch (ex) {\n            failed = true;\n          }\n\n          if (command === 'paste' && !doc.queryCommandEnabled(command)) {\n            failed = true;\n          }\n\n          if (failed || !doc.queryCommandSupported(command)) {\n            var msg = editor.translate('Your browser doesn\\'t support direct access to the clipboard. ' + 'Please use the Ctrl+X/C/V keyboard shortcuts instead.');\n\n            if (Env.mac) {\n              msg = msg.replace(/Ctrl\\+/g, '\\u2318+');\n            }\n\n            editor.notificationManager.open({\n              text: msg,\n              type: 'error'\n            });\n          }\n        },\n        'unlink': function () {\n          if (editor.selection.isCollapsed()) {\n            var elm = editor.dom.getParent(editor.selection.getStart(), 'a');\n\n            if (elm) {\n              editor.dom.remove(elm, true);\n            }\n\n            return;\n          }\n\n          editor.formatter.remove('link');\n        },\n        'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone': function (command) {\n          var align = command.substring(7);\n\n          if (align === 'full') {\n            align = 'justify';\n          }\n\n          each$f('left,center,right,justify'.split(','), function (name) {\n            if (align !== name) {\n              editor.formatter.remove('align' + name);\n            }\n          });\n\n          if (align !== 'none') {\n            self.toggleFormat('align' + align);\n          }\n        },\n        'InsertUnorderedList,InsertOrderedList': function (command) {\n          var listParent;\n          self.execNativeCommand(command);\n          var listElm = editor.dom.getParent(editor.selection.getNode(), 'ol,ul');\n\n          if (listElm) {\n            listParent = listElm.parentNode;\n\n            if (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\n              self.storeSelection();\n              editor.dom.split(listParent, listElm);\n              self.restoreSelection();\n            }\n          }\n        },\n        'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\n          self.toggleFormat(command);\n        },\n        'ForeColor,HiliteColor': function (command, ui, value) {\n          self.toggleFormat(command, value);\n        },\n        'FontName': function (command, ui, value) {\n          fontNameAction(editor, value);\n        },\n        'FontSize': function (command, ui, value) {\n          fontSizeAction(editor, value);\n        },\n        'LineHeight': function (command, ui, value) {\n          lineHeightAction(editor, value);\n        },\n        'RemoveFormat': function (command) {\n          editor.formatter.remove(command);\n        },\n        'mceBlockQuote': function () {\n          self.toggleFormat('blockquote');\n        },\n        'FormatBlock': function (command, ui, value) {\n          return self.toggleFormat(value || 'p');\n        },\n        'mceCleanup': function () {\n          var bookmark = editor.selection.getBookmark();\n          editor.setContent(editor.getContent());\n          editor.selection.moveToBookmark(bookmark);\n        },\n        'mceRemoveNode': function (command, ui, value) {\n          var node = value || editor.selection.getNode();\n\n          if (node !== editor.getBody()) {\n            self.storeSelection();\n            editor.dom.remove(node, true);\n            self.restoreSelection();\n          }\n        },\n        'mceSelectNodeDepth': function (command, ui, value) {\n          var counter = 0;\n          editor.dom.getParent(editor.selection.getNode(), function (node) {\n            if (node.nodeType === 1 && counter++ === value) {\n              editor.selection.select(node);\n              return false;\n            }\n          }, editor.getBody());\n        },\n        'mceSelectNode': function (command, ui, value) {\n          editor.selection.select(value);\n        },\n        'mceInsertContent': function (command, ui, value) {\n          insertAtCaret$1(editor, value);\n        },\n        'mceInsertRawHTML': function (command, ui, value) {\n          editor.selection.setContent('tiny_mce_marker');\n          var content = editor.getContent();\n          editor.setContent(content.replace(/tiny_mce_marker/g, function () {\n            return value;\n          }));\n        },\n        'mceInsertNewLine': function (command, ui, value) {\n          insert$3(editor, value);\n        },\n        'mceToggleFormat': function (command, ui, value) {\n          self.toggleFormat(value);\n        },\n        'mceSetContent': function (command, ui, value) {\n          editor.setContent(value);\n        },\n        'Indent,Outdent': function (command) {\n          handle(editor, command);\n        },\n        'mceRepaint': function () {},\n        'InsertHorizontalRule': function () {\n          editor.execCommand('mceInsertContent', false, '<hr />');\n        },\n        'mceToggleVisualAid': function () {\n          editor.hasVisual = !editor.hasVisual;\n          editor.addVisual();\n        },\n        'mceReplaceContent': function (command, ui, value) {\n          editor.execCommand('mceInsertContent', false, value.replace(/\\{\\$selection\\}/g, editor.selection.getContent({\n            format: 'text'\n          })));\n        },\n        'mceInsertLink': function (command, ui, value) {\n          if (typeof value === 'string') {\n            value = {\n              href: value\n            };\n          }\n\n          var anchor = editor.dom.getParent(editor.selection.getNode(), 'a');\n          value.href = value.href.replace(/ /g, '%20');\n\n          if (!anchor || !value.href) {\n            editor.formatter.remove('link');\n          }\n\n          if (value.href) {\n            editor.formatter.apply('link', value, anchor);\n          }\n        },\n        'selectAll': function () {\n          var editingHost = editor.dom.getParent(editor.selection.getStart(), isContentEditableTrue);\n\n          if (editingHost) {\n            var rng = editor.dom.createRng();\n            rng.selectNodeContents(editingHost);\n            editor.selection.setRng(rng);\n          }\n        },\n        'mceNewDocument': function () {\n          editor.setContent('');\n        },\n        'InsertLineBreak': function (command, ui, value) {\n          insert$2(editor, value);\n          return true;\n        }\n      });\n\n      var alignStates = function (name) {\n        return function () {\n          var selection = editor.selection;\n          var nodes = selection.isCollapsed() ? [editor.dom.getParent(selection.getNode(), editor.dom.isBlock)] : selection.getSelectedBlocks();\n          var matches = map$3(nodes, function (node) {\n            return !!editor.formatter.matchNode(node, name);\n          });\n          return inArray$2(matches, true) !== -1;\n        };\n      };\n\n      self.addCommands({\n        'JustifyLeft': alignStates('alignleft'),\n        'JustifyCenter': alignStates('aligncenter'),\n        'JustifyRight': alignStates('alignright'),\n        'JustifyFull': alignStates('alignjustify'),\n        'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\n          return self.isFormatMatch(command);\n        },\n        'mceBlockQuote': function () {\n          return self.isFormatMatch('blockquote');\n        },\n        'Outdent': function () {\n          return canOutdent(editor);\n        },\n        'InsertUnorderedList,InsertOrderedList': function (command) {\n          var list = editor.dom.getParent(editor.selection.getNode(), 'ul,ol');\n          return list && (command === 'insertunorderedlist' && list.tagName === 'UL' || command === 'insertorderedlist' && list.tagName === 'OL');\n        }\n      }, 'state');\n      self.addCommands({\n        Undo: function () {\n          editor.undoManager.undo();\n        },\n        Redo: function () {\n          editor.undoManager.redo();\n        }\n      });\n      self.addQueryValueHandler('FontName', function () {\n        return fontNameQuery(editor);\n      }, this);\n      self.addQueryValueHandler('FontSize', function () {\n        return fontSizeQuery(editor);\n      }, this);\n      self.addQueryValueHandler('LineHeight', function () {\n        return lineHeightQuery(editor);\n      }, this);\n    };\n\n    return EditorCommands;\n  }();\n\n  var internalContentEditableAttr = 'data-mce-contenteditable';\n\n  var toggleClass = function (elm, cls, state) {\n    if (has$2(elm, cls) && state === false) {\n      remove$4(elm, cls);\n    } else if (state) {\n      add$3(elm, cls);\n    }\n  };\n\n  var setEditorCommandState = function (editor, cmd, state) {\n    try {\n      editor.getDoc().execCommand(cmd, false, String(state));\n    } catch (ex) {}\n  };\n\n  var setContentEditable = function (elm, state) {\n    elm.dom.contentEditable = state ? 'true' : 'false';\n  };\n\n  var switchOffContentEditableTrue = function (elm) {\n    each(descendants$1(elm, '*[contenteditable=\"true\"]'), function (elm) {\n      set(elm, internalContentEditableAttr, 'true');\n      setContentEditable(elm, false);\n    });\n  };\n\n  var switchOnContentEditableTrue = function (elm) {\n    each(descendants$1(elm, '*[' + internalContentEditableAttr + '=\"true\"]'), function (elm) {\n      remove$1(elm, internalContentEditableAttr);\n      setContentEditable(elm, true);\n    });\n  };\n\n  var removeFakeSelection = function (editor) {\n    Optional.from(editor.selection.getNode()).each(function (elm) {\n      elm.removeAttribute('data-mce-selected');\n    });\n  };\n\n  var restoreFakeSelection = function (editor) {\n    editor.selection.setRng(editor.selection.getRng());\n  };\n\n  var toggleReadOnly = function (editor, state) {\n    var body = SugarElement.fromDom(editor.getBody());\n    toggleClass(body, 'mce-content-readonly', state);\n\n    if (state) {\n      editor.selection.controlSelection.hideResizeRect();\n\n      editor._selectionOverrides.hideFakeCaret();\n\n      removeFakeSelection(editor);\n      editor.readonly = true;\n      setContentEditable(body, false);\n      switchOffContentEditableTrue(body);\n    } else {\n      editor.readonly = false;\n      setContentEditable(body, true);\n      switchOnContentEditableTrue(body);\n      setEditorCommandState(editor, 'StyleWithCSS', false);\n      setEditorCommandState(editor, 'enableInlineTableEditing', false);\n      setEditorCommandState(editor, 'enableObjectResizing', false);\n\n      if (hasEditorOrUiFocus(editor)) {\n        editor.focus();\n      }\n\n      restoreFakeSelection(editor);\n      editor.nodeChanged();\n    }\n  };\n\n  var isReadOnly$1 = function (editor) {\n    return editor.readonly;\n  };\n\n  var registerFilters = function (editor) {\n    editor.parser.addAttributeFilter('contenteditable', function (nodes) {\n      if (isReadOnly$1(editor)) {\n        each(nodes, function (node) {\n          node.attr(internalContentEditableAttr, node.attr('contenteditable'));\n          node.attr('contenteditable', 'false');\n        });\n      }\n    });\n    editor.serializer.addAttributeFilter(internalContentEditableAttr, function (nodes) {\n      if (isReadOnly$1(editor)) {\n        each(nodes, function (node) {\n          node.attr('contenteditable', node.attr(internalContentEditableAttr));\n        });\n      }\n    });\n    editor.serializer.addTempAttr(internalContentEditableAttr);\n  };\n\n  var registerReadOnlyContentFilters = function (editor) {\n    if (editor.serializer) {\n      registerFilters(editor);\n    } else {\n      editor.on('PreInit', function () {\n        registerFilters(editor);\n      });\n    }\n  };\n\n  var isClickEvent = function (e) {\n    return e.type === 'click';\n  };\n\n  var getAnchorHrefOpt = function (editor, elm) {\n    var isRoot = function (elm) {\n      return eq$2(elm, SugarElement.fromDom(editor.getBody()));\n    };\n\n    return closest$1(elm, 'a', isRoot).bind(function (a) {\n      return getOpt(a, 'href');\n    });\n  };\n\n  var processReadonlyEvents = function (editor, e) {\n    if (isClickEvent(e) && !VK.metaKeyPressed(e)) {\n      var elm = SugarElement.fromDom(e.target);\n      getAnchorHrefOpt(editor, elm).each(function (href) {\n        e.preventDefault();\n\n        if (/^#/.test(href)) {\n          var targetEl = editor.dom.select(href + ',[name=\"' + removeLeading(href, '#') + '\"]');\n\n          if (targetEl.length) {\n            editor.selection.scrollIntoView(targetEl[0], true);\n          }\n        } else {\n          window.open(href, '_blank', 'rel=noopener noreferrer,menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,scrollbars=yes');\n        }\n      });\n    }\n  };\n\n  var registerReadOnlySelectionBlockers = function (editor) {\n    editor.on('ShowCaret', function (e) {\n      if (isReadOnly$1(editor)) {\n        e.preventDefault();\n      }\n    });\n    editor.on('ObjectSelected', function (e) {\n      if (isReadOnly$1(editor)) {\n        e.preventDefault();\n      }\n    });\n  };\n\n  var nativeEvents = Tools.makeMap('focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange ' + 'mouseout mouseenter mouseleave wheel keydown keypress keyup input beforeinput contextmenu dragstart dragend dragover ' + 'draggesture dragdrop drop drag submit ' + 'compositionstart compositionend compositionupdate touchstart touchmove touchend touchcancel', ' ');\n\n  var EventDispatcher = function () {\n    function EventDispatcher(settings) {\n      this.bindings = {};\n      this.settings = settings || {};\n      this.scope = this.settings.scope || this;\n      this.toggleEvent = this.settings.toggleEvent || never;\n    }\n\n    EventDispatcher.isNative = function (name) {\n      return !!nativeEvents[name.toLowerCase()];\n    };\n\n    EventDispatcher.prototype.fire = function (nameIn, argsIn) {\n      var name = nameIn.toLowerCase();\n      var args = argsIn || {};\n      args.type = name;\n\n      if (!args.target) {\n        args.target = this.scope;\n      }\n\n      if (!args.preventDefault) {\n        args.preventDefault = function () {\n          args.isDefaultPrevented = always;\n        };\n\n        args.stopPropagation = function () {\n          args.isPropagationStopped = always;\n        };\n\n        args.stopImmediatePropagation = function () {\n          args.isImmediatePropagationStopped = always;\n        };\n\n        args.isDefaultPrevented = never;\n        args.isPropagationStopped = never;\n        args.isImmediatePropagationStopped = never;\n      }\n\n      if (this.settings.beforeFire) {\n        this.settings.beforeFire(args);\n      }\n\n      var handlers = this.bindings[name];\n\n      if (handlers) {\n        for (var i = 0, l = handlers.length; i < l; i++) {\n          var callback = handlers[i];\n\n          if (callback.once) {\n            this.off(name, callback.func);\n          }\n\n          if (args.isImmediatePropagationStopped()) {\n            args.stopPropagation();\n            return args;\n          }\n\n          if (callback.func.call(this.scope, args) === false) {\n            args.preventDefault();\n            return args;\n          }\n        }\n      }\n\n      return args;\n    };\n\n    EventDispatcher.prototype.on = function (name, callback, prepend, extra) {\n      if (callback === false) {\n        callback = never;\n      }\n\n      if (callback) {\n        var wrappedCallback = {\n          func: callback\n        };\n\n        if (extra) {\n          Tools.extend(wrappedCallback, extra);\n        }\n\n        var names = name.toLowerCase().split(' ');\n        var i = names.length;\n\n        while (i--) {\n          var currentName = names[i];\n          var handlers = this.bindings[currentName];\n\n          if (!handlers) {\n            handlers = this.bindings[currentName] = [];\n            this.toggleEvent(currentName, true);\n          }\n\n          if (prepend) {\n            handlers.unshift(wrappedCallback);\n          } else {\n            handlers.push(wrappedCallback);\n          }\n        }\n      }\n\n      return this;\n    };\n\n    EventDispatcher.prototype.off = function (name, callback) {\n      var _this = this;\n\n      if (name) {\n        var names = name.toLowerCase().split(' ');\n        var i = names.length;\n\n        while (i--) {\n          var currentName = names[i];\n          var handlers = this.bindings[currentName];\n\n          if (!currentName) {\n            each$1(this.bindings, function (_value, bindingName) {\n              _this.toggleEvent(bindingName, false);\n\n              delete _this.bindings[bindingName];\n            });\n            return this;\n          }\n\n          if (handlers) {\n            if (!callback) {\n              handlers.length = 0;\n            } else {\n              var hi = handlers.length;\n\n              while (hi--) {\n                if (handlers[hi].func === callback) {\n                  handlers = handlers.slice(0, hi).concat(handlers.slice(hi + 1));\n                  this.bindings[currentName] = handlers;\n                }\n              }\n            }\n\n            if (!handlers.length) {\n              this.toggleEvent(name, false);\n              delete this.bindings[currentName];\n            }\n          }\n        }\n      } else {\n        each$1(this.bindings, function (_value, name) {\n          _this.toggleEvent(name, false);\n        });\n        this.bindings = {};\n      }\n\n      return this;\n    };\n\n    EventDispatcher.prototype.once = function (name, callback, prepend) {\n      return this.on(name, callback, prepend, {\n        once: true\n      });\n    };\n\n    EventDispatcher.prototype.has = function (name) {\n      name = name.toLowerCase();\n      return !(!this.bindings[name] || this.bindings[name].length === 0);\n    };\n\n    return EventDispatcher;\n  }();\n\n  var getEventDispatcher = function (obj) {\n    if (!obj._eventDispatcher) {\n      obj._eventDispatcher = new EventDispatcher({\n        scope: obj,\n        toggleEvent: function (name, state) {\n          if (EventDispatcher.isNative(name) && obj.toggleNativeEvent) {\n            obj.toggleNativeEvent(name, state);\n          }\n        }\n      });\n    }\n\n    return obj._eventDispatcher;\n  };\n\n  var Observable = {\n    fire: function (name, args, bubble) {\n      var self = this;\n\n      if (self.removed && name !== 'remove' && name !== 'detach') {\n        return args;\n      }\n\n      var dispatcherArgs = getEventDispatcher(self).fire(name, args);\n\n      if (bubble !== false && self.parent) {\n        var parent_1 = self.parent();\n\n        while (parent_1 && !dispatcherArgs.isPropagationStopped()) {\n          parent_1.fire(name, dispatcherArgs, false);\n          parent_1 = parent_1.parent();\n        }\n      }\n\n      return dispatcherArgs;\n    },\n    on: function (name, callback, prepend) {\n      return getEventDispatcher(this).on(name, callback, prepend);\n    },\n    off: function (name, callback) {\n      return getEventDispatcher(this).off(name, callback);\n    },\n    once: function (name, callback) {\n      return getEventDispatcher(this).once(name, callback);\n    },\n    hasEventListeners: function (name) {\n      return getEventDispatcher(this).has(name);\n    }\n  };\n  var DOM$8 = DOMUtils$1.DOM;\n  var customEventRootDelegates;\n\n  var getEventTarget = function (editor, eventName) {\n    if (eventName === 'selectionchange') {\n      return editor.getDoc();\n    }\n\n    if (!editor.inline && /^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)) {\n      return editor.getDoc().documentElement;\n    }\n\n    var eventRoot = getEventRoot(editor);\n\n    if (eventRoot) {\n      if (!editor.eventRoot) {\n        editor.eventRoot = DOM$8.select(eventRoot)[0];\n      }\n\n      return editor.eventRoot;\n    }\n\n    return editor.getBody();\n  };\n\n  var isListening = function (editor) {\n    return !editor.hidden && !isReadOnly$1(editor);\n  };\n\n  var fireEvent = function (editor, eventName, e) {\n    if (isListening(editor)) {\n      editor.fire(eventName, e);\n    } else if (isReadOnly$1(editor)) {\n      processReadonlyEvents(editor, e);\n    }\n  };\n\n  var bindEventDelegate = function (editor, eventName) {\n    var delegate;\n\n    if (!editor.delegates) {\n      editor.delegates = {};\n    }\n\n    if (editor.delegates[eventName] || editor.removed) {\n      return;\n    }\n\n    var eventRootElm = getEventTarget(editor, eventName);\n\n    if (getEventRoot(editor)) {\n      if (!customEventRootDelegates) {\n        customEventRootDelegates = {};\n        editor.editorManager.on('removeEditor', function () {\n          if (!editor.editorManager.activeEditor) {\n            if (customEventRootDelegates) {\n              each$1(customEventRootDelegates, function (_value, name) {\n                editor.dom.unbind(getEventTarget(editor, name));\n              });\n              customEventRootDelegates = null;\n            }\n          }\n        });\n      }\n\n      if (customEventRootDelegates[eventName]) {\n        return;\n      }\n\n      delegate = function (e) {\n        var target = e.target;\n        var editors = editor.editorManager.get();\n        var i = editors.length;\n\n        while (i--) {\n          var body = editors[i].getBody();\n\n          if (body === target || DOM$8.isChildOf(target, body)) {\n            fireEvent(editors[i], eventName, e);\n          }\n        }\n      };\n\n      customEventRootDelegates[eventName] = delegate;\n      DOM$8.bind(eventRootElm, eventName, delegate);\n    } else {\n      delegate = function (e) {\n        fireEvent(editor, eventName, e);\n      };\n\n      DOM$8.bind(eventRootElm, eventName, delegate);\n      editor.delegates[eventName] = delegate;\n    }\n  };\n\n  var EditorObservable = __assign(__assign({}, Observable), {\n    bindPendingEventDelegates: function () {\n      var self = this;\n      Tools.each(self._pendingNativeEvents, function (name) {\n        bindEventDelegate(self, name);\n      });\n    },\n    toggleNativeEvent: function (name, state) {\n      var self = this;\n\n      if (name === 'focus' || name === 'blur') {\n        return;\n      }\n\n      if (state) {\n        if (self.initialized) {\n          bindEventDelegate(self, name);\n        } else {\n          if (!self._pendingNativeEvents) {\n            self._pendingNativeEvents = [name];\n          } else {\n            self._pendingNativeEvents.push(name);\n          }\n        }\n      } else if (self.initialized) {\n        self.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n        delete self.delegates[name];\n      }\n    },\n    unbindAllNativeEvents: function () {\n      var self = this;\n      var body = self.getBody();\n      var dom = self.dom;\n\n      if (self.delegates) {\n        each$1(self.delegates, function (value, name) {\n          self.dom.unbind(getEventTarget(self, name), name, value);\n        });\n        delete self.delegates;\n      }\n\n      if (!self.inline && body && dom) {\n        body.onload = null;\n        dom.unbind(self.getWin());\n        dom.unbind(self.getDoc());\n      }\n\n      if (dom) {\n        dom.unbind(body);\n        dom.unbind(self.getContainer());\n      }\n    }\n  });\n\n  var defaultModes = ['design', 'readonly'];\n\n  var switchToMode = function (editor, activeMode, availableModes, mode) {\n    var oldMode = availableModes[activeMode.get()];\n    var newMode = availableModes[mode];\n\n    try {\n      newMode.activate();\n    } catch (e) {\n      console.error('problem while activating editor mode ' + mode + ':', e);\n      return;\n    }\n\n    oldMode.deactivate();\n\n    if (oldMode.editorReadOnly !== newMode.editorReadOnly) {\n      toggleReadOnly(editor, newMode.editorReadOnly);\n    }\n\n    activeMode.set(mode);\n    fireSwitchMode(editor, mode);\n  };\n\n  var setMode = function (editor, availableModes, activeMode, mode) {\n    if (mode === activeMode.get()) {\n      return;\n    } else if (!has(availableModes, mode)) {\n      throw new Error('Editor mode \\'' + mode + '\\' is invalid');\n    }\n\n    if (editor.initialized) {\n      switchToMode(editor, activeMode, availableModes, mode);\n    } else {\n      editor.on('init', function () {\n        return switchToMode(editor, activeMode, availableModes, mode);\n      });\n    }\n  };\n\n  var registerMode = function (availableModes, mode, api) {\n    var _a;\n\n    if (contains(defaultModes, mode)) {\n      throw new Error('Cannot override default mode ' + mode);\n    }\n\n    return __assign(__assign({}, availableModes), (_a = {}, _a[mode] = __assign(__assign({}, api), {\n      deactivate: function () {\n        try {\n          api.deactivate();\n        } catch (e) {\n          console.error('problem while deactivating editor mode ' + mode + ':', e);\n        }\n      }\n    }), _a));\n  };\n\n  var create$5 = function (editor) {\n    var activeMode = Cell('design');\n    var availableModes = Cell({\n      design: {\n        activate: noop,\n        deactivate: noop,\n        editorReadOnly: false\n      },\n      readonly: {\n        activate: noop,\n        deactivate: noop,\n        editorReadOnly: true\n      }\n    });\n    registerReadOnlyContentFilters(editor);\n    registerReadOnlySelectionBlockers(editor);\n    return {\n      isReadOnly: function () {\n        return isReadOnly$1(editor);\n      },\n      set: function (mode) {\n        return setMode(editor, availableModes.get(), activeMode, mode);\n      },\n      get: function () {\n        return activeMode.get();\n      },\n      register: function (mode, api) {\n        availableModes.set(registerMode(availableModes.get(), mode, api));\n      }\n    };\n  };\n\n  var each$g = Tools.each,\n      explode$3 = Tools.explode;\n  var keyCodeLookup = {\n    f1: 112,\n    f2: 113,\n    f3: 114,\n    f4: 115,\n    f5: 116,\n    f6: 117,\n    f7: 118,\n    f8: 119,\n    f9: 120,\n    f10: 121,\n    f11: 122,\n    f12: 123\n  };\n  var modifierNames = Tools.makeMap('alt,ctrl,shift,meta,access');\n\n  var Shortcuts = function () {\n    function Shortcuts(editor) {\n      this.shortcuts = {};\n      this.pendingPatterns = [];\n      this.editor = editor;\n      var self = this;\n      editor.on('keyup keypress keydown', function (e) {\n        if ((self.hasModifier(e) || self.isFunctionKey(e)) && !e.isDefaultPrevented()) {\n          each$g(self.shortcuts, function (shortcut) {\n            if (self.matchShortcut(e, shortcut)) {\n              self.pendingPatterns = shortcut.subpatterns.slice(0);\n\n              if (e.type === 'keydown') {\n                self.executeShortcutAction(shortcut);\n              }\n\n              return true;\n            }\n          });\n\n          if (self.matchShortcut(e, self.pendingPatterns[0])) {\n            if (self.pendingPatterns.length === 1) {\n              if (e.type === 'keydown') {\n                self.executeShortcutAction(self.pendingPatterns[0]);\n              }\n            }\n\n            self.pendingPatterns.shift();\n          }\n        }\n      });\n    }\n\n    Shortcuts.prototype.add = function (pattern, desc, cmdFunc, scope) {\n      var self = this;\n      var func = self.normalizeCommandFunc(cmdFunc);\n      each$g(explode$3(Tools.trim(pattern)), function (pattern) {\n        var shortcut = self.createShortcut(pattern, desc, func, scope);\n        self.shortcuts[shortcut.id] = shortcut;\n      });\n      return true;\n    };\n\n    Shortcuts.prototype.remove = function (pattern) {\n      var shortcut = this.createShortcut(pattern);\n\n      if (this.shortcuts[shortcut.id]) {\n        delete this.shortcuts[shortcut.id];\n        return true;\n      }\n\n      return false;\n    };\n\n    Shortcuts.prototype.normalizeCommandFunc = function (cmdFunc) {\n      var self = this;\n      var cmd = cmdFunc;\n\n      if (typeof cmd === 'string') {\n        return function () {\n          self.editor.execCommand(cmd, false, null);\n        };\n      } else if (Tools.isArray(cmd)) {\n        return function () {\n          self.editor.execCommand(cmd[0], cmd[1], cmd[2]);\n        };\n      } else {\n        return cmd;\n      }\n    };\n\n    Shortcuts.prototype.parseShortcut = function (pattern) {\n      var key;\n      var shortcut = {};\n      each$g(explode$3(pattern.toLowerCase(), '+'), function (value) {\n        if (value in modifierNames) {\n          shortcut[value] = true;\n        } else {\n          if (/^[0-9]{2,}$/.test(value)) {\n            shortcut.keyCode = parseInt(value, 10);\n          } else {\n            shortcut.charCode = value.charCodeAt(0);\n            shortcut.keyCode = keyCodeLookup[value] || value.toUpperCase().charCodeAt(0);\n          }\n        }\n      });\n      var id = [shortcut.keyCode];\n\n      for (key in modifierNames) {\n        if (shortcut[key]) {\n          id.push(key);\n        } else {\n          shortcut[key] = false;\n        }\n      }\n\n      shortcut.id = id.join(',');\n\n      if (shortcut.access) {\n        shortcut.alt = true;\n\n        if (Env.mac) {\n          shortcut.ctrl = true;\n        } else {\n          shortcut.shift = true;\n        }\n      }\n\n      if (shortcut.meta) {\n        if (Env.mac) {\n          shortcut.meta = true;\n        } else {\n          shortcut.ctrl = true;\n          shortcut.meta = false;\n        }\n      }\n\n      return shortcut;\n    };\n\n    Shortcuts.prototype.createShortcut = function (pattern, desc, cmdFunc, scope) {\n      var shortcuts = Tools.map(explode$3(pattern, '>'), this.parseShortcut);\n      shortcuts[shortcuts.length - 1] = Tools.extend(shortcuts[shortcuts.length - 1], {\n        func: cmdFunc,\n        scope: scope || this.editor\n      });\n      return Tools.extend(shortcuts[0], {\n        desc: this.editor.translate(desc),\n        subpatterns: shortcuts.slice(1)\n      });\n    };\n\n    Shortcuts.prototype.hasModifier = function (e) {\n      return e.altKey || e.ctrlKey || e.metaKey;\n    };\n\n    Shortcuts.prototype.isFunctionKey = function (e) {\n      return e.type === 'keydown' && e.keyCode >= 112 && e.keyCode <= 123;\n    };\n\n    Shortcuts.prototype.matchShortcut = function (e, shortcut) {\n      if (!shortcut) {\n        return false;\n      }\n\n      if (shortcut.ctrl !== e.ctrlKey || shortcut.meta !== e.metaKey) {\n        return false;\n      }\n\n      if (shortcut.alt !== e.altKey || shortcut.shift !== e.shiftKey) {\n        return false;\n      }\n\n      if (e.keyCode === shortcut.keyCode || e.charCode && e.charCode === shortcut.charCode) {\n        e.preventDefault();\n        return true;\n      }\n\n      return false;\n    };\n\n    Shortcuts.prototype.executeShortcutAction = function (shortcut) {\n      return shortcut.func ? shortcut.func.call(shortcut.scope) : null;\n    };\n\n    return Shortcuts;\n  }();\n\n  var create$6 = function () {\n    var buttons = {};\n    var menuItems = {};\n    var popups = {};\n    var icons = {};\n    var contextMenus = {};\n    var contextToolbars = {};\n    var sidebars = {};\n\n    var add = function (collection, type) {\n      return function (name, spec) {\n        return collection[name.toLowerCase()] = __assign(__assign({}, spec), {\n          type: type\n        });\n      };\n    };\n\n    var addIcon = function (name, svgData) {\n      return icons[name.toLowerCase()] = svgData;\n    };\n\n    return {\n      addButton: add(buttons, 'button'),\n      addGroupToolbarButton: add(buttons, 'grouptoolbarbutton'),\n      addToggleButton: add(buttons, 'togglebutton'),\n      addMenuButton: add(buttons, 'menubutton'),\n      addSplitButton: add(buttons, 'splitbutton'),\n      addMenuItem: add(menuItems, 'menuitem'),\n      addNestedMenuItem: add(menuItems, 'nestedmenuitem'),\n      addToggleMenuItem: add(menuItems, 'togglemenuitem'),\n      addAutocompleter: add(popups, 'autocompleter'),\n      addContextMenu: add(contextMenus, 'contextmenu'),\n      addContextToolbar: add(contextToolbars, 'contexttoolbar'),\n      addContextForm: add(contextToolbars, 'contextform'),\n      addSidebar: add(sidebars, 'sidebar'),\n      addIcon: addIcon,\n      getAll: function () {\n        return {\n          buttons: buttons,\n          menuItems: menuItems,\n          icons: icons,\n          popups: popups,\n          contextMenus: contextMenus,\n          contextToolbars: contextToolbars,\n          sidebars: sidebars\n        };\n      }\n    };\n  };\n\n  var registry = function () {\n    var bridge = create$6();\n    return {\n      addAutocompleter: bridge.addAutocompleter,\n      addButton: bridge.addButton,\n      addContextForm: bridge.addContextForm,\n      addContextMenu: bridge.addContextMenu,\n      addContextToolbar: bridge.addContextToolbar,\n      addIcon: bridge.addIcon,\n      addMenuButton: bridge.addMenuButton,\n      addMenuItem: bridge.addMenuItem,\n      addNestedMenuItem: bridge.addNestedMenuItem,\n      addSidebar: bridge.addSidebar,\n      addSplitButton: bridge.addSplitButton,\n      addToggleButton: bridge.addToggleButton,\n      addGroupToolbarButton: bridge.addGroupToolbarButton,\n      addToggleMenuItem: bridge.addToggleMenuItem,\n      getAll: bridge.getAll\n    };\n  };\n\n  var each$h = Tools.each,\n      trim$4 = Tools.trim;\n  var queryParts = 'source protocol authority userInfo user password host port relative path directory file query anchor'.split(' ');\n  var DEFAULT_PORTS = {\n    ftp: 21,\n    http: 80,\n    https: 443,\n    mailto: 25\n  };\n\n  var URI = function () {\n    function URI(url, settings) {\n      url = trim$4(url);\n      this.settings = settings || {};\n      var baseUri = this.settings.base_uri;\n      var self = this;\n\n      if (/^([\\w\\-]+):([^\\/]{2})/i.test(url) || /^\\s*#/.test(url)) {\n        self.source = url;\n        return;\n      }\n\n      var isProtocolRelative = url.indexOf('//') === 0;\n\n      if (url.indexOf('/') === 0 && !isProtocolRelative) {\n        url = (baseUri ? baseUri.protocol || 'http' : 'http') + '://mce_host' + url;\n      }\n\n      if (!/^[\\w\\-]*:?\\/\\//.test(url)) {\n        var baseUrl = this.settings.base_uri ? this.settings.base_uri.path : new URI(document.location.href).directory;\n\n        if (this.settings.base_uri && this.settings.base_uri.protocol == '') {\n          url = '//mce_host' + self.toAbsPath(baseUrl, url);\n        } else {\n          var match = /([^#?]*)([#?]?.*)/.exec(url);\n          url = (baseUri && baseUri.protocol || 'http') + '://mce_host' + self.toAbsPath(baseUrl, match[1]) + match[2];\n        }\n      }\n\n      url = url.replace(/@@/g, '(mce_at)');\n      var urlMatch = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(url);\n      each$h(queryParts, function (v, i) {\n        var part = urlMatch[i];\n\n        if (part) {\n          part = part.replace(/\\(mce_at\\)/g, '@@');\n        }\n\n        self[v] = part;\n      });\n\n      if (baseUri) {\n        if (!self.protocol) {\n          self.protocol = baseUri.protocol;\n        }\n\n        if (!self.userInfo) {\n          self.userInfo = baseUri.userInfo;\n        }\n\n        if (!self.port && self.host === 'mce_host') {\n          self.port = baseUri.port;\n        }\n\n        if (!self.host || self.host === 'mce_host') {\n          self.host = baseUri.host;\n        }\n\n        self.source = '';\n      }\n\n      if (isProtocolRelative) {\n        self.protocol = '';\n      }\n    }\n\n    URI.parseDataUri = function (uri) {\n      var type;\n      var uriComponents = decodeURIComponent(uri).split(',');\n      var matches = /data:([^;]+)/.exec(uriComponents[0]);\n\n      if (matches) {\n        type = matches[1];\n      }\n\n      return {\n        type: type,\n        data: uriComponents[1]\n      };\n    };\n\n    URI.getDocumentBaseUrl = function (loc) {\n      var baseUrl;\n\n      if (loc.protocol.indexOf('http') !== 0 && loc.protocol !== 'file:') {\n        baseUrl = loc.href;\n      } else {\n        baseUrl = loc.protocol + '//' + loc.host + loc.pathname;\n      }\n\n      if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(baseUrl)) {\n        baseUrl = baseUrl.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n\n        if (!/[\\/\\\\]$/.test(baseUrl)) {\n          baseUrl += '/';\n        }\n      }\n\n      return baseUrl;\n    };\n\n    URI.prototype.setPath = function (path) {\n      var pathMatch = /^(.*?)\\/?(\\w+)?$/.exec(path);\n      this.path = pathMatch[0];\n      this.directory = pathMatch[1];\n      this.file = pathMatch[2];\n      this.source = '';\n      this.getURI();\n    };\n\n    URI.prototype.toRelative = function (uri) {\n      var output;\n\n      if (uri === './') {\n        return uri;\n      }\n\n      var relativeUri = new URI(uri, {\n        base_uri: this\n      });\n\n      if (relativeUri.host !== 'mce_host' && this.host !== relativeUri.host && relativeUri.host || this.port !== relativeUri.port || this.protocol !== relativeUri.protocol && relativeUri.protocol !== '') {\n        return relativeUri.getURI();\n      }\n\n      var tu = this.getURI(),\n          uu = relativeUri.getURI();\n\n      if (tu === uu || tu.charAt(tu.length - 1) === '/' && tu.substr(0, tu.length - 1) === uu) {\n        return tu;\n      }\n\n      output = this.toRelPath(this.path, relativeUri.path);\n\n      if (relativeUri.query) {\n        output += '?' + relativeUri.query;\n      }\n\n      if (relativeUri.anchor) {\n        output += '#' + relativeUri.anchor;\n      }\n\n      return output;\n    };\n\n    URI.prototype.toAbsolute = function (uri, noHost) {\n      var absoluteUri = new URI(uri, {\n        base_uri: this\n      });\n      return absoluteUri.getURI(noHost && this.isSameOrigin(absoluteUri));\n    };\n\n    URI.prototype.isSameOrigin = function (uri) {\n      if (this.host == uri.host && this.protocol == uri.protocol) {\n        if (this.port == uri.port) {\n          return true;\n        }\n\n        var defaultPort = DEFAULT_PORTS[this.protocol];\n\n        if (defaultPort && (this.port || defaultPort) == (uri.port || defaultPort)) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    URI.prototype.toRelPath = function (base, path) {\n      var breakPoint = 0,\n          out = '',\n          i,\n          l;\n      var normalizedBase = base.substring(0, base.lastIndexOf('/')).split('/');\n      var items = path.split('/');\n\n      if (normalizedBase.length >= items.length) {\n        for (i = 0, l = normalizedBase.length; i < l; i++) {\n          if (i >= items.length || normalizedBase[i] !== items[i]) {\n            breakPoint = i + 1;\n            break;\n          }\n        }\n      }\n\n      if (normalizedBase.length < items.length) {\n        for (i = 0, l = items.length; i < l; i++) {\n          if (i >= normalizedBase.length || normalizedBase[i] !== items[i]) {\n            breakPoint = i + 1;\n            break;\n          }\n        }\n      }\n\n      if (breakPoint === 1) {\n        return path;\n      }\n\n      for (i = 0, l = normalizedBase.length - (breakPoint - 1); i < l; i++) {\n        out += '../';\n      }\n\n      for (i = breakPoint - 1, l = items.length; i < l; i++) {\n        if (i !== breakPoint - 1) {\n          out += '/' + items[i];\n        } else {\n          out += items[i];\n        }\n      }\n\n      return out;\n    };\n\n    URI.prototype.toAbsPath = function (base, path) {\n      var i,\n          nb = 0,\n          o = [],\n          outPath;\n      var tr = /\\/$/.test(path) ? '/' : '';\n      var normalizedBase = base.split('/');\n      var normalizedPath = path.split('/');\n      each$h(normalizedBase, function (k) {\n        if (k) {\n          o.push(k);\n        }\n      });\n      normalizedBase = o;\n\n      for (i = normalizedPath.length - 1, o = []; i >= 0; i--) {\n        if (normalizedPath[i].length === 0 || normalizedPath[i] === '.') {\n          continue;\n        }\n\n        if (normalizedPath[i] === '..') {\n          nb++;\n          continue;\n        }\n\n        if (nb > 0) {\n          nb--;\n          continue;\n        }\n\n        o.push(normalizedPath[i]);\n      }\n\n      i = normalizedBase.length - nb;\n\n      if (i <= 0) {\n        outPath = reverse(o).join('/');\n      } else {\n        outPath = normalizedBase.slice(0, i).join('/') + '/' + reverse(o).join('/');\n      }\n\n      if (outPath.indexOf('/') !== 0) {\n        outPath = '/' + outPath;\n      }\n\n      if (tr && outPath.lastIndexOf('/') !== outPath.length - 1) {\n        outPath += tr;\n      }\n\n      return outPath;\n    };\n\n    URI.prototype.getURI = function (noProtoHost) {\n      if (noProtoHost === void 0) {\n        noProtoHost = false;\n      }\n\n      var s;\n\n      if (!this.source || noProtoHost) {\n        s = '';\n\n        if (!noProtoHost) {\n          if (this.protocol) {\n            s += this.protocol + '://';\n          } else {\n            s += '//';\n          }\n\n          if (this.userInfo) {\n            s += this.userInfo + '@';\n          }\n\n          if (this.host) {\n            s += this.host;\n          }\n\n          if (this.port) {\n            s += ':' + this.port;\n          }\n        }\n\n        if (this.path) {\n          s += this.path;\n        }\n\n        if (this.query) {\n          s += '?' + this.query;\n        }\n\n        if (this.anchor) {\n          s += '#' + this.anchor;\n        }\n\n        this.source = s;\n      }\n\n      return this.source;\n    };\n\n    return URI;\n  }();\n\n  var DOM$9 = DOMUtils$1.DOM;\n  var extend$3 = Tools.extend,\n      each$i = Tools.each;\n  var resolve$3 = Tools.resolve;\n  var ie$1 = Env.ie;\n\n  var Editor = function () {\n    function Editor(id, settings, editorManager) {\n      var _this = this;\n\n      this.plugins = {};\n      this.contentCSS = [];\n      this.contentStyles = [];\n      this.loadedCSS = {};\n      this.isNotDirty = false;\n      this.editorManager = editorManager;\n      this.documentBaseUrl = editorManager.documentBaseURL;\n      extend$3(this, EditorObservable);\n      this.settings = getEditorSettings(this, id, this.documentBaseUrl, editorManager.defaultSettings, settings);\n\n      if (this.settings.suffix) {\n        editorManager.suffix = this.settings.suffix;\n      }\n\n      this.suffix = editorManager.suffix;\n\n      if (this.settings.base_url) {\n        editorManager._setBaseUrl(this.settings.base_url);\n      }\n\n      this.baseUri = editorManager.baseURI;\n\n      if (this.settings.referrer_policy) {\n        ScriptLoader.ScriptLoader._setReferrerPolicy(this.settings.referrer_policy);\n\n        DOMUtils$1.DOM.styleSheetLoader._setReferrerPolicy(this.settings.referrer_policy);\n      }\n\n      AddOnManager$1.languageLoad = this.settings.language_load;\n      AddOnManager$1.baseURL = editorManager.baseURL;\n      this.id = id;\n      this.setDirty(false);\n      this.documentBaseURI = new URI(this.settings.document_base_url, {\n        base_uri: this.baseUri\n      });\n      this.baseURI = this.baseUri;\n      this.inline = !!this.settings.inline;\n      this.shortcuts = new Shortcuts(this);\n      this.editorCommands = new EditorCommands(this);\n\n      if (this.settings.cache_suffix) {\n        Env.cacheSuffix = this.settings.cache_suffix.replace(/^[\\?\\&]+/, '');\n      }\n\n      this.ui = {\n        registry: registry(),\n        styleSheetLoader: undefined,\n        show: noop,\n        hide: noop,\n        enable: noop,\n        disable: noop,\n        isDisabled: never\n      };\n      var self = this;\n      var modeInstance = create$5(self);\n      this.mode = modeInstance;\n      this.setMode = modeInstance.set;\n      editorManager.fire('SetupEditor', {\n        editor: this\n      });\n      this.execCallback('setup', this);\n      this.$ = DomQuery.overrideDefaults(function () {\n        return {\n          context: _this.inline ? _this.getBody() : _this.getDoc(),\n          element: _this.getBody()\n        };\n      });\n    }\n\n    Editor.prototype.render = function () {\n      render(this);\n    };\n\n    Editor.prototype.focus = function (skipFocus) {\n      focus$1(this, skipFocus);\n    };\n\n    Editor.prototype.hasFocus = function () {\n      return hasFocus$1(this);\n    };\n\n    Editor.prototype.execCallback = function (name) {\n      var x = [];\n\n      for (var _i = 1; _i < arguments.length; _i++) {\n        x[_i - 1] = arguments[_i];\n      }\n\n      var self = this;\n      var callback = self.settings[name],\n          scope;\n\n      if (!callback) {\n        return;\n      }\n\n      if (self.callbackLookup && (scope = self.callbackLookup[name])) {\n        callback = scope.func;\n        scope = scope.scope;\n      }\n\n      if (typeof callback === 'string') {\n        scope = callback.replace(/\\.\\w+$/, '');\n        scope = scope ? resolve$3(scope) : 0;\n        callback = resolve$3(callback);\n        self.callbackLookup = self.callbackLookup || {};\n        self.callbackLookup[name] = {\n          func: callback,\n          scope: scope\n        };\n      }\n\n      return callback.apply(scope || self, x);\n    };\n\n    Editor.prototype.translate = function (text) {\n      return I18n.translate(text);\n    };\n\n    Editor.prototype.getParam = function (name, defaultVal, type) {\n      return getParam(this, name, defaultVal, type);\n    };\n\n    Editor.prototype.hasPlugin = function (name, loaded) {\n      var hasPlugin = contains(getPlugins(this).split(/[ ,]/), name);\n\n      if (hasPlugin) {\n        return loaded ? PluginManager.get(name) !== undefined : true;\n      } else {\n        return false;\n      }\n    };\n\n    Editor.prototype.nodeChanged = function (args) {\n      this._nodeChangeDispatcher.nodeChanged(args);\n    };\n\n    Editor.prototype.addCommand = function (name, callback, scope) {\n      this.editorCommands.addCommand(name, callback, scope);\n    };\n\n    Editor.prototype.addQueryStateHandler = function (name, callback, scope) {\n      this.editorCommands.addQueryStateHandler(name, callback, scope);\n    };\n\n    Editor.prototype.addQueryValueHandler = function (name, callback, scope) {\n      this.editorCommands.addQueryValueHandler(name, callback, scope);\n    };\n\n    Editor.prototype.addShortcut = function (pattern, desc, cmdFunc, scope) {\n      this.shortcuts.add(pattern, desc, cmdFunc, scope);\n    };\n\n    Editor.prototype.execCommand = function (cmd, ui, value, args) {\n      return this.editorCommands.execCommand(cmd, ui, value, args);\n    };\n\n    Editor.prototype.queryCommandState = function (cmd) {\n      return this.editorCommands.queryCommandState(cmd);\n    };\n\n    Editor.prototype.queryCommandValue = function (cmd) {\n      return this.editorCommands.queryCommandValue(cmd);\n    };\n\n    Editor.prototype.queryCommandSupported = function (cmd) {\n      return this.editorCommands.queryCommandSupported(cmd);\n    };\n\n    Editor.prototype.show = function () {\n      var self = this;\n\n      if (self.hidden) {\n        self.hidden = false;\n\n        if (self.inline) {\n          self.getBody().contentEditable = 'true';\n        } else {\n          DOM$9.show(self.getContainer());\n          DOM$9.hide(self.id);\n        }\n\n        self.load();\n        self.fire('show');\n      }\n    };\n\n    Editor.prototype.hide = function () {\n      var self = this,\n          doc = self.getDoc();\n\n      if (!self.hidden) {\n        if (ie$1 && doc && !self.inline) {\n          doc.execCommand('SelectAll');\n        }\n\n        self.save();\n\n        if (self.inline) {\n          self.getBody().contentEditable = 'false';\n\n          if (self === self.editorManager.focusedEditor) {\n            self.editorManager.focusedEditor = null;\n          }\n        } else {\n          DOM$9.hide(self.getContainer());\n          DOM$9.setStyle(self.id, 'display', self.orgDisplay);\n        }\n\n        self.hidden = true;\n        self.fire('hide');\n      }\n    };\n\n    Editor.prototype.isHidden = function () {\n      return !!this.hidden;\n    };\n\n    Editor.prototype.setProgressState = function (state, time) {\n      this.fire('ProgressState', {\n        state: state,\n        time: time\n      });\n    };\n\n    Editor.prototype.load = function (args) {\n      var self = this;\n      var elm = self.getElement(),\n          html;\n\n      if (self.removed) {\n        return '';\n      }\n\n      if (elm) {\n        args = args || {};\n        args.load = true;\n        var value = isTextareaOrInput(elm) ? elm.value : elm.innerHTML;\n        html = self.setContent(value, args);\n        args.element = elm;\n\n        if (!args.no_events) {\n          self.fire('LoadContent', args);\n        }\n\n        args.element = elm = null;\n        return html;\n      }\n    };\n\n    Editor.prototype.save = function (args) {\n      var self = this;\n      var elm = self.getElement(),\n          html,\n          form;\n\n      if (!elm || !self.initialized || self.removed) {\n        return;\n      }\n\n      args = args || {};\n      args.save = true;\n      args.element = elm;\n      html = args.content = self.getContent(args);\n\n      if (!args.no_events) {\n        self.fire('SaveContent', args);\n      }\n\n      if (args.format === 'raw') {\n        self.fire('RawSaveContent', args);\n      }\n\n      html = args.content;\n\n      if (!isTextareaOrInput(elm)) {\n        if (args.is_removing || !self.inline) {\n          elm.innerHTML = html;\n        }\n\n        if (form = DOM$9.getParent(self.id, 'form')) {\n          each$i(form.elements, function (elm) {\n            if (elm.name === self.id) {\n              elm.value = html;\n              return false;\n            }\n          });\n        }\n      } else {\n        elm.value = html;\n      }\n\n      args.element = elm = null;\n\n      if (args.set_dirty !== false) {\n        self.setDirty(false);\n      }\n\n      return html;\n    };\n\n    Editor.prototype.setContent = function (content, args) {\n      return setContent$2(this, content, args);\n    };\n\n    Editor.prototype.getContent = function (args) {\n      return getContent$2(this, args);\n    };\n\n    Editor.prototype.insertContent = function (content, args) {\n      if (args) {\n        content = extend$3({\n          content: content\n        }, args);\n      }\n\n      this.execCommand('mceInsertContent', false, content);\n    };\n\n    Editor.prototype.resetContent = function (initialContent) {\n      if (initialContent === undefined) {\n        setContent$2(this, this.startContent, {\n          format: 'raw'\n        });\n      } else {\n        setContent$2(this, initialContent);\n      }\n\n      this.undoManager.reset();\n      this.setDirty(false);\n      this.nodeChanged();\n    };\n\n    Editor.prototype.isDirty = function () {\n      return !this.isNotDirty;\n    };\n\n    Editor.prototype.setDirty = function (state) {\n      var oldState = !this.isNotDirty;\n      this.isNotDirty = !state;\n\n      if (state && state !== oldState) {\n        this.fire('dirty');\n      }\n    };\n\n    Editor.prototype.getContainer = function () {\n      var self = this;\n\n      if (!self.container) {\n        self.container = DOM$9.get(self.editorContainer || self.id + '_parent');\n      }\n\n      return self.container;\n    };\n\n    Editor.prototype.getContentAreaContainer = function () {\n      return this.contentAreaContainer;\n    };\n\n    Editor.prototype.getElement = function () {\n      if (!this.targetElm) {\n        this.targetElm = DOM$9.get(this.id);\n      }\n\n      return this.targetElm;\n    };\n\n    Editor.prototype.getWin = function () {\n      var self = this;\n      var elm;\n\n      if (!self.contentWindow) {\n        elm = self.iframeElement;\n\n        if (elm) {\n          self.contentWindow = elm.contentWindow;\n        }\n      }\n\n      return self.contentWindow;\n    };\n\n    Editor.prototype.getDoc = function () {\n      var self = this;\n      var win;\n\n      if (!self.contentDocument) {\n        win = self.getWin();\n\n        if (win) {\n          self.contentDocument = win.document;\n        }\n      }\n\n      return self.contentDocument;\n    };\n\n    Editor.prototype.getBody = function () {\n      var doc = this.getDoc();\n      return this.bodyElement || (doc ? doc.body : null);\n    };\n\n    Editor.prototype.convertURL = function (url, name, elm) {\n      var self = this,\n          settings = self.settings;\n\n      if (settings.urlconverter_callback) {\n        return self.execCallback('urlconverter_callback', url, elm, true, name);\n      }\n\n      if (!settings.convert_urls || elm && elm.nodeName === 'LINK' || url.indexOf('file:') === 0 || url.length === 0) {\n        return url;\n      }\n\n      if (settings.relative_urls) {\n        return self.documentBaseURI.toRelative(url);\n      }\n\n      url = self.documentBaseURI.toAbsolute(url, settings.remove_script_host);\n      return url;\n    };\n\n    Editor.prototype.addVisual = function (elm) {\n      addVisual$1(this, elm);\n    };\n\n    Editor.prototype.remove = function () {\n      remove$7(this);\n    };\n\n    Editor.prototype.destroy = function (automatic) {\n      destroy(this, automatic);\n    };\n\n    Editor.prototype.uploadImages = function (callback) {\n      return this.editorUpload.uploadImages(callback);\n    };\n\n    Editor.prototype._scanForImages = function () {\n      return this.editorUpload.scanForImages();\n    };\n\n    Editor.prototype.addButton = function () {\n      throw new Error('editor.addButton has been removed in tinymce 5x, use editor.ui.registry.addButton or editor.ui.registry.addToggleButton or editor.ui.registry.addSplitButton instead');\n    };\n\n    Editor.prototype.addSidebar = function () {\n      throw new Error('editor.addSidebar has been removed in tinymce 5x, use editor.ui.registry.addSidebar instead');\n    };\n\n    Editor.prototype.addMenuItem = function () {\n      throw new Error('editor.addMenuItem has been removed in tinymce 5x, use editor.ui.registry.addMenuItem instead');\n    };\n\n    Editor.prototype.addContextToolbar = function () {\n      throw new Error('editor.addContextToolbar has been removed in tinymce 5x, use editor.ui.registry.addContextToolbar instead');\n    };\n\n    return Editor;\n  }();\n\n  var DOM$a = DOMUtils$1.DOM;\n  var explode$4 = Tools.explode,\n      each$j = Tools.each,\n      extend$4 = Tools.extend;\n  var instanceCounter = 0,\n      boundGlobalEvents = false;\n  var beforeUnloadDelegate;\n  var legacyEditors = [];\n  var editors = [];\n\n  var isValidLegacyKey = function (id) {\n    return id !== 'length';\n  };\n\n  var globalEventDelegate = function (e) {\n    var type = e.type;\n    each$j(EditorManager.get(), function (editor) {\n      switch (type) {\n        case 'scroll':\n          editor.fire('ScrollWindow', e);\n          break;\n\n        case 'resize':\n          editor.fire('ResizeWindow', e);\n          break;\n      }\n    });\n  };\n\n  var toggleGlobalEvents = function (state) {\n    if (state !== boundGlobalEvents) {\n      if (state) {\n        DomQuery(window).on('resize scroll', globalEventDelegate);\n      } else {\n        DomQuery(window).off('resize scroll', globalEventDelegate);\n      }\n\n      boundGlobalEvents = state;\n    }\n  };\n\n  var removeEditorFromList = function (targetEditor) {\n    var oldEditors = editors;\n    delete legacyEditors[targetEditor.id];\n\n    for (var i = 0; i < legacyEditors.length; i++) {\n      if (legacyEditors[i] === targetEditor) {\n        legacyEditors.splice(i, 1);\n        break;\n      }\n    }\n\n    editors = filter(editors, function (editor) {\n      return targetEditor !== editor;\n    });\n\n    if (EditorManager.activeEditor === targetEditor) {\n      EditorManager.activeEditor = editors.length > 0 ? editors[0] : null;\n    }\n\n    if (EditorManager.focusedEditor === targetEditor) {\n      EditorManager.focusedEditor = null;\n    }\n\n    return oldEditors.length !== editors.length;\n  };\n\n  var purgeDestroyedEditor = function (editor) {\n    if (editor && editor.initialized && !(editor.getContainer() || editor.getBody()).parentNode) {\n      removeEditorFromList(editor);\n      editor.unbindAllNativeEvents();\n      editor.destroy(true);\n      editor.removed = true;\n      editor = null;\n    }\n\n    return editor;\n  };\n\n  var isQuirksMode = document.compatMode !== 'CSS1Compat';\n\n  var EditorManager = __assign(__assign({}, Observable), {\n    baseURI: null,\n    baseURL: null,\n    defaultSettings: {},\n    documentBaseURL: null,\n    suffix: null,\n    $: DomQuery,\n    majorVersion: '5',\n    minorVersion: '6.2',\n    releaseDate: '2020-12-08',\n    editors: legacyEditors,\n    i18n: I18n,\n    activeEditor: null,\n    focusedEditor: null,\n    settings: {},\n    setup: function () {\n      var self = this;\n      var baseURL,\n          documentBaseURL,\n          suffix = '';\n      documentBaseURL = URI.getDocumentBaseUrl(document.location);\n\n      if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(documentBaseURL)) {\n        documentBaseURL = documentBaseURL.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n\n        if (!/[\\/\\\\]$/.test(documentBaseURL)) {\n          documentBaseURL += '/';\n        }\n      }\n\n      var preInit = window.tinymce || window.tinyMCEPreInit;\n\n      if (preInit) {\n        baseURL = preInit.base || preInit.baseURL;\n        suffix = preInit.suffix;\n      } else {\n        var scripts = document.getElementsByTagName('script');\n\n        for (var i = 0; i < scripts.length; i++) {\n          var src = scripts[i].src || '';\n\n          if (src === '') {\n            continue;\n          }\n\n          var srcScript = src.substring(src.lastIndexOf('/'));\n\n          if (/tinymce(\\.full|\\.jquery|)(\\.min|\\.dev|)\\.js/.test(src)) {\n            if (srcScript.indexOf('.min') !== -1) {\n              suffix = '.min';\n            }\n\n            baseURL = src.substring(0, src.lastIndexOf('/'));\n            break;\n          }\n        }\n\n        if (!baseURL && document.currentScript) {\n          var src = document.currentScript.src;\n\n          if (src.indexOf('.min') !== -1) {\n            suffix = '.min';\n          }\n\n          baseURL = src.substring(0, src.lastIndexOf('/'));\n        }\n      }\n\n      self.baseURL = new URI(documentBaseURL).toAbsolute(baseURL);\n      self.documentBaseURL = documentBaseURL;\n      self.baseURI = new URI(self.baseURL);\n      self.suffix = suffix;\n      setup$2(self);\n    },\n    overrideDefaults: function (defaultSettings) {\n      var baseUrl = defaultSettings.base_url;\n\n      if (baseUrl) {\n        this._setBaseUrl(baseUrl);\n      }\n\n      var suffix = defaultSettings.suffix;\n\n      if (defaultSettings.suffix) {\n        this.suffix = suffix;\n      }\n\n      this.defaultSettings = defaultSettings;\n      var pluginBaseUrls = defaultSettings.plugin_base_urls;\n\n      if (pluginBaseUrls !== undefined) {\n        each$1(pluginBaseUrls, function (pluginBaseUrl, pluginName) {\n          AddOnManager$1.PluginManager.urls[pluginName] = pluginBaseUrl;\n        });\n      }\n    },\n    init: function (settings) {\n      var self = this;\n      var result;\n      var invalidInlineTargets = Tools.makeMap('area base basefont br col frame hr img input isindex link meta param embed source wbr track ' + 'colgroup option table tbody tfoot thead tr th td script noscript style textarea video audio iframe object menu', ' ');\n\n      var isInvalidInlineTarget = function (settings, elm) {\n        return settings.inline && elm.tagName.toLowerCase() in invalidInlineTargets;\n      };\n\n      var createId = function (elm) {\n        var id = elm.id;\n\n        if (!id) {\n          id = get$1(elm, 'name').filter(function (name) {\n            return !DOM$a.get(name);\n          }).getOrThunk(DOM$a.uniqueId);\n          elm.setAttribute('id', id);\n        }\n\n        return id;\n      };\n\n      var execCallback = function (name) {\n        var callback = settings[name];\n\n        if (!callback) {\n          return;\n        }\n\n        return callback.apply(self, Array.prototype.slice.call(arguments, 2));\n      };\n\n      var hasClass = function (elm, className) {\n        return className.constructor === RegExp ? className.test(elm.className) : DOM$a.hasClass(elm, className);\n      };\n\n      var findTargets = function (settings) {\n        var targets = [];\n\n        if (Env.browser.isIE() && Env.browser.version.major < 11) {\n          initError('TinyMCE does not support the browser you are using. For a list of supported' + ' browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/');\n          return [];\n        } else if (isQuirksMode) {\n          initError('Failed to initialize the editor as the document is not in standards mode. ' + 'TinyMCE requires standards mode.');\n          return [];\n        }\n\n        if (settings.types) {\n          each$j(settings.types, function (type) {\n            targets = targets.concat(DOM$a.select(type.selector));\n          });\n          return targets;\n        } else if (settings.selector) {\n          return DOM$a.select(settings.selector);\n        } else if (settings.target) {\n          return [settings.target];\n        }\n\n        switch (settings.mode) {\n          case 'exact':\n            var l = settings.elements || '';\n\n            if (l.length > 0) {\n              each$j(explode$4(l), function (id) {\n                var elm = DOM$a.get(id);\n\n                if (elm) {\n                  targets.push(elm);\n                } else {\n                  each$j(document.forms, function (f) {\n                    each$j(f.elements, function (e) {\n                      if (e.name === id) {\n                        id = 'mce_editor_' + instanceCounter++;\n                        DOM$a.setAttrib(e, 'id', id);\n                        targets.push(e);\n                      }\n                    });\n                  });\n                }\n              });\n            }\n\n            break;\n\n          case 'textareas':\n          case 'specific_textareas':\n            each$j(DOM$a.select('textarea'), function (elm) {\n              if (settings.editor_deselector && hasClass(elm, settings.editor_deselector)) {\n                return;\n              }\n\n              if (!settings.editor_selector || hasClass(elm, settings.editor_selector)) {\n                targets.push(elm);\n              }\n            });\n            break;\n        }\n\n        return targets;\n      };\n\n      var provideResults = function (editors) {\n        result = editors;\n      };\n\n      var initEditors = function () {\n        var initCount = 0;\n        var editors = [];\n        var targets;\n\n        var createEditor = function (id, settings, targetElm) {\n          var editor = new Editor(id, settings, self);\n          editors.push(editor);\n          editor.on('init', function () {\n            if (++initCount === targets.length) {\n              provideResults(editors);\n            }\n          });\n          editor.targetElm = editor.targetElm || targetElm;\n          editor.render();\n        };\n\n        DOM$a.unbind(window, 'ready', initEditors);\n        execCallback('onpageload');\n        targets = DomQuery.unique(findTargets(settings));\n\n        if (settings.types) {\n          each$j(settings.types, function (type) {\n            Tools.each(targets, function (elm) {\n              if (DOM$a.is(elm, type.selector)) {\n                createEditor(createId(elm), extend$4({}, settings, type), elm);\n                return false;\n              }\n\n              return true;\n            });\n          });\n          return;\n        }\n\n        Tools.each(targets, function (elm) {\n          purgeDestroyedEditor(self.get(elm.id));\n        });\n        targets = Tools.grep(targets, function (elm) {\n          return !self.get(elm.id);\n        });\n\n        if (targets.length === 0) {\n          provideResults([]);\n        } else {\n          each$j(targets, function (elm) {\n            if (isInvalidInlineTarget(settings, elm)) {\n              initError('Could not initialize inline editor on invalid inline target element', elm);\n            } else {\n              createEditor(createId(elm), settings, elm);\n            }\n          });\n        }\n      };\n\n      self.settings = settings;\n      DOM$a.bind(window, 'ready', initEditors);\n      return new promiseObj(function (resolve) {\n        if (result) {\n          resolve(result);\n        } else {\n          provideResults = function (editors) {\n            resolve(editors);\n          };\n        }\n      });\n    },\n    get: function (id) {\n      if (arguments.length === 0) {\n        return editors.slice(0);\n      } else if (isString(id)) {\n        return find(editors, function (editor) {\n          return editor.id === id;\n        }).getOr(null);\n      } else if (isNumber(id)) {\n        return editors[id] ? editors[id] : null;\n      } else {\n        return null;\n      }\n    },\n    add: function (editor) {\n      var self = this;\n      var existingEditor = legacyEditors[editor.id];\n\n      if (existingEditor === editor) {\n        return editor;\n      }\n\n      if (self.get(editor.id) === null) {\n        if (isValidLegacyKey(editor.id)) {\n          legacyEditors[editor.id] = editor;\n        }\n\n        legacyEditors.push(editor);\n        editors.push(editor);\n      }\n\n      toggleGlobalEvents(true);\n      self.activeEditor = editor;\n      self.fire('AddEditor', {\n        editor: editor\n      });\n\n      if (!beforeUnloadDelegate) {\n        beforeUnloadDelegate = function (e) {\n          var event = self.fire('BeforeUnload');\n\n          if (event.returnValue) {\n            e.preventDefault();\n            e.returnValue = event.returnValue;\n            return event.returnValue;\n          }\n        };\n\n        window.addEventListener('beforeunload', beforeUnloadDelegate);\n      }\n\n      return editor;\n    },\n    createEditor: function (id, settings) {\n      return this.add(new Editor(id, settings, this));\n    },\n    remove: function (selector) {\n      var self = this;\n      var i, editor;\n\n      if (!selector) {\n        for (i = editors.length - 1; i >= 0; i--) {\n          self.remove(editors[i]);\n        }\n\n        return;\n      }\n\n      if (isString(selector)) {\n        each$j(DOM$a.select(selector), function (elm) {\n          editor = self.get(elm.id);\n\n          if (editor) {\n            self.remove(editor);\n          }\n        });\n        return;\n      }\n\n      editor = selector;\n\n      if (isNull(self.get(editor.id))) {\n        return null;\n      }\n\n      if (removeEditorFromList(editor)) {\n        self.fire('RemoveEditor', {\n          editor: editor\n        });\n      }\n\n      if (editors.length === 0) {\n        window.removeEventListener('beforeunload', beforeUnloadDelegate);\n      }\n\n      editor.remove();\n      toggleGlobalEvents(editors.length > 0);\n      return editor;\n    },\n    execCommand: function (cmd, ui, value) {\n      var self = this,\n          editor = self.get(value);\n\n      switch (cmd) {\n        case 'mceAddEditor':\n          if (!self.get(value)) {\n            new Editor(value, self.settings, self).render();\n          }\n\n          return true;\n\n        case 'mceRemoveEditor':\n          if (editor) {\n            editor.remove();\n          }\n\n          return true;\n\n        case 'mceToggleEditor':\n          if (!editor) {\n            self.execCommand('mceAddEditor', 0, value);\n            return true;\n          }\n\n          if (editor.isHidden()) {\n            editor.show();\n          } else {\n            editor.hide();\n          }\n\n          return true;\n      }\n\n      if (self.activeEditor) {\n        return self.activeEditor.execCommand(cmd, ui, value);\n      }\n\n      return false;\n    },\n    triggerSave: function () {\n      each$j(editors, function (editor) {\n        editor.save();\n      });\n    },\n    addI18n: function (code, items) {\n      I18n.add(code, items);\n    },\n    translate: function (text) {\n      return I18n.translate(text);\n    },\n    setActive: function (editor) {\n      var activeEditor = this.activeEditor;\n\n      if (this.activeEditor !== editor) {\n        if (activeEditor) {\n          activeEditor.fire('deactivate', {\n            relatedTarget: editor\n          });\n        }\n\n        editor.fire('activate', {\n          relatedTarget: activeEditor\n        });\n      }\n\n      this.activeEditor = editor;\n    },\n    _setBaseUrl: function (baseUrl) {\n      this.baseURL = new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\\/+$/, ''));\n      this.baseURI = new URI(this.baseURL);\n    }\n  });\n\n  EditorManager.setup();\n  var min = Math.min,\n      max = Math.max,\n      round$1 = Math.round;\n\n  var relativePosition = function (rect, targetRect, rel) {\n    var x = targetRect.x;\n    var y = targetRect.y;\n    var w = rect.w;\n    var h = rect.h;\n    var targetW = targetRect.w;\n    var targetH = targetRect.h;\n    var relChars = (rel || '').split('');\n\n    if (relChars[0] === 'b') {\n      y += targetH;\n    }\n\n    if (relChars[1] === 'r') {\n      x += targetW;\n    }\n\n    if (relChars[0] === 'c') {\n      y += round$1(targetH / 2);\n    }\n\n    if (relChars[1] === 'c') {\n      x += round$1(targetW / 2);\n    }\n\n    if (relChars[3] === 'b') {\n      y -= h;\n    }\n\n    if (relChars[4] === 'r') {\n      x -= w;\n    }\n\n    if (relChars[3] === 'c') {\n      y -= round$1(h / 2);\n    }\n\n    if (relChars[4] === 'c') {\n      x -= round$1(w / 2);\n    }\n\n    return create$7(x, y, w, h);\n  };\n\n  var findBestRelativePosition = function (rect, targetRect, constrainRect, rels) {\n    var pos, i;\n\n    for (i = 0; i < rels.length; i++) {\n      pos = relativePosition(rect, targetRect, rels[i]);\n\n      if (pos.x >= constrainRect.x && pos.x + pos.w <= constrainRect.w + constrainRect.x && pos.y >= constrainRect.y && pos.y + pos.h <= constrainRect.h + constrainRect.y) {\n        return rels[i];\n      }\n    }\n\n    return null;\n  };\n\n  var inflate = function (rect, w, h) {\n    return create$7(rect.x - w, rect.y - h, rect.w + w * 2, rect.h + h * 2);\n  };\n\n  var intersect = function (rect, cropRect) {\n    var x1 = max(rect.x, cropRect.x);\n    var y1 = max(rect.y, cropRect.y);\n    var x2 = min(rect.x + rect.w, cropRect.x + cropRect.w);\n    var y2 = min(rect.y + rect.h, cropRect.y + cropRect.h);\n\n    if (x2 - x1 < 0 || y2 - y1 < 0) {\n      return null;\n    }\n\n    return create$7(x1, y1, x2 - x1, y2 - y1);\n  };\n\n  var clamp$1 = function (rect, clampRect, fixedSize) {\n    var x1 = rect.x;\n    var y1 = rect.y;\n    var x2 = rect.x + rect.w;\n    var y2 = rect.y + rect.h;\n    var cx2 = clampRect.x + clampRect.w;\n    var cy2 = clampRect.y + clampRect.h;\n    var underflowX1 = max(0, clampRect.x - x1);\n    var underflowY1 = max(0, clampRect.y - y1);\n    var overflowX2 = max(0, x2 - cx2);\n    var overflowY2 = max(0, y2 - cy2);\n    x1 += underflowX1;\n    y1 += underflowY1;\n\n    if (fixedSize) {\n      x2 += underflowX1;\n      y2 += underflowY1;\n      x1 -= overflowX2;\n      y1 -= overflowY2;\n    }\n\n    x2 -= overflowX2;\n    y2 -= overflowY2;\n    return create$7(x1, y1, x2 - x1, y2 - y1);\n  };\n\n  var create$7 = function (x, y, w, h) {\n    return {\n      x: x,\n      y: y,\n      w: w,\n      h: h\n    };\n  };\n\n  var fromClientRect = function (clientRect) {\n    return create$7(clientRect.left, clientRect.top, clientRect.width, clientRect.height);\n  };\n\n  var Rect = {\n    inflate: inflate,\n    relativePosition: relativePosition,\n    findBestRelativePosition: findBestRelativePosition,\n    intersect: intersect,\n    clamp: clamp$1,\n    create: create$7,\n    fromClientRect: fromClientRect\n  };\n\n  var awaiter = function (resolveCb, rejectCb, timeout) {\n    if (timeout === void 0) {\n      timeout = 1000;\n    }\n\n    var done = false;\n    var timer = null;\n\n    var complete = function (completer) {\n      return function () {\n        var args = [];\n\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n\n        if (!done) {\n          done = true;\n\n          if (timer !== null) {\n            clearTimeout(timer);\n            timer = null;\n          }\n\n          completer.apply(null, args);\n        }\n      };\n    };\n\n    var resolve = complete(resolveCb);\n    var reject = complete(rejectCb);\n\n    var start = function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      if (!done && timer === null) {\n        timer = setTimeout(function () {\n          return reject.apply(null, args);\n        }, timeout);\n      }\n    };\n\n    return {\n      start: start,\n      resolve: resolve,\n      reject: reject\n    };\n  };\n\n  var create$8 = function () {\n    var tasks = {};\n    var resultFns = {};\n\n    var load = function (id, url) {\n      var loadErrMsg = 'Script at URL \"' + url + '\" failed to load';\n      var runErrMsg = 'Script at URL \"' + url + '\" did not call `tinymce.Resource.add(\\'' + id + '\\', data)` within 1 second';\n\n      if (tasks[id] !== undefined) {\n        return tasks[id];\n      } else {\n        var task = new promiseObj(function (resolve, reject) {\n          var waiter = awaiter(resolve, reject);\n          resultFns[id] = waiter.resolve;\n          ScriptLoader.ScriptLoader.loadScript(url, function () {\n            return waiter.start(runErrMsg);\n          }, function () {\n            return waiter.reject(loadErrMsg);\n          });\n        });\n        tasks[id] = task;\n        return task;\n      }\n    };\n\n    var add = function (id, data) {\n      if (resultFns[id] !== undefined) {\n        resultFns[id](data);\n        delete resultFns[id];\n      }\n\n      tasks[id] = promiseObj.resolve(data);\n    };\n\n    return {\n      load: load,\n      add: add\n    };\n  };\n\n  var Resource = create$8();\n  var each$k = Tools.each,\n      extend$5 = Tools.extend;\n  var extendClass, initializing;\n\n  var Class = function () {};\n\n  Class.extend = extendClass = function (props) {\n    var self = this;\n    var _super = self.prototype;\n\n    var Class = function () {\n      var i, mixins, mixin;\n      var self = this;\n\n      if (!initializing) {\n        if (self.init) {\n          self.init.apply(self, arguments);\n        }\n\n        mixins = self.Mixins;\n\n        if (mixins) {\n          i = mixins.length;\n\n          while (i--) {\n            mixin = mixins[i];\n\n            if (mixin.init) {\n              mixin.init.apply(self, arguments);\n            }\n          }\n        }\n      }\n    };\n\n    var dummy = function () {\n      return this;\n    };\n\n    var createMethod = function (name, fn) {\n      return function () {\n        var self = this;\n        var tmp = self._super;\n        self._super = _super[name];\n        var ret = fn.apply(self, arguments);\n        self._super = tmp;\n        return ret;\n      };\n    };\n\n    initializing = true;\n    var prototype = new self();\n    initializing = false;\n\n    if (props.Mixins) {\n      each$k(props.Mixins, function (mixin) {\n        for (var name_1 in mixin) {\n          if (name_1 !== 'init') {\n            props[name_1] = mixin[name_1];\n          }\n        }\n      });\n\n      if (_super.Mixins) {\n        props.Mixins = _super.Mixins.concat(props.Mixins);\n      }\n    }\n\n    if (props.Methods) {\n      each$k(props.Methods.split(','), function (name) {\n        props[name] = dummy;\n      });\n    }\n\n    if (props.Properties) {\n      each$k(props.Properties.split(','), function (name) {\n        var fieldName = '_' + name;\n\n        props[name] = function (value) {\n          var self = this;\n\n          if (value !== undefined) {\n            self[fieldName] = value;\n            return self;\n          }\n\n          return self[fieldName];\n        };\n      });\n    }\n\n    if (props.Statics) {\n      each$k(props.Statics, function (func, name) {\n        Class[name] = func;\n      });\n    }\n\n    if (props.Defaults && _super.Defaults) {\n      props.Defaults = extend$5({}, _super.Defaults, props.Defaults);\n    }\n\n    each$1(props, function (member, name) {\n      if (typeof member === 'function' && _super[name]) {\n        prototype[name] = createMethod(name, member);\n      } else {\n        prototype[name] = member;\n      }\n    });\n    Class.prototype = prototype;\n    Class.constructor = Class;\n    Class.extend = extendClass;\n    return Class;\n  };\n\n  var min$1 = Math.min,\n      max$1 = Math.max,\n      round$2 = Math.round;\n\n  var Color = function (value) {\n    var self = {};\n    var r = 0,\n        g = 0,\n        b = 0;\n\n    var rgb2hsv = function (r, g, b) {\n      var h, s, v;\n      h = 0;\n      s = 0;\n      v = 0;\n      r = r / 255;\n      g = g / 255;\n      b = b / 255;\n      var minRGB = min$1(r, min$1(g, b));\n      var maxRGB = max$1(r, max$1(g, b));\n\n      if (minRGB === maxRGB) {\n        v = minRGB;\n        return {\n          h: 0,\n          s: 0,\n          v: v * 100\n        };\n      }\n\n      var d = r === minRGB ? g - b : b === minRGB ? r - g : b - r;\n      h = r === minRGB ? 3 : b === minRGB ? 1 : 5;\n      h = 60 * (h - d / (maxRGB - minRGB));\n      s = (maxRGB - minRGB) / maxRGB;\n      v = maxRGB;\n      return {\n        h: round$2(h),\n        s: round$2(s * 100),\n        v: round$2(v * 100)\n      };\n    };\n\n    var hsvToRgb = function (hue, saturation, brightness) {\n      hue = (parseInt(hue, 10) || 0) % 360;\n      saturation = parseInt(saturation, 10) / 100;\n      brightness = parseInt(brightness, 10) / 100;\n      saturation = max$1(0, min$1(saturation, 1));\n      brightness = max$1(0, min$1(brightness, 1));\n\n      if (saturation === 0) {\n        r = g = b = round$2(255 * brightness);\n        return;\n      }\n\n      var side = hue / 60;\n      var chroma = brightness * saturation;\n      var x = chroma * (1 - Math.abs(side % 2 - 1));\n      var match = brightness - chroma;\n\n      switch (Math.floor(side)) {\n        case 0:\n          r = chroma;\n          g = x;\n          b = 0;\n          break;\n\n        case 1:\n          r = x;\n          g = chroma;\n          b = 0;\n          break;\n\n        case 2:\n          r = 0;\n          g = chroma;\n          b = x;\n          break;\n\n        case 3:\n          r = 0;\n          g = x;\n          b = chroma;\n          break;\n\n        case 4:\n          r = x;\n          g = 0;\n          b = chroma;\n          break;\n\n        case 5:\n          r = chroma;\n          g = 0;\n          b = x;\n          break;\n\n        default:\n          r = g = b = 0;\n      }\n\n      r = round$2(255 * (r + match));\n      g = round$2(255 * (g + match));\n      b = round$2(255 * (b + match));\n    };\n\n    var toHex = function () {\n      var hex = function (val) {\n        val = parseInt(val, 10).toString(16);\n        return val.length > 1 ? val : '0' + val;\n      };\n\n      return '#' + hex(r) + hex(g) + hex(b);\n    };\n\n    var toRgb = function () {\n      return {\n        r: r,\n        g: g,\n        b: b\n      };\n    };\n\n    var toHsv = function () {\n      return rgb2hsv(r, g, b);\n    };\n\n    var parse = function (value) {\n      var matches;\n\n      if (typeof value === 'object') {\n        if ('r' in value) {\n          r = value.r;\n          g = value.g;\n          b = value.b;\n        } else if ('v' in value) {\n          hsvToRgb(value.h, value.s, value.v);\n        }\n      } else {\n        if (matches = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)[^\\)]*\\)/gi.exec(value)) {\n          r = parseInt(matches[1], 10);\n          g = parseInt(matches[2], 10);\n          b = parseInt(matches[3], 10);\n        } else if (matches = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value)) {\n          r = parseInt(matches[1], 16);\n          g = parseInt(matches[2], 16);\n          b = parseInt(matches[3], 16);\n        } else if (matches = /#([0-F])([0-F])([0-F])/gi.exec(value)) {\n          r = parseInt(matches[1] + matches[1], 16);\n          g = parseInt(matches[2] + matches[2], 16);\n          b = parseInt(matches[3] + matches[3], 16);\n        }\n      }\n\n      r = r < 0 ? 0 : r > 255 ? 255 : r;\n      g = g < 0 ? 0 : g > 255 ? 255 : g;\n      b = b < 0 ? 0 : b > 255 ? 255 : b;\n      return self;\n    };\n\n    if (value) {\n      parse(value);\n    }\n\n    self.toRgb = toRgb;\n    self.toHsv = toHsv;\n    self.toHex = toHex;\n    self.parse = parse;\n    return self;\n  };\n\n  var serialize = function (obj) {\n    var data = JSON.stringify(obj);\n\n    if (!isString(data)) {\n      return data;\n    }\n\n    return data.replace(/[\\u0080-\\uFFFF]/g, function (match) {\n      var hexCode = match.charCodeAt(0).toString(16);\n      return '\\\\u' + '0000'.substring(hexCode.length) + hexCode;\n    });\n  };\n\n  var JSONUtils = {\n    serialize: serialize,\n    parse: function (text) {\n      try {\n        return JSON.parse(text);\n      } catch (ex) {}\n    }\n  };\n  var JSONP = {\n    callbacks: {},\n    count: 0,\n    send: function (settings) {\n      var self = this,\n          dom = DOMUtils$1.DOM,\n          count = settings.count !== undefined ? settings.count : self.count;\n      var id = 'tinymce_jsonp_' + count;\n\n      self.callbacks[count] = function (json) {\n        dom.remove(id);\n        delete self.callbacks[count];\n        settings.callback(json);\n      };\n\n      dom.add(dom.doc.body, 'script', {\n        id: id,\n        src: settings.url,\n        type: 'text/javascript'\n      });\n      self.count++;\n    }\n  };\n\n  var XHR = __assign(__assign({}, Observable), {\n    send: function (settings) {\n      var xhr,\n          count = 0;\n\n      var ready = function () {\n        if (!settings.async || xhr.readyState === 4 || count++ > 10000) {\n          if (settings.success && count < 10000 && xhr.status === 200) {\n            settings.success.call(settings.success_scope, '' + xhr.responseText, xhr, settings);\n          } else if (settings.error) {\n            settings.error.call(settings.error_scope, count > 10000 ? 'TIMED_OUT' : 'GENERAL', xhr, settings);\n          }\n\n          xhr = null;\n        } else {\n          Delay.setTimeout(ready, 10);\n        }\n      };\n\n      settings.scope = settings.scope || this;\n      settings.success_scope = settings.success_scope || settings.scope;\n      settings.error_scope = settings.error_scope || settings.scope;\n      settings.async = settings.async !== false;\n      settings.data = settings.data || '';\n      XHR.fire('beforeInitialize', {\n        settings: settings\n      });\n      xhr = new XMLHttpRequest();\n\n      if (xhr.overrideMimeType) {\n        xhr.overrideMimeType(settings.content_type);\n      }\n\n      xhr.open(settings.type || (settings.data ? 'POST' : 'GET'), settings.url, settings.async);\n\n      if (settings.crossDomain) {\n        xhr.withCredentials = true;\n      }\n\n      if (settings.content_type) {\n        xhr.setRequestHeader('Content-Type', settings.content_type);\n      }\n\n      if (settings.requestheaders) {\n        Tools.each(settings.requestheaders, function (header) {\n          xhr.setRequestHeader(header.key, header.value);\n        });\n      }\n\n      xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n      xhr = XHR.fire('beforeSend', {\n        xhr: xhr,\n        settings: settings\n      }).xhr;\n      xhr.send(settings.data);\n\n      if (!settings.async) {\n        return ready();\n      }\n\n      Delay.setTimeout(ready, 10);\n    }\n  });\n\n  var extend$6 = Tools.extend;\n\n  var JSONRequest = function () {\n    function JSONRequest(settings) {\n      this.settings = extend$6({}, settings);\n      this.count = 0;\n    }\n\n    JSONRequest.sendRPC = function (o) {\n      return new JSONRequest().send(o);\n    };\n\n    JSONRequest.prototype.send = function (args) {\n      var ecb = args.error,\n          scb = args.success;\n      var xhrArgs = extend$6(this.settings, args);\n\n      xhrArgs.success = function (c, x) {\n        c = JSONUtils.parse(c);\n\n        if (typeof c === 'undefined') {\n          c = {\n            error: 'JSON Parse error.'\n          };\n        }\n\n        if (c.error) {\n          ecb.call(xhrArgs.error_scope || xhrArgs.scope, c.error, x);\n        } else {\n          scb.call(xhrArgs.success_scope || xhrArgs.scope, c.result);\n        }\n      };\n\n      xhrArgs.error = function (ty, x) {\n        if (ecb) {\n          ecb.call(xhrArgs.error_scope || xhrArgs.scope, ty, x);\n        }\n      };\n\n      xhrArgs.data = JSONUtils.serialize({\n        id: args.id || 'c' + this.count++,\n        method: args.method,\n        params: args.params\n      });\n      xhrArgs.content_type = 'application/json';\n      XHR.send(xhrArgs);\n    };\n\n    return JSONRequest;\n  }();\n\n  var create$9 = function () {\n    return function () {\n      var data = {};\n      var keys = [];\n      var storage = {\n        getItem: function (key) {\n          var item = data[key];\n          return item ? item : null;\n        },\n        setItem: function (key, value) {\n          keys.push(key);\n          data[key] = String(value);\n        },\n        key: function (index) {\n          return keys[index];\n        },\n        removeItem: function (key) {\n          keys = keys.filter(function (k) {\n            return k === key;\n          });\n          delete data[key];\n        },\n        clear: function () {\n          keys = [];\n          data = {};\n        },\n        length: 0\n      };\n      Object.defineProperty(storage, 'length', {\n        get: function () {\n          return keys.length;\n        },\n        configurable: false,\n        enumerable: false\n      });\n      return storage;\n    }();\n  };\n\n  var localStorage;\n\n  try {\n    var test = '__storage_test__';\n    localStorage = window.localStorage;\n    localStorage.setItem(test, test);\n    localStorage.removeItem(test);\n  } catch (e) {\n    localStorage = create$9();\n  }\n\n  var LocalStorage = localStorage;\n  var publicApi = {\n    geom: {\n      Rect: Rect\n    },\n    util: {\n      Promise: promiseObj,\n      Delay: Delay,\n      Tools: Tools,\n      VK: VK,\n      URI: URI,\n      Class: Class,\n      EventDispatcher: EventDispatcher,\n      Observable: Observable,\n      I18n: I18n,\n      XHR: XHR,\n      JSON: JSONUtils,\n      JSONRequest: JSONRequest,\n      JSONP: JSONP,\n      LocalStorage: LocalStorage,\n      Color: Color\n    },\n    dom: {\n      EventUtils: EventUtils,\n      Sizzle: Sizzle,\n      DomQuery: DomQuery,\n      TreeWalker: DomTreeWalker,\n      TextSeeker: TextSeeker,\n      DOMUtils: DOMUtils$1,\n      ScriptLoader: ScriptLoader,\n      RangeUtils: RangeUtils$1,\n      Serializer: DomSerializer,\n      StyleSheetLoader: StyleSheetLoader,\n      ControlSelection: ControlSelection,\n      BookmarkManager: BookmarkManager$1,\n      Selection: EditorSelection,\n      Event: EventUtils.Event\n    },\n    html: {\n      Styles: Styles,\n      Entities: Entities,\n      Node: AstNode,\n      Schema: Schema,\n      SaxParser: SaxParser$1,\n      DomParser: DomParser,\n      Writer: Writer,\n      Serializer: HtmlSerializer\n    },\n    Env: Env,\n    AddOnManager: AddOnManager$1,\n    Annotator: Annotator,\n    Formatter: Formatter,\n    UndoManager: UndoManager,\n    EditorCommands: EditorCommands,\n    WindowManager: WindowManager,\n    NotificationManager: NotificationManager,\n    EditorObservable: EditorObservable,\n    Shortcuts: Shortcuts,\n    Editor: Editor,\n    FocusManager: FocusManager,\n    EditorManager: EditorManager,\n    DOM: DOMUtils$1.DOM,\n    ScriptLoader: ScriptLoader.ScriptLoader,\n    PluginManager: PluginManager,\n    ThemeManager: ThemeManager,\n    IconManager: IconManager,\n    Resource: Resource,\n    trim: Tools.trim,\n    isArray: Tools.isArray,\n    is: Tools.is,\n    toArray: Tools.toArray,\n    makeMap: Tools.makeMap,\n    each: Tools.each,\n    map: Tools.map,\n    grep: Tools.grep,\n    inArray: Tools.inArray,\n    extend: Tools.extend,\n    create: Tools.create,\n    walk: Tools.walk,\n    createNS: Tools.createNS,\n    resolve: Tools.resolve,\n    explode: Tools.explode,\n    _addCacheSuffix: Tools._addCacheSuffix,\n    isOpera: Env.opera,\n    isWebKit: Env.webkit,\n    isIE: Env.ie,\n    isGecko: Env.gecko,\n    isMac: Env.mac\n  };\n  var tinymce = Tools.extend(EditorManager, publicApi);\n\n  var exportToModuleLoaders = function (tinymce) {\n    if (typeof module === 'object') {\n      try {\n        module.exports = tinymce;\n      } catch (_) {}\n    }\n  };\n\n  var exportToWindowGlobal = function (tinymce) {\n    window.tinymce = tinymce;\n    window.tinyMCE = tinymce;\n  };\n\n  exportToWindowGlobal(tinymce);\n  exportToModuleLoaders(tinymce);\n})();","map":{"version":3,"sources":["C:/Users/horne/Documents/SeniorProject/ehr/client/node_modules/tinymce/tinymce.js"],"names":["typeOf","x","undefined","t","Array","prototype","isPrototypeOf","constructor","name","String","isEquatableType","indexOf","sort","xs","compareFn","clone","slice","call","contramap","eqa","f","eq","y","tripleEq","eqString","eqArray","length","len","i","eqSortedArray","eqRecord","kx","Object","keys","ky","q","eqAny","tx","ty","noop","compose","fa","fb","args","_i","arguments","apply","compose1","fbc","fab","a","constant","value","identity","curry","fn","initialArgs","restArgs","all","concat","not","die","msg","Error","never","always","none","NONE","o","isNone","thunk","id","n","me","fold","_s","is","isSome","getOr","getOrThunk","getOrDie","getOrNull","getOrUndefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","some","constant_a","self","s","v","elementEq","b","from","Optional","typeOf$1","isType","type","isSimpleType","eq$1","isString","isObject","isArray","isNull","isBoolean","isUndefined","isNullable","isNonNullable","isFunction","isNumber","nativeSlice","nativeIndexOf","nativePush","push","rawIndexOf","ts","r","contains","pred","eachr","partition","pass","fail","arr","foldr","acc","foldl","findUntil","until","find","findIndex","flatten","reverse","difference","a1","a2","mapToObject","sort$1","comparator","copy","get","head","last","from$1","findMap","hasOwnProperty","each$1","obj","props","k","map$1","tupleMap","tuple","objAcc","internalFilter","onTrue","onFalse","bifilter","filter$1","mapToArray","values","get$1","key","has","hasNonNullableKey","equal","isArray$1","array","l","each$2","cb","map$2","callback","out","item","index","filter$2","indexOf$1","reduce","collection","iteratee","accumulator","thisArg","findIndex$1","predicate","last$1","__assign","assign","p","__rest","e","getOwnPropertySymbols","propertyIsEnumerable","__spreadArrays","il","j","jl","cached","called","DeviceType","os","browser","userAgent","mediaMatch","isiPad","isiOS","test","isiPhone","isMobile","isAndroid","isTouch","isTablet","isPhone","iOSwebview","isSafari","isDesktop","isWebView","firstMatch","regexes","find$1","agent","major","minor","group","Number","replace","nu","detect","versionRegexes","cleanedAgent","toLowerCase","unknown","Version","detect$1","candidates","candidate","search","detectBrowser","browsers","version","current","detectOs","oses","UaString","removeFromStart","str","numChars","substring","checkRange","substr","start","removeLeading","prefix","startsWith","contains$1","blank","trim","lTrim","rTrim","normalVersionRegex","checkContains","target","uastring","PlatformInfo","edge","chrome","ie","opera","firefox","safari","unknown$1","nu$1","info","isBrowser","isEdge","isChrome","isIE","isOpera","isFirefox","Browser","windows","ios","android","linux","osx","solaris","freebsd","chromeos","unknown$2","nu$2","isOS","isWindows","isOSX","isLinux","isSolaris","isFreeBSD","isChromeOS","OperatingSystem","detect$2","deviceType","PlatformDetection","query","window","matchMedia","matches","platform","navigator","detect$3","platform$1","webkit","fileApi","URL","createObjectURL","windowsPhone","Env","gecko","mac","iOS","contentEditable","transparentSrc","caretAfter","range","getSelection","documentMode","document","ceFalse","cacheSuffix","container","experimentalShadowDom","canHaveCSP","desktop","whiteSpaceRegExp","trim$1","makeMap","items","delim","split","hasOwnProperty$1","prop","create","root","sp","scn","c","de","exec","cn","match","ns","createNS","onCreate","extend","resolve","parent","static","exts","ext","name_1","walk","explode","d","_addCacheSuffix","url","Tools","grep","inArray","hasOwn","fromHtml","html","scope","doc","div","createElement","innerHTML","hasChildNodes","childNodes","console","error","fromDom","fromTag","tag","node","fromText","text","createTextNode","dom","fromPoint","docElm","elementFromPoint","SugarElement","toArray$1","recurse","cur","compareDocumentPosition","documentPositionContainedBy","Node","DOCUMENT_POSITION_CONTAINED_BY","COMMENT","DOCUMENT","DOCUMENT_FRAGMENT","ELEMENT","TEXT","is$1","element","selector","nodeType","elem","msMatchesSelector","webkitMatchesSelector","mozMatchesSelector","bypassSelector","childElementCount","base","querySelectorAll","one","querySelector","eq$2","e1","e2","regularContains","d1","d2","ieContains","contains$2","Global","Function","nodeName","isType$1","isComment","isElement","isText","isDocument","isDocumentFragment","owner","ownerDocument","documentOrOwner","dos","documentElement","defaultView","parentNode","parents","isRoot","stop","ret","rawParent","siblings","filterSelf","elements","children","prevSibling","previousSibling","nextSibling","prevSiblings","nextSiblings","child","cs","firstChild","lastChild","childNodesCount","getHead","isShadowRoot","supported","Element","attachShadow","getRootNode","isSupported","getStyleContainer","getShadowRoot","getShadowHost","host","getOriginalEventTarget","event","el","isOpenShadowHost","composed","composedPath","shadowRoot","before","marker","parent$1","insertBefore","after","sibling","append","prepend","firstChild$1","appendChild","wrap","wrapper","before$1","append$1","empty","textContent","rogue","remove","removeChild","unwrap","children$1","inBody","body","left","top","translate","SugarPosition","boxPosition","box","getBoundingClientRect","firstDefinedOrZero","absolute","win","offsetLeft","offsetTop","scrollTop","pageYOffset","scrollLeft","pageXOffset","clientTop","clientLeft","viewport","get$2","_DOC","to","scrollTo","intoView","alignToTop","scrollIntoViewIfNeeded","scrollIntoView","get$3","_win","bounds","width","height","right","bottom","getBounds","scroll","clientWidth","clientHeight","visualViewport","Math","max","pageLeft","pageTop","isNodeType","isRestrictedNode","getPrototypeOf","isElement$1","matchNodeNames","names","lowercasedNames","matchStyleValues","cssValue","computed","getComputedStyle","getPropertyValue","hasAttribute","attrName","hasAttributeValue","attrValue","getAttribute","isBogus","isBogusAll","isTable","tagName","hasContentEditableState","isTextareaOrInput","isText$1","isComment$1","isDocument$1","isDocumentFragment$1","isBr","isImg","isContentEditableTrue","isContentEditableFalse","isTableCell","isMedia","isSupported$1","style","rawSet","setAttribute","set","setAll","attrs","get$4","getOpt","has$1","remove$1","removeAttribute","attributes","attr","internalSet","property","setProperty","setAll$1","css","get$5","styles","getUnsafeProperty","getRaw","raw","getAllRaw","ruleName","reflow","offsetWidth","browser$1","firstElement","nodes","getTableCaptionDeltaY","elm","caption","bodyTop","captionTop","captionHeight","offsetHeight","hasChild","getPos","rootElm","offsetParent","pos","exports$1","module$1","exports","define","module","require","amd","g","global","EphoxContactWrapper","u","code","process","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","setTimeout","clearTimeout","runTimeout","fun","runClearTimeout","queue","draining","currentQueue","queueIndex","cleanUpNextTick","drainQueue","timeout","run","nextTick","Item","title","env","argv","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","setImmediate","setTimeoutFunc","Promise","TypeError","_state","_handled","_value","_deferreds","doResolve","handle","deferred","_immediateFn","onFulfilled","onRejected","reject","promise","newValue","then","finale","_unhandledRejectionFn","Handler","done","reason","ex","prom","remaining","res","val","race","err","warn","_setImmediateFn","_setUnhandledRejectionFn","clearImmediate","immediateIds","nextImmediateId","Timeout","setInterval","clearInterval","close","clearFn","_id","_clearFn","unref","ref","enroll","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","onTimeout","_onTimeout","onNextTick","promisePolyfill","boltExport","nu$3","baseFn","data","callbacks","nCallback","isReady","cbs","pure","LazyValue","errorReporter","make","aFutureB","toPromise","anonBind","futureB","toLazy","toCached","cache","nu$4","pure$1","Future","par","asyncValues","count","asyncValue","par$1","futures","_opt","_f","mapError","_","onValue","toOptional","isValue","isError","message","opt","onError","fromOption","Result","generate","cases","constructors","adt","acase","keys$1","argLength","branches","branchKeys","join","allReqd","reqKey","log","label","params","Adt","comparison","bothErrors","firstError","secondError","bothValues","unite","result","ClosestOrAncestor","ancestor","closest","child$1","ancestor$1","descendant","closest$1","asap","immediateFn","catch","promiseObj","requestAnimationFramePromise","requestAnimationFrame","requestAnimationFrameFunc","vendors","featurefill","wrappedSetTimeout","time","wrappedSetInterval","wrappedClearTimeout","wrappedClearInterval","debounce","timer","func","Delay","setEditorTimeout","editor","removed","setEditorInterval","throttle","StyleSheetLoader","documentOrShadowRoot","settings","idCount","loadedStates","edos","maxLoadTime","_setReferrerPolicy","referrerPolicy","addStyle","removeStyle","styleContainer","getOrCreateState","passed","failed","load","success","failure","link","urlWithSuffix","state","status","onload","onerror","wait","testCallback","waitCallback","Date","now","startTime","waitForWebKitLinkLoaded","styleSheets","styleSheet","ownerNode","linkElem","rel","contentCssCors","loadF","loadAll","urls","parts","unload","unloadAll","create$1","WeakMap","forElement","referenceElement","rootDom","sl","instance","DomTreeWalker","startNode","rootNode","next","prev","prev2","shallow","findSibling","findPreviousNode","startName","siblingName","blocks","tableCells","tableSections","textBlocks","headings","listItems","lists","wsElements","lazyLookup","lookup","isHeading","isBlock","isTable$1","isInline","isBr$1","isTextBlock","isList","isListItem","isTableSection","isTableCell$1","isWsPreserveElement","ancestor$2","zeroWidth","nbsp","isZwsp","char","removeZwsp","ZWSP","isZwsp$1","trim$2","isElement$2","isText$2","isCaretContainerBlock","isCaretContainerInline","isCaretContainer","hasContent","insertInline","textNode","startsWithCaretContainer","splitText","endsWithCaretContainer","isBeforeInline","charAt","offset","isAtStart","isAfterInline","isAtEnd","createBogusBr","br","insertBlock","blockName","blockNode","trimBogusBr","brs","getElementsByTagName","lastBr","showCaretContainerBlock","caretContainer","isRangeInCaretContainerBlock","startContainer","isContentEditableTrue$1","isContentEditableFalse$1","isBr$2","isText$3","isInvalidTextElement","isAtomicInline","isTable$2","isCaretContainer$1","isCaretCandidate","isNonUiContentEditableFalse","isUnselectable","isInEditable","isAtomicContentEditableFalse","isAtomic","isEditableCaretCandidate","whiteSpaceRegExp$1","isWhitespaceText","hasWhitespacePreserveParent","rootElement","isWhitespace","isNamedAnchor","isContent","isBookmark","isBogus$1","isBogusAll$1","isEmptyNode","targetNode","skipBogus","brCount","walker","isEmpty","isSpan","isInlineContent","surroundedByInlineContent","prevIsInline","nextIsInline","isBookmarkNode","isKeepTextNode","isKeepElement","isDocument$2","trimNode","currentChildren","makeMap$1","attrsCharsRegExp","textCharsRegExp","rawCharsRegExp","entityRegExp","asciiMap","baseEntities","reverseEntities","nativeDecode","innerText","buildEntitiesLookup","radix","chr","entity","fromCharCode","parseInt","namedEntities","encodeRaw","encodeAllRaw","encodeNumeric","charCodeAt","encodeNamed","entities","getEncodeFunc","entitiesMap","encodeNamedAndNumeric","encodeCustomNamed","nameMap","named","numeric","decode","Entities","mapCache","dummyObj","makeMap$2","each$3","extend$1","explode$1","compileSchema","schema","globalAttributes","blockContent","phrasingContent","flowContent","html4BlockContent","html4PhrasingContent","add","ni","attributesOrder","arrayToMap","addAttrs","schemaItem","table","script","compileElementMap","mode","toUpperCase","Schema","patternElements","customElementsMap","specialElements","createLookupTable","option","defaultValue","extendWith","schemaItems","verify_html","valid_elements","validStyles","valid_styles","invalidStyles","invalid_styles","validClasses","valid_classes","whiteSpaceElementsMap","selfClosingElementsMap","shortEndedElementsMap","boolAttrMap","nonEmptyOrMoveCaretBeforeOnEnter","nonEmptyElementsMap","moveCaretBeforeOnEnterElementsMap","textBlockElementsMap","blockElementsMap","textInlineElementsMap","special","RegExp","patternToRegExp","addValidElements","validElements","ei","ai","al","attrData","elementName","attrType","outputName","globalAttributesOrder","elementRuleRegExp","attrRuleRegExp","hasPatternsRegExp","validElementsArr","paddEmpty","removeEmpty","removeEmptyAttrs","attributesRequired","required","splice","attributesDefault","attributesForced","forcedValue","validValues","attributePatterns","pattern","setValidElements","addCustomElements","customElements","customElementRegExp","text_block_elements","block_elements","rule","inline","cloneName","customRule","elmName","addValidChildren","validChildren","childRuleRegExp","getElementRule","custom_elements","valid_children","extended_valid_elements","dd","dt","li","td","th","tr","tbody","thead","tfoot","legend","area","param","parentsRequired","invalid_elements","getValidStyles","getInvalidStyles","getValidClasses","getBoolAttrs","getBlockElements","getTextBlockElements","getTextInlineElements","getShortEndedElements","getSelfClosingElements","getNonEmptyElements","getMoveCaretBeforeOnEnterElements","getWhiteSpaceElements","getSpecialElements","isValidChild","isValid","attrPatterns","getCustomElements","toHex","hex","Styles","rgbRegExp","urlOrStrRegExp","styleRegExp","trimRightRegExp","encodingLookup","invisibleChar","encodingItems","color","parse","isEncoded","urlConverter","url_converter","urlConverterScope","url_converter_scope","compress","suffix","noJoin","canCompress","compress2","encode","keepSlashes","decodeSingleHexSequence","escSeq","decodeHexSequences","processUrl","url2","url3","str2","allow_script_urls","scriptUrl","allow_svg_data_urls","lastIndex","border","serialize","serializeStyles","styleList","i_1","styleMap","eventExpandoPrefix","mouseEventRe","deprecated","keyLocation","layerX","layerY","returnValue","webkitMovementX","webkitMovementY","keyIdentifier","mozPressure","hasIsDefaultPrevented","isDefaultPrevented","returnTrue","returnFalse","addEvent","capture","addEventListener","attachEvent","removeEvent","removeEventListener","detachEvent","isMouseEvent","fix","originalEvent","srcElement","pageX","clientX","eventDoc","pageY","clientY","preventDefault","stopPropagation","isPropagationStopped","cancelBubble","stopImmediatePropagation","isImmediatePropagationStopped","metaKey","bindOnReady","eventUtils","domLoaded","isDocReady","readyState","readyHandler","EventUtils","events","expando","hasMouseEnterLeave","hasFocusIn","callbackList","fakeName","nativeHandler","defaultNativeHandler","evt","executeHandlers","namesList","mouseEnterLeave","currentTarget","related","relatedTarget","unbind","ci","eventMap","fire","parentWindow","clean","destroy","cancel","Event","support","Expr","getText","isXML","tokenize","compile","select","outermostContext","sortInput","hasDuplicate","setDocument","document$1","docElem","documentIsHTML","rbuggyQSA","rbuggyMatches","contains$3","preferredDoc","dirruns","classCache","createCache","tokenCache","compilerCache","sortOrder","strundefined","MAX_NEGATIVE","pop","push_native","indexOf$2","booleans","whitespace","identifier","pseudos","rtrim","rcomma","rcombinators","rattributeQuotes","rpseudo","ridentifier","matchExpr","ID","CLASS","TAG","ATTR","PSEUDO","CHILD","bool","needsContext","rinputs","rheader","rnative","rquickExpr","rsibling","rescape","runescape","funescape","escaped","escapedWhitespace","high","els","Sizzle","context","results","seed","m","groups","old","nid","newContext","newSelector","getElementById","getElementsByClassName","qsa","toSelector","testContext","qsaError","cacheLength","shift","markFunction","siblingCheck","diff","sourceIndex","createInputPseudo","createButtonPseudo","createPositionalPseudo","argument","matchIndexes","hasCompare","getTop","getById","attrId","tmp","className","disconnectedMatch","adown","bup","compare","sortDetached","aup","ap","bp","unshift","expr","matchesSelector","attrHandle","getAttributeNode","specified","uniqueSort","duplicates","detectDuplicates","sortStable","nodeValue","selectors","createPseudo","relative","first","preFilter","excess","unquoted","nodeNameSelector","operator","check","what","simple","forward","ofType","xml","outerCache","nodeIndex","useCache","pseudo","setFilters","idx","matched","input","matcher","unmatched","lang","elemLang","hash","location","focus","activeElement","hasFocus","href","tabIndex","enabled","disabled","checked","selected","selectedIndex","header","button","even","odd","lt","gt","nth","filters","parseOnly","tokens","soFar","preFilters","addCombinator","combinator","checkNonElements","doneName","oldCache","newCache","elementMatcher","matchers","multipleContexts","contexts","condense","newUnmatched","mapped","setMatcher","postFilter","postFinder","postSelector","temp","preMap","postMap","preexisting","elems","matcherIn","matcherOut","matcherFromTokens","checkContext","leadingRelative","implicitRelative","matchContext","matchAnyContext","matcherFromGroupMatchers","elementMatchers","setMatchers","bySet","byElement","superMatcher","outermost","matchedCount","setMatched","contextBackup","dirrunsUnique","random","token","compiled","push$1","slice$1","rquickExpr$1","skipUniques","isDefined","isString$1","isWindow","createFragment","fragDoc","frag","createDocumentFragment","domManipulate","targetNodes","sourceItem","getElementDocument","DomQuery","makeArray","hasClass","wrap$1","lastParent","newWrapper","cloneNode","numericCssMap","booleanMap","propFix","for","class","readonly","cssFix","float","attrHooks","cssHooks","DomQueryConstructor","init","inArray$1","whiteSpaceRegExp$2","trim$3","each$4","unique","hook","removeAttr","camel","dashed","removeProperty","currentStyle","appendTo","prependTo","replaceWith","content","wrapAll","wrapInner","contents","addClass","toggleClass","removeClass","classState","existingClassName","trigger","show","hide","object","sibling$1","firstSibling","contentDocument","contentWindow","wrappedResult","parentsUntil","nextUntil","prevUntil","overrideDefaults","defaults","sub","each$5","grep$1","simpleSelectorRe","setupAttrHooks","getContext","keepValues","keep_values","keepUrlHook","$elm","src","updateInternalStyleAttr","rawValue","findNodeIndex","normalized","lastNodeType","DOMUtils","_this","addedStyles","files","counter","stdMode","boxModel","styleSheetLoader","boundEvents","ownEvents","$","getRoot","$$","getAttrib","defaultVal","getAttribs","setAttrib","originalValue","onSetAttrib","attrElm","deep","clone_1","root_element","getViewPort","argWin","vp","w","h","getPos$1","setStyle","update_styles","setStyles","stylesArg","getStyle","getSize","getRect","size","elms","getParents","collect","selectorVal","getParent","_findSib","getNext","getPrev","setAttribs","setHTML","canHaveHTML","parentElm","newElm","createHTML","outHtml","keepChildren","$node","removeAllAttribs","removeAttributeNode","parseStyle","cssText","serializeStyle","styleElm","DOM","loadCSS","cls","isHidden","uniqueId","getOuterHTML","outerHTML","setOuterHTML","insertAfter","reference","referenceNode","oldElm","replaceChild","rename","attrNode","findCommonAncestor","ps","pe","rgbVal","isNonEmptyElement","bogusVal","createRng","createRange","splitElm","replacementElm","beforeFragment","afterFragment","setStart","setEnd","extractContents","rv","output","getContentEditable","getContentEditableParent","isChildOf","dumpRng","startOffset","endContainer","endOffset","DOMUtils$1","each$6","grep$2","QUEUED","LOADING","LOADED","FAILED","ScriptLoader","states","scriptLoadedCallbacks","queueLoadedCallbacks","loading","loadScript","cleanup","isDone","markDone","loadQueue","loadScripts","scripts","failures","execCallbacks","loadingScripts","notifyCallbacks","Cell","initial","isRaw","isTokenised","currentCode","getLanguageData","getData","setCode","newCode","getCode","langData","translation","getLangData","textstr","removeContext","values_1","substitued","$1","$2","isRtl","hasCode","I18n","AddOnManager","_listeners","runListeners","matchedListeners","listener","dependencies","requireLangPack","languages","languageLoad","waitFor","language","wrappedLanguages","addOn","addOnConstructor","createUrl","baseUrl","dep","resource","addComponents","pluginName","pluginUrl","loadDependencies","addOnUrl","deps","newUrl","urlString","baseURL","lastIndexOf","PluginManager","ThemeManager","AddOnManager$1","rate","last$2","read","add$1","remove$2","supports","classList","get$6","add$2","clazz","remove$3","add$3","cleanClass","remove$4","has$2","descendants","descendants$1","annotation","dataAnnotation","dataAnnotationId","identify","annotationName","rng","selection","getRng","getBody","an","newStart","getAttr","uid","findMarkers","isAnnotation","findAll","markers","directory","nodesAlready","setup","_registry","changeCallbacks","initData","previous","withCallbacks","updateCallbacks","callbackMap","outputData","fireCallbacks","fireNoAnnotation","onNodeChange","annotations","_a","setup$1","registry","identifyParserNode","span","serializer","addNodeFilter","spans","persistent","create$2","register","generate$1","date","getTime","floor","add$4","classes","fromHtml$1","get$7","set$1","owner$1","docDom","fragment","contentElements","clone$1","original","isDeep","TextWalker","isBoundary","direction","TextSeeker","isBlockBoundary","newOffset","backwards","forwards","cat","lift2","oa","ob","lift3","oc","someIf","round","clone$2","rect","collapse","toStart","isEqual","rect1","rect2","isValidOverflow","overflowY","min","isAbove","halfHeight","isBelow","containsXY","getSelectedNode","getNode","extendingChars","isExtendingChar","ch","and","isElement$3","isCaretCandidate$1","isBlock$1","isFloated","isValidElementCaretCandidate","isNotPre","isText$4","isBr$3","resolveIndex","isWhiteSpace","isRange","isHiddenWhiteSpaceRange","getBrClientRect","brNode","nbsp$1","clientRect","getBoundingClientRectWebKitText","sc","ec","so","eo","newRng","cloneRange","setEndAfter","isZeroRect","clientRects","getClientRects","collapseAndInflateWidth","newClientRect","getCaretPositionClientRects","caretPosition","beforeNode","addUniqueAndValidRect","addCharacterOffset","CaretPosition","toRange","isVisible","fromRangeStart","fromRangeEnd","pos1","pos2","isTextPosition","isElementPosition","CaretPosition$1","trimEmptyTextNode","insertNode","insertFragment","rangeInsertNode","isText$5","isBogus$2","nodeIndex$1","normalizedParent","getChildNodes","normalizedTextOffset","equal$1","normalizedNodeIndex","numTextFragments","createPathItem","create$3","path","outputOffset","resolvePathItem","findTextPosition","targetOffset","dataLen","resolve$1","paths","isContentEditableFalse$2","getNormalizedTextOffset","trimmedOffset","getPoint","point","getLocation","bookmark","isCollapsed","end","findIndex$2","moveEndPoint","normalizeTableCellSelection","findAdjacentContentEditableFalseElm","getOffsetBookmark","getCaretBookmark","getRangeBookmark","createBookmarkSpan","filled","getPersistentBookmark","collapsed","rng2","endBookmarkNode","startBookmarkNode","moveToBookmark","keep","getBookmark","getUndoBookmark","DOM$1","defaultPreviewStyles","getBodySetting","getParam","bodyObj","getIframeAttrs","getDocType","getDocumentBaseUrl","getBodyId","getBodyClass","getContentSecurityPolicy","shouldPutBrInPre","getForcedRootBlock","block","getForcedRootBlockAttrs","getBrNewLineSelector","getNoNewLineSelector","shouldKeepStyles","shouldEndContainerOnEmptyBlock","getFontStyleValues","getFontSizeClasses","getImagesDataImgFilter","isAutomaticUploadsEnabled","shouldReuseFileName","shouldReplaceBlobUris","getIconPackName","getIconsUrl","getImageUploadUrl","getImageUploadBasePath","getImagesUploadCredentials","getImagesUploadHandler","shouldUseContentCssCors","getReferrerPolicy","getLanguageCode","getLanguageUrl","shouldIndentUseMargin","getIndentation","getContentCss","contentCss","getDirectionality","getInlineBoundarySelector","getObjectResizing","getResizeImgProportional","getPlaceholder","getElement","getEventRoot","getServiceMessage","getTheme","shouldValidate","isInlineBoundariesEnabled","getFormats","getPreviewStyles","canFormatEmptyLines","getCustomUiSelector","getThemeUrl","isInline$1","hasHiddenInput","shouldPatchSubmit","isEncodingXml","shouldAddFormSubmitTrigger","shouldAddUnloadTrigger","hasForcedRootBlock","getCustomUndoRedoLevels","shouldDisableNodeChange","isReadOnly","hasContentCssCors","getPlugins","getExternalPlugins","shouldBlockUnsupportedDrop","isVisualAidsEnabled","getVisualAidsTableClass","getVisualAidsAnchorClass","isElement$4","isText$6","removeNode","trimCount","trimmedText","deleteZwspChars","deleteData","removeUnchanged","remove$5","removeTextAndReposition","removeElementAndReposition","newPosition","removeTextCaretContainer","removeElementCaretContainer","removeAndReposition","caretContainerNode","browser$2","isContentEditableFalse$3","isMedia$1","isTableCell$2","inlineFakeCaretSelector","getAbsoluteClientRect","scrollX","scrollY","margin","rootRect","trimInlineCaretContainers","fakeCaretTargetNodes","FakeCaret","lastVisualCaret","cursorInterval","rootBlock","caretBlock","caret","caretState","startBlink","isInlineFakeCaretTarget","reposition","getCss","isFakeCaretTableBrowser","isFakeCaretTarget","isContentEditableFalse$4","isMedia$2","isBlockLike","isCaretContainer$2","isCaretContainerBlock$1","isElement$5","isCaretCandidate$2","isForwards","isBackwards","skipCaretContainers","findNode","predicateFn","isCefOrCaretContainer","getParentBlock","isInSameBlock","caretPosition1","caretPosition2","getChildNodeAtRelativeOffset","relativeOffset","beforeAfter","setStartBefore","setEndBefore","setStartAfter","isNodesInSameBlock","node1","node2","lean","before$2","after$1","normalizeRange","leanLeft","leanRight","getRelativeCefElm","getNormalizedRangeEndPoint","normalizedRange","getElementFromPosition","getElementFromPrevPosition","getVisualCaretPosition","walkFn","isMoveInsideSameBlock","inSameBlock","HDirection","isContentEditableFalse$5","isText$7","isElement$6","isBr$4","isCaretCandidate$3","isAtomic$1","isEditableCaretCandidate$1","nodeAtIndex","getCaretCandidatePosition","moveForwardFromBr","nextNode","findCaretPosition","Forwards","startPos","innerNode","rootContentEditableFalseElm","CaretWalker","Backwards","walkToPositionIn","position","fromPosition","afterElement","isBeforeOrStart","isAfterOrEnd","isBeforeAfterSameElement","isAtBr","shouldSkipPosition","navigate","navigateIgnore","ignoreFilter","positionIn","nextPosition","prevPosition","firstPositionIn","lastPositionIn","CARET_ID","isCaretNode","getParentCaretContainer","isStringPathBookmark","isRangeBookmark","isIdBookmark","isIndexBookmark","isPathBookmark","addBogus","resolveCaretPositionBookmark","insertZwsp","isEmpty$1","tryFindRangePosition","padEmptyCaretContainer","setEndPoint","isValidTextNode","restoreEndPoint","appendData","resolvePaths","resolveId","endPos","spos","epos","resolveIndex$1","selectNode","resolve$2","getBookmark$1","setRng","isBookmarkNode$1","is$2","expected","actual","isNbsp","isWhiteSpace$1","isContent$1","isNode","isInlineBlock","moveStart","isWhiteSpaceNode","getNonWhiteSpaceSibling","inc","nextName","isTextBlock$1","ed","allowSpaces","isEmptyTextNode","replaceVars","vars","isEq","str1","normalizeStyleValue","getTextDecoration","decoration","getParents$1","isVariableFormatName","formatName","hasVariableValues","format","isVariableValue","field","fieldValues","formatter","areSimilarFormats","otherFormatName","validKeys","filterObj","validKey","fmt1","filteredFmt1","fmt2","filteredFmt2","isBlockFormat","isSelectorFormat","isInlineFormat","isBookmarkNode$2","getParents$2","isWhiteSpaceNode$1","isTextBlock$2","isBogusBr","findParentContentEditable","walkText","findSpace","findContent","findWordEndPoint","includeTrailingSpaces","lastTextNode","textSeeker","textOffset","spaceResult","findSelectorEndPoint","curFormat","findBlockEndPoint","scopeRoot","isAtBlockBoundary","findParentContainer","block_expand","isSelfOrParentBookmark","expandRng","includeTrailingSpace","startPoint","endPoint","expand","clampToExistingChildren","getEndChild","walk$1","exclude","collectSiblings","endNode","findEndPoint","walkBoundary","parent_1","siblings_1","getRanges","ranges","rangeCount","getRangeAt","getSelectedNodes","hasMultipleRanges","getCellsFromRanges","getCellsFromElement","getCellsFromElementOrRanges","selectedCells","getCellsFromEditor","getSel","getStartNode","getEndNode","getFirstChildren","getLastChildren","hasAllContentsSelected","moveEndPoint$1","hasAnyRanges","sel","runOnRanges","executor","fakeSelectionNodes","fakeNodeRng","preserve","fillBookmark","NodeValue","getOption","api","get$8","isZeroWidth","wrapName","applyWordGrab","makeAnnotation","eDoc","decorate","_b","master","_c","_d","_e","annotate","newWrappers","getDoc","finishWrapper","getOrOpenWrapper","processElements","processElement","ctx","processNodes","annotateWithBookmark","undoManager","transact","initialRng","hasFakeSelection","selectionRng","Annotator","changes","annotationChanged","getAll","BookmarkManager","BookmarkManager$1","getContentEditableRoot","isXYWithinRange","firePreProcess","firePostProcess","fireRemove","fireDetach","fireSwitchMode","fireObjectResizeStart","origin","fireObjectResized","firePreInit","firePostRender","fireInit","firePlaceholderToggle","fireError","errorType","VK","BACKSPACE","DELETE","DOWN","ENTER","LEFT","RIGHT","SPACEBAR","TAB","UP","END","HOME","modifierPressed","shiftKey","ctrlKey","altKey","metaKeyPressed","isContentEditableFalse$6","ControlSelection","selectedElm","selectedElmGhost","resizeHelper","selectedHandle","startX","startY","selectedElmX","selectedElmY","startW","startH","ratio","resizeStarted","editableDoc","rootDocument","abs","startScrollWidth","startScrollHeight","resizeHandles","nw","ne","se","sw","isImage","isEventOnImageOutsideRange","touch","touches","contextMenuSelectImage","getResizeTarget","isResizable","setGhostElmSize","ghostElm","resizeGhostElement","deltaX","deltaY","proportional","resizeHelperX","resizeHelperY","screenX","screenY","display","scrollWidth","scrollHeight","endGhostResize","wasResizeStarted","setSizeProp","showResizeRect","nodeChanged","targetElm","hideResizeRect","unbindResizeHandleEvents","targetWidth","targetHeight","handleElm","startDrag","unSelectabe","updateResizeRect","startElm","controlElm","isChildOrEqual","img","disableGeckoResize","getStart","getEnd","isWithinContentEditableFalse","execCommand","handleMSControlSelect_1","delayedSelect","throttledUpdateResizeRect","composing","hasCeProperty","findParent","findClosestIeRange","rects","createTextRange","moveToElementText","moveToPoint","moveOutOfContentEditableFalse","parentElement","fromPoint$1","pointDoc","caretPositionFromPoint","offsetNode","caretRangeFromPoint","isEq$1","rng1","findParent$1","hasParent","hasParentWithName","isTable$3","isTableCell$3","isCeFalseCaretContainer","hasBrBeforeAfter","isPrevNode","hasContentEditableFalseParent","findTextNodeRelative","isAfterNode","lastInlineElement","parentBlockContainer","normalizeEndPoint","directionLeft","normalize","normRng","split$1","RangeUtils","normalize$1","normalizedRng","compareRanges","getCaretRangeFromPoint","RangeUtils$1","Dimension","getOffset","parseFloat","getOuter","aggregate","properties","isNaN","cumulativeInclusions","absoluteMax","api$1","get$9","walkUp","navigation","frame","view","rest","pathTo","frameElement","Navigation","freeze","__proto__","find$2","frames","loc","excludeFromDescend","fireScrollIntoViewEvent","scrollEvent","fireAfterScrollIntoViewEvent","descend","markerInfo","cleanupFun","createMarker","elementMarker","withMarker","preserveWith","applyWithMarker","withScrollEvents","withElement","startElement","endElement","scrollToMarker","viewHeight","intoWindowIfNeeded","viewportBottom","markerTop","markerBottom","largerThanViewport","align","intoWindow","innerHeight","intoFrame","frameViewHeight","op","viewportBounds","rangeIntoWindow","elementIntoWindow","rangeIntoFrame","elementIntoFrame","scrollElementIntoView","scroller","scrollRangeIntoView","getDocument","create$4","soffset","finish","foffset","SimRange","cata","subject","onBefore","onOn","onAfter","situ","before$3","after$2","Situ","adt$1","domRange","exact","exactFromRange","simRange","getStart$1","startSitu","_finishSitu","_soffset","_finish","_foffset","getWin","SimSelection","browser$3","clamp","normalizeRng","isOrContains","isRngInRoot","shouldStore","nativeRangeToSelectionRange","readRange","getBookmark$2","validate","bookmarkToNativeRng","store","newBookmark","storeNative","restore","isEditorUIElement","FocusManager","isManualNodeChange","selectionChange","registerPageMouseUp","throttledStore","mouseUpPage","registerFocusOut","registerMouseUp","registerEditorEvents","documentFocusInHandler","DOM$2","isEditorUIElement$1","isEditorContentAreaElement","isUIElement","customSelector","getActiveElement","registerEvents","editorManager","focusedEditor","setActive","blurredEditor","activeEditor","unregisterDocumentEvents","setup$2","getContentEditableHost","getCollapsedNode","getFocusInElement","normalizeSelection","caretPos","focusBody","hasElementFocus","hasIframeFocus","iframeElement","hasInlineFocus","rawBody","hasUiFocus","hasFocus$1","hasEditorOrUiFocus","focusEditor","quirks","refreshContentEditable","bookmarkRng","contentEditableHost","activateEditor","focus$1","skipFocus","getEndpointElement","real","getStart$2","skipEmptyTextNodes","orig","getNode$1","commonAncestorContainer","getSelectedBlocks","endElm","selectedBlocks","select$1","processRanges","ensureIsRoot","ancestor$3","transform","transformed","closest$2","isEq$2","matchesUnInheritedFormatSelector","formatList","inherit","matchParents","matchNode","matchName","matchItems","itemName","similar","onmatch","matchAll","matchedFormatNames","checkedMap","closest$3","rawElm","canApply","defaultBlock","matchAllOnNode","formatNames","matchSimilar","typeLookup","walk$2","isEmptyTextNode$1","AstNode","insert","selfAttrs","cloneAttrs","selfAttr","shortEnded","refNode","makeMap$3","Writer","indent","indentBefore","indent_before","indentAfter","indent_after","entity_encoding","htmlOutput","element_format","cdata","comment","pi","doctype","reset","getContent","HtmlSerializer","writer","handlers","handler","sortedAttrs","elementRule","inner","extractBase64DataUris","dataImageUri","chunks","uris","uri","imageId","restoreDataUris","parseDataUri","decodeURIComponent","safeSvgDataUrlElements","isValidPrefixAttrName","blockSvgDataUris","allowSvgDataUrls","allowed","isInvalidUri","allow_html_data_urls","findEndTagIndex","startIndex","shortEndedElements","tokenRegExp","isConditionalComment","findCommentEndIndex","lcHtml","endIfIndex","endIndex","endCommentRegexp","checkBogusAttribute","regExp","attrString","SaxParser","fix_self_closing","parseInternal","base64Extract","endRegExp","stack","attrList","textData","isInternalElement","isShortEnded","isValidElement","attribsValue","validAttributesMap","validAttributePatterns","anyAttributesRequired","filteredUrlAttrs","scriptUriRegExp","parsingMode","processEndTag","valid","processText","processComment","allow_conditional_comments","processAttr","processMalformedComment","startTag","parseAttribute","val2","val3","attrRule","trimRegExp","fillAttrsMap","unescape","attrRegExp","selfClosing","self_closing_elements","removeInternalElements","remove_internals","fixSelfClosing","processHtml","matchText","bogusValue","isValidCdataSection","preserve_cdata","findEndTag","SaxParser$1","trimHtml","tempAttrs","trimContentRegExp","trimInternal","bogusAllRegExp","endTagIndex","matchLength","getTempAttrs","trimExternal","trimEmptyContents","emptyRegExp","getContentFromBody","getInner","no_events","getContentInternal","each$7","ElementUtils","attribs","compareObjects","obj1","obj2","isChar","delta","isBeforeSpace","isAfterSpace","isEmptyText","matchesElementPosition","isImageBlock","isCefNode","isBeforeImageBlock","isAfterImageBlock","isBeforeMedia","isAfterMedia","isBeforeTable","isAfterTable","isBeforeContentEditableFalse","isAfterContentEditableFalse","getLastChildren$1","rawNode","removeTrailingBr","allBrs","fillWithPaddingBr","trimBlockTrailingBr","lastChildPrevSibling","dropLast","parentsUntil$1","parents$1","parentsAndSelf","navigateIgnoreEmptyTextNodes","getClosestBlock","isAtBeforeAfterBlockBoundary","newPos","fromBlock","isAtBlockBoundary$1","isAtStartOfBlock","isAtEndOfBlock","isBeforeBlock","isAfterBlock","isBr$5","findBr","parentBlocks","isBeforeBr","isAfterBr","findPreviousBr","findNextBr","isInMiddleOfText","getClosestBlock$1","hasSpaceBefore","hasSpaceAfter","isPreValue","isInPre","isAtBeginningOfBody","isAtEndOfBody","isAtLineBoundary","needsToHaveNbsp","needsToBeNbspLeft","needsToBeNbspRight","needsToBeNbsp","isNbspAt","hasNbsp","normalizeNbspMiddle","chars","normalizeNbspAtStart","firstPos","normalizeNbspInMiddleOfTextNode","newText","normalizeNbspAtEnd","lastPos","normalizeNbsps","normalizeNbspsInEditor","normalizeContent","isStartOfContent","isEndOfContent","previousCharIsSpace","replaceData","normalizeWhitespaceAfter","whitespaceCount","normalizeWhitespaceBefore","mergeTextNodes","prevNode","normalizeWhitespace","mergeToPrev","whitespaceOffset","newNode","insertData","needsReposition","beforeOrStartOf","afterOrEndOf","getPreviousSiblingCaretPosition","getNextSiblingCaretPosition","findCaretPositionBackwardsFromElm","startPosition","findCaretPositionForwardsFromElm","findCaretPositionBackwards","findCaretPositionForward","findCaretPosition$1","findCaretPosOutsideElmAfterDelete","setSelection","eqRawNode","isBlock$2","paddEmptyBlock","deleteNormalized","afterDeletePosOpt","prevTextOpt","nextTextOpt","isInlineElement","deleteElement","moveCaret","afterDeletePos","parentBlock","normalizedAfterDeletePos","setContent","setCursorLocation","paddPos","tableCellRng","tableSelection","cells","deleteAction","removeTable","emptyCells","deleteCellSelection","isRootFromElement","getClosestCell","getClosestTable","cell","isExpandedCellRng","cellRng","getTableFromCellRng","startParentTable","endParentTable","isSingleCellTable","rows","getTableCells","getCellRng","startCell","endCell","getCellRangeFromStartTable","partialSelection","isWithinSameTable","getTableSelectionFromCellRng","getTableSelection","optCellRng","cRng","getCellIndex","getSelectedCells","isSingleCellTableContentSelected","getAction","getActionFromRange","freefallRtl","deleteCellContents","deleteContents","lastNode","lastBlock","additionalCleanupNodes","deleteTableElement","deleteCellRange","action","deleteCaptionRange","emptyElement","deleteTableRange","getParentCaption","deleteRange","getParentCell","deleteBetweenCells","fromCell","toCell","isDeleteOfLastCharPos","fromCaption","emptyCaretCaption","validateCaretCaption","toCaption","deleteCaretInsideCaption","deleteCaretCells","deleteCaretCaption","isNearTable","isBeforeOrAfterTable","fromPos","deleteCaret","backspaceDelete","createRange$1","normalizeBlockSelectionRange","newEndPos","normalize$2","hasOnlyOneChild","isPaddingNode","isPaddedEmptyBlock","blockElements","isEmptyFragmentElement","nonEmptyElements","isListFragment","cleanupDomFragment","domFragment","toDomFragment","listItems$1","isPadding","isListItemPadded","isEmptyOrPadded","trimListItems","getParentLi","isParentBlockLi","getSplit","beforeRng","afterRng","cloneContents","findFirstIn","caretWalker","newCaretPos","findLastOf","insertMiddle","insertAtCaret","liTarget","liElms","BEGINNING","isAt","trimOrPadLeftRight","isTableCell$4","isTableCellContentSelected","validInsertion","trimBrsFromTableCell","reduceInlineTextElements","merge","textInlineElements","root_1","elementUtils_1","testNode","markFragmentElements","unmarkFragmentElements","isPartOfFragment","canHaveChildren","moveSelectionToMarker","nextRng","getContentEditableFalseParent","parentEditableFalseElm","findNextCaretRng","deleteSelectedContent","insertHtmlAtCaret","details","parser","bookmarkHtml","paste","caretElement","parserArgs","_selectionOverrides","showBlockCaretContainer","invalid","addVisual","traverse","findMatchingNodes","nodeFilters","attributeFilters","nodeMatches","attrMatches","name_2","filter$3","defaultFormat","isTreeNode","moveSelection","setEditorHtml","setContentString","forcedRootBlockName","padd","isRootContent","setContentTree","getNodeFilters","getAttributeFilters","setContentInternal","addVisualInternal","hasVisual","matchedElm","value_1","cls_1","sibling$2","ZWSP$1","CARET_ID$1","importNode","getEmptyCaretContainers","isCaretContainerEmpty","findFirstTextNode","createCaretContainer","fill","trimZwspFromCaretContainer","removeCaretContainerNode","removeCaretContainer","insertCaretContainerNode","formatNode","appendNode","insertFormatNodesIntoCaretContainer","formatNodes","innerMostFormatNode","cleanFormatNode","validFormats","matchedFormats","uniqueFormats","fmtName","clonedFormatNode","applyCaretFormat","wordcharRegex","removeCaretFormat","hasContentAfter","expandedRng","newCaretContainer","cleanedFormatNode","caretTextNode","disableCaretContainer","keyCode","setup$3","replaceWithCaretFormat","innerMost","isFormatElement","inlineElements","isEmptyCaretFormatElement","postProcessHooks","filter$4","each$8","addPostProcessHook","hooks","postProcess","hasPreSibling","pre","isPre","joinPre","pre1","pre2","each$9","isElementNode","findElementSibling","mergeSiblingsNodes","tmpSibling","elementUtils","mergeSiblings","merge_siblings","clearChildStyles","clear_child_styles","links","processChildElements","unwrapEmptySpan","hasStyle","applyStyle","removeResult","MCE_ATTR_RE","each$a","isEq$3","isTableCellOrRow","isChildOfInlineParent","getContainer","lastIdx","normalizeTableSelection","childNode","wrap$2","wrapWithSiblings","matchName$1","isColorFormatAndAnchor","find$3","removeNode$1","rootBlockElm","forcedRootBlock","list_block","forced_root_block_attrs","removeFormatInternal","compareNode","stylesModified","preserve_attributes","attrsToPreserve","remove_similar","valueOut","removeFormat","newName","findFormatRoot","formatRoot","removeFormatFromClone","wrapAndSplit","lastClone","firstClone","formatRootParent","mixed","remove$6","splitToFormatRoot","isRemoveBookmarkNode","lastContentEditable","removeRngStyle","textDecorations","textDecoration","ceFalseOverride","each$b","mergeTextDecorationsAndColor","processTextDecorationsAndColor","mergeBackgroundColorAndFontSize","backgroundColor","mergeSubSup","mergeWithChildren","mergeWithParents","merge_with_parents","each$c","hasFormatProperty","isElementNode$1","canFormatBR","parentName","validBRParentElements","figcaption","summary","hasCaretNodeSibling","applyFormat","setElementFormat","fmt","onformat","styleVal","applyNodeStyle","found","applyRngStyle","nodeSpecific","wrapElm","currentWrapElm","getChildCount","getChildElementNode","mergeStyles","childCount","formatItem","curSelNode","firstFormat","forced_root_block","fake","setup$4","registeredFormatListeners","currentFormats","updateAndFireChangeCallbacks","formatChangeData","formatsList","newFormats","remainingFormats","filterRemainingFormats","addListeners","formats","formatChangeItems","removeListeners","formatChangedInternal","toggle","fromElements","tableModel","tableRow","cellPosition","getSpan","fillout","rowspan","colspan","y2","x2","cellExists","skipCellsX","getWidth","row","findElementPos","extractRows","sx","sy","ey","newRows","subTable","createDomTable","tableElement","tableBody","modelRowsToDomRows","fromDom$1","tableElm","toDom","subsection","findParentListContainer","getFullySelectedListWrappers","_li","listCont","listElm","listStyles","_style","wrap$3","innerElm","wrapped","directListWrappers","commonAnchorContainer","getWrapElements","wrapElements","listWrappers","allWrappers","emptyFragment","getFragmentFromRange","getParentTable","getTableFragment","selectedTableCells","firstCell","lastCell","fullTableModel","sectionedTableModel","getSelectionFragment","read$1","trimLeadingCollapsibleText","isCollapsibleWhitespace","getInnerText","bin","shouldTrim","getContextNodeName","parentBlockOpt","getTextContent","contextNodeName","shouldTrimSpaces","nonRenderedText","parentBlockText","textIndex","hasProceedingSpace","hasTrailingSpace","getSerializedContent","tmpElm","contextual","getSelectedContentInternal","KEEP","INSERT","vDown","vUp","snake","diag","buildScript","start1","end1","start2","end2","middle","getMiddleSnake","i2","buildSnake","sum","getOuterHtml","createFragment$1","insertAt","removeAt","applyDiff","read$2","write","fragments","currentFragments","undoLevelDocument","lazyTempDocument","implementation","createHTMLDocument","hasIframes","createFragmentedLevel","beforeBookmark","createCompleteLevel","createFromEditor","trimmedFragments","trimmed","applyToEditor","level","getLevelContent","getCleanLevelContent","hasEqualContent","level1","level2","hasEqualCleanedContent","isEq$4","isUnlocked","locks","setTyping","typing","endTyping","endTypingLevelIgnoreLocks","beforeChange","addUndoLevel","currentLevel","lastLevel","bm","customUndoRedoLevels","setDirty","clear","extra","callback1","callback2","redo","undo","hasUndo","hasRedo","ignore","isTreeNode$1","runSerializerFiltersOnFragment","getInsertContext","createDummyUndoLevel","makePlainAdaptor","formatChanged","insertContent","getModel","makeRtcAdaptor","tinymceEditor","rtcEditor","defaultVars","unsupported","_undoManager","_locks","_node","matchFormat","canApplyFormat","closestFormat","_similar","toggleFormat","_rfl","_args","_details","contextArgs","_elm","getSelectedContent","getRawModel","isRtc","plugins","setup$5","editorCast","rtcInstance","rtc","isRemote","getRtcInstanceWithFallback","getRtcInstanceWithError","beforeChange$1","addUndoLevel$1","undo$1","redo$1","clear$1","reset$1","hasUndo$1","hasRedo$1","transact$1","ignore$1","extra$1","matchAllFormats","matchNodeFormat","applyFormat$1","removeFormat$1","getContent$1","walkPastBookmark","outer","outerElm","oldLength","normalizeTextIfRequired","mergeAndNormalizeText","outerNode","normalizer","innerTextNode","rngSetContent","prevText","nextText","setupArgs","cleanContent","contextBlock","setContent$1","contentArgs","createContextualFragment","deleteFromCallbackMap","newCallbacks","SelectorChanged","selectorChangedData","currentSelectors","selectorChangedWithUnbind","matchedSelectors","isNativeIeSelection","isAttachedToDom","isValidRange","EditorSelection","selectedRange","explicitRange","getRng$1","getEnd$1","bookmarkManager","compareEndPoints","tryCompareBoundaryPoints","how","sourceRange","destinationRange","compareBoundaryPoints","anchorNode","START_TO_START","END_TO_END","ieRange","removeAllRanges","addRange","setBaseAndExtent","focusNode","setNode","getSelectedBlocks$1","isForward","anchorRange","anchorOffset","focusRange","focusOffset","selectorChanged","getScrollContainer","scrollContainer","placeCaretAt","controlSelection","removeAttrs","addFontToSpansFilter","domParser","fontSizes","face","addStrikeToSpanFilter","addFilters","convert_fonts_to_spans","font_size_legacy_values","register$1","inline_styles","blobUriToBlob","rejectWithError","xhr","XMLHttpRequest","open","responseType","response","send","parseDataUri$1","uriParts","buildBlob","atob","Uint8Array","Blob","dataUriToBlob","uriToBlob","blobToDataUri","blob","reader","FileReader","onloadend","readAsDataURL","imageToBlobInfo","blobCache","base64","blobInfo","getByUri","image","dataUri","getByData","getAllImages","ImageScanner","uploadStatus","cachedPromises","images","isUploaded","promises","imageInfo","newPromise","paddEmptyNode","brPreferred","padd_empty_with_br","isPaddedWithNbsp","hasOnlyChild","isPadded","isEmpty$2","whitespaceElements","isLineBreakNode","isBogusImage","isInternalImageSource","isValidDataImg","images_dataimg_filter","imgElem_1","Image","registerBase64ImageFilter","blob_cache","processImage","inputSrc","blobUri","addAttributeFilter","register$2","remove_trailing_brs","prevName","whiteSpaceElements","appendRel","addNoOpener","newRel","allow_unsafe_link_target","allow_html_in_named_anchor","fix_list_elements","classValue","validClassesMap","makeMap$4","each$d","explode$2","extend$2","DomParser","matchedNodes","matchedAttributes","root_name","fixInvalidChildren","newParent","currentNode","tempNode","nonSplitableElements","textBlockElements","fixed","filterNode","list","fi","fl","invalidChildren","isInWhiteSpacePreservedElement","getRootBlockName","rootBlockName","startWhiteSpaceRegExp","endWhiteSpaceRegExp","allWhiteSpaceRegExp","isAllWhiteSpaceRegExp","addRootBlocks","rootBlockNode","createNode","removeWhitespaceBefore","textNodeNext","textVal","cloneAndExcludeBlocks","attrFiltersLen","register$3","htmlParser","internalName","hasChildren","trimTrailingBr","brNode1","brNode2","preProcess","oldDoc","impl","shouldFireEvent","hasEventListeners","addTempAttr","postProcess$1","outArgs","getHtmlFromNode","parseHtml","serializeNode","htmlSerializer","toHtml","DomSerializerImpl","addRules","rules","setRules","DomSerializer","domSerializer","defaultFormat$1","getContent$2","setContent$2","DOM$3","restoreOriginalStyles","orgDisplay","safeDestroy","clearDomReferences","contentAreaContainer","formElement","editorContainer","bodyElement","restoreForm","form","_mceOldSubmit","submit","formEventDelegate","remove$7","editorUpload","save","is_removing","unbindAllNativeEvents","automatic","destroyed","_beforeUnload","theme","hasOwnProperty$2","deep$1","bothObjects","deepMerge","baseMerge","merger","objects","curObject","sectionResult","sections","deviceDetection","legacyMobilePlugins","defaultTouchSettings","table_grid","object_resizing","resize","normalizePlugins","pluginNames","trimmedPlugins","filterLegacyMobilePlugins","extractSections","getSection","sectionSettings","hasSection","isSectionTheme","section","getSectionConfig","getToolbarMode","getDefaultSettings","documentBaseUrl","baseDefaults","toolbar_mode","document_base_url","add_form_submit_trigger","submit_patch","add_unload_trigger","convert_urls","relative_urls","remove_script_host","visual","hidden_input","convertURL","getDefaultMobileSettings","mobileSettings","defaultMobileSettings","toolbar_sticky","defaultPhoneSettings","menubar","getExternalPlugins$1","overrideSettings","userDefinedExternalPlugins","external_plugins","combinePlugins","forcedPlugins","getPlatformPlugins","isMobileDevice","desktopPlugins","mobilePlugins","processPlugins","defaultOverrideSettings","forced_plugins","mobileConfig","platformPlugins","combinedPlugins","isOnMobile","combineSettings","defaultSettings","defaultDeviceSettings","mobile","extendedSettings","getEditorSettings","getFiltered","getParamObject","isArrayOf","CreateIconManager","iconPack","icons","IconManager","getProp","propName","getComputedSizeProp","getClientWidth","getClientHeight","getMarginTop","getMarginLeft","getBoundingClientRect$1","isInsideElementContentArea","bodyElm","transpose","isXYInContentArea","transposedPoint","fromDomSafe","isEditorAttachedToDom","rawContainer","getContentAreaContainer","NotificationManagerImpl","unimplemented","getArgs","NotificationManager","notifications","getImplementation","getNotificationManagerImpl","getTopNotification","progressBar","addNotification","notification","closeNotification","otherNotification","spec","fireEvent","getEl","getNotifications","serviceMessage","WindowManagerImpl","openUrl","alert","confirm","getParams","setParams","WindowManager","dialogs","getWindowManagerImpl","funcBind","fireOpenEvent","dialog","fireCloseEvent","addDialog","closeDialog","otherDialog","getTopDialog","storeSelectionAndOpenDialog","openDialog","displayNotification","notificationManager","displayError","_skinLoaded","uploadError","logError","createLoadError","pluginLoadError","iconsLoadError","languageLoadError","pluginInitError","initError","isContentCssSkinName","getContentCssUrls","skinUrl","contentCssFile","documentBaseURI","toAbsolute","appendContentCssFromSettings","contentCSS","Uploader","pendingPromises","pathJoin","path1","path2","defaultHandler","progress","withCredentials","credentials","upload","onprogress","loaded","total","json","JSON","responseText","basePath","formData","FormData","filename","noUpload","handlerSuccess","handlerFailure","options","resolvePending","uploadBlobInfo","openNotification","markPending","closeNotification_1","markUploaded","failureOptions","removeFailed","percent","isDefaultHandler","pendingUploadBlobInfo","uploadBlobs","blobInfos","isPending","UploadStatus","PENDING","UPLOADED","blobUriStatuses","createStatus","resultUri","hasBlobUri","getResultUri","count$1","rnd","uuid","BlobCache","mimeToExt","mime","mimes","toBlobInfo","findFirst","cachedBlobInfo","removeByUri","revokeObjectURL","UploadChangeHandler","lastChangedLevel","fireIfChanged","EditorUpload","uploader","imageScanner","urlFilters","changeHandler","aliveGuard","cacheInvalidator","replaceString","replaceImageUrl","targetUrl","replacementUrl","replacementString","replaceUrlInUndoStack","replaceImageUriInView","uploadImages","scanForImages","imageInfos","imagesToRemove","filteredResult","uploadInfo","uploadUri","uploadImagesAuto","isValidDataUriImage","imgElm","dataImgFilter","addFilter","resultItem","replaceBlobUris","source_view","get$a","valigntop","verticalAlign","valignmiddle","valignbottom","alignleft","preview","textAlign","aligncenter","marginLeft","marginRight","alignright","alignjustify","bold","fontWeight","italic","fontStyle","underline","strikethrough","forecolor","hilitecolor","fontname","fontFamily","fontsize","fontSize","lineheight","lineHeight","fontsize_class","blockquote","subscript","superscript","_fmt","_itemName","removeformat","FormatRegistry","unregister","each$e","parsedSelectorToHtml","ancestry","sItem","getRequiredParent","elmRule","wrapInHtml","parentCandidate","ancestorName","parentRequired","siblingElm","parseSelectorItem","$0","$3","$4","parseSelector","getCssText","previewFrag","previewCss","parentFontSize","previewStyles","removeVars","previewOpt","previewElm","numValue","setup$6","addShortcut","Formatter","formatChangeState","registerEvents$1","isFirstTypedCharacter","addNonTypingUndoLevel","cmd","command","isDirty","modKey","isInsertReplacementText","inputType","isInsertTextDataNull","isInsertFromPasteOrDrop","addKeyboardShortcuts","UndoManager","nonTypingKeycodes","placeholderAttr","isKeyboardEvent","isDeleteEvent","isNonTypingKeyboardEvent","isTypingKeyboardEvent","isVisuallyEmpty","isForcedRootBlockFalse","firstElementChild","setup$7","placeholder","updatePlaceholder","showPlaceholder","isPlaceholderShown","strongRtl","hasStrongRtl","isInlineTarget","isRtl$1","findInlineParents","findRootInline","hasSameParentBlock","block1","block2","isAtZwsp","normalizePosition","normalizeForwards","normalizeBackwards","isBeforeRoot","getParentBlock$1","placeCaretInEmptyBody","paddEmptyBody","willDeleteLastPositionInElement","normalizedFirstPos","normalizedLastPos","normalizedFromPos","nextPos","prevPos","blockPosition","blockBoundary","getBlockPosition","containerElm","isDifferentBlocks","hasSameParent","parent1","parent2","isEditable","skipLastBr","lastPositionInBlock","readFromRange","fromBlockPos","toBlockPos","blockPos","read$3","getChildrenUntilBlockBoundary","extractChildren","removeEmptyRoot","isEmptyBefore","nestedBlockMerge","toBlock","insertionPoint","sidelongBlockMerge","findInsertionPoint","parentsAndSelf$1","getInsertionPoint","trimBr","mergeBlockInto","mergeBlocks","backspaceDelete$1","deleteRangeMergeBlocks","isRawNodeInTable","isSelectionInTable","isEverythingSelected","noPrevious","noNext","emptyEditor","deleteRange$1","backspaceDelete$2","_forward","isContentEditableTrue$2","isContentEditableFalse$7","showCaret","getNodeRange","renderCaretAtRange","caretPositionNode","caretPositionBeforeNode","ceRoot","renderRangeCaret","isBeforeBoundary","isAfterBoundary","trimEmptyTextNode$1","deleteContentAndShowCaret","peekCaretPosition","caretRange","deleteBoundaryText","getNextPosFn","isBeforeFn","nextCaretPosition","backspaceDelete$3","isCompoundElement","DeleteAction","moveToElement","moveToPosition","isAtContentEditableBlockCaret","caretLocation","isDeleteFromCefDifferentBlocks","deleteEmptyBlockOrMoveToCef","toCefElm","blockElm","findCefPosition","getContentEditableBlockAction","skipMoveToActionFromInlineCefToContent","getContentEditableAction","read$4","deleteElement$1","hideFakeCaret","getAncestorCe","backspaceDeleteCaret","selectedNode","deleteOffscreenSelection","backspaceDeleteRange","hasCefAncestor","paddEmptyElement","backspaceDelete$4","deleteCaret$1","backspaceDelete$5","isText$8","startsWithCaretContainer$1","endsWithCaretContainer$1","createZwsp","insertBefore$1","insertAfter$1","insertInline$1","insertInlineBefore","insertInlineAfter","insertInlinePos","isPosCaretContainer","caretNode","renderCaret","evaluateUntil","fns","Location","rescope","before$4","nPos","isNotInsideFormatCaretContainer","findInsideRootInline","after$3","isValidLocation","readLocation","getName","outside","inside","isEq$5","location1","location2","betweenInlines","fromInline","toInline","skipNoMovement","fromLocation","toLocation","findLocationTraverse","findLocationSimple","findLocation","prevLocation","nextLocation","hasSelectionModifyApi","modify","moveRel","moveByWord","setCaretPosition","setSelected","renderCaretLocation","findLocation$1","isInlineTarget$1","toggleInlines","inlineBoundaries","selectedInlines","targetInlines","safeRemoveCaretContainer","renderInsideInlineCaret","inlines","_inline","move","moveWord","_caret","setupSelectedState","moveNextWord","movePrevWord","rangeFromPositions","hasOnlyTwoOrLessPositionsLeft","setCaretLocation","deleteFromTo","rescope$1","backspaceDeleteCollapsed","toPosition","backspaceDelete$6","getParentInlines","hasOnlyOneChild$1","deleteLastPosition","parentInlines","isFormatElement$1","deleteCaret$2","backspaceDelete$7","deleteElement$2","deleteCaret$3","isNearMedia","deleteRange$2","backspaceDelete$8","isEditable$1","parseIndentValue","number","getIndentStyleName","useMargin","indentStyleName","indentElement","unit","styleValue","validateBlocks","intentValue","canOutdent","getBlocksToIndent","isListComponent","parentIsListComponent","indentation","indentUnit","indentValue","queryCommandState","backspaceDelete$9","nativeCommand","deleteCommand","forwardDeleteCommand","setup$8","addCommand","SIGNIFICANT_MOVE","LONGPRESS_DELAY","getTouch","isFarEnough","distX","distY","setup$9","startData","longpressFired","debounceLongpress","isEqualNode","isBlockElement","isValidTarget","hasBlockParent","shouldRemoveTextNode","rootNodeName","restoreSelection","setup$a","findBlockCaretContainer","removeIeControlRect","blockCaretContainer","handleBlockContainer","setup$b","BreakType","flip","positions","walk$3","getBreakType","currentPos","Br","Block","Wrap","getPositionsUntil","breakType","breakAt","Eol","getAdjacentLinePositions","getPositionsUntilBreak","findClosestHorizontalPositionFromPoint","lastRect","newRect","lastDist","newDist","findClosestHorizontalPosition","targetRect","getPositionsUntilPreviousLine","getPositionsUntilNextLine","isAtFirstLine","isAtLastLine","getPositionsAbove","getPositionsBelow","getFirstLinePositions","getLastLinePositions","getNodeClientRects","toArrayWithNode","VDirection","findUntil$1","walkUntil","isAboveFn","isBeflowFn","line","targetClientRect","aboveLineNumber","lineNumber","isLineNumber","upUntil","Up","downUntil","Down","positionsUntil","isBelowFn","getClientRect","isAboveLine","isLine","isContentEditableFalse$8","findNode$1","distanceToRectLeft","distanceToRectRight","isInsideX","isInsideY","findClosestClientRect","oldClientRect","oldDistance","newDistance","walkUntil$1","includeChildren","findLineNodeRects","targetNodeRect","checkPosFn","lineRects","getFakeCaretTargets","caretInfo","closestFakeCaret","fakeTargetNodeRects","targetNodeRects","closestNodeRect","moveToRange","renderRangeCaretOpt","moveHorizontally","isBefore","isAfter","rangeIsInContainerBlock","moveVertically","caretClientRect","walkerFn","linePositions","nextLinePositions","nextLineRect","dist1","dist2","caretPositions","closestNextLineRect","getLineEndPoint","moveToLineEndPoint","isContentEditableFalse$9","moveToCeFalseHorizontally","moveToCeFalseVertically","createTextBlock","textBlock","exitPreBlock","getVisualCaretPosition$1","newBlock","getHorizontalRange","getVerticalRange","down","moveH","newRange","moveV","moveToLineEndPoint$1","isCefPosition","isTarget","rangeBefore","insertElement","insertBr","insertBlock$1","insertEmptyLine","getClosestTargetBlock","isAtFirstOrLastLine","moveCaretToNewEmptyLine","rootBlockAttrs","moveV$1","defaultPatterns","patterns","matchesEvent","match$1","execute","moveH$1","moveV$2","moveToLineEndPoint$2","deflate","getCorners","getYAxisValue","tds","findClosestCorner","corners","newCorner","oldCorner","oldDist","sqrt","getClosestCell$1","isTargetCorner","corner","getBottomValue","getTopValue","isAbove$1","isBelow$1","getClosestCellAbove","getClosestCellBelow","findClosestPositionInAboveCell","findClosestPositionInBelowCell","hasNextBreak","lineInfo","breakPos","startsWithWrapBreak","startsWithBrBreak","isAtTableCellLine","isAtFirstTableCellLine","isAtLastTableCellLine","isCaretAtStartOrEndOfTable","navigateHorizontally","_td","getClosestAbovePosition","getClosestBelowPosition","getTable","renderBlock","navigateVertically","move$1","mover","moveH$2","moveV$3","executeKeydownOverride","setup$c","executeKeydownOverride$1","executeKeyupOverride","setup$d","firstNonWhiteSpaceNodeSibling","moveToCaretPosition","getEditableRoot","editableRoot","getParentBlock$2","getParentBlockName","isListItemParentBlock","hasFirstChild","hasParent$1","isListBlock","isNestedList","getContainerBlock","containerBlock","containerBlockParent","isFirstOrLastLi","createNewBlock","newBlockName","tmpRng","trimZwsp","isEmptyAnchor","isTableCell$5","emptyBlock","containerAndSiblingName","canSplitBlock","trimInlineElementsOnLeftSideOfBlock","firstChilds","normalizeZwspOffset","includeZwspInRange","trimLeadingLineBreaks","getEditableRoot$1","applyAttributes","forcedRootBlockAttrs","attrStyles","currentStyles","newStyles","attrClassesOpt","attrClasses","currentClassesOpt","currentClasses","filteredClasses","newClasses","appliedAttrs","remainingAttrs","setForcedBlockAttrs","wrapSelfAndSiblingsInDefaultBlock","addBrToBlockIfNeeded","insert$1","parentBlockName","isAfterLastNodeInContainer","clonedNode","isCaretAtStartOrEndOfBlock","normalizedOffset","insertNewBlockAfter","containerBlockName","hasRightSideContent","scrollToBr","brElm","moveSelectionToBr","extraBr","insertBrAtCaret","isControlKey","insertBrBefore","insertBrAfter","hasBrAfter","isBeforeBr$1","isAnchorLink","isInsideAnchor","readInlineAnchorLocation","insertBrOutsideAnchor","insert$2","anchorLocation","shouldInsertBr","shouldBlockNewLine","newLineAction","shouldBlockNewLine$1","_shiftKey","isBrMode","requiredState","brMode","inListBlock","inBlock","inPreBlock","inSummaryBlock","shouldPutBrInPre$1","inBrContext","hasShiftKey","_editor","canInsertIntoEditableRoot","rootEditable","match$2","predicates","isMatch","getAction$1","insert$3","handleEnterKeyEvent","setup$e","executeKeydownOverride$2","setup$f","browser$4","setupIeInput","keypressThrotter","setup$g","isComposing","insertTextAtPosition","insertNbspAtPosition","insertSpaceAtPosition","locationToCaretPosition","insertInlineBoundarySpaceOrNbsp","checkPos","setSelection$1","insertSpaceOrNbspAtSelection","executeKeydownOverride$3","setup$h","registerKeyboardOverrides","setup$i","NodeChange","lastPath","lastRng","nativeRng","fakeRng","isSameElementPath","initialized","currentPath","preventSummaryToggle","filterDetails","setup$j","isTextBlockNode","normalizeSelection$1","setup$k","detail","value$1","isSet","getAbsolutePosition","getBodyPosition","getScrollPosition","getBodyScroll","inlineScroll","iframeScroll","getMousePosition","iframePosition","scrollPosition","calculatePosition","bodyPosition","mousePosition","calc","isContentEditableFalse$a","isContentEditableTrue$3","isDraggable","isValidDropTarget","targetElement","dragElement","cloneElement","cloneElm","createGhost","clonedElm","opacity","overflow","padding","boxSizing","appendGhostToBody","moveGhost","maxX","maxY","overflowX","removeElement","isLeftMouseButtonPressed","applyRelPos","relX","start$1","ceElm","elmPos","dragging","relY","ghost","move$2","throttledPlaceCaretAt","movement","targetPos","getRawTarget","drop","targetClone_1","removeDragState","bindFakeDragEvents","pageDom","dragStartHandler","dragHandler","dropHandler","dragEndHandler","blockIeDrop","realTarget","blockUnsupportedFileDrop","preventFileDrop","defaultPrevented","dataTransfer","types","preventFileDropIfUIElement","editorRoot","eventNames","setup$l","renderFocusCaret","setup$m","isContentEditableTrue$4","isContentEditableFalse$b","getContentEditableRoot$1","SelectionOverrides","fakeCaret","realSelectionId","elementSelectionAttr","selectedElement","isFakeSelectionElement","isFakeSelectionTargetElement","isNearFakeSelectionElement","getRealSelectionElement","setRange","getRange","contentEditableRoot","removeElementSelection","hasNormalCaretPosition","hasBetterMouseTarget","targetBlock","setElementSelection","fakeCaretInfo","normalizeShortEndedElementSelection","isPasteBin","isRangeInCaretContainer","clipboardData","realSelectionElement","clearData","setData","outerText","isWithinCaretContainer","setupOffscreenSelection","targetClone","origTargetClone","$realSelectionContainer","selectElement","nodeElm","afterNode","Quirks","isGecko","isWebKit","mceInternalUrlPrefix","mceInternalDataType","setEditorCommandState","setMceInternalContent","selectionHtml","internalContent","escape","getMceInternalContent","insertClipboardContents","internal","queryCommandSupported","emptyEditorWhenDeleting","serializeRng","allContentsSelected","allRng","allSelection","selectAll","shortcuts","inputMethodFocus","removeHrOnBackspace","Range","body_1","blur","selectControlElements","removeStylesWhenDeletingAcrossBlockElements","getAttributeApplyFunction","template","setAttributeNode","isSelectionAcrossElements","disableBackspaceIntoATable","removeBlockQuoteOnBackSpace","setGeckoEditingOptions","setOpts","addBrAfterLastLinks","fixLinks","setDefaultBlockType","showBrokenImageIcon","contentStyles","restoreFocusOnKeyDown","bodyHeight","blockCmdArrowNavigation","selection_1","disableAutoUrlDetect","tapLinksAndImages","blockFormSubmitInsideEditor","removeAppleInterchangeBrs","ieInternalDragAndDrop","DOM$4","appendStyle","getRootName","removeUndefined","mkParserSettings","mkSerializerSettings","boolean_attributes","move_caret_before_on_enter_elements","non_empty_elements","short_ended_elements","text_inline_elements","whitespace_elements","createParser","autoFocus","auto_focus","moveSelectionToFirstCaretPosition","initEditor","bindPendingEventDelegates","execCallback","getStyleSheetLoader","ui","loadContentCss","preInit","rtcMode","browser_spellcheck","gecko_spellcheck","spellcheck","directionality","protect","startContent","contentCssText_1","content_style","initContentBody","skipWrite","visibility","orgVisibility","iframeHTML","hex_colors","force_hex_style_colors","annotator","_nodeChangeDispatcher","loadingRtc","setProgressState","DOM$5","relaxDomain","ifr","domain","hostname","bodyUuid","domainRelaxUrl","createIframeElement","customAttrs","iframe","frameBorder","allowTransparency","getIframeHtml","getURI","bodyId","bodyClass","createIframe","isDomainRelaxed","iframeContainer","init$1","boxInfo","hidden","DOM$6","initPlugin","initializedPlugins","plugin","Plugin","pluginInstance","trimLegacyPrefix","initPlugins","initIcons","iconPackName","currentIcons","loadIcons","svgData","icon","addIcon","initTheme","Theme","renderFromLoadedTheme","renderUI","renderFromThemeFunc","iframeHeight","createThemeFalseResult","renderThemeFalseIframe","renderThemeFalse","renderThemeUi","augmentEditorUiApi","uiApiFacade","disable","isDisabled","enable","init$2","renderInfo","DOM$7","hasSkipLoadPrefix","loadLanguage","scriptLoader","languageCode","languageUrl","url_1","loadTheme","themeUrl","getIconsUrlMetaFromUrl","getIconsUrlMetaFromName","defaultIconsUrl","customIconsUrl","urlMeta","loadPlugins","depPlugin","url_2","getStyleSheetLoader$1","render","snapshot","resetContent","triggerSave","windowManager","set_dirty","addVisual$1","legacyPropNames","getSpecifiedFontProp","getProperty","legacyPropName","normalizeFontFamily","getComputedFontProp","getFontProp","getFontSize","getFontFamily","findFirstCaretElement","getCaretElement","atStartOfNode","mapRange","mapper","fromFontSizeNumber","fontSizeNumber","fontClasses","normalizeFontNames","font","fonts","fontNameAction","fontNameQuery","fontSizeAction","fontSizeQuery","lineHeightQuery","specifiedStyle","computedStyle","lineHeightAction","processValue","insertAtCaret$1","each$f","map$3","inArray$2","EditorCommands","commands","setupCommands","skip_focus","customCommand","queryCommandValue","addCommands","commandList","addQueryStateHandler","addQueryValueHandler","hasCustomCommand","execNativeCommand","isFormatMatch","storeSelection","selectionBookmark","queryCommandEnabled","listParent","anchor","editingHost","selectNodeContents","alignStates","Undo","Redo","internalContentEditableAttr","setContentEditable","switchOffContentEditableTrue","switchOnContentEditableTrue","removeFakeSelection","restoreFakeSelection","toggleReadOnly","isReadOnly$1","registerFilters","registerReadOnlyContentFilters","isClickEvent","getAnchorHrefOpt","processReadonlyEvents","targetEl","registerReadOnlySelectionBlockers","nativeEvents","EventDispatcher","bindings","toggleEvent","isNative","nameIn","argsIn","beforeFire","wrappedCallback","currentName","bindingName","hi","getEventDispatcher","_eventDispatcher","toggleNativeEvent","Observable","bubble","dispatcherArgs","DOM$8","customEventRootDelegates","getEventTarget","eventName","eventRoot","isListening","bindEventDelegate","delegate","delegates","eventRootElm","editors","EditorObservable","_pendingNativeEvents","defaultModes","switchToMode","activeMode","availableModes","oldMode","newMode","activate","deactivate","editorReadOnly","setMode","registerMode","create$5","design","each$g","explode$3","keyCodeLookup","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","modifierNames","Shortcuts","pendingPatterns","hasModifier","isFunctionKey","shortcut","matchShortcut","subpatterns","executeShortcutAction","desc","cmdFunc","normalizeCommandFunc","createShortcut","parseShortcut","charCode","access","alt","ctrl","meta","create$6","buttons","menuItems","popups","contextMenus","contextToolbars","sidebars","addButton","addGroupToolbarButton","addToggleButton","addMenuButton","addSplitButton","addMenuItem","addNestedMenuItem","addToggleMenuItem","addAutocompleter","addContextMenu","addContextToolbar","addContextForm","addSidebar","bridge","each$h","trim$4","queryParts","DEFAULT_PORTS","ftp","http","https","mailto","URI","baseUri","base_uri","source","isProtocolRelative","protocol","toAbsPath","urlMatch","part","userInfo","port","uriComponents","pathname","setPath","pathMatch","file","toRelative","relativeUri","tu","uu","toRelPath","noHost","absoluteUri","isSameOrigin","defaultPort","breakPoint","normalizedBase","nb","outPath","normalizedPath","noProtoHost","DOM$9","extend$3","each$i","resolve$3","ie$1","Editor","loadedCSS","isNotDirty","documentBaseURL","base_url","_setBaseUrl","baseURI","referrer_policy","language_load","editorCommands","cache_suffix","modeInstance","callbackLookup","hasPlugin","initialContent","oldState","urlconverter_callback","_scanForImages","DOM$a","explode$4","each$j","extend$4","instanceCounter","boundGlobalEvents","beforeUnloadDelegate","legacyEditors","isValidLegacyKey","globalEventDelegate","EditorManager","toggleGlobalEvents","removeEditorFromList","targetEditor","oldEditors","purgeDestroyedEditor","isQuirksMode","compatMode","majorVersion","minorVersion","releaseDate","i18n","tinymce","tinyMCEPreInit","srcScript","currentScript","pluginBaseUrls","plugin_base_urls","pluginBaseUrl","invalidInlineTargets","isInvalidInlineTarget","createId","findTargets","targets","forms","editor_deselector","editor_selector","provideResults","initEditors","initCount","createEditor","existingEditor","addI18n","round$1","relativePosition","targetW","targetH","relChars","create$7","findBestRelativePosition","constrainRect","rels","inflate","intersect","cropRect","x1","y1","clamp$1","clampRect","fixedSize","cx2","cy2","underflowX1","underflowY1","overflowX2","overflowY2","fromClientRect","Rect","awaiter","resolveCb","rejectCb","complete","completer","create$8","tasks","resultFns","loadErrMsg","runErrMsg","task","waiter","Resource","each$k","extend$5","extendClass","initializing","Class","_super","mixins","mixin","Mixins","dummy","createMethod","Methods","Properties","fieldName","Statics","Defaults","member","min$1","max$1","round$2","Color","rgb2hsv","minRGB","maxRGB","hsvToRgb","hue","saturation","brightness","side","chroma","toRgb","toHsv","stringify","hexCode","JSONUtils","JSONP","XHR","ready","async","success_scope","error_scope","overrideMimeType","content_type","crossDomain","setRequestHeader","requestheaders","extend$6","JSONRequest","sendRPC","ecb","scb","xhrArgs","method","create$9","storage","getItem","setItem","removeItem","defineProperty","configurable","enumerable","localStorage","LocalStorage","publicApi","geom","util","TreeWalker","Serializer","Selection","isMac","exportToModuleLoaders","exportToWindowGlobal","tinyMCE"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.6.2 (2020-12-08)\n */\n(function () {\n    'use strict';\n\n    var typeOf = function (x) {\n      if (x === null) {\n        return 'null';\n      }\n      if (x === undefined) {\n        return 'undefined';\n      }\n      var t = typeof x;\n      if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      }\n      if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      }\n      return t;\n    };\n    var isEquatableType = function (x) {\n      return [\n        'undefined',\n        'boolean',\n        'number',\n        'string',\n        'function',\n        'xml',\n        'null'\n      ].indexOf(x) !== -1;\n    };\n\n    var sort = function (xs, compareFn) {\n      var clone = Array.prototype.slice.call(xs);\n      return clone.sort(compareFn);\n    };\n\n    var contramap = function (eqa, f) {\n      return eq(function (x, y) {\n        return eqa.eq(f(x), f(y));\n      });\n    };\n    var eq = function (f) {\n      return { eq: f };\n    };\n    var tripleEq = eq(function (x, y) {\n      return x === y;\n    });\n    var eqString = tripleEq;\n    var eqArray = function (eqa) {\n      return eq(function (x, y) {\n        if (x.length !== y.length) {\n          return false;\n        }\n        var len = x.length;\n        for (var i = 0; i < len; i++) {\n          if (!eqa.eq(x[i], y[i])) {\n            return false;\n          }\n        }\n        return true;\n      });\n    };\n    var eqSortedArray = function (eqa, compareFn) {\n      return contramap(eqArray(eqa), function (xs) {\n        return sort(xs, compareFn);\n      });\n    };\n    var eqRecord = function (eqa) {\n      return eq(function (x, y) {\n        var kx = Object.keys(x);\n        var ky = Object.keys(y);\n        if (!eqSortedArray(eqString).eq(kx, ky)) {\n          return false;\n        }\n        var len = kx.length;\n        for (var i = 0; i < len; i++) {\n          var q = kx[i];\n          if (!eqa.eq(x[q], y[q])) {\n            return false;\n          }\n        }\n        return true;\n      });\n    };\n    var eqAny = eq(function (x, y) {\n      if (x === y) {\n        return true;\n      }\n      var tx = typeOf(x);\n      var ty = typeOf(y);\n      if (tx !== ty) {\n        return false;\n      }\n      if (isEquatableType(tx)) {\n        return x === y;\n      } else if (tx === 'array') {\n        return eqArray(eqAny).eq(x, y);\n      } else if (tx === 'object') {\n        return eqRecord(eqAny).eq(x, y);\n      }\n      return false;\n    });\n\n    var noop = function () {\n    };\n    var compose = function (fa, fb) {\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        return fa(fb.apply(null, args));\n      };\n    };\n    var compose1 = function (fbc, fab) {\n      return function (a) {\n        return fbc(fab(a));\n      };\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var identity = function (x) {\n      return x;\n    };\n    function curry(fn) {\n      var initialArgs = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        initialArgs[_i - 1] = arguments[_i];\n      }\n      return function () {\n        var restArgs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          restArgs[_i] = arguments[_i];\n        }\n        var all = initialArgs.concat(restArgs);\n        return fn.apply(null, all);\n      };\n    }\n    var not = function (f) {\n      return function (t) {\n        return !f(t);\n      };\n    };\n    var die = function (msg) {\n      return function () {\n        throw new Error(msg);\n      };\n    };\n    var call = function (f) {\n      f();\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, _s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Optional = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var typeOf$1 = function (x) {\n      var t = typeof x;\n      if (x === null) {\n        return 'null';\n      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      } else {\n        return t;\n      }\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf$1(value) === type;\n      };\n    };\n    var isSimpleType = function (type) {\n      return function (value) {\n        return typeof value === type;\n      };\n    };\n    var eq$1 = function (t) {\n      return function (a) {\n        return t === a;\n      };\n    };\n    var isString = isType('string');\n    var isObject = isType('object');\n    var isArray = isType('array');\n    var isNull = eq$1(null);\n    var isBoolean = isSimpleType('boolean');\n    var isUndefined = eq$1(undefined);\n    var isNullable = function (a) {\n      return a === null || a === undefined;\n    };\n    var isNonNullable = function (a) {\n      return !isNullable(a);\n    };\n    var isFunction = isSimpleType('function');\n    var isNumber = isSimpleType('number');\n\n    var nativeSlice = Array.prototype.slice;\n    var nativeIndexOf = Array.prototype.indexOf;\n    var nativePush = Array.prototype.push;\n    var rawIndexOf = function (ts, t) {\n      return nativeIndexOf.call(ts, t);\n    };\n    var indexOf = function (xs, x) {\n      var r = rawIndexOf(xs, x);\n      return r === -1 ? Optional.none() : Optional.some(r);\n    };\n    var contains = function (xs, x) {\n      return rawIndexOf(xs, x) > -1;\n    };\n    var exists = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var map = function (xs, f) {\n      var len = xs.length;\n      var r = new Array(len);\n      for (var i = 0; i < len; i++) {\n        var x = xs[i];\n        r[i] = f(x, i);\n      }\n      return r;\n    };\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var eachr = function (xs, f) {\n      for (var i = xs.length - 1; i >= 0; i--) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var partition = function (xs, pred) {\n      var pass = [];\n      var fail = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        var arr = pred(x, i) ? pass : fail;\n        arr.push(x);\n      }\n      return {\n        pass: pass,\n        fail: fail\n      };\n    };\n    var filter = function (xs, pred) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          r.push(x);\n        }\n      }\n      return r;\n    };\n    var foldr = function (xs, f, acc) {\n      eachr(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var foldl = function (xs, f, acc) {\n      each(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var findUntil = function (xs, pred, until) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Optional.some(x);\n        } else if (until(x, i)) {\n          break;\n        }\n      }\n      return Optional.none();\n    };\n    var find = function (xs, pred) {\n      return findUntil(xs, pred, never);\n    };\n    var findIndex = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Optional.some(i);\n        }\n      }\n      return Optional.none();\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n    var bind = function (xs, f) {\n      return flatten(map(xs, f));\n    };\n    var forall = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        var x = xs[i];\n        if (pred(x, i) !== true) {\n          return false;\n        }\n      }\n      return true;\n    };\n    var reverse = function (xs) {\n      var r = nativeSlice.call(xs, 0);\n      r.reverse();\n      return r;\n    };\n    var difference = function (a1, a2) {\n      return filter(a1, function (x) {\n        return !contains(a2, x);\n      });\n    };\n    var mapToObject = function (xs, f) {\n      var r = {};\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        r[String(x)] = f(x, i);\n      }\n      return r;\n    };\n    var sort$1 = function (xs, comparator) {\n      var copy = nativeSlice.call(xs, 0);\n      copy.sort(comparator);\n      return copy;\n    };\n    var get = function (xs, i) {\n      return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n    };\n    var head = function (xs) {\n      return get(xs, 0);\n    };\n    var last = function (xs) {\n      return get(xs, xs.length - 1);\n    };\n    var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n      return nativeSlice.call(x);\n    };\n    var findMap = function (arr, f) {\n      for (var i = 0; i < arr.length; i++) {\n        var r = f(arr[i], i);\n        if (r.isSome()) {\n          return r;\n        }\n      }\n      return Optional.none();\n    };\n\n    var keys = Object.keys;\n    var hasOwnProperty = Object.hasOwnProperty;\n    var each$1 = function (obj, f) {\n      var props = keys(obj);\n      for (var k = 0, len = props.length; k < len; k++) {\n        var i = props[k];\n        var x = obj[i];\n        f(x, i);\n      }\n    };\n    var map$1 = function (obj, f) {\n      return tupleMap(obj, function (x, i) {\n        return {\n          k: i,\n          v: f(x, i)\n        };\n      });\n    };\n    var tupleMap = function (obj, f) {\n      var r = {};\n      each$1(obj, function (x, i) {\n        var tuple = f(x, i);\n        r[tuple.k] = tuple.v;\n      });\n      return r;\n    };\n    var objAcc = function (r) {\n      return function (x, i) {\n        r[i] = x;\n      };\n    };\n    var internalFilter = function (obj, pred, onTrue, onFalse) {\n      var r = {};\n      each$1(obj, function (x, i) {\n        (pred(x, i) ? onTrue : onFalse)(x, i);\n      });\n      return r;\n    };\n    var bifilter = function (obj, pred) {\n      var t = {};\n      var f = {};\n      internalFilter(obj, pred, objAcc(t), objAcc(f));\n      return {\n        t: t,\n        f: f\n      };\n    };\n    var filter$1 = function (obj, pred) {\n      var t = {};\n      internalFilter(obj, pred, objAcc(t), noop);\n      return t;\n    };\n    var mapToArray = function (obj, f) {\n      var r = [];\n      each$1(obj, function (value, name) {\n        r.push(f(value, name));\n      });\n      return r;\n    };\n    var values = function (obj) {\n      return mapToArray(obj, function (v) {\n        return v;\n      });\n    };\n    var get$1 = function (obj, key) {\n      return has(obj, key) ? Optional.from(obj[key]) : Optional.none();\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty.call(obj, key);\n    };\n    var hasNonNullableKey = function (obj, key) {\n      return has(obj, key) && obj[key] !== undefined && obj[key] !== null;\n    };\n    var equal = function (a1, a2, eq) {\n      if (eq === void 0) {\n        eq = eqAny;\n      }\n      return eqRecord(eq).eq(a1, a2);\n    };\n\n    var isArray$1 = Array.isArray;\n    var toArray = function (obj) {\n      if (!isArray$1(obj)) {\n        var array = [];\n        for (var i = 0, l = obj.length; i < l; i++) {\n          array[i] = obj[i];\n        }\n        return array;\n      } else {\n        return obj;\n      }\n    };\n    var each$2 = function (o, cb, s) {\n      var n, l;\n      if (!o) {\n        return false;\n      }\n      s = s || o;\n      if (o.length !== undefined) {\n        for (n = 0, l = o.length; n < l; n++) {\n          if (cb.call(s, o[n], n, o) === false) {\n            return false;\n          }\n        }\n      } else {\n        for (n in o) {\n          if (o.hasOwnProperty(n)) {\n            if (cb.call(s, o[n], n, o) === false) {\n              return false;\n            }\n          }\n        }\n      }\n      return true;\n    };\n    var map$2 = function (array, callback) {\n      var out = [];\n      each$2(array, function (item, index) {\n        out.push(callback(item, index, array));\n      });\n      return out;\n    };\n    var filter$2 = function (a, f) {\n      var o = [];\n      each$2(a, function (v, index) {\n        if (!f || f(v, index, a)) {\n          o.push(v);\n        }\n      });\n      return o;\n    };\n    var indexOf$1 = function (a, v) {\n      if (a) {\n        for (var i = 0, l = a.length; i < l; i++) {\n          if (a[i] === v) {\n            return i;\n          }\n        }\n      }\n      return -1;\n    };\n    var reduce = function (collection, iteratee, accumulator, thisArg) {\n      var acc = isUndefined(accumulator) ? collection[0] : accumulator;\n      for (var i = 0; i < collection.length; i++) {\n        acc = iteratee.call(thisArg, acc, collection[i], i);\n      }\n      return acc;\n    };\n    var findIndex$1 = function (array, predicate, thisArg) {\n      var i, l;\n      for (i = 0, l = array.length; i < l; i++) {\n        if (predicate.call(thisArg, array[i], i, array)) {\n          return i;\n        }\n      }\n      return -1;\n    };\n    var last$1 = function (collection) {\n      return collection[collection.length - 1];\n    };\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n    function __rest(s, e) {\n      var t = {};\n      for (var p in s)\n        if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n          t[p] = s[p];\n      if (s != null && typeof Object.getOwnPropertySymbols === 'function')\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n            t[p[i]] = s[p[i]];\n        }\n      return t;\n    }\n    function __spreadArrays() {\n      for (var s = 0, i = 0, il = arguments.length; i < il; i++)\n        s += arguments[i].length;\n      for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n      return r;\n    }\n\n    var cached = function (f) {\n      var called = false;\n      var r;\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (!called) {\n          called = true;\n          r = f.apply(null, args);\n        }\n        return r;\n      };\n    };\n\n    var DeviceType = function (os, browser, userAgent, mediaMatch) {\n      var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\n      var isiPhone = os.isiOS() && !isiPad;\n      var isMobile = os.isiOS() || os.isAndroid();\n      var isTouch = isMobile || mediaMatch('(pointer:coarse)');\n      var isTablet = isiPad || !isiPhone && isMobile && mediaMatch('(min-device-width:768px)');\n      var isPhone = isiPhone || isMobile && !isTablet;\n      var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\n      var isDesktop = !isPhone && !isTablet && !iOSwebview;\n      return {\n        isiPad: constant(isiPad),\n        isiPhone: constant(isiPhone),\n        isTablet: constant(isTablet),\n        isPhone: constant(isPhone),\n        isTouch: constant(isTouch),\n        isAndroid: os.isAndroid,\n        isiOS: os.isiOS,\n        isWebView: constant(iOSwebview),\n        isDesktop: constant(isDesktop)\n      };\n    };\n\n    var firstMatch = function (regexes, s) {\n      for (var i = 0; i < regexes.length; i++) {\n        var x = regexes[i];\n        if (x.test(s)) {\n          return x;\n        }\n      }\n      return undefined;\n    };\n    var find$1 = function (regexes, agent) {\n      var r = firstMatch(regexes, agent);\n      if (!r) {\n        return {\n          major: 0,\n          minor: 0\n        };\n      }\n      var group = function (i) {\n        return Number(agent.replace(r, '$' + i));\n      };\n      return nu(group(1), group(2));\n    };\n    var detect = function (versionRegexes, agent) {\n      var cleanedAgent = String(agent).toLowerCase();\n      if (versionRegexes.length === 0) {\n        return unknown();\n      }\n      return find$1(versionRegexes, cleanedAgent);\n    };\n    var unknown = function () {\n      return nu(0, 0);\n    };\n    var nu = function (major, minor) {\n      return {\n        major: major,\n        minor: minor\n      };\n    };\n    var Version = {\n      nu: nu,\n      detect: detect,\n      unknown: unknown\n    };\n\n    var detect$1 = function (candidates, userAgent) {\n      var agent = String(userAgent).toLowerCase();\n      return find(candidates, function (candidate) {\n        return candidate.search(agent);\n      });\n    };\n    var detectBrowser = function (browsers, userAgent) {\n      return detect$1(browsers, userAgent).map(function (browser) {\n        var version = Version.detect(browser.versionRegexes, userAgent);\n        return {\n          current: browser.name,\n          version: version\n        };\n      });\n    };\n    var detectOs = function (oses, userAgent) {\n      return detect$1(oses, userAgent).map(function (os) {\n        var version = Version.detect(os.versionRegexes, userAgent);\n        return {\n          current: os.name,\n          version: version\n        };\n      });\n    };\n    var UaString = {\n      detectBrowser: detectBrowser,\n      detectOs: detectOs\n    };\n\n    var removeFromStart = function (str, numChars) {\n      return str.substring(numChars);\n    };\n\n    var checkRange = function (str, substr, start) {\n      return substr === '' || str.length >= substr.length && str.substr(start, start + substr.length) === substr;\n    };\n    var removeLeading = function (str, prefix) {\n      return startsWith(str, prefix) ? removeFromStart(str, prefix.length) : str;\n    };\n    var contains$1 = function (str, substr) {\n      return str.indexOf(substr) !== -1;\n    };\n    var startsWith = function (str, prefix) {\n      return checkRange(str, prefix, 0);\n    };\n    var blank = function (r) {\n      return function (s) {\n        return s.replace(r, '');\n      };\n    };\n    var trim = blank(/^\\s+|\\s+$/g);\n    var lTrim = blank(/^\\s+/g);\n    var rTrim = blank(/\\s+$/g);\n\n    var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\n    var checkContains = function (target) {\n      return function (uastring) {\n        return contains$1(uastring, target);\n      };\n    };\n    var browsers = [\n      {\n        name: 'Edge',\n        versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\n        search: function (uastring) {\n          return contains$1(uastring, 'edge/') && contains$1(uastring, 'chrome') && contains$1(uastring, 'safari') && contains$1(uastring, 'applewebkit');\n        }\n      },\n      {\n        name: 'Chrome',\n        versionRegexes: [\n          /.*?chrome\\/([0-9]+)\\.([0-9]+).*/,\n          normalVersionRegex\n        ],\n        search: function (uastring) {\n          return contains$1(uastring, 'chrome') && !contains$1(uastring, 'chromeframe');\n        }\n      },\n      {\n        name: 'IE',\n        versionRegexes: [\n          /.*?msie\\ ?([0-9]+)\\.([0-9]+).*/,\n          /.*?rv:([0-9]+)\\.([0-9]+).*/\n        ],\n        search: function (uastring) {\n          return contains$1(uastring, 'msie') || contains$1(uastring, 'trident');\n        }\n      },\n      {\n        name: 'Opera',\n        versionRegexes: [\n          normalVersionRegex,\n          /.*?opera\\/([0-9]+)\\.([0-9]+).*/\n        ],\n        search: checkContains('opera')\n      },\n      {\n        name: 'Firefox',\n        versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\n        search: checkContains('firefox')\n      },\n      {\n        name: 'Safari',\n        versionRegexes: [\n          normalVersionRegex,\n          /.*?cpu os ([0-9]+)_([0-9]+).*/\n        ],\n        search: function (uastring) {\n          return (contains$1(uastring, 'safari') || contains$1(uastring, 'mobile/')) && contains$1(uastring, 'applewebkit');\n        }\n      }\n    ];\n    var oses = [\n      {\n        name: 'Windows',\n        search: checkContains('win'),\n        versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\n      },\n      {\n        name: 'iOS',\n        search: function (uastring) {\n          return contains$1(uastring, 'iphone') || contains$1(uastring, 'ipad');\n        },\n        versionRegexes: [\n          /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/,\n          /.*cpu os ([0-9]+)_([0-9]+).*/,\n          /.*cpu iphone os ([0-9]+)_([0-9]+).*/\n        ]\n      },\n      {\n        name: 'Android',\n        search: checkContains('android'),\n        versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\n      },\n      {\n        name: 'OSX',\n        search: checkContains('mac os x'),\n        versionRegexes: [/.*?mac\\ os\\ x\\ ?([0-9]+)_([0-9]+).*/]\n      },\n      {\n        name: 'Linux',\n        search: checkContains('linux'),\n        versionRegexes: []\n      },\n      {\n        name: 'Solaris',\n        search: checkContains('sunos'),\n        versionRegexes: []\n      },\n      {\n        name: 'FreeBSD',\n        search: checkContains('freebsd'),\n        versionRegexes: []\n      },\n      {\n        name: 'ChromeOS',\n        search: checkContains('cros'),\n        versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/]\n      }\n    ];\n    var PlatformInfo = {\n      browsers: constant(browsers),\n      oses: constant(oses)\n    };\n\n    var edge = 'Edge';\n    var chrome = 'Chrome';\n    var ie = 'IE';\n    var opera = 'Opera';\n    var firefox = 'Firefox';\n    var safari = 'Safari';\n    var unknown$1 = function () {\n      return nu$1({\n        current: undefined,\n        version: Version.unknown()\n      });\n    };\n    var nu$1 = function (info) {\n      var current = info.current;\n      var version = info.version;\n      var isBrowser = function (name) {\n        return function () {\n          return current === name;\n        };\n      };\n      return {\n        current: current,\n        version: version,\n        isEdge: isBrowser(edge),\n        isChrome: isBrowser(chrome),\n        isIE: isBrowser(ie),\n        isOpera: isBrowser(opera),\n        isFirefox: isBrowser(firefox),\n        isSafari: isBrowser(safari)\n      };\n    };\n    var Browser = {\n      unknown: unknown$1,\n      nu: nu$1,\n      edge: constant(edge),\n      chrome: constant(chrome),\n      ie: constant(ie),\n      opera: constant(opera),\n      firefox: constant(firefox),\n      safari: constant(safari)\n    };\n\n    var windows = 'Windows';\n    var ios = 'iOS';\n    var android = 'Android';\n    var linux = 'Linux';\n    var osx = 'OSX';\n    var solaris = 'Solaris';\n    var freebsd = 'FreeBSD';\n    var chromeos = 'ChromeOS';\n    var unknown$2 = function () {\n      return nu$2({\n        current: undefined,\n        version: Version.unknown()\n      });\n    };\n    var nu$2 = function (info) {\n      var current = info.current;\n      var version = info.version;\n      var isOS = function (name) {\n        return function () {\n          return current === name;\n        };\n      };\n      return {\n        current: current,\n        version: version,\n        isWindows: isOS(windows),\n        isiOS: isOS(ios),\n        isAndroid: isOS(android),\n        isOSX: isOS(osx),\n        isLinux: isOS(linux),\n        isSolaris: isOS(solaris),\n        isFreeBSD: isOS(freebsd),\n        isChromeOS: isOS(chromeos)\n      };\n    };\n    var OperatingSystem = {\n      unknown: unknown$2,\n      nu: nu$2,\n      windows: constant(windows),\n      ios: constant(ios),\n      android: constant(android),\n      linux: constant(linux),\n      osx: constant(osx),\n      solaris: constant(solaris),\n      freebsd: constant(freebsd),\n      chromeos: constant(chromeos)\n    };\n\n    var detect$2 = function (userAgent, mediaMatch) {\n      var browsers = PlatformInfo.browsers();\n      var oses = PlatformInfo.oses();\n      var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);\n      var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\n      var deviceType = DeviceType(os, browser, userAgent, mediaMatch);\n      return {\n        browser: browser,\n        os: os,\n        deviceType: deviceType\n      };\n    };\n    var PlatformDetection = { detect: detect$2 };\n\n    var mediaMatch = function (query) {\n      return window.matchMedia(query).matches;\n    };\n    var platform = cached(function () {\n      return PlatformDetection.detect(navigator.userAgent, mediaMatch);\n    });\n    var detect$3 = function () {\n      return platform();\n    };\n\n    var userAgent = navigator.userAgent;\n    var platform$1 = detect$3();\n    var browser = platform$1.browser;\n    var os = platform$1.os;\n    var deviceType = platform$1.deviceType;\n    var webkit = /WebKit/.test(userAgent) && !browser.isEdge();\n    var fileApi = 'FormData' in window && 'FileReader' in window && 'URL' in window && !!URL.createObjectURL;\n    var windowsPhone = userAgent.indexOf('Windows Phone') !== -1;\n    var Env = {\n      opera: browser.isOpera(),\n      webkit: webkit,\n      ie: browser.isIE() || browser.isEdge() ? browser.version.major : false,\n      gecko: browser.isFirefox(),\n      mac: os.isOSX() || os.isiOS(),\n      iOS: deviceType.isiPad() || deviceType.isiPhone(),\n      android: os.isAndroid(),\n      contentEditable: true,\n      transparentSrc: 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',\n      caretAfter: true,\n      range: window.getSelection && 'Range' in window,\n      documentMode: browser.isIE() ? document.documentMode || 7 : 10,\n      fileApi: fileApi,\n      ceFalse: true,\n      cacheSuffix: null,\n      container: null,\n      experimentalShadowDom: false,\n      canHaveCSP: !browser.isIE(),\n      desktop: deviceType.isDesktop(),\n      windowsPhone: windowsPhone,\n      browser: {\n        current: browser.current,\n        version: browser.version,\n        isChrome: browser.isChrome,\n        isEdge: browser.isEdge,\n        isFirefox: browser.isFirefox,\n        isIE: browser.isIE,\n        isOpera: browser.isOpera,\n        isSafari: browser.isSafari\n      },\n      os: {\n        current: os.current,\n        version: os.version,\n        isAndroid: os.isAndroid,\n        isChromeOS: os.isChromeOS,\n        isFreeBSD: os.isFreeBSD,\n        isiOS: os.isiOS,\n        isLinux: os.isLinux,\n        isOSX: os.isOSX,\n        isSolaris: os.isSolaris,\n        isWindows: os.isWindows\n      },\n      deviceType: {\n        isDesktop: deviceType.isDesktop,\n        isiPad: deviceType.isiPad,\n        isiPhone: deviceType.isiPhone,\n        isPhone: deviceType.isPhone,\n        isTablet: deviceType.isTablet,\n        isTouch: deviceType.isTouch,\n        isWebView: deviceType.isWebView\n      }\n    };\n\n    var whiteSpaceRegExp = /^\\s*|\\s*$/g;\n    var trim$1 = function (str) {\n      return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp, '');\n    };\n    var is = function (obj, type) {\n      if (!type) {\n        return obj !== undefined;\n      }\n      if (type === 'array' && isArray$1(obj)) {\n        return true;\n      }\n      return typeof obj === type;\n    };\n    var makeMap = function (items, delim, map) {\n      var i;\n      items = items || [];\n      delim = delim || ',';\n      if (typeof items === 'string') {\n        items = items.split(delim);\n      }\n      map = map || {};\n      i = items.length;\n      while (i--) {\n        map[items[i]] = {};\n      }\n      return map;\n    };\n    var hasOwnProperty$1 = function (obj, prop) {\n      return Object.prototype.hasOwnProperty.call(obj, prop);\n    };\n    var create = function (s, p, root) {\n      var self = this;\n      var sp, scn, c, de = 0;\n      s = /^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);\n      var cn = s[3].match(/(^|\\.)(\\w+)$/i)[2];\n      var ns = self.createNS(s[3].replace(/\\.\\w+$/, ''), root);\n      if (ns[cn]) {\n        return;\n      }\n      if (s[2] === 'static') {\n        ns[cn] = p;\n        if (this.onCreate) {\n          this.onCreate(s[2], s[3], ns[cn]);\n        }\n        return;\n      }\n      if (!p[cn]) {\n        p[cn] = function () {\n        };\n        de = 1;\n      }\n      ns[cn] = p[cn];\n      self.extend(ns[cn].prototype, p);\n      if (s[5]) {\n        sp = self.resolve(s[5]).prototype;\n        scn = s[5].match(/\\.(\\w+)$/i)[1];\n        c = ns[cn];\n        if (de) {\n          ns[cn] = function () {\n            return sp[scn].apply(this, arguments);\n          };\n        } else {\n          ns[cn] = function () {\n            this.parent = sp[scn];\n            return c.apply(this, arguments);\n          };\n        }\n        ns[cn].prototype[cn] = ns[cn];\n        self.each(sp, function (f, n) {\n          ns[cn].prototype[n] = sp[n];\n        });\n        self.each(p, function (f, n) {\n          if (sp[n]) {\n            ns[cn].prototype[n] = function () {\n              this.parent = sp[n];\n              return f.apply(this, arguments);\n            };\n          } else {\n            if (n !== cn) {\n              ns[cn].prototype[n] = f;\n            }\n          }\n        });\n      }\n      self.each(p.static, function (f, n) {\n        ns[cn][n] = f;\n      });\n    };\n    var extend = function (obj) {\n      var exts = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        exts[_i - 1] = arguments[_i];\n      }\n      for (var i = 0; i < exts.length; i++) {\n        var ext = exts[i];\n        for (var name_1 in ext) {\n          if (ext.hasOwnProperty(name_1)) {\n            var value = ext[name_1];\n            if (value !== undefined) {\n              obj[name_1] = value;\n            }\n          }\n        }\n      }\n      return obj;\n    };\n    var walk = function (o, f, n, s) {\n      s = s || this;\n      if (o) {\n        if (n) {\n          o = o[n];\n        }\n        each$2(o, function (o, i) {\n          if (f.call(s, o, i, n) === false) {\n            return false;\n          }\n          walk(o, f, n, s);\n        });\n      }\n    };\n    var createNS = function (n, o) {\n      var i, v;\n      o = o || window;\n      n = n.split('.');\n      for (i = 0; i < n.length; i++) {\n        v = n[i];\n        if (!o[v]) {\n          o[v] = {};\n        }\n        o = o[v];\n      }\n      return o;\n    };\n    var resolve = function (n, o) {\n      var i, l;\n      o = o || window;\n      n = n.split('.');\n      for (i = 0, l = n.length; i < l; i++) {\n        o = o[n[i]];\n        if (!o) {\n          break;\n        }\n      }\n      return o;\n    };\n    var explode = function (s, d) {\n      if (!s || is(s, 'array')) {\n        return s;\n      }\n      return map$2(s.split(d || ','), trim$1);\n    };\n    var _addCacheSuffix = function (url) {\n      var cacheSuffix = Env.cacheSuffix;\n      if (cacheSuffix) {\n        url += (url.indexOf('?') === -1 ? '?' : '&') + cacheSuffix;\n      }\n      return url;\n    };\n    var Tools = {\n      trim: trim$1,\n      isArray: isArray$1,\n      is: is,\n      toArray: toArray,\n      makeMap: makeMap,\n      each: each$2,\n      map: map$2,\n      grep: filter$2,\n      inArray: indexOf$1,\n      hasOwn: hasOwnProperty$1,\n      extend: extend,\n      create: create,\n      walk: walk,\n      createNS: createNS,\n      resolve: resolve,\n      explode: explode,\n      _addCacheSuffix: _addCacheSuffix\n    };\n\n    var fromHtml = function (html, scope) {\n      var doc = scope || document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      if (!div.hasChildNodes() || div.childNodes.length > 1) {\n        console.error('HTML does not have a single root node', html);\n        throw new Error('HTML must have a single root node');\n      }\n      return fromDom(div.childNodes[0]);\n    };\n    var fromTag = function (tag, scope) {\n      var doc = scope || document;\n      var node = doc.createElement(tag);\n      return fromDom(node);\n    };\n    var fromText = function (text, scope) {\n      var doc = scope || document;\n      var node = doc.createTextNode(text);\n      return fromDom(node);\n    };\n    var fromDom = function (node) {\n      if (node === null || node === undefined) {\n        throw new Error('Node cannot be null or undefined');\n      }\n      return { dom: node };\n    };\n    var fromPoint = function (docElm, x, y) {\n      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n    };\n    var SugarElement = {\n      fromHtml: fromHtml,\n      fromTag: fromTag,\n      fromText: fromText,\n      fromDom: fromDom,\n      fromPoint: fromPoint\n    };\n\n    var toArray$1 = function (target, f) {\n      var r = [];\n      var recurse = function (e) {\n        r.push(e);\n        return f(e);\n      };\n      var cur = f(target);\n      do {\n        cur = cur.bind(recurse);\n      } while (cur.isSome());\n      return r;\n    };\n\n    var compareDocumentPosition = function (a, b, match) {\n      return (a.compareDocumentPosition(b) & match) !== 0;\n    };\n    var documentPositionContainedBy = function (a, b) {\n      return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_CONTAINED_BY);\n    };\n\n    var COMMENT = 8;\n    var DOCUMENT = 9;\n    var DOCUMENT_FRAGMENT = 11;\n    var ELEMENT = 1;\n    var TEXT = 3;\n\n    var is$1 = function (element, selector) {\n      var dom = element.dom;\n      if (dom.nodeType !== ELEMENT) {\n        return false;\n      } else {\n        var elem = dom;\n        if (elem.matches !== undefined) {\n          return elem.matches(selector);\n        } else if (elem.msMatchesSelector !== undefined) {\n          return elem.msMatchesSelector(selector);\n        } else if (elem.webkitMatchesSelector !== undefined) {\n          return elem.webkitMatchesSelector(selector);\n        } else if (elem.mozMatchesSelector !== undefined) {\n          return elem.mozMatchesSelector(selector);\n        } else {\n          throw new Error('Browser lacks native selectors');\n        }\n      }\n    };\n    var bypassSelector = function (dom) {\n      return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;\n    };\n    var all = function (selector, scope) {\n      var base = scope === undefined ? document : scope.dom;\n      return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), SugarElement.fromDom);\n    };\n    var one = function (selector, scope) {\n      var base = scope === undefined ? document : scope.dom;\n      return bypassSelector(base) ? Optional.none() : Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);\n    };\n\n    var eq$2 = function (e1, e2) {\n      return e1.dom === e2.dom;\n    };\n    var regularContains = function (e1, e2) {\n      var d1 = e1.dom;\n      var d2 = e2.dom;\n      return d1 === d2 ? false : d1.contains(d2);\n    };\n    var ieContains = function (e1, e2) {\n      return documentPositionContainedBy(e1.dom, e2.dom);\n    };\n    var contains$2 = function (e1, e2) {\n      return detect$3().browser.isIE() ? ieContains(e1, e2) : regularContains(e1, e2);\n    };\n\n    var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n\n    var name = function (element) {\n      var r = element.dom.nodeName;\n      return r.toLowerCase();\n    };\n    var type = function (element) {\n      return element.dom.nodeType;\n    };\n    var isType$1 = function (t) {\n      return function (element) {\n        return type(element) === t;\n      };\n    };\n    var isComment = function (element) {\n      return type(element) === COMMENT || name(element) === '#comment';\n    };\n    var isElement = isType$1(ELEMENT);\n    var isText = isType$1(TEXT);\n    var isDocument = isType$1(DOCUMENT);\n    var isDocumentFragment = isType$1(DOCUMENT_FRAGMENT);\n\n    var owner = function (element) {\n      return SugarElement.fromDom(element.dom.ownerDocument);\n    };\n    var documentOrOwner = function (dos) {\n      return isDocument(dos) ? dos : owner(dos);\n    };\n    var documentElement = function (element) {\n      return SugarElement.fromDom(documentOrOwner(element).dom.documentElement);\n    };\n    var defaultView = function (element) {\n      return SugarElement.fromDom(documentOrOwner(element).dom.defaultView);\n    };\n    var parent = function (element) {\n      return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);\n    };\n    var parents = function (element, isRoot) {\n      var stop = isFunction(isRoot) ? isRoot : never;\n      var dom = element.dom;\n      var ret = [];\n      while (dom.parentNode !== null && dom.parentNode !== undefined) {\n        var rawParent = dom.parentNode;\n        var p = SugarElement.fromDom(rawParent);\n        ret.push(p);\n        if (stop(p) === true) {\n          break;\n        } else {\n          dom = rawParent;\n        }\n      }\n      return ret;\n    };\n    var siblings = function (element) {\n      var filterSelf = function (elements) {\n        return filter(elements, function (x) {\n          return !eq$2(element, x);\n        });\n      };\n      return parent(element).map(children).map(filterSelf).getOr([]);\n    };\n    var prevSibling = function (element) {\n      return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom);\n    };\n    var nextSibling = function (element) {\n      return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);\n    };\n    var prevSiblings = function (element) {\n      return reverse(toArray$1(element, prevSibling));\n    };\n    var nextSiblings = function (element) {\n      return toArray$1(element, nextSibling);\n    };\n    var children = function (element) {\n      return map(element.dom.childNodes, SugarElement.fromDom);\n    };\n    var child = function (element, index) {\n      var cs = element.dom.childNodes;\n      return Optional.from(cs[index]).map(SugarElement.fromDom);\n    };\n    var firstChild = function (element) {\n      return child(element, 0);\n    };\n    var lastChild = function (element) {\n      return child(element, element.dom.childNodes.length - 1);\n    };\n    var childNodesCount = function (element) {\n      return element.dom.childNodes.length;\n    };\n\n    var getHead = function (doc) {\n      var b = doc.dom.head;\n      if (b === null || b === undefined) {\n        throw new Error('Head is not available yet');\n      }\n      return SugarElement.fromDom(b);\n    };\n\n    var isShadowRoot = function (dos) {\n      return isDocumentFragment(dos);\n    };\n    var supported = isFunction(Element.prototype.attachShadow) && isFunction(Node.prototype.getRootNode);\n    var isSupported = constant(supported);\n    var getRootNode = supported ? function (e) {\n      return SugarElement.fromDom(e.dom.getRootNode());\n    } : documentOrOwner;\n    var getStyleContainer = function (dos) {\n      return isShadowRoot(dos) ? dos : getHead(documentOrOwner(dos));\n    };\n    var getShadowRoot = function (e) {\n      var r = getRootNode(e);\n      return isShadowRoot(r) ? Optional.some(r) : Optional.none();\n    };\n    var getShadowHost = function (e) {\n      return SugarElement.fromDom(e.dom.host);\n    };\n    var getOriginalEventTarget = function (event) {\n      if (isSupported() && isNonNullable(event.target)) {\n        var el = SugarElement.fromDom(event.target);\n        if (isElement(el) && isOpenShadowHost(el)) {\n          if (event.composed && event.composedPath) {\n            var composedPath = event.composedPath();\n            if (composedPath) {\n              return head(composedPath);\n            }\n          }\n        }\n      }\n      return Optional.from(event.target);\n    };\n    var isOpenShadowHost = function (element) {\n      return isNonNullable(element.dom.shadowRoot);\n    };\n\n    var before = function (marker, element) {\n      var parent$1 = parent(marker);\n      parent$1.each(function (v) {\n        v.dom.insertBefore(element.dom, marker.dom);\n      });\n    };\n    var after = function (marker, element) {\n      var sibling = nextSibling(marker);\n      sibling.fold(function () {\n        var parent$1 = parent(marker);\n        parent$1.each(function (v) {\n          append(v, element);\n        });\n      }, function (v) {\n        before(v, element);\n      });\n    };\n    var prepend = function (parent, element) {\n      var firstChild$1 = firstChild(parent);\n      firstChild$1.fold(function () {\n        append(parent, element);\n      }, function (v) {\n        parent.dom.insertBefore(element.dom, v.dom);\n      });\n    };\n    var append = function (parent, element) {\n      parent.dom.appendChild(element.dom);\n    };\n    var wrap = function (element, wrapper) {\n      before(element, wrapper);\n      append(wrapper, element);\n    };\n\n    var before$1 = function (marker, elements) {\n      each(elements, function (x) {\n        before(marker, x);\n      });\n    };\n    var append$1 = function (parent, elements) {\n      each(elements, function (x) {\n        append(parent, x);\n      });\n    };\n\n    var empty = function (element) {\n      element.dom.textContent = '';\n      each(children(element), function (rogue) {\n        remove(rogue);\n      });\n    };\n    var remove = function (element) {\n      var dom = element.dom;\n      if (dom.parentNode !== null) {\n        dom.parentNode.removeChild(dom);\n      }\n    };\n    var unwrap = function (wrapper) {\n      var children$1 = children(wrapper);\n      if (children$1.length > 0) {\n        before$1(wrapper, children$1);\n      }\n      remove(wrapper);\n    };\n\n    var inBody = function (element) {\n      var dom = isText(element) ? element.dom.parentNode : element.dom;\n      if (dom === undefined || dom === null || dom.ownerDocument === null) {\n        return false;\n      }\n      var doc = dom.ownerDocument;\n      return getShadowRoot(SugarElement.fromDom(dom)).fold(function () {\n        return doc.body.contains(dom);\n      }, compose1(inBody, getShadowHost));\n    };\n\n    var r = function (left, top) {\n      var translate = function (x, y) {\n        return r(left + x, top + y);\n      };\n      return {\n        left: left,\n        top: top,\n        translate: translate\n      };\n    };\n    var SugarPosition = r;\n\n    var boxPosition = function (dom) {\n      var box = dom.getBoundingClientRect();\n      return SugarPosition(box.left, box.top);\n    };\n    var firstDefinedOrZero = function (a, b) {\n      if (a !== undefined) {\n        return a;\n      } else {\n        return b !== undefined ? b : 0;\n      }\n    };\n    var absolute = function (element) {\n      var doc = element.dom.ownerDocument;\n      var body = doc.body;\n      var win = doc.defaultView;\n      var html = doc.documentElement;\n      if (body === element.dom) {\n        return SugarPosition(body.offsetLeft, body.offsetTop);\n      }\n      var scrollTop = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageYOffset, html.scrollTop);\n      var scrollLeft = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageXOffset, html.scrollLeft);\n      var clientTop = firstDefinedOrZero(html.clientTop, body.clientTop);\n      var clientLeft = firstDefinedOrZero(html.clientLeft, body.clientLeft);\n      return viewport(element).translate(scrollLeft - clientLeft, scrollTop - clientTop);\n    };\n    var viewport = function (element) {\n      var dom = element.dom;\n      var doc = dom.ownerDocument;\n      var body = doc.body;\n      if (body === dom) {\n        return SugarPosition(body.offsetLeft, body.offsetTop);\n      }\n      if (!inBody(element)) {\n        return SugarPosition(0, 0);\n      }\n      return boxPosition(dom);\n    };\n\n    var get$2 = function (_DOC) {\n      var doc = _DOC !== undefined ? _DOC.dom : document;\n      var x = doc.body.scrollLeft || doc.documentElement.scrollLeft;\n      var y = doc.body.scrollTop || doc.documentElement.scrollTop;\n      return SugarPosition(x, y);\n    };\n    var to = function (x, y, _DOC) {\n      var doc = _DOC !== undefined ? _DOC.dom : document;\n      var win = doc.defaultView;\n      if (win) {\n        win.scrollTo(x, y);\n      }\n    };\n    var intoView = function (element, alignToTop) {\n      var isSafari = detect$3().browser.isSafari();\n      if (isSafari && isFunction(element.dom.scrollIntoViewIfNeeded)) {\n        element.dom.scrollIntoViewIfNeeded(false);\n      } else {\n        element.dom.scrollIntoView(alignToTop);\n      }\n    };\n\n    var get$3 = function (_win) {\n      var win = _win === undefined ? window : _win;\n      return Optional.from(win['visualViewport']);\n    };\n    var bounds = function (x, y, width, height) {\n      return {\n        x: x,\n        y: y,\n        width: width,\n        height: height,\n        right: x + width,\n        bottom: y + height\n      };\n    };\n    var getBounds = function (_win) {\n      var win = _win === undefined ? window : _win;\n      var doc = win.document;\n      var scroll = get$2(SugarElement.fromDom(doc));\n      return get$3(win).fold(function () {\n        var html = win.document.documentElement;\n        var width = html.clientWidth;\n        var height = html.clientHeight;\n        return bounds(scroll.left, scroll.top, width, height);\n      }, function (visualViewport) {\n        return bounds(Math.max(visualViewport.pageLeft, scroll.left), Math.max(visualViewport.pageTop, scroll.top), visualViewport.width, visualViewport.height);\n      });\n    };\n\n    var isNodeType = function (type) {\n      return function (node) {\n        return !!node && node.nodeType === type;\n      };\n    };\n    var isRestrictedNode = function (node) {\n      return !!node && !Object.getPrototypeOf(node);\n    };\n    var isElement$1 = isNodeType(1);\n    var matchNodeNames = function (names) {\n      var lowercasedNames = names.map(function (s) {\n        return s.toLowerCase();\n      });\n      return function (node) {\n        if (node && node.nodeName) {\n          var nodeName = node.nodeName.toLowerCase();\n          return contains(lowercasedNames, nodeName);\n        }\n        return false;\n      };\n    };\n    var matchStyleValues = function (name, values) {\n      var items = values.toLowerCase().split(' ');\n      return function (node) {\n        var i, cssValue;\n        if (isElement$1(node)) {\n          for (i = 0; i < items.length; i++) {\n            var computed = node.ownerDocument.defaultView.getComputedStyle(node, null);\n            cssValue = computed ? computed.getPropertyValue(name) : null;\n            if (cssValue === items[i]) {\n              return true;\n            }\n          }\n        }\n        return false;\n      };\n    };\n    var hasAttribute = function (attrName) {\n      return function (node) {\n        return isElement$1(node) && node.hasAttribute(attrName);\n      };\n    };\n    var hasAttributeValue = function (attrName, attrValue) {\n      return function (node) {\n        return isElement$1(node) && node.getAttribute(attrName) === attrValue;\n      };\n    };\n    var isBogus = function (node) {\n      return isElement$1(node) && node.hasAttribute('data-mce-bogus');\n    };\n    var isBogusAll = function (node) {\n      return isElement$1(node) && node.getAttribute('data-mce-bogus') === 'all';\n    };\n    var isTable = function (node) {\n      return isElement$1(node) && node.tagName === 'TABLE';\n    };\n    var hasContentEditableState = function (value) {\n      return function (node) {\n        if (isElement$1(node)) {\n          if (node.contentEditable === value) {\n            return true;\n          }\n          if (node.getAttribute('data-mce-contenteditable') === value) {\n            return true;\n          }\n        }\n        return false;\n      };\n    };\n    var isTextareaOrInput = matchNodeNames([\n      'textarea',\n      'input'\n    ]);\n    var isText$1 = isNodeType(3);\n    var isComment$1 = isNodeType(8);\n    var isDocument$1 = isNodeType(9);\n    var isDocumentFragment$1 = isNodeType(11);\n    var isBr = matchNodeNames(['br']);\n    var isImg = matchNodeNames(['img']);\n    var isContentEditableTrue = hasContentEditableState('true');\n    var isContentEditableFalse = hasContentEditableState('false');\n    var isTableCell = matchNodeNames([\n      'td',\n      'th'\n    ]);\n    var isMedia = matchNodeNames([\n      'video',\n      'audio',\n      'object',\n      'embed'\n    ]);\n\n    var isSupported$1 = function (dom) {\n      return dom.style !== undefined && isFunction(dom.style.getPropertyValue);\n    };\n\n    var rawSet = function (dom, key, value) {\n      if (isString(value) || isBoolean(value) || isNumber(value)) {\n        dom.setAttribute(key, value + '');\n      } else {\n        console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n        throw new Error('Attribute value was not simple');\n      }\n    };\n    var set = function (element, key, value) {\n      rawSet(element.dom, key, value);\n    };\n    var setAll = function (element, attrs) {\n      var dom = element.dom;\n      each$1(attrs, function (v, k) {\n        rawSet(dom, k, v);\n      });\n    };\n    var get$4 = function (element, key) {\n      var v = element.dom.getAttribute(key);\n      return v === null ? undefined : v;\n    };\n    var getOpt = function (element, key) {\n      return Optional.from(get$4(element, key));\n    };\n    var has$1 = function (element, key) {\n      var dom = element.dom;\n      return dom && dom.hasAttribute ? dom.hasAttribute(key) : false;\n    };\n    var remove$1 = function (element, key) {\n      element.dom.removeAttribute(key);\n    };\n    var clone = function (element) {\n      return foldl(element.dom.attributes, function (acc, attr) {\n        acc[attr.name] = attr.value;\n        return acc;\n      }, {});\n    };\n\n    var internalSet = function (dom, property, value) {\n      if (!isString(value)) {\n        console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);\n        throw new Error('CSS value must be a string: ' + value);\n      }\n      if (isSupported$1(dom)) {\n        dom.style.setProperty(property, value);\n      }\n    };\n    var setAll$1 = function (element, css) {\n      var dom = element.dom;\n      each$1(css, function (v, k) {\n        internalSet(dom, k, v);\n      });\n    };\n    var get$5 = function (element, property) {\n      var dom = element.dom;\n      var styles = window.getComputedStyle(dom);\n      var r = styles.getPropertyValue(property);\n      return r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;\n    };\n    var getUnsafeProperty = function (dom, property) {\n      return isSupported$1(dom) ? dom.style.getPropertyValue(property) : '';\n    };\n    var getRaw = function (element, property) {\n      var dom = element.dom;\n      var raw = getUnsafeProperty(dom, property);\n      return Optional.from(raw).filter(function (r) {\n        return r.length > 0;\n      });\n    };\n    var getAllRaw = function (element) {\n      var css = {};\n      var dom = element.dom;\n      if (isSupported$1(dom)) {\n        for (var i = 0; i < dom.style.length; i++) {\n          var ruleName = dom.style.item(i);\n          css[ruleName] = dom.style[ruleName];\n        }\n      }\n      return css;\n    };\n    var reflow = function (e) {\n      return e.dom.offsetWidth;\n    };\n\n    var browser$1 = detect$3().browser;\n    var firstElement = function (nodes) {\n      return find(nodes, isElement);\n    };\n    var getTableCaptionDeltaY = function (elm) {\n      if (browser$1.isFirefox() && name(elm) === 'table') {\n        return firstElement(children(elm)).filter(function (elm) {\n          return name(elm) === 'caption';\n        }).bind(function (caption) {\n          return firstElement(nextSiblings(caption)).map(function (body) {\n            var bodyTop = body.dom.offsetTop;\n            var captionTop = caption.dom.offsetTop;\n            var captionHeight = caption.dom.offsetHeight;\n            return bodyTop <= captionTop ? -captionHeight : 0;\n          });\n        }).getOr(0);\n      } else {\n        return 0;\n      }\n    };\n    var hasChild = function (elm, child) {\n      return elm.children && contains(elm.children, child);\n    };\n    var getPos = function (body, elm, rootElm) {\n      var x = 0, y = 0, offsetParent;\n      var doc = body.ownerDocument;\n      var pos;\n      rootElm = rootElm ? rootElm : body;\n      if (elm) {\n        if (rootElm === body && elm.getBoundingClientRect && get$5(SugarElement.fromDom(body), 'position') === 'static') {\n          pos = elm.getBoundingClientRect();\n          x = pos.left + (doc.documentElement.scrollLeft || body.scrollLeft) - doc.documentElement.clientLeft;\n          y = pos.top + (doc.documentElement.scrollTop || body.scrollTop) - doc.documentElement.clientTop;\n          return {\n            x: x,\n            y: y\n          };\n        }\n        offsetParent = elm;\n        while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType && !hasChild(offsetParent, rootElm)) {\n          x += offsetParent.offsetLeft || 0;\n          y += offsetParent.offsetTop || 0;\n          offsetParent = offsetParent.offsetParent;\n        }\n        offsetParent = elm.parentNode;\n        while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType && !hasChild(offsetParent, rootElm)) {\n          x -= offsetParent.scrollLeft || 0;\n          y -= offsetParent.scrollTop || 0;\n          offsetParent = offsetParent.parentNode;\n        }\n        y += getTableCaptionDeltaY(SugarElement.fromDom(elm));\n      }\n      return {\n        x: x,\n        y: y\n      };\n    };\n\n    var exports$1 = {}, module$1 = { exports: exports$1 };\n    (function (define, exports, module, require) {\n      (function (f) {\n        if (typeof exports === 'object' && typeof module !== 'undefined') {\n          module.exports = f();\n        } else if (typeof define === 'function' && define.amd) {\n          define([], f);\n        } else {\n          var g;\n          if (typeof window !== 'undefined') {\n            g = window;\n          } else if (typeof global !== 'undefined') {\n            g = global;\n          } else if (typeof self !== 'undefined') {\n            g = self;\n          } else {\n            g = this;\n          }\n          g.EphoxContactWrapper = f();\n        }\n      }(function () {\n        return function () {\n          function r(e, n, t) {\n            function o(i, f) {\n              if (!n[i]) {\n                if (!e[i]) {\n                  var c = 'function' == typeof require && require;\n                  if (!f && c)\n                    return c(i, !0);\n                  if (u)\n                    return u(i, !0);\n                  var a = new Error('Cannot find module \\'' + i + '\\'');\n                  throw a.code = 'MODULE_NOT_FOUND', a;\n                }\n                var p = n[i] = { exports: {} };\n                e[i][0].call(p.exports, function (r) {\n                  var n = e[i][1][r];\n                  return o(n || r);\n                }, p, p.exports, r, e, n, t);\n              }\n              return n[i].exports;\n            }\n            for (var u = 'function' == typeof require && require, i = 0; i < t.length; i++)\n              o(t[i]);\n            return o;\n          }\n          return r;\n        }()({\n          1: [\n            function (require, module, exports) {\n              var process = module.exports = {};\n              var cachedSetTimeout;\n              var cachedClearTimeout;\n              function defaultSetTimout() {\n                throw new Error('setTimeout has not been defined');\n              }\n              function defaultClearTimeout() {\n                throw new Error('clearTimeout has not been defined');\n              }\n              (function () {\n                try {\n                  if (typeof setTimeout === 'function') {\n                    cachedSetTimeout = setTimeout;\n                  } else {\n                    cachedSetTimeout = defaultSetTimout;\n                  }\n                } catch (e) {\n                  cachedSetTimeout = defaultSetTimout;\n                }\n                try {\n                  if (typeof clearTimeout === 'function') {\n                    cachedClearTimeout = clearTimeout;\n                  } else {\n                    cachedClearTimeout = defaultClearTimeout;\n                  }\n                } catch (e) {\n                  cachedClearTimeout = defaultClearTimeout;\n                }\n              }());\n              function runTimeout(fun) {\n                if (cachedSetTimeout === setTimeout) {\n                  return setTimeout(fun, 0);\n                }\n                if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n                  cachedSetTimeout = setTimeout;\n                  return setTimeout(fun, 0);\n                }\n                try {\n                  return cachedSetTimeout(fun, 0);\n                } catch (e) {\n                  try {\n                    return cachedSetTimeout.call(null, fun, 0);\n                  } catch (e) {\n                    return cachedSetTimeout.call(this, fun, 0);\n                  }\n                }\n              }\n              function runClearTimeout(marker) {\n                if (cachedClearTimeout === clearTimeout) {\n                  return clearTimeout(marker);\n                }\n                if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n                  cachedClearTimeout = clearTimeout;\n                  return clearTimeout(marker);\n                }\n                try {\n                  return cachedClearTimeout(marker);\n                } catch (e) {\n                  try {\n                    return cachedClearTimeout.call(null, marker);\n                  } catch (e) {\n                    return cachedClearTimeout.call(this, marker);\n                  }\n                }\n              }\n              var queue = [];\n              var draining = false;\n              var currentQueue;\n              var queueIndex = -1;\n              function cleanUpNextTick() {\n                if (!draining || !currentQueue) {\n                  return;\n                }\n                draining = false;\n                if (currentQueue.length) {\n                  queue = currentQueue.concat(queue);\n                } else {\n                  queueIndex = -1;\n                }\n                if (queue.length) {\n                  drainQueue();\n                }\n              }\n              function drainQueue() {\n                if (draining) {\n                  return;\n                }\n                var timeout = runTimeout(cleanUpNextTick);\n                draining = true;\n                var len = queue.length;\n                while (len) {\n                  currentQueue = queue;\n                  queue = [];\n                  while (++queueIndex < len) {\n                    if (currentQueue) {\n                      currentQueue[queueIndex].run();\n                    }\n                  }\n                  queueIndex = -1;\n                  len = queue.length;\n                }\n                currentQueue = null;\n                draining = false;\n                runClearTimeout(timeout);\n              }\n              process.nextTick = function (fun) {\n                var args = new Array(arguments.length - 1);\n                if (arguments.length > 1) {\n                  for (var i = 1; i < arguments.length; i++) {\n                    args[i - 1] = arguments[i];\n                  }\n                }\n                queue.push(new Item(fun, args));\n                if (queue.length === 1 && !draining) {\n                  runTimeout(drainQueue);\n                }\n              };\n              function Item(fun, array) {\n                this.fun = fun;\n                this.array = array;\n              }\n              Item.prototype.run = function () {\n                this.fun.apply(null, this.array);\n              };\n              process.title = 'browser';\n              process.browser = true;\n              process.env = {};\n              process.argv = [];\n              process.version = '';\n              process.versions = {};\n              function noop() {\n              }\n              process.on = noop;\n              process.addListener = noop;\n              process.once = noop;\n              process.off = noop;\n              process.removeListener = noop;\n              process.removeAllListeners = noop;\n              process.emit = noop;\n              process.prependListener = noop;\n              process.prependOnceListener = noop;\n              process.listeners = function (name) {\n                return [];\n              };\n              process.binding = function (name) {\n                throw new Error('process.binding is not supported');\n              };\n              process.cwd = function () {\n                return '/';\n              };\n              process.chdir = function (dir) {\n                throw new Error('process.chdir is not supported');\n              };\n              process.umask = function () {\n                return 0;\n              };\n            },\n            {}\n          ],\n          2: [\n            function (require, module, exports) {\n              (function (setImmediate) {\n                (function (root) {\n                  var setTimeoutFunc = setTimeout;\n                  function noop() {\n                  }\n                  function bind(fn, thisArg) {\n                    return function () {\n                      fn.apply(thisArg, arguments);\n                    };\n                  }\n                  function Promise(fn) {\n                    if (typeof this !== 'object')\n                      throw new TypeError('Promises must be constructed via new');\n                    if (typeof fn !== 'function')\n                      throw new TypeError('not a function');\n                    this._state = 0;\n                    this._handled = false;\n                    this._value = undefined;\n                    this._deferreds = [];\n                    doResolve(fn, this);\n                  }\n                  function handle(self, deferred) {\n                    while (self._state === 3) {\n                      self = self._value;\n                    }\n                    if (self._state === 0) {\n                      self._deferreds.push(deferred);\n                      return;\n                    }\n                    self._handled = true;\n                    Promise._immediateFn(function () {\n                      var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n                      if (cb === null) {\n                        (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n                        return;\n                      }\n                      var ret;\n                      try {\n                        ret = cb(self._value);\n                      } catch (e) {\n                        reject(deferred.promise, e);\n                        return;\n                      }\n                      resolve(deferred.promise, ret);\n                    });\n                  }\n                  function resolve(self, newValue) {\n                    try {\n                      if (newValue === self)\n                        throw new TypeError('A promise cannot be resolved with itself.');\n                      if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n                        var then = newValue.then;\n                        if (newValue instanceof Promise) {\n                          self._state = 3;\n                          self._value = newValue;\n                          finale(self);\n                          return;\n                        } else if (typeof then === 'function') {\n                          doResolve(bind(then, newValue), self);\n                          return;\n                        }\n                      }\n                      self._state = 1;\n                      self._value = newValue;\n                      finale(self);\n                    } catch (e) {\n                      reject(self, e);\n                    }\n                  }\n                  function reject(self, newValue) {\n                    self._state = 2;\n                    self._value = newValue;\n                    finale(self);\n                  }\n                  function finale(self) {\n                    if (self._state === 2 && self._deferreds.length === 0) {\n                      Promise._immediateFn(function () {\n                        if (!self._handled) {\n                          Promise._unhandledRejectionFn(self._value);\n                        }\n                      });\n                    }\n                    for (var i = 0, len = self._deferreds.length; i < len; i++) {\n                      handle(self, self._deferreds[i]);\n                    }\n                    self._deferreds = null;\n                  }\n                  function Handler(onFulfilled, onRejected, promise) {\n                    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n                    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n                    this.promise = promise;\n                  }\n                  function doResolve(fn, self) {\n                    var done = false;\n                    try {\n                      fn(function (value) {\n                        if (done)\n                          return;\n                        done = true;\n                        resolve(self, value);\n                      }, function (reason) {\n                        if (done)\n                          return;\n                        done = true;\n                        reject(self, reason);\n                      });\n                    } catch (ex) {\n                      if (done)\n                        return;\n                      done = true;\n                      reject(self, ex);\n                    }\n                  }\n                  Promise.prototype['catch'] = function (onRejected) {\n                    return this.then(null, onRejected);\n                  };\n                  Promise.prototype.then = function (onFulfilled, onRejected) {\n                    var prom = new this.constructor(noop);\n                    handle(this, new Handler(onFulfilled, onRejected, prom));\n                    return prom;\n                  };\n                  Promise.all = function (arr) {\n                    var args = Array.prototype.slice.call(arr);\n                    return new Promise(function (resolve, reject) {\n                      if (args.length === 0)\n                        return resolve([]);\n                      var remaining = args.length;\n                      function res(i, val) {\n                        try {\n                          if (val && (typeof val === 'object' || typeof val === 'function')) {\n                            var then = val.then;\n                            if (typeof then === 'function') {\n                              then.call(val, function (val) {\n                                res(i, val);\n                              }, reject);\n                              return;\n                            }\n                          }\n                          args[i] = val;\n                          if (--remaining === 0) {\n                            resolve(args);\n                          }\n                        } catch (ex) {\n                          reject(ex);\n                        }\n                      }\n                      for (var i = 0; i < args.length; i++) {\n                        res(i, args[i]);\n                      }\n                    });\n                  };\n                  Promise.resolve = function (value) {\n                    if (value && typeof value === 'object' && value.constructor === Promise) {\n                      return value;\n                    }\n                    return new Promise(function (resolve) {\n                      resolve(value);\n                    });\n                  };\n                  Promise.reject = function (value) {\n                    return new Promise(function (resolve, reject) {\n                      reject(value);\n                    });\n                  };\n                  Promise.race = function (values) {\n                    return new Promise(function (resolve, reject) {\n                      for (var i = 0, len = values.length; i < len; i++) {\n                        values[i].then(resolve, reject);\n                      }\n                    });\n                  };\n                  Promise._immediateFn = typeof setImmediate === 'function' ? function (fn) {\n                    setImmediate(fn);\n                  } : function (fn) {\n                    setTimeoutFunc(fn, 0);\n                  };\n                  Promise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n                    if (typeof console !== 'undefined' && console) {\n                      console.warn('Possible Unhandled Promise Rejection:', err);\n                    }\n                  };\n                  Promise._setImmediateFn = function _setImmediateFn(fn) {\n                    Promise._immediateFn = fn;\n                  };\n                  Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {\n                    Promise._unhandledRejectionFn = fn;\n                  };\n                  if (typeof module !== 'undefined' && module.exports) {\n                    module.exports = Promise;\n                  } else if (!root.Promise) {\n                    root.Promise = Promise;\n                  }\n                }(this));\n              }.call(this, require('timers').setImmediate));\n            },\n            { 'timers': 3 }\n          ],\n          3: [\n            function (require, module, exports) {\n              (function (setImmediate, clearImmediate) {\n                var nextTick = require('process/browser.js').nextTick;\n                var apply = Function.prototype.apply;\n                var slice = Array.prototype.slice;\n                var immediateIds = {};\n                var nextImmediateId = 0;\n                exports.setTimeout = function () {\n                  return new Timeout(apply.call(setTimeout, window, arguments), clearTimeout);\n                };\n                exports.setInterval = function () {\n                  return new Timeout(apply.call(setInterval, window, arguments), clearInterval);\n                };\n                exports.clearTimeout = exports.clearInterval = function (timeout) {\n                  timeout.close();\n                };\n                function Timeout(id, clearFn) {\n                  this._id = id;\n                  this._clearFn = clearFn;\n                }\n                Timeout.prototype.unref = Timeout.prototype.ref = function () {\n                };\n                Timeout.prototype.close = function () {\n                  this._clearFn.call(window, this._id);\n                };\n                exports.enroll = function (item, msecs) {\n                  clearTimeout(item._idleTimeoutId);\n                  item._idleTimeout = msecs;\n                };\n                exports.unenroll = function (item) {\n                  clearTimeout(item._idleTimeoutId);\n                  item._idleTimeout = -1;\n                };\n                exports._unrefActive = exports.active = function (item) {\n                  clearTimeout(item._idleTimeoutId);\n                  var msecs = item._idleTimeout;\n                  if (msecs >= 0) {\n                    item._idleTimeoutId = setTimeout(function onTimeout() {\n                      if (item._onTimeout)\n                        item._onTimeout();\n                    }, msecs);\n                  }\n                };\n                exports.setImmediate = typeof setImmediate === 'function' ? setImmediate : function (fn) {\n                  var id = nextImmediateId++;\n                  var args = arguments.length < 2 ? false : slice.call(arguments, 1);\n                  immediateIds[id] = true;\n                  nextTick(function onNextTick() {\n                    if (immediateIds[id]) {\n                      if (args) {\n                        fn.apply(null, args);\n                      } else {\n                        fn.call(null);\n                      }\n                      exports.clearImmediate(id);\n                    }\n                  });\n                  return id;\n                };\n                exports.clearImmediate = typeof clearImmediate === 'function' ? clearImmediate : function (id) {\n                  delete immediateIds[id];\n                };\n              }.call(this, require('timers').setImmediate, require('timers').clearImmediate));\n            },\n            {\n              'process/browser.js': 1,\n              'timers': 3\n            }\n          ],\n          4: [\n            function (require, module, exports) {\n              var promisePolyfill = require('promise-polyfill');\n              var Global = function () {\n                if (typeof window !== 'undefined') {\n                  return window;\n                } else {\n                  return Function('return this;')();\n                }\n              }();\n              module.exports = { boltExport: Global.Promise || promisePolyfill };\n            },\n            { 'promise-polyfill': 2 }\n          ]\n        }, {}, [4])(4);\n      }));\n    }(undefined, exports$1, module$1, undefined));\n    var Promise = module$1.exports.boltExport;\n\n    var nu$3 = function (baseFn) {\n      var data = Optional.none();\n      var callbacks = [];\n      var map = function (f) {\n        return nu$3(function (nCallback) {\n          get(function (data) {\n            nCallback(f(data));\n          });\n        });\n      };\n      var get = function (nCallback) {\n        if (isReady()) {\n          call(nCallback);\n        } else {\n          callbacks.push(nCallback);\n        }\n      };\n      var set = function (x) {\n        if (!isReady()) {\n          data = Optional.some(x);\n          run(callbacks);\n          callbacks = [];\n        }\n      };\n      var isReady = function () {\n        return data.isSome();\n      };\n      var run = function (cbs) {\n        each(cbs, call);\n      };\n      var call = function (cb) {\n        data.each(function (x) {\n          setTimeout(function () {\n            cb(x);\n          }, 0);\n        });\n      };\n      baseFn(set);\n      return {\n        get: get,\n        map: map,\n        isReady: isReady\n      };\n    };\n    var pure = function (a) {\n      return nu$3(function (callback) {\n        callback(a);\n      });\n    };\n    var LazyValue = {\n      nu: nu$3,\n      pure: pure\n    };\n\n    var errorReporter = function (err) {\n      setTimeout(function () {\n        throw err;\n      }, 0);\n    };\n    var make = function (run) {\n      var get = function (callback) {\n        run().then(callback, errorReporter);\n      };\n      var map = function (fab) {\n        return make(function () {\n          return run().then(fab);\n        });\n      };\n      var bind = function (aFutureB) {\n        return make(function () {\n          return run().then(function (v) {\n            return aFutureB(v).toPromise();\n          });\n        });\n      };\n      var anonBind = function (futureB) {\n        return make(function () {\n          return run().then(function () {\n            return futureB.toPromise();\n          });\n        });\n      };\n      var toLazy = function () {\n        return LazyValue.nu(get);\n      };\n      var toCached = function () {\n        var cache = null;\n        return make(function () {\n          if (cache === null) {\n            cache = run();\n          }\n          return cache;\n        });\n      };\n      var toPromise = run;\n      return {\n        map: map,\n        bind: bind,\n        anonBind: anonBind,\n        toLazy: toLazy,\n        toCached: toCached,\n        toPromise: toPromise,\n        get: get\n      };\n    };\n    var nu$4 = function (baseFn) {\n      return make(function () {\n        return new Promise(baseFn);\n      });\n    };\n    var pure$1 = function (a) {\n      return make(function () {\n        return Promise.resolve(a);\n      });\n    };\n    var Future = {\n      nu: nu$4,\n      pure: pure$1\n    };\n\n    var par = function (asyncValues, nu) {\n      return nu(function (callback) {\n        var r = [];\n        var count = 0;\n        var cb = function (i) {\n          return function (value) {\n            r[i] = value;\n            count++;\n            if (count >= asyncValues.length) {\n              callback(r);\n            }\n          };\n        };\n        if (asyncValues.length === 0) {\n          callback([]);\n        } else {\n          each(asyncValues, function (asyncValue, i) {\n            asyncValue.get(cb(i));\n          });\n        }\n      });\n    };\n\n    var par$1 = function (futures) {\n      return par(futures, Future.nu);\n    };\n\n    var value = function (o) {\n      var is = function (v) {\n        return o === v;\n      };\n      var or = function (_opt) {\n        return value(o);\n      };\n      var orThunk = function (_f) {\n        return value(o);\n      };\n      var map = function (f) {\n        return value(f(o));\n      };\n      var mapError = function (_f) {\n        return value(o);\n      };\n      var each = function (f) {\n        f(o);\n      };\n      var bind = function (f) {\n        return f(o);\n      };\n      var fold = function (_, onValue) {\n        return onValue(o);\n      };\n      var exists = function (f) {\n        return f(o);\n      };\n      var forall = function (f) {\n        return f(o);\n      };\n      var toOptional = function () {\n        return Optional.some(o);\n      };\n      return {\n        is: is,\n        isValue: always,\n        isError: never,\n        getOr: constant(o),\n        getOrThunk: constant(o),\n        getOrDie: constant(o),\n        or: or,\n        orThunk: orThunk,\n        fold: fold,\n        map: map,\n        mapError: mapError,\n        each: each,\n        bind: bind,\n        exists: exists,\n        forall: forall,\n        toOptional: toOptional\n      };\n    };\n    var error = function (message) {\n      var getOrThunk = function (f) {\n        return f();\n      };\n      var getOrDie = function () {\n        return die(String(message))();\n      };\n      var or = function (opt) {\n        return opt;\n      };\n      var orThunk = function (f) {\n        return f();\n      };\n      var map = function (_f) {\n        return error(message);\n      };\n      var mapError = function (f) {\n        return error(f(message));\n      };\n      var bind = function (_f) {\n        return error(message);\n      };\n      var fold = function (onError, _) {\n        return onError(message);\n      };\n      return {\n        is: never,\n        isValue: never,\n        isError: always,\n        getOr: identity,\n        getOrThunk: getOrThunk,\n        getOrDie: getOrDie,\n        or: or,\n        orThunk: orThunk,\n        fold: fold,\n        map: map,\n        mapError: mapError,\n        each: noop,\n        bind: bind,\n        exists: never,\n        forall: always,\n        toOptional: Optional.none\n      };\n    };\n    var fromOption = function (opt, err) {\n      return opt.fold(function () {\n        return error(err);\n      }, value);\n    };\n    var Result = {\n      value: value,\n      error: error,\n      fromOption: fromOption\n    };\n\n    var generate = function (cases) {\n      if (!isArray(cases)) {\n        throw new Error('cases must be an array');\n      }\n      if (cases.length === 0) {\n        throw new Error('there must be at least one case');\n      }\n      var constructors = [];\n      var adt = {};\n      each(cases, function (acase, count) {\n        var keys$1 = keys(acase);\n        if (keys$1.length !== 1) {\n          throw new Error('one and only one name per case');\n        }\n        var key = keys$1[0];\n        var value = acase[key];\n        if (adt[key] !== undefined) {\n          throw new Error('duplicate key detected:' + key);\n        } else if (key === 'cata') {\n          throw new Error('cannot have a case named cata (sorry)');\n        } else if (!isArray(value)) {\n          throw new Error('case arguments must be an array');\n        }\n        constructors.push(key);\n        adt[key] = function () {\n          var argLength = arguments.length;\n          if (argLength !== value.length) {\n            throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);\n          }\n          var args = new Array(argLength);\n          for (var i = 0; i < args.length; i++) {\n            args[i] = arguments[i];\n          }\n          var match = function (branches) {\n            var branchKeys = keys(branches);\n            if (constructors.length !== branchKeys.length) {\n              throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\\nActual: ' + branchKeys.join(','));\n            }\n            var allReqd = forall(constructors, function (reqKey) {\n              return contains(branchKeys, reqKey);\n            });\n            if (!allReqd) {\n              throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\\nRequired: ' + constructors.join(', '));\n            }\n            return branches[key].apply(null, args);\n          };\n          return {\n            fold: function () {\n              if (arguments.length !== cases.length) {\n                throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + arguments.length);\n              }\n              var target = arguments[count];\n              return target.apply(null, args);\n            },\n            match: match,\n            log: function (label) {\n              console.log(label, {\n                constructors: constructors,\n                constructor: key,\n                params: args\n              });\n            }\n          };\n        };\n      });\n      return adt;\n    };\n    var Adt = { generate: generate };\n\n    var comparison = Adt.generate([\n      {\n        bothErrors: [\n          'error1',\n          'error2'\n        ]\n      },\n      {\n        firstError: [\n          'error1',\n          'value2'\n        ]\n      },\n      {\n        secondError: [\n          'value1',\n          'error2'\n        ]\n      },\n      {\n        bothValues: [\n          'value1',\n          'value2'\n        ]\n      }\n    ]);\n    var unite = function (result) {\n      return result.fold(identity, identity);\n    };\n\n    function ClosestOrAncestor (is, ancestor, scope, a, isRoot) {\n      if (is(scope, a)) {\n        return Optional.some(scope);\n      } else if (isFunction(isRoot) && isRoot(scope)) {\n        return Optional.none();\n      } else {\n        return ancestor(scope, a, isRoot);\n      }\n    }\n\n    var ancestor = function (scope, predicate, isRoot) {\n      var element = scope.dom;\n      var stop = isFunction(isRoot) ? isRoot : never;\n      while (element.parentNode) {\n        element = element.parentNode;\n        var el = SugarElement.fromDom(element);\n        if (predicate(el)) {\n          return Optional.some(el);\n        } else if (stop(el)) {\n          break;\n        }\n      }\n      return Optional.none();\n    };\n    var closest = function (scope, predicate, isRoot) {\n      var is = function (s, test) {\n        return test(s);\n      };\n      return ClosestOrAncestor(is, ancestor, scope, predicate, isRoot);\n    };\n    var sibling = function (scope, predicate) {\n      var element = scope.dom;\n      if (!element.parentNode) {\n        return Optional.none();\n      }\n      return child$1(SugarElement.fromDom(element.parentNode), function (x) {\n        return !eq$2(scope, x) && predicate(x);\n      });\n    };\n    var child$1 = function (scope, predicate) {\n      var pred = function (node) {\n        return predicate(SugarElement.fromDom(node));\n      };\n      var result = find(scope.dom.childNodes, pred);\n      return result.map(SugarElement.fromDom);\n    };\n\n    var ancestor$1 = function (scope, selector, isRoot) {\n      return ancestor(scope, function (e) {\n        return is$1(e, selector);\n      }, isRoot);\n    };\n    var descendant = function (scope, selector) {\n      return one(selector, scope);\n    };\n    var closest$1 = function (scope, selector, isRoot) {\n      var is = function (element, selector) {\n        return is$1(element, selector);\n      };\n      return ClosestOrAncestor(is, ancestor$1, scope, selector, isRoot);\n    };\n\n    var promise = function () {\n      function bind(fn, thisArg) {\n        return function () {\n          fn.apply(thisArg, arguments);\n        };\n      }\n      var isArray = Array.isArray || function (value) {\n        return Object.prototype.toString.call(value) === '[object Array]';\n      };\n      var Promise = function (fn) {\n        if (typeof this !== 'object') {\n          throw new TypeError('Promises must be constructed via new');\n        }\n        if (typeof fn !== 'function') {\n          throw new TypeError('not a function');\n        }\n        this._state = null;\n        this._value = null;\n        this._deferreds = [];\n        doResolve(fn, bind(resolve, this), bind(reject, this));\n      };\n      var asap = Promise.immediateFn || typeof setImmediate === 'function' && setImmediate || function (fn) {\n        setTimeout(fn, 1);\n      };\n      function handle(deferred) {\n        var me = this;\n        if (this._state === null) {\n          this._deferreds.push(deferred);\n          return;\n        }\n        asap(function () {\n          var cb = me._state ? deferred.onFulfilled : deferred.onRejected;\n          if (cb === null) {\n            (me._state ? deferred.resolve : deferred.reject)(me._value);\n            return;\n          }\n          var ret;\n          try {\n            ret = cb(me._value);\n          } catch (e) {\n            deferred.reject(e);\n            return;\n          }\n          deferred.resolve(ret);\n        });\n      }\n      function resolve(newValue) {\n        try {\n          if (newValue === this) {\n            throw new TypeError('A promise cannot be resolved with itself.');\n          }\n          if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n            var then = newValue.then;\n            if (typeof then === 'function') {\n              doResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\n              return;\n            }\n          }\n          this._state = true;\n          this._value = newValue;\n          finale.call(this);\n        } catch (e) {\n          reject.call(this, e);\n        }\n      }\n      function reject(newValue) {\n        this._state = false;\n        this._value = newValue;\n        finale.call(this);\n      }\n      function finale() {\n        for (var i = 0, len = this._deferreds.length; i < len; i++) {\n          handle.call(this, this._deferreds[i]);\n        }\n        this._deferreds = null;\n      }\n      function Handler(onFulfilled, onRejected, resolve, reject) {\n        this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n        this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n        this.resolve = resolve;\n        this.reject = reject;\n      }\n      function doResolve(fn, onFulfilled, onRejected) {\n        var done = false;\n        try {\n          fn(function (value) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onFulfilled(value);\n          }, function (reason) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onRejected(reason);\n          });\n        } catch (ex) {\n          if (done) {\n            return;\n          }\n          done = true;\n          onRejected(ex);\n        }\n      }\n      Promise.prototype.catch = function (onRejected) {\n        return this.then(null, onRejected);\n      };\n      Promise.prototype.then = function (onFulfilled, onRejected) {\n        var me = this;\n        return new Promise(function (resolve, reject) {\n          handle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\n        });\n      };\n      Promise.all = function () {\n        var args = Array.prototype.slice.call(arguments.length === 1 && isArray(arguments[0]) ? arguments[0] : arguments);\n        return new Promise(function (resolve, reject) {\n          if (args.length === 0) {\n            return resolve([]);\n          }\n          var remaining = args.length;\n          function res(i, val) {\n            try {\n              if (val && (typeof val === 'object' || typeof val === 'function')) {\n                var then = val.then;\n                if (typeof then === 'function') {\n                  then.call(val, function (val) {\n                    res(i, val);\n                  }, reject);\n                  return;\n                }\n              }\n              args[i] = val;\n              if (--remaining === 0) {\n                resolve(args);\n              }\n            } catch (ex) {\n              reject(ex);\n            }\n          }\n          for (var i = 0; i < args.length; i++) {\n            res(i, args[i]);\n          }\n        });\n      };\n      Promise.resolve = function (value) {\n        if (value && typeof value === 'object' && value.constructor === Promise) {\n          return value;\n        }\n        return new Promise(function (resolve) {\n          resolve(value);\n        });\n      };\n      Promise.reject = function (value) {\n        return new Promise(function (resolve, reject) {\n          reject(value);\n        });\n      };\n      Promise.race = function (values) {\n        return new Promise(function (resolve, reject) {\n          for (var i = 0, len = values.length; i < len; i++) {\n            values[i].then(resolve, reject);\n          }\n        });\n      };\n      return Promise;\n    };\n    var promiseObj = window.Promise ? window.Promise : promise();\n\n    var requestAnimationFramePromise;\n    var requestAnimationFrame = function (callback, element) {\n      var i, requestAnimationFrameFunc = window.requestAnimationFrame;\n      var vendors = [\n        'ms',\n        'moz',\n        'webkit'\n      ];\n      var featurefill = function (callback) {\n        window.setTimeout(callback, 0);\n      };\n      for (i = 0; i < vendors.length && !requestAnimationFrameFunc; i++) {\n        requestAnimationFrameFunc = window[vendors[i] + 'RequestAnimationFrame'];\n      }\n      if (!requestAnimationFrameFunc) {\n        requestAnimationFrameFunc = featurefill;\n      }\n      requestAnimationFrameFunc(callback, element);\n    };\n    var wrappedSetTimeout = function (callback, time) {\n      if (typeof time !== 'number') {\n        time = 0;\n      }\n      return setTimeout(callback, time);\n    };\n    var wrappedSetInterval = function (callback, time) {\n      if (typeof time !== 'number') {\n        time = 1;\n      }\n      return setInterval(callback, time);\n    };\n    var wrappedClearTimeout = function (id) {\n      return clearTimeout(id);\n    };\n    var wrappedClearInterval = function (id) {\n      return clearInterval(id);\n    };\n    var debounce = function (callback, time) {\n      var timer;\n      var func = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        clearTimeout(timer);\n        timer = wrappedSetTimeout(function () {\n          callback.apply(this, args);\n        }, time);\n      };\n      func.stop = function () {\n        clearTimeout(timer);\n      };\n      return func;\n    };\n    var Delay = {\n      requestAnimationFrame: function (callback, element) {\n        if (requestAnimationFramePromise) {\n          requestAnimationFramePromise.then(callback);\n          return;\n        }\n        requestAnimationFramePromise = new promiseObj(function (resolve) {\n          if (!element) {\n            element = document.body;\n          }\n          requestAnimationFrame(resolve, element);\n        }).then(callback);\n      },\n      setTimeout: wrappedSetTimeout,\n      setInterval: wrappedSetInterval,\n      setEditorTimeout: function (editor, callback, time) {\n        return wrappedSetTimeout(function () {\n          if (!editor.removed) {\n            callback();\n          }\n        }, time);\n      },\n      setEditorInterval: function (editor, callback, time) {\n        var timer = wrappedSetInterval(function () {\n          if (!editor.removed) {\n            callback();\n          } else {\n            clearInterval(timer);\n          }\n        }, time);\n        return timer;\n      },\n      debounce: debounce,\n      throttle: debounce,\n      clearInterval: wrappedClearInterval,\n      clearTimeout: wrappedClearTimeout\n    };\n\n    function StyleSheetLoader(documentOrShadowRoot, settings) {\n      if (settings === void 0) {\n        settings = {};\n      }\n      var idCount = 0;\n      var loadedStates = {};\n      var edos = SugarElement.fromDom(documentOrShadowRoot);\n      var doc = documentOrOwner(edos);\n      var maxLoadTime = settings.maxLoadTime || 5000;\n      var _setReferrerPolicy = function (referrerPolicy) {\n        settings.referrerPolicy = referrerPolicy;\n      };\n      var addStyle = function (element) {\n        append(getStyleContainer(edos), element);\n      };\n      var removeStyle = function (id) {\n        var styleContainer = getStyleContainer(edos);\n        descendant(styleContainer, '#' + id).each(remove);\n      };\n      var getOrCreateState = function (url) {\n        return get$1(loadedStates, url).getOrThunk(function () {\n          return {\n            id: 'mce-u' + idCount++,\n            passed: [],\n            failed: [],\n            count: 0\n          };\n        });\n      };\n      var load = function (url, success, failure) {\n        var link;\n        var urlWithSuffix = Tools._addCacheSuffix(url);\n        var state = getOrCreateState(urlWithSuffix);\n        loadedStates[urlWithSuffix] = state;\n        state.count++;\n        var resolve = function (callbacks, status) {\n          var i = callbacks.length;\n          while (i--) {\n            callbacks[i]();\n          }\n          state.status = status;\n          state.passed = [];\n          state.failed = [];\n          if (link) {\n            link.onload = null;\n            link.onerror = null;\n            link = null;\n          }\n        };\n        var passed = function () {\n          return resolve(state.passed, 2);\n        };\n        var failed = function () {\n          return resolve(state.failed, 3);\n        };\n        var wait = function (testCallback, waitCallback) {\n          if (!testCallback()) {\n            if (Date.now() - startTime < maxLoadTime) {\n              Delay.setTimeout(waitCallback);\n            } else {\n              failed();\n            }\n          }\n        };\n        var waitForWebKitLinkLoaded = function () {\n          wait(function () {\n            var styleSheets = documentOrShadowRoot.styleSheets;\n            var i = styleSheets.length;\n            while (i--) {\n              var styleSheet = styleSheets[i];\n              var owner = styleSheet.ownerNode;\n              if (owner && owner.id === link.id) {\n                passed();\n                return true;\n              }\n            }\n            return false;\n          }, waitForWebKitLinkLoaded);\n        };\n        if (success) {\n          state.passed.push(success);\n        }\n        if (failure) {\n          state.failed.push(failure);\n        }\n        if (state.status === 1) {\n          return;\n        }\n        if (state.status === 2) {\n          passed();\n          return;\n        }\n        if (state.status === 3) {\n          failed();\n          return;\n        }\n        state.status = 1;\n        var linkElem = SugarElement.fromTag('link', doc.dom);\n        setAll(linkElem, {\n          rel: 'stylesheet',\n          type: 'text/css',\n          id: state.id\n        });\n        var startTime = Date.now();\n        if (settings.contentCssCors) {\n          set(linkElem, 'crossOrigin', 'anonymous');\n        }\n        if (settings.referrerPolicy) {\n          set(linkElem, 'referrerpolicy', settings.referrerPolicy);\n        }\n        link = linkElem.dom;\n        link.onload = waitForWebKitLinkLoaded;\n        link.onerror = failed;\n        addStyle(linkElem);\n        set(linkElem, 'href', urlWithSuffix);\n      };\n      var loadF = function (url) {\n        return Future.nu(function (resolve) {\n          load(url, compose(resolve, constant(Result.value(url))), compose(resolve, constant(Result.error(url))));\n        });\n      };\n      var loadAll = function (urls, success, failure) {\n        par$1(map(urls, loadF)).get(function (result) {\n          var parts = partition(result, function (r) {\n            return r.isValue();\n          });\n          if (parts.fail.length > 0) {\n            failure(parts.fail.map(unite));\n          } else {\n            success(parts.pass.map(unite));\n          }\n        });\n      };\n      var unload = function (url) {\n        var urlWithSuffix = Tools._addCacheSuffix(url);\n        get$1(loadedStates, urlWithSuffix).each(function (state) {\n          var count = --state.count;\n          if (count === 0) {\n            delete loadedStates[urlWithSuffix];\n            removeStyle(state.id);\n          }\n        });\n      };\n      var unloadAll = function (urls) {\n        each(urls, function (url) {\n          unload(url);\n        });\n      };\n      return {\n        load: load,\n        loadAll: loadAll,\n        unload: unload,\n        unloadAll: unloadAll,\n        _setReferrerPolicy: _setReferrerPolicy\n      };\n    }\n\n    var create$1 = function () {\n      var map = new WeakMap();\n      var forElement = function (referenceElement, settings) {\n        var root = getRootNode(referenceElement);\n        var rootDom = root.dom;\n        return Optional.from(map.get(rootDom)).getOrThunk(function () {\n          var sl = StyleSheetLoader(rootDom, settings);\n          map.set(rootDom, sl);\n          return sl;\n        });\n      };\n      return { forElement: forElement };\n    };\n    var instance = create$1();\n\n    var DomTreeWalker = function () {\n      function DomTreeWalker(startNode, rootNode) {\n        this.node = startNode;\n        this.rootNode = rootNode;\n        this.current = this.current.bind(this);\n        this.next = this.next.bind(this);\n        this.prev = this.prev.bind(this);\n        this.prev2 = this.prev2.bind(this);\n      }\n      DomTreeWalker.prototype.current = function () {\n        return this.node;\n      };\n      DomTreeWalker.prototype.next = function (shallow) {\n        this.node = this.findSibling(this.node, 'firstChild', 'nextSibling', shallow);\n        return this.node;\n      };\n      DomTreeWalker.prototype.prev = function (shallow) {\n        this.node = this.findSibling(this.node, 'lastChild', 'previousSibling', shallow);\n        return this.node;\n      };\n      DomTreeWalker.prototype.prev2 = function (shallow) {\n        this.node = this.findPreviousNode(this.node, 'lastChild', 'previousSibling', shallow);\n        return this.node;\n      };\n      DomTreeWalker.prototype.findSibling = function (node, startName, siblingName, shallow) {\n        var sibling, parent;\n        if (node) {\n          if (!shallow && node[startName]) {\n            return node[startName];\n          }\n          if (node !== this.rootNode) {\n            sibling = node[siblingName];\n            if (sibling) {\n              return sibling;\n            }\n            for (parent = node.parentNode; parent && parent !== this.rootNode; parent = parent.parentNode) {\n              sibling = parent[siblingName];\n              if (sibling) {\n                return sibling;\n              }\n            }\n          }\n        }\n      };\n      DomTreeWalker.prototype.findPreviousNode = function (node, startName, siblingName, shallow) {\n        var sibling, parent, child;\n        if (node) {\n          sibling = node[siblingName];\n          if (this.rootNode && sibling === this.rootNode) {\n            return;\n          }\n          if (sibling) {\n            if (!shallow) {\n              for (child = sibling[startName]; child; child = child[startName]) {\n                if (!child[startName]) {\n                  return child;\n                }\n              }\n            }\n            return sibling;\n          }\n          parent = node.parentNode;\n          if (parent && parent !== this.rootNode) {\n            return parent;\n          }\n        }\n      };\n      return DomTreeWalker;\n    }();\n\n    var blocks = [\n      'article',\n      'aside',\n      'details',\n      'div',\n      'dt',\n      'figcaption',\n      'footer',\n      'form',\n      'fieldset',\n      'header',\n      'hgroup',\n      'html',\n      'main',\n      'nav',\n      'section',\n      'summary',\n      'body',\n      'p',\n      'dl',\n      'multicol',\n      'dd',\n      'figure',\n      'address',\n      'center',\n      'blockquote',\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6',\n      'listing',\n      'xmp',\n      'pre',\n      'plaintext',\n      'menu',\n      'dir',\n      'ul',\n      'ol',\n      'li',\n      'hr',\n      'table',\n      'tbody',\n      'thead',\n      'tfoot',\n      'th',\n      'tr',\n      'td',\n      'caption'\n    ];\n    var tableCells = [\n      'td',\n      'th'\n    ];\n    var tableSections = [\n      'thead',\n      'tbody',\n      'tfoot'\n    ];\n    var textBlocks = [\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6',\n      'p',\n      'div',\n      'address',\n      'pre',\n      'form',\n      'blockquote',\n      'center',\n      'dir',\n      'fieldset',\n      'header',\n      'footer',\n      'article',\n      'section',\n      'hgroup',\n      'aside',\n      'nav',\n      'figure'\n    ];\n    var headings = [\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6'\n    ];\n    var listItems = [\n      'li',\n      'dd',\n      'dt'\n    ];\n    var lists = [\n      'ul',\n      'ol',\n      'dl'\n    ];\n    var wsElements = [\n      'pre',\n      'script',\n      'textarea',\n      'style'\n    ];\n    var lazyLookup = function (items) {\n      var lookup;\n      return function (node) {\n        lookup = lookup ? lookup : mapToObject(items, always);\n        return lookup.hasOwnProperty(name(node));\n      };\n    };\n    var isHeading = lazyLookup(headings);\n    var isBlock = lazyLookup(blocks);\n    var isTable$1 = function (node) {\n      return name(node) === 'table';\n    };\n    var isInline = function (node) {\n      return isElement(node) && !isBlock(node);\n    };\n    var isBr$1 = function (node) {\n      return isElement(node) && name(node) === 'br';\n    };\n    var isTextBlock = lazyLookup(textBlocks);\n    var isList = lazyLookup(lists);\n    var isListItem = lazyLookup(listItems);\n    var isTableSection = lazyLookup(tableSections);\n    var isTableCell$1 = lazyLookup(tableCells);\n    var isWsPreserveElement = lazyLookup(wsElements);\n\n    var ancestor$2 = function (scope, selector, isRoot) {\n      return ancestor$1(scope, selector, isRoot).isSome();\n    };\n\n    var zeroWidth = '\\uFEFF';\n    var nbsp = '\\xA0';\n    var isZwsp = function (char) {\n      return char === zeroWidth;\n    };\n    var removeZwsp = function (s) {\n      return s.replace(/\\uFEFF/g, '');\n    };\n\n    var ZWSP = zeroWidth;\n    var isZwsp$1 = isZwsp;\n    var trim$2 = removeZwsp;\n\n    var isElement$2 = isElement$1;\n    var isText$2 = isText$1;\n    var isCaretContainerBlock = function (node) {\n      if (isText$2(node)) {\n        node = node.parentNode;\n      }\n      return isElement$2(node) && node.hasAttribute('data-mce-caret');\n    };\n    var isCaretContainerInline = function (node) {\n      return isText$2(node) && isZwsp$1(node.data);\n    };\n    var isCaretContainer = function (node) {\n      return isCaretContainerBlock(node) || isCaretContainerInline(node);\n    };\n    var hasContent = function (node) {\n      return node.firstChild !== node.lastChild || !isBr(node.firstChild);\n    };\n    var insertInline = function (node, before) {\n      var sibling;\n      var doc = node.ownerDocument;\n      var textNode = doc.createTextNode(ZWSP);\n      var parentNode = node.parentNode;\n      if (!before) {\n        sibling = node.nextSibling;\n        if (isText$2(sibling)) {\n          if (isCaretContainer(sibling)) {\n            return sibling;\n          }\n          if (startsWithCaretContainer(sibling)) {\n            sibling.splitText(1);\n            return sibling;\n          }\n        }\n        if (node.nextSibling) {\n          parentNode.insertBefore(textNode, node.nextSibling);\n        } else {\n          parentNode.appendChild(textNode);\n        }\n      } else {\n        sibling = node.previousSibling;\n        if (isText$2(sibling)) {\n          if (isCaretContainer(sibling)) {\n            return sibling;\n          }\n          if (endsWithCaretContainer(sibling)) {\n            return sibling.splitText(sibling.data.length - 1);\n          }\n        }\n        parentNode.insertBefore(textNode, node);\n      }\n      return textNode;\n    };\n    var isBeforeInline = function (pos) {\n      var container = pos.container();\n      if (!isText$1(container)) {\n        return false;\n      }\n      return container.data.charAt(pos.offset()) === ZWSP || pos.isAtStart() && isCaretContainerInline(container.previousSibling);\n    };\n    var isAfterInline = function (pos) {\n      var container = pos.container();\n      if (!isText$1(container)) {\n        return false;\n      }\n      return container.data.charAt(pos.offset() - 1) === ZWSP || pos.isAtEnd() && isCaretContainerInline(container.nextSibling);\n    };\n    var createBogusBr = function () {\n      var br = document.createElement('br');\n      br.setAttribute('data-mce-bogus', '1');\n      return br;\n    };\n    var insertBlock = function (blockName, node, before) {\n      var doc = node.ownerDocument;\n      var blockNode = doc.createElement(blockName);\n      blockNode.setAttribute('data-mce-caret', before ? 'before' : 'after');\n      blockNode.setAttribute('data-mce-bogus', 'all');\n      blockNode.appendChild(createBogusBr());\n      var parentNode = node.parentNode;\n      if (!before) {\n        if (node.nextSibling) {\n          parentNode.insertBefore(blockNode, node.nextSibling);\n        } else {\n          parentNode.appendChild(blockNode);\n        }\n      } else {\n        parentNode.insertBefore(blockNode, node);\n      }\n      return blockNode;\n    };\n    var startsWithCaretContainer = function (node) {\n      return isText$2(node) && node.data[0] === ZWSP;\n    };\n    var endsWithCaretContainer = function (node) {\n      return isText$2(node) && node.data[node.data.length - 1] === ZWSP;\n    };\n    var trimBogusBr = function (elm) {\n      var brs = elm.getElementsByTagName('br');\n      var lastBr = brs[brs.length - 1];\n      if (isBogus(lastBr)) {\n        lastBr.parentNode.removeChild(lastBr);\n      }\n    };\n    var showCaretContainerBlock = function (caretContainer) {\n      if (caretContainer && caretContainer.hasAttribute('data-mce-caret')) {\n        trimBogusBr(caretContainer);\n        caretContainer.removeAttribute('data-mce-caret');\n        caretContainer.removeAttribute('data-mce-bogus');\n        caretContainer.removeAttribute('style');\n        caretContainer.removeAttribute('_moz_abspos');\n        return caretContainer;\n      }\n      return null;\n    };\n    var isRangeInCaretContainerBlock = function (range) {\n      return isCaretContainerBlock(range.startContainer);\n    };\n\n    var isContentEditableTrue$1 = isContentEditableTrue;\n    var isContentEditableFalse$1 = isContentEditableFalse;\n    var isBr$2 = isBr;\n    var isText$3 = isText$1;\n    var isInvalidTextElement = matchNodeNames([\n      'script',\n      'style',\n      'textarea'\n    ]);\n    var isAtomicInline = matchNodeNames([\n      'img',\n      'input',\n      'textarea',\n      'hr',\n      'iframe',\n      'video',\n      'audio',\n      'object',\n      'embed'\n    ]);\n    var isTable$2 = matchNodeNames(['table']);\n    var isCaretContainer$1 = isCaretContainer;\n    var isCaretCandidate = function (node) {\n      if (isCaretContainer$1(node)) {\n        return false;\n      }\n      if (isText$3(node)) {\n        return !isInvalidTextElement(node.parentNode);\n      }\n      return isAtomicInline(node) || isBr$2(node) || isTable$2(node) || isNonUiContentEditableFalse(node);\n    };\n    var isUnselectable = function (node) {\n      return isElement$1(node) && node.getAttribute('unselectable') === 'true';\n    };\n    var isNonUiContentEditableFalse = function (node) {\n      return isUnselectable(node) === false && isContentEditableFalse$1(node);\n    };\n    var isInEditable = function (node, root) {\n      for (node = node.parentNode; node && node !== root; node = node.parentNode) {\n        if (isNonUiContentEditableFalse(node)) {\n          return false;\n        }\n        if (isContentEditableTrue$1(node)) {\n          return true;\n        }\n      }\n      return true;\n    };\n    var isAtomicContentEditableFalse = function (node) {\n      if (!isNonUiContentEditableFalse(node)) {\n        return false;\n      }\n      return foldl(from$1(node.getElementsByTagName('*')), function (result, elm) {\n        return result || isContentEditableTrue$1(elm);\n      }, false) !== true;\n    };\n    var isAtomic = function (node) {\n      return isAtomicInline(node) || isAtomicContentEditableFalse(node);\n    };\n    var isEditableCaretCandidate = function (node, root) {\n      return isCaretCandidate(node) && isInEditable(node, root);\n    };\n\n    var whiteSpaceRegExp$1 = /^[ \\t\\r\\n]*$/;\n    var isWhitespaceText = function (text) {\n      return whiteSpaceRegExp$1.test(text);\n    };\n\n    var hasWhitespacePreserveParent = function (node, rootNode) {\n      var rootElement = SugarElement.fromDom(rootNode);\n      var startNode = SugarElement.fromDom(node);\n      return ancestor$2(startNode, 'pre,code', curry(eq$2, rootElement));\n    };\n    var isWhitespace = function (node, rootNode) {\n      return isText$1(node) && isWhitespaceText(node.data) && hasWhitespacePreserveParent(node, rootNode) === false;\n    };\n    var isNamedAnchor = function (node) {\n      return isElement$1(node) && node.nodeName === 'A' && !node.hasAttribute('href') && (node.hasAttribute('name') || node.hasAttribute('id'));\n    };\n    var isContent = function (node, rootNode) {\n      return isCaretCandidate(node) && isWhitespace(node, rootNode) === false || isNamedAnchor(node) || isBookmark(node);\n    };\n    var isBookmark = hasAttribute('data-mce-bookmark');\n    var isBogus$1 = hasAttribute('data-mce-bogus');\n    var isBogusAll$1 = hasAttributeValue('data-mce-bogus', 'all');\n    var isEmptyNode = function (targetNode, skipBogus) {\n      var node, brCount = 0;\n      if (isContent(targetNode, targetNode)) {\n        return false;\n      } else {\n        node = targetNode.firstChild;\n        if (!node) {\n          return true;\n        }\n        var walker = new DomTreeWalker(node, targetNode);\n        do {\n          if (skipBogus) {\n            if (isBogusAll$1(node)) {\n              node = walker.next(true);\n              continue;\n            }\n            if (isBogus$1(node)) {\n              node = walker.next();\n              continue;\n            }\n          }\n          if (isBr(node)) {\n            brCount++;\n            node = walker.next();\n            continue;\n          }\n          if (isContent(node, targetNode)) {\n            return false;\n          }\n          node = walker.next();\n        } while (node);\n        return brCount <= 1;\n      }\n    };\n    var isEmpty = function (elm, skipBogus) {\n      if (skipBogus === void 0) {\n        skipBogus = true;\n      }\n      return isEmptyNode(elm.dom, skipBogus);\n    };\n\n    var isSpan = function (node) {\n      return node.nodeName.toLowerCase() === 'span';\n    };\n    var isInlineContent = function (node, root) {\n      return isNonNullable(node) && (isContent(node, root) || isInline(SugarElement.fromDom(node)));\n    };\n    var surroundedByInlineContent = function (node, root) {\n      var prev = new DomTreeWalker(node, root).prev(false);\n      var next = new DomTreeWalker(node, root).next(false);\n      var prevIsInline = isUndefined(prev) || isInlineContent(prev, root);\n      var nextIsInline = isUndefined(next) || isInlineContent(next, root);\n      return prevIsInline && nextIsInline;\n    };\n    var isBookmarkNode = function (node) {\n      return isSpan(node) && node.getAttribute('data-mce-type') === 'bookmark';\n    };\n    var isKeepTextNode = function (node, root) {\n      return isText$1(node) && node.data.length > 0 && surroundedByInlineContent(node, root);\n    };\n    var isKeepElement = function (node) {\n      return isElement$1(node) ? node.childNodes.length > 0 : false;\n    };\n    var isDocument$2 = function (node) {\n      return isDocumentFragment$1(node) || isDocument$1(node);\n    };\n    var trimNode = function (dom, node, root) {\n      var rootNode = root || node;\n      if (isElement$1(node) && isBookmarkNode(node)) {\n        return node;\n      }\n      var children = node.childNodes;\n      for (var i = children.length - 1; i >= 0; i--) {\n        trimNode(dom, children[i], rootNode);\n      }\n      if (isElement$1(node)) {\n        var currentChildren = node.childNodes;\n        if (currentChildren.length === 1 && isBookmarkNode(currentChildren[0])) {\n          node.parentNode.insertBefore(currentChildren[0], node);\n        }\n      }\n      if (!isDocument$2(node) && !isContent(node, rootNode) && !isKeepElement(node) && !isKeepTextNode(node, rootNode)) {\n        dom.remove(node);\n      }\n      return node;\n    };\n\n    var makeMap$1 = Tools.makeMap;\n    var attrsCharsRegExp = /[&<>\\\"\\u0060\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\n    var textCharsRegExp = /[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\n    var rawCharsRegExp = /[<>&\\\"\\']/g;\n    var entityRegExp = /&#([a-z0-9]+);?|&([a-z0-9]+);/gi;\n    var asciiMap = {\n      128: '\\u20AC',\n      130: '\\u201A',\n      131: '\\u0192',\n      132: '\\u201E',\n      133: '\\u2026',\n      134: '\\u2020',\n      135: '\\u2021',\n      136: '\\u02c6',\n      137: '\\u2030',\n      138: '\\u0160',\n      139: '\\u2039',\n      140: '\\u0152',\n      142: '\\u017d',\n      145: '\\u2018',\n      146: '\\u2019',\n      147: '\\u201C',\n      148: '\\u201D',\n      149: '\\u2022',\n      150: '\\u2013',\n      151: '\\u2014',\n      152: '\\u02DC',\n      153: '\\u2122',\n      154: '\\u0161',\n      155: '\\u203A',\n      156: '\\u0153',\n      158: '\\u017e',\n      159: '\\u0178'\n    };\n    var baseEntities = {\n      '\"': '&quot;',\n      '\\'': '&#39;',\n      '<': '&lt;',\n      '>': '&gt;',\n      '&': '&amp;',\n      '`': '&#96;'\n    };\n    var reverseEntities = {\n      '&lt;': '<',\n      '&gt;': '>',\n      '&amp;': '&',\n      '&quot;': '\"',\n      '&apos;': '\\''\n    };\n    var nativeDecode = function (text) {\n      var elm = SugarElement.fromTag('div').dom;\n      elm.innerHTML = text;\n      return elm.textContent || elm.innerText || text;\n    };\n    var buildEntitiesLookup = function (items, radix) {\n      var i, chr, entity;\n      var lookup = {};\n      if (items) {\n        items = items.split(',');\n        radix = radix || 10;\n        for (i = 0; i < items.length; i += 2) {\n          chr = String.fromCharCode(parseInt(items[i], radix));\n          if (!baseEntities[chr]) {\n            entity = '&' + items[i + 1] + ';';\n            lookup[chr] = entity;\n            lookup[entity] = chr;\n          }\n        }\n        return lookup;\n      }\n    };\n    var namedEntities = buildEntitiesLookup('50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' + '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' + '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' + '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' + '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' + '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' + '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' + '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' + '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' + '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' + 'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' + 'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' + 't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' + 'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' + 'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' + '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' + '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' + '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' + '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' + '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' + 'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' + 'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' + 'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' + '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' + '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\n    var encodeRaw = function (text, attr) {\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        return baseEntities[chr] || chr;\n      });\n    };\n    var encodeAllRaw = function (text) {\n      return ('' + text).replace(rawCharsRegExp, function (chr) {\n        return baseEntities[chr] || chr;\n      });\n    };\n    var encodeNumeric = function (text, attr) {\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        if (chr.length > 1) {\n          return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\n        }\n        return baseEntities[chr] || '&#' + chr.charCodeAt(0) + ';';\n      });\n    };\n    var encodeNamed = function (text, attr, entities) {\n      entities = entities || namedEntities;\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        return baseEntities[chr] || entities[chr] || chr;\n      });\n    };\n    var getEncodeFunc = function (name, entities) {\n      var entitiesMap = buildEntitiesLookup(entities) || namedEntities;\n      var encodeNamedAndNumeric = function (text, attr) {\n        return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n          if (baseEntities[chr] !== undefined) {\n            return baseEntities[chr];\n          }\n          if (entitiesMap[chr] !== undefined) {\n            return entitiesMap[chr];\n          }\n          if (chr.length > 1) {\n            return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\n          }\n          return '&#' + chr.charCodeAt(0) + ';';\n        });\n      };\n      var encodeCustomNamed = function (text, attr) {\n        return encodeNamed(text, attr, entitiesMap);\n      };\n      var nameMap = makeMap$1(name.replace(/\\+/g, ','));\n      if (nameMap.named && nameMap.numeric) {\n        return encodeNamedAndNumeric;\n      }\n      if (nameMap.named) {\n        if (entities) {\n          return encodeCustomNamed;\n        }\n        return encodeNamed;\n      }\n      if (nameMap.numeric) {\n        return encodeNumeric;\n      }\n      return encodeRaw;\n    };\n    var decode = function (text) {\n      return text.replace(entityRegExp, function (all, numeric) {\n        if (numeric) {\n          if (numeric.charAt(0).toLowerCase() === 'x') {\n            numeric = parseInt(numeric.substr(1), 16);\n          } else {\n            numeric = parseInt(numeric, 10);\n          }\n          if (numeric > 65535) {\n            numeric -= 65536;\n            return String.fromCharCode(55296 + (numeric >> 10), 56320 + (numeric & 1023));\n          }\n          return asciiMap[numeric] || String.fromCharCode(numeric);\n        }\n        return reverseEntities[all] || namedEntities[all] || nativeDecode(all);\n      });\n    };\n    var Entities = {\n      encodeRaw: encodeRaw,\n      encodeAllRaw: encodeAllRaw,\n      encodeNumeric: encodeNumeric,\n      encodeNamed: encodeNamed,\n      getEncodeFunc: getEncodeFunc,\n      decode: decode\n    };\n\n    var mapCache = {}, dummyObj = {};\n    var makeMap$2 = Tools.makeMap, each$3 = Tools.each, extend$1 = Tools.extend, explode$1 = Tools.explode, inArray = Tools.inArray;\n    var split = function (items, delim) {\n      items = Tools.trim(items);\n      return items ? items.split(delim || ' ') : [];\n    };\n    var compileSchema = function (type) {\n      var schema = {};\n      var globalAttributes, blockContent;\n      var phrasingContent, flowContent, html4BlockContent, html4PhrasingContent;\n      var add = function (name, attributes, children) {\n        var ni, attributesOrder, element;\n        var arrayToMap = function (array, obj) {\n          var map = {};\n          var i, l;\n          for (i = 0, l = array.length; i < l; i++) {\n            map[array[i]] = obj || {};\n          }\n          return map;\n        };\n        children = children || [];\n        attributes = attributes || '';\n        if (typeof children === 'string') {\n          children = split(children);\n        }\n        var names = split(name);\n        ni = names.length;\n        while (ni--) {\n          attributesOrder = split([\n            globalAttributes,\n            attributes\n          ].join(' '));\n          element = {\n            attributes: arrayToMap(attributesOrder),\n            attributesOrder: attributesOrder,\n            children: arrayToMap(children, dummyObj)\n          };\n          schema[names[ni]] = element;\n        }\n      };\n      var addAttrs = function (name, attributes) {\n        var ni, schemaItem, i, l;\n        var names = split(name);\n        ni = names.length;\n        var attrs = split(attributes);\n        while (ni--) {\n          schemaItem = schema[names[ni]];\n          for (i = 0, l = attrs.length; i < l; i++) {\n            schemaItem.attributes[attrs[i]] = {};\n            schemaItem.attributesOrder.push(attrs[i]);\n          }\n        }\n      };\n      if (mapCache[type]) {\n        return mapCache[type];\n      }\n      globalAttributes = 'id accesskey class dir lang style tabindex title role';\n      blockContent = 'address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul';\n      phrasingContent = 'a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd ' + 'label map noscript object q s samp script select small span strong sub sup ' + 'textarea u var #text #comment';\n      if (type !== 'html4') {\n        globalAttributes += ' contenteditable contextmenu draggable dropzone ' + 'hidden spellcheck translate';\n        blockContent += ' article aside details dialog figure main header footer hgroup section nav';\n        phrasingContent += ' audio canvas command datalist mark meter output picture ' + 'progress time wbr video ruby bdi keygen';\n      }\n      if (type !== 'html5-strict') {\n        globalAttributes += ' xml:lang';\n        html4PhrasingContent = 'acronym applet basefont big font strike tt';\n        phrasingContent = [\n          phrasingContent,\n          html4PhrasingContent\n        ].join(' ');\n        each$3(split(html4PhrasingContent), function (name) {\n          add(name, '', phrasingContent);\n        });\n        html4BlockContent = 'center dir isindex noframes';\n        blockContent = [\n          blockContent,\n          html4BlockContent\n        ].join(' ');\n        flowContent = [\n          blockContent,\n          phrasingContent\n        ].join(' ');\n        each$3(split(html4BlockContent), function (name) {\n          add(name, '', flowContent);\n        });\n      }\n      flowContent = flowContent || [\n        blockContent,\n        phrasingContent\n      ].join(' ');\n      add('html', 'manifest', 'head body');\n      add('head', '', 'base command link meta noscript script style title');\n      add('title hr noscript br');\n      add('base', 'href target');\n      add('link', 'href rel media hreflang type sizes hreflang');\n      add('meta', 'name http-equiv content charset');\n      add('style', 'media type scoped');\n      add('script', 'src async defer type charset');\n      add('body', 'onafterprint onbeforeprint onbeforeunload onblur onerror onfocus ' + 'onhashchange onload onmessage onoffline ononline onpagehide onpageshow ' + 'onpopstate onresize onscroll onstorage onunload', flowContent);\n      add('address dt dd div caption', '', flowContent);\n      add('h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn', '', phrasingContent);\n      add('blockquote', 'cite', flowContent);\n      add('ol', 'reversed start type', 'li');\n      add('ul', '', 'li');\n      add('li', 'value', flowContent);\n      add('dl', '', 'dt dd');\n      add('a', 'href target rel media hreflang type', phrasingContent);\n      add('q', 'cite', phrasingContent);\n      add('ins del', 'cite datetime', flowContent);\n      add('img', 'src sizes srcset alt usemap ismap width height');\n      add('iframe', 'src name width height', flowContent);\n      add('embed', 'src type width height');\n      add('object', 'data type typemustmatch name usemap form width height', [\n        flowContent,\n        'param'\n      ].join(' '));\n      add('param', 'name value');\n      add('map', 'name', [\n        flowContent,\n        'area'\n      ].join(' '));\n      add('area', 'alt coords shape href target rel media hreflang type');\n      add('table', 'border', 'caption colgroup thead tfoot tbody tr' + (type === 'html4' ? ' col' : ''));\n      add('colgroup', 'span', 'col');\n      add('col', 'span');\n      add('tbody thead tfoot', '', 'tr');\n      add('tr', '', 'td th');\n      add('td', 'colspan rowspan headers', flowContent);\n      add('th', 'colspan rowspan headers scope abbr', flowContent);\n      add('form', 'accept-charset action autocomplete enctype method name novalidate target', flowContent);\n      add('fieldset', 'disabled form name', [\n        flowContent,\n        'legend'\n      ].join(' '));\n      add('label', 'form for', phrasingContent);\n      add('input', 'accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate ' + 'formtarget height list max maxlength min multiple name pattern readonly required size src step type value width');\n      add('button', 'disabled form formaction formenctype formmethod formnovalidate formtarget name type value', type === 'html4' ? flowContent : phrasingContent);\n      add('select', 'disabled form multiple name required size', 'option optgroup');\n      add('optgroup', 'disabled label', 'option');\n      add('option', 'disabled label selected value');\n      add('textarea', 'cols dirname disabled form maxlength name readonly required rows wrap');\n      add('menu', 'type label', [\n        flowContent,\n        'li'\n      ].join(' '));\n      add('noscript', '', flowContent);\n      if (type !== 'html4') {\n        add('wbr');\n        add('ruby', '', [\n          phrasingContent,\n          'rt rp'\n        ].join(' '));\n        add('figcaption', '', flowContent);\n        add('mark rt rp summary bdi', '', phrasingContent);\n        add('canvas', 'width height', flowContent);\n        add('video', 'src crossorigin poster preload autoplay mediagroup loop ' + 'muted controls width height buffered', [\n          flowContent,\n          'track source'\n        ].join(' '));\n        add('audio', 'src crossorigin preload autoplay mediagroup loop muted controls ' + 'buffered volume', [\n          flowContent,\n          'track source'\n        ].join(' '));\n        add('picture', '', 'img source');\n        add('source', 'src srcset type media sizes');\n        add('track', 'kind src srclang label default');\n        add('datalist', '', [\n          phrasingContent,\n          'option'\n        ].join(' '));\n        add('article section nav aside main header footer', '', flowContent);\n        add('hgroup', '', 'h1 h2 h3 h4 h5 h6');\n        add('figure', '', [\n          flowContent,\n          'figcaption'\n        ].join(' '));\n        add('time', 'datetime', phrasingContent);\n        add('dialog', 'open', flowContent);\n        add('command', 'type label icon disabled checked radiogroup command');\n        add('output', 'for form name', phrasingContent);\n        add('progress', 'value max', phrasingContent);\n        add('meter', 'value min max low high optimum', phrasingContent);\n        add('details', 'open', [\n          flowContent,\n          'summary'\n        ].join(' '));\n        add('keygen', 'autofocus challenge disabled form keytype name');\n      }\n      if (type !== 'html5-strict') {\n        addAttrs('script', 'language xml:space');\n        addAttrs('style', 'xml:space');\n        addAttrs('object', 'declare classid code codebase codetype archive standby align border hspace vspace');\n        addAttrs('embed', 'align name hspace vspace');\n        addAttrs('param', 'valuetype type');\n        addAttrs('a', 'charset name rev shape coords');\n        addAttrs('br', 'clear');\n        addAttrs('applet', 'codebase archive code object alt name width height align hspace vspace');\n        addAttrs('img', 'name longdesc align border hspace vspace');\n        addAttrs('iframe', 'longdesc frameborder marginwidth marginheight scrolling align');\n        addAttrs('font basefont', 'size color face');\n        addAttrs('input', 'usemap align');\n        addAttrs('select');\n        addAttrs('textarea');\n        addAttrs('h1 h2 h3 h4 h5 h6 div p legend caption', 'align');\n        addAttrs('ul', 'type compact');\n        addAttrs('li', 'type');\n        addAttrs('ol dl menu dir', 'compact');\n        addAttrs('pre', 'width xml:space');\n        addAttrs('hr', 'align noshade size width');\n        addAttrs('isindex', 'prompt');\n        addAttrs('table', 'summary width frame rules cellspacing cellpadding align bgcolor');\n        addAttrs('col', 'width align char charoff valign');\n        addAttrs('colgroup', 'width align char charoff valign');\n        addAttrs('thead', 'align char charoff valign');\n        addAttrs('tr', 'align char charoff valign bgcolor');\n        addAttrs('th', 'axis align char charoff valign nowrap bgcolor width height');\n        addAttrs('form', 'accept');\n        addAttrs('td', 'abbr axis scope align char charoff valign nowrap bgcolor width height');\n        addAttrs('tfoot', 'align char charoff valign');\n        addAttrs('tbody', 'align char charoff valign');\n        addAttrs('area', 'nohref');\n        addAttrs('body', 'background bgcolor text link vlink alink');\n      }\n      if (type !== 'html4') {\n        addAttrs('input button select textarea', 'autofocus');\n        addAttrs('input textarea', 'placeholder');\n        addAttrs('a', 'download');\n        addAttrs('link script img', 'crossorigin');\n        addAttrs('img', 'loading');\n        addAttrs('iframe', 'sandbox seamless allowfullscreen loading');\n      }\n      each$3(split('a form meter progress dfn'), function (name) {\n        if (schema[name]) {\n          delete schema[name].children[name];\n        }\n      });\n      delete schema.caption.children.table;\n      delete schema.script;\n      mapCache[type] = schema;\n      return schema;\n    };\n    var compileElementMap = function (value, mode) {\n      var styles;\n      if (value) {\n        styles = {};\n        if (typeof value === 'string') {\n          value = { '*': value };\n        }\n        each$3(value, function (value, key) {\n          styles[key] = styles[key.toUpperCase()] = mode === 'map' ? makeMap$2(value, /[, ]/) : explode$1(value, /[, ]/);\n        });\n      }\n      return styles;\n    };\n    function Schema(settings) {\n      var elements = {};\n      var children = {};\n      var patternElements = [];\n      var customElementsMap = {}, specialElements = {};\n      var createLookupTable = function (option, defaultValue, extendWith) {\n        var value = settings[option];\n        if (!value) {\n          value = mapCache[option];\n          if (!value) {\n            value = makeMap$2(defaultValue, ' ', makeMap$2(defaultValue.toUpperCase(), ' '));\n            value = extend$1(value, extendWith);\n            mapCache[option] = value;\n          }\n        } else {\n          value = makeMap$2(value, /[, ]/, makeMap$2(value.toUpperCase(), /[, ]/));\n        }\n        return value;\n      };\n      settings = settings || {};\n      var schemaItems = compileSchema(settings.schema);\n      if (settings.verify_html === false) {\n        settings.valid_elements = '*[*]';\n      }\n      var validStyles = compileElementMap(settings.valid_styles);\n      var invalidStyles = compileElementMap(settings.invalid_styles, 'map');\n      var validClasses = compileElementMap(settings.valid_classes, 'map');\n      var whiteSpaceElementsMap = createLookupTable('whitespace_elements', 'pre script noscript style textarea video audio iframe object code');\n      var selfClosingElementsMap = createLookupTable('self_closing_elements', 'colgroup dd dt li option p td tfoot th thead tr');\n      var shortEndedElementsMap = createLookupTable('short_ended_elements', 'area base basefont br col frame hr img input isindex link ' + 'meta param embed source wbr track');\n      var boolAttrMap = createLookupTable('boolean_attributes', 'checked compact declare defer disabled ismap multiple nohref noresize ' + 'noshade nowrap readonly selected autoplay loop controls');\n      var nonEmptyOrMoveCaretBeforeOnEnter = 'td th iframe video audio object script code';\n      var nonEmptyElementsMap = createLookupTable('non_empty_elements', nonEmptyOrMoveCaretBeforeOnEnter + ' pre', shortEndedElementsMap);\n      var moveCaretBeforeOnEnterElementsMap = createLookupTable('move_caret_before_on_enter_elements', nonEmptyOrMoveCaretBeforeOnEnter + ' table', shortEndedElementsMap);\n      var textBlockElementsMap = createLookupTable('text_block_elements', 'h1 h2 h3 h4 h5 h6 p div address pre form ' + 'blockquote center dir fieldset header footer article section hgroup aside main nav figure');\n      var blockElementsMap = createLookupTable('block_elements', 'hr table tbody thead tfoot ' + 'th tr td li ol ul caption dl dt dd noscript menu isindex option ' + 'datalist select optgroup figcaption details summary', textBlockElementsMap);\n      var textInlineElementsMap = createLookupTable('text_inline_elements', 'span strong b em i font strike u var cite ' + 'dfn code mark q sup sub samp');\n      each$3((settings.special || 'script noscript iframe noframes noembed title style textarea xmp').split(' '), function (name) {\n        specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\n      });\n      var patternToRegExp = function (str) {\n        return new RegExp('^' + str.replace(/([?+*])/g, '.$1') + '$');\n      };\n      var addValidElements = function (validElements) {\n        var ei, el, ai, al, matches, element, attr, attrData, elementName, attrName, attrType, attributes, attributesOrder, prefix, outputName, globalAttributes, globalAttributesOrder, value;\n        var elementRuleRegExp = /^([#+\\-])?([^\\[!\\/]+)(?:\\/([^\\[!]+))?(?:(!?)\\[([^\\]]+)])?$/, attrRuleRegExp = /^([!\\-])?(\\w+[\\\\:]:\\w+|[^=:<]+)?(?:([=:<])(.*))?$/, hasPatternsRegExp = /[*?+]/;\n        if (validElements) {\n          var validElementsArr = split(validElements, ',');\n          if (elements['@']) {\n            globalAttributes = elements['@'].attributes;\n            globalAttributesOrder = elements['@'].attributesOrder;\n          }\n          for (ei = 0, el = validElementsArr.length; ei < el; ei++) {\n            matches = elementRuleRegExp.exec(validElementsArr[ei]);\n            if (matches) {\n              prefix = matches[1];\n              elementName = matches[2];\n              outputName = matches[3];\n              attrData = matches[5];\n              attributes = {};\n              attributesOrder = [];\n              element = {\n                attributes: attributes,\n                attributesOrder: attributesOrder\n              };\n              if (prefix === '#') {\n                element.paddEmpty = true;\n              }\n              if (prefix === '-') {\n                element.removeEmpty = true;\n              }\n              if (matches[4] === '!') {\n                element.removeEmptyAttrs = true;\n              }\n              if (globalAttributes) {\n                each$1(globalAttributes, function (value, key) {\n                  attributes[key] = value;\n                });\n                attributesOrder.push.apply(attributesOrder, globalAttributesOrder);\n              }\n              if (attrData) {\n                attrData = split(attrData, '|');\n                for (ai = 0, al = attrData.length; ai < al; ai++) {\n                  matches = attrRuleRegExp.exec(attrData[ai]);\n                  if (matches) {\n                    attr = {};\n                    attrType = matches[1];\n                    attrName = matches[2].replace(/[\\\\:]:/g, ':');\n                    prefix = matches[3];\n                    value = matches[4];\n                    if (attrType === '!') {\n                      element.attributesRequired = element.attributesRequired || [];\n                      element.attributesRequired.push(attrName);\n                      attr.required = true;\n                    }\n                    if (attrType === '-') {\n                      delete attributes[attrName];\n                      attributesOrder.splice(inArray(attributesOrder, attrName), 1);\n                      continue;\n                    }\n                    if (prefix) {\n                      if (prefix === '=') {\n                        element.attributesDefault = element.attributesDefault || [];\n                        element.attributesDefault.push({\n                          name: attrName,\n                          value: value\n                        });\n                        attr.defaultValue = value;\n                      }\n                      if (prefix === ':') {\n                        element.attributesForced = element.attributesForced || [];\n                        element.attributesForced.push({\n                          name: attrName,\n                          value: value\n                        });\n                        attr.forcedValue = value;\n                      }\n                      if (prefix === '<') {\n                        attr.validValues = makeMap$2(value, '?');\n                      }\n                    }\n                    if (hasPatternsRegExp.test(attrName)) {\n                      element.attributePatterns = element.attributePatterns || [];\n                      attr.pattern = patternToRegExp(attrName);\n                      element.attributePatterns.push(attr);\n                    } else {\n                      if (!attributes[attrName]) {\n                        attributesOrder.push(attrName);\n                      }\n                      attributes[attrName] = attr;\n                    }\n                  }\n                }\n              }\n              if (!globalAttributes && elementName === '@') {\n                globalAttributes = attributes;\n                globalAttributesOrder = attributesOrder;\n              }\n              if (outputName) {\n                element.outputName = elementName;\n                elements[outputName] = element;\n              }\n              if (hasPatternsRegExp.test(elementName)) {\n                element.pattern = patternToRegExp(elementName);\n                patternElements.push(element);\n              } else {\n                elements[elementName] = element;\n              }\n            }\n          }\n        }\n      };\n      var setValidElements = function (validElements) {\n        elements = {};\n        patternElements = [];\n        addValidElements(validElements);\n        each$3(schemaItems, function (element, name) {\n          children[name] = element.children;\n        });\n      };\n      var addCustomElements = function (customElements) {\n        var customElementRegExp = /^(~)?(.+)$/;\n        if (customElements) {\n          mapCache.text_block_elements = mapCache.block_elements = null;\n          each$3(split(customElements, ','), function (rule) {\n            var matches = customElementRegExp.exec(rule), inline = matches[1] === '~', cloneName = inline ? 'span' : 'div', name = matches[2];\n            children[name] = children[cloneName];\n            customElementsMap[name] = cloneName;\n            if (!inline) {\n              blockElementsMap[name.toUpperCase()] = {};\n              blockElementsMap[name] = {};\n            }\n            if (!elements[name]) {\n              var customRule = elements[cloneName];\n              customRule = extend$1({}, customRule);\n              delete customRule.removeEmptyAttrs;\n              delete customRule.removeEmpty;\n              elements[name] = customRule;\n            }\n            each$3(children, function (element, elmName) {\n              if (element[cloneName]) {\n                children[elmName] = element = extend$1({}, children[elmName]);\n                element[name] = element[cloneName];\n              }\n            });\n          });\n        }\n      };\n      var addValidChildren = function (validChildren) {\n        var childRuleRegExp = /^([+\\-]?)([A-Za-z0-9_\\-.\\u00b7\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u037d\\u037f-\\u1fff\\u200c-\\u200d\\u203f-\\u2040\\u2070-\\u218f\\u2c00-\\u2fef\\u3001-\\ud7ff\\uf900-\\ufdcf\\ufdf0-\\ufffd]+)\\[([^\\]]+)]$/;\n        mapCache[settings.schema] = null;\n        if (validChildren) {\n          each$3(split(validChildren, ','), function (rule) {\n            var matches = childRuleRegExp.exec(rule);\n            var parent, prefix;\n            if (matches) {\n              prefix = matches[1];\n              if (prefix) {\n                parent = children[matches[2]];\n              } else {\n                parent = children[matches[2]] = { '#comment': {} };\n              }\n              parent = children[matches[2]];\n              each$3(split(matches[3], '|'), function (child) {\n                if (prefix === '-') {\n                  delete parent[child];\n                } else {\n                  parent[child] = {};\n                }\n              });\n            }\n          });\n        }\n      };\n      var getElementRule = function (name) {\n        var element = elements[name], i;\n        if (element) {\n          return element;\n        }\n        i = patternElements.length;\n        while (i--) {\n          element = patternElements[i];\n          if (element.pattern.test(name)) {\n            return element;\n          }\n        }\n      };\n      if (!settings.valid_elements) {\n        each$3(schemaItems, function (element, name) {\n          elements[name] = {\n            attributes: element.attributes,\n            attributesOrder: element.attributesOrder\n          };\n          children[name] = element.children;\n        });\n        if (settings.schema !== 'html5') {\n          each$3(split('strong/b em/i'), function (item) {\n            var items = split(item, '/');\n            elements[items[1]].outputName = items[0];\n          });\n        }\n        each$3(split('ol ul sub sup blockquote span font a table tbody strong em b i'), function (name) {\n          if (elements[name]) {\n            elements[name].removeEmpty = true;\n          }\n        });\n        each$3(split('p h1 h2 h3 h4 h5 h6 th td pre div address caption li'), function (name) {\n          elements[name].paddEmpty = true;\n        });\n        each$3(split('span'), function (name) {\n          elements[name].removeEmptyAttrs = true;\n        });\n      } else {\n        setValidElements(settings.valid_elements);\n      }\n      addCustomElements(settings.custom_elements);\n      addValidChildren(settings.valid_children);\n      addValidElements(settings.extended_valid_elements);\n      addValidChildren('+ol[ul|ol],+ul[ul|ol]');\n      each$3({\n        dd: 'dl',\n        dt: 'dl',\n        li: 'ul ol',\n        td: 'tr',\n        th: 'tr',\n        tr: 'tbody thead tfoot',\n        tbody: 'table',\n        thead: 'table',\n        tfoot: 'table',\n        legend: 'fieldset',\n        area: 'map',\n        param: 'video audio object'\n      }, function (parents, item) {\n        if (elements[item]) {\n          elements[item].parentsRequired = split(parents);\n        }\n      });\n      if (settings.invalid_elements) {\n        each$3(explode$1(settings.invalid_elements), function (item) {\n          if (elements[item]) {\n            delete elements[item];\n          }\n        });\n      }\n      if (!getElementRule('span')) {\n        addValidElements('span[!data-mce-type|*]');\n      }\n      var getValidStyles = function () {\n        return validStyles;\n      };\n      var getInvalidStyles = function () {\n        return invalidStyles;\n      };\n      var getValidClasses = function () {\n        return validClasses;\n      };\n      var getBoolAttrs = function () {\n        return boolAttrMap;\n      };\n      var getBlockElements = function () {\n        return blockElementsMap;\n      };\n      var getTextBlockElements = function () {\n        return textBlockElementsMap;\n      };\n      var getTextInlineElements = function () {\n        return textInlineElementsMap;\n      };\n      var getShortEndedElements = function () {\n        return shortEndedElementsMap;\n      };\n      var getSelfClosingElements = function () {\n        return selfClosingElementsMap;\n      };\n      var getNonEmptyElements = function () {\n        return nonEmptyElementsMap;\n      };\n      var getMoveCaretBeforeOnEnterElements = function () {\n        return moveCaretBeforeOnEnterElementsMap;\n      };\n      var getWhiteSpaceElements = function () {\n        return whiteSpaceElementsMap;\n      };\n      var getSpecialElements = function () {\n        return specialElements;\n      };\n      var isValidChild = function (name, child) {\n        var parent = children[name.toLowerCase()];\n        return !!(parent && parent[child.toLowerCase()]);\n      };\n      var isValid = function (name, attr) {\n        var attrPatterns, i;\n        var rule = getElementRule(name);\n        if (rule) {\n          if (attr) {\n            if (rule.attributes[attr]) {\n              return true;\n            }\n            attrPatterns = rule.attributePatterns;\n            if (attrPatterns) {\n              i = attrPatterns.length;\n              while (i--) {\n                if (attrPatterns[i].pattern.test(name)) {\n                  return true;\n                }\n              }\n            }\n          } else {\n            return true;\n          }\n        }\n        return false;\n      };\n      var getCustomElements = function () {\n        return customElementsMap;\n      };\n      return {\n        children: children,\n        elements: elements,\n        getValidStyles: getValidStyles,\n        getValidClasses: getValidClasses,\n        getBlockElements: getBlockElements,\n        getInvalidStyles: getInvalidStyles,\n        getShortEndedElements: getShortEndedElements,\n        getTextBlockElements: getTextBlockElements,\n        getTextInlineElements: getTextInlineElements,\n        getBoolAttrs: getBoolAttrs,\n        getElementRule: getElementRule,\n        getSelfClosingElements: getSelfClosingElements,\n        getNonEmptyElements: getNonEmptyElements,\n        getMoveCaretBeforeOnEnterElements: getMoveCaretBeforeOnEnterElements,\n        getWhiteSpaceElements: getWhiteSpaceElements,\n        getSpecialElements: getSpecialElements,\n        isValidChild: isValidChild,\n        isValid: isValid,\n        getCustomElements: getCustomElements,\n        addValidElements: addValidElements,\n        setValidElements: setValidElements,\n        addCustomElements: addCustomElements,\n        addValidChildren: addValidChildren\n      };\n    }\n\n    var toHex = function (match, r, g, b) {\n      var hex = function (val) {\n        val = parseInt(val, 10).toString(16);\n        return val.length > 1 ? val : '0' + val;\n      };\n      return '#' + hex(r) + hex(g) + hex(b);\n    };\n    var Styles = function (settings, schema) {\n      var rgbRegExp = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi;\n      var urlOrStrRegExp = /(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi;\n      var styleRegExp = /\\s*([^:]+):\\s*([^;]+);?/g;\n      var trimRightRegExp = /\\s+$/;\n      var i;\n      var encodingLookup = {};\n      var validStyles;\n      var invalidStyles;\n      var invisibleChar = zeroWidth;\n      settings = settings || {};\n      if (schema) {\n        validStyles = schema.getValidStyles();\n        invalidStyles = schema.getInvalidStyles();\n      }\n      var encodingItems = ('\\\\\" \\\\\\' \\\\; \\\\: ; : ' + invisibleChar).split(' ');\n      for (i = 0; i < encodingItems.length; i++) {\n        encodingLookup[encodingItems[i]] = invisibleChar + i;\n        encodingLookup[invisibleChar + i] = encodingItems[i];\n      }\n      return {\n        toHex: function (color) {\n          return color.replace(rgbRegExp, toHex);\n        },\n        parse: function (css) {\n          var styles = {};\n          var matches, name, value, isEncoded;\n          var urlConverter = settings.url_converter;\n          var urlConverterScope = settings.url_converter_scope || this;\n          var compress = function (prefix, suffix, noJoin) {\n            var top = styles[prefix + '-top' + suffix];\n            if (!top) {\n              return;\n            }\n            var right = styles[prefix + '-right' + suffix];\n            if (!right) {\n              return;\n            }\n            var bottom = styles[prefix + '-bottom' + suffix];\n            if (!bottom) {\n              return;\n            }\n            var left = styles[prefix + '-left' + suffix];\n            if (!left) {\n              return;\n            }\n            var box = [\n              top,\n              right,\n              bottom,\n              left\n            ];\n            i = box.length - 1;\n            while (i--) {\n              if (box[i] !== box[i + 1]) {\n                break;\n              }\n            }\n            if (i > -1 && noJoin) {\n              return;\n            }\n            styles[prefix + suffix] = i === -1 ? box[0] : box.join(' ');\n            delete styles[prefix + '-top' + suffix];\n            delete styles[prefix + '-right' + suffix];\n            delete styles[prefix + '-bottom' + suffix];\n            delete styles[prefix + '-left' + suffix];\n          };\n          var canCompress = function (key) {\n            var value = styles[key], i;\n            if (!value) {\n              return;\n            }\n            value = value.split(' ');\n            i = value.length;\n            while (i--) {\n              if (value[i] !== value[0]) {\n                return false;\n              }\n            }\n            styles[key] = value[0];\n            return true;\n          };\n          var compress2 = function (target, a, b, c) {\n            if (!canCompress(a)) {\n              return;\n            }\n            if (!canCompress(b)) {\n              return;\n            }\n            if (!canCompress(c)) {\n              return;\n            }\n            styles[target] = styles[a] + ' ' + styles[b] + ' ' + styles[c];\n            delete styles[a];\n            delete styles[b];\n            delete styles[c];\n          };\n          var encode = function (str) {\n            isEncoded = true;\n            return encodingLookup[str];\n          };\n          var decode = function (str, keepSlashes) {\n            if (isEncoded) {\n              str = str.replace(/\\uFEFF[0-9]/g, function (str) {\n                return encodingLookup[str];\n              });\n            }\n            if (!keepSlashes) {\n              str = str.replace(/\\\\([\\'\\\";:])/g, '$1');\n            }\n            return str;\n          };\n          var decodeSingleHexSequence = function (escSeq) {\n            return String.fromCharCode(parseInt(escSeq.slice(1), 16));\n          };\n          var decodeHexSequences = function (value) {\n            return value.replace(/\\\\[0-9a-f]+/gi, decodeSingleHexSequence);\n          };\n          var processUrl = function (match, url, url2, url3, str, str2) {\n            str = str || str2;\n            if (str) {\n              str = decode(str);\n              return '\\'' + str.replace(/\\'/g, '\\\\\\'') + '\\'';\n            }\n            url = decode(url || url2 || url3);\n            if (!settings.allow_script_urls) {\n              var scriptUrl = url.replace(/[\\s\\r\\n]+/g, '');\n              if (/(java|vb)script:/i.test(scriptUrl)) {\n                return '';\n              }\n              if (!settings.allow_svg_data_urls && /^data:image\\/svg/i.test(scriptUrl)) {\n                return '';\n              }\n            }\n            if (urlConverter) {\n              url = urlConverter.call(urlConverterScope, url, 'style');\n            }\n            return 'url(\\'' + url.replace(/\\'/g, '\\\\\\'') + '\\')';\n          };\n          if (css) {\n            css = css.replace(/[\\u0000-\\u001F]/g, '');\n            css = css.replace(/\\\\[\\\"\\';:\\uFEFF]/g, encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g, function (str) {\n              return str.replace(/[;:]/g, encode);\n            });\n            while (matches = styleRegExp.exec(css)) {\n              styleRegExp.lastIndex = matches.index + matches[0].length;\n              name = matches[1].replace(trimRightRegExp, '').toLowerCase();\n              value = matches[2].replace(trimRightRegExp, '');\n              if (name && value) {\n                name = decodeHexSequences(name);\n                value = decodeHexSequences(value);\n                if (name.indexOf(invisibleChar) !== -1 || name.indexOf('\"') !== -1) {\n                  continue;\n                }\n                if (!settings.allow_script_urls && (name === 'behavior' || /expression\\s*\\(|\\/\\*|\\*\\//.test(value))) {\n                  continue;\n                }\n                if (name === 'font-weight' && value === '700') {\n                  value = 'bold';\n                } else if (name === 'color' || name === 'background-color') {\n                  value = value.toLowerCase();\n                }\n                value = value.replace(rgbRegExp, toHex);\n                value = value.replace(urlOrStrRegExp, processUrl);\n                styles[name] = isEncoded ? decode(value, true) : value;\n              }\n            }\n            compress('border', '', true);\n            compress('border', '-width');\n            compress('border', '-color');\n            compress('border', '-style');\n            compress('padding', '');\n            compress('margin', '');\n            compress2('border', 'border-width', 'border-style', 'border-color');\n            if (styles.border === 'medium none') {\n              delete styles.border;\n            }\n            if (styles['border-image'] === 'none') {\n              delete styles['border-image'];\n            }\n          }\n          return styles;\n        },\n        serialize: function (styles, elementName) {\n          var css = '';\n          var serializeStyles = function (name) {\n            var value;\n            var styleList = validStyles[name];\n            if (styleList) {\n              for (var i_1 = 0, l = styleList.length; i_1 < l; i_1++) {\n                name = styleList[i_1];\n                value = styles[name];\n                if (value) {\n                  css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n                }\n              }\n            }\n          };\n          var isValid = function (name, elementName) {\n            var styleMap = invalidStyles['*'];\n            if (styleMap && styleMap[name]) {\n              return false;\n            }\n            styleMap = invalidStyles[elementName];\n            return !(styleMap && styleMap[name]);\n          };\n          if (elementName && validStyles) {\n            serializeStyles('*');\n            serializeStyles(elementName);\n          } else {\n            each$1(styles, function (value, name) {\n              if (value && (!invalidStyles || isValid(name, elementName))) {\n                css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n              }\n            });\n          }\n          return css;\n        }\n      };\n    };\n\n    var eventExpandoPrefix = 'mce-data-';\n    var mouseEventRe = /^(?:mouse|contextmenu)|click/;\n    var deprecated = {\n      keyLocation: 1,\n      layerX: 1,\n      layerY: 1,\n      returnValue: 1,\n      webkitMovementX: 1,\n      webkitMovementY: 1,\n      keyIdentifier: 1,\n      mozPressure: 1\n    };\n    var hasIsDefaultPrevented = function (event) {\n      return event.isDefaultPrevented === returnTrue || event.isDefaultPrevented === returnFalse;\n    };\n    var returnFalse = function () {\n      return false;\n    };\n    var returnTrue = function () {\n      return true;\n    };\n    var addEvent = function (target, name, callback, capture) {\n      if (target.addEventListener) {\n        target.addEventListener(name, callback, capture || false);\n      } else if (target.attachEvent) {\n        target.attachEvent('on' + name, callback);\n      }\n    };\n    var removeEvent = function (target, name, callback, capture) {\n      if (target.removeEventListener) {\n        target.removeEventListener(name, callback, capture || false);\n      } else if (target.detachEvent) {\n        target.detachEvent('on' + name, callback);\n      }\n    };\n    var isMouseEvent = function (event) {\n      return mouseEventRe.test(event.type);\n    };\n    var fix = function (originalEvent, data) {\n      var name;\n      var event = data || {};\n      for (name in originalEvent) {\n        if (!deprecated[name]) {\n          event[name] = originalEvent[name];\n        }\n      }\n      if (!event.target) {\n        event.target = event.srcElement || document;\n      }\n      if (event.composedPath) {\n        event.composedPath = function () {\n          return originalEvent.composedPath();\n        };\n      }\n      if (originalEvent && isMouseEvent(originalEvent) && originalEvent.pageX === undefined && originalEvent.clientX !== undefined) {\n        var eventDoc = event.target.ownerDocument || document;\n        var doc = eventDoc.documentElement;\n        var body = eventDoc.body;\n        event.pageX = originalEvent.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);\n        event.pageY = originalEvent.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0);\n      }\n      event.preventDefault = function () {\n        event.isDefaultPrevented = returnTrue;\n        if (originalEvent) {\n          if (originalEvent.preventDefault) {\n            originalEvent.preventDefault();\n          } else {\n            originalEvent.returnValue = false;\n          }\n        }\n      };\n      event.stopPropagation = function () {\n        event.isPropagationStopped = returnTrue;\n        if (originalEvent) {\n          if (originalEvent.stopPropagation) {\n            originalEvent.stopPropagation();\n          } else {\n            originalEvent.cancelBubble = true;\n          }\n        }\n      };\n      event.stopImmediatePropagation = function () {\n        event.isImmediatePropagationStopped = returnTrue;\n        event.stopPropagation();\n      };\n      if (hasIsDefaultPrevented(event) === false) {\n        event.isDefaultPrevented = returnFalse;\n        event.isPropagationStopped = returnFalse;\n        event.isImmediatePropagationStopped = returnFalse;\n      }\n      if (typeof event.metaKey === 'undefined') {\n        event.metaKey = false;\n      }\n      return event;\n    };\n    var bindOnReady = function (win, callback, eventUtils) {\n      var doc = win.document, event = { type: 'ready' };\n      if (eventUtils.domLoaded) {\n        callback(event);\n        return;\n      }\n      var isDocReady = function () {\n        return doc.readyState === 'complete' || doc.readyState === 'interactive' && doc.body;\n      };\n      var readyHandler = function () {\n        removeEvent(win, 'DOMContentLoaded', readyHandler);\n        removeEvent(win, 'load', readyHandler);\n        if (!eventUtils.domLoaded) {\n          eventUtils.domLoaded = true;\n          callback(event);\n        }\n        win = null;\n      };\n      if (isDocReady()) {\n        readyHandler();\n      } else {\n        addEvent(win, 'DOMContentLoaded', readyHandler);\n      }\n      if (!eventUtils.domLoaded) {\n        addEvent(win, 'load', readyHandler);\n      }\n    };\n    var EventUtils = function () {\n      function EventUtils() {\n        this.domLoaded = false;\n        this.events = {};\n        this.count = 1;\n        this.expando = eventExpandoPrefix + (+new Date()).toString(32);\n        this.hasMouseEnterLeave = 'onmouseenter' in document.documentElement;\n        this.hasFocusIn = 'onfocusin' in document.documentElement;\n        this.count = 1;\n      }\n      EventUtils.prototype.bind = function (target, names, callback, scope) {\n        var self = this;\n        var id, callbackList, i, name, fakeName, nativeHandler, capture;\n        var win = window;\n        var defaultNativeHandler = function (evt) {\n          self.executeHandlers(fix(evt || win.event), id);\n        };\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return;\n        }\n        if (!target[self.expando]) {\n          id = self.count++;\n          target[self.expando] = id;\n          self.events[id] = {};\n        } else {\n          id = target[self.expando];\n        }\n        scope = scope || target;\n        var namesList = names.split(' ');\n        i = namesList.length;\n        while (i--) {\n          name = namesList[i];\n          nativeHandler = defaultNativeHandler;\n          fakeName = capture = false;\n          if (name === 'DOMContentLoaded') {\n            name = 'ready';\n          }\n          if (self.domLoaded && name === 'ready' && target.readyState === 'complete') {\n            callback.call(scope, fix({ type: name }));\n            continue;\n          }\n          if (!self.hasMouseEnterLeave) {\n            fakeName = self.mouseEnterLeave[name];\n            if (fakeName) {\n              nativeHandler = function (evt) {\n                var current = evt.currentTarget;\n                var related = evt.relatedTarget;\n                if (related && current.contains) {\n                  related = current.contains(related);\n                } else {\n                  while (related && related !== current) {\n                    related = related.parentNode;\n                  }\n                }\n                if (!related) {\n                  evt = fix(evt || win.event);\n                  evt.type = evt.type === 'mouseout' ? 'mouseleave' : 'mouseenter';\n                  evt.target = current;\n                  self.executeHandlers(evt, id);\n                }\n              };\n            }\n          }\n          if (!self.hasFocusIn && (name === 'focusin' || name === 'focusout')) {\n            capture = true;\n            fakeName = name === 'focusin' ? 'focus' : 'blur';\n            nativeHandler = function (evt) {\n              evt = fix(evt || win.event);\n              evt.type = evt.type === 'focus' ? 'focusin' : 'focusout';\n              self.executeHandlers(evt, id);\n            };\n          }\n          callbackList = self.events[id][name];\n          if (!callbackList) {\n            self.events[id][name] = callbackList = [{\n                func: callback,\n                scope: scope\n              }];\n            callbackList.fakeName = fakeName;\n            callbackList.capture = capture;\n            callbackList.nativeHandler = nativeHandler;\n            if (name === 'ready') {\n              bindOnReady(target, nativeHandler, self);\n            } else {\n              addEvent(target, fakeName || name, nativeHandler, capture);\n            }\n          } else {\n            if (name === 'ready' && self.domLoaded) {\n              callback(fix({ type: name }));\n            } else {\n              callbackList.push({\n                func: callback,\n                scope: scope\n              });\n            }\n          }\n        }\n        target = callbackList = null;\n        return callback;\n      };\n      EventUtils.prototype.unbind = function (target, names, callback) {\n        var callbackList, i, ci, name, eventMap;\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return this;\n        }\n        var id = target[this.expando];\n        if (id) {\n          eventMap = this.events[id];\n          if (names) {\n            var namesList = names.split(' ');\n            i = namesList.length;\n            while (i--) {\n              name = namesList[i];\n              callbackList = eventMap[name];\n              if (callbackList) {\n                if (callback) {\n                  ci = callbackList.length;\n                  while (ci--) {\n                    if (callbackList[ci].func === callback) {\n                      var nativeHandler = callbackList.nativeHandler;\n                      var fakeName = callbackList.fakeName, capture = callbackList.capture;\n                      callbackList = callbackList.slice(0, ci).concat(callbackList.slice(ci + 1));\n                      callbackList.nativeHandler = nativeHandler;\n                      callbackList.fakeName = fakeName;\n                      callbackList.capture = capture;\n                      eventMap[name] = callbackList;\n                    }\n                  }\n                }\n                if (!callback || callbackList.length === 0) {\n                  delete eventMap[name];\n                  removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n                }\n              }\n            }\n          } else {\n            each$1(eventMap, function (callbackList, name) {\n              removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n            });\n            eventMap = {};\n          }\n          for (name in eventMap) {\n            if (has(eventMap, name)) {\n              return this;\n            }\n          }\n          delete this.events[id];\n          try {\n            delete target[this.expando];\n          } catch (ex) {\n            target[this.expando] = null;\n          }\n        }\n        return this;\n      };\n      EventUtils.prototype.fire = function (target, name, args) {\n        var id;\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return this;\n        }\n        var event = fix(null, args);\n        event.type = name;\n        event.target = target;\n        do {\n          id = target[this.expando];\n          if (id) {\n            this.executeHandlers(event, id);\n          }\n          target = target.parentNode || target.ownerDocument || target.defaultView || target.parentWindow;\n        } while (target && !event.isPropagationStopped());\n        return this;\n      };\n      EventUtils.prototype.clean = function (target) {\n        var i, children;\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return this;\n        }\n        if (target[this.expando]) {\n          this.unbind(target);\n        }\n        if (!target.getElementsByTagName) {\n          target = target.document;\n        }\n        if (target && target.getElementsByTagName) {\n          this.unbind(target);\n          children = target.getElementsByTagName('*');\n          i = children.length;\n          while (i--) {\n            target = children[i];\n            if (target[this.expando]) {\n              this.unbind(target);\n            }\n          }\n        }\n        return this;\n      };\n      EventUtils.prototype.destroy = function () {\n        this.events = {};\n      };\n      EventUtils.prototype.cancel = function (e) {\n        if (e) {\n          e.preventDefault();\n          e.stopImmediatePropagation();\n        }\n        return false;\n      };\n      EventUtils.prototype.executeHandlers = function (evt, id) {\n        var container = this.events[id];\n        var callbackList = container && container[evt.type];\n        if (callbackList) {\n          for (var i = 0, l = callbackList.length; i < l; i++) {\n            var callback = callbackList[i];\n            if (callback && callback.func.call(callback.scope, evt) === false) {\n              evt.preventDefault();\n            }\n            if (evt.isImmediatePropagationStopped()) {\n              return;\n            }\n          }\n        }\n      };\n      EventUtils.Event = new EventUtils();\n      return EventUtils;\n    }();\n\n    var support, Expr, getText, isXML, tokenize, compile, select, outermostContext, sortInput, hasDuplicate, setDocument, document$1, docElem, documentIsHTML, rbuggyQSA, rbuggyMatches, matches, contains$3, expando = 'sizzle' + -new Date(), preferredDoc = window.document, dirruns = 0, done = 0, classCache = createCache(), tokenCache = createCache(), compilerCache = createCache(), sortOrder = function (a, b) {\n        if (a === b) {\n          hasDuplicate = true;\n        }\n        return 0;\n      }, strundefined = typeof undefined, MAX_NEGATIVE = 1 << 31, hasOwn = {}.hasOwnProperty, arr = [], pop = arr.pop, push_native = arr.push, push = arr.push, slice = arr.slice, indexOf$2 = arr.indexOf || function (elem) {\n        var i = 0, len = this.length;\n        for (; i < len; i++) {\n          if (this[i] === elem) {\n            return i;\n          }\n        }\n        return -1;\n      }, booleans = 'checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped', whitespace = '[\\\\x20\\\\t\\\\r\\\\n\\\\f]', identifier = '(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+', attributes = '\\\\[' + whitespace + '*(' + identifier + ')(?:' + whitespace + '*([*^$|!~]?=)' + whitespace + '*(?:\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\"|(' + identifier + '))|)' + whitespace + '*\\\\]', pseudos = ':(' + identifier + ')(?:\\\\((' + '(\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\")|' + '((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|' + attributes + ')*)|' + '.*' + ')\\\\)|)', rtrim = new RegExp('^' + whitespace + '+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)' + whitespace + '+$', 'g'), rcomma = new RegExp('^' + whitespace + '*,' + whitespace + '*'), rcombinators = new RegExp('^' + whitespace + '*([>+~]|' + whitespace + ')' + whitespace + '*'), rattributeQuotes = new RegExp('=' + whitespace + '*([^\\\\]\\'\"]*?)' + whitespace + '*\\\\]', 'g'), rpseudo = new RegExp(pseudos), ridentifier = new RegExp('^' + identifier + '$'), matchExpr = {\n        ID: new RegExp('^#(' + identifier + ')'),\n        CLASS: new RegExp('^\\\\.(' + identifier + ')'),\n        TAG: new RegExp('^(' + identifier + '|[*])'),\n        ATTR: new RegExp('^' + attributes),\n        PSEUDO: new RegExp('^' + pseudos),\n        CHILD: new RegExp('^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(' + whitespace + '*(even|odd|(([+-]|)(\\\\d*)n|)' + whitespace + '*(?:([+-]|)' + whitespace + '*(\\\\d+)|))' + whitespace + '*\\\\)|)', 'i'),\n        bool: new RegExp('^(?:' + booleans + ')$', 'i'),\n        needsContext: new RegExp('^' + whitespace + '*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(' + whitespace + '*((?:-\\\\d)?\\\\d*)' + whitespace + '*\\\\)|)(?=[^-]|$)', 'i')\n      }, rinputs = /^(?:input|select|textarea|button)$/i, rheader = /^h\\d$/i, rnative = /^[^{]+\\{\\s*\\[native \\w/, rquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/, rsibling = /[+~]/, rescape = /'|\\\\/g, runescape = new RegExp('\\\\\\\\([\\\\da-f]{1,6}' + whitespace + '?|(' + whitespace + ')|.)', 'ig'), funescape = function (_, escaped, escapedWhitespace) {\n        var high = '0x' + escaped - 65536;\n        return high !== high || escapedWhitespace ? escaped : high < 0 ? String.fromCharCode(high + 65536) : String.fromCharCode(high >> 10 | 55296, high & 1023 | 56320);\n      };\n    try {\n      push.apply(arr = slice.call(preferredDoc.childNodes), preferredDoc.childNodes);\n      arr[preferredDoc.childNodes.length].nodeType;\n    } catch (e) {\n      push = {\n        apply: arr.length ? function (target, els) {\n          push_native.apply(target, slice.call(els));\n        } : function (target, els) {\n          var j = target.length, i = 0;\n          while (target[j++] = els[i++]) {\n          }\n          target.length = j - 1;\n        }\n      };\n    }\n    var Sizzle = function (selector, context, results, seed) {\n      var match, elem, m, nodeType, i, groups, old, nid, newContext, newSelector;\n      if ((context ? context.ownerDocument || context : preferredDoc) !== document$1) {\n        setDocument(context);\n      }\n      context = context || document$1;\n      results = results || [];\n      if (!selector || typeof selector !== 'string') {\n        return results;\n      }\n      if ((nodeType = context.nodeType) !== 1 && nodeType !== 9) {\n        return [];\n      }\n      if (documentIsHTML && !seed) {\n        if (match = rquickExpr.exec(selector)) {\n          if (m = match[1]) {\n            if (nodeType === 9) {\n              elem = context.getElementById(m);\n              if (elem && elem.parentNode) {\n                if (elem.id === m) {\n                  results.push(elem);\n                  return results;\n                }\n              } else {\n                return results;\n              }\n            } else {\n              if (context.ownerDocument && (elem = context.ownerDocument.getElementById(m)) && contains$3(context, elem) && elem.id === m) {\n                results.push(elem);\n                return results;\n              }\n            }\n          } else if (match[2]) {\n            push.apply(results, context.getElementsByTagName(selector));\n            return results;\n          } else if ((m = match[3]) && support.getElementsByClassName) {\n            push.apply(results, context.getElementsByClassName(m));\n            return results;\n          }\n        }\n        if (support.qsa && (!rbuggyQSA || !rbuggyQSA.test(selector))) {\n          nid = old = expando;\n          newContext = context;\n          newSelector = nodeType === 9 && selector;\n          if (nodeType === 1 && context.nodeName.toLowerCase() !== 'object') {\n            groups = tokenize(selector);\n            if (old = context.getAttribute('id')) {\n              nid = old.replace(rescape, '\\\\$&');\n            } else {\n              context.setAttribute('id', nid);\n            }\n            nid = '[id=\\'' + nid + '\\'] ';\n            i = groups.length;\n            while (i--) {\n              groups[i] = nid + toSelector(groups[i]);\n            }\n            newContext = rsibling.test(selector) && testContext(context.parentNode) || context;\n            newSelector = groups.join(',');\n          }\n          if (newSelector) {\n            try {\n              push.apply(results, newContext.querySelectorAll(newSelector));\n              return results;\n            } catch (qsaError) {\n            } finally {\n              if (!old) {\n                context.removeAttribute('id');\n              }\n            }\n          }\n        }\n      }\n      return select(selector.replace(rtrim, '$1'), context, results, seed);\n    };\n    function createCache() {\n      var keys = [];\n      function cache(key, value) {\n        if (keys.push(key + ' ') > Expr.cacheLength) {\n          delete cache[keys.shift()];\n        }\n        return cache[key + ' '] = value;\n      }\n      return cache;\n    }\n    function markFunction(fn) {\n      fn[expando] = true;\n      return fn;\n    }\n    function siblingCheck(a, b) {\n      var cur = b && a, diff = cur && a.nodeType === 1 && b.nodeType === 1 && (~b.sourceIndex || MAX_NEGATIVE) - (~a.sourceIndex || MAX_NEGATIVE);\n      if (diff) {\n        return diff;\n      }\n      if (cur) {\n        while (cur = cur.nextSibling) {\n          if (cur === b) {\n            return -1;\n          }\n        }\n      }\n      return a ? 1 : -1;\n    }\n    function createInputPseudo(type) {\n      return function (elem) {\n        var name = elem.nodeName.toLowerCase();\n        return name === 'input' && elem.type === type;\n      };\n    }\n    function createButtonPseudo(type) {\n      return function (elem) {\n        var name = elem.nodeName.toLowerCase();\n        return (name === 'input' || name === 'button') && elem.type === type;\n      };\n    }\n    function createPositionalPseudo(fn) {\n      return markFunction(function (argument) {\n        argument = +argument;\n        return markFunction(function (seed, matches) {\n          var j, matchIndexes = fn([], seed.length, argument), i = matchIndexes.length;\n          while (i--) {\n            if (seed[j = matchIndexes[i]]) {\n              seed[j] = !(matches[j] = seed[j]);\n            }\n          }\n        });\n      });\n    }\n    function testContext(context) {\n      return context && typeof context.getElementsByTagName !== strundefined && context;\n    }\n    support = Sizzle.support = {};\n    isXML = Sizzle.isXML = function (elem) {\n      var documentElement = elem && (elem.ownerDocument || elem).documentElement;\n      return documentElement ? documentElement.nodeName !== 'HTML' : false;\n    };\n    setDocument = Sizzle.setDocument = function (node) {\n      var hasCompare, doc = node ? node.ownerDocument || node : preferredDoc, parent = doc.defaultView;\n      function getTop(win) {\n        try {\n          return win.top;\n        } catch (ex) {\n        }\n        return null;\n      }\n      if (doc === document$1 || doc.nodeType !== 9 || !doc.documentElement) {\n        return document$1;\n      }\n      document$1 = doc;\n      docElem = doc.documentElement;\n      documentIsHTML = !isXML(doc);\n      if (parent && parent !== getTop(parent)) {\n        if (parent.addEventListener) {\n          parent.addEventListener('unload', function () {\n            setDocument();\n          }, false);\n        } else if (parent.attachEvent) {\n          parent.attachEvent('onunload', function () {\n            setDocument();\n          });\n        }\n      }\n      support.attributes = true;\n      support.getElementsByTagName = true;\n      support.getElementsByClassName = rnative.test(doc.getElementsByClassName);\n      support.getById = true;\n      Expr.find.ID = function (id, context) {\n        if (typeof context.getElementById !== strundefined && documentIsHTML) {\n          var m = context.getElementById(id);\n          return m && m.parentNode ? [m] : [];\n        }\n      };\n      Expr.filter.ID = function (id) {\n        var attrId = id.replace(runescape, funescape);\n        return function (elem) {\n          return elem.getAttribute('id') === attrId;\n        };\n      };\n      Expr.find.TAG = support.getElementsByTagName ? function (tag, context) {\n        if (typeof context.getElementsByTagName !== strundefined) {\n          return context.getElementsByTagName(tag);\n        }\n      } : function (tag, context) {\n        var elem, tmp = [], i = 0, results = context.getElementsByTagName(tag);\n        if (tag === '*') {\n          while (elem = results[i++]) {\n            if (elem.nodeType === 1) {\n              tmp.push(elem);\n            }\n          }\n          return tmp;\n        }\n        return results;\n      };\n      Expr.find.CLASS = support.getElementsByClassName && function (className, context) {\n        if (documentIsHTML) {\n          return context.getElementsByClassName(className);\n        }\n      };\n      rbuggyMatches = [];\n      rbuggyQSA = [];\n      support.disconnectedMatch = true;\n      rbuggyQSA = rbuggyQSA.length && new RegExp(rbuggyQSA.join('|'));\n      rbuggyMatches = rbuggyMatches.length && new RegExp(rbuggyMatches.join('|'));\n      hasCompare = rnative.test(docElem.compareDocumentPosition);\n      contains$3 = hasCompare || rnative.test(docElem.contains) ? function (a, b) {\n        var adown = a.nodeType === 9 ? a.documentElement : a, bup = b && b.parentNode;\n        return a === bup || !!(bup && bup.nodeType === 1 && (adown.contains ? adown.contains(bup) : a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16));\n      } : function (a, b) {\n        if (b) {\n          while (b = b.parentNode) {\n            if (b === a) {\n              return true;\n            }\n          }\n        }\n        return false;\n      };\n      sortOrder = hasCompare ? function (a, b) {\n        if (a === b) {\n          hasDuplicate = true;\n          return 0;\n        }\n        var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;\n        if (compare) {\n          return compare;\n        }\n        compare = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : 1;\n        if (compare & 1 || !support.sortDetached && b.compareDocumentPosition(a) === compare) {\n          if (a === doc || a.ownerDocument === preferredDoc && contains$3(preferredDoc, a)) {\n            return -1;\n          }\n          if (b === doc || b.ownerDocument === preferredDoc && contains$3(preferredDoc, b)) {\n            return 1;\n          }\n          return sortInput ? indexOf$2.call(sortInput, a) - indexOf$2.call(sortInput, b) : 0;\n        }\n        return compare & 4 ? -1 : 1;\n      } : function (a, b) {\n        if (a === b) {\n          hasDuplicate = true;\n          return 0;\n        }\n        var cur, i = 0, aup = a.parentNode, bup = b.parentNode, ap = [a], bp = [b];\n        if (!aup || !bup) {\n          return a === doc ? -1 : b === doc ? 1 : aup ? -1 : bup ? 1 : sortInput ? indexOf$2.call(sortInput, a) - indexOf$2.call(sortInput, b) : 0;\n        } else if (aup === bup) {\n          return siblingCheck(a, b);\n        }\n        cur = a;\n        while (cur = cur.parentNode) {\n          ap.unshift(cur);\n        }\n        cur = b;\n        while (cur = cur.parentNode) {\n          bp.unshift(cur);\n        }\n        while (ap[i] === bp[i]) {\n          i++;\n        }\n        return i ? siblingCheck(ap[i], bp[i]) : ap[i] === preferredDoc ? -1 : bp[i] === preferredDoc ? 1 : 0;\n      };\n      return doc;\n    };\n    Sizzle.matches = function (expr, elements) {\n      return Sizzle(expr, null, null, elements);\n    };\n    Sizzle.matchesSelector = function (elem, expr) {\n      if ((elem.ownerDocument || elem) !== document$1) {\n        setDocument(elem);\n      }\n      expr = expr.replace(rattributeQuotes, '=\\'$1\\']');\n      if (support.matchesSelector && documentIsHTML && (!rbuggyMatches || !rbuggyMatches.test(expr)) && (!rbuggyQSA || !rbuggyQSA.test(expr))) {\n        try {\n          var ret = matches.call(elem, expr);\n          if (ret || support.disconnectedMatch || elem.document && elem.document.nodeType !== 11) {\n            return ret;\n          }\n        } catch (e) {\n        }\n      }\n      return Sizzle(expr, document$1, null, [elem]).length > 0;\n    };\n    Sizzle.contains = function (context, elem) {\n      if ((context.ownerDocument || context) !== document$1) {\n        setDocument(context);\n      }\n      return contains$3(context, elem);\n    };\n    Sizzle.attr = function (elem, name) {\n      if ((elem.ownerDocument || elem) !== document$1) {\n        setDocument(elem);\n      }\n      var fn = Expr.attrHandle[name.toLowerCase()], val = fn && hasOwn.call(Expr.attrHandle, name.toLowerCase()) ? fn(elem, name, !documentIsHTML) : undefined;\n      return val !== undefined ? val : support.attributes || !documentIsHTML ? elem.getAttribute(name) : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null;\n    };\n    Sizzle.error = function (msg) {\n      throw new Error('Syntax error, unrecognized expression: ' + msg);\n    };\n    Sizzle.uniqueSort = function (results) {\n      var elem, duplicates = [], j = 0, i = 0;\n      hasDuplicate = !support.detectDuplicates;\n      sortInput = !support.sortStable && results.slice(0);\n      results.sort(sortOrder);\n      if (hasDuplicate) {\n        while (elem = results[i++]) {\n          if (elem === results[i]) {\n            j = duplicates.push(i);\n          }\n        }\n        while (j--) {\n          results.splice(duplicates[j], 1);\n        }\n      }\n      sortInput = null;\n      return results;\n    };\n    getText = Sizzle.getText = function (elem) {\n      var node, ret = '', i = 0, nodeType = elem.nodeType;\n      if (!nodeType) {\n        while (node = elem[i++]) {\n          ret += getText(node);\n        }\n      } else if (nodeType === 1 || nodeType === 9 || nodeType === 11) {\n        if (typeof elem.textContent === 'string') {\n          return elem.textContent;\n        } else {\n          for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\n            ret += getText(elem);\n          }\n        }\n      } else if (nodeType === 3 || nodeType === 4) {\n        return elem.nodeValue;\n      }\n      return ret;\n    };\n    Expr = Sizzle.selectors = {\n      cacheLength: 50,\n      createPseudo: markFunction,\n      match: matchExpr,\n      attrHandle: {},\n      find: {},\n      relative: {\n        '>': {\n          dir: 'parentNode',\n          first: true\n        },\n        ' ': { dir: 'parentNode' },\n        '+': {\n          dir: 'previousSibling',\n          first: true\n        },\n        '~': { dir: 'previousSibling' }\n      },\n      preFilter: {\n        ATTR: function (match) {\n          match[1] = match[1].replace(runescape, funescape);\n          match[3] = (match[3] || match[4] || match[5] || '').replace(runescape, funescape);\n          if (match[2] === '~=') {\n            match[3] = ' ' + match[3] + ' ';\n          }\n          return match.slice(0, 4);\n        },\n        CHILD: function (match) {\n          match[1] = match[1].toLowerCase();\n          if (match[1].slice(0, 3) === 'nth') {\n            if (!match[3]) {\n              Sizzle.error(match[0]);\n            }\n            match[4] = +(match[4] ? match[5] + (match[6] || 1) : 2 * (match[3] === 'even' || match[3] === 'odd'));\n            match[5] = +(match[7] + match[8] || match[3] === 'odd');\n          } else if (match[3]) {\n            Sizzle.error(match[0]);\n          }\n          return match;\n        },\n        PSEUDO: function (match) {\n          var excess, unquoted = !match[6] && match[2];\n          if (matchExpr.CHILD.test(match[0])) {\n            return null;\n          }\n          if (match[3]) {\n            match[2] = match[4] || match[5] || '';\n          } else if (unquoted && rpseudo.test(unquoted) && (excess = tokenize(unquoted, true)) && (excess = unquoted.indexOf(')', unquoted.length - excess) - unquoted.length)) {\n            match[0] = match[0].slice(0, excess);\n            match[2] = unquoted.slice(0, excess);\n          }\n          return match.slice(0, 3);\n        }\n      },\n      filter: {\n        TAG: function (nodeNameSelector) {\n          var nodeName = nodeNameSelector.replace(runescape, funescape).toLowerCase();\n          return nodeNameSelector === '*' ? function () {\n            return true;\n          } : function (elem) {\n            return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\n          };\n        },\n        CLASS: function (className) {\n          var pattern = classCache[className + ' '];\n          return pattern || (pattern = new RegExp('(^|' + whitespace + ')' + className + '(' + whitespace + '|$)')) && classCache(className, function (elem) {\n            return pattern.test(typeof elem.className === 'string' && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute('class') || '');\n          });\n        },\n        ATTR: function (name, operator, check) {\n          return function (elem) {\n            var result = Sizzle.attr(elem, name);\n            if (result == null) {\n              return operator === '!=';\n            }\n            if (!operator) {\n              return true;\n            }\n            result += '';\n            return operator === '=' ? result === check : operator === '!=' ? result !== check : operator === '^=' ? check && result.indexOf(check) === 0 : operator === '*=' ? check && result.indexOf(check) > -1 : operator === '$=' ? check && result.slice(-check.length) === check : operator === '~=' ? (' ' + result + ' ').indexOf(check) > -1 : operator === '|=' ? result === check || result.slice(0, check.length + 1) === check + '-' : false;\n          };\n        },\n        CHILD: function (type, what, argument, first, last) {\n          var simple = type.slice(0, 3) !== 'nth', forward = type.slice(-4) !== 'last', ofType = what === 'of-type';\n          return first === 1 && last === 0 ? function (elem) {\n            return !!elem.parentNode;\n          } : function (elem, context, xml) {\n            var cache, outerCache, node, diff, nodeIndex, start, dir = simple !== forward ? 'nextSibling' : 'previousSibling', parent = elem.parentNode, name = ofType && elem.nodeName.toLowerCase(), useCache = !xml && !ofType;\n            if (parent) {\n              if (simple) {\n                while (dir) {\n                  node = elem;\n                  while (node = node[dir]) {\n                    if (ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) {\n                      return false;\n                    }\n                  }\n                  start = dir = type === 'only' && !start && 'nextSibling';\n                }\n                return true;\n              }\n              start = [forward ? parent.firstChild : parent.lastChild];\n              if (forward && useCache) {\n                outerCache = parent[expando] || (parent[expando] = {});\n                cache = outerCache[type] || [];\n                nodeIndex = cache[0] === dirruns && cache[1];\n                diff = cache[0] === dirruns && cache[2];\n                node = nodeIndex && parent.childNodes[nodeIndex];\n                while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\n                  if (node.nodeType === 1 && ++diff && node === elem) {\n                    outerCache[type] = [\n                      dirruns,\n                      nodeIndex,\n                      diff\n                    ];\n                    break;\n                  }\n                }\n              } else if (useCache && (cache = (elem[expando] || (elem[expando] = {}))[type]) && cache[0] === dirruns) {\n                diff = cache[1];\n              } else {\n                while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\n                  if ((ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) && ++diff) {\n                    if (useCache) {\n                      (node[expando] || (node[expando] = {}))[type] = [\n                        dirruns,\n                        diff\n                      ];\n                    }\n                    if (node === elem) {\n                      break;\n                    }\n                  }\n                }\n              }\n              diff -= last;\n              return diff === first || diff % first === 0 && diff / first >= 0;\n            }\n          };\n        },\n        PSEUDO: function (pseudo, argument) {\n          var args, fn = Expr.pseudos[pseudo] || Expr.setFilters[pseudo.toLowerCase()] || Sizzle.error('unsupported pseudo: ' + pseudo);\n          if (fn[expando]) {\n            return fn(argument);\n          }\n          if (fn.length > 1) {\n            args = [\n              pseudo,\n              pseudo,\n              '',\n              argument\n            ];\n            return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase()) ? markFunction(function (seed, matches) {\n              var idx, matched = fn(seed, argument), i = matched.length;\n              while (i--) {\n                idx = indexOf$2.call(seed, matched[i]);\n                seed[idx] = !(matches[idx] = matched[i]);\n              }\n            }) : function (elem) {\n              return fn(elem, 0, args);\n            };\n          }\n          return fn;\n        }\n      },\n      pseudos: {\n        not: markFunction(function (selector) {\n          var input = [], results = [], matcher = compile(selector.replace(rtrim, '$1'));\n          return matcher[expando] ? markFunction(function (seed, matches, context, xml) {\n            var elem, unmatched = matcher(seed, null, xml, []), i = seed.length;\n            while (i--) {\n              if (elem = unmatched[i]) {\n                seed[i] = !(matches[i] = elem);\n              }\n            }\n          }) : function (elem, context, xml) {\n            input[0] = elem;\n            matcher(input, null, xml, results);\n            return !results.pop();\n          };\n        }),\n        has: markFunction(function (selector) {\n          return function (elem) {\n            return Sizzle(selector, elem).length > 0;\n          };\n        }),\n        contains: markFunction(function (text) {\n          text = text.replace(runescape, funescape);\n          return function (elem) {\n            return (elem.textContent || elem.innerText || getText(elem)).indexOf(text) > -1;\n          };\n        }),\n        lang: markFunction(function (lang) {\n          if (!ridentifier.test(lang || '')) {\n            Sizzle.error('unsupported lang: ' + lang);\n          }\n          lang = lang.replace(runescape, funescape).toLowerCase();\n          return function (elem) {\n            var elemLang;\n            do {\n              if (elemLang = documentIsHTML ? elem.lang : elem.getAttribute('xml:lang') || elem.getAttribute('lang')) {\n                elemLang = elemLang.toLowerCase();\n                return elemLang === lang || elemLang.indexOf(lang + '-') === 0;\n              }\n            } while ((elem = elem.parentNode) && elem.nodeType === 1);\n            return false;\n          };\n        }),\n        target: function (elem) {\n          var hash = window.location && window.location.hash;\n          return hash && hash.slice(1) === elem.id;\n        },\n        root: function (elem) {\n          return elem === docElem;\n        },\n        focus: function (elem) {\n          return elem === document$1.activeElement && (!document$1.hasFocus || document$1.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);\n        },\n        enabled: function (elem) {\n          return elem.disabled === false;\n        },\n        disabled: function (elem) {\n          return elem.disabled === true;\n        },\n        checked: function (elem) {\n          var nodeName = elem.nodeName.toLowerCase();\n          return nodeName === 'input' && !!elem.checked || nodeName === 'option' && !!elem.selected;\n        },\n        selected: function (elem) {\n          if (elem.parentNode) {\n            elem.parentNode.selectedIndex;\n          }\n          return elem.selected === true;\n        },\n        empty: function (elem) {\n          for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\n            if (elem.nodeType < 6) {\n              return false;\n            }\n          }\n          return true;\n        },\n        parent: function (elem) {\n          return !Expr.pseudos.empty(elem);\n        },\n        header: function (elem) {\n          return rheader.test(elem.nodeName);\n        },\n        input: function (elem) {\n          return rinputs.test(elem.nodeName);\n        },\n        button: function (elem) {\n          var name = elem.nodeName.toLowerCase();\n          return name === 'input' && elem.type === 'button' || name === 'button';\n        },\n        text: function (elem) {\n          var attr;\n          return elem.nodeName.toLowerCase() === 'input' && elem.type === 'text' && ((attr = elem.getAttribute('type')) == null || attr.toLowerCase() === 'text');\n        },\n        first: createPositionalPseudo(function () {\n          return [0];\n        }),\n        last: createPositionalPseudo(function (matchIndexes, length) {\n          return [length - 1];\n        }),\n        eq: createPositionalPseudo(function (matchIndexes, length, argument) {\n          return [argument < 0 ? argument + length : argument];\n        }),\n        even: createPositionalPseudo(function (matchIndexes, length) {\n          var i = 0;\n          for (; i < length; i += 2) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        }),\n        odd: createPositionalPseudo(function (matchIndexes, length) {\n          var i = 1;\n          for (; i < length; i += 2) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        }),\n        lt: createPositionalPseudo(function (matchIndexes, length, argument) {\n          var i = argument < 0 ? argument + length : argument;\n          for (; --i >= 0;) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        }),\n        gt: createPositionalPseudo(function (matchIndexes, length, argument) {\n          var i = argument < 0 ? argument + length : argument;\n          for (; ++i < length;) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        })\n      }\n    };\n    Expr.pseudos.nth = Expr.pseudos.eq;\n    each([\n      'radio',\n      'checkbox',\n      'file',\n      'password',\n      'image'\n    ], function (i) {\n      Expr.pseudos[i] = createInputPseudo(i);\n    });\n    each([\n      'submit',\n      'reset'\n    ], function (i) {\n      Expr.pseudos[i] = createButtonPseudo(i);\n    });\n    function setFilters() {\n    }\n    setFilters.prototype = Expr.filters = Expr.pseudos;\n    Expr.setFilters = new setFilters();\n    tokenize = Sizzle.tokenize = function (selector, parseOnly) {\n      var matched, match, tokens, type, soFar, groups, preFilters, cached = tokenCache[selector + ' '];\n      if (cached) {\n        return parseOnly ? 0 : cached.slice(0);\n      }\n      soFar = selector;\n      groups = [];\n      preFilters = Expr.preFilter;\n      while (soFar) {\n        if (!matched || (match = rcomma.exec(soFar))) {\n          if (match) {\n            soFar = soFar.slice(match[0].length) || soFar;\n          }\n          groups.push(tokens = []);\n        }\n        matched = false;\n        if (match = rcombinators.exec(soFar)) {\n          matched = match.shift();\n          tokens.push({\n            value: matched,\n            type: match[0].replace(rtrim, ' ')\n          });\n          soFar = soFar.slice(matched.length);\n        }\n        for (type in Expr.filter) {\n          if (!Expr.filter.hasOwnProperty(type)) {\n            continue;\n          }\n          if ((match = matchExpr[type].exec(soFar)) && (!preFilters[type] || (match = preFilters[type](match)))) {\n            matched = match.shift();\n            tokens.push({\n              value: matched,\n              type: type,\n              matches: match\n            });\n            soFar = soFar.slice(matched.length);\n          }\n        }\n        if (!matched) {\n          break;\n        }\n      }\n      return parseOnly ? soFar.length : soFar ? Sizzle.error(selector) : tokenCache(selector, groups).slice(0);\n    };\n    function toSelector(tokens) {\n      var i = 0, len = tokens.length, selector = '';\n      for (; i < len; i++) {\n        selector += tokens[i].value;\n      }\n      return selector;\n    }\n    function addCombinator(matcher, combinator, base) {\n      var dir = combinator.dir, checkNonElements = base && dir === 'parentNode', doneName = done++;\n      return combinator.first ? function (elem, context, xml) {\n        while (elem = elem[dir]) {\n          if (elem.nodeType === 1 || checkNonElements) {\n            return matcher(elem, context, xml);\n          }\n        }\n      } : function (elem, context, xml) {\n        var oldCache, outerCache, newCache = [\n            dirruns,\n            doneName\n          ];\n        if (xml) {\n          while (elem = elem[dir]) {\n            if (elem.nodeType === 1 || checkNonElements) {\n              if (matcher(elem, context, xml)) {\n                return true;\n              }\n            }\n          }\n        } else {\n          while (elem = elem[dir]) {\n            if (elem.nodeType === 1 || checkNonElements) {\n              outerCache = elem[expando] || (elem[expando] = {});\n              if ((oldCache = outerCache[dir]) && oldCache[0] === dirruns && oldCache[1] === doneName) {\n                return newCache[2] = oldCache[2];\n              } else {\n                outerCache[dir] = newCache;\n                if (newCache[2] = matcher(elem, context, xml)) {\n                  return true;\n                }\n              }\n            }\n          }\n        }\n      };\n    }\n    function elementMatcher(matchers) {\n      return matchers.length > 1 ? function (elem, context, xml) {\n        var i = matchers.length;\n        while (i--) {\n          if (!matchers[i](elem, context, xml)) {\n            return false;\n          }\n        }\n        return true;\n      } : matchers[0];\n    }\n    function multipleContexts(selector, contexts, results) {\n      var i = 0, len = contexts.length;\n      for (; i < len; i++) {\n        Sizzle(selector, contexts[i], results);\n      }\n      return results;\n    }\n    function condense(unmatched, map, filter, context, xml) {\n      var elem, newUnmatched = [], i = 0, len = unmatched.length, mapped = map != null;\n      for (; i < len; i++) {\n        if (elem = unmatched[i]) {\n          if (!filter || filter(elem, context, xml)) {\n            newUnmatched.push(elem);\n            if (mapped) {\n              map.push(i);\n            }\n          }\n        }\n      }\n      return newUnmatched;\n    }\n    function setMatcher(preFilter, selector, matcher, postFilter, postFinder, postSelector) {\n      if (postFilter && !postFilter[expando]) {\n        postFilter = setMatcher(postFilter);\n      }\n      if (postFinder && !postFinder[expando]) {\n        postFinder = setMatcher(postFinder, postSelector);\n      }\n      return markFunction(function (seed, results, context, xml) {\n        var temp, i, elem, preMap = [], postMap = [], preexisting = results.length, elems = seed || multipleContexts(selector || '*', context.nodeType ? [context] : context, []), matcherIn = preFilter && (seed || !selector) ? condense(elems, preMap, preFilter, context, xml) : elems, matcherOut = matcher ? postFinder || (seed ? preFilter : preexisting || postFilter) ? [] : results : matcherIn;\n        if (matcher) {\n          matcher(matcherIn, matcherOut, context, xml);\n        }\n        if (postFilter) {\n          temp = condense(matcherOut, postMap);\n          postFilter(temp, [], context, xml);\n          i = temp.length;\n          while (i--) {\n            if (elem = temp[i]) {\n              matcherOut[postMap[i]] = !(matcherIn[postMap[i]] = elem);\n            }\n          }\n        }\n        if (seed) {\n          if (postFinder || preFilter) {\n            if (postFinder) {\n              temp = [];\n              i = matcherOut.length;\n              while (i--) {\n                if (elem = matcherOut[i]) {\n                  temp.push(matcherIn[i] = elem);\n                }\n              }\n              postFinder(null, matcherOut = [], temp, xml);\n            }\n            i = matcherOut.length;\n            while (i--) {\n              if ((elem = matcherOut[i]) && (temp = postFinder ? indexOf$2.call(seed, elem) : preMap[i]) > -1) {\n                seed[temp] = !(results[temp] = elem);\n              }\n            }\n          }\n        } else {\n          matcherOut = condense(matcherOut === results ? matcherOut.splice(preexisting, matcherOut.length) : matcherOut);\n          if (postFinder) {\n            postFinder(null, results, matcherOut, xml);\n          } else {\n            push.apply(results, matcherOut);\n          }\n        }\n      });\n    }\n    function matcherFromTokens(tokens) {\n      var checkContext, matcher, j, len = tokens.length, leadingRelative = Expr.relative[tokens[0].type], implicitRelative = leadingRelative || Expr.relative[' '], i = leadingRelative ? 1 : 0, matchContext = addCombinator(function (elem) {\n          return elem === checkContext;\n        }, implicitRelative, true), matchAnyContext = addCombinator(function (elem) {\n          return indexOf$2.call(checkContext, elem) > -1;\n        }, implicitRelative, true), matchers = [function (elem, context, xml) {\n            return !leadingRelative && (xml || context !== outermostContext) || ((checkContext = context).nodeType ? matchContext(elem, context, xml) : matchAnyContext(elem, context, xml));\n          }];\n      for (; i < len; i++) {\n        if (matcher = Expr.relative[tokens[i].type]) {\n          matchers = [addCombinator(elementMatcher(matchers), matcher)];\n        } else {\n          matcher = Expr.filter[tokens[i].type].apply(null, tokens[i].matches);\n          if (matcher[expando]) {\n            j = ++i;\n            for (; j < len; j++) {\n              if (Expr.relative[tokens[j].type]) {\n                break;\n              }\n            }\n            return setMatcher(i > 1 && elementMatcher(matchers), i > 1 && toSelector(tokens.slice(0, i - 1).concat({ value: tokens[i - 2].type === ' ' ? '*' : '' })).replace(rtrim, '$1'), matcher, i < j && matcherFromTokens(tokens.slice(i, j)), j < len && matcherFromTokens(tokens = tokens.slice(j)), j < len && toSelector(tokens));\n          }\n          matchers.push(matcher);\n        }\n      }\n      return elementMatcher(matchers);\n    }\n    function matcherFromGroupMatchers(elementMatchers, setMatchers) {\n      var bySet = setMatchers.length > 0, byElement = elementMatchers.length > 0, superMatcher = function (seed, context, xml, results, outermost) {\n          var elem, j, matcher, matchedCount = 0, i = '0', unmatched = seed && [], setMatched = [], contextBackup = outermostContext, elems = seed || byElement && Expr.find.TAG('*', outermost), dirrunsUnique = dirruns += contextBackup == null ? 1 : Math.random() || 0.1, len = elems.length;\n          if (outermost) {\n            outermostContext = context !== document$1 && context;\n          }\n          for (; i !== len && (elem = elems[i]) != null; i++) {\n            if (byElement && elem) {\n              j = 0;\n              while (matcher = elementMatchers[j++]) {\n                if (matcher(elem, context, xml)) {\n                  results.push(elem);\n                  break;\n                }\n              }\n              if (outermost) {\n                dirruns = dirrunsUnique;\n              }\n            }\n            if (bySet) {\n              if (elem = !matcher && elem) {\n                matchedCount--;\n              }\n              if (seed) {\n                unmatched.push(elem);\n              }\n            }\n          }\n          matchedCount += i;\n          if (bySet && i !== matchedCount) {\n            j = 0;\n            while (matcher = setMatchers[j++]) {\n              matcher(unmatched, setMatched, context, xml);\n            }\n            if (seed) {\n              if (matchedCount > 0) {\n                while (i--) {\n                  if (!(unmatched[i] || setMatched[i])) {\n                    setMatched[i] = pop.call(results);\n                  }\n                }\n              }\n              setMatched = condense(setMatched);\n            }\n            push.apply(results, setMatched);\n            if (outermost && !seed && setMatched.length > 0 && matchedCount + setMatchers.length > 1) {\n              Sizzle.uniqueSort(results);\n            }\n          }\n          if (outermost) {\n            dirruns = dirrunsUnique;\n            outermostContext = contextBackup;\n          }\n          return unmatched;\n        };\n      return bySet ? markFunction(superMatcher) : superMatcher;\n    }\n    compile = Sizzle.compile = function (selector, match) {\n      var i, setMatchers = [], elementMatchers = [], cached = compilerCache[selector + ' '];\n      if (!cached) {\n        if (!match) {\n          match = tokenize(selector);\n        }\n        i = match.length;\n        while (i--) {\n          cached = matcherFromTokens(match[i]);\n          if (cached[expando]) {\n            setMatchers.push(cached);\n          } else {\n            elementMatchers.push(cached);\n          }\n        }\n        cached = compilerCache(selector, matcherFromGroupMatchers(elementMatchers, setMatchers));\n        cached.selector = selector;\n      }\n      return cached;\n    };\n    select = Sizzle.select = function (selector, context, results, seed) {\n      var i, tokens, token, type, find, compiled = typeof selector === 'function' && selector, match = !seed && tokenize(selector = compiled.selector || selector);\n      results = results || [];\n      if (match.length === 1) {\n        tokens = match[0] = match[0].slice(0);\n        if (tokens.length > 2 && (token = tokens[0]).type === 'ID' && support.getById && context.nodeType === 9 && documentIsHTML && Expr.relative[tokens[1].type]) {\n          context = (Expr.find.ID(token.matches[0].replace(runescape, funescape), context) || [])[0];\n          if (!context) {\n            return results;\n          } else if (compiled) {\n            context = context.parentNode;\n          }\n          selector = selector.slice(tokens.shift().value.length);\n        }\n        i = matchExpr.needsContext.test(selector) ? 0 : tokens.length;\n        while (i--) {\n          token = tokens[i];\n          if (Expr.relative[type = token.type]) {\n            break;\n          }\n          if (find = Expr.find[type]) {\n            if (seed = find(token.matches[0].replace(runescape, funescape), rsibling.test(tokens[0].type) && testContext(context.parentNode) || context)) {\n              tokens.splice(i, 1);\n              selector = seed.length && toSelector(tokens);\n              if (!selector) {\n                push.apply(results, seed);\n                return results;\n              }\n              break;\n            }\n          }\n        }\n      }\n      (compiled || compile(selector, match))(seed, context, !documentIsHTML, results, rsibling.test(selector) && testContext(context.parentNode) || context);\n      return results;\n    };\n    support.sortStable = expando.split('').sort(sortOrder).join('') === expando;\n    support.detectDuplicates = !!hasDuplicate;\n    setDocument();\n    support.sortDetached = true;\n\n    var doc = document, push$1 = Array.prototype.push, slice$1 = Array.prototype.slice;\n    var rquickExpr$1 = /^(?:[^#<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]*)$)/;\n    var Event = EventUtils.Event;\n    var skipUniques = Tools.makeMap('children,contents,next,prev');\n    var isDefined = function (obj) {\n      return typeof obj !== 'undefined';\n    };\n    var isString$1 = function (obj) {\n      return typeof obj === 'string';\n    };\n    var isWindow = function (obj) {\n      return obj && obj === obj.window;\n    };\n    var createFragment = function (html, fragDoc) {\n      fragDoc = fragDoc || doc;\n      var container = fragDoc.createElement('div');\n      var frag = fragDoc.createDocumentFragment();\n      container.innerHTML = html;\n      var node;\n      while (node = container.firstChild) {\n        frag.appendChild(node);\n      }\n      return frag;\n    };\n    var domManipulate = function (targetNodes, sourceItem, callback, reverse) {\n      var i;\n      if (isString$1(sourceItem)) {\n        sourceItem = createFragment(sourceItem, getElementDocument(targetNodes[0]));\n      } else if (sourceItem.length && !sourceItem.nodeType) {\n        sourceItem = DomQuery.makeArray(sourceItem);\n        if (reverse) {\n          for (i = sourceItem.length - 1; i >= 0; i--) {\n            domManipulate(targetNodes, sourceItem[i], callback, reverse);\n          }\n        } else {\n          for (i = 0; i < sourceItem.length; i++) {\n            domManipulate(targetNodes, sourceItem[i], callback, reverse);\n          }\n        }\n        return targetNodes;\n      }\n      if (sourceItem.nodeType) {\n        i = targetNodes.length;\n        while (i--) {\n          callback.call(targetNodes[i], sourceItem);\n        }\n      }\n      return targetNodes;\n    };\n    var hasClass = function (node, className) {\n      return node && className && (' ' + node.className + ' ').indexOf(' ' + className + ' ') !== -1;\n    };\n    var wrap$1 = function (elements, wrapper, all) {\n      var lastParent, newWrapper;\n      wrapper = DomQuery(wrapper)[0];\n      elements.each(function () {\n        var self = this;\n        if (!all || lastParent !== self.parentNode) {\n          lastParent = self.parentNode;\n          newWrapper = wrapper.cloneNode(false);\n          self.parentNode.insertBefore(newWrapper, self);\n          newWrapper.appendChild(self);\n        } else {\n          newWrapper.appendChild(self);\n        }\n      });\n      return elements;\n    };\n    var numericCssMap = Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom', ' ');\n    var booleanMap = Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected', ' ');\n    var propFix = {\n      for: 'htmlFor',\n      class: 'className',\n      readonly: 'readOnly'\n    };\n    var cssFix = { float: 'cssFloat' };\n    var attrHooks = {}, cssHooks = {};\n    var DomQueryConstructor = function (selector, context) {\n      return new DomQuery.fn.init(selector, context);\n    };\n    var inArray$1 = function (item, array) {\n      var i;\n      if (array.indexOf) {\n        return array.indexOf(item);\n      }\n      i = array.length;\n      while (i--) {\n        if (array[i] === item) {\n          return i;\n        }\n      }\n      return -1;\n    };\n    var whiteSpaceRegExp$2 = /^\\s*|\\s*$/g;\n    var trim$3 = function (str) {\n      return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp$2, '');\n    };\n    var each$4 = function (obj, callback) {\n      var length, key, i, value;\n      if (obj) {\n        length = obj.length;\n        if (length === undefined) {\n          for (key in obj) {\n            if (obj.hasOwnProperty(key)) {\n              value = obj[key];\n              if (callback.call(value, key, value) === false) {\n                break;\n              }\n            }\n          }\n        } else {\n          for (i = 0; i < length; i++) {\n            value = obj[i];\n            if (callback.call(value, i, value) === false) {\n              break;\n            }\n          }\n        }\n      }\n      return obj;\n    };\n    var grep = function (array, callback) {\n      var out = [];\n      each$4(array, function (i, item) {\n        if (callback(item, i)) {\n          out.push(item);\n        }\n      });\n      return out;\n    };\n    var getElementDocument = function (element) {\n      if (!element) {\n        return doc;\n      }\n      if (element.nodeType === 9) {\n        return element;\n      }\n      return element.ownerDocument;\n    };\n    DomQueryConstructor.fn = DomQueryConstructor.prototype = {\n      constructor: DomQueryConstructor,\n      selector: '',\n      context: null,\n      length: 0,\n      init: function (selector, context) {\n        var self = this;\n        var match, node;\n        if (!selector) {\n          return self;\n        }\n        if (selector.nodeType) {\n          self.context = self[0] = selector;\n          self.length = 1;\n          return self;\n        }\n        if (context && context.nodeType) {\n          self.context = context;\n        } else {\n          if (context) {\n            return DomQuery(selector).attr(context);\n          }\n          self.context = context = document;\n        }\n        if (isString$1(selector)) {\n          self.selector = selector;\n          if (selector.charAt(0) === '<' && selector.charAt(selector.length - 1) === '>' && selector.length >= 3) {\n            match = [\n              null,\n              selector,\n              null\n            ];\n          } else {\n            match = rquickExpr$1.exec(selector);\n          }\n          if (match) {\n            if (match[1]) {\n              node = createFragment(selector, getElementDocument(context)).firstChild;\n              while (node) {\n                push$1.call(self, node);\n                node = node.nextSibling;\n              }\n            } else {\n              node = getElementDocument(context).getElementById(match[2]);\n              if (!node) {\n                return self;\n              }\n              if (node.id !== match[2]) {\n                return self.find(selector);\n              }\n              self.length = 1;\n              self[0] = node;\n            }\n          } else {\n            return DomQuery(context).find(selector);\n          }\n        } else {\n          this.add(selector, false);\n        }\n        return self;\n      },\n      toArray: function () {\n        return Tools.toArray(this);\n      },\n      add: function (items, sort) {\n        var self = this;\n        var nodes, i;\n        if (isString$1(items)) {\n          return self.add(DomQuery(items));\n        }\n        if (sort !== false) {\n          nodes = DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));\n          self.length = nodes.length;\n          for (i = 0; i < nodes.length; i++) {\n            self[i] = nodes[i];\n          }\n        } else {\n          push$1.apply(self, DomQuery.makeArray(items));\n        }\n        return self;\n      },\n      attr: function (name, value) {\n        var self = this;\n        var hook;\n        if (typeof name === 'object') {\n          each$4(name, function (name, value) {\n            self.attr(name, value);\n          });\n        } else if (isDefined(value)) {\n          this.each(function () {\n            var hook;\n            if (this.nodeType === 1) {\n              hook = attrHooks[name];\n              if (hook && hook.set) {\n                hook.set(this, value);\n                return;\n              }\n              if (value === null) {\n                this.removeAttribute(name, 2);\n              } else {\n                this.setAttribute(name, value, 2);\n              }\n            }\n          });\n        } else {\n          if (self[0] && self[0].nodeType === 1) {\n            hook = attrHooks[name];\n            if (hook && hook.get) {\n              return hook.get(self[0], name);\n            }\n            if (booleanMap[name]) {\n              return self.prop(name) ? name : undefined;\n            }\n            value = self[0].getAttribute(name, 2);\n            if (value === null) {\n              value = undefined;\n            }\n          }\n          return value;\n        }\n        return self;\n      },\n      removeAttr: function (name) {\n        return this.attr(name, null);\n      },\n      prop: function (name, value) {\n        var self = this;\n        name = propFix[name] || name;\n        if (typeof name === 'object') {\n          each$4(name, function (name, value) {\n            self.prop(name, value);\n          });\n        } else if (isDefined(value)) {\n          this.each(function () {\n            if (this.nodeType === 1) {\n              this[name] = value;\n            }\n          });\n        } else {\n          if (self[0] && self[0].nodeType && name in self[0]) {\n            return self[0][name];\n          }\n          return value;\n        }\n        return self;\n      },\n      css: function (name, value) {\n        var self = this;\n        var elm, hook;\n        var camel = function (name) {\n          return name.replace(/-(\\D)/g, function (a, b) {\n            return b.toUpperCase();\n          });\n        };\n        var dashed = function (name) {\n          return name.replace(/[A-Z]/g, function (a) {\n            return '-' + a;\n          });\n        };\n        if (typeof name === 'object') {\n          each$4(name, function (name, value) {\n            self.css(name, value);\n          });\n        } else {\n          if (isDefined(value)) {\n            name = camel(name);\n            if (typeof value === 'number' && !numericCssMap[name]) {\n              value = value.toString() + 'px';\n            }\n            self.each(function () {\n              var style = this.style;\n              hook = cssHooks[name];\n              if (hook && hook.set) {\n                hook.set(this, value);\n                return;\n              }\n              try {\n                this.style[cssFix[name] || name] = value;\n              } catch (ex) {\n              }\n              if (value === null || value === '') {\n                if (style.removeProperty) {\n                  style.removeProperty(dashed(name));\n                } else {\n                  style.removeAttribute(name);\n                }\n              }\n            });\n          } else {\n            elm = self[0];\n            hook = cssHooks[name];\n            if (hook && hook.get) {\n              return hook.get(elm);\n            }\n            if (elm.ownerDocument.defaultView) {\n              try {\n                return elm.ownerDocument.defaultView.getComputedStyle(elm, null).getPropertyValue(dashed(name));\n              } catch (ex) {\n                return undefined;\n              }\n            } else if (elm.currentStyle) {\n              return elm.currentStyle[camel(name)];\n            } else {\n              return '';\n            }\n          }\n        }\n        return self;\n      },\n      remove: function () {\n        var self = this;\n        var node, i = this.length;\n        while (i--) {\n          node = self[i];\n          Event.clean(node);\n          if (node.parentNode) {\n            node.parentNode.removeChild(node);\n          }\n        }\n        return this;\n      },\n      empty: function () {\n        var self = this;\n        var node, i = this.length;\n        while (i--) {\n          node = self[i];\n          while (node.firstChild) {\n            node.removeChild(node.firstChild);\n          }\n        }\n        return this;\n      },\n      html: function (value) {\n        var self = this;\n        var i;\n        if (isDefined(value)) {\n          i = self.length;\n          try {\n            while (i--) {\n              self[i].innerHTML = value;\n            }\n          } catch (ex) {\n            DomQuery(self[i]).empty().append(value);\n          }\n          return self;\n        }\n        return self[0] ? self[0].innerHTML : '';\n      },\n      text: function (value) {\n        var self = this;\n        var i;\n        if (isDefined(value)) {\n          i = self.length;\n          while (i--) {\n            if ('innerText' in self[i]) {\n              self[i].innerText = value;\n            } else {\n              self[0].textContent = value;\n            }\n          }\n          return self;\n        }\n        return self[0] ? self[0].innerText || self[0].textContent : '';\n      },\n      append: function () {\n        return domManipulate(this, arguments, function (node) {\n          if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\n            this.appendChild(node);\n          }\n        });\n      },\n      prepend: function () {\n        return domManipulate(this, arguments, function (node) {\n          if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\n            this.insertBefore(node, this.firstChild);\n          }\n        }, true);\n      },\n      before: function () {\n        var self = this;\n        if (self[0] && self[0].parentNode) {\n          return domManipulate(self, arguments, function (node) {\n            this.parentNode.insertBefore(node, this);\n          });\n        }\n        return self;\n      },\n      after: function () {\n        var self = this;\n        if (self[0] && self[0].parentNode) {\n          return domManipulate(self, arguments, function (node) {\n            this.parentNode.insertBefore(node, this.nextSibling);\n          }, true);\n        }\n        return self;\n      },\n      appendTo: function (val) {\n        DomQuery(val).append(this);\n        return this;\n      },\n      prependTo: function (val) {\n        DomQuery(val).prepend(this);\n        return this;\n      },\n      replaceWith: function (content) {\n        return this.before(content).remove();\n      },\n      wrap: function (content) {\n        return wrap$1(this, content);\n      },\n      wrapAll: function (content) {\n        return wrap$1(this, content, true);\n      },\n      wrapInner: function (content) {\n        this.each(function () {\n          DomQuery(this).contents().wrapAll(content);\n        });\n        return this;\n      },\n      unwrap: function () {\n        return this.parent().each(function () {\n          DomQuery(this).replaceWith(this.childNodes);\n        });\n      },\n      clone: function () {\n        var result = [];\n        this.each(function () {\n          result.push(this.cloneNode(true));\n        });\n        return DomQuery(result);\n      },\n      addClass: function (className) {\n        return this.toggleClass(className, true);\n      },\n      removeClass: function (className) {\n        return this.toggleClass(className, false);\n      },\n      toggleClass: function (className, state) {\n        var self = this;\n        if (typeof className !== 'string') {\n          return self;\n        }\n        if (className.indexOf(' ') !== -1) {\n          each$4(className.split(' '), function () {\n            self.toggleClass(this, state);\n          });\n        } else {\n          self.each(function (index, node) {\n            var classState = hasClass(node, className);\n            if (classState !== state) {\n              var existingClassName = node.className;\n              if (classState) {\n                node.className = trim$3((' ' + existingClassName + ' ').replace(' ' + className + ' ', ' '));\n              } else {\n                node.className += existingClassName ? ' ' + className : className;\n              }\n            }\n          });\n        }\n        return self;\n      },\n      hasClass: function (className) {\n        return hasClass(this[0], className);\n      },\n      each: function (callback) {\n        return each$4(this, callback);\n      },\n      on: function (name, callback) {\n        return this.each(function () {\n          Event.bind(this, name, callback);\n        });\n      },\n      off: function (name, callback) {\n        return this.each(function () {\n          Event.unbind(this, name, callback);\n        });\n      },\n      trigger: function (name) {\n        return this.each(function () {\n          if (typeof name === 'object') {\n            Event.fire(this, name.type, name);\n          } else {\n            Event.fire(this, name);\n          }\n        });\n      },\n      show: function () {\n        return this.css('display', '');\n      },\n      hide: function () {\n        return this.css('display', 'none');\n      },\n      slice: function () {\n        return new DomQuery(slice$1.apply(this, arguments));\n      },\n      eq: function (index) {\n        return index === -1 ? this.slice(index) : this.slice(index, +index + 1);\n      },\n      first: function () {\n        return this.eq(0);\n      },\n      last: function () {\n        return this.eq(-1);\n      },\n      find: function (selector) {\n        var i, l;\n        var ret = [];\n        for (i = 0, l = this.length; i < l; i++) {\n          DomQuery.find(selector, this[i], ret);\n        }\n        return DomQuery(ret);\n      },\n      filter: function (selector) {\n        if (typeof selector === 'function') {\n          return DomQuery(grep(this.toArray(), function (item, i) {\n            return selector(i, item);\n          }));\n        }\n        return DomQuery(DomQuery.filter(selector, this.toArray()));\n      },\n      closest: function (selector) {\n        var result = [];\n        if (selector instanceof DomQuery) {\n          selector = selector[0];\n        }\n        this.each(function (i, node) {\n          while (node) {\n            if (typeof selector === 'string' && DomQuery(node).is(selector)) {\n              result.push(node);\n              break;\n            } else if (node === selector) {\n              result.push(node);\n              break;\n            }\n            node = node.parentNode;\n          }\n        });\n        return DomQuery(result);\n      },\n      offset: function (offset) {\n        var elm, doc, docElm;\n        var x = 0, y = 0, pos;\n        if (!offset) {\n          elm = this[0];\n          if (elm) {\n            doc = elm.ownerDocument;\n            docElm = doc.documentElement;\n            if (elm.getBoundingClientRect) {\n              pos = elm.getBoundingClientRect();\n              x = pos.left + (docElm.scrollLeft || doc.body.scrollLeft) - docElm.clientLeft;\n              y = pos.top + (docElm.scrollTop || doc.body.scrollTop) - docElm.clientTop;\n            }\n          }\n          return {\n            left: x,\n            top: y\n          };\n        }\n        return this.css(offset);\n      },\n      push: push$1,\n      sort: Array.prototype.sort,\n      splice: Array.prototype.splice\n    };\n    Tools.extend(DomQueryConstructor, {\n      extend: Tools.extend,\n      makeArray: function (object) {\n        if (isWindow(object) || object.nodeType) {\n          return [object];\n        }\n        return Tools.toArray(object);\n      },\n      inArray: inArray$1,\n      isArray: Tools.isArray,\n      each: each$4,\n      trim: trim$3,\n      grep: grep,\n      find: Sizzle,\n      expr: Sizzle.selectors,\n      unique: Sizzle.uniqueSort,\n      text: Sizzle.getText,\n      contains: Sizzle.contains,\n      filter: function (expr, elems, not) {\n        var i = elems.length;\n        if (not) {\n          expr = ':not(' + expr + ')';\n        }\n        while (i--) {\n          if (elems[i].nodeType !== 1) {\n            elems.splice(i, 1);\n          }\n        }\n        if (elems.length === 1) {\n          elems = DomQuery.find.matchesSelector(elems[0], expr) ? [elems[0]] : [];\n        } else {\n          elems = DomQuery.find.matches(expr, elems);\n        }\n        return elems;\n      }\n    });\n    var dir = function (el, prop, until) {\n      var matched = [];\n      var cur = el[prop];\n      if (typeof until !== 'string' && until instanceof DomQuery) {\n        until = until[0];\n      }\n      while (cur && cur.nodeType !== 9) {\n        if (until !== undefined) {\n          if (cur === until) {\n            break;\n          }\n          if (typeof until === 'string' && DomQuery(cur).is(until)) {\n            break;\n          }\n        }\n        if (cur.nodeType === 1) {\n          matched.push(cur);\n        }\n        cur = cur[prop];\n      }\n      return matched;\n    };\n    var sibling$1 = function (node, siblingName, nodeType, until) {\n      var result = [];\n      if (until instanceof DomQuery) {\n        until = until[0];\n      }\n      for (; node; node = node[siblingName]) {\n        if (nodeType && node.nodeType !== nodeType) {\n          continue;\n        }\n        if (until !== undefined) {\n          if (node === until) {\n            break;\n          }\n          if (typeof until === 'string' && DomQuery(node).is(until)) {\n            break;\n          }\n        }\n        result.push(node);\n      }\n      return result;\n    };\n    var firstSibling = function (node, siblingName, nodeType) {\n      for (node = node[siblingName]; node; node = node[siblingName]) {\n        if (node.nodeType === nodeType) {\n          return node;\n        }\n      }\n      return null;\n    };\n    each$4({\n      parent: function (node) {\n        var parent = node.parentNode;\n        return parent && parent.nodeType !== 11 ? parent : null;\n      },\n      parents: function (node) {\n        return dir(node, 'parentNode');\n      },\n      next: function (node) {\n        return firstSibling(node, 'nextSibling', 1);\n      },\n      prev: function (node) {\n        return firstSibling(node, 'previousSibling', 1);\n      },\n      children: function (node) {\n        return sibling$1(node.firstChild, 'nextSibling', 1);\n      },\n      contents: function (node) {\n        return Tools.toArray((node.nodeName === 'iframe' ? node.contentDocument || node.contentWindow.document : node).childNodes);\n      }\n    }, function (name, fn) {\n      DomQueryConstructor.fn[name] = function (selector) {\n        var self = this;\n        var result = [];\n        self.each(function () {\n          var nodes = fn.call(result, this, selector, result);\n          if (nodes) {\n            if (DomQuery.isArray(nodes)) {\n              result.push.apply(result, nodes);\n            } else {\n              result.push(nodes);\n            }\n          }\n        });\n        if (this.length > 1) {\n          if (!skipUniques[name]) {\n            result = DomQuery.unique(result);\n          }\n          if (name.indexOf('parents') === 0) {\n            result = result.reverse();\n          }\n        }\n        var wrappedResult = DomQuery(result);\n        if (selector) {\n          return wrappedResult.filter(selector);\n        }\n        return wrappedResult;\n      };\n    });\n    each$4({\n      parentsUntil: function (node, until) {\n        return dir(node, 'parentNode', until);\n      },\n      nextUntil: function (node, until) {\n        return sibling$1(node, 'nextSibling', 1, until).slice(1);\n      },\n      prevUntil: function (node, until) {\n        return sibling$1(node, 'previousSibling', 1, until).slice(1);\n      }\n    }, function (name, fn) {\n      DomQueryConstructor.fn[name] = function (selector, filter) {\n        var self = this;\n        var result = [];\n        self.each(function () {\n          var nodes = fn.call(result, this, selector, result);\n          if (nodes) {\n            if (DomQuery.isArray(nodes)) {\n              result.push.apply(result, nodes);\n            } else {\n              result.push(nodes);\n            }\n          }\n        });\n        if (this.length > 1) {\n          result = DomQuery.unique(result);\n          if (name.indexOf('parents') === 0 || name === 'prevUntil') {\n            result = result.reverse();\n          }\n        }\n        var wrappedResult = DomQuery(result);\n        if (filter) {\n          return wrappedResult.filter(filter);\n        }\n        return wrappedResult;\n      };\n    });\n    DomQueryConstructor.fn.is = function (selector) {\n      return !!selector && this.filter(selector).length > 0;\n    };\n    DomQueryConstructor.fn.init.prototype = DomQueryConstructor.fn;\n    DomQueryConstructor.overrideDefaults = function (callback) {\n      var defaults;\n      var sub = function (selector, context) {\n        defaults = defaults || callback();\n        if (arguments.length === 0) {\n          selector = defaults.element;\n        }\n        if (!context) {\n          context = defaults.context;\n        }\n        return new sub.fn.init(selector, context);\n      };\n      DomQuery.extend(sub, this);\n      return sub;\n    };\n    DomQueryConstructor.attrHooks = attrHooks;\n    DomQueryConstructor.cssHooks = cssHooks;\n    var DomQuery = DomQueryConstructor;\n\n    var each$5 = Tools.each;\n    var grep$1 = Tools.grep;\n    var isIE = Env.ie;\n    var simpleSelectorRe = /^([a-z0-9],?)+$/i;\n    var setupAttrHooks = function (styles, settings, getContext) {\n      var keepValues = settings.keep_values;\n      var keepUrlHook = {\n        set: function ($elm, value, name) {\n          if (settings.url_converter) {\n            value = settings.url_converter.call(settings.url_converter_scope || getContext(), value, name, $elm[0]);\n          }\n          $elm.attr('data-mce-' + name, value).attr(name, value);\n        },\n        get: function ($elm, name) {\n          return $elm.attr('data-mce-' + name) || $elm.attr(name);\n        }\n      };\n      var attrHooks = {\n        style: {\n          set: function ($elm, value) {\n            if (value !== null && typeof value === 'object') {\n              $elm.css(value);\n              return;\n            }\n            if (keepValues) {\n              $elm.attr('data-mce-style', value);\n            }\n            if (value !== null && typeof value === 'string') {\n              $elm.removeAttr('style');\n              $elm.css(styles.parse(value));\n            } else {\n              $elm.attr('style', value);\n            }\n          },\n          get: function ($elm) {\n            var value = $elm.attr('data-mce-style') || $elm.attr('style');\n            value = styles.serialize(styles.parse(value), $elm[0].nodeName);\n            return value;\n          }\n        }\n      };\n      if (keepValues) {\n        attrHooks.href = attrHooks.src = keepUrlHook;\n      }\n      return attrHooks;\n    };\n    var updateInternalStyleAttr = function (styles, $elm) {\n      var rawValue = $elm.attr('style');\n      var value = styles.serialize(styles.parse(rawValue), $elm[0].nodeName);\n      if (!value) {\n        value = null;\n      }\n      $elm.attr('data-mce-style', value);\n    };\n    var findNodeIndex = function (node, normalized) {\n      var idx = 0, lastNodeType, nodeType;\n      if (node) {\n        for (lastNodeType = node.nodeType, node = node.previousSibling; node; node = node.previousSibling) {\n          nodeType = node.nodeType;\n          if (normalized && nodeType === 3) {\n            if (nodeType === lastNodeType || !node.nodeValue.length) {\n              continue;\n            }\n          }\n          idx++;\n          lastNodeType = nodeType;\n        }\n      }\n      return idx;\n    };\n    function DOMUtils(doc, settings) {\n      var _this = this;\n      if (settings === void 0) {\n        settings = {};\n      }\n      var addedStyles = {};\n      var win = window;\n      var files = {};\n      var counter = 0;\n      var stdMode = true;\n      var boxModel = true;\n      var styleSheetLoader = instance.forElement(SugarElement.fromDom(doc), {\n        contentCssCors: settings.contentCssCors,\n        referrerPolicy: settings.referrerPolicy\n      });\n      var boundEvents = [];\n      var schema = settings.schema ? settings.schema : Schema({});\n      var styles = Styles({\n        url_converter: settings.url_converter,\n        url_converter_scope: settings.url_converter_scope\n      }, settings.schema);\n      var events = settings.ownEvents ? new EventUtils() : EventUtils.Event;\n      var blockElementsMap = schema.getBlockElements();\n      var $ = DomQuery.overrideDefaults(function () {\n        return {\n          context: doc,\n          element: self.getRoot()\n        };\n      });\n      var isBlock = function (node) {\n        if (typeof node === 'string') {\n          return !!blockElementsMap[node];\n        } else if (node) {\n          var type = node.nodeType;\n          if (type) {\n            return !!(type === 1 && blockElementsMap[node.nodeName]);\n          }\n        }\n        return false;\n      };\n      var get = function (elm) {\n        return elm && doc && isString(elm) ? doc.getElementById(elm) : elm;\n      };\n      var $$ = function (elm) {\n        return $(typeof elm === 'string' ? get(elm) : elm);\n      };\n      var getAttrib = function (elm, name, defaultVal) {\n        var hook, value;\n        var $elm = $$(elm);\n        if ($elm.length) {\n          hook = attrHooks[name];\n          if (hook && hook.get) {\n            value = hook.get($elm, name);\n          } else {\n            value = $elm.attr(name);\n          }\n        }\n        if (typeof value === 'undefined') {\n          value = defaultVal || '';\n        }\n        return value;\n      };\n      var getAttribs = function (elm) {\n        var node = get(elm);\n        if (!node) {\n          return [];\n        }\n        return node.attributes;\n      };\n      var setAttrib = function (elm, name, value) {\n        if (value === '') {\n          value = null;\n        }\n        var $elm = $$(elm);\n        var originalValue = $elm.attr(name);\n        if (!$elm.length) {\n          return;\n        }\n        var hook = attrHooks[name];\n        if (hook && hook.set) {\n          hook.set($elm, value, name);\n        } else {\n          $elm.attr(name, value);\n        }\n        if (originalValue !== value && settings.onSetAttrib) {\n          settings.onSetAttrib({\n            attrElm: $elm,\n            attrName: name,\n            attrValue: value\n          });\n        }\n      };\n      var clone = function (node, deep) {\n        if (!isIE || node.nodeType !== 1 || deep) {\n          return node.cloneNode(deep);\n        } else {\n          var clone_1 = doc.createElement(node.nodeName);\n          each$5(getAttribs(node), function (attr) {\n            setAttrib(clone_1, attr.nodeName, getAttrib(node, attr.nodeName));\n          });\n          return clone_1;\n        }\n      };\n      var getRoot = function () {\n        return settings.root_element || doc.body;\n      };\n      var getViewPort = function (argWin) {\n        var vp = getBounds(argWin);\n        return {\n          x: vp.x,\n          y: vp.y,\n          w: vp.width,\n          h: vp.height\n        };\n      };\n      var getPos$1 = function (elm, rootElm) {\n        return getPos(doc.body, get(elm), rootElm);\n      };\n      var setStyle = function (elm, name, value) {\n        var $elm = isString(name) ? $$(elm).css(name, value) : $$(elm).css(name);\n        if (settings.update_styles) {\n          updateInternalStyleAttr(styles, $elm);\n        }\n      };\n      var setStyles = function (elm, stylesArg) {\n        var $elm = $$(elm).css(stylesArg);\n        if (settings.update_styles) {\n          updateInternalStyleAttr(styles, $elm);\n        }\n      };\n      var getStyle = function (elm, name, computed) {\n        var $elm = $$(elm);\n        if (computed) {\n          return $elm.css(name);\n        }\n        name = name.replace(/-(\\D)/g, function (a, b) {\n          return b.toUpperCase();\n        });\n        if (name === 'float') {\n          name = Env.browser.isIE() ? 'styleFloat' : 'cssFloat';\n        }\n        return $elm[0] && $elm[0].style ? $elm[0].style[name] : undefined;\n      };\n      var getSize = function (elm) {\n        var w, h;\n        elm = get(elm);\n        w = getStyle(elm, 'width');\n        h = getStyle(elm, 'height');\n        if (w.indexOf('px') === -1) {\n          w = 0;\n        }\n        if (h.indexOf('px') === -1) {\n          h = 0;\n        }\n        return {\n          w: parseInt(w, 10) || elm.offsetWidth || elm.clientWidth,\n          h: parseInt(h, 10) || elm.offsetHeight || elm.clientHeight\n        };\n      };\n      var getRect = function (elm) {\n        elm = get(elm);\n        var pos = getPos$1(elm);\n        var size = getSize(elm);\n        return {\n          x: pos.x,\n          y: pos.y,\n          w: size.w,\n          h: size.h\n        };\n      };\n      var is = function (elm, selector) {\n        var i;\n        if (!elm) {\n          return false;\n        }\n        if (!Array.isArray(elm)) {\n          if (selector === '*') {\n            return elm.nodeType === 1;\n          }\n          if (simpleSelectorRe.test(selector)) {\n            var selectors = selector.toLowerCase().split(/,/);\n            var elmName = elm.nodeName.toLowerCase();\n            for (i = selectors.length - 1; i >= 0; i--) {\n              if (selectors[i] === elmName) {\n                return true;\n              }\n            }\n            return false;\n          }\n          if (elm.nodeType && elm.nodeType !== 1) {\n            return false;\n          }\n        }\n        var elms = !Array.isArray(elm) ? [elm] : elm;\n        return Sizzle(selector, elms[0].ownerDocument || elms[0], null, elms).length > 0;\n      };\n      var getParents = function (elm, selector, root, collect) {\n        var result = [];\n        var selectorVal;\n        var node = get(elm);\n        collect = collect === undefined;\n        root = root || (getRoot().nodeName !== 'BODY' ? getRoot().parentNode : null);\n        if (Tools.is(selector, 'string')) {\n          selectorVal = selector;\n          if (selector === '*') {\n            selector = function (node) {\n              return node.nodeType === 1;\n            };\n          } else {\n            selector = function (node) {\n              return is(node, selectorVal);\n            };\n          }\n        }\n        while (node) {\n          if (node === root || isNullable(node.nodeType) || isDocument$1(node) || isDocumentFragment$1(node)) {\n            break;\n          }\n          if (!selector || typeof selector === 'function' && selector(node)) {\n            if (collect) {\n              result.push(node);\n            } else {\n              return [node];\n            }\n          }\n          node = node.parentNode;\n        }\n        return collect ? result : null;\n      };\n      var getParent = function (node, selector, root) {\n        var parents = getParents(node, selector, root, false);\n        return parents && parents.length > 0 ? parents[0] : null;\n      };\n      var _findSib = function (node, selector, name) {\n        var func = selector;\n        if (node) {\n          if (typeof selector === 'string') {\n            func = function (node) {\n              return is(node, selector);\n            };\n          }\n          for (node = node[name]; node; node = node[name]) {\n            if (typeof func === 'function' && func(node)) {\n              return node;\n            }\n          }\n        }\n        return null;\n      };\n      var getNext = function (node, selector) {\n        return _findSib(node, selector, 'nextSibling');\n      };\n      var getPrev = function (node, selector) {\n        return _findSib(node, selector, 'previousSibling');\n      };\n      var select = function (selector, scope) {\n        return Sizzle(selector, get(scope) || settings.root_element || doc, []);\n      };\n      var run = function (elm, func, scope) {\n        var result;\n        var node = typeof elm === 'string' ? get(elm) : elm;\n        if (!node) {\n          return false;\n        }\n        if (Tools.isArray(node) && (node.length || node.length === 0)) {\n          result = [];\n          each$5(node, function (elm, i) {\n            if (elm) {\n              result.push(func.call(scope, typeof elm === 'string' ? get(elm) : elm, i));\n            }\n          });\n          return result;\n        }\n        var context = scope ? scope : _this;\n        return func.call(context, node);\n      };\n      var setAttribs = function (elm, attrs) {\n        $$(elm).each(function (i, node) {\n          each$5(attrs, function (value, name) {\n            setAttrib(node, name, value);\n          });\n        });\n      };\n      var setHTML = function (elm, html) {\n        var $elm = $$(elm);\n        if (isIE) {\n          $elm.each(function (i, target) {\n            if (target.canHaveHTML === false) {\n              return;\n            }\n            while (target.firstChild) {\n              target.removeChild(target.firstChild);\n            }\n            try {\n              target.innerHTML = '<br>' + html;\n              target.removeChild(target.firstChild);\n            } catch (ex) {\n              DomQuery('<div></div>').html('<br>' + html).contents().slice(1).appendTo(target);\n            }\n            return html;\n          });\n        } else {\n          $elm.html(html);\n        }\n      };\n      var add = function (parentElm, name, attrs, html, create) {\n        return run(parentElm, function (parentElm) {\n          var newElm = typeof name === 'string' ? doc.createElement(name) : name;\n          setAttribs(newElm, attrs);\n          if (html) {\n            if (typeof html !== 'string' && html.nodeType) {\n              newElm.appendChild(html);\n            } else if (typeof html === 'string') {\n              setHTML(newElm, html);\n            }\n          }\n          return !create ? parentElm.appendChild(newElm) : newElm;\n        });\n      };\n      var create = function (name, attrs, html) {\n        return add(doc.createElement(name), name, attrs, html, true);\n      };\n      var decode = Entities.decode;\n      var encode = Entities.encodeAllRaw;\n      var createHTML = function (name, attrs, html) {\n        var outHtml = '', key;\n        outHtml += '<' + name;\n        for (key in attrs) {\n          if (attrs.hasOwnProperty(key) && attrs[key] !== null && typeof attrs[key] !== 'undefined') {\n            outHtml += ' ' + key + '=\"' + encode(attrs[key]) + '\"';\n          }\n        }\n        if (typeof html !== 'undefined') {\n          return outHtml + '>' + html + '</' + name + '>';\n        }\n        return outHtml + ' />';\n      };\n      var createFragment = function (html) {\n        var node;\n        var container = doc.createElement('div');\n        var frag = doc.createDocumentFragment();\n        frag.appendChild(container);\n        if (html) {\n          container.innerHTML = html;\n        }\n        while (node = container.firstChild) {\n          frag.appendChild(node);\n        }\n        frag.removeChild(container);\n        return frag;\n      };\n      var remove = function (node, keepChildren) {\n        var $node = $$(node);\n        if (keepChildren) {\n          $node.each(function () {\n            var child;\n            while (child = this.firstChild) {\n              if (child.nodeType === 3 && child.data.length === 0) {\n                this.removeChild(child);\n              } else {\n                this.parentNode.insertBefore(child, this);\n              }\n            }\n          }).remove();\n        } else {\n          $node.remove();\n        }\n        return $node.length > 1 ? $node.toArray() : $node[0];\n      };\n      var removeAllAttribs = function (e) {\n        return run(e, function (e) {\n          var i;\n          var attrs = e.attributes;\n          for (i = attrs.length - 1; i >= 0; i--) {\n            e.removeAttributeNode(attrs.item(i));\n          }\n        });\n      };\n      var parseStyle = function (cssText) {\n        return styles.parse(cssText);\n      };\n      var serializeStyle = function (stylesArg, name) {\n        return styles.serialize(stylesArg, name);\n      };\n      var addStyle = function (cssText) {\n        var head, styleElm;\n        if (self !== DOMUtils.DOM && doc === document) {\n          if (addedStyles[cssText]) {\n            return;\n          }\n          addedStyles[cssText] = true;\n        }\n        styleElm = doc.getElementById('mceDefaultStyles');\n        if (!styleElm) {\n          styleElm = doc.createElement('style');\n          styleElm.id = 'mceDefaultStyles';\n          styleElm.type = 'text/css';\n          head = doc.getElementsByTagName('head')[0];\n          if (head.firstChild) {\n            head.insertBefore(styleElm, head.firstChild);\n          } else {\n            head.appendChild(styleElm);\n          }\n        }\n        if (styleElm.styleSheet) {\n          styleElm.styleSheet.cssText += cssText;\n        } else {\n          styleElm.appendChild(doc.createTextNode(cssText));\n        }\n      };\n      var loadCSS = function (urls) {\n        if (!urls) {\n          urls = '';\n        }\n        each(urls.split(','), function (url) {\n          files[url] = true;\n          styleSheetLoader.load(url, noop);\n        });\n      };\n      var toggleClass = function (elm, cls, state) {\n        $$(elm).toggleClass(cls, state).each(function () {\n          if (this.className === '') {\n            DomQuery(this).attr('class', null);\n          }\n        });\n      };\n      var addClass = function (elm, cls) {\n        $$(elm).addClass(cls);\n      };\n      var removeClass = function (elm, cls) {\n        toggleClass(elm, cls, false);\n      };\n      var hasClass = function (elm, cls) {\n        return $$(elm).hasClass(cls);\n      };\n      var show = function (elm) {\n        $$(elm).show();\n      };\n      var hide = function (elm) {\n        $$(elm).hide();\n      };\n      var isHidden = function (elm) {\n        return $$(elm).css('display') === 'none';\n      };\n      var uniqueId = function (prefix) {\n        return (!prefix ? 'mce_' : prefix) + counter++;\n      };\n      var getOuterHTML = function (elm) {\n        var node = typeof elm === 'string' ? get(elm) : elm;\n        return isElement$1(node) ? node.outerHTML : DomQuery('<div></div>').append(DomQuery(node).clone()).html();\n      };\n      var setOuterHTML = function (elm, html) {\n        $$(elm).each(function () {\n          try {\n            if ('outerHTML' in this) {\n              this.outerHTML = html;\n              return;\n            }\n          } catch (ex) {\n          }\n          remove(DomQuery(this).html(html), true);\n        });\n      };\n      var insertAfter = function (node, reference) {\n        var referenceNode = get(reference);\n        return run(node, function (node) {\n          var parent = referenceNode.parentNode;\n          var nextSibling = referenceNode.nextSibling;\n          if (nextSibling) {\n            parent.insertBefore(node, nextSibling);\n          } else {\n            parent.appendChild(node);\n          }\n          return node;\n        });\n      };\n      var replace = function (newElm, oldElm, keepChildren) {\n        return run(oldElm, function (oldElm) {\n          if (Tools.is(oldElm, 'array')) {\n            newElm = newElm.cloneNode(true);\n          }\n          if (keepChildren) {\n            each$5(grep$1(oldElm.childNodes), function (node) {\n              newElm.appendChild(node);\n            });\n          }\n          return oldElm.parentNode.replaceChild(newElm, oldElm);\n        });\n      };\n      var rename = function (elm, name) {\n        var newElm;\n        if (elm.nodeName !== name.toUpperCase()) {\n          newElm = create(name);\n          each$5(getAttribs(elm), function (attrNode) {\n            setAttrib(newElm, attrNode.nodeName, getAttrib(elm, attrNode.nodeName));\n          });\n          replace(newElm, elm, true);\n        }\n        return newElm || elm;\n      };\n      var findCommonAncestor = function (a, b) {\n        var ps = a, pe;\n        while (ps) {\n          pe = b;\n          while (pe && ps !== pe) {\n            pe = pe.parentNode;\n          }\n          if (ps === pe) {\n            break;\n          }\n          ps = ps.parentNode;\n        }\n        if (!ps && a.ownerDocument) {\n          return a.ownerDocument.documentElement;\n        }\n        return ps;\n      };\n      var toHex = function (rgbVal) {\n        return styles.toHex(Tools.trim(rgbVal));\n      };\n      var isNonEmptyElement = function (node) {\n        if (isElement$1(node)) {\n          var isNamedAnchor = node.nodeName.toLowerCase() === 'a' && !getAttrib(node, 'href') && getAttrib(node, 'id');\n          if (getAttrib(node, 'name') || getAttrib(node, 'data-mce-bookmark') || isNamedAnchor) {\n            return true;\n          }\n        }\n        return false;\n      };\n      var isEmpty = function (node, elements) {\n        var type, name, brCount = 0;\n        if (isNonEmptyElement(node)) {\n          return false;\n        }\n        node = node.firstChild;\n        if (node) {\n          var walker = new DomTreeWalker(node, node.parentNode);\n          var whitespace = schema ? schema.getWhiteSpaceElements() : {};\n          elements = elements || (schema ? schema.getNonEmptyElements() : null);\n          do {\n            type = node.nodeType;\n            if (isElement$1(node)) {\n              var bogusVal = node.getAttribute('data-mce-bogus');\n              if (bogusVal) {\n                node = walker.next(bogusVal === 'all');\n                continue;\n              }\n              name = node.nodeName.toLowerCase();\n              if (elements && elements[name]) {\n                if (name === 'br') {\n                  brCount++;\n                  node = walker.next();\n                  continue;\n                }\n                return false;\n              }\n              if (isNonEmptyElement(node)) {\n                return false;\n              }\n            }\n            if (type === 8) {\n              return false;\n            }\n            if (type === 3 && !isWhitespaceText(node.nodeValue)) {\n              return false;\n            }\n            if (type === 3 && node.parentNode && whitespace[node.parentNode.nodeName] && isWhitespaceText(node.nodeValue)) {\n              return false;\n            }\n            node = walker.next();\n          } while (node);\n        }\n        return brCount <= 1;\n      };\n      var createRng = function () {\n        return doc.createRange();\n      };\n      var split = function (parentElm, splitElm, replacementElm) {\n        var range = createRng();\n        var beforeFragment;\n        var afterFragment;\n        var parentNode;\n        if (parentElm && splitElm) {\n          range.setStart(parentElm.parentNode, findNodeIndex(parentElm));\n          range.setEnd(splitElm.parentNode, findNodeIndex(splitElm));\n          beforeFragment = range.extractContents();\n          range = createRng();\n          range.setStart(splitElm.parentNode, findNodeIndex(splitElm) + 1);\n          range.setEnd(parentElm.parentNode, findNodeIndex(parentElm) + 1);\n          afterFragment = range.extractContents();\n          parentNode = parentElm.parentNode;\n          parentNode.insertBefore(trimNode(self, beforeFragment), parentElm);\n          if (replacementElm) {\n            parentNode.insertBefore(replacementElm, parentElm);\n          } else {\n            parentNode.insertBefore(splitElm, parentElm);\n          }\n          parentNode.insertBefore(trimNode(self, afterFragment), parentElm);\n          remove(parentElm);\n          return replacementElm || splitElm;\n        }\n      };\n      var bind = function (target, name, func, scope) {\n        if (Tools.isArray(target)) {\n          var i = target.length;\n          var rv = [];\n          while (i--) {\n            rv[i] = bind(target[i], name, func, scope);\n          }\n          return rv;\n        }\n        if (settings.collect && (target === doc || target === win)) {\n          boundEvents.push([\n            target,\n            name,\n            func,\n            scope\n          ]);\n        }\n        var output = events.bind(target, name, func, scope || self);\n        return output;\n      };\n      var unbind = function (target, name, func) {\n        if (Tools.isArray(target)) {\n          var i = target.length;\n          var rv = [];\n          while (i--) {\n            rv[i] = unbind(target[i], name, func);\n          }\n          return rv;\n        } else {\n          if (boundEvents.length > 0 && (target === doc || target === win)) {\n            var i = boundEvents.length;\n            while (i--) {\n              var item = boundEvents[i];\n              if (target === item[0] && (!name || name === item[1]) && (!func || func === item[2])) {\n                events.unbind(item[0], item[1], item[2]);\n              }\n            }\n          }\n          return events.unbind(target, name, func);\n        }\n      };\n      var fire = function (target, name, evt) {\n        return events.fire(target, name, evt);\n      };\n      var getContentEditable = function (node) {\n        if (node && isElement$1(node)) {\n          var contentEditable = node.getAttribute('data-mce-contenteditable');\n          if (contentEditable && contentEditable !== 'inherit') {\n            return contentEditable;\n          }\n          return node.contentEditable !== 'inherit' ? node.contentEditable : null;\n        } else {\n          return null;\n        }\n      };\n      var getContentEditableParent = function (node) {\n        var root = getRoot();\n        var state = null;\n        for (; node && node !== root; node = node.parentNode) {\n          state = getContentEditable(node);\n          if (state !== null) {\n            break;\n          }\n        }\n        return state;\n      };\n      var destroy = function () {\n        if (boundEvents.length > 0) {\n          var i = boundEvents.length;\n          while (i--) {\n            var item = boundEvents[i];\n            events.unbind(item[0], item[1], item[2]);\n          }\n        }\n        each$1(files, function (_, url) {\n          styleSheetLoader.unload(url);\n          delete files[url];\n        });\n        if (Sizzle.setDocument) {\n          Sizzle.setDocument();\n        }\n      };\n      var isChildOf = function (node, parent) {\n        while (node) {\n          if (parent === node) {\n            return true;\n          }\n          node = node.parentNode;\n        }\n        return false;\n      };\n      var dumpRng = function (r) {\n        return 'startContainer: ' + r.startContainer.nodeName + ', startOffset: ' + r.startOffset + ', endContainer: ' + r.endContainer.nodeName + ', endOffset: ' + r.endOffset;\n      };\n      var self = {\n        doc: doc,\n        settings: settings,\n        win: win,\n        files: files,\n        stdMode: stdMode,\n        boxModel: boxModel,\n        styleSheetLoader: styleSheetLoader,\n        boundEvents: boundEvents,\n        styles: styles,\n        schema: schema,\n        events: events,\n        isBlock: isBlock,\n        $: $,\n        $$: $$,\n        root: null,\n        clone: clone,\n        getRoot: getRoot,\n        getViewPort: getViewPort,\n        getRect: getRect,\n        getSize: getSize,\n        getParent: getParent,\n        getParents: getParents,\n        get: get,\n        getNext: getNext,\n        getPrev: getPrev,\n        select: select,\n        is: is,\n        add: add,\n        create: create,\n        createHTML: createHTML,\n        createFragment: createFragment,\n        remove: remove,\n        setStyle: setStyle,\n        getStyle: getStyle,\n        setStyles: setStyles,\n        removeAllAttribs: removeAllAttribs,\n        setAttrib: setAttrib,\n        setAttribs: setAttribs,\n        getAttrib: getAttrib,\n        getPos: getPos$1,\n        parseStyle: parseStyle,\n        serializeStyle: serializeStyle,\n        addStyle: addStyle,\n        loadCSS: loadCSS,\n        addClass: addClass,\n        removeClass: removeClass,\n        hasClass: hasClass,\n        toggleClass: toggleClass,\n        show: show,\n        hide: hide,\n        isHidden: isHidden,\n        uniqueId: uniqueId,\n        setHTML: setHTML,\n        getOuterHTML: getOuterHTML,\n        setOuterHTML: setOuterHTML,\n        decode: decode,\n        encode: encode,\n        insertAfter: insertAfter,\n        replace: replace,\n        rename: rename,\n        findCommonAncestor: findCommonAncestor,\n        toHex: toHex,\n        run: run,\n        getAttribs: getAttribs,\n        isEmpty: isEmpty,\n        createRng: createRng,\n        nodeIndex: findNodeIndex,\n        split: split,\n        bind: bind,\n        unbind: unbind,\n        fire: fire,\n        getContentEditable: getContentEditable,\n        getContentEditableParent: getContentEditableParent,\n        destroy: destroy,\n        isChildOf: isChildOf,\n        dumpRng: dumpRng\n      };\n      var attrHooks = setupAttrHooks(styles, settings, function () {\n        return self;\n      });\n      return self;\n    }\n    (function (DOMUtils) {\n      DOMUtils.DOM = DOMUtils(document);\n      DOMUtils.nodeIndex = findNodeIndex;\n    }(DOMUtils || (DOMUtils = {})));\n    var DOMUtils$1 = DOMUtils;\n\n    var DOM = DOMUtils$1.DOM;\n    var each$6 = Tools.each, grep$2 = Tools.grep;\n    var QUEUED = 0;\n    var LOADING = 1;\n    var LOADED = 2;\n    var FAILED = 3;\n    var ScriptLoader = function () {\n      function ScriptLoader(settings) {\n        if (settings === void 0) {\n          settings = {};\n        }\n        this.states = {};\n        this.queue = [];\n        this.scriptLoadedCallbacks = {};\n        this.queueLoadedCallbacks = [];\n        this.loading = 0;\n        this.settings = settings;\n      }\n      ScriptLoader.prototype._setReferrerPolicy = function (referrerPolicy) {\n        this.settings.referrerPolicy = referrerPolicy;\n      };\n      ScriptLoader.prototype.loadScript = function (url, success, failure) {\n        var dom = DOM;\n        var elm;\n        var cleanup = function () {\n          dom.remove(id);\n          if (elm) {\n            elm.onerror = elm.onload = elm = null;\n          }\n        };\n        var done = function () {\n          cleanup();\n          success();\n        };\n        var error = function () {\n          cleanup();\n          if (isFunction(failure)) {\n            failure();\n          } else {\n            if (typeof console !== 'undefined' && console.log) {\n              console.log('Failed to load script: ' + url);\n            }\n          }\n        };\n        var id = dom.uniqueId();\n        elm = document.createElement('script');\n        elm.id = id;\n        elm.type = 'text/javascript';\n        elm.src = Tools._addCacheSuffix(url);\n        if (this.settings.referrerPolicy) {\n          dom.setAttrib(elm, 'referrerpolicy', this.settings.referrerPolicy);\n        }\n        elm.onload = done;\n        elm.onerror = error;\n        (document.getElementsByTagName('head')[0] || document.body).appendChild(elm);\n      };\n      ScriptLoader.prototype.isDone = function (url) {\n        return this.states[url] === LOADED;\n      };\n      ScriptLoader.prototype.markDone = function (url) {\n        this.states[url] = LOADED;\n      };\n      ScriptLoader.prototype.add = function (url, success, scope, failure) {\n        var state = this.states[url];\n        this.queue.push(url);\n        if (state === undefined) {\n          this.states[url] = QUEUED;\n        }\n        if (success) {\n          if (!this.scriptLoadedCallbacks[url]) {\n            this.scriptLoadedCallbacks[url] = [];\n          }\n          this.scriptLoadedCallbacks[url].push({\n            success: success,\n            failure: failure,\n            scope: scope || this\n          });\n        }\n      };\n      ScriptLoader.prototype.load = function (url, success, scope, failure) {\n        return this.add(url, success, scope, failure);\n      };\n      ScriptLoader.prototype.remove = function (url) {\n        delete this.states[url];\n        delete this.scriptLoadedCallbacks[url];\n      };\n      ScriptLoader.prototype.loadQueue = function (success, scope, failure) {\n        this.loadScripts(this.queue, success, scope, failure);\n      };\n      ScriptLoader.prototype.loadScripts = function (scripts, success, scope, failure) {\n        var self = this;\n        var failures = [];\n        var execCallbacks = function (name, url) {\n          each$6(self.scriptLoadedCallbacks[url], function (callback) {\n            if (isFunction(callback[name])) {\n              callback[name].call(callback.scope);\n            }\n          });\n          self.scriptLoadedCallbacks[url] = undefined;\n        };\n        self.queueLoadedCallbacks.push({\n          success: success,\n          failure: failure,\n          scope: scope || this\n        });\n        var loadScripts = function () {\n          var loadingScripts = grep$2(scripts);\n          scripts.length = 0;\n          each$6(loadingScripts, function (url) {\n            if (self.states[url] === LOADED) {\n              execCallbacks('success', url);\n              return;\n            }\n            if (self.states[url] === FAILED) {\n              execCallbacks('failure', url);\n              return;\n            }\n            if (self.states[url] !== LOADING) {\n              self.states[url] = LOADING;\n              self.loading++;\n              self.loadScript(url, function () {\n                self.states[url] = LOADED;\n                self.loading--;\n                execCallbacks('success', url);\n                loadScripts();\n              }, function () {\n                self.states[url] = FAILED;\n                self.loading--;\n                failures.push(url);\n                execCallbacks('failure', url);\n                loadScripts();\n              });\n            }\n          });\n          if (!self.loading) {\n            var notifyCallbacks = self.queueLoadedCallbacks.slice(0);\n            self.queueLoadedCallbacks.length = 0;\n            each$6(notifyCallbacks, function (callback) {\n              if (failures.length === 0) {\n                if (isFunction(callback.success)) {\n                  callback.success.call(callback.scope);\n                }\n              } else {\n                if (isFunction(callback.failure)) {\n                  callback.failure.call(callback.scope, failures);\n                }\n              }\n            });\n          }\n        };\n        loadScripts();\n      };\n      ScriptLoader.ScriptLoader = new ScriptLoader();\n      return ScriptLoader;\n    }();\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      return {\n        get: get,\n        set: set\n      };\n    };\n\n    var isRaw = function (str) {\n      return isObject(str) && has(str, 'raw');\n    };\n    var isTokenised = function (str) {\n      return isArray(str) && str.length > 1;\n    };\n    var data = {};\n    var currentCode = Cell('en');\n    var getLanguageData = function () {\n      return get$1(data, currentCode.get());\n    };\n    var getData = function () {\n      return map$1(data, function (value) {\n        return __assign({}, value);\n      });\n    };\n    var setCode = function (newCode) {\n      if (newCode) {\n        currentCode.set(newCode);\n      }\n    };\n    var getCode = function () {\n      return currentCode.get();\n    };\n    var add = function (code, items) {\n      var langData = data[code];\n      if (!langData) {\n        data[code] = langData = {};\n      }\n      each$1(items, function (translation, name) {\n        langData[name.toLowerCase()] = translation;\n      });\n    };\n    var translate = function (text) {\n      var langData = getLanguageData().getOr({});\n      var toString = function (obj) {\n        if (isFunction(obj)) {\n          return Object.prototype.toString.call(obj);\n        }\n        return !isEmpty(obj) ? '' + obj : '';\n      };\n      var isEmpty = function (text) {\n        return text === '' || text === null || text === undefined;\n      };\n      var getLangData = function (text) {\n        var textstr = toString(text);\n        return get$1(langData, textstr.toLowerCase()).map(toString).getOr(textstr);\n      };\n      var removeContext = function (str) {\n        return str.replace(/{context:\\w+}$/, '');\n      };\n      if (isEmpty(text)) {\n        return '';\n      }\n      if (isRaw(text)) {\n        return toString(text.raw);\n      }\n      if (isTokenised(text)) {\n        var values_1 = text.slice(1);\n        var substitued = getLangData(text[0]).replace(/\\{([0-9]+)\\}/g, function ($1, $2) {\n          return has(values_1, $2) ? toString(values_1[$2]) : $1;\n        });\n        return removeContext(substitued);\n      }\n      return removeContext(getLangData(text));\n    };\n    var isRtl = function () {\n      return getLanguageData().bind(function (items) {\n        return get$1(items, '_dir');\n      }).exists(function (dir) {\n        return dir === 'rtl';\n      });\n    };\n    var hasCode = function (code) {\n      return has(data, code);\n    };\n    var I18n = {\n      getData: getData,\n      setCode: setCode,\n      getCode: getCode,\n      add: add,\n      translate: translate,\n      isRtl: isRtl,\n      hasCode: hasCode\n    };\n\n    function AddOnManager() {\n      var _this = this;\n      var items = [];\n      var urls = {};\n      var lookup = {};\n      var _listeners = [];\n      var runListeners = function (name, state) {\n        var matchedListeners = filter(_listeners, function (listener) {\n          return listener.name === name && listener.state === state;\n        });\n        each(matchedListeners, function (listener) {\n          return listener.callback();\n        });\n      };\n      var get = function (name) {\n        if (lookup[name]) {\n          return lookup[name].instance;\n        }\n        return undefined;\n      };\n      var dependencies = function (name) {\n        var result;\n        if (lookup[name]) {\n          result = lookup[name].dependencies;\n        }\n        return result || [];\n      };\n      var requireLangPack = function (name, languages) {\n        if (AddOnManager.languageLoad !== false) {\n          waitFor(name, function () {\n            var language = I18n.getCode();\n            var wrappedLanguages = ',' + (languages || '') + ',';\n            if (!language || languages && wrappedLanguages.indexOf(',' + language + ',') === -1) {\n              return;\n            }\n            ScriptLoader.ScriptLoader.add(urls[name] + '/langs/' + language + '.js');\n          }, 'loaded');\n        }\n      };\n      var add = function (id, addOn, dependencies) {\n        var addOnConstructor = addOn;\n        items.push(addOnConstructor);\n        lookup[id] = {\n          instance: addOnConstructor,\n          dependencies: dependencies\n        };\n        runListeners(id, 'added');\n        return addOnConstructor;\n      };\n      var remove = function (name) {\n        delete urls[name];\n        delete lookup[name];\n      };\n      var createUrl = function (baseUrl, dep) {\n        if (typeof dep === 'object') {\n          return dep;\n        }\n        return typeof baseUrl === 'string' ? {\n          prefix: '',\n          resource: dep,\n          suffix: ''\n        } : {\n          prefix: baseUrl.prefix,\n          resource: dep,\n          suffix: baseUrl.suffix\n        };\n      };\n      var addComponents = function (pluginName, scripts) {\n        var pluginUrl = _this.urls[pluginName];\n        each(scripts, function (script) {\n          ScriptLoader.ScriptLoader.add(pluginUrl + '/' + script);\n        });\n      };\n      var loadDependencies = function (name, addOnUrl, success, scope) {\n        var deps = dependencies(name);\n        each(deps, function (dep) {\n          var newUrl = createUrl(addOnUrl, dep);\n          load(newUrl.resource, newUrl, undefined, undefined);\n        });\n        if (success) {\n          if (scope) {\n            success.call(scope);\n          } else {\n            success.call(ScriptLoader);\n          }\n        }\n      };\n      var load = function (name, addOnUrl, success, scope, failure) {\n        if (urls[name]) {\n          return;\n        }\n        var urlString = typeof addOnUrl === 'string' ? addOnUrl : addOnUrl.prefix + addOnUrl.resource + addOnUrl.suffix;\n        if (urlString.indexOf('/') !== 0 && urlString.indexOf('://') === -1) {\n          urlString = AddOnManager.baseURL + '/' + urlString;\n        }\n        urls[name] = urlString.substring(0, urlString.lastIndexOf('/'));\n        var done = function () {\n          runListeners(name, 'loaded');\n          loadDependencies(name, addOnUrl, success, scope);\n        };\n        if (lookup[name]) {\n          done();\n        } else {\n          ScriptLoader.ScriptLoader.add(urlString, done, scope, failure);\n        }\n      };\n      var waitFor = function (name, callback, state) {\n        if (state === void 0) {\n          state = 'added';\n        }\n        if (has(lookup, name) && state === 'added') {\n          callback();\n        } else if (has(urls, name) && state === 'loaded') {\n          callback();\n        } else {\n          _listeners.push({\n            name: name,\n            state: state,\n            callback: callback\n          });\n        }\n      };\n      return {\n        items: items,\n        urls: urls,\n        lookup: lookup,\n        _listeners: _listeners,\n        get: get,\n        dependencies: dependencies,\n        requireLangPack: requireLangPack,\n        add: add,\n        remove: remove,\n        createUrl: createUrl,\n        addComponents: addComponents,\n        load: load,\n        waitFor: waitFor\n      };\n    }\n    (function (AddOnManager) {\n      AddOnManager.PluginManager = AddOnManager();\n      AddOnManager.ThemeManager = AddOnManager();\n    }(AddOnManager || (AddOnManager = {})));\n    var AddOnManager$1 = AddOnManager;\n\n    var first = function (fn, rate) {\n      var timer = null;\n      var cancel = function () {\n        if (timer !== null) {\n          clearTimeout(timer);\n          timer = null;\n        }\n      };\n      var throttle = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (timer === null) {\n          timer = setTimeout(function () {\n            fn.apply(null, args);\n            timer = null;\n          }, rate);\n        }\n      };\n      return {\n        cancel: cancel,\n        throttle: throttle\n      };\n    };\n    var last$2 = function (fn, rate) {\n      var timer = null;\n      var cancel = function () {\n        if (timer !== null) {\n          clearTimeout(timer);\n          timer = null;\n        }\n      };\n      var throttle = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (timer !== null) {\n          clearTimeout(timer);\n        }\n        timer = setTimeout(function () {\n          fn.apply(null, args);\n          timer = null;\n        }, rate);\n      };\n      return {\n        cancel: cancel,\n        throttle: throttle\n      };\n    };\n\n    var read = function (element, attr) {\n      var value = get$4(element, attr);\n      return value === undefined || value === '' ? [] : value.split(' ');\n    };\n    var add$1 = function (element, attr, id) {\n      var old = read(element, attr);\n      var nu = old.concat([id]);\n      set(element, attr, nu.join(' '));\n      return true;\n    };\n    var remove$2 = function (element, attr, id) {\n      var nu = filter(read(element, attr), function (v) {\n        return v !== id;\n      });\n      if (nu.length > 0) {\n        set(element, attr, nu.join(' '));\n      } else {\n        remove$1(element, attr);\n      }\n      return false;\n    };\n\n    var supports = function (element) {\n      return element.dom.classList !== undefined;\n    };\n    var get$6 = function (element) {\n      return read(element, 'class');\n    };\n    var add$2 = function (element, clazz) {\n      return add$1(element, 'class', clazz);\n    };\n    var remove$3 = function (element, clazz) {\n      return remove$2(element, 'class', clazz);\n    };\n\n    var add$3 = function (element, clazz) {\n      if (supports(element)) {\n        element.dom.classList.add(clazz);\n      } else {\n        add$2(element, clazz);\n      }\n    };\n    var cleanClass = function (element) {\n      var classList = supports(element) ? element.dom.classList : get$6(element);\n      if (classList.length === 0) {\n        remove$1(element, 'class');\n      }\n    };\n    var remove$4 = function (element, clazz) {\n      if (supports(element)) {\n        var classList = element.dom.classList;\n        classList.remove(clazz);\n      } else {\n        remove$3(element, clazz);\n      }\n      cleanClass(element);\n    };\n    var has$2 = function (element, clazz) {\n      return supports(element) && element.dom.classList.contains(clazz);\n    };\n\n    var descendants = function (scope, predicate) {\n      var result = [];\n      each(children(scope), function (x) {\n        if (predicate(x)) {\n          result = result.concat([x]);\n        }\n        result = result.concat(descendants(x, predicate));\n      });\n      return result;\n    };\n\n    var descendants$1 = function (scope, selector) {\n      return all(selector, scope);\n    };\n\n    var annotation = constant('mce-annotation');\n    var dataAnnotation = constant('data-mce-annotation');\n    var dataAnnotationId = constant('data-mce-annotation-uid');\n\n    var identify = function (editor, annotationName) {\n      var rng = editor.selection.getRng();\n      var start = SugarElement.fromDom(rng.startContainer);\n      var root = SugarElement.fromDom(editor.getBody());\n      var selector = annotationName.fold(function () {\n        return '.' + annotation();\n      }, function (an) {\n        return '[' + dataAnnotation() + '=\"' + an + '\"]';\n      });\n      var newStart = child(start, rng.startOffset).getOr(start);\n      var closest = closest$1(newStart, selector, function (n) {\n        return eq$2(n, root);\n      });\n      var getAttr = function (c, property) {\n        if (has$1(c, property)) {\n          return Optional.some(get$4(c, property));\n        } else {\n          return Optional.none();\n        }\n      };\n      return closest.bind(function (c) {\n        return getAttr(c, '' + dataAnnotationId()).bind(function (uid) {\n          return getAttr(c, '' + dataAnnotation()).map(function (name) {\n            var elements = findMarkers(editor, uid);\n            return {\n              uid: uid,\n              name: name,\n              elements: elements\n            };\n          });\n        });\n      });\n    };\n    var isAnnotation = function (elem) {\n      return isElement(elem) && has$2(elem, annotation());\n    };\n    var findMarkers = function (editor, uid) {\n      var body = SugarElement.fromDom(editor.getBody());\n      return descendants$1(body, '[' + dataAnnotationId() + '=\"' + uid + '\"]');\n    };\n    var findAll = function (editor, name) {\n      var body = SugarElement.fromDom(editor.getBody());\n      var markers = descendants$1(body, '[' + dataAnnotation() + '=\"' + name + '\"]');\n      var directory = {};\n      each(markers, function (m) {\n        var uid = get$4(m, dataAnnotationId());\n        var nodesAlready = directory.hasOwnProperty(uid) ? directory[uid] : [];\n        directory[uid] = nodesAlready.concat([m]);\n      });\n      return directory;\n    };\n\n    var setup = function (editor, _registry) {\n      var changeCallbacks = Cell({});\n      var initData = function () {\n        return {\n          listeners: [],\n          previous: Cell(Optional.none())\n        };\n      };\n      var withCallbacks = function (name, f) {\n        updateCallbacks(name, function (data) {\n          f(data);\n          return data;\n        });\n      };\n      var updateCallbacks = function (name, f) {\n        var callbackMap = changeCallbacks.get();\n        var data = callbackMap.hasOwnProperty(name) ? callbackMap[name] : initData();\n        var outputData = f(data);\n        callbackMap[name] = outputData;\n        changeCallbacks.set(callbackMap);\n      };\n      var fireCallbacks = function (name, uid, elements) {\n        withCallbacks(name, function (data) {\n          each(data.listeners, function (f) {\n            return f(true, name, {\n              uid: uid,\n              nodes: map(elements, function (elem) {\n                return elem.dom;\n              })\n            });\n          });\n        });\n      };\n      var fireNoAnnotation = function (name) {\n        withCallbacks(name, function (data) {\n          each(data.listeners, function (f) {\n            return f(false, name);\n          });\n        });\n      };\n      var onNodeChange = last$2(function () {\n        var callbackMap = changeCallbacks.get();\n        var annotations = sort$1(keys(callbackMap));\n        each(annotations, function (name) {\n          updateCallbacks(name, function (data) {\n            var prev = data.previous.get();\n            identify(editor, Optional.some(name)).fold(function () {\n              if (prev.isSome()) {\n                fireNoAnnotation(name);\n                data.previous.set(Optional.none());\n              }\n            }, function (_a) {\n              var uid = _a.uid, name = _a.name, elements = _a.elements;\n              if (!prev.is(uid)) {\n                fireCallbacks(name, uid, elements);\n                data.previous.set(Optional.some(uid));\n              }\n            });\n            return {\n              previous: data.previous,\n              listeners: data.listeners\n            };\n          });\n        });\n      }, 30);\n      editor.on('remove', function () {\n        onNodeChange.cancel();\n      });\n      editor.on('NodeChange', function () {\n        onNodeChange.throttle();\n      });\n      var addListener = function (name, f) {\n        updateCallbacks(name, function (data) {\n          return {\n            previous: data.previous,\n            listeners: data.listeners.concat([f])\n          };\n        });\n      };\n      return { addListener: addListener };\n    };\n\n    var setup$1 = function (editor, registry) {\n      var identifyParserNode = function (span) {\n        return Optional.from(span.attr(dataAnnotation())).bind(registry.lookup);\n      };\n      editor.on('init', function () {\n        editor.serializer.addNodeFilter('span', function (spans) {\n          each(spans, function (span) {\n            identifyParserNode(span).each(function (settings) {\n              if (settings.persistent === false) {\n                span.unwrap();\n              }\n            });\n          });\n        });\n      });\n    };\n\n    var create$2 = function () {\n      var annotations = {};\n      var register = function (name, settings) {\n        annotations[name] = {\n          name: name,\n          settings: settings\n        };\n      };\n      var lookup = function (name) {\n        return annotations.hasOwnProperty(name) ? Optional.from(annotations[name]).map(function (a) {\n          return a.settings;\n        }) : Optional.none();\n      };\n      return {\n        register: register,\n        lookup: lookup\n      };\n    };\n\n    var unique = 0;\n    var generate$1 = function (prefix) {\n      var date = new Date();\n      var time = date.getTime();\n      var random = Math.floor(Math.random() * 1000000000);\n      unique++;\n      return prefix + '_' + random + unique + String(time);\n    };\n\n    var add$4 = function (element, classes) {\n      each(classes, function (x) {\n        add$3(element, x);\n      });\n    };\n\n    var fromHtml$1 = function (html, scope) {\n      var doc = scope || document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      return children(SugarElement.fromDom(div));\n    };\n\n    var get$7 = function (element) {\n      return element.dom.innerHTML;\n    };\n    var set$1 = function (element, content) {\n      var owner$1 = owner(element);\n      var docDom = owner$1.dom;\n      var fragment = SugarElement.fromDom(docDom.createDocumentFragment());\n      var contentElements = fromHtml$1(content, docDom);\n      append$1(fragment, contentElements);\n      empty(element);\n      append(element, fragment);\n    };\n\n    var clone$1 = function (original, isDeep) {\n      return SugarElement.fromDom(original.dom.cloneNode(isDeep));\n    };\n    var shallow = function (original) {\n      return clone$1(original, false);\n    };\n    var deep = function (original) {\n      return clone$1(original, true);\n    };\n\n    var TextWalker = function (startNode, rootNode, isBoundary) {\n      if (isBoundary === void 0) {\n        isBoundary = never;\n      }\n      var walker = new DomTreeWalker(startNode, rootNode);\n      var walk = function (direction) {\n        var next;\n        do {\n          next = walker[direction]();\n        } while (next && !isText$1(next) && !isBoundary(next));\n        return Optional.from(next).filter(isText$1);\n      };\n      return {\n        current: function () {\n          return Optional.from(walker.current()).filter(isText$1);\n        },\n        next: function () {\n          return walk('next');\n        },\n        prev: function () {\n          return walk('prev');\n        },\n        prev2: function () {\n          return walk('prev2');\n        }\n      };\n    };\n\n    var TextSeeker = function (dom, isBoundary) {\n      var isBlockBoundary = isBoundary ? isBoundary : function (node) {\n        return dom.isBlock(node) || isBr(node) || isContentEditableFalse(node);\n      };\n      var walk = function (node, offset, walker, process) {\n        if (isText$1(node)) {\n          var newOffset = process(node, offset, node.data);\n          if (newOffset !== -1) {\n            return Optional.some({\n              container: node,\n              offset: newOffset\n            });\n          }\n        }\n        return walker().bind(function (next) {\n          return walk(next.container, next.offset, walker, process);\n        });\n      };\n      var backwards = function (node, offset, process, root) {\n        var walker = TextWalker(node, root, isBlockBoundary);\n        return walk(node, offset, function () {\n          return walker.prev().map(function (prev) {\n            return {\n              container: prev,\n              offset: prev.length\n            };\n          });\n        }, process).getOrNull();\n      };\n      var forwards = function (node, offset, process, root) {\n        var walker = TextWalker(node, root, isBlockBoundary);\n        return walk(node, offset, function () {\n          return walker.next().map(function (next) {\n            return {\n              container: next,\n              offset: 0\n            };\n          });\n        }, process).getOrNull();\n      };\n      return {\n        backwards: backwards,\n        forwards: forwards\n      };\n    };\n\n    var cat = function (arr) {\n      var r = [];\n      var push = function (x) {\n        r.push(x);\n      };\n      for (var i = 0; i < arr.length; i++) {\n        arr[i].each(push);\n      }\n      return r;\n    };\n    var lift2 = function (oa, ob, f) {\n      return oa.isSome() && ob.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie())) : Optional.none();\n    };\n    var lift3 = function (oa, ob, oc, f) {\n      return oa.isSome() && ob.isSome() && oc.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie(), oc.getOrDie())) : Optional.none();\n    };\n    var someIf = function (b, a) {\n      return b ? Optional.some(a) : Optional.none();\n    };\n\n    var round = Math.round;\n    var clone$2 = function (rect) {\n      if (!rect) {\n        return {\n          left: 0,\n          top: 0,\n          bottom: 0,\n          right: 0,\n          width: 0,\n          height: 0\n        };\n      }\n      return {\n        left: round(rect.left),\n        top: round(rect.top),\n        bottom: round(rect.bottom),\n        right: round(rect.right),\n        width: round(rect.width),\n        height: round(rect.height)\n      };\n    };\n    var collapse = function (rect, toStart) {\n      rect = clone$2(rect);\n      if (toStart) {\n        rect.right = rect.left;\n      } else {\n        rect.left = rect.left + rect.width;\n        rect.right = rect.left;\n      }\n      rect.width = 0;\n      return rect;\n    };\n    var isEqual = function (rect1, rect2) {\n      return rect1.left === rect2.left && rect1.top === rect2.top && rect1.bottom === rect2.bottom && rect1.right === rect2.right;\n    };\n    var isValidOverflow = function (overflowY, rect1, rect2) {\n      return overflowY >= 0 && overflowY <= Math.min(rect1.height, rect2.height) / 2;\n    };\n    var isAbove = function (rect1, rect2) {\n      var halfHeight = Math.min(rect2.height / 2, rect1.height / 2);\n      if (rect1.bottom - halfHeight < rect2.top) {\n        return true;\n      }\n      if (rect1.top > rect2.bottom) {\n        return false;\n      }\n      return isValidOverflow(rect2.top - rect1.bottom, rect1, rect2);\n    };\n    var isBelow = function (rect1, rect2) {\n      if (rect1.top > rect2.bottom) {\n        return true;\n      }\n      if (rect1.bottom < rect2.top) {\n        return false;\n      }\n      return isValidOverflow(rect2.bottom - rect1.top, rect1, rect2);\n    };\n    var containsXY = function (rect, clientX, clientY) {\n      return clientX >= rect.left && clientX <= rect.right && clientY >= rect.top && clientY <= rect.bottom;\n    };\n\n    var getSelectedNode = function (range) {\n      var startContainer = range.startContainer, startOffset = range.startOffset;\n      if (startContainer.hasChildNodes() && range.endOffset === startOffset + 1) {\n        return startContainer.childNodes[startOffset];\n      }\n      return null;\n    };\n    var getNode = function (container, offset) {\n      if (container.nodeType === 1 && container.hasChildNodes()) {\n        if (offset >= container.childNodes.length) {\n          offset = container.childNodes.length - 1;\n        }\n        container = container.childNodes[offset];\n      }\n      return container;\n    };\n\n    var extendingChars = new RegExp('[\\u0300-\\u036f\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1-\\u05c2\\u05c4-\\u05c5\\u05c7\\u0610-\\u061a' + '\\u064b-\\u065f\\u0670\\u06d6-\\u06dc\\u06df-\\u06e4\\u06e7-\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0' + '\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0859-\\u085b\\u08e3-\\u0902\\u093a\\u093c' + '\\u0941-\\u0948\\u094d\\u0951-\\u0957\\u0962-\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2-\\u09e3' + '\\u0a01-\\u0a02\\u0a3c\\u0a41-\\u0a42\\u0a47-\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70-\\u0a71\\u0a75\\u0a81-\\u0a82\\u0abc' + '\\u0ac1-\\u0ac5\\u0ac7-\\u0ac8\\u0acd\\u0ae2-\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57' + '\\u0b62-\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c00\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55-\\u0c56' + '\\u0c62-\\u0c63\\u0c81\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc-\\u0ccd\\u0cd5-\\u0cd6\\u0ce2-\\u0ce3\\u0d01\\u0d3e\\u0d41-\\u0d44' + '\\u0d4d\\u0d57\\u0d62-\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9' + '\\u0ebb-\\u0ebc\\u0ec8-\\u0ecd\\u0f18-\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97' + '\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039-\\u103a\\u103d-\\u103e\\u1058-\\u1059\\u105e-\\u1060\\u1071-\\u1074' + '\\u1082\\u1085-\\u1086\\u108d\\u109d\\u135d-\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752-\\u1753\\u1772-\\u1773\\u17b4-\\u17b5' + '\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927-\\u1928\\u1932\\u1939-\\u193b\\u1a17-\\u1a18' + '\\u1a1b\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1ab0-\\u1abd\\u1ABE\\u1b00-\\u1b03\\u1b34' + '\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80-\\u1b81\\u1ba2-\\u1ba5\\u1ba8-\\u1ba9\\u1bab-\\u1bad\\u1be6\\u1be8-\\u1be9' + '\\u1bed\\u1bef-\\u1bf1\\u1c2c-\\u1c33\\u1c36-\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1cf4\\u1cf8-\\u1cf9' + '\\u1dc0-\\u1df5\\u1dfc-\\u1dff\\u200c-\\u200d\\u20d0-\\u20dc\\u20DD-\\u20E0\\u20e1\\u20E2-\\u20E4\\u20e5-\\u20f0\\u2cef-\\u2cf1' + '\\u2d7f\\u2de0-\\u2dff\\u302a-\\u302d\\u302e-\\u302f\\u3099-\\u309a\\ua66f\\uA670-\\uA672\\ua674-\\ua67d\\ua69e-\\ua69f\\ua6f0-\\ua6f1' + '\\ua802\\ua806\\ua80b\\ua825-\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc' + '\\ua9e5\\uaa29-\\uaa2e\\uaa31-\\uaa32\\uaa35-\\uaa36\\uaa43\\uaa4c\\uaa7c\\uaab0\\uaab2-\\uaab4\\uaab7-\\uaab8\\uaabe-\\uaabf\\uaac1' + '\\uaaec-\\uaaed\\uaaf6\\uabe5\\uabe8\\uabed\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe2f\\uff9e-\\uff9f]');\n    var isExtendingChar = function (ch) {\n      return typeof ch === 'string' && ch.charCodeAt(0) >= 768 && extendingChars.test(ch);\n    };\n\n    var or = function () {\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      return function (x) {\n        for (var i = 0; i < args.length; i++) {\n          if (args[i](x)) {\n            return true;\n          }\n        }\n        return false;\n      };\n    };\n    var and = function () {\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      return function (x) {\n        for (var i = 0; i < args.length; i++) {\n          if (!args[i](x)) {\n            return false;\n          }\n        }\n        return true;\n      };\n    };\n\n    var isElement$3 = isElement$1;\n    var isCaretCandidate$1 = isCaretCandidate;\n    var isBlock$1 = matchStyleValues('display', 'block table');\n    var isFloated = matchStyleValues('float', 'left right');\n    var isValidElementCaretCandidate = and(isElement$3, isCaretCandidate$1, not(isFloated));\n    var isNotPre = not(matchStyleValues('white-space', 'pre pre-line pre-wrap'));\n    var isText$4 = isText$1;\n    var isBr$3 = isBr;\n    var nodeIndex = DOMUtils$1.nodeIndex;\n    var resolveIndex = getNode;\n    var createRange = function (doc) {\n      return 'createRange' in doc ? doc.createRange() : DOMUtils$1.DOM.createRng();\n    };\n    var isWhiteSpace = function (chr) {\n      return chr && /[\\r\\n\\t ]/.test(chr);\n    };\n    var isRange = function (rng) {\n      return !!rng.setStart && !!rng.setEnd;\n    };\n    var isHiddenWhiteSpaceRange = function (range) {\n      var container = range.startContainer;\n      var offset = range.startOffset;\n      var text;\n      if (isWhiteSpace(range.toString()) && isNotPre(container.parentNode) && isText$1(container)) {\n        text = container.data;\n        if (isWhiteSpace(text[offset - 1]) || isWhiteSpace(text[offset + 1])) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var getBrClientRect = function (brNode) {\n      var doc = brNode.ownerDocument;\n      var rng = createRange(doc);\n      var nbsp$1 = doc.createTextNode(nbsp);\n      var parentNode = brNode.parentNode;\n      parentNode.insertBefore(nbsp$1, brNode);\n      rng.setStart(nbsp$1, 0);\n      rng.setEnd(nbsp$1, 1);\n      var clientRect = clone$2(rng.getBoundingClientRect());\n      parentNode.removeChild(nbsp$1);\n      return clientRect;\n    };\n    var getBoundingClientRectWebKitText = function (rng) {\n      var sc = rng.startContainer;\n      var ec = rng.endContainer;\n      var so = rng.startOffset;\n      var eo = rng.endOffset;\n      if (sc === ec && isText$1(ec) && so === 0 && eo === 1) {\n        var newRng = rng.cloneRange();\n        newRng.setEndAfter(ec);\n        return getBoundingClientRect(newRng);\n      } else {\n        return null;\n      }\n    };\n    var isZeroRect = function (r) {\n      return r.left === 0 && r.right === 0 && r.top === 0 && r.bottom === 0;\n    };\n    var getBoundingClientRect = function (item) {\n      var clientRect;\n      var clientRects = item.getClientRects();\n      if (clientRects.length > 0) {\n        clientRect = clone$2(clientRects[0]);\n      } else {\n        clientRect = clone$2(item.getBoundingClientRect());\n      }\n      if (!isRange(item) && isBr$3(item) && isZeroRect(clientRect)) {\n        return getBrClientRect(item);\n      }\n      if (isZeroRect(clientRect) && isRange(item)) {\n        return getBoundingClientRectWebKitText(item);\n      }\n      return clientRect;\n    };\n    var collapseAndInflateWidth = function (clientRect, toStart) {\n      var newClientRect = collapse(clientRect, toStart);\n      newClientRect.width = 1;\n      newClientRect.right = newClientRect.left + 1;\n      return newClientRect;\n    };\n    var getCaretPositionClientRects = function (caretPosition) {\n      var clientRects = [];\n      var beforeNode, node;\n      var addUniqueAndValidRect = function (clientRect) {\n        if (clientRect.height === 0) {\n          return;\n        }\n        if (clientRects.length > 0) {\n          if (isEqual(clientRect, clientRects[clientRects.length - 1])) {\n            return;\n          }\n        }\n        clientRects.push(clientRect);\n      };\n      var addCharacterOffset = function (container, offset) {\n        var range = createRange(container.ownerDocument);\n        if (offset < container.data.length) {\n          if (isExtendingChar(container.data[offset])) {\n            return clientRects;\n          }\n          if (isExtendingChar(container.data[offset - 1])) {\n            range.setStart(container, offset);\n            range.setEnd(container, offset + 1);\n            if (!isHiddenWhiteSpaceRange(range)) {\n              addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n              return clientRects;\n            }\n          }\n        }\n        if (offset > 0) {\n          range.setStart(container, offset - 1);\n          range.setEnd(container, offset);\n          if (!isHiddenWhiteSpaceRange(range)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n          }\n        }\n        if (offset < container.data.length) {\n          range.setStart(container, offset);\n          range.setEnd(container, offset + 1);\n          if (!isHiddenWhiteSpaceRange(range)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), true));\n          }\n        }\n      };\n      if (isText$4(caretPosition.container())) {\n        addCharacterOffset(caretPosition.container(), caretPosition.offset());\n        return clientRects;\n      }\n      if (isElement$3(caretPosition.container())) {\n        if (caretPosition.isAtEnd()) {\n          node = resolveIndex(caretPosition.container(), caretPosition.offset());\n          if (isText$4(node)) {\n            addCharacterOffset(node, node.data.length);\n          }\n          if (isValidElementCaretCandidate(node) && !isBr$3(node)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n          }\n        } else {\n          node = resolveIndex(caretPosition.container(), caretPosition.offset());\n          if (isText$4(node)) {\n            addCharacterOffset(node, 0);\n          }\n          if (isValidElementCaretCandidate(node) && caretPosition.isAtEnd()) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n            return clientRects;\n          }\n          beforeNode = resolveIndex(caretPosition.container(), caretPosition.offset() - 1);\n          if (isValidElementCaretCandidate(beforeNode) && !isBr$3(beforeNode)) {\n            if (isBlock$1(beforeNode) || isBlock$1(node) || !isValidElementCaretCandidate(node)) {\n              addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode), false));\n            }\n          }\n          if (isValidElementCaretCandidate(node)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), true));\n          }\n        }\n      }\n      return clientRects;\n    };\n    function CaretPosition(container, offset, clientRects) {\n      var isAtStart = function () {\n        if (isText$4(container)) {\n          return offset === 0;\n        }\n        return offset === 0;\n      };\n      var isAtEnd = function () {\n        if (isText$4(container)) {\n          return offset >= container.data.length;\n        }\n        return offset >= container.childNodes.length;\n      };\n      var toRange = function () {\n        var range = createRange(container.ownerDocument);\n        range.setStart(container, offset);\n        range.setEnd(container, offset);\n        return range;\n      };\n      var getClientRects = function () {\n        if (!clientRects) {\n          clientRects = getCaretPositionClientRects(CaretPosition(container, offset));\n        }\n        return clientRects;\n      };\n      var isVisible = function () {\n        return getClientRects().length > 0;\n      };\n      var isEqual = function (caretPosition) {\n        return caretPosition && container === caretPosition.container() && offset === caretPosition.offset();\n      };\n      var getNode = function (before) {\n        return resolveIndex(container, before ? offset - 1 : offset);\n      };\n      return {\n        container: constant(container),\n        offset: constant(offset),\n        toRange: toRange,\n        getClientRects: getClientRects,\n        isVisible: isVisible,\n        isAtStart: isAtStart,\n        isAtEnd: isAtEnd,\n        isEqual: isEqual,\n        getNode: getNode\n      };\n    }\n    (function (CaretPosition) {\n      CaretPosition.fromRangeStart = function (range) {\n        return CaretPosition(range.startContainer, range.startOffset);\n      };\n      CaretPosition.fromRangeEnd = function (range) {\n        return CaretPosition(range.endContainer, range.endOffset);\n      };\n      CaretPosition.after = function (node) {\n        return CaretPosition(node.parentNode, nodeIndex(node) + 1);\n      };\n      CaretPosition.before = function (node) {\n        return CaretPosition(node.parentNode, nodeIndex(node));\n      };\n      CaretPosition.isAbove = function (pos1, pos2) {\n        return lift2(head(pos2.getClientRects()), last(pos1.getClientRects()), isAbove).getOr(false);\n      };\n      CaretPosition.isBelow = function (pos1, pos2) {\n        return lift2(last(pos2.getClientRects()), head(pos1.getClientRects()), isBelow).getOr(false);\n      };\n      CaretPosition.isAtStart = function (pos) {\n        return pos ? pos.isAtStart() : false;\n      };\n      CaretPosition.isAtEnd = function (pos) {\n        return pos ? pos.isAtEnd() : false;\n      };\n      CaretPosition.isTextPosition = function (pos) {\n        return pos ? isText$1(pos.container()) : false;\n      };\n      CaretPosition.isElementPosition = function (pos) {\n        return CaretPosition.isTextPosition(pos) === false;\n      };\n    }(CaretPosition || (CaretPosition = {})));\n    var CaretPosition$1 = CaretPosition;\n\n    var trimEmptyTextNode = function (dom, node) {\n      if (isText$1(node) && node.data.length === 0) {\n        dom.remove(node);\n      }\n    };\n    var insertNode = function (dom, rng, node) {\n      rng.insertNode(node);\n      trimEmptyTextNode(dom, node.previousSibling);\n      trimEmptyTextNode(dom, node.nextSibling);\n    };\n    var insertFragment = function (dom, rng, frag) {\n      var firstChild = Optional.from(frag.firstChild);\n      var lastChild = Optional.from(frag.lastChild);\n      rng.insertNode(frag);\n      firstChild.each(function (child) {\n        return trimEmptyTextNode(dom, child.previousSibling);\n      });\n      lastChild.each(function (child) {\n        return trimEmptyTextNode(dom, child.nextSibling);\n      });\n    };\n    var rangeInsertNode = function (dom, rng, node) {\n      if (isDocumentFragment$1(node)) {\n        insertFragment(dom, rng, node);\n      } else {\n        insertNode(dom, rng, node);\n      }\n    };\n\n    var isText$5 = isText$1;\n    var isBogus$2 = isBogus;\n    var nodeIndex$1 = DOMUtils$1.nodeIndex;\n    var normalizedParent = function (node) {\n      var parentNode = node.parentNode;\n      if (isBogus$2(parentNode)) {\n        return normalizedParent(parentNode);\n      }\n      return parentNode;\n    };\n    var getChildNodes = function (node) {\n      if (!node) {\n        return [];\n      }\n      return reduce(node.childNodes, function (result, node) {\n        if (isBogus$2(node) && node.nodeName !== 'BR') {\n          result = result.concat(getChildNodes(node));\n        } else {\n          result.push(node);\n        }\n        return result;\n      }, []);\n    };\n    var normalizedTextOffset = function (node, offset) {\n      while (node = node.previousSibling) {\n        if (!isText$5(node)) {\n          break;\n        }\n        offset += node.data.length;\n      }\n      return offset;\n    };\n    var equal$1 = function (a) {\n      return function (b) {\n        return a === b;\n      };\n    };\n    var normalizedNodeIndex = function (node) {\n      var nodes, index;\n      nodes = getChildNodes(normalizedParent(node));\n      index = findIndex$1(nodes, equal$1(node), node);\n      nodes = nodes.slice(0, index + 1);\n      var numTextFragments = reduce(nodes, function (result, node, i) {\n        if (isText$5(node) && isText$5(nodes[i - 1])) {\n          result++;\n        }\n        return result;\n      }, 0);\n      nodes = filter$2(nodes, matchNodeNames([node.nodeName]));\n      index = findIndex$1(nodes, equal$1(node), node);\n      return index - numTextFragments;\n    };\n    var createPathItem = function (node) {\n      var name;\n      if (isText$5(node)) {\n        name = 'text()';\n      } else {\n        name = node.nodeName.toLowerCase();\n      }\n      return name + '[' + normalizedNodeIndex(node) + ']';\n    };\n    var parentsUntil = function (root, node, predicate) {\n      var parents = [];\n      for (node = node.parentNode; node !== root; node = node.parentNode) {\n        if (predicate && predicate(node)) {\n          break;\n        }\n        parents.push(node);\n      }\n      return parents;\n    };\n    var create$3 = function (root, caretPosition) {\n      var container, offset, path = [], outputOffset, childNodes, parents;\n      container = caretPosition.container();\n      offset = caretPosition.offset();\n      if (isText$5(container)) {\n        outputOffset = normalizedTextOffset(container, offset);\n      } else {\n        childNodes = container.childNodes;\n        if (offset >= childNodes.length) {\n          outputOffset = 'after';\n          offset = childNodes.length - 1;\n        } else {\n          outputOffset = 'before';\n        }\n        container = childNodes[offset];\n      }\n      path.push(createPathItem(container));\n      parents = parentsUntil(root, container);\n      parents = filter$2(parents, not(isBogus));\n      path = path.concat(map$2(parents, function (node) {\n        return createPathItem(node);\n      }));\n      return path.reverse().join('/') + ',' + outputOffset;\n    };\n    var resolvePathItem = function (node, name, index) {\n      var nodes = getChildNodes(node);\n      nodes = filter$2(nodes, function (node, index) {\n        return !isText$5(node) || !isText$5(nodes[index - 1]);\n      });\n      nodes = filter$2(nodes, matchNodeNames([name]));\n      return nodes[index];\n    };\n    var findTextPosition = function (container, offset) {\n      var node = container, targetOffset = 0, dataLen;\n      while (isText$5(node)) {\n        dataLen = node.data.length;\n        if (offset >= targetOffset && offset <= targetOffset + dataLen) {\n          container = node;\n          offset = offset - targetOffset;\n          break;\n        }\n        if (!isText$5(node.nextSibling)) {\n          container = node;\n          offset = dataLen;\n          break;\n        }\n        targetOffset += dataLen;\n        node = node.nextSibling;\n      }\n      if (isText$5(container) && offset > container.data.length) {\n        offset = container.data.length;\n      }\n      return CaretPosition$1(container, offset);\n    };\n    var resolve$1 = function (root, path) {\n      var offset;\n      if (!path) {\n        return null;\n      }\n      var parts = path.split(',');\n      var paths = parts[0].split('/');\n      offset = parts.length > 1 ? parts[1] : 'before';\n      var container = reduce(paths, function (result, value) {\n        var match = /([\\w\\-\\(\\)]+)\\[([0-9]+)\\]/.exec(value);\n        if (!match) {\n          return null;\n        }\n        if (match[1] === 'text()') {\n          match[1] = '#text';\n        }\n        return resolvePathItem(result, match[1], parseInt(match[2], 10));\n      }, root);\n      if (!container) {\n        return null;\n      }\n      if (!isText$5(container)) {\n        if (offset === 'after') {\n          offset = nodeIndex$1(container) + 1;\n        } else {\n          offset = nodeIndex$1(container);\n        }\n        return CaretPosition$1(container.parentNode, offset);\n      }\n      return findTextPosition(container, parseInt(offset, 10));\n    };\n\n    var isContentEditableFalse$2 = isContentEditableFalse;\n    var getNormalizedTextOffset = function (trim, container, offset) {\n      var node, trimmedOffset;\n      trimmedOffset = trim(container.data.slice(0, offset)).length;\n      for (node = container.previousSibling; node && isText$1(node); node = node.previousSibling) {\n        trimmedOffset += trim(node.data).length;\n      }\n      return trimmedOffset;\n    };\n    var getPoint = function (dom, trim, normalized, rng, start) {\n      var container = rng[start ? 'startContainer' : 'endContainer'];\n      var offset = rng[start ? 'startOffset' : 'endOffset'];\n      var point = [];\n      var childNodes, after = 0;\n      var root = dom.getRoot();\n      if (isText$1(container)) {\n        point.push(normalized ? getNormalizedTextOffset(trim, container, offset) : offset);\n      } else {\n        childNodes = container.childNodes;\n        if (offset >= childNodes.length && childNodes.length) {\n          after = 1;\n          offset = Math.max(0, childNodes.length - 1);\n        }\n        point.push(dom.nodeIndex(childNodes[offset], normalized) + after);\n      }\n      for (; container && container !== root; container = container.parentNode) {\n        point.push(dom.nodeIndex(container, normalized));\n      }\n      return point;\n    };\n    var getLocation = function (trim, selection, normalized, rng) {\n      var dom = selection.dom, bookmark = {};\n      bookmark.start = getPoint(dom, trim, normalized, rng, true);\n      if (!selection.isCollapsed()) {\n        bookmark.end = getPoint(dom, trim, normalized, rng, false);\n      }\n      return bookmark;\n    };\n    var findIndex$2 = function (dom, name, element) {\n      var count = 0;\n      Tools.each(dom.select(name), function (node) {\n        if (node.getAttribute('data-mce-bogus') === 'all') {\n          return;\n        }\n        if (node === element) {\n          return false;\n        }\n        count++;\n      });\n      return count;\n    };\n    var moveEndPoint = function (rng, start) {\n      var container, offset, childNodes;\n      var prefix = start ? 'start' : 'end';\n      container = rng[prefix + 'Container'];\n      offset = rng[prefix + 'Offset'];\n      if (isElement$1(container) && container.nodeName === 'TR') {\n        childNodes = container.childNodes;\n        container = childNodes[Math.min(start ? offset : offset - 1, childNodes.length - 1)];\n        if (container) {\n          offset = start ? 0 : container.childNodes.length;\n          rng['set' + (start ? 'Start' : 'End')](container, offset);\n        }\n      }\n    };\n    var normalizeTableCellSelection = function (rng) {\n      moveEndPoint(rng, true);\n      moveEndPoint(rng, false);\n      return rng;\n    };\n    var findSibling = function (node, offset) {\n      var sibling;\n      if (isElement$1(node)) {\n        node = getNode(node, offset);\n        if (isContentEditableFalse$2(node)) {\n          return node;\n        }\n      }\n      if (isCaretContainer(node)) {\n        if (isText$1(node) && isCaretContainerBlock(node)) {\n          node = node.parentNode;\n        }\n        sibling = node.previousSibling;\n        if (isContentEditableFalse$2(sibling)) {\n          return sibling;\n        }\n        sibling = node.nextSibling;\n        if (isContentEditableFalse$2(sibling)) {\n          return sibling;\n        }\n      }\n    };\n    var findAdjacentContentEditableFalseElm = function (rng) {\n      return findSibling(rng.startContainer, rng.startOffset) || findSibling(rng.endContainer, rng.endOffset);\n    };\n    var getOffsetBookmark = function (trim, normalized, selection) {\n      var element = selection.getNode();\n      var name = element ? element.nodeName : null;\n      var rng = selection.getRng();\n      if (isContentEditableFalse$2(element) || name === 'IMG') {\n        return {\n          name: name,\n          index: findIndex$2(selection.dom, name, element)\n        };\n      }\n      var sibling = findAdjacentContentEditableFalseElm(rng);\n      if (sibling) {\n        name = sibling.tagName;\n        return {\n          name: name,\n          index: findIndex$2(selection.dom, name, sibling)\n        };\n      }\n      return getLocation(trim, selection, normalized, rng);\n    };\n    var getCaretBookmark = function (selection) {\n      var rng = selection.getRng();\n      return {\n        start: create$3(selection.dom.getRoot(), CaretPosition$1.fromRangeStart(rng)),\n        end: create$3(selection.dom.getRoot(), CaretPosition$1.fromRangeEnd(rng))\n      };\n    };\n    var getRangeBookmark = function (selection) {\n      return { rng: selection.getRng() };\n    };\n    var createBookmarkSpan = function (dom, id, filled) {\n      var args = {\n        'data-mce-type': 'bookmark',\n        id: id,\n        'style': 'overflow:hidden;line-height:0px'\n      };\n      return filled ? dom.create('span', args, '&#xFEFF;') : dom.create('span', args);\n    };\n    var getPersistentBookmark = function (selection, filled) {\n      var dom = selection.dom;\n      var rng = selection.getRng();\n      var id = dom.uniqueId();\n      var collapsed = selection.isCollapsed();\n      var element = selection.getNode();\n      var name = element.nodeName;\n      if (name === 'IMG') {\n        return {\n          name: name,\n          index: findIndex$2(dom, name, element)\n        };\n      }\n      var rng2 = normalizeTableCellSelection(rng.cloneRange());\n      if (!collapsed) {\n        rng2.collapse(false);\n        var endBookmarkNode = createBookmarkSpan(dom, id + '_end', filled);\n        rangeInsertNode(dom, rng2, endBookmarkNode);\n      }\n      rng = normalizeTableCellSelection(rng);\n      rng.collapse(true);\n      var startBookmarkNode = createBookmarkSpan(dom, id + '_start', filled);\n      rangeInsertNode(dom, rng, startBookmarkNode);\n      selection.moveToBookmark({\n        id: id,\n        keep: true\n      });\n      return { id: id };\n    };\n    var getBookmark = function (selection, type, normalized) {\n      if (type === 2) {\n        return getOffsetBookmark(trim$2, normalized, selection);\n      } else if (type === 3) {\n        return getCaretBookmark(selection);\n      } else if (type) {\n        return getRangeBookmark(selection);\n      } else {\n        return getPersistentBookmark(selection, false);\n      }\n    };\n    var getUndoBookmark = curry(getOffsetBookmark, identity, true);\n\n    var DOM$1 = DOMUtils$1.DOM;\n    var defaultPreviewStyles = 'font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow';\n    var getBodySetting = function (editor, name, defaultValue) {\n      var value = editor.getParam(name, defaultValue);\n      if (value.indexOf('=') !== -1) {\n        var bodyObj = editor.getParam(name, '', 'hash');\n        return bodyObj.hasOwnProperty(editor.id) ? bodyObj[editor.id] : defaultValue;\n      } else {\n        return value;\n      }\n    };\n    var getIframeAttrs = function (editor) {\n      return editor.getParam('iframe_attrs', {});\n    };\n    var getDocType = function (editor) {\n      return editor.getParam('doctype', '<!DOCTYPE html>');\n    };\n    var getDocumentBaseUrl = function (editor) {\n      return editor.getParam('document_base_url', '');\n    };\n    var getBodyId = function (editor) {\n      return getBodySetting(editor, 'body_id', 'tinymce');\n    };\n    var getBodyClass = function (editor) {\n      return getBodySetting(editor, 'body_class', '');\n    };\n    var getContentSecurityPolicy = function (editor) {\n      return editor.getParam('content_security_policy', '');\n    };\n    var shouldPutBrInPre = function (editor) {\n      return editor.getParam('br_in_pre', true);\n    };\n    var getForcedRootBlock = function (editor) {\n      if (editor.getParam('force_p_newlines', false)) {\n        return 'p';\n      }\n      var block = editor.getParam('forced_root_block', 'p');\n      if (block === false) {\n        return '';\n      } else if (block === true) {\n        return 'p';\n      } else {\n        return block;\n      }\n    };\n    var getForcedRootBlockAttrs = function (editor) {\n      return editor.getParam('forced_root_block_attrs', {});\n    };\n    var getBrNewLineSelector = function (editor) {\n      return editor.getParam('br_newline_selector', '.mce-toc h2,figcaption,caption');\n    };\n    var getNoNewLineSelector = function (editor) {\n      return editor.getParam('no_newline_selector', '');\n    };\n    var shouldKeepStyles = function (editor) {\n      return editor.getParam('keep_styles', true);\n    };\n    var shouldEndContainerOnEmptyBlock = function (editor) {\n      return editor.getParam('end_container_on_empty_block', false);\n    };\n    var getFontStyleValues = function (editor) {\n      return Tools.explode(editor.getParam('font_size_style_values', 'xx-small,x-small,small,medium,large,x-large,xx-large'));\n    };\n    var getFontSizeClasses = function (editor) {\n      return Tools.explode(editor.getParam('font_size_classes', ''));\n    };\n    var getImagesDataImgFilter = function (editor) {\n      return editor.getParam('images_dataimg_filter', always, 'function');\n    };\n    var isAutomaticUploadsEnabled = function (editor) {\n      return editor.getParam('automatic_uploads', true, 'boolean');\n    };\n    var shouldReuseFileName = function (editor) {\n      return editor.getParam('images_reuse_filename', false, 'boolean');\n    };\n    var shouldReplaceBlobUris = function (editor) {\n      return editor.getParam('images_replace_blob_uris', true, 'boolean');\n    };\n    var getIconPackName = function (editor) {\n      return editor.getParam('icons', '', 'string');\n    };\n    var getIconsUrl = function (editor) {\n      return editor.getParam('icons_url', '', 'string');\n    };\n    var getImageUploadUrl = function (editor) {\n      return editor.getParam('images_upload_url', '', 'string');\n    };\n    var getImageUploadBasePath = function (editor) {\n      return editor.getParam('images_upload_base_path', '', 'string');\n    };\n    var getImagesUploadCredentials = function (editor) {\n      return editor.getParam('images_upload_credentials', false, 'boolean');\n    };\n    var getImagesUploadHandler = function (editor) {\n      return editor.getParam('images_upload_handler', null, 'function');\n    };\n    var shouldUseContentCssCors = function (editor) {\n      return editor.getParam('content_css_cors', false, 'boolean');\n    };\n    var getReferrerPolicy = function (editor) {\n      return editor.getParam('referrer_policy', '', 'string');\n    };\n    var getLanguageCode = function (editor) {\n      return editor.getParam('language', 'en', 'string');\n    };\n    var getLanguageUrl = function (editor) {\n      return editor.getParam('language_url', '', 'string');\n    };\n    var shouldIndentUseMargin = function (editor) {\n      return editor.getParam('indent_use_margin', false);\n    };\n    var getIndentation = function (editor) {\n      return editor.getParam('indentation', '40px', 'string');\n    };\n    var getContentCss = function (editor) {\n      var contentCss = editor.getParam('content_css');\n      if (isString(contentCss)) {\n        return map(contentCss.split(','), trim);\n      } else if (isArray(contentCss)) {\n        return contentCss;\n      } else if (contentCss === false || editor.inline) {\n        return [];\n      } else {\n        return ['default'];\n      }\n    };\n    var getDirectionality = function (editor) {\n      return editor.getParam('directionality', I18n.isRtl() ? 'rtl' : undefined);\n    };\n    var getInlineBoundarySelector = function (editor) {\n      return editor.getParam('inline_boundaries_selector', 'a[href],code,.mce-annotation', 'string');\n    };\n    var getObjectResizing = function (editor) {\n      var selector = editor.getParam('object_resizing');\n      if (selector === false || Env.iOS) {\n        return false;\n      } else {\n        return isString(selector) ? selector : 'table,img,figure.image,div';\n      }\n    };\n    var getResizeImgProportional = function (editor) {\n      return editor.getParam('resize_img_proportional', true, 'boolean');\n    };\n    var getPlaceholder = function (editor) {\n      return editor.getParam('placeholder', DOM$1.getAttrib(editor.getElement(), 'placeholder'), 'string');\n    };\n    var getEventRoot = function (editor) {\n      return editor.getParam('event_root');\n    };\n    var getServiceMessage = function (editor) {\n      return editor.getParam('service_message');\n    };\n    var getTheme = function (editor) {\n      return editor.getParam('theme');\n    };\n    var shouldValidate = function (editor) {\n      return editor.getParam('validate');\n    };\n    var isInlineBoundariesEnabled = function (editor) {\n      return editor.getParam('inline_boundaries') !== false;\n    };\n    var getFormats = function (editor) {\n      return editor.getParam('formats');\n    };\n    var getPreviewStyles = function (editor) {\n      var style = editor.getParam('preview_styles', defaultPreviewStyles);\n      if (isString(style)) {\n        return style;\n      } else {\n        return '';\n      }\n    };\n    var canFormatEmptyLines = function (editor) {\n      return editor.getParam('format_empty_lines', false, 'boolean');\n    };\n    var getCustomUiSelector = function (editor) {\n      return editor.getParam('custom_ui_selector', '', 'string');\n    };\n    var getThemeUrl = function (editor) {\n      return editor.getParam('theme_url');\n    };\n    var isInline$1 = function (editor) {\n      return editor.getParam('inline');\n    };\n    var hasHiddenInput = function (editor) {\n      return editor.getParam('hidden_input');\n    };\n    var shouldPatchSubmit = function (editor) {\n      return editor.getParam('submit_patch');\n    };\n    var isEncodingXml = function (editor) {\n      return editor.getParam('encoding') === 'xml';\n    };\n    var shouldAddFormSubmitTrigger = function (editor) {\n      return editor.getParam('add_form_submit_trigger');\n    };\n    var shouldAddUnloadTrigger = function (editor) {\n      return editor.getParam('add_unload_trigger');\n    };\n    var hasForcedRootBlock = function (editor) {\n      return getForcedRootBlock(editor) !== '';\n    };\n    var getCustomUndoRedoLevels = function (editor) {\n      return editor.getParam('custom_undo_redo_levels', 0, 'number');\n    };\n    var shouldDisableNodeChange = function (editor) {\n      return editor.getParam('disable_nodechange');\n    };\n    var isReadOnly = function (editor) {\n      return editor.getParam('readonly');\n    };\n    var hasContentCssCors = function (editor) {\n      return editor.getParam('content_css_cors');\n    };\n    var getPlugins = function (editor) {\n      return editor.getParam('plugins', '', 'string');\n    };\n    var getExternalPlugins = function (editor) {\n      return editor.getParam('external_plugins');\n    };\n    var shouldBlockUnsupportedDrop = function (editor) {\n      return editor.getParam('block_unsupported_drop', true, 'boolean');\n    };\n    var isVisualAidsEnabled = function (editor) {\n      return editor.getParam('visual', true, 'boolean');\n    };\n    var getVisualAidsTableClass = function (editor) {\n      return editor.getParam('visual_table_class', 'mce-item-table', 'string');\n    };\n    var getVisualAidsAnchorClass = function (editor) {\n      return editor.getParam('visual_anchor_class', 'mce-item-anchor', 'string');\n    };\n\n    var isElement$4 = isElement$1;\n    var isText$6 = isText$1;\n    var removeNode = function (node) {\n      var parentNode = node.parentNode;\n      if (parentNode) {\n        parentNode.removeChild(node);\n      }\n    };\n    var trimCount = function (text) {\n      var trimmedText = trim$2(text);\n      return {\n        count: text.length - trimmedText.length,\n        text: trimmedText\n      };\n    };\n    var deleteZwspChars = function (caretContainer) {\n      var idx;\n      while ((idx = caretContainer.data.lastIndexOf(ZWSP)) !== -1) {\n        caretContainer.deleteData(idx, 1);\n      }\n    };\n    var removeUnchanged = function (caretContainer, pos) {\n      remove$5(caretContainer);\n      return pos;\n    };\n    var removeTextAndReposition = function (caretContainer, pos) {\n      var before = trimCount(caretContainer.data.substr(0, pos.offset()));\n      var after = trimCount(caretContainer.data.substr(pos.offset()));\n      var text = before.text + after.text;\n      if (text.length > 0) {\n        deleteZwspChars(caretContainer);\n        return CaretPosition$1(caretContainer, pos.offset() - before.count);\n      } else {\n        return pos;\n      }\n    };\n    var removeElementAndReposition = function (caretContainer, pos) {\n      var parentNode = pos.container();\n      var newPosition = indexOf(from$1(parentNode.childNodes), caretContainer).map(function (index) {\n        return index < pos.offset() ? CaretPosition$1(parentNode, pos.offset() - 1) : pos;\n      }).getOr(pos);\n      remove$5(caretContainer);\n      return newPosition;\n    };\n    var removeTextCaretContainer = function (caretContainer, pos) {\n      return isText$6(caretContainer) && pos.container() === caretContainer ? removeTextAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\n    };\n    var removeElementCaretContainer = function (caretContainer, pos) {\n      return pos.container() === caretContainer.parentNode ? removeElementAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\n    };\n    var removeAndReposition = function (container, pos) {\n      return CaretPosition$1.isTextPosition(pos) ? removeTextCaretContainer(container, pos) : removeElementCaretContainer(container, pos);\n    };\n    var remove$5 = function (caretContainerNode) {\n      if (isElement$4(caretContainerNode) && isCaretContainer(caretContainerNode)) {\n        if (hasContent(caretContainerNode)) {\n          caretContainerNode.removeAttribute('data-mce-caret');\n        } else {\n          removeNode(caretContainerNode);\n        }\n      }\n      if (isText$6(caretContainerNode)) {\n        deleteZwspChars(caretContainerNode);\n        if (caretContainerNode.data.length === 0) {\n          removeNode(caretContainerNode);\n        }\n      }\n    };\n\n    var browser$2 = detect$3().browser;\n    var isContentEditableFalse$3 = isContentEditableFalse;\n    var isMedia$1 = isMedia;\n    var isTableCell$2 = isTableCell;\n    var inlineFakeCaretSelector = '*[contentEditable=false],video,audio,embed,object';\n    var getAbsoluteClientRect = function (root, element, before) {\n      var clientRect = collapse(element.getBoundingClientRect(), before);\n      var docElm, scrollX, scrollY, margin, rootRect;\n      if (root.tagName === 'BODY') {\n        docElm = root.ownerDocument.documentElement;\n        scrollX = root.scrollLeft || docElm.scrollLeft;\n        scrollY = root.scrollTop || docElm.scrollTop;\n      } else {\n        rootRect = root.getBoundingClientRect();\n        scrollX = root.scrollLeft - rootRect.left;\n        scrollY = root.scrollTop - rootRect.top;\n      }\n      clientRect.left += scrollX;\n      clientRect.right += scrollX;\n      clientRect.top += scrollY;\n      clientRect.bottom += scrollY;\n      clientRect.width = 1;\n      margin = element.offsetWidth - element.clientWidth;\n      if (margin > 0) {\n        if (before) {\n          margin *= -1;\n        }\n        clientRect.left += margin;\n        clientRect.right += margin;\n      }\n      return clientRect;\n    };\n    var trimInlineCaretContainers = function (root) {\n      var fakeCaretTargetNodes = descendants$1(SugarElement.fromDom(root), inlineFakeCaretSelector);\n      for (var i = 0; i < fakeCaretTargetNodes.length; i++) {\n        var node = fakeCaretTargetNodes[i].dom;\n        var sibling = node.previousSibling;\n        if (endsWithCaretContainer(sibling)) {\n          var data = sibling.data;\n          if (data.length === 1) {\n            sibling.parentNode.removeChild(sibling);\n          } else {\n            sibling.deleteData(data.length - 1, 1);\n          }\n        }\n        sibling = node.nextSibling;\n        if (startsWithCaretContainer(sibling)) {\n          var data = sibling.data;\n          if (data.length === 1) {\n            sibling.parentNode.removeChild(sibling);\n          } else {\n            sibling.deleteData(0, 1);\n          }\n        }\n      }\n    };\n    var FakeCaret = function (editor, root, isBlock, hasFocus) {\n      var lastVisualCaret = Cell(Optional.none());\n      var cursorInterval, caretContainerNode;\n      var rootBlock = getForcedRootBlock(editor);\n      var caretBlock = rootBlock.length > 0 ? rootBlock : 'p';\n      var show = function (before, element) {\n        var clientRect, rng;\n        hide();\n        if (isTableCell$2(element)) {\n          return null;\n        }\n        if (isBlock(element)) {\n          caretContainerNode = insertBlock(caretBlock, element, before);\n          clientRect = getAbsoluteClientRect(root, element, before);\n          DomQuery(caretContainerNode).css('top', clientRect.top);\n          var caret = DomQuery('<div class=\"mce-visual-caret\" data-mce-bogus=\"all\"></div>').css(clientRect).appendTo(root)[0];\n          lastVisualCaret.set(Optional.some({\n            caret: caret,\n            element: element,\n            before: before\n          }));\n          lastVisualCaret.get().each(function (caretState) {\n            if (before) {\n              DomQuery(caretState.caret).addClass('mce-visual-caret-before');\n            }\n          });\n          startBlink();\n          rng = element.ownerDocument.createRange();\n          rng.setStart(caretContainerNode, 0);\n          rng.setEnd(caretContainerNode, 0);\n        } else {\n          caretContainerNode = insertInline(element, before);\n          rng = element.ownerDocument.createRange();\n          if (isInlineFakeCaretTarget(caretContainerNode.nextSibling)) {\n            rng.setStart(caretContainerNode, 0);\n            rng.setEnd(caretContainerNode, 0);\n          } else {\n            rng.setStart(caretContainerNode, 1);\n            rng.setEnd(caretContainerNode, 1);\n          }\n          return rng;\n        }\n        return rng;\n      };\n      var hide = function () {\n        trimInlineCaretContainers(root);\n        if (caretContainerNode) {\n          remove$5(caretContainerNode);\n          caretContainerNode = null;\n        }\n        lastVisualCaret.get().each(function (caretState) {\n          DomQuery(caretState.caret).remove();\n          lastVisualCaret.set(Optional.none());\n        });\n        if (cursorInterval) {\n          Delay.clearInterval(cursorInterval);\n          cursorInterval = null;\n        }\n      };\n      var startBlink = function () {\n        cursorInterval = Delay.setInterval(function () {\n          if (hasFocus()) {\n            DomQuery('div.mce-visual-caret', root).toggleClass('mce-visual-caret-hidden');\n          } else {\n            DomQuery('div.mce-visual-caret', root).addClass('mce-visual-caret-hidden');\n          }\n        }, 500);\n      };\n      var reposition = function () {\n        lastVisualCaret.get().each(function (caretState) {\n          var clientRect = getAbsoluteClientRect(root, caretState.element, caretState.before);\n          DomQuery(caretState.caret).css(__assign({}, clientRect));\n        });\n      };\n      var destroy = function () {\n        return Delay.clearInterval(cursorInterval);\n      };\n      var getCss = function () {\n        return '.mce-visual-caret {' + 'position: absolute;' + 'background-color: black;' + 'background-color: currentcolor;' + '}' + '.mce-visual-caret-hidden {' + 'display: none;' + '}' + '*[data-mce-caret] {' + 'position: absolute;' + 'left: -1000px;' + 'right: auto;' + 'top: 0;' + 'margin: 0;' + 'padding: 0;' + '}';\n      };\n      return {\n        show: show,\n        hide: hide,\n        getCss: getCss,\n        reposition: reposition,\n        destroy: destroy\n      };\n    };\n    var isFakeCaretTableBrowser = function () {\n      return browser$2.isIE() || browser$2.isEdge() || browser$2.isFirefox();\n    };\n    var isInlineFakeCaretTarget = function (node) {\n      return isContentEditableFalse$3(node) || isMedia$1(node);\n    };\n    var isFakeCaretTarget = function (node) {\n      return isInlineFakeCaretTarget(node) || isTable(node) && isFakeCaretTableBrowser();\n    };\n\n    var isContentEditableFalse$4 = isContentEditableFalse;\n    var isMedia$2 = isMedia;\n    var isBlockLike = matchStyleValues('display', 'block table table-cell table-caption list-item');\n    var isCaretContainer$2 = isCaretContainer;\n    var isCaretContainerBlock$1 = isCaretContainerBlock;\n    var isElement$5 = isElement$1;\n    var isCaretCandidate$2 = isCaretCandidate;\n    var isForwards = function (direction) {\n      return direction > 0;\n    };\n    var isBackwards = function (direction) {\n      return direction < 0;\n    };\n    var skipCaretContainers = function (walk, shallow) {\n      var node;\n      while (node = walk(shallow)) {\n        if (!isCaretContainerBlock$1(node)) {\n          return node;\n        }\n      }\n      return null;\n    };\n    var findNode = function (node, direction, predicateFn, rootNode, shallow) {\n      var walker = new DomTreeWalker(node, rootNode);\n      var isCefOrCaretContainer = isContentEditableFalse$4(node) || isCaretContainerBlock$1(node);\n      if (isBackwards(direction)) {\n        if (isCefOrCaretContainer) {\n          node = skipCaretContainers(walker.prev, true);\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n        while (node = skipCaretContainers(walker.prev, shallow)) {\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n      }\n      if (isForwards(direction)) {\n        if (isCefOrCaretContainer) {\n          node = skipCaretContainers(walker.next, true);\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n        while (node = skipCaretContainers(walker.next, shallow)) {\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n      }\n      return null;\n    };\n    var getParentBlock = function (node, rootNode) {\n      while (node && node !== rootNode) {\n        if (isBlockLike(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var isInSameBlock = function (caretPosition1, caretPosition2, rootNode) {\n      return getParentBlock(caretPosition1.container(), rootNode) === getParentBlock(caretPosition2.container(), rootNode);\n    };\n    var getChildNodeAtRelativeOffset = function (relativeOffset, caretPosition) {\n      if (!caretPosition) {\n        return null;\n      }\n      var container = caretPosition.container();\n      var offset = caretPosition.offset();\n      if (!isElement$5(container)) {\n        return null;\n      }\n      return container.childNodes[offset + relativeOffset];\n    };\n    var beforeAfter = function (before, node) {\n      var range = node.ownerDocument.createRange();\n      if (before) {\n        range.setStartBefore(node);\n        range.setEndBefore(node);\n      } else {\n        range.setStartAfter(node);\n        range.setEndAfter(node);\n      }\n      return range;\n    };\n    var isNodesInSameBlock = function (root, node1, node2) {\n      return getParentBlock(node1, root) === getParentBlock(node2, root);\n    };\n    var lean = function (left, root, node) {\n      var sibling, siblingName;\n      if (left) {\n        siblingName = 'previousSibling';\n      } else {\n        siblingName = 'nextSibling';\n      }\n      while (node && node !== root) {\n        sibling = node[siblingName];\n        if (isCaretContainer$2(sibling)) {\n          sibling = sibling[siblingName];\n        }\n        if (isContentEditableFalse$4(sibling) || isMedia$2(sibling)) {\n          if (isNodesInSameBlock(root, sibling, node)) {\n            return sibling;\n          }\n          break;\n        }\n        if (isCaretCandidate$2(sibling)) {\n          break;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var before$2 = curry(beforeAfter, true);\n    var after$1 = curry(beforeAfter, false);\n    var normalizeRange = function (direction, root, range) {\n      var node, container, location;\n      var leanLeft = curry(lean, true, root);\n      var leanRight = curry(lean, false, root);\n      container = range.startContainer;\n      var offset = range.startOffset;\n      if (isCaretContainerBlock(container)) {\n        if (!isElement$5(container)) {\n          container = container.parentNode;\n        }\n        location = container.getAttribute('data-mce-caret');\n        if (location === 'before') {\n          node = container.nextSibling;\n          if (isFakeCaretTarget(node)) {\n            return before$2(node);\n          }\n        }\n        if (location === 'after') {\n          node = container.previousSibling;\n          if (isFakeCaretTarget(node)) {\n            return after$1(node);\n          }\n        }\n      }\n      if (!range.collapsed) {\n        return range;\n      }\n      if (isText$1(container)) {\n        if (isCaretContainer$2(container)) {\n          if (direction === 1) {\n            node = leanRight(container);\n            if (node) {\n              return before$2(node);\n            }\n            node = leanLeft(container);\n            if (node) {\n              return after$1(node);\n            }\n          }\n          if (direction === -1) {\n            node = leanLeft(container);\n            if (node) {\n              return after$1(node);\n            }\n            node = leanRight(container);\n            if (node) {\n              return before$2(node);\n            }\n          }\n          return range;\n        }\n        if (endsWithCaretContainer(container) && offset >= container.data.length - 1) {\n          if (direction === 1) {\n            node = leanRight(container);\n            if (node) {\n              return before$2(node);\n            }\n          }\n          return range;\n        }\n        if (startsWithCaretContainer(container) && offset <= 1) {\n          if (direction === -1) {\n            node = leanLeft(container);\n            if (node) {\n              return after$1(node);\n            }\n          }\n          return range;\n        }\n        if (offset === container.data.length) {\n          node = leanRight(container);\n          if (node) {\n            return before$2(node);\n          }\n          return range;\n        }\n        if (offset === 0) {\n          node = leanLeft(container);\n          if (node) {\n            return after$1(node);\n          }\n          return range;\n        }\n      }\n      return range;\n    };\n    var getRelativeCefElm = function (forward, caretPosition) {\n      return Optional.from(getChildNodeAtRelativeOffset(forward ? 0 : -1, caretPosition)).filter(isContentEditableFalse$4);\n    };\n    var getNormalizedRangeEndPoint = function (direction, root, range) {\n      var normalizedRange = normalizeRange(direction, root, range);\n      if (direction === -1) {\n        return CaretPosition.fromRangeStart(normalizedRange);\n      }\n      return CaretPosition.fromRangeEnd(normalizedRange);\n    };\n    var getElementFromPosition = function (pos) {\n      return Optional.from(pos.getNode()).map(SugarElement.fromDom);\n    };\n    var getElementFromPrevPosition = function (pos) {\n      return Optional.from(pos.getNode(true)).map(SugarElement.fromDom);\n    };\n    var getVisualCaretPosition = function (walkFn, caretPosition) {\n      while (caretPosition = walkFn(caretPosition)) {\n        if (caretPosition.isVisible()) {\n          return caretPosition;\n        }\n      }\n      return caretPosition;\n    };\n    var isMoveInsideSameBlock = function (from, to) {\n      var inSameBlock = isInSameBlock(from, to);\n      if (!inSameBlock && isBr(from.getNode())) {\n        return true;\n      }\n      return inSameBlock;\n    };\n\n    var HDirection;\n    (function (HDirection) {\n      HDirection[HDirection['Backwards'] = -1] = 'Backwards';\n      HDirection[HDirection['Forwards'] = 1] = 'Forwards';\n    }(HDirection || (HDirection = {})));\n    var isContentEditableFalse$5 = isContentEditableFalse;\n    var isText$7 = isText$1;\n    var isElement$6 = isElement$1;\n    var isBr$4 = isBr;\n    var isCaretCandidate$3 = isCaretCandidate;\n    var isAtomic$1 = isAtomic;\n    var isEditableCaretCandidate$1 = isEditableCaretCandidate;\n    var getParents = function (node, root) {\n      var parents = [];\n      while (node && node !== root) {\n        parents.push(node);\n        node = node.parentNode;\n      }\n      return parents;\n    };\n    var nodeAtIndex = function (container, offset) {\n      if (container.hasChildNodes() && offset < container.childNodes.length) {\n        return container.childNodes[offset];\n      }\n      return null;\n    };\n    var getCaretCandidatePosition = function (direction, node) {\n      if (isForwards(direction)) {\n        if (isCaretCandidate$3(node.previousSibling) && !isText$7(node.previousSibling)) {\n          return CaretPosition$1.before(node);\n        }\n        if (isText$7(node)) {\n          return CaretPosition$1(node, 0);\n        }\n      }\n      if (isBackwards(direction)) {\n        if (isCaretCandidate$3(node.nextSibling) && !isText$7(node.nextSibling)) {\n          return CaretPosition$1.after(node);\n        }\n        if (isText$7(node)) {\n          return CaretPosition$1(node, node.data.length);\n        }\n      }\n      if (isBackwards(direction)) {\n        if (isBr$4(node)) {\n          return CaretPosition$1.before(node);\n        }\n        return CaretPosition$1.after(node);\n      }\n      return CaretPosition$1.before(node);\n    };\n    var moveForwardFromBr = function (root, nextNode) {\n      var nextSibling = nextNode.nextSibling;\n      if (nextSibling && isCaretCandidate$3(nextSibling)) {\n        if (isText$7(nextSibling)) {\n          return CaretPosition$1(nextSibling, 0);\n        } else {\n          return CaretPosition$1.before(nextSibling);\n        }\n      } else {\n        return findCaretPosition(HDirection.Forwards, CaretPosition$1.after(nextNode), root);\n      }\n    };\n    var findCaretPosition = function (direction, startPos, root) {\n      var node, nextNode, innerNode;\n      var caretPosition;\n      if (!isElement$6(root) || !startPos) {\n        return null;\n      }\n      if (startPos.isEqual(CaretPosition$1.after(root)) && root.lastChild) {\n        caretPosition = CaretPosition$1.after(root.lastChild);\n        if (isBackwards(direction) && isCaretCandidate$3(root.lastChild) && isElement$6(root.lastChild)) {\n          return isBr$4(root.lastChild) ? CaretPosition$1.before(root.lastChild) : caretPosition;\n        }\n      } else {\n        caretPosition = startPos;\n      }\n      var container = caretPosition.container();\n      var offset = caretPosition.offset();\n      if (isText$7(container)) {\n        if (isBackwards(direction) && offset > 0) {\n          return CaretPosition$1(container, --offset);\n        }\n        if (isForwards(direction) && offset < container.length) {\n          return CaretPosition$1(container, ++offset);\n        }\n        node = container;\n      } else {\n        if (isBackwards(direction) && offset > 0) {\n          nextNode = nodeAtIndex(container, offset - 1);\n          if (isCaretCandidate$3(nextNode)) {\n            if (!isAtomic$1(nextNode)) {\n              innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\n              if (innerNode) {\n                if (isText$7(innerNode)) {\n                  return CaretPosition$1(innerNode, innerNode.data.length);\n                }\n                return CaretPosition$1.after(innerNode);\n              }\n            }\n            if (isText$7(nextNode)) {\n              return CaretPosition$1(nextNode, nextNode.data.length);\n            }\n            return CaretPosition$1.before(nextNode);\n          }\n        }\n        if (isForwards(direction) && offset < container.childNodes.length) {\n          nextNode = nodeAtIndex(container, offset);\n          if (isCaretCandidate$3(nextNode)) {\n            if (isBr$4(nextNode)) {\n              return moveForwardFromBr(root, nextNode);\n            }\n            if (!isAtomic$1(nextNode)) {\n              innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\n              if (innerNode) {\n                if (isText$7(innerNode)) {\n                  return CaretPosition$1(innerNode, 0);\n                }\n                return CaretPosition$1.before(innerNode);\n              }\n            }\n            if (isText$7(nextNode)) {\n              return CaretPosition$1(nextNode, 0);\n            }\n            return CaretPosition$1.after(nextNode);\n          }\n        }\n        node = nextNode ? nextNode : caretPosition.getNode();\n      }\n      if (isForwards(direction) && caretPosition.isAtEnd() || isBackwards(direction) && caretPosition.isAtStart()) {\n        node = findNode(node, direction, always, root, true);\n        if (isEditableCaretCandidate$1(node, root)) {\n          return getCaretCandidatePosition(direction, node);\n        }\n      }\n      nextNode = findNode(node, direction, isEditableCaretCandidate$1, root);\n      var rootContentEditableFalseElm = last$1(filter(getParents(container, root), isContentEditableFalse$5));\n      if (rootContentEditableFalseElm && (!nextNode || !rootContentEditableFalseElm.contains(nextNode))) {\n        if (isForwards(direction)) {\n          caretPosition = CaretPosition$1.after(rootContentEditableFalseElm);\n        } else {\n          caretPosition = CaretPosition$1.before(rootContentEditableFalseElm);\n        }\n        return caretPosition;\n      }\n      if (nextNode) {\n        return getCaretCandidatePosition(direction, nextNode);\n      }\n      return null;\n    };\n    var CaretWalker = function (root) {\n      return {\n        next: function (caretPosition) {\n          return findCaretPosition(HDirection.Forwards, caretPosition, root);\n        },\n        prev: function (caretPosition) {\n          return findCaretPosition(HDirection.Backwards, caretPosition, root);\n        }\n      };\n    };\n\n    var walkToPositionIn = function (forward, root, start) {\n      var position = forward ? CaretPosition$1.before(start) : CaretPosition$1.after(start);\n      return fromPosition(forward, root, position);\n    };\n    var afterElement = function (node) {\n      return isBr(node) ? CaretPosition$1.before(node) : CaretPosition$1.after(node);\n    };\n    var isBeforeOrStart = function (position) {\n      if (CaretPosition$1.isTextPosition(position)) {\n        return position.offset() === 0;\n      } else {\n        return isCaretCandidate(position.getNode());\n      }\n    };\n    var isAfterOrEnd = function (position) {\n      if (CaretPosition$1.isTextPosition(position)) {\n        var container = position.container();\n        return position.offset() === container.data.length;\n      } else {\n        return isCaretCandidate(position.getNode(true));\n      }\n    };\n    var isBeforeAfterSameElement = function (from, to) {\n      return !CaretPosition$1.isTextPosition(from) && !CaretPosition$1.isTextPosition(to) && from.getNode() === to.getNode(true);\n    };\n    var isAtBr = function (position) {\n      return !CaretPosition$1.isTextPosition(position) && isBr(position.getNode());\n    };\n    var shouldSkipPosition = function (forward, from, to) {\n      if (forward) {\n        return !isBeforeAfterSameElement(from, to) && !isAtBr(from) && isAfterOrEnd(from) && isBeforeOrStart(to);\n      } else {\n        return !isBeforeAfterSameElement(to, from) && isBeforeOrStart(from) && isAfterOrEnd(to);\n      }\n    };\n    var fromPosition = function (forward, root, pos) {\n      var walker = CaretWalker(root);\n      return Optional.from(forward ? walker.next(pos) : walker.prev(pos));\n    };\n    var navigate = function (forward, root, from) {\n      return fromPosition(forward, root, from).bind(function (to) {\n        if (isInSameBlock(from, to, root) && shouldSkipPosition(forward, from, to)) {\n          return fromPosition(forward, root, to);\n        } else {\n          return Optional.some(to);\n        }\n      });\n    };\n    var navigateIgnore = function (forward, root, from, ignoreFilter) {\n      return navigate(forward, root, from).bind(function (pos) {\n        return ignoreFilter(pos) ? navigateIgnore(forward, root, pos, ignoreFilter) : Optional.some(pos);\n      });\n    };\n    var positionIn = function (forward, element) {\n      var startNode = forward ? element.firstChild : element.lastChild;\n      if (isText$1(startNode)) {\n        return Optional.some(CaretPosition$1(startNode, forward ? 0 : startNode.data.length));\n      } else if (startNode) {\n        if (isCaretCandidate(startNode)) {\n          return Optional.some(forward ? CaretPosition$1.before(startNode) : afterElement(startNode));\n        } else {\n          return walkToPositionIn(forward, element, startNode);\n        }\n      } else {\n        return Optional.none();\n      }\n    };\n    var nextPosition = curry(fromPosition, true);\n    var prevPosition = curry(fromPosition, false);\n    var firstPositionIn = curry(positionIn, true);\n    var lastPositionIn = curry(positionIn, false);\n\n    var CARET_ID = '_mce_caret';\n    var isCaretNode = function (node) {\n      return isElement$1(node) && node.id === CARET_ID;\n    };\n    var getParentCaretContainer = function (body, node) {\n      while (node && node !== body) {\n        if (node.id === CARET_ID) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n\n    var isStringPathBookmark = function (bookmark) {\n      return typeof bookmark.start === 'string';\n    };\n    var isRangeBookmark = function (bookmark) {\n      return bookmark.hasOwnProperty('rng');\n    };\n    var isIdBookmark = function (bookmark) {\n      return bookmark.hasOwnProperty('id');\n    };\n    var isIndexBookmark = function (bookmark) {\n      return bookmark.hasOwnProperty('name');\n    };\n    var isPathBookmark = function (bookmark) {\n      return Tools.isArray(bookmark.start);\n    };\n\n    var addBogus = function (dom, node) {\n      if (isElement$1(node) && dom.isBlock(node) && !node.innerHTML && !Env.ie) {\n        node.innerHTML = '<br data-mce-bogus=\"1\" />';\n      }\n      return node;\n    };\n    var resolveCaretPositionBookmark = function (dom, bookmark) {\n      var pos;\n      var rng = dom.createRng();\n      pos = resolve$1(dom.getRoot(), bookmark.start);\n      rng.setStart(pos.container(), pos.offset());\n      pos = resolve$1(dom.getRoot(), bookmark.end);\n      rng.setEnd(pos.container(), pos.offset());\n      return rng;\n    };\n    var insertZwsp = function (node, rng) {\n      var textNode = node.ownerDocument.createTextNode(ZWSP);\n      node.appendChild(textNode);\n      rng.setStart(textNode, 0);\n      rng.setEnd(textNode, 0);\n    };\n    var isEmpty$1 = function (node) {\n      return node.hasChildNodes() === false;\n    };\n    var tryFindRangePosition = function (node, rng) {\n      return lastPositionIn(node).fold(function () {\n        return false;\n      }, function (pos) {\n        rng.setStart(pos.container(), pos.offset());\n        rng.setEnd(pos.container(), pos.offset());\n        return true;\n      });\n    };\n    var padEmptyCaretContainer = function (root, node, rng) {\n      if (isEmpty$1(node) && getParentCaretContainer(root, node)) {\n        insertZwsp(node, rng);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var setEndPoint = function (dom, start, bookmark, rng) {\n      var point = bookmark[start ? 'start' : 'end'];\n      var i, node, offset, children;\n      var root = dom.getRoot();\n      if (point) {\n        offset = point[0];\n        for (node = root, i = point.length - 1; i >= 1; i--) {\n          children = node.childNodes;\n          if (padEmptyCaretContainer(root, node, rng)) {\n            return true;\n          }\n          if (point[i] > children.length - 1) {\n            if (padEmptyCaretContainer(root, node, rng)) {\n              return true;\n            }\n            return tryFindRangePosition(node, rng);\n          }\n          node = children[point[i]];\n        }\n        if (node.nodeType === 3) {\n          offset = Math.min(point[0], node.nodeValue.length);\n        }\n        if (node.nodeType === 1) {\n          offset = Math.min(point[0], node.childNodes.length);\n        }\n        if (start) {\n          rng.setStart(node, offset);\n        } else {\n          rng.setEnd(node, offset);\n        }\n      }\n      return true;\n    };\n    var isValidTextNode = function (node) {\n      return isText$1(node) && node.data.length > 0;\n    };\n    var restoreEndPoint = function (dom, suffix, bookmark) {\n      var marker = dom.get(bookmark.id + '_' + suffix), node, idx, next, prev;\n      var keep = bookmark.keep;\n      var container, offset;\n      if (marker) {\n        node = marker.parentNode;\n        if (suffix === 'start') {\n          if (!keep) {\n            idx = dom.nodeIndex(marker);\n          } else {\n            if (marker.hasChildNodes()) {\n              node = marker.firstChild;\n              idx = 1;\n            } else if (isValidTextNode(marker.nextSibling)) {\n              node = marker.nextSibling;\n              idx = 0;\n            } else if (isValidTextNode(marker.previousSibling)) {\n              node = marker.previousSibling;\n              idx = marker.previousSibling.data.length;\n            } else {\n              node = marker.parentNode;\n              idx = dom.nodeIndex(marker) + 1;\n            }\n          }\n          container = node;\n          offset = idx;\n        } else {\n          if (!keep) {\n            idx = dom.nodeIndex(marker);\n          } else {\n            if (marker.hasChildNodes()) {\n              node = marker.firstChild;\n              idx = 1;\n            } else if (isValidTextNode(marker.previousSibling)) {\n              node = marker.previousSibling;\n              idx = marker.previousSibling.data.length;\n            } else {\n              node = marker.parentNode;\n              idx = dom.nodeIndex(marker);\n            }\n          }\n          container = node;\n          offset = idx;\n        }\n        if (!keep) {\n          prev = marker.previousSibling;\n          next = marker.nextSibling;\n          Tools.each(Tools.grep(marker.childNodes), function (node) {\n            if (isText$1(node)) {\n              node.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\n            }\n          });\n          while (marker = dom.get(bookmark.id + '_' + suffix)) {\n            dom.remove(marker, true);\n          }\n          if (prev && next && prev.nodeType === next.nodeType && isText$1(prev) && !Env.opera) {\n            idx = prev.nodeValue.length;\n            prev.appendData(next.nodeValue);\n            dom.remove(next);\n            container = prev;\n            offset = idx;\n          }\n        }\n        return Optional.some(CaretPosition$1(container, offset));\n      } else {\n        return Optional.none();\n      }\n    };\n    var resolvePaths = function (dom, bookmark) {\n      var rng = dom.createRng();\n      if (setEndPoint(dom, true, bookmark, rng) && setEndPoint(dom, false, bookmark, rng)) {\n        return Optional.some(rng);\n      } else {\n        return Optional.none();\n      }\n    };\n    var resolveId = function (dom, bookmark) {\n      var startPos = restoreEndPoint(dom, 'start', bookmark);\n      var endPos = restoreEndPoint(dom, 'end', bookmark);\n      return lift2(startPos, endPos.or(startPos), function (spos, epos) {\n        var rng = dom.createRng();\n        rng.setStart(addBogus(dom, spos.container()), spos.offset());\n        rng.setEnd(addBogus(dom, epos.container()), epos.offset());\n        return rng;\n      });\n    };\n    var resolveIndex$1 = function (dom, bookmark) {\n      return Optional.from(dom.select(bookmark.name)[bookmark.index]).map(function (elm) {\n        var rng = dom.createRng();\n        rng.selectNode(elm);\n        return rng;\n      });\n    };\n    var resolve$2 = function (selection, bookmark) {\n      var dom = selection.dom;\n      if (bookmark) {\n        if (isPathBookmark(bookmark)) {\n          return resolvePaths(dom, bookmark);\n        } else if (isStringPathBookmark(bookmark)) {\n          return Optional.some(resolveCaretPositionBookmark(dom, bookmark));\n        } else if (isIdBookmark(bookmark)) {\n          return resolveId(dom, bookmark);\n        } else if (isIndexBookmark(bookmark)) {\n          return resolveIndex$1(dom, bookmark);\n        } else if (isRangeBookmark(bookmark)) {\n          return Optional.some(bookmark.rng);\n        }\n      }\n      return Optional.none();\n    };\n\n    var getBookmark$1 = function (selection, type, normalized) {\n      return getBookmark(selection, type, normalized);\n    };\n    var moveToBookmark = function (selection, bookmark) {\n      resolve$2(selection, bookmark).each(function (rng) {\n        selection.setRng(rng);\n      });\n    };\n    var isBookmarkNode$1 = function (node) {\n      return isElement$1(node) && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\n    };\n\n    var is$2 = function (expected) {\n      return function (actual) {\n        return expected === actual;\n      };\n    };\n    var isNbsp = is$2(nbsp);\n    var isWhiteSpace$1 = function (chr) {\n      return chr !== '' && ' \\f\\n\\r\\t\\x0B'.indexOf(chr) !== -1;\n    };\n    var isContent$1 = function (chr) {\n      return !isWhiteSpace$1(chr) && !isNbsp(chr);\n    };\n\n    var isNode = function (node) {\n      return !!node.nodeType;\n    };\n    var isInlineBlock = function (node) {\n      return node && /^(IMG)$/.test(node.nodeName);\n    };\n    var moveStart = function (dom, selection, rng) {\n      var offset = rng.startOffset;\n      var container = rng.startContainer, walker, node, nodes;\n      if (rng.startContainer === rng.endContainer) {\n        if (isInlineBlock(rng.startContainer.childNodes[rng.startOffset])) {\n          return;\n        }\n      }\n      if (container.nodeType === 1) {\n        nodes = container.childNodes;\n        if (offset < nodes.length) {\n          container = nodes[offset];\n          walker = new DomTreeWalker(container, dom.getParent(container, dom.isBlock));\n        } else {\n          container = nodes[nodes.length - 1];\n          walker = new DomTreeWalker(container, dom.getParent(container, dom.isBlock));\n          walker.next(true);\n        }\n        for (node = walker.current(); node; node = walker.next()) {\n          if (node.nodeType === 3 && !isWhiteSpaceNode(node)) {\n            rng.setStart(node, 0);\n            selection.setRng(rng);\n            return;\n          }\n        }\n      }\n    };\n    var getNonWhiteSpaceSibling = function (node, next, inc) {\n      if (node) {\n        var nextName = next ? 'nextSibling' : 'previousSibling';\n        for (node = inc ? node : node[nextName]; node; node = node[nextName]) {\n          if (node.nodeType === 1 || !isWhiteSpaceNode(node)) {\n            return node;\n          }\n        }\n      }\n    };\n    var isTextBlock$1 = function (editor, name) {\n      if (isNode(name)) {\n        name = name.nodeName;\n      }\n      return !!editor.schema.getTextBlockElements()[name.toLowerCase()];\n    };\n    var isValid = function (ed, parent, child) {\n      return ed.schema.isValidChild(parent, child);\n    };\n    var isWhiteSpaceNode = function (node, allowSpaces) {\n      if (allowSpaces === void 0) {\n        allowSpaces = false;\n      }\n      if (isNonNullable(node) && isText$1(node)) {\n        var data = allowSpaces ? node.data.replace(/ /g, '\\xA0') : node.data;\n        return isWhitespaceText(data);\n      } else {\n        return false;\n      }\n    };\n    var isEmptyTextNode = function (node) {\n      return isNonNullable(node) && isText$1(node) && node.length === 0;\n    };\n    var replaceVars = function (value, vars) {\n      if (typeof value !== 'string') {\n        value = value(vars);\n      } else if (vars) {\n        value = value.replace(/%(\\w+)/g, function (str, name) {\n          return vars[name] || str;\n        });\n      }\n      return value;\n    };\n    var isEq = function (str1, str2) {\n      str1 = str1 || '';\n      str2 = str2 || '';\n      str1 = '' + (str1.nodeName || str1);\n      str2 = '' + (str2.nodeName || str2);\n      return str1.toLowerCase() === str2.toLowerCase();\n    };\n    var normalizeStyleValue = function (dom, value, name) {\n      if (name === 'color' || name === 'backgroundColor') {\n        value = dom.toHex(value);\n      }\n      if (name === 'fontWeight' && value === 700) {\n        value = 'bold';\n      }\n      if (name === 'fontFamily') {\n        value = value.replace(/[\\'\\\"]/g, '').replace(/,\\s+/g, ',');\n      }\n      return '' + value;\n    };\n    var getStyle = function (dom, node, name) {\n      return normalizeStyleValue(dom, dom.getStyle(node, name), name);\n    };\n    var getTextDecoration = function (dom, node) {\n      var decoration;\n      dom.getParent(node, function (n) {\n        decoration = dom.getStyle(n, 'text-decoration');\n        return decoration && decoration !== 'none';\n      });\n      return decoration;\n    };\n    var getParents$1 = function (dom, node, selector) {\n      return dom.getParents(node, selector, dom.getRoot());\n    };\n    var isVariableFormatName = function (editor, formatName) {\n      var hasVariableValues = function (format) {\n        var isVariableValue = function (val) {\n          return val.length > 1 && val.charAt(0) === '%';\n        };\n        return exists([\n          'styles',\n          'attributes'\n        ], function (key) {\n          return get$1(format, key).exists(function (field) {\n            var fieldValues = isArray(field) ? field : values(field);\n            return exists(fieldValues, isVariableValue);\n          });\n        });\n      };\n      return exists(editor.formatter.get(formatName), hasVariableValues);\n    };\n    var areSimilarFormats = function (editor, formatName, otherFormatName) {\n      var validKeys = [\n        'inline',\n        'block',\n        'selector',\n        'attributes',\n        'styles',\n        'classes'\n      ];\n      var filterObj = function (format) {\n        return filter$1(format, function (_, key) {\n          return exists(validKeys, function (validKey) {\n            return validKey === key;\n          });\n        });\n      };\n      return exists(editor.formatter.get(formatName), function (fmt1) {\n        var filteredFmt1 = filterObj(fmt1);\n        return exists(editor.formatter.get(otherFormatName), function (fmt2) {\n          var filteredFmt2 = filterObj(fmt2);\n          return equal(filteredFmt1, filteredFmt2);\n        });\n      });\n    };\n    var isBlockFormat = function (format) {\n      return hasNonNullableKey(format, 'block');\n    };\n    var isSelectorFormat = function (format) {\n      return hasNonNullableKey(format, 'selector');\n    };\n    var isInlineFormat = function (format) {\n      return hasNonNullableKey(format, 'inline');\n    };\n\n    var isBookmarkNode$2 = isBookmarkNode$1;\n    var getParents$2 = getParents$1;\n    var isWhiteSpaceNode$1 = isWhiteSpaceNode;\n    var isTextBlock$2 = isTextBlock$1;\n    var isBogusBr = function (node) {\n      return isBr(node) && node.getAttribute('data-mce-bogus') && !node.nextSibling;\n    };\n    var findParentContentEditable = function (dom, node) {\n      var parent = node;\n      while (parent) {\n        if (isElement$1(parent) && dom.getContentEditable(parent)) {\n          return dom.getContentEditable(parent) === 'false' ? parent : node;\n        }\n        parent = parent.parentNode;\n      }\n      return node;\n    };\n    var walkText = function (start, node, offset, predicate) {\n      var str = node.data;\n      for (var i = offset; start ? i >= 0 : i < str.length; start ? i-- : i++) {\n        if (predicate(str.charAt(i))) {\n          return start ? i + 1 : i;\n        }\n      }\n      return -1;\n    };\n    var findSpace = function (start, node, offset) {\n      return walkText(start, node, offset, function (c) {\n        return isNbsp(c) || isWhiteSpace$1(c);\n      });\n    };\n    var findContent = function (start, node, offset) {\n      return walkText(start, node, offset, isContent$1);\n    };\n    var findWordEndPoint = function (dom, body, container, offset, start, includeTrailingSpaces) {\n      var lastTextNode;\n      var rootNode = dom.getParent(container, dom.isBlock) || body;\n      var walk = function (container, offset, pred) {\n        var textSeeker = TextSeeker(dom);\n        var walker = start ? textSeeker.backwards : textSeeker.forwards;\n        return Optional.from(walker(container, offset, function (text, textOffset) {\n          if (isBookmarkNode$2(text.parentNode)) {\n            return -1;\n          } else {\n            lastTextNode = text;\n            return pred(start, text, textOffset);\n          }\n        }, rootNode));\n      };\n      var spaceResult = walk(container, offset, findSpace);\n      return spaceResult.bind(function (result) {\n        return includeTrailingSpaces ? walk(result.container, result.offset + (start ? -1 : 0), findContent) : Optional.some(result);\n      }).orThunk(function () {\n        return lastTextNode ? Optional.some({\n          container: lastTextNode,\n          offset: start ? 0 : lastTextNode.length\n        }) : Optional.none();\n      });\n    };\n    var findSelectorEndPoint = function (dom, format, rng, container, siblingName) {\n      if (isText$1(container) && container.nodeValue.length === 0 && container[siblingName]) {\n        container = container[siblingName];\n      }\n      var parents = getParents$2(dom, container);\n      for (var i = 0; i < parents.length; i++) {\n        for (var y = 0; y < format.length; y++) {\n          var curFormat = format[y];\n          if ('collapsed' in curFormat && curFormat.collapsed !== rng.collapsed) {\n            continue;\n          }\n          if (dom.is(parents[i], curFormat.selector)) {\n            return parents[i];\n          }\n        }\n      }\n      return container;\n    };\n    var findBlockEndPoint = function (editor, format, container, siblingName) {\n      var node;\n      var dom = editor.dom;\n      var root = dom.getRoot();\n      if (!format[0].wrapper) {\n        node = dom.getParent(container, format[0].block, root);\n      }\n      if (!node) {\n        var scopeRoot = dom.getParent(container, 'LI,TD,TH');\n        node = dom.getParent(isText$1(container) ? container.parentNode : container, function (node) {\n          return node !== root && isTextBlock$2(editor, node);\n        }, scopeRoot);\n      }\n      if (node && format[0].wrapper) {\n        node = getParents$2(dom, node, 'ul,ol').reverse()[0] || node;\n      }\n      if (!node) {\n        node = container;\n        while (node[siblingName] && !dom.isBlock(node[siblingName])) {\n          node = node[siblingName];\n          if (isEq(node, 'br')) {\n            break;\n          }\n        }\n      }\n      return node || container;\n    };\n    var isAtBlockBoundary = function (dom, root, container, siblingName) {\n      var parent = container.parentNode;\n      if (isNonNullable(container[siblingName])) {\n        return false;\n      } else if (parent === root || isNullable(parent) || dom.isBlock(parent)) {\n        return true;\n      } else {\n        return isAtBlockBoundary(dom, root, parent, siblingName);\n      }\n    };\n    var findParentContainer = function (dom, format, container, offset, start) {\n      var parent = container;\n      var sibling;\n      var siblingName = start ? 'previousSibling' : 'nextSibling';\n      var root = dom.getRoot();\n      if (isText$1(container) && !isWhiteSpaceNode$1(container)) {\n        if (start ? offset > 0 : offset < container.data.length) {\n          return container;\n        }\n      }\n      while (true) {\n        if (!format[0].block_expand && dom.isBlock(parent)) {\n          return parent;\n        }\n        for (sibling = parent[siblingName]; sibling; sibling = sibling[siblingName]) {\n          var allowSpaces = isText$1(sibling) && !isAtBlockBoundary(dom, root, sibling, siblingName);\n          if (!isBookmarkNode$2(sibling) && !isBogusBr(sibling) && !isWhiteSpaceNode$1(sibling, allowSpaces)) {\n            return parent;\n          }\n        }\n        if (parent === root || parent.parentNode === root) {\n          container = parent;\n          break;\n        }\n        parent = parent.parentNode;\n      }\n      return container;\n    };\n    var isSelfOrParentBookmark = function (container) {\n      return isBookmarkNode$2(container.parentNode) || isBookmarkNode$2(container);\n    };\n    var expandRng = function (editor, rng, format, includeTrailingSpace) {\n      if (includeTrailingSpace === void 0) {\n        includeTrailingSpace = false;\n      }\n      var startContainer = rng.startContainer, startOffset = rng.startOffset, endContainer = rng.endContainer, endOffset = rng.endOffset;\n      var dom = editor.dom;\n      if (isElement$1(startContainer) && startContainer.hasChildNodes()) {\n        startContainer = getNode(startContainer, startOffset);\n        if (isText$1(startContainer)) {\n          startOffset = 0;\n        }\n      }\n      if (isElement$1(endContainer) && endContainer.hasChildNodes()) {\n        endContainer = getNode(endContainer, rng.collapsed ? endOffset : endOffset - 1);\n        if (isText$1(endContainer)) {\n          endOffset = endContainer.nodeValue.length;\n        }\n      }\n      startContainer = findParentContentEditable(dom, startContainer);\n      endContainer = findParentContentEditable(dom, endContainer);\n      if (isSelfOrParentBookmark(startContainer)) {\n        startContainer = isBookmarkNode$2(startContainer) ? startContainer : startContainer.parentNode;\n        if (rng.collapsed) {\n          startContainer = startContainer.previousSibling || startContainer;\n        } else {\n          startContainer = startContainer.nextSibling || startContainer;\n        }\n        if (isText$1(startContainer)) {\n          startOffset = rng.collapsed ? startContainer.length : 0;\n        }\n      }\n      if (isSelfOrParentBookmark(endContainer)) {\n        endContainer = isBookmarkNode$2(endContainer) ? endContainer : endContainer.parentNode;\n        if (rng.collapsed) {\n          endContainer = endContainer.nextSibling || endContainer;\n        } else {\n          endContainer = endContainer.previousSibling || endContainer;\n        }\n        if (isText$1(endContainer)) {\n          endOffset = rng.collapsed ? 0 : endContainer.length;\n        }\n      }\n      if (rng.collapsed) {\n        var startPoint = findWordEndPoint(dom, editor.getBody(), startContainer, startOffset, true, includeTrailingSpace);\n        startPoint.each(function (_a) {\n          var container = _a.container, offset = _a.offset;\n          startContainer = container;\n          startOffset = offset;\n        });\n        var endPoint = findWordEndPoint(dom, editor.getBody(), endContainer, endOffset, false, includeTrailingSpace);\n        endPoint.each(function (_a) {\n          var container = _a.container, offset = _a.offset;\n          endContainer = container;\n          endOffset = offset;\n        });\n      }\n      if (format[0].inline || format[0].block_expand) {\n        if (!format[0].inline || (!isText$1(startContainer) || startOffset === 0)) {\n          startContainer = findParentContainer(dom, format, startContainer, startOffset, true);\n        }\n        if (!format[0].inline || (!isText$1(endContainer) || endOffset === endContainer.nodeValue.length)) {\n          endContainer = findParentContainer(dom, format, endContainer, endOffset, false);\n        }\n      }\n      if (format[0].selector && format[0].expand !== false && !format[0].inline) {\n        startContainer = findSelectorEndPoint(dom, format, rng, startContainer, 'previousSibling');\n        endContainer = findSelectorEndPoint(dom, format, rng, endContainer, 'nextSibling');\n      }\n      if (format[0].block || format[0].selector) {\n        startContainer = findBlockEndPoint(editor, format, startContainer, 'previousSibling');\n        endContainer = findBlockEndPoint(editor, format, endContainer, 'nextSibling');\n        if (format[0].block) {\n          if (!dom.isBlock(startContainer)) {\n            startContainer = findParentContainer(dom, format, startContainer, startOffset, true);\n          }\n          if (!dom.isBlock(endContainer)) {\n            endContainer = findParentContainer(dom, format, endContainer, endOffset, false);\n          }\n        }\n      }\n      if (isElement$1(startContainer)) {\n        startOffset = dom.nodeIndex(startContainer);\n        startContainer = startContainer.parentNode;\n      }\n      if (isElement$1(endContainer)) {\n        endOffset = dom.nodeIndex(endContainer) + 1;\n        endContainer = endContainer.parentNode;\n      }\n      return {\n        startContainer: startContainer,\n        startOffset: startOffset,\n        endContainer: endContainer,\n        endOffset: endOffset\n      };\n    };\n\n    var clampToExistingChildren = function (container, index) {\n      var childNodes = container.childNodes;\n      if (index >= childNodes.length) {\n        index = childNodes.length - 1;\n      } else if (index < 0) {\n        index = 0;\n      }\n      return childNodes[index] || container;\n    };\n    var getEndChild = function (container, index) {\n      return clampToExistingChildren(container, index - 1);\n    };\n    var walk$1 = function (dom, rng, callback) {\n      var startContainer = rng.startContainer;\n      var startOffset = rng.startOffset;\n      var endContainer = rng.endContainer;\n      var endOffset = rng.endOffset;\n      var exclude = function (nodes) {\n        var node;\n        node = nodes[0];\n        if (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {\n          nodes.splice(0, 1);\n        }\n        node = nodes[nodes.length - 1];\n        if (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {\n          nodes.splice(nodes.length - 1, 1);\n        }\n        return nodes;\n      };\n      var collectSiblings = function (node, name, endNode) {\n        var siblings = [];\n        for (; node && node !== endNode; node = node[name]) {\n          siblings.push(node);\n        }\n        return siblings;\n      };\n      var findEndPoint = function (node, root) {\n        do {\n          if (node.parentNode === root) {\n            return node;\n          }\n          node = node.parentNode;\n        } while (node);\n      };\n      var walkBoundary = function (startNode, endNode, next) {\n        var siblingName = next ? 'nextSibling' : 'previousSibling';\n        for (var node = startNode, parent_1 = node.parentNode; node && node !== endNode; node = parent_1) {\n          parent_1 = node.parentNode;\n          var siblings_1 = collectSiblings(node === startNode ? node : node[siblingName], siblingName);\n          if (siblings_1.length) {\n            if (!next) {\n              siblings_1.reverse();\n            }\n            callback(exclude(siblings_1));\n          }\n        }\n      };\n      if (startContainer.nodeType === 1 && startContainer.hasChildNodes()) {\n        startContainer = clampToExistingChildren(startContainer, startOffset);\n      }\n      if (endContainer.nodeType === 1 && endContainer.hasChildNodes()) {\n        endContainer = getEndChild(endContainer, endOffset);\n      }\n      if (startContainer === endContainer) {\n        return callback(exclude([startContainer]));\n      }\n      var ancestor = dom.findCommonAncestor(startContainer, endContainer);\n      for (var node = startContainer; node; node = node.parentNode) {\n        if (node === endContainer) {\n          return walkBoundary(startContainer, ancestor, true);\n        }\n        if (node === ancestor) {\n          break;\n        }\n      }\n      for (var node = endContainer; node; node = node.parentNode) {\n        if (node === startContainer) {\n          return walkBoundary(endContainer, ancestor);\n        }\n        if (node === ancestor) {\n          break;\n        }\n      }\n      var startPoint = findEndPoint(startContainer, ancestor) || startContainer;\n      var endPoint = findEndPoint(endContainer, ancestor) || endContainer;\n      walkBoundary(startContainer, startPoint, true);\n      var siblings = collectSiblings(startPoint === startContainer ? startPoint : startPoint.nextSibling, 'nextSibling', endPoint === endContainer ? endPoint.nextSibling : endPoint);\n      if (siblings.length) {\n        callback(exclude(siblings));\n      }\n      walkBoundary(endContainer, endPoint);\n    };\n\n    var getRanges = function (selection) {\n      var ranges = [];\n      if (selection) {\n        for (var i = 0; i < selection.rangeCount; i++) {\n          ranges.push(selection.getRangeAt(i));\n        }\n      }\n      return ranges;\n    };\n    var getSelectedNodes = function (ranges) {\n      return bind(ranges, function (range) {\n        var node = getSelectedNode(range);\n        return node ? [SugarElement.fromDom(node)] : [];\n      });\n    };\n    var hasMultipleRanges = function (selection) {\n      return getRanges(selection).length > 1;\n    };\n\n    var getCellsFromRanges = function (ranges) {\n      return filter(getSelectedNodes(ranges), isTableCell$1);\n    };\n    var getCellsFromElement = function (elm) {\n      return descendants$1(elm, 'td[data-mce-selected],th[data-mce-selected]');\n    };\n    var getCellsFromElementOrRanges = function (ranges, element) {\n      var selectedCells = getCellsFromElement(element);\n      return selectedCells.length > 0 ? selectedCells : getCellsFromRanges(ranges);\n    };\n    var getCellsFromEditor = function (editor) {\n      return getCellsFromElementOrRanges(getRanges(editor.selection.getSel()), SugarElement.fromDom(editor.getBody()));\n    };\n\n    var getStartNode = function (rng) {\n      var sc = rng.startContainer, so = rng.startOffset;\n      if (isText$1(sc)) {\n        return so === 0 ? Optional.some(SugarElement.fromDom(sc)) : Optional.none();\n      } else {\n        return Optional.from(sc.childNodes[so]).map(SugarElement.fromDom);\n      }\n    };\n    var getEndNode = function (rng) {\n      var ec = rng.endContainer, eo = rng.endOffset;\n      if (isText$1(ec)) {\n        return eo === ec.data.length ? Optional.some(SugarElement.fromDom(ec)) : Optional.none();\n      } else {\n        return Optional.from(ec.childNodes[eo - 1]).map(SugarElement.fromDom);\n      }\n    };\n    var getFirstChildren = function (node) {\n      return firstChild(node).fold(constant([node]), function (child) {\n        return [node].concat(getFirstChildren(child));\n      });\n    };\n    var getLastChildren = function (node) {\n      return lastChild(node).fold(constant([node]), function (child) {\n        if (name(child) === 'br') {\n          return prevSibling(child).map(function (sibling) {\n            return [node].concat(getLastChildren(sibling));\n          }).getOr([]);\n        } else {\n          return [node].concat(getLastChildren(child));\n        }\n      });\n    };\n    var hasAllContentsSelected = function (elm, rng) {\n      return lift2(getStartNode(rng), getEndNode(rng), function (startNode, endNode) {\n        var start = find(getFirstChildren(elm), curry(eq$2, startNode));\n        var end = find(getLastChildren(elm), curry(eq$2, endNode));\n        return start.isSome() && end.isSome();\n      }).getOr(false);\n    };\n    var moveEndPoint$1 = function (dom, rng, node, start) {\n      var root = node, walker = new DomTreeWalker(node, root);\n      var moveCaretBeforeOnEnterElementsMap = filter$1(dom.schema.getMoveCaretBeforeOnEnterElements(), function (_, name) {\n        return !contains([\n          'td',\n          'th',\n          'table'\n        ], name.toLowerCase());\n      });\n      do {\n        if (isText$1(node) && Tools.trim(node.nodeValue).length !== 0) {\n          if (start) {\n            rng.setStart(node, 0);\n          } else {\n            rng.setEnd(node, node.nodeValue.length);\n          }\n          return;\n        }\n        if (moveCaretBeforeOnEnterElementsMap[node.nodeName]) {\n          if (start) {\n            rng.setStartBefore(node);\n          } else {\n            if (node.nodeName === 'BR') {\n              rng.setEndBefore(node);\n            } else {\n              rng.setEndAfter(node);\n            }\n          }\n          return;\n        }\n      } while (node = start ? walker.next() : walker.prev());\n      if (root.nodeName === 'BODY') {\n        if (start) {\n          rng.setStart(root, 0);\n        } else {\n          rng.setEnd(root, root.childNodes.length);\n        }\n      }\n    };\n    var hasAnyRanges = function (editor) {\n      var sel = editor.selection.getSel();\n      return sel && sel.rangeCount > 0;\n    };\n    var runOnRanges = function (editor, executor) {\n      var fakeSelectionNodes = getCellsFromEditor(editor);\n      if (fakeSelectionNodes.length > 0) {\n        each(fakeSelectionNodes, function (elem) {\n          var node = elem.dom;\n          var fakeNodeRng = editor.dom.createRng();\n          fakeNodeRng.setStartBefore(node);\n          fakeNodeRng.setEndAfter(node);\n          executor(fakeNodeRng, true);\n        });\n      } else {\n        executor(editor.selection.getRng(), false);\n      }\n    };\n    var preserve = function (selection, fillBookmark, executor) {\n      var bookmark = getPersistentBookmark(selection, fillBookmark);\n      executor(bookmark);\n      selection.moveToBookmark(bookmark);\n    };\n\n    function NodeValue (is, name) {\n      var get = function (element) {\n        if (!is(element)) {\n          throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\n        }\n        return getOption(element).getOr('');\n      };\n      var getOption = function (element) {\n        return is(element) ? Optional.from(element.dom.nodeValue) : Optional.none();\n      };\n      var set = function (element, value) {\n        if (!is(element)) {\n          throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\n        }\n        element.dom.nodeValue = value;\n      };\n      return {\n        get: get,\n        getOption: getOption,\n        set: set\n      };\n    }\n\n    var api = NodeValue(isText, 'text');\n    var get$8 = function (element) {\n      return api.get(element);\n    };\n\n    var isZeroWidth = function (elem) {\n      return isText(elem) && get$8(elem) === ZWSP;\n    };\n    var context = function (editor, elem, wrapName, nodeName) {\n      return parent(elem).fold(function () {\n        return 'skipping';\n      }, function (parent) {\n        if (nodeName === 'br' || isZeroWidth(elem)) {\n          return 'valid';\n        } else if (isAnnotation(elem)) {\n          return 'existing';\n        } else if (isCaretNode(elem.dom)) {\n          return 'caret';\n        } else if (!isValid(editor, wrapName, nodeName) || !isValid(editor, name(parent), wrapName)) {\n          return 'invalid-child';\n        } else {\n          return 'valid';\n        }\n      });\n    };\n\n    var applyWordGrab = function (editor, rng) {\n      var r = expandRng(editor, rng, [{ inline: true }]);\n      rng.setStart(r.startContainer, r.startOffset);\n      rng.setEnd(r.endContainer, r.endOffset);\n      editor.selection.setRng(rng);\n    };\n    var makeAnnotation = function (eDoc, _a, annotationName, decorate) {\n      var _b = _a.uid, uid = _b === void 0 ? generate$1('mce-annotation') : _b, data = __rest(_a, ['uid']);\n      var master = SugarElement.fromTag('span', eDoc);\n      add$3(master, annotation());\n      set(master, '' + dataAnnotationId(), uid);\n      set(master, '' + dataAnnotation(), annotationName);\n      var _c = decorate(uid, data), _d = _c.attributes, attributes = _d === void 0 ? {} : _d, _e = _c.classes, classes = _e === void 0 ? [] : _e;\n      setAll(master, attributes);\n      add$4(master, classes);\n      return master;\n    };\n    var annotate = function (editor, rng, annotationName, decorate, data) {\n      var newWrappers = [];\n      var master = makeAnnotation(editor.getDoc(), data, annotationName, decorate);\n      var wrapper = Cell(Optional.none());\n      var finishWrapper = function () {\n        wrapper.set(Optional.none());\n      };\n      var getOrOpenWrapper = function () {\n        return wrapper.get().getOrThunk(function () {\n          var nu = shallow(master);\n          newWrappers.push(nu);\n          wrapper.set(Optional.some(nu));\n          return nu;\n        });\n      };\n      var processElements = function (elems) {\n        each(elems, processElement);\n      };\n      var processElement = function (elem) {\n        var ctx = context(editor, elem, 'span', name(elem));\n        switch (ctx) {\n        case 'invalid-child': {\n            finishWrapper();\n            var children$1 = children(elem);\n            processElements(children$1);\n            finishWrapper();\n            break;\n          }\n        case 'valid': {\n            var w = getOrOpenWrapper();\n            wrap(elem, w);\n            break;\n          }\n        }\n      };\n      var processNodes = function (nodes) {\n        var elems = map(nodes, SugarElement.fromDom);\n        processElements(elems);\n      };\n      walk$1(editor.dom, rng, function (nodes) {\n        finishWrapper();\n        processNodes(nodes);\n      });\n      return newWrappers;\n    };\n    var annotateWithBookmark = function (editor, name, settings, data) {\n      editor.undoManager.transact(function () {\n        var selection = editor.selection;\n        var initialRng = selection.getRng();\n        var hasFakeSelection = getCellsFromEditor(editor).length > 0;\n        if (initialRng.collapsed && !hasFakeSelection) {\n          applyWordGrab(editor, initialRng);\n        }\n        if (selection.getRng().collapsed && !hasFakeSelection) {\n          var wrapper = makeAnnotation(editor.getDoc(), data, name, settings.decorate);\n          set$1(wrapper, nbsp);\n          selection.getRng().insertNode(wrapper.dom);\n          selection.select(wrapper.dom);\n        } else {\n          preserve(selection, false, function () {\n            runOnRanges(editor, function (selectionRng) {\n              annotate(editor, selectionRng, name, settings.decorate, data);\n            });\n          });\n        }\n      });\n    };\n\n    var Annotator = function (editor) {\n      var registry = create$2();\n      setup$1(editor, registry);\n      var changes = setup(editor);\n      return {\n        register: function (name, settings) {\n          registry.register(name, settings);\n        },\n        annotate: function (name, data) {\n          registry.lookup(name).each(function (settings) {\n            annotateWithBookmark(editor, name, settings, data);\n          });\n        },\n        annotationChanged: function (name, callback) {\n          changes.addListener(name, callback);\n        },\n        remove: function (name) {\n          identify(editor, Optional.some(name)).each(function (_a) {\n            var elements = _a.elements;\n            each(elements, unwrap);\n          });\n        },\n        getAll: function (name) {\n          var directory = findAll(editor, name);\n          return map$1(directory, function (elems) {\n            return map(elems, function (elem) {\n              return elem.dom;\n            });\n          });\n        }\n      };\n    };\n\n    function BookmarkManager(selection) {\n      return {\n        getBookmark: curry(getBookmark$1, selection),\n        moveToBookmark: curry(moveToBookmark, selection)\n      };\n    }\n    (function (BookmarkManager) {\n      BookmarkManager.isBookmarkNode = isBookmarkNode$1;\n    }(BookmarkManager || (BookmarkManager = {})));\n    var BookmarkManager$1 = BookmarkManager;\n\n    var getContentEditableRoot = function (root, node) {\n      while (node && node !== root) {\n        if (isContentEditableTrue(node) || isContentEditableFalse(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n\n    var isXYWithinRange = function (clientX, clientY, range) {\n      if (range.collapsed) {\n        return false;\n      }\n      if (Env.browser.isIE() && range.startOffset === range.endOffset - 1 && range.startContainer === range.endContainer) {\n        var elm = range.startContainer.childNodes[range.startOffset];\n        if (isElement$1(elm)) {\n          return exists(elm.getClientRects(), function (rect) {\n            return containsXY(rect, clientX, clientY);\n          });\n        }\n      }\n      return exists(range.getClientRects(), function (rect) {\n        return containsXY(rect, clientX, clientY);\n      });\n    };\n\n    var firePreProcess = function (editor, args) {\n      return editor.fire('PreProcess', args);\n    };\n    var firePostProcess = function (editor, args) {\n      return editor.fire('PostProcess', args);\n    };\n    var fireRemove = function (editor) {\n      return editor.fire('remove');\n    };\n    var fireDetach = function (editor) {\n      return editor.fire('detach');\n    };\n    var fireSwitchMode = function (editor, mode) {\n      return editor.fire('SwitchMode', { mode: mode });\n    };\n    var fireObjectResizeStart = function (editor, target, width, height, origin) {\n      editor.fire('ObjectResizeStart', {\n        target: target,\n        width: width,\n        height: height,\n        origin: origin\n      });\n    };\n    var fireObjectResized = function (editor, target, width, height, origin) {\n      editor.fire('ObjectResized', {\n        target: target,\n        width: width,\n        height: height,\n        origin: origin\n      });\n    };\n    var firePreInit = function (editor) {\n      return editor.fire('PreInit');\n    };\n    var firePostRender = function (editor) {\n      return editor.fire('PostRender');\n    };\n    var fireInit = function (editor) {\n      return editor.fire('Init');\n    };\n    var firePlaceholderToggle = function (editor, state) {\n      return editor.fire('PlaceholderToggle', { state: state });\n    };\n    var fireError = function (editor, errorType, error) {\n      return editor.fire(errorType, error);\n    };\n\n    var VK = {\n      BACKSPACE: 8,\n      DELETE: 46,\n      DOWN: 40,\n      ENTER: 13,\n      LEFT: 37,\n      RIGHT: 39,\n      SPACEBAR: 32,\n      TAB: 9,\n      UP: 38,\n      END: 35,\n      HOME: 36,\n      modifierPressed: function (e) {\n        return e.shiftKey || e.ctrlKey || e.altKey || this.metaKeyPressed(e);\n      },\n      metaKeyPressed: function (e) {\n        return Env.mac ? e.metaKey : e.ctrlKey && !e.altKey;\n      }\n    };\n\n    var isContentEditableFalse$6 = isContentEditableFalse;\n    var ControlSelection = function (selection, editor) {\n      var dom = editor.dom, each = Tools.each;\n      var selectedElm, selectedElmGhost, resizeHelper, selectedHandle;\n      var startX, startY, selectedElmX, selectedElmY, startW, startH, ratio, resizeStarted;\n      var width, height;\n      var editableDoc = editor.getDoc(), rootDocument = document;\n      var abs = Math.abs, round = Math.round, rootElement = editor.getBody();\n      var startScrollWidth, startScrollHeight;\n      var resizeHandles = {\n        nw: [\n          0,\n          0,\n          -1,\n          -1\n        ],\n        ne: [\n          1,\n          0,\n          1,\n          -1\n        ],\n        se: [\n          1,\n          1,\n          1,\n          1\n        ],\n        sw: [\n          0,\n          1,\n          -1,\n          1\n        ]\n      };\n      var isImage = function (elm) {\n        return elm && (elm.nodeName === 'IMG' || editor.dom.is(elm, 'figure.image'));\n      };\n      var isEventOnImageOutsideRange = function (evt, range) {\n        if (evt.type === 'longpress' || evt.type.indexOf('touch') === 0) {\n          var touch = evt.touches[0];\n          return isImage(evt.target) && !isXYWithinRange(touch.clientX, touch.clientY, range);\n        } else {\n          return isImage(evt.target) && !isXYWithinRange(evt.clientX, evt.clientY, range);\n        }\n      };\n      var contextMenuSelectImage = function (evt) {\n        var target = evt.target;\n        if (isEventOnImageOutsideRange(evt, editor.selection.getRng()) && !evt.isDefaultPrevented()) {\n          editor.selection.select(target);\n        }\n      };\n      var getResizeTarget = function (elm) {\n        return editor.dom.is(elm, 'figure.image') ? elm.querySelector('img') : elm;\n      };\n      var isResizable = function (elm) {\n        var selector = getObjectResizing(editor);\n        if (!selector) {\n          return false;\n        }\n        if (elm.getAttribute('data-mce-resize') === 'false') {\n          return false;\n        }\n        if (elm === editor.getBody()) {\n          return false;\n        }\n        return is$1(SugarElement.fromDom(elm), selector);\n      };\n      var setGhostElmSize = function (ghostElm, width, height) {\n        dom.setStyles(getResizeTarget(ghostElm), {\n          width: width,\n          height: height\n        });\n      };\n      var resizeGhostElement = function (e) {\n        var deltaX, deltaY, proportional;\n        var resizeHelperX, resizeHelperY;\n        deltaX = e.screenX - startX;\n        deltaY = e.screenY - startY;\n        width = deltaX * selectedHandle[2] + startW;\n        height = deltaY * selectedHandle[3] + startH;\n        width = width < 5 ? 5 : width;\n        height = height < 5 ? 5 : height;\n        if (isImage(selectedElm) && getResizeImgProportional(editor) !== false) {\n          proportional = !VK.modifierPressed(e);\n        } else {\n          proportional = VK.modifierPressed(e);\n        }\n        if (proportional) {\n          if (abs(deltaX) > abs(deltaY)) {\n            height = round(width * ratio);\n            width = round(height / ratio);\n          } else {\n            width = round(height / ratio);\n            height = round(width * ratio);\n          }\n        }\n        setGhostElmSize(selectedElmGhost, width, height);\n        resizeHelperX = selectedHandle.startPos.x + deltaX;\n        resizeHelperY = selectedHandle.startPos.y + deltaY;\n        resizeHelperX = resizeHelperX > 0 ? resizeHelperX : 0;\n        resizeHelperY = resizeHelperY > 0 ? resizeHelperY : 0;\n        dom.setStyles(resizeHelper, {\n          left: resizeHelperX,\n          top: resizeHelperY,\n          display: 'block'\n        });\n        resizeHelper.innerHTML = width + ' &times; ' + height;\n        if (selectedHandle[2] < 0 && selectedElmGhost.clientWidth <= width) {\n          dom.setStyle(selectedElmGhost, 'left', selectedElmX + (startW - width));\n        }\n        if (selectedHandle[3] < 0 && selectedElmGhost.clientHeight <= height) {\n          dom.setStyle(selectedElmGhost, 'top', selectedElmY + (startH - height));\n        }\n        deltaX = rootElement.scrollWidth - startScrollWidth;\n        deltaY = rootElement.scrollHeight - startScrollHeight;\n        if (deltaX + deltaY !== 0) {\n          dom.setStyles(resizeHelper, {\n            left: resizeHelperX - deltaX,\n            top: resizeHelperY - deltaY\n          });\n        }\n        if (!resizeStarted) {\n          fireObjectResizeStart(editor, selectedElm, startW, startH, 'corner-' + selectedHandle.name);\n          resizeStarted = true;\n        }\n      };\n      var endGhostResize = function () {\n        var wasResizeStarted = resizeStarted;\n        resizeStarted = false;\n        var setSizeProp = function (name, value) {\n          if (value) {\n            if (selectedElm.style[name] || !editor.schema.isValid(selectedElm.nodeName.toLowerCase(), name)) {\n              dom.setStyle(getResizeTarget(selectedElm), name, value);\n            } else {\n              dom.setAttrib(getResizeTarget(selectedElm), name, '' + value);\n            }\n          }\n        };\n        if (wasResizeStarted) {\n          setSizeProp('width', width);\n          setSizeProp('height', height);\n        }\n        dom.unbind(editableDoc, 'mousemove', resizeGhostElement);\n        dom.unbind(editableDoc, 'mouseup', endGhostResize);\n        if (rootDocument !== editableDoc) {\n          dom.unbind(rootDocument, 'mousemove', resizeGhostElement);\n          dom.unbind(rootDocument, 'mouseup', endGhostResize);\n        }\n        dom.remove(selectedElmGhost);\n        dom.remove(resizeHelper);\n        showResizeRect(selectedElm);\n        if (wasResizeStarted) {\n          fireObjectResized(editor, selectedElm, width, height, 'corner-' + selectedHandle.name);\n          dom.setAttrib(selectedElm, 'style', dom.getAttrib(selectedElm, 'style'));\n        }\n        editor.nodeChanged();\n      };\n      var showResizeRect = function (targetElm) {\n        hideResizeRect();\n        unbindResizeHandleEvents();\n        var position = dom.getPos(targetElm, rootElement);\n        var selectedElmX = position.x;\n        var selectedElmY = position.y;\n        var rect = targetElm.getBoundingClientRect();\n        var targetWidth = rect.width || rect.right - rect.left;\n        var targetHeight = rect.height || rect.bottom - rect.top;\n        if (selectedElm !== targetElm) {\n          selectedElm = targetElm;\n          width = height = 0;\n        }\n        var e = editor.fire('ObjectSelected', { target: targetElm });\n        if (isResizable(targetElm) && !e.isDefaultPrevented()) {\n          each(resizeHandles, function (handle, name) {\n            var handleElm;\n            var startDrag = function (e) {\n              startX = e.screenX;\n              startY = e.screenY;\n              startW = getResizeTarget(selectedElm).clientWidth;\n              startH = getResizeTarget(selectedElm).clientHeight;\n              ratio = startH / startW;\n              selectedHandle = handle;\n              selectedHandle.name = name;\n              selectedHandle.startPos = {\n                x: targetWidth * handle[0] + selectedElmX,\n                y: targetHeight * handle[1] + selectedElmY\n              };\n              startScrollWidth = rootElement.scrollWidth;\n              startScrollHeight = rootElement.scrollHeight;\n              selectedElmGhost = selectedElm.cloneNode(true);\n              dom.addClass(selectedElmGhost, 'mce-clonedresizable');\n              dom.setAttrib(selectedElmGhost, 'data-mce-bogus', 'all');\n              selectedElmGhost.contentEditable = false;\n              selectedElmGhost.unSelectabe = true;\n              dom.setStyles(selectedElmGhost, {\n                left: selectedElmX,\n                top: selectedElmY,\n                margin: 0\n              });\n              setGhostElmSize(selectedElmGhost, targetWidth, targetHeight);\n              selectedElmGhost.removeAttribute('data-mce-selected');\n              rootElement.appendChild(selectedElmGhost);\n              dom.bind(editableDoc, 'mousemove', resizeGhostElement);\n              dom.bind(editableDoc, 'mouseup', endGhostResize);\n              if (rootDocument !== editableDoc) {\n                dom.bind(rootDocument, 'mousemove', resizeGhostElement);\n                dom.bind(rootDocument, 'mouseup', endGhostResize);\n              }\n              resizeHelper = dom.add(rootElement, 'div', {\n                'class': 'mce-resize-helper',\n                'data-mce-bogus': 'all'\n              }, startW + ' &times; ' + startH);\n            };\n            handleElm = dom.get('mceResizeHandle' + name);\n            if (handleElm) {\n              dom.remove(handleElm);\n            }\n            handleElm = dom.add(rootElement, 'div', {\n              'id': 'mceResizeHandle' + name,\n              'data-mce-bogus': 'all',\n              'class': 'mce-resizehandle',\n              'unselectable': true,\n              'style': 'cursor:' + name + '-resize; margin:0; padding:0'\n            });\n            if (Env.ie === 11) {\n              handleElm.contentEditable = false;\n            }\n            dom.bind(handleElm, 'mousedown', function (e) {\n              e.stopImmediatePropagation();\n              e.preventDefault();\n              startDrag(e);\n            });\n            handle.elm = handleElm;\n            dom.setStyles(handleElm, {\n              left: targetWidth * handle[0] + selectedElmX - handleElm.offsetWidth / 2,\n              top: targetHeight * handle[1] + selectedElmY - handleElm.offsetHeight / 2\n            });\n          });\n        } else {\n          hideResizeRect();\n        }\n        selectedElm.setAttribute('data-mce-selected', '1');\n      };\n      var hideResizeRect = function () {\n        unbindResizeHandleEvents();\n        if (selectedElm) {\n          selectedElm.removeAttribute('data-mce-selected');\n        }\n        each$1(resizeHandles, function (value, name) {\n          var handleElm = dom.get('mceResizeHandle' + name);\n          if (handleElm) {\n            dom.unbind(handleElm);\n            dom.remove(handleElm);\n          }\n        });\n      };\n      var updateResizeRect = function (e) {\n        var startElm, controlElm;\n        var isChildOrEqual = function (node, parent) {\n          if (node) {\n            do {\n              if (node === parent) {\n                return true;\n              }\n            } while (node = node.parentNode);\n          }\n        };\n        if (resizeStarted || editor.removed) {\n          return;\n        }\n        each(dom.select('img[data-mce-selected],hr[data-mce-selected]'), function (img) {\n          img.removeAttribute('data-mce-selected');\n        });\n        controlElm = e.type === 'mousedown' ? e.target : selection.getNode();\n        controlElm = dom.$(controlElm).closest('table,img,figure.image,hr')[0];\n        if (isChildOrEqual(controlElm, rootElement)) {\n          disableGeckoResize();\n          startElm = selection.getStart(true);\n          if (isChildOrEqual(startElm, controlElm) && isChildOrEqual(selection.getEnd(true), controlElm)) {\n            showResizeRect(controlElm);\n            return;\n          }\n        }\n        hideResizeRect();\n      };\n      var isWithinContentEditableFalse = function (elm) {\n        return isContentEditableFalse$6(getContentEditableRoot(editor.getBody(), elm));\n      };\n      var unbindResizeHandleEvents = function () {\n        each$1(resizeHandles, function (handle) {\n          if (handle.elm) {\n            dom.unbind(handle.elm);\n            delete handle.elm;\n          }\n        });\n      };\n      var disableGeckoResize = function () {\n        try {\n          editor.getDoc().execCommand('enableObjectResizing', false, 'false');\n        } catch (ex) {\n        }\n      };\n      editor.on('init', function () {\n        disableGeckoResize();\n        if (Env.browser.isIE() || Env.browser.isEdge()) {\n          editor.on('mousedown click', function (e) {\n            var target = e.target, nodeName = target.nodeName;\n            if (!resizeStarted && /^(TABLE|IMG|HR)$/.test(nodeName) && !isWithinContentEditableFalse(target)) {\n              if (e.button !== 2) {\n                editor.selection.select(target, nodeName === 'TABLE');\n              }\n              if (e.type === 'mousedown') {\n                editor.nodeChanged();\n              }\n            }\n          });\n          var handleMSControlSelect_1 = function (e) {\n            var delayedSelect = function (node) {\n              Delay.setEditorTimeout(editor, function () {\n                return editor.selection.select(node);\n              });\n            };\n            if (isWithinContentEditableFalse(e.target) || isMedia(e.target)) {\n              e.preventDefault();\n              delayedSelect(e.target);\n              return;\n            }\n            if (/^(TABLE|IMG|HR)$/.test(e.target.nodeName)) {\n              e.preventDefault();\n              if (e.target.tagName === 'IMG') {\n                delayedSelect(e.target);\n              }\n            }\n          };\n          dom.bind(rootElement, 'mscontrolselect', handleMSControlSelect_1);\n          editor.on('remove', function () {\n            return dom.unbind(rootElement, 'mscontrolselect', handleMSControlSelect_1);\n          });\n        }\n        var throttledUpdateResizeRect = Delay.throttle(function (e) {\n          if (!editor.composing) {\n            updateResizeRect(e);\n          }\n        });\n        editor.on('nodechange ResizeEditor ResizeWindow ResizeContent drop FullscreenStateChanged', throttledUpdateResizeRect);\n        editor.on('keyup compositionend', function (e) {\n          if (selectedElm && selectedElm.nodeName === 'TABLE') {\n            throttledUpdateResizeRect(e);\n          }\n        });\n        editor.on('hide blur', hideResizeRect);\n        editor.on('contextmenu longpress', contextMenuSelectImage, true);\n      });\n      editor.on('remove', unbindResizeHandleEvents);\n      var destroy = function () {\n        selectedElm = selectedElmGhost = null;\n      };\n      return {\n        isResizable: isResizable,\n        showResizeRect: showResizeRect,\n        hideResizeRect: hideResizeRect,\n        updateResizeRect: updateResizeRect,\n        destroy: destroy\n      };\n    };\n\n    var hasCeProperty = function (node) {\n      return isContentEditableTrue(node) || isContentEditableFalse(node);\n    };\n    var findParent = function (node, rootNode, predicate) {\n      while (node && node !== rootNode) {\n        if (predicate(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var findClosestIeRange = function (clientX, clientY, doc) {\n      var rects;\n      var element = doc.elementFromPoint(clientX, clientY);\n      var rng = doc.body.createTextRange();\n      if (!element || element.tagName === 'HTML') {\n        element = doc.body;\n      }\n      rng.moveToElementText(element);\n      rects = Tools.toArray(rng.getClientRects());\n      rects = rects.sort(function (a, b) {\n        a = Math.abs(Math.max(a.top - clientY, a.bottom - clientY));\n        b = Math.abs(Math.max(b.top - clientY, b.bottom - clientY));\n        return a - b;\n      });\n      if (rects.length > 0) {\n        clientY = (rects[0].bottom + rects[0].top) / 2;\n        try {\n          rng.moveToPoint(clientX, clientY);\n          rng.collapse(true);\n          return rng;\n        } catch (ex) {\n        }\n      }\n      return null;\n    };\n    var moveOutOfContentEditableFalse = function (rng, rootNode) {\n      var parentElement = rng && rng.parentElement ? rng.parentElement() : null;\n      return isContentEditableFalse(findParent(parentElement, rootNode, hasCeProperty)) ? null : rng;\n    };\n    var fromPoint$1 = function (clientX, clientY, doc) {\n      var rng, point;\n      var pointDoc = doc;\n      if (pointDoc.caretPositionFromPoint) {\n        point = pointDoc.caretPositionFromPoint(clientX, clientY);\n        if (point) {\n          rng = doc.createRange();\n          rng.setStart(point.offsetNode, point.offset);\n          rng.collapse(true);\n        }\n      } else if (doc.caretRangeFromPoint) {\n        rng = doc.caretRangeFromPoint(clientX, clientY);\n      } else if (pointDoc.body.createTextRange) {\n        rng = pointDoc.body.createTextRange();\n        try {\n          rng.moveToPoint(clientX, clientY);\n          rng.collapse(true);\n        } catch (ex) {\n          rng = findClosestIeRange(clientX, clientY, doc);\n        }\n        return moveOutOfContentEditableFalse(rng, doc.body);\n      }\n      return rng;\n    };\n\n    var isEq$1 = function (rng1, rng2) {\n      return rng1 && rng2 && (rng1.startContainer === rng2.startContainer && rng1.startOffset === rng2.startOffset) && (rng1.endContainer === rng2.endContainer && rng1.endOffset === rng2.endOffset);\n    };\n\n    var findParent$1 = function (node, rootNode, predicate) {\n      while (node && node !== rootNode) {\n        if (predicate(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var hasParent = function (node, rootNode, predicate) {\n      return findParent$1(node, rootNode, predicate) !== null;\n    };\n    var hasParentWithName = function (node, rootNode, name) {\n      return hasParent(node, rootNode, function (node) {\n        return node.nodeName === name;\n      });\n    };\n    var isTable$3 = function (node) {\n      return node && node.nodeName === 'TABLE';\n    };\n    var isTableCell$3 = function (node) {\n      return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n    };\n    var isCeFalseCaretContainer = function (node, rootNode) {\n      return isCaretContainer(node) && hasParent(node, rootNode, isCaretNode) === false;\n    };\n    var hasBrBeforeAfter = function (dom, node, left) {\n      var walker = new DomTreeWalker(node, dom.getParent(node.parentNode, dom.isBlock) || dom.getRoot());\n      while (node = walker[left ? 'prev' : 'next']()) {\n        if (isBr(node)) {\n          return true;\n        }\n      }\n    };\n    var isPrevNode = function (node, name) {\n      return node.previousSibling && node.previousSibling.nodeName === name;\n    };\n    var hasContentEditableFalseParent = function (body, node) {\n      while (node && node !== body) {\n        if (isContentEditableFalse(node)) {\n          return true;\n        }\n        node = node.parentNode;\n      }\n      return false;\n    };\n    var findTextNodeRelative = function (dom, isAfterNode, collapsed, left, startNode) {\n      var lastInlineElement;\n      var body = dom.getRoot();\n      var node;\n      var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n      var parentBlockContainer = dom.getParent(startNode.parentNode, dom.isBlock) || body;\n      if (left && isBr(startNode) && isAfterNode && dom.isEmpty(parentBlockContainer)) {\n        return Optional.some(CaretPosition(startNode.parentNode, dom.nodeIndex(startNode)));\n      }\n      var walker = new DomTreeWalker(startNode, parentBlockContainer);\n      while (node = walker[left ? 'prev' : 'next']()) {\n        if (dom.getContentEditableParent(node) === 'false' || isCeFalseCaretContainer(node, body)) {\n          return Optional.none();\n        }\n        if (isText$1(node) && node.nodeValue.length > 0) {\n          if (hasParentWithName(node, body, 'A') === false) {\n            return Optional.some(CaretPosition(node, left ? node.nodeValue.length : 0));\n          }\n          return Optional.none();\n        }\n        if (dom.isBlock(node) || nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n          return Optional.none();\n        }\n        lastInlineElement = node;\n      }\n      if (collapsed && lastInlineElement) {\n        return Optional.some(CaretPosition(lastInlineElement, 0));\n      }\n      return Optional.none();\n    };\n    var normalizeEndPoint = function (dom, collapsed, start, rng) {\n      var container, offset;\n      var body = dom.getRoot();\n      var node;\n      var directionLeft, normalized = false;\n      container = rng[(start ? 'start' : 'end') + 'Container'];\n      offset = rng[(start ? 'start' : 'end') + 'Offset'];\n      var isAfterNode = isElement$1(container) && offset === container.childNodes.length;\n      var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n      directionLeft = start;\n      if (isCaretContainer(container)) {\n        return Optional.none();\n      }\n      if (isElement$1(container) && offset > container.childNodes.length - 1) {\n        directionLeft = false;\n      }\n      if (isDocument$1(container)) {\n        container = body;\n        offset = 0;\n      }\n      if (container === body) {\n        if (directionLeft) {\n          node = container.childNodes[offset > 0 ? offset - 1 : 0];\n          if (node) {\n            if (isCaretContainer(node)) {\n              return Optional.none();\n            }\n            if (nonEmptyElementsMap[node.nodeName] || isTable$3(node)) {\n              return Optional.none();\n            }\n          }\n        }\n        if (container.hasChildNodes()) {\n          offset = Math.min(!directionLeft && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1);\n          container = container.childNodes[offset];\n          offset = isText$1(container) && isAfterNode ? container.data.length : 0;\n          if (!collapsed && container === body.lastChild && isTable$3(container)) {\n            return Optional.none();\n          }\n          if (hasContentEditableFalseParent(body, container) || isCaretContainer(container)) {\n            return Optional.none();\n          }\n          if (container.hasChildNodes() && isTable$3(container) === false) {\n            node = container;\n            var walker = new DomTreeWalker(container, body);\n            do {\n              if (isContentEditableFalse(node) || isCaretContainer(node)) {\n                normalized = false;\n                break;\n              }\n              if (isText$1(node) && node.nodeValue.length > 0) {\n                offset = directionLeft ? 0 : node.nodeValue.length;\n                container = node;\n                normalized = true;\n                break;\n              }\n              if (nonEmptyElementsMap[node.nodeName.toLowerCase()] && !isTableCell$3(node)) {\n                offset = dom.nodeIndex(node);\n                container = node.parentNode;\n                if (!directionLeft) {\n                  offset++;\n                }\n                normalized = true;\n                break;\n              }\n            } while (node = directionLeft ? walker.next() : walker.prev());\n          }\n        }\n      }\n      if (collapsed) {\n        if (isText$1(container) && offset === 0) {\n          findTextNodeRelative(dom, isAfterNode, collapsed, true, container).each(function (pos) {\n            container = pos.container();\n            offset = pos.offset();\n            normalized = true;\n          });\n        }\n        if (isElement$1(container)) {\n          node = container.childNodes[offset];\n          if (!node) {\n            node = container.childNodes[offset - 1];\n          }\n          if (node && isBr(node) && !isPrevNode(node, 'A') && !hasBrBeforeAfter(dom, node, false) && !hasBrBeforeAfter(dom, node, true)) {\n            findTextNodeRelative(dom, isAfterNode, collapsed, true, node).each(function (pos) {\n              container = pos.container();\n              offset = pos.offset();\n              normalized = true;\n            });\n          }\n        }\n      }\n      if (directionLeft && !collapsed && isText$1(container) && offset === container.nodeValue.length) {\n        findTextNodeRelative(dom, isAfterNode, collapsed, false, container).each(function (pos) {\n          container = pos.container();\n          offset = pos.offset();\n          normalized = true;\n        });\n      }\n      return normalized ? Optional.some(CaretPosition(container, offset)) : Optional.none();\n    };\n    var normalize = function (dom, rng) {\n      var collapsed = rng.collapsed, normRng = rng.cloneRange();\n      var startPos = CaretPosition.fromRangeStart(rng);\n      normalizeEndPoint(dom, collapsed, true, normRng).each(function (pos) {\n        if (!collapsed || !CaretPosition.isAbove(startPos, pos)) {\n          normRng.setStart(pos.container(), pos.offset());\n        }\n      });\n      if (!collapsed) {\n        normalizeEndPoint(dom, collapsed, false, normRng).each(function (pos) {\n          normRng.setEnd(pos.container(), pos.offset());\n        });\n      }\n      if (collapsed) {\n        normRng.collapse(true);\n      }\n      return isEq$1(rng, normRng) ? Optional.none() : Optional.some(normRng);\n    };\n\n    var splitText = function (node, offset) {\n      return node.splitText(offset);\n    };\n    var split$1 = function (rng) {\n      var startContainer = rng.startContainer, startOffset = rng.startOffset, endContainer = rng.endContainer, endOffset = rng.endOffset;\n      if (startContainer === endContainer && isText$1(startContainer)) {\n        if (startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n          endContainer = splitText(startContainer, startOffset);\n          startContainer = endContainer.previousSibling;\n          if (endOffset > startOffset) {\n            endOffset = endOffset - startOffset;\n            startContainer = endContainer = splitText(endContainer, endOffset).previousSibling;\n            endOffset = endContainer.nodeValue.length;\n            startOffset = 0;\n          } else {\n            endOffset = 0;\n          }\n        }\n      } else {\n        if (isText$1(startContainer) && startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n          startContainer = splitText(startContainer, startOffset);\n          startOffset = 0;\n        }\n        if (isText$1(endContainer) && endOffset > 0 && endOffset < endContainer.nodeValue.length) {\n          endContainer = splitText(endContainer, endOffset).previousSibling;\n          endOffset = endContainer.nodeValue.length;\n        }\n      }\n      return {\n        startContainer: startContainer,\n        startOffset: startOffset,\n        endContainer: endContainer,\n        endOffset: endOffset\n      };\n    };\n\n    function RangeUtils(dom) {\n      var walk = function (rng, callback) {\n        return walk$1(dom, rng, callback);\n      };\n      var split = split$1;\n      var normalize$1 = function (rng) {\n        return normalize(dom, rng).fold(never, function (normalizedRng) {\n          rng.setStart(normalizedRng.startContainer, normalizedRng.startOffset);\n          rng.setEnd(normalizedRng.endContainer, normalizedRng.endOffset);\n          return true;\n        });\n      };\n      return {\n        walk: walk,\n        split: split,\n        normalize: normalize$1\n      };\n    }\n    (function (RangeUtils) {\n      RangeUtils.compareRanges = isEq$1;\n      RangeUtils.getCaretRangeFromPoint = fromPoint$1;\n      RangeUtils.getSelectedNode = getSelectedNode;\n      RangeUtils.getNode = getNode;\n    }(RangeUtils || (RangeUtils = {})));\n    var RangeUtils$1 = RangeUtils;\n\n    function Dimension (name, getOffset) {\n      var set = function (element, h) {\n        if (!isNumber(h) && !h.match(/^[0-9]+$/)) {\n          throw new Error(name + '.set accepts only positive integer values. Value was ' + h);\n        }\n        var dom = element.dom;\n        if (isSupported$1(dom)) {\n          dom.style[name] = h + 'px';\n        }\n      };\n      var get = function (element) {\n        var r = getOffset(element);\n        if (r <= 0 || r === null) {\n          var css = get$5(element, name);\n          return parseFloat(css) || 0;\n        }\n        return r;\n      };\n      var getOuter = get;\n      var aggregate = function (element, properties) {\n        return foldl(properties, function (acc, property) {\n          var val = get$5(element, property);\n          var value = val === undefined ? 0 : parseInt(val, 10);\n          return isNaN(value) ? acc : acc + value;\n        }, 0);\n      };\n      var max = function (element, value, properties) {\n        var cumulativeInclusions = aggregate(element, properties);\n        var absoluteMax = value > cumulativeInclusions ? value - cumulativeInclusions : 0;\n        return absoluteMax;\n      };\n      return {\n        set: set,\n        get: get,\n        getOuter: getOuter,\n        aggregate: aggregate,\n        max: max\n      };\n    }\n\n    var api$1 = Dimension('height', function (element) {\n      var dom = element.dom;\n      return inBody(element) ? dom.getBoundingClientRect().height : dom.offsetHeight;\n    });\n    var get$9 = function (element) {\n      return api$1.get(element);\n    };\n\n    var walkUp = function (navigation, doc) {\n      var frame = navigation.view(doc);\n      return frame.fold(constant([]), function (f) {\n        var parent = navigation.owner(f);\n        var rest = walkUp(navigation, parent);\n        return [f].concat(rest);\n      });\n    };\n    var pathTo = function (element, navigation) {\n      var d = navigation.owner(element);\n      return walkUp(navigation, d);\n    };\n\n    var view = function (doc) {\n      var _a;\n      var element = doc.dom === document ? Optional.none() : Optional.from((_a = doc.dom.defaultView) === null || _a === void 0 ? void 0 : _a.frameElement);\n      return element.map(SugarElement.fromDom);\n    };\n    var owner$1 = function (element) {\n      return documentOrOwner(element);\n    };\n\n    var Navigation = /*#__PURE__*/Object.freeze({\n        __proto__: null,\n        view: view,\n        owner: owner$1\n    });\n\n    var find$2 = function (element) {\n      var doc = SugarElement.fromDom(document);\n      var scroll = get$2(doc);\n      var frames = pathTo(element, Navigation);\n      var offset = viewport(element);\n      var r = foldr(frames, function (b, a) {\n        var loc = viewport(a);\n        return {\n          left: b.left + loc.left,\n          top: b.top + loc.top\n        };\n      }, {\n        left: 0,\n        top: 0\n      });\n      return SugarPosition(r.left + offset.left + scroll.left, r.top + offset.top + scroll.top);\n    };\n\n    var excludeFromDescend = function (element) {\n      return name(element) === 'textarea';\n    };\n    var fireScrollIntoViewEvent = function (editor, data) {\n      var scrollEvent = editor.fire('ScrollIntoView', data);\n      return scrollEvent.isDefaultPrevented();\n    };\n    var fireAfterScrollIntoViewEvent = function (editor, data) {\n      editor.fire('AfterScrollIntoView', data);\n    };\n    var descend = function (element, offset) {\n      var children$1 = children(element);\n      if (children$1.length === 0 || excludeFromDescend(element)) {\n        return {\n          element: element,\n          offset: offset\n        };\n      } else if (offset < children$1.length && !excludeFromDescend(children$1[offset])) {\n        return {\n          element: children$1[offset],\n          offset: 0\n        };\n      } else {\n        var last = children$1[children$1.length - 1];\n        if (excludeFromDescend(last)) {\n          return {\n            element: element,\n            offset: offset\n          };\n        } else {\n          if (name(last) === 'img') {\n            return {\n              element: last,\n              offset: 1\n            };\n          } else if (isText(last)) {\n            return {\n              element: last,\n              offset: get$8(last).length\n            };\n          } else {\n            return {\n              element: last,\n              offset: children(last).length\n            };\n          }\n        }\n      }\n    };\n    var markerInfo = function (element, cleanupFun) {\n      var pos = absolute(element);\n      var height = get$9(element);\n      return {\n        element: element,\n        bottom: pos.top + height,\n        height: height,\n        pos: pos,\n        cleanup: cleanupFun\n      };\n    };\n    var createMarker = function (element, offset) {\n      var startPoint = descend(element, offset);\n      var span = SugarElement.fromHtml('<span data-mce-bogus=\"all\">' + ZWSP + '</span>');\n      before(startPoint.element, span);\n      return markerInfo(span, function () {\n        return remove(span);\n      });\n    };\n    var elementMarker = function (element) {\n      return markerInfo(SugarElement.fromDom(element), noop);\n    };\n    var withMarker = function (editor, f, rng, alignToTop) {\n      preserveWith(editor, function (_s, _e) {\n        return applyWithMarker(editor, f, rng, alignToTop);\n      }, rng);\n    };\n    var withScrollEvents = function (editor, doc, f, marker, alignToTop) {\n      var data = {\n        elm: marker.element.dom,\n        alignToTop: alignToTop\n      };\n      if (fireScrollIntoViewEvent(editor, data)) {\n        return;\n      }\n      var scrollTop = get$2(doc).top;\n      f(doc, scrollTop, marker, alignToTop);\n      fireAfterScrollIntoViewEvent(editor, data);\n    };\n    var applyWithMarker = function (editor, f, rng, alignToTop) {\n      var body = SugarElement.fromDom(editor.getBody());\n      var doc = SugarElement.fromDom(editor.getDoc());\n      reflow(body);\n      var marker = createMarker(SugarElement.fromDom(rng.startContainer), rng.startOffset);\n      withScrollEvents(editor, doc, f, marker, alignToTop);\n      marker.cleanup();\n    };\n    var withElement = function (editor, element, f, alignToTop) {\n      var doc = SugarElement.fromDom(editor.getDoc());\n      withScrollEvents(editor, doc, f, elementMarker(element), alignToTop);\n    };\n    var preserveWith = function (editor, f, rng) {\n      var startElement = rng.startContainer;\n      var startOffset = rng.startOffset;\n      var endElement = rng.endContainer;\n      var endOffset = rng.endOffset;\n      f(SugarElement.fromDom(startElement), SugarElement.fromDom(endElement));\n      var newRng = editor.dom.createRng();\n      newRng.setStart(startElement, startOffset);\n      newRng.setEnd(endElement, endOffset);\n      editor.selection.setRng(rng);\n    };\n    var scrollToMarker = function (marker, viewHeight, alignToTop, doc) {\n      var pos = marker.pos;\n      if (alignToTop) {\n        to(pos.left, pos.top, doc);\n      } else {\n        var y = pos.top - viewHeight + marker.height;\n        to(pos.left, y, doc);\n      }\n    };\n    var intoWindowIfNeeded = function (doc, scrollTop, viewHeight, marker, alignToTop) {\n      var viewportBottom = viewHeight + scrollTop;\n      var markerTop = marker.pos.top;\n      var markerBottom = marker.bottom;\n      var largerThanViewport = markerBottom - markerTop >= viewHeight;\n      if (markerTop < scrollTop) {\n        scrollToMarker(marker, viewHeight, alignToTop !== false, doc);\n      } else if (markerTop > viewportBottom) {\n        var align = largerThanViewport ? alignToTop !== false : alignToTop === true;\n        scrollToMarker(marker, viewHeight, align, doc);\n      } else if (markerBottom > viewportBottom && !largerThanViewport) {\n        scrollToMarker(marker, viewHeight, alignToTop === true, doc);\n      }\n    };\n    var intoWindow = function (doc, scrollTop, marker, alignToTop) {\n      var viewHeight = doc.dom.defaultView.innerHeight;\n      intoWindowIfNeeded(doc, scrollTop, viewHeight, marker, alignToTop);\n    };\n    var intoFrame = function (doc, scrollTop, marker, alignToTop) {\n      var frameViewHeight = doc.dom.defaultView.innerHeight;\n      intoWindowIfNeeded(doc, scrollTop, frameViewHeight, marker, alignToTop);\n      var op = find$2(marker.element);\n      var viewportBounds = getBounds(window);\n      if (op.top < viewportBounds.y) {\n        intoView(marker.element, alignToTop !== false);\n      } else if (op.top > viewportBounds.bottom) {\n        intoView(marker.element, alignToTop === true);\n      }\n    };\n    var rangeIntoWindow = function (editor, rng, alignToTop) {\n      return withMarker(editor, intoWindow, rng, alignToTop);\n    };\n    var elementIntoWindow = function (editor, element, alignToTop) {\n      return withElement(editor, element, intoWindow, alignToTop);\n    };\n    var rangeIntoFrame = function (editor, rng, alignToTop) {\n      return withMarker(editor, intoFrame, rng, alignToTop);\n    };\n    var elementIntoFrame = function (editor, element, alignToTop) {\n      return withElement(editor, element, intoFrame, alignToTop);\n    };\n    var scrollElementIntoView = function (editor, element, alignToTop) {\n      var scroller = editor.inline ? elementIntoWindow : elementIntoFrame;\n      scroller(editor, element, alignToTop);\n    };\n    var scrollRangeIntoView = function (editor, rng, alignToTop) {\n      var scroller = editor.inline ? rangeIntoWindow : rangeIntoFrame;\n      scroller(editor, rng, alignToTop);\n    };\n\n    var getDocument = function () {\n      return SugarElement.fromDom(document);\n    };\n\n    var focus = function (element) {\n      return element.dom.focus();\n    };\n    var hasFocus = function (element) {\n      var root = getRootNode(element).dom;\n      return element.dom === root.activeElement;\n    };\n    var active = function (root) {\n      if (root === void 0) {\n        root = getDocument();\n      }\n      return Optional.from(root.dom.activeElement).map(SugarElement.fromDom);\n    };\n    var search = function (element) {\n      return active(getRootNode(element)).filter(function (e) {\n        return element.dom.contains(e.dom);\n      });\n    };\n\n    var create$4 = function (start, soffset, finish, foffset) {\n      return {\n        start: start,\n        soffset: soffset,\n        finish: finish,\n        foffset: foffset\n      };\n    };\n    var SimRange = { create: create$4 };\n\n    var adt = Adt.generate([\n      { before: ['element'] },\n      {\n        on: [\n          'element',\n          'offset'\n        ]\n      },\n      { after: ['element'] }\n    ]);\n    var cata = function (subject, onBefore, onOn, onAfter) {\n      return subject.fold(onBefore, onOn, onAfter);\n    };\n    var getStart = function (situ) {\n      return situ.fold(identity, identity, identity);\n    };\n    var before$3 = adt.before;\n    var on = adt.on;\n    var after$2 = adt.after;\n    var Situ = {\n      before: before$3,\n      on: on,\n      after: after$2,\n      cata: cata,\n      getStart: getStart\n    };\n\n    var adt$1 = Adt.generate([\n      { domRange: ['rng'] },\n      {\n        relative: [\n          'startSitu',\n          'finishSitu'\n        ]\n      },\n      {\n        exact: [\n          'start',\n          'soffset',\n          'finish',\n          'foffset'\n        ]\n      }\n    ]);\n    var exactFromRange = function (simRange) {\n      return adt$1.exact(simRange.start, simRange.soffset, simRange.finish, simRange.foffset);\n    };\n    var getStart$1 = function (selection) {\n      return selection.match({\n        domRange: function (rng) {\n          return SugarElement.fromDom(rng.startContainer);\n        },\n        relative: function (startSitu, _finishSitu) {\n          return Situ.getStart(startSitu);\n        },\n        exact: function (start, _soffset, _finish, _foffset) {\n          return start;\n        }\n      });\n    };\n    var domRange = adt$1.domRange;\n    var relative = adt$1.relative;\n    var exact = adt$1.exact;\n    var getWin = function (selection) {\n      var start = getStart$1(selection);\n      return defaultView(start);\n    };\n    var range = SimRange.create;\n    var SimSelection = {\n      domRange: domRange,\n      relative: relative,\n      exact: exact,\n      exactFromRange: exactFromRange,\n      getWin: getWin,\n      range: range\n    };\n\n    var browser$3 = detect$3().browser;\n    var clamp = function (offset, element) {\n      var max = isText(element) ? get$8(element).length : children(element).length + 1;\n      if (offset > max) {\n        return max;\n      } else if (offset < 0) {\n        return 0;\n      }\n      return offset;\n    };\n    var normalizeRng = function (rng) {\n      return SimSelection.range(rng.start, clamp(rng.soffset, rng.start), rng.finish, clamp(rng.foffset, rng.finish));\n    };\n    var isOrContains = function (root, elm) {\n      return !isRestrictedNode(elm.dom) && (contains$2(root, elm) || eq$2(root, elm));\n    };\n    var isRngInRoot = function (root) {\n      return function (rng) {\n        return isOrContains(root, rng.start) && isOrContains(root, rng.finish);\n      };\n    };\n    var shouldStore = function (editor) {\n      return editor.inline === true || browser$3.isIE();\n    };\n    var nativeRangeToSelectionRange = function (r) {\n      return SimSelection.range(SugarElement.fromDom(r.startContainer), r.startOffset, SugarElement.fromDom(r.endContainer), r.endOffset);\n    };\n    var readRange = function (win) {\n      var selection = win.getSelection();\n      var rng = !selection || selection.rangeCount === 0 ? Optional.none() : Optional.from(selection.getRangeAt(0));\n      return rng.map(nativeRangeToSelectionRange);\n    };\n    var getBookmark$2 = function (root) {\n      var win = defaultView(root);\n      return readRange(win.dom).filter(isRngInRoot(root));\n    };\n    var validate = function (root, bookmark) {\n      return Optional.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng);\n    };\n    var bookmarkToNativeRng = function (bookmark) {\n      var rng = document.createRange();\n      try {\n        rng.setStart(bookmark.start.dom, bookmark.soffset);\n        rng.setEnd(bookmark.finish.dom, bookmark.foffset);\n        return Optional.some(rng);\n      } catch (_) {\n        return Optional.none();\n      }\n    };\n    var store = function (editor) {\n      var newBookmark = shouldStore(editor) ? getBookmark$2(SugarElement.fromDom(editor.getBody())) : Optional.none();\n      editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\n    };\n    var storeNative = function (editor, rng) {\n      var root = SugarElement.fromDom(editor.getBody());\n      var range = shouldStore(editor) ? Optional.from(rng) : Optional.none();\n      var newBookmark = range.map(nativeRangeToSelectionRange).filter(isRngInRoot(root));\n      editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\n    };\n    var getRng = function (editor) {\n      var bookmark = editor.bookmark ? editor.bookmark : Optional.none();\n      return bookmark.bind(function (x) {\n        return validate(SugarElement.fromDom(editor.getBody()), x);\n      }).bind(bookmarkToNativeRng);\n    };\n    var restore = function (editor) {\n      getRng(editor).each(function (rng) {\n        return editor.selection.setRng(rng);\n      });\n    };\n\n    var isEditorUIElement = function (elm) {\n      var className = elm.className.toString();\n      return className.indexOf('tox-') !== -1 || className.indexOf('mce-') !== -1;\n    };\n    var FocusManager = { isEditorUIElement: isEditorUIElement };\n\n    var isManualNodeChange = function (e) {\n      return e.type === 'nodechange' && e.selectionChange;\n    };\n    var registerPageMouseUp = function (editor, throttledStore) {\n      var mouseUpPage = function () {\n        throttledStore.throttle();\n      };\n      DOMUtils$1.DOM.bind(document, 'mouseup', mouseUpPage);\n      editor.on('remove', function () {\n        DOMUtils$1.DOM.unbind(document, 'mouseup', mouseUpPage);\n      });\n    };\n    var registerFocusOut = function (editor) {\n      editor.on('focusout', function () {\n        store(editor);\n      });\n    };\n    var registerMouseUp = function (editor, throttledStore) {\n      editor.on('mouseup touchend', function (_e) {\n        throttledStore.throttle();\n      });\n    };\n    var registerEditorEvents = function (editor, throttledStore) {\n      var browser = detect$3().browser;\n      if (browser.isIE()) {\n        registerFocusOut(editor);\n      } else {\n        registerMouseUp(editor, throttledStore);\n      }\n      editor.on('keyup NodeChange', function (e) {\n        if (!isManualNodeChange(e)) {\n          store(editor);\n        }\n      });\n    };\n    var register = function (editor) {\n      var throttledStore = first(function () {\n        store(editor);\n      }, 0);\n      editor.on('init', function () {\n        if (editor.inline) {\n          registerPageMouseUp(editor, throttledStore);\n        }\n        registerEditorEvents(editor, throttledStore);\n      });\n      editor.on('remove', function () {\n        throttledStore.cancel();\n      });\n    };\n\n    var documentFocusInHandler;\n    var DOM$2 = DOMUtils$1.DOM;\n    var isEditorUIElement$1 = function (elm) {\n      return FocusManager.isEditorUIElement(elm);\n    };\n    var isEditorContentAreaElement = function (elm) {\n      var classList = elm.classList;\n      if (classList !== undefined) {\n        return classList.contains('tox-edit-area') || classList.contains('tox-edit-area__iframe') || classList.contains('mce-content-body');\n      } else {\n        return false;\n      }\n    };\n    var isUIElement = function (editor, elm) {\n      var customSelector = getCustomUiSelector(editor);\n      var parent = DOM$2.getParent(elm, function (elm) {\n        return isEditorUIElement$1(elm) || (customSelector ? editor.dom.is(elm, customSelector) : false);\n      });\n      return parent !== null;\n    };\n    var getActiveElement = function (editor) {\n      try {\n        var root = getRootNode(SugarElement.fromDom(editor.getElement()));\n        return active(root).fold(function () {\n          return document.body;\n        }, function (x) {\n          return x.dom;\n        });\n      } catch (ex) {\n        return document.body;\n      }\n    };\n    var registerEvents = function (editorManager, e) {\n      var editor = e.editor;\n      register(editor);\n      editor.on('focusin', function () {\n        var self = this;\n        var focusedEditor = editorManager.focusedEditor;\n        if (focusedEditor !== self) {\n          if (focusedEditor) {\n            focusedEditor.fire('blur', { focusedEditor: self });\n          }\n          editorManager.setActive(self);\n          editorManager.focusedEditor = self;\n          self.fire('focus', { blurredEditor: focusedEditor });\n          self.focus(true);\n        }\n      });\n      editor.on('focusout', function () {\n        var self = this;\n        Delay.setEditorTimeout(self, function () {\n          var focusedEditor = editorManager.focusedEditor;\n          if (!isUIElement(self, getActiveElement(self)) && focusedEditor === self) {\n            self.fire('blur', { focusedEditor: null });\n            editorManager.focusedEditor = null;\n          }\n        });\n      });\n      if (!documentFocusInHandler) {\n        documentFocusInHandler = function (e) {\n          var activeEditor = editorManager.activeEditor;\n          if (activeEditor) {\n            getOriginalEventTarget(e).each(function (target) {\n              if (target.ownerDocument === document) {\n                if (target !== document.body && !isUIElement(activeEditor, target) && editorManager.focusedEditor === activeEditor) {\n                  activeEditor.fire('blur', { focusedEditor: null });\n                  editorManager.focusedEditor = null;\n                }\n              }\n            });\n          }\n        };\n        DOM$2.bind(document, 'focusin', documentFocusInHandler);\n      }\n    };\n    var unregisterDocumentEvents = function (editorManager, e) {\n      if (editorManager.focusedEditor === e.editor) {\n        editorManager.focusedEditor = null;\n      }\n      if (!editorManager.activeEditor) {\n        DOM$2.unbind(document, 'focusin', documentFocusInHandler);\n        documentFocusInHandler = null;\n      }\n    };\n    var setup$2 = function (editorManager) {\n      editorManager.on('AddEditor', curry(registerEvents, editorManager));\n      editorManager.on('RemoveEditor', curry(unregisterDocumentEvents, editorManager));\n    };\n\n    var getContentEditableHost = function (editor, node) {\n      return editor.dom.getParent(node, function (node) {\n        return editor.dom.getContentEditable(node) === 'true';\n      });\n    };\n    var getCollapsedNode = function (rng) {\n      return rng.collapsed ? Optional.from(getNode(rng.startContainer, rng.startOffset)).map(SugarElement.fromDom) : Optional.none();\n    };\n    var getFocusInElement = function (root, rng) {\n      return getCollapsedNode(rng).bind(function (node) {\n        if (isTableSection(node)) {\n          return Optional.some(node);\n        } else if (contains$2(root, node) === false) {\n          return Optional.some(root);\n        } else {\n          return Optional.none();\n        }\n      });\n    };\n    var normalizeSelection = function (editor, rng) {\n      getFocusInElement(SugarElement.fromDom(editor.getBody()), rng).bind(function (elm) {\n        return firstPositionIn(elm.dom);\n      }).fold(function () {\n        editor.selection.normalize();\n        return;\n      }, function (caretPos) {\n        return editor.selection.setRng(caretPos.toRange());\n      });\n    };\n    var focusBody = function (body) {\n      if (body.setActive) {\n        try {\n          body.setActive();\n        } catch (ex) {\n          body.focus();\n        }\n      } else {\n        body.focus();\n      }\n    };\n    var hasElementFocus = function (elm) {\n      return hasFocus(elm) || search(elm).isSome();\n    };\n    var hasIframeFocus = function (editor) {\n      return editor.iframeElement && hasFocus(SugarElement.fromDom(editor.iframeElement));\n    };\n    var hasInlineFocus = function (editor) {\n      var rawBody = editor.getBody();\n      return rawBody && hasElementFocus(SugarElement.fromDom(rawBody));\n    };\n    var hasUiFocus = function (editor) {\n      return active().filter(function (elem) {\n        return !isEditorContentAreaElement(elem.dom) && isUIElement(editor, elem.dom);\n      }).isSome();\n    };\n    var hasFocus$1 = function (editor) {\n      return editor.inline ? hasInlineFocus(editor) : hasIframeFocus(editor);\n    };\n    var hasEditorOrUiFocus = function (editor) {\n      return hasFocus$1(editor) || hasUiFocus(editor);\n    };\n    var focusEditor = function (editor) {\n      var selection = editor.selection;\n      var body = editor.getBody();\n      var rng = selection.getRng();\n      editor.quirks.refreshContentEditable();\n      if (editor.bookmark !== undefined && hasFocus$1(editor) === false) {\n        getRng(editor).each(function (bookmarkRng) {\n          editor.selection.setRng(bookmarkRng);\n          rng = bookmarkRng;\n        });\n      }\n      var contentEditableHost = getContentEditableHost(editor, selection.getNode());\n      if (editor.$.contains(body, contentEditableHost)) {\n        focusBody(contentEditableHost);\n        normalizeSelection(editor, rng);\n        activateEditor(editor);\n        return;\n      }\n      if (!editor.inline) {\n        if (!Env.opera) {\n          focusBody(body);\n        }\n        editor.getWin().focus();\n      }\n      if (Env.gecko || editor.inline) {\n        focusBody(body);\n        normalizeSelection(editor, rng);\n      }\n      activateEditor(editor);\n    };\n    var activateEditor = function (editor) {\n      return editor.editorManager.setActive(editor);\n    };\n    var focus$1 = function (editor, skipFocus) {\n      if (editor.removed) {\n        return;\n      }\n      skipFocus ? activateEditor(editor) : focusEditor(editor);\n    };\n\n    var getEndpointElement = function (root, rng, start, real, resolve) {\n      var container = start ? rng.startContainer : rng.endContainer;\n      var offset = start ? rng.startOffset : rng.endOffset;\n      return Optional.from(container).map(SugarElement.fromDom).map(function (elm) {\n        return !real || !rng.collapsed ? child(elm, resolve(elm, offset)).getOr(elm) : elm;\n      }).bind(function (elm) {\n        return isElement(elm) ? Optional.some(elm) : parent(elm).filter(isElement);\n      }).map(function (elm) {\n        return elm.dom;\n      }).getOr(root);\n    };\n    var getStart$2 = function (root, rng, real) {\n      return getEndpointElement(root, rng, true, real, function (elm, offset) {\n        return Math.min(childNodesCount(elm), offset);\n      });\n    };\n    var getEnd = function (root, rng, real) {\n      return getEndpointElement(root, rng, false, real, function (elm, offset) {\n        return offset > 0 ? offset - 1 : offset;\n      });\n    };\n    var skipEmptyTextNodes = function (node, forwards) {\n      var orig = node;\n      while (node && isText$1(node) && node.length === 0) {\n        node = forwards ? node.nextSibling : node.previousSibling;\n      }\n      return node || orig;\n    };\n    var getNode$1 = function (root, rng) {\n      var elm, startContainer, endContainer;\n      if (!rng) {\n        return root;\n      }\n      startContainer = rng.startContainer;\n      endContainer = rng.endContainer;\n      var startOffset = rng.startOffset;\n      var endOffset = rng.endOffset;\n      elm = rng.commonAncestorContainer;\n      if (!rng.collapsed) {\n        if (startContainer === endContainer) {\n          if (endOffset - startOffset < 2) {\n            if (startContainer.hasChildNodes()) {\n              elm = startContainer.childNodes[startOffset];\n            }\n          }\n        }\n        if (startContainer.nodeType === 3 && endContainer.nodeType === 3) {\n          if (startContainer.length === startOffset) {\n            startContainer = skipEmptyTextNodes(startContainer.nextSibling, true);\n          } else {\n            startContainer = startContainer.parentNode;\n          }\n          if (endOffset === 0) {\n            endContainer = skipEmptyTextNodes(endContainer.previousSibling, false);\n          } else {\n            endContainer = endContainer.parentNode;\n          }\n          if (startContainer && startContainer === endContainer) {\n            return startContainer;\n          }\n        }\n      }\n      if (elm && elm.nodeType === 3) {\n        return elm.parentNode;\n      }\n      return elm;\n    };\n    var getSelectedBlocks = function (dom, rng, startElm, endElm) {\n      var node;\n      var selectedBlocks = [];\n      var root = dom.getRoot();\n      startElm = dom.getParent(startElm || getStart$2(root, rng, rng.collapsed), dom.isBlock);\n      endElm = dom.getParent(endElm || getEnd(root, rng, rng.collapsed), dom.isBlock);\n      if (startElm && startElm !== root) {\n        selectedBlocks.push(startElm);\n      }\n      if (startElm && endElm && startElm !== endElm) {\n        node = startElm;\n        var walker = new DomTreeWalker(startElm, root);\n        while ((node = walker.next()) && node !== endElm) {\n          if (dom.isBlock(node)) {\n            selectedBlocks.push(node);\n          }\n        }\n      }\n      if (endElm && startElm !== endElm && endElm !== root) {\n        selectedBlocks.push(endElm);\n      }\n      return selectedBlocks;\n    };\n    var select$1 = function (dom, node, content) {\n      return Optional.from(node).map(function (node) {\n        var idx = dom.nodeIndex(node);\n        var rng = dom.createRng();\n        rng.setStart(node.parentNode, idx);\n        rng.setEnd(node.parentNode, idx + 1);\n        if (content) {\n          moveEndPoint$1(dom, rng, node, true);\n          moveEndPoint$1(dom, rng, node, false);\n        }\n        return rng;\n      });\n    };\n\n    var processRanges = function (editor, ranges) {\n      return map(ranges, function (range) {\n        var evt = editor.fire('GetSelectionRange', { range: range });\n        return evt.range !== range ? evt.range : range;\n      });\n    };\n\n    var ensureIsRoot = function (isRoot) {\n      return isFunction(isRoot) ? isRoot : never;\n    };\n    var ancestor$3 = function (scope, transform, isRoot) {\n      var element = scope.dom;\n      var stop = ensureIsRoot(isRoot);\n      while (element.parentNode) {\n        element = element.parentNode;\n        var el = SugarElement.fromDom(element);\n        var transformed = transform(el);\n        if (transformed.isSome()) {\n          return transformed;\n        } else if (stop(el)) {\n          break;\n        }\n      }\n      return Optional.none();\n    };\n    var closest$2 = function (scope, transform, isRoot) {\n      var current = transform(scope);\n      var stop = ensureIsRoot(isRoot);\n      return current.orThunk(function () {\n        return stop(scope) ? Optional.none() : ancestor$3(scope, transform, stop);\n      });\n    };\n\n    var isEq$2 = isEq;\n    var matchesUnInheritedFormatSelector = function (ed, node, name) {\n      var formatList = ed.formatter.get(name);\n      if (formatList) {\n        for (var i = 0; i < formatList.length; i++) {\n          if (formatList[i].inherit === false && ed.dom.is(node, formatList[i].selector)) {\n            return true;\n          }\n        }\n      }\n      return false;\n    };\n    var matchParents = function (editor, node, name, vars) {\n      var root = editor.dom.getRoot();\n      if (node === root) {\n        return false;\n      }\n      node = editor.dom.getParent(node, function (node) {\n        if (matchesUnInheritedFormatSelector(editor, node, name)) {\n          return true;\n        }\n        return node.parentNode === root || !!matchNode(editor, node, name, vars, true);\n      });\n      return matchNode(editor, node, name, vars);\n    };\n    var matchName = function (dom, node, format) {\n      if (isEq$2(node, format.inline)) {\n        return true;\n      }\n      if (isEq$2(node, format.block)) {\n        return true;\n      }\n      if (format.selector) {\n        return node.nodeType === 1 && dom.is(node, format.selector);\n      }\n    };\n    var matchItems = function (dom, node, format, itemName, similar, vars) {\n      var key, value;\n      var items = format[itemName];\n      var i;\n      if (format.onmatch) {\n        return format.onmatch(node, format, itemName);\n      }\n      if (items) {\n        if (typeof items.length === 'undefined') {\n          for (key in items) {\n            if (items.hasOwnProperty(key)) {\n              if (itemName === 'attributes') {\n                value = dom.getAttrib(node, key);\n              } else {\n                value = getStyle(dom, node, key);\n              }\n              if (similar && !value && !format.exact) {\n                return;\n              }\n              if ((!similar || format.exact) && !isEq$2(value, normalizeStyleValue(dom, replaceVars(items[key], vars), key))) {\n                return;\n              }\n            }\n          }\n        } else {\n          for (i = 0; i < items.length; i++) {\n            if (itemName === 'attributes' ? dom.getAttrib(node, items[i]) : getStyle(dom, node, items[i])) {\n              return format;\n            }\n          }\n        }\n      }\n      return format;\n    };\n    var matchNode = function (ed, node, name, vars, similar) {\n      var formatList = ed.formatter.get(name);\n      var format, i, x, classes;\n      var dom = ed.dom;\n      if (formatList && node) {\n        for (i = 0; i < formatList.length; i++) {\n          format = formatList[i];\n          if (matchName(ed.dom, node, format) && matchItems(dom, node, format, 'attributes', similar, vars) && matchItems(dom, node, format, 'styles', similar, vars)) {\n            if (classes = format.classes) {\n              for (x = 0; x < classes.length; x++) {\n                if (!ed.dom.hasClass(node, classes[x])) {\n                  return;\n                }\n              }\n            }\n            return format;\n          }\n        }\n      }\n    };\n    var match = function (editor, name, vars, node) {\n      if (node) {\n        return matchParents(editor, node, name, vars);\n      }\n      node = editor.selection.getNode();\n      if (matchParents(editor, node, name, vars)) {\n        return true;\n      }\n      var startNode = editor.selection.getStart();\n      if (startNode !== node) {\n        if (matchParents(editor, startNode, name, vars)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var matchAll = function (editor, names, vars) {\n      var matchedFormatNames = [];\n      var checkedMap = {};\n      var startElement = editor.selection.getStart();\n      editor.dom.getParent(startElement, function (node) {\n        for (var i = 0; i < names.length; i++) {\n          var name_1 = names[i];\n          if (!checkedMap[name_1] && matchNode(editor, node, name_1, vars)) {\n            checkedMap[name_1] = true;\n            matchedFormatNames.push(name_1);\n          }\n        }\n      }, editor.dom.getRoot());\n      return matchedFormatNames;\n    };\n    var closest$3 = function (editor, names) {\n      var isRoot = function (elm) {\n        return eq$2(elm, SugarElement.fromDom(editor.getBody()));\n      };\n      var match = function (elm, name) {\n        return matchNode(editor, elm.dom, name) ? Optional.some(name) : Optional.none();\n      };\n      return Optional.from(editor.selection.getStart(true)).bind(function (rawElm) {\n        return closest$2(SugarElement.fromDom(rawElm), function (elm) {\n          return findMap(names, function (name) {\n            return match(elm, name);\n          });\n        }, isRoot);\n      }).getOrNull();\n    };\n    var canApply = function (editor, name) {\n      var formatList = editor.formatter.get(name);\n      var startNode, parents, i, x, selector;\n      var dom = editor.dom;\n      if (formatList) {\n        startNode = editor.selection.getStart();\n        parents = getParents$1(dom, startNode);\n        for (x = formatList.length - 1; x >= 0; x--) {\n          selector = formatList[x].selector;\n          if (!selector || formatList[x].defaultBlock) {\n            return true;\n          }\n          for (i = parents.length - 1; i >= 0; i--) {\n            if (dom.is(parents[i], selector)) {\n              return true;\n            }\n          }\n        }\n      }\n      return false;\n    };\n    var matchAllOnNode = function (editor, node, formatNames) {\n      return foldl(formatNames, function (acc, name) {\n        var matchSimilar = isVariableFormatName(editor, name);\n        if (editor.formatter.matchNode(node, name, {}, matchSimilar)) {\n          return acc.concat([name]);\n        } else {\n          return acc;\n        }\n      }, []);\n    };\n\n    var typeLookup = {\n      '#text': 3,\n      '#comment': 8,\n      '#cdata': 4,\n      '#pi': 7,\n      '#doctype': 10,\n      '#document-fragment': 11\n    };\n    var walk$2 = function (node, root, prev) {\n      var startName = prev ? 'lastChild' : 'firstChild';\n      var siblingName = prev ? 'prev' : 'next';\n      if (node[startName]) {\n        return node[startName];\n      }\n      if (node !== root) {\n        var sibling = node[siblingName];\n        if (sibling) {\n          return sibling;\n        }\n        for (var parent_1 = node.parent; parent_1 && parent_1 !== root; parent_1 = parent_1.parent) {\n          sibling = parent_1[siblingName];\n          if (sibling) {\n            return sibling;\n          }\n        }\n      }\n    };\n    var isEmptyTextNode$1 = function (node) {\n      if (!isWhitespaceText(node.value)) {\n        return false;\n      }\n      var parentNode = node.parent;\n      if (parentNode && (parentNode.name !== 'span' || parentNode.attr('style')) && /^[ ]+$/.test(node.value)) {\n        return false;\n      }\n      return true;\n    };\n    var isNonEmptyElement = function (node) {\n      var isNamedAnchor = node.name === 'a' && !node.attr('href') && node.attr('id');\n      return node.attr('name') || node.attr('id') && !node.firstChild || node.attr('data-mce-bookmark') || isNamedAnchor;\n    };\n    var AstNode = function () {\n      function AstNode(name, type) {\n        this.name = name;\n        this.type = type;\n        if (type === 1) {\n          this.attributes = [];\n          this.attributes.map = {};\n        }\n      }\n      AstNode.create = function (name, attrs) {\n        var node = new AstNode(name, typeLookup[name] || 1);\n        if (attrs) {\n          each$1(attrs, function (value, attrName) {\n            node.attr(attrName, value);\n          });\n        }\n        return node;\n      };\n      AstNode.prototype.replace = function (node) {\n        var self = this;\n        if (node.parent) {\n          node.remove();\n        }\n        self.insert(node, self);\n        self.remove();\n        return self;\n      };\n      AstNode.prototype.attr = function (name, value) {\n        var self = this;\n        var attrs;\n        if (typeof name !== 'string') {\n          if (name !== undefined && name !== null) {\n            each$1(name, function (value, key) {\n              self.attr(key, value);\n            });\n          }\n          return self;\n        }\n        if (attrs = self.attributes) {\n          if (value !== undefined) {\n            if (value === null) {\n              if (name in attrs.map) {\n                delete attrs.map[name];\n                var i = attrs.length;\n                while (i--) {\n                  if (attrs[i].name === name) {\n                    attrs.splice(i, 1);\n                    return self;\n                  }\n                }\n              }\n              return self;\n            }\n            if (name in attrs.map) {\n              var i = attrs.length;\n              while (i--) {\n                if (attrs[i].name === name) {\n                  attrs[i].value = value;\n                  break;\n                }\n              }\n            } else {\n              attrs.push({\n                name: name,\n                value: value\n              });\n            }\n            attrs.map[name] = value;\n            return self;\n          }\n          return attrs.map[name];\n        }\n      };\n      AstNode.prototype.clone = function () {\n        var self = this;\n        var clone = new AstNode(self.name, self.type);\n        var selfAttrs;\n        if (selfAttrs = self.attributes) {\n          var cloneAttrs = [];\n          cloneAttrs.map = {};\n          for (var i = 0, l = selfAttrs.length; i < l; i++) {\n            var selfAttr = selfAttrs[i];\n            if (selfAttr.name !== 'id') {\n              cloneAttrs[cloneAttrs.length] = {\n                name: selfAttr.name,\n                value: selfAttr.value\n              };\n              cloneAttrs.map[selfAttr.name] = selfAttr.value;\n            }\n          }\n          clone.attributes = cloneAttrs;\n        }\n        clone.value = self.value;\n        clone.shortEnded = self.shortEnded;\n        return clone;\n      };\n      AstNode.prototype.wrap = function (wrapper) {\n        var self = this;\n        self.parent.insert(wrapper, self);\n        wrapper.append(self);\n        return self;\n      };\n      AstNode.prototype.unwrap = function () {\n        var self = this;\n        for (var node = self.firstChild; node;) {\n          var next = node.next;\n          self.insert(node, self, true);\n          node = next;\n        }\n        self.remove();\n      };\n      AstNode.prototype.remove = function () {\n        var self = this, parent = self.parent, next = self.next, prev = self.prev;\n        if (parent) {\n          if (parent.firstChild === self) {\n            parent.firstChild = next;\n            if (next) {\n              next.prev = null;\n            }\n          } else {\n            prev.next = next;\n          }\n          if (parent.lastChild === self) {\n            parent.lastChild = prev;\n            if (prev) {\n              prev.next = null;\n            }\n          } else {\n            next.prev = prev;\n          }\n          self.parent = self.next = self.prev = null;\n        }\n        return self;\n      };\n      AstNode.prototype.append = function (node) {\n        var self = this;\n        if (node.parent) {\n          node.remove();\n        }\n        var last = self.lastChild;\n        if (last) {\n          last.next = node;\n          node.prev = last;\n          self.lastChild = node;\n        } else {\n          self.lastChild = self.firstChild = node;\n        }\n        node.parent = self;\n        return node;\n      };\n      AstNode.prototype.insert = function (node, refNode, before) {\n        if (node.parent) {\n          node.remove();\n        }\n        var parent = refNode.parent || this;\n        if (before) {\n          if (refNode === parent.firstChild) {\n            parent.firstChild = node;\n          } else {\n            refNode.prev.next = node;\n          }\n          node.prev = refNode.prev;\n          node.next = refNode;\n          refNode.prev = node;\n        } else {\n          if (refNode === parent.lastChild) {\n            parent.lastChild = node;\n          } else {\n            refNode.next.prev = node;\n          }\n          node.next = refNode.next;\n          node.prev = refNode;\n          refNode.next = node;\n        }\n        node.parent = parent;\n        return node;\n      };\n      AstNode.prototype.getAll = function (name) {\n        var self = this;\n        var collection = [];\n        for (var node = self.firstChild; node; node = walk$2(node, self)) {\n          if (node.name === name) {\n            collection.push(node);\n          }\n        }\n        return collection;\n      };\n      AstNode.prototype.empty = function () {\n        var self = this;\n        if (self.firstChild) {\n          var nodes = [];\n          for (var node = self.firstChild; node; node = walk$2(node, self)) {\n            nodes.push(node);\n          }\n          var i = nodes.length;\n          while (i--) {\n            var node = nodes[i];\n            node.parent = node.firstChild = node.lastChild = node.next = node.prev = null;\n          }\n        }\n        self.firstChild = self.lastChild = null;\n        return self;\n      };\n      AstNode.prototype.isEmpty = function (elements, whitespace, predicate) {\n        if (whitespace === void 0) {\n          whitespace = {};\n        }\n        var self = this;\n        var node = self.firstChild;\n        if (isNonEmptyElement(self)) {\n          return false;\n        }\n        if (node) {\n          do {\n            if (node.type === 1) {\n              if (node.attr('data-mce-bogus')) {\n                continue;\n              }\n              if (elements[node.name]) {\n                return false;\n              }\n              if (isNonEmptyElement(node)) {\n                return false;\n              }\n            }\n            if (node.type === 8) {\n              return false;\n            }\n            if (node.type === 3 && !isEmptyTextNode$1(node)) {\n              return false;\n            }\n            if (node.type === 3 && node.parent && whitespace[node.parent.name] && isWhitespaceText(node.value)) {\n              return false;\n            }\n            if (predicate && predicate(node)) {\n              return false;\n            }\n          } while (node = walk$2(node, self));\n        }\n        return true;\n      };\n      AstNode.prototype.walk = function (prev) {\n        return walk$2(this, null, prev);\n      };\n      return AstNode;\n    }();\n\n    var makeMap$3 = Tools.makeMap;\n    var Writer = function (settings) {\n      var html = [];\n      settings = settings || {};\n      var indent = settings.indent;\n      var indentBefore = makeMap$3(settings.indent_before || '');\n      var indentAfter = makeMap$3(settings.indent_after || '');\n      var encode = Entities.getEncodeFunc(settings.entity_encoding || 'raw', settings.entities);\n      var htmlOutput = settings.element_format === 'html';\n      return {\n        start: function (name, attrs, empty) {\n          var i, l, attr, value;\n          if (indent && indentBefore[name] && html.length > 0) {\n            value = html[html.length - 1];\n            if (value.length > 0 && value !== '\\n') {\n              html.push('\\n');\n            }\n          }\n          html.push('<', name);\n          if (attrs) {\n            for (i = 0, l = attrs.length; i < l; i++) {\n              attr = attrs[i];\n              html.push(' ', attr.name, '=\"', encode(attr.value, true), '\"');\n            }\n          }\n          if (!empty || htmlOutput) {\n            html[html.length] = '>';\n          } else {\n            html[html.length] = ' />';\n          }\n          if (empty && indent && indentAfter[name] && html.length > 0) {\n            value = html[html.length - 1];\n            if (value.length > 0 && value !== '\\n') {\n              html.push('\\n');\n            }\n          }\n        },\n        end: function (name) {\n          var value;\n          html.push('</', name, '>');\n          if (indent && indentAfter[name] && html.length > 0) {\n            value = html[html.length - 1];\n            if (value.length > 0 && value !== '\\n') {\n              html.push('\\n');\n            }\n          }\n        },\n        text: function (text, raw) {\n          if (text.length > 0) {\n            html[html.length] = raw ? text : encode(text);\n          }\n        },\n        cdata: function (text) {\n          html.push('<![CDATA[', text, ']]>');\n        },\n        comment: function (text) {\n          html.push('<!--', text, '-->');\n        },\n        pi: function (name, text) {\n          if (text) {\n            html.push('<?', name, ' ', encode(text), '?>');\n          } else {\n            html.push('<?', name, '?>');\n          }\n          if (indent) {\n            html.push('\\n');\n          }\n        },\n        doctype: function (text) {\n          html.push('<!DOCTYPE', text, '>', indent ? '\\n' : '');\n        },\n        reset: function () {\n          html.length = 0;\n        },\n        getContent: function () {\n          return html.join('').replace(/\\n$/, '');\n        }\n      };\n    };\n\n    var HtmlSerializer = function (settings, schema) {\n      if (schema === void 0) {\n        schema = Schema();\n      }\n      var writer = Writer(settings);\n      settings = settings || {};\n      settings.validate = 'validate' in settings ? settings.validate : true;\n      var serialize = function (node) {\n        var validate = settings.validate;\n        var handlers = {\n          3: function (node) {\n            writer.text(node.value, node.raw);\n          },\n          8: function (node) {\n            writer.comment(node.value);\n          },\n          7: function (node) {\n            writer.pi(node.name, node.value);\n          },\n          10: function (node) {\n            writer.doctype(node.value);\n          },\n          4: function (node) {\n            writer.cdata(node.value);\n          },\n          11: function (node) {\n            if (node = node.firstChild) {\n              do {\n                walk(node);\n              } while (node = node.next);\n            }\n          }\n        };\n        writer.reset();\n        var walk = function (node) {\n          var handler = handlers[node.type];\n          var name, isEmpty, attrs, attrName, attrValue, sortedAttrs, i, l, elementRule;\n          if (!handler) {\n            name = node.name;\n            isEmpty = node.shortEnded;\n            attrs = node.attributes;\n            if (validate && attrs && attrs.length > 1) {\n              sortedAttrs = [];\n              sortedAttrs.map = {};\n              elementRule = schema.getElementRule(node.name);\n              if (elementRule) {\n                for (i = 0, l = elementRule.attributesOrder.length; i < l; i++) {\n                  attrName = elementRule.attributesOrder[i];\n                  if (attrName in attrs.map) {\n                    attrValue = attrs.map[attrName];\n                    sortedAttrs.map[attrName] = attrValue;\n                    sortedAttrs.push({\n                      name: attrName,\n                      value: attrValue\n                    });\n                  }\n                }\n                for (i = 0, l = attrs.length; i < l; i++) {\n                  attrName = attrs[i].name;\n                  if (!(attrName in sortedAttrs.map)) {\n                    attrValue = attrs.map[attrName];\n                    sortedAttrs.map[attrName] = attrValue;\n                    sortedAttrs.push({\n                      name: attrName,\n                      value: attrValue\n                    });\n                  }\n                }\n                attrs = sortedAttrs;\n              }\n            }\n            writer.start(node.name, attrs, isEmpty);\n            if (!isEmpty) {\n              if (node = node.firstChild) {\n                do {\n                  walk(node);\n                } while (node = node.next);\n              }\n              writer.end(name);\n            }\n          } else {\n            handler(node);\n          }\n        };\n        if (node.type === 1 && !settings.inner) {\n          walk(node);\n        } else {\n          handlers[11](node);\n        }\n        return writer.getContent();\n      };\n      return { serialize: serialize };\n    };\n\n    var extractBase64DataUris = function (html) {\n      var dataImageUri = /data:[^;]+;base64,([a-z0-9\\+\\/=]+)/gi;\n      var chunks = [];\n      var uris = {};\n      var prefix = generate$1('img');\n      var matches;\n      var index = 0;\n      var count = 0;\n      while (matches = dataImageUri.exec(html)) {\n        var uri = matches[0];\n        var imageId = prefix + '_' + count++;\n        uris[imageId] = uri;\n        if (index < matches.index) {\n          chunks.push(html.substr(index, matches.index - index));\n        }\n        chunks.push(imageId);\n        index = matches.index + uri.length;\n      }\n      if (index === 0) {\n        return {\n          prefix: prefix,\n          uris: uris,\n          html: html\n        };\n      } else {\n        if (index < html.length) {\n          chunks.push(html.substr(index));\n        }\n        return {\n          prefix: prefix,\n          uris: uris,\n          html: chunks.join('')\n        };\n      }\n    };\n    var restoreDataUris = function (html, result) {\n      return html.replace(new RegExp(result.prefix + '_[0-9]+', 'g'), function (imageId) {\n        return get$1(result.uris, imageId).getOr(imageId);\n      });\n    };\n    var parseDataUri = function (uri) {\n      var matches = /data:([^;]+);base64,([a-z0-9\\+\\/=]+)/i.exec(uri);\n      if (matches) {\n        return Optional.some({\n          type: matches[1],\n          data: decodeURIComponent(matches[2])\n        });\n      } else {\n        return Optional.none();\n      }\n    };\n\n    var safeSvgDataUrlElements = [\n      'img',\n      'video'\n    ];\n    var isValidPrefixAttrName = function (name) {\n      return name.indexOf('data-') === 0 || name.indexOf('aria-') === 0;\n    };\n    var blockSvgDataUris = function (allowSvgDataUrls, tagName) {\n      var allowed = isNullable(allowSvgDataUrls) ? contains(safeSvgDataUrlElements, tagName) : allowSvgDataUrls;\n      return !allowed;\n    };\n    var isInvalidUri = function (settings, uri, tagName) {\n      if (settings.allow_html_data_urls) {\n        return false;\n      } else if (/^data:image\\//i.test(uri)) {\n        return blockSvgDataUris(settings.allow_svg_data_urls, tagName) && /^data:image\\/svg\\+xml/i.test(uri);\n      } else {\n        return /^data:/i.test(uri);\n      }\n    };\n    var findEndTagIndex = function (schema, html, startIndex) {\n      var count = 1, index, matches;\n      var shortEndedElements = schema.getShortEndedElements();\n      var tokenRegExp = /<([!?\\/])?([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\/|\\s+)>/g;\n      tokenRegExp.lastIndex = index = startIndex;\n      while (matches = tokenRegExp.exec(html)) {\n        index = tokenRegExp.lastIndex;\n        if (matches[1] === '/') {\n          count--;\n        } else if (!matches[1]) {\n          if (matches[2] in shortEndedElements) {\n            continue;\n          }\n          count++;\n        }\n        if (count === 0) {\n          break;\n        }\n      }\n      return index;\n    };\n    var isConditionalComment = function (html, startIndex) {\n      return /^\\s*\\[if [\\w\\W]+\\]>.*<!\\[endif\\](--!?)?>/.test(html.substr(startIndex));\n    };\n    var findCommentEndIndex = function (html, isBogus, startIndex) {\n      if (startIndex === void 0) {\n        startIndex = 0;\n      }\n      var lcHtml = html.toLowerCase();\n      if (lcHtml.indexOf('[if ', startIndex) !== -1 && isConditionalComment(lcHtml, startIndex)) {\n        var endIfIndex = lcHtml.indexOf('[endif]', startIndex);\n        return lcHtml.indexOf('>', endIfIndex);\n      } else {\n        if (isBogus) {\n          var endIndex = lcHtml.indexOf('>', startIndex);\n          return endIndex !== -1 ? endIndex : lcHtml.length;\n        } else {\n          var endCommentRegexp = /--!?>/;\n          endCommentRegexp.lastIndex = startIndex;\n          var match = endCommentRegexp.exec(html);\n          return match ? match.index + match[0].length : lcHtml.length;\n        }\n      }\n    };\n    var checkBogusAttribute = function (regExp, attrString) {\n      var matches = regExp.exec(attrString);\n      if (matches) {\n        var name_1 = matches[1];\n        var value = matches[2];\n        return typeof name_1 === 'string' && name_1.toLowerCase() === 'data-mce-bogus' ? value : null;\n      } else {\n        return null;\n      }\n    };\n    function SaxParser(settings, schema) {\n      if (schema === void 0) {\n        schema = Schema();\n      }\n      var noop = function () {\n      };\n      settings = settings || {};\n      if (settings.fix_self_closing !== false) {\n        settings.fix_self_closing = true;\n      }\n      var comment = settings.comment ? settings.comment : noop;\n      var cdata = settings.cdata ? settings.cdata : noop;\n      var text = settings.text ? settings.text : noop;\n      var start = settings.start ? settings.start : noop;\n      var end = settings.end ? settings.end : noop;\n      var pi = settings.pi ? settings.pi : noop;\n      var doctype = settings.doctype ? settings.doctype : noop;\n      var parseInternal = function (base64Extract, format) {\n        if (format === void 0) {\n          format = 'html';\n        }\n        var html = base64Extract.html;\n        var matches, index = 0, value, endRegExp;\n        var stack = [];\n        var attrList, i, textData, name;\n        var isInternalElement, isShortEnded;\n        var elementRule, isValidElement, attr, attribsValue, validAttributesMap, validAttributePatterns;\n        var attributesRequired, attributesDefault, attributesForced;\n        var anyAttributesRequired, attrValue, idCount = 0;\n        var decode = Entities.decode;\n        var filteredUrlAttrs = Tools.makeMap('src,href,data,background,formaction,poster,xlink:href');\n        var scriptUriRegExp = /((java|vb)script|mhtml):/i;\n        var parsingMode = format === 'html' ? 0 : 1;\n        var processEndTag = function (name) {\n          var pos, i;\n          pos = stack.length;\n          while (pos--) {\n            if (stack[pos].name === name) {\n              break;\n            }\n          }\n          if (pos >= 0) {\n            for (i = stack.length - 1; i >= pos; i--) {\n              name = stack[i];\n              if (name.valid) {\n                end(name.name);\n              }\n            }\n            stack.length = pos;\n          }\n        };\n        var processText = function (value, raw) {\n          return text(restoreDataUris(value, base64Extract), raw);\n        };\n        var processComment = function (value) {\n          if (value === '') {\n            return;\n          }\n          if (value.charAt(0) === '>') {\n            value = ' ' + value;\n          }\n          if (!settings.allow_conditional_comments && value.substr(0, 3).toLowerCase() === '[if') {\n            value = ' ' + value;\n          }\n          comment(restoreDataUris(value, base64Extract));\n        };\n        var processAttr = function (value) {\n          return get$1(base64Extract.uris, value).getOr(value);\n        };\n        var processMalformedComment = function (value, startIndex) {\n          var startTag = value || '';\n          var isBogus = !startsWith(startTag, '--');\n          var endIndex = findCommentEndIndex(html, isBogus, startIndex);\n          value = html.substr(startIndex, endIndex - startIndex);\n          processComment(isBogus ? startTag + value : value);\n          return endIndex + 1;\n        };\n        var parseAttribute = function (tagName, name, value, val2, val3) {\n          var attrRule, i;\n          var trimRegExp = /[\\s\\u0000-\\u001F]+/g;\n          name = name.toLowerCase();\n          value = processAttr(name in fillAttrsMap ? name : decode(value || val2 || val3 || ''));\n          if (validate && !isInternalElement && isValidPrefixAttrName(name) === false) {\n            attrRule = validAttributesMap[name];\n            if (!attrRule && validAttributePatterns) {\n              i = validAttributePatterns.length;\n              while (i--) {\n                attrRule = validAttributePatterns[i];\n                if (attrRule.pattern.test(name)) {\n                  break;\n                }\n              }\n              if (i === -1) {\n                attrRule = null;\n              }\n            }\n            if (!attrRule) {\n              return;\n            }\n            if (attrRule.validValues && !(value in attrRule.validValues)) {\n              return;\n            }\n          }\n          if (filteredUrlAttrs[name] && !settings.allow_script_urls) {\n            var uri = value.replace(trimRegExp, '');\n            try {\n              uri = decodeURIComponent(uri);\n            } catch (ex) {\n              uri = unescape(uri);\n            }\n            if (scriptUriRegExp.test(uri)) {\n              return;\n            }\n            if (isInvalidUri(settings, uri, tagName)) {\n              return;\n            }\n          }\n          if (isInternalElement && (name in filteredUrlAttrs || name.indexOf('on') === 0)) {\n            return;\n          }\n          attrList.map[name] = value;\n          attrList.push({\n            name: name,\n            value: value\n          });\n        };\n        var tokenRegExp = new RegExp('<(?:' + '(?:!--([\\\\w\\\\W]*?)--!?>)|' + '(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|' + '(?:![Dd][Oo][Cc][Tt][Yy][Pp][Ee]([\\\\w\\\\W]*?)>)|' + '(?:!(--)?)|' + '(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|' + '(?:\\\\/([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)>)|' + '(?:([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)((?:\\\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\\\/|\\\\s+)>)' + ')', 'g');\n        var attrRegExp = /([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:[^\\\"])*)\\\")|(?:\\'((?:[^\\'])*)\\')|([^>\\s]+)))?/g;\n        var shortEndedElements = schema.getShortEndedElements();\n        var selfClosing = settings.self_closing_elements || schema.getSelfClosingElements();\n        var fillAttrsMap = schema.getBoolAttrs();\n        var validate = settings.validate;\n        var removeInternalElements = settings.remove_internals;\n        var fixSelfClosing = settings.fix_self_closing;\n        var specialElements = schema.getSpecialElements();\n        var processHtml = html + '>';\n        while (matches = tokenRegExp.exec(processHtml)) {\n          var matchText = matches[0];\n          if (index < matches.index) {\n            processText(decode(html.substr(index, matches.index - index)));\n          }\n          if (value = matches[7]) {\n            value = value.toLowerCase();\n            if (value.charAt(0) === ':') {\n              value = value.substr(1);\n            }\n            processEndTag(value);\n          } else if (value = matches[8]) {\n            if (matches.index + matchText.length > html.length) {\n              processText(decode(html.substr(matches.index)));\n              index = matches.index + matchText.length;\n              continue;\n            }\n            value = value.toLowerCase();\n            if (value.charAt(0) === ':') {\n              value = value.substr(1);\n            }\n            isShortEnded = value in shortEndedElements;\n            if (fixSelfClosing && selfClosing[value] && stack.length > 0 && stack[stack.length - 1].name === value) {\n              processEndTag(value);\n            }\n            var bogusValue = checkBogusAttribute(attrRegExp, matches[9]);\n            if (bogusValue !== null) {\n              if (bogusValue === 'all') {\n                index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\n                tokenRegExp.lastIndex = index;\n                continue;\n              }\n              isValidElement = false;\n            }\n            if (!validate || (elementRule = schema.getElementRule(value))) {\n              isValidElement = true;\n              if (validate) {\n                validAttributesMap = elementRule.attributes;\n                validAttributePatterns = elementRule.attributePatterns;\n              }\n              if (attribsValue = matches[9]) {\n                isInternalElement = attribsValue.indexOf('data-mce-type') !== -1;\n                if (isInternalElement && removeInternalElements) {\n                  isValidElement = false;\n                }\n                attrList = [];\n                attrList.map = {};\n                attribsValue.replace(attrRegExp, function (match, name, val, val2, val3) {\n                  parseAttribute(value, name, val, val2, val3);\n                  return '';\n                });\n              } else {\n                attrList = [];\n                attrList.map = {};\n              }\n              if (validate && !isInternalElement) {\n                attributesRequired = elementRule.attributesRequired;\n                attributesDefault = elementRule.attributesDefault;\n                attributesForced = elementRule.attributesForced;\n                anyAttributesRequired = elementRule.removeEmptyAttrs;\n                if (anyAttributesRequired && !attrList.length) {\n                  isValidElement = false;\n                }\n                if (attributesForced) {\n                  i = attributesForced.length;\n                  while (i--) {\n                    attr = attributesForced[i];\n                    name = attr.name;\n                    attrValue = attr.value;\n                    if (attrValue === '{$uid}') {\n                      attrValue = 'mce_' + idCount++;\n                    }\n                    attrList.map[name] = attrValue;\n                    attrList.push({\n                      name: name,\n                      value: attrValue\n                    });\n                  }\n                }\n                if (attributesDefault) {\n                  i = attributesDefault.length;\n                  while (i--) {\n                    attr = attributesDefault[i];\n                    name = attr.name;\n                    if (!(name in attrList.map)) {\n                      attrValue = attr.value;\n                      if (attrValue === '{$uid}') {\n                        attrValue = 'mce_' + idCount++;\n                      }\n                      attrList.map[name] = attrValue;\n                      attrList.push({\n                        name: name,\n                        value: attrValue\n                      });\n                    }\n                  }\n                }\n                if (attributesRequired) {\n                  i = attributesRequired.length;\n                  while (i--) {\n                    if (attributesRequired[i] in attrList.map) {\n                      break;\n                    }\n                  }\n                  if (i === -1) {\n                    isValidElement = false;\n                  }\n                }\n                if (attr = attrList.map['data-mce-bogus']) {\n                  if (attr === 'all') {\n                    index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\n                    tokenRegExp.lastIndex = index;\n                    continue;\n                  }\n                  isValidElement = false;\n                }\n              }\n              if (isValidElement) {\n                start(value, attrList, isShortEnded);\n              }\n            } else {\n              isValidElement = false;\n            }\n            if (endRegExp = specialElements[value]) {\n              endRegExp.lastIndex = index = matches.index + matchText.length;\n              if (matches = endRegExp.exec(html)) {\n                if (isValidElement) {\n                  textData = html.substr(index, matches.index - index);\n                }\n                index = matches.index + matches[0].length;\n              } else {\n                textData = html.substr(index);\n                index = html.length;\n              }\n              if (isValidElement) {\n                if (textData.length > 0) {\n                  processText(textData, true);\n                }\n                end(value);\n              }\n              tokenRegExp.lastIndex = index;\n              continue;\n            }\n            if (!isShortEnded) {\n              if (!attribsValue || attribsValue.indexOf('/') !== attribsValue.length - 1) {\n                stack.push({\n                  name: value,\n                  valid: isValidElement\n                });\n              } else if (isValidElement) {\n                end(value);\n              }\n            }\n          } else if (value = matches[1]) {\n            processComment(value);\n          } else if (value = matches[2]) {\n            var isValidCdataSection = parsingMode === 1 || settings.preserve_cdata || stack.length > 0 && schema.isValidChild(stack[stack.length - 1].name, '#cdata');\n            if (isValidCdataSection) {\n              cdata(value);\n            } else {\n              index = processMalformedComment('', matches.index + 2);\n              tokenRegExp.lastIndex = index;\n              continue;\n            }\n          } else if (value = matches[3]) {\n            doctype(value);\n          } else if ((value = matches[4]) || matchText === '<!') {\n            index = processMalformedComment(value, matches.index + matchText.length);\n            tokenRegExp.lastIndex = index;\n            continue;\n          } else if (value = matches[5]) {\n            if (parsingMode === 1) {\n              pi(value, matches[6]);\n            } else {\n              index = processMalformedComment('?', matches.index + 2);\n              tokenRegExp.lastIndex = index;\n              continue;\n            }\n          }\n          index = matches.index + matchText.length;\n        }\n        if (index < html.length) {\n          processText(decode(html.substr(index)));\n        }\n        for (i = stack.length - 1; i >= 0; i--) {\n          value = stack[i];\n          if (value.valid) {\n            end(value.name);\n          }\n        }\n      };\n      var parse = function (html, format) {\n        if (format === void 0) {\n          format = 'html';\n        }\n        parseInternal(extractBase64DataUris(html), format);\n      };\n      return { parse: parse };\n    }\n    (function (SaxParser) {\n      SaxParser.findEndTag = findEndTagIndex;\n    }(SaxParser || (SaxParser = {})));\n    var SaxParser$1 = SaxParser;\n\n    var trimHtml = function (tempAttrs, html) {\n      var trimContentRegExp = new RegExp(['\\\\s?(' + tempAttrs.join('|') + ')=\"[^\"]+\"'].join('|'), 'gi');\n      return html.replace(trimContentRegExp, '');\n    };\n    var trimInternal = function (serializer, html) {\n      var content = html;\n      var bogusAllRegExp = /<(\\w+) [^>]*data-mce-bogus=\"all\"[^>]*>/g;\n      var endTagIndex, index, matchLength, matches;\n      var schema = serializer.schema;\n      content = trimHtml(serializer.getTempAttrs(), content);\n      var shortEndedElements = schema.getShortEndedElements();\n      while (matches = bogusAllRegExp.exec(content)) {\n        index = bogusAllRegExp.lastIndex;\n        matchLength = matches[0].length;\n        if (shortEndedElements[matches[1]]) {\n          endTagIndex = index;\n        } else {\n          endTagIndex = SaxParser$1.findEndTag(schema, content, index);\n        }\n        content = content.substring(0, index - matchLength) + content.substring(endTagIndex);\n        bogusAllRegExp.lastIndex = index - matchLength;\n      }\n      return trim$2(content);\n    };\n    var trimExternal = trimInternal;\n\n    var trimEmptyContents = function (editor, html) {\n      var blockName = getForcedRootBlock(editor);\n      var emptyRegExp = new RegExp('^(<' + blockName + '[^>]*>(&nbsp;|&#160;|\\\\s|\\xA0|<br \\\\/>|)<\\\\/' + blockName + '>[\\r\\n]*|<br \\\\/>[\\r\\n]*)$');\n      return html.replace(emptyRegExp, '');\n    };\n    var getContentFromBody = function (editor, args, format, body) {\n      var content;\n      args.format = format;\n      args.get = true;\n      args.getInner = true;\n      if (!args.no_events) {\n        editor.fire('BeforeGetContent', args);\n      }\n      if (args.format === 'raw') {\n        content = Tools.trim(trimExternal(editor.serializer, body.innerHTML));\n      } else if (args.format === 'text') {\n        content = editor.dom.isEmpty(body) ? '' : trim$2(body.innerText || body.textContent);\n      } else if (args.format === 'tree') {\n        content = editor.serializer.serialize(body, args);\n      } else {\n        content = trimEmptyContents(editor, editor.serializer.serialize(body, args));\n      }\n      if (!contains([\n          'text',\n          'tree'\n        ], args.format) && !isWsPreserveElement(SugarElement.fromDom(body))) {\n        args.content = Tools.trim(content);\n      } else {\n        args.content = content;\n      }\n      if (!args.no_events) {\n        editor.fire('GetContent', args);\n      }\n      return args.content;\n    };\n    var getContentInternal = function (editor, args, format) {\n      return Optional.from(editor.getBody()).fold(constant(args.format === 'tree' ? new AstNode('body', 11) : ''), function (body) {\n        return getContentFromBody(editor, args, format, body);\n      });\n    };\n\n    var each$7 = Tools.each;\n    var ElementUtils = function (dom) {\n      this.compare = function (node1, node2) {\n        if (node1.nodeName !== node2.nodeName) {\n          return false;\n        }\n        var getAttribs = function (node) {\n          var attribs = {};\n          each$7(dom.getAttribs(node), function (attr) {\n            var name = attr.nodeName.toLowerCase();\n            if (name.indexOf('_') !== 0 && name !== 'style' && name.indexOf('data-') !== 0) {\n              attribs[name] = dom.getAttrib(node, name);\n            }\n          });\n          return attribs;\n        };\n        var compareObjects = function (obj1, obj2) {\n          var value, name;\n          for (name in obj1) {\n            if (obj1.hasOwnProperty(name)) {\n              value = obj2[name];\n              if (typeof value === 'undefined') {\n                return false;\n              }\n              if (obj1[name] !== value) {\n                return false;\n              }\n              delete obj2[name];\n            }\n          }\n          for (name in obj2) {\n            if (obj2.hasOwnProperty(name)) {\n              return false;\n            }\n          }\n          return true;\n        };\n        if (!compareObjects(getAttribs(node1), getAttribs(node2))) {\n          return false;\n        }\n        if (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style')))) {\n          return false;\n        }\n        return !isBookmarkNode$1(node1) && !isBookmarkNode$1(node2);\n      };\n    };\n\n    var isChar = function (forward, predicate, pos) {\n      return Optional.from(pos.container()).filter(isText$1).exists(function (text) {\n        var delta = forward ? 0 : -1;\n        return predicate(text.data.charAt(pos.offset() + delta));\n      });\n    };\n    var isBeforeSpace = curry(isChar, true, isWhiteSpace$1);\n    var isAfterSpace = curry(isChar, false, isWhiteSpace$1);\n    var isEmptyText = function (pos) {\n      var container = pos.container();\n      return isText$1(container) && (container.data.length === 0 || isZwsp$1(container.data) && BookmarkManager$1.isBookmarkNode(container.parentNode));\n    };\n    var matchesElementPosition = function (before, predicate) {\n      return function (pos) {\n        return Optional.from(getChildNodeAtRelativeOffset(before ? 0 : -1, pos)).filter(predicate).isSome();\n      };\n    };\n    var isImageBlock = function (node) {\n      return isImg(node) && get$5(SugarElement.fromDom(node), 'display') === 'block';\n    };\n    var isCefNode = function (node) {\n      return isContentEditableFalse(node) && !isBogusAll(node);\n    };\n    var isBeforeImageBlock = matchesElementPosition(true, isImageBlock);\n    var isAfterImageBlock = matchesElementPosition(false, isImageBlock);\n    var isBeforeMedia = matchesElementPosition(true, isMedia);\n    var isAfterMedia = matchesElementPosition(false, isMedia);\n    var isBeforeTable = matchesElementPosition(true, isTable);\n    var isAfterTable = matchesElementPosition(false, isTable);\n    var isBeforeContentEditableFalse = matchesElementPosition(true, isCefNode);\n    var isAfterContentEditableFalse = matchesElementPosition(false, isCefNode);\n\n    var getLastChildren$1 = function (elm) {\n      var children = [];\n      var rawNode = elm.dom;\n      while (rawNode) {\n        children.push(SugarElement.fromDom(rawNode));\n        rawNode = rawNode.lastChild;\n      }\n      return children;\n    };\n    var removeTrailingBr = function (elm) {\n      var allBrs = descendants$1(elm, 'br');\n      var brs = filter(getLastChildren$1(elm).slice(-1), isBr$1);\n      if (allBrs.length === brs.length) {\n        each(brs, remove);\n      }\n    };\n    var fillWithPaddingBr = function (elm) {\n      empty(elm);\n      append(elm, SugarElement.fromHtml('<br data-mce-bogus=\"1\">'));\n    };\n    var trimBlockTrailingBr = function (elm) {\n      lastChild(elm).each(function (lastChild) {\n        prevSibling(lastChild).each(function (lastChildPrevSibling) {\n          if (isBlock(elm) && isBr$1(lastChild) && isBlock(lastChildPrevSibling)) {\n            remove(lastChild);\n          }\n        });\n      });\n    };\n\n    var dropLast = function (xs) {\n      return xs.slice(0, -1);\n    };\n    var parentsUntil$1 = function (start, root, predicate) {\n      if (contains$2(root, start)) {\n        return dropLast(parents(start, function (elm) {\n          return predicate(elm) || eq$2(elm, root);\n        }));\n      } else {\n        return [];\n      }\n    };\n    var parents$1 = function (start, root) {\n      return parentsUntil$1(start, root, never);\n    };\n    var parentsAndSelf = function (start, root) {\n      return [start].concat(parents$1(start, root));\n    };\n\n    var navigateIgnoreEmptyTextNodes = function (forward, root, from) {\n      return navigateIgnore(forward, root, from, isEmptyText);\n    };\n    var getClosestBlock = function (root, pos) {\n      return find(parentsAndSelf(SugarElement.fromDom(pos.container()), root), isBlock);\n    };\n    var isAtBeforeAfterBlockBoundary = function (forward, root, pos) {\n      return navigateIgnoreEmptyTextNodes(forward, root.dom, pos).forall(function (newPos) {\n        return getClosestBlock(root, pos).fold(function () {\n          return isInSameBlock(newPos, pos, root.dom) === false;\n        }, function (fromBlock) {\n          return isInSameBlock(newPos, pos, root.dom) === false && contains$2(fromBlock, SugarElement.fromDom(newPos.container()));\n        });\n      });\n    };\n    var isAtBlockBoundary$1 = function (forward, root, pos) {\n      return getClosestBlock(root, pos).fold(function () {\n        return navigateIgnoreEmptyTextNodes(forward, root.dom, pos).forall(function (newPos) {\n          return isInSameBlock(newPos, pos, root.dom) === false;\n        });\n      }, function (parent) {\n        return navigateIgnoreEmptyTextNodes(forward, parent.dom, pos).isNone();\n      });\n    };\n    var isAtStartOfBlock = curry(isAtBlockBoundary$1, false);\n    var isAtEndOfBlock = curry(isAtBlockBoundary$1, true);\n    var isBeforeBlock = curry(isAtBeforeAfterBlockBoundary, false);\n    var isAfterBlock = curry(isAtBeforeAfterBlockBoundary, true);\n\n    var isBr$5 = function (pos) {\n      return getElementFromPosition(pos).exists(isBr$1);\n    };\n    var findBr = function (forward, root, pos) {\n      var parentBlocks = filter(parentsAndSelf(SugarElement.fromDom(pos.container()), root), isBlock);\n      var scope = head(parentBlocks).getOr(root);\n      return fromPosition(forward, scope.dom, pos).filter(isBr$5);\n    };\n    var isBeforeBr = function (root, pos) {\n      return getElementFromPosition(pos).exists(isBr$1) || findBr(true, root, pos).isSome();\n    };\n    var isAfterBr = function (root, pos) {\n      return getElementFromPrevPosition(pos).exists(isBr$1) || findBr(false, root, pos).isSome();\n    };\n    var findPreviousBr = curry(findBr, false);\n    var findNextBr = curry(findBr, true);\n\n    var isInMiddleOfText = function (pos) {\n      return CaretPosition.isTextPosition(pos) && !pos.isAtStart() && !pos.isAtEnd();\n    };\n    var getClosestBlock$1 = function (root, pos) {\n      var parentBlocks = filter(parentsAndSelf(SugarElement.fromDom(pos.container()), root), isBlock);\n      return head(parentBlocks).getOr(root);\n    };\n    var hasSpaceBefore = function (root, pos) {\n      if (isInMiddleOfText(pos)) {\n        return isAfterSpace(pos);\n      } else {\n        return isAfterSpace(pos) || prevPosition(getClosestBlock$1(root, pos).dom, pos).exists(isAfterSpace);\n      }\n    };\n    var hasSpaceAfter = function (root, pos) {\n      if (isInMiddleOfText(pos)) {\n        return isBeforeSpace(pos);\n      } else {\n        return isBeforeSpace(pos) || nextPosition(getClosestBlock$1(root, pos).dom, pos).exists(isBeforeSpace);\n      }\n    };\n    var isPreValue = function (value) {\n      return contains([\n        'pre',\n        'pre-wrap'\n      ], value);\n    };\n    var isInPre = function (pos) {\n      return getElementFromPosition(pos).bind(function (elm) {\n        return closest(elm, isElement);\n      }).exists(function (elm) {\n        return isPreValue(get$5(elm, 'white-space'));\n      });\n    };\n    var isAtBeginningOfBody = function (root, pos) {\n      return prevPosition(root.dom, pos).isNone();\n    };\n    var isAtEndOfBody = function (root, pos) {\n      return nextPosition(root.dom, pos).isNone();\n    };\n    var isAtLineBoundary = function (root, pos) {\n      return isAtBeginningOfBody(root, pos) || isAtEndOfBody(root, pos) || isAtStartOfBlock(root, pos) || isAtEndOfBlock(root, pos) || isAfterBr(root, pos) || isBeforeBr(root, pos);\n    };\n    var needsToHaveNbsp = function (root, pos) {\n      if (isInPre(pos)) {\n        return false;\n      } else {\n        return isAtLineBoundary(root, pos) || hasSpaceBefore(root, pos) || hasSpaceAfter(root, pos);\n      }\n    };\n    var needsToBeNbspLeft = function (root, pos) {\n      if (isInPre(pos)) {\n        return false;\n      } else {\n        return isAtStartOfBlock(root, pos) || isBeforeBlock(root, pos) || isAfterBr(root, pos) || hasSpaceBefore(root, pos);\n      }\n    };\n    var leanRight = function (pos) {\n      var container = pos.container();\n      var offset = pos.offset();\n      if (isText$1(container) && offset < container.data.length) {\n        return CaretPosition(container, offset + 1);\n      } else {\n        return pos;\n      }\n    };\n    var needsToBeNbspRight = function (root, pos) {\n      if (isInPre(pos)) {\n        return false;\n      } else {\n        return isAtEndOfBlock(root, pos) || isAfterBlock(root, pos) || isBeforeBr(root, pos) || hasSpaceAfter(root, pos);\n      }\n    };\n    var needsToBeNbsp = function (root, pos) {\n      return needsToBeNbspLeft(root, pos) || needsToBeNbspRight(root, leanRight(pos));\n    };\n    var isNbspAt = function (text, offset) {\n      return isNbsp(text.charAt(offset));\n    };\n    var hasNbsp = function (pos) {\n      var container = pos.container();\n      return isText$1(container) && contains$1(container.data, nbsp);\n    };\n    var normalizeNbspMiddle = function (text) {\n      var chars = text.split('');\n      return map(chars, function (chr, i) {\n        if (isNbsp(chr) && i > 0 && i < chars.length - 1 && isContent$1(chars[i - 1]) && isContent$1(chars[i + 1])) {\n          return ' ';\n        } else {\n          return chr;\n        }\n      }).join('');\n    };\n    var normalizeNbspAtStart = function (root, node) {\n      var text = node.data;\n      var firstPos = CaretPosition(node, 0);\n      if (isNbspAt(text, 0) && !needsToBeNbsp(root, firstPos)) {\n        node.data = ' ' + text.slice(1);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var normalizeNbspInMiddleOfTextNode = function (node) {\n      var text = node.data;\n      var newText = normalizeNbspMiddle(text);\n      if (newText !== text) {\n        node.data = newText;\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var normalizeNbspAtEnd = function (root, node) {\n      var text = node.data;\n      var lastPos = CaretPosition(node, text.length - 1);\n      if (isNbspAt(text, text.length - 1) && !needsToBeNbsp(root, lastPos)) {\n        node.data = text.slice(0, -1) + ' ';\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var normalizeNbsps = function (root, pos) {\n      return Optional.some(pos).filter(hasNbsp).bind(function (pos) {\n        var container = pos.container();\n        var normalized = normalizeNbspAtStart(root, container) || normalizeNbspInMiddleOfTextNode(container) || normalizeNbspAtEnd(root, container);\n        return normalized ? Optional.some(pos) : Optional.none();\n      });\n    };\n    var normalizeNbspsInEditor = function (editor) {\n      var root = SugarElement.fromDom(editor.getBody());\n      if (editor.selection.isCollapsed()) {\n        normalizeNbsps(root, CaretPosition.fromRangeStart(editor.selection.getRng())).each(function (pos) {\n          editor.selection.setRng(pos.toRange());\n        });\n      }\n    };\n\n    var normalizeContent = function (content, isStartOfContent, isEndOfContent) {\n      var result = foldl(content, function (acc, c) {\n        if (isWhiteSpace$1(c) || isNbsp(c)) {\n          if (acc.previousCharIsSpace || acc.str === '' && isStartOfContent || acc.str.length === content.length - 1 && isEndOfContent) {\n            return {\n              previousCharIsSpace: false,\n              str: acc.str + nbsp\n            };\n          } else {\n            return {\n              previousCharIsSpace: true,\n              str: acc.str + ' '\n            };\n          }\n        } else {\n          return {\n            previousCharIsSpace: false,\n            str: acc.str + c\n          };\n        }\n      }, {\n        previousCharIsSpace: false,\n        str: ''\n      });\n      return result.str;\n    };\n    var normalize$1 = function (node, offset, count) {\n      if (count === 0) {\n        return;\n      }\n      var elm = SugarElement.fromDom(node);\n      var root = ancestor(elm, isBlock).getOr(elm);\n      var whitespace = node.data.slice(offset, offset + count);\n      var isEndOfContent = offset + count >= node.data.length && needsToBeNbspRight(root, CaretPosition$1(node, node.data.length));\n      var isStartOfContent = offset === 0 && needsToBeNbspLeft(root, CaretPosition$1(node, 0));\n      node.replaceData(offset, count, normalizeContent(whitespace, isStartOfContent, isEndOfContent));\n    };\n    var normalizeWhitespaceAfter = function (node, offset) {\n      var content = node.data.slice(offset);\n      var whitespaceCount = content.length - lTrim(content).length;\n      return normalize$1(node, offset, whitespaceCount);\n    };\n    var normalizeWhitespaceBefore = function (node, offset) {\n      var content = node.data.slice(0, offset);\n      var whitespaceCount = content.length - rTrim(content).length;\n      return normalize$1(node, offset - whitespaceCount, whitespaceCount);\n    };\n    var mergeTextNodes = function (prevNode, nextNode, normalizeWhitespace, mergeToPrev) {\n      if (mergeToPrev === void 0) {\n        mergeToPrev = true;\n      }\n      var whitespaceOffset = rTrim(prevNode.data).length;\n      var newNode = mergeToPrev ? prevNode : nextNode;\n      var removeNode = mergeToPrev ? nextNode : prevNode;\n      if (mergeToPrev) {\n        newNode.appendData(removeNode.data);\n      } else {\n        newNode.insertData(0, removeNode.data);\n      }\n      remove(SugarElement.fromDom(removeNode));\n      if (normalizeWhitespace) {\n        normalizeWhitespaceAfter(newNode, whitespaceOffset);\n      }\n      return newNode;\n    };\n\n    var needsReposition = function (pos, elm) {\n      var container = pos.container();\n      var offset = pos.offset();\n      return CaretPosition$1.isTextPosition(pos) === false && container === elm.parentNode && offset > CaretPosition$1.before(elm).offset();\n    };\n    var reposition = function (elm, pos) {\n      return needsReposition(pos, elm) ? CaretPosition$1(pos.container(), pos.offset() - 1) : pos;\n    };\n    var beforeOrStartOf = function (node) {\n      return isText$1(node) ? CaretPosition$1(node, 0) : CaretPosition$1.before(node);\n    };\n    var afterOrEndOf = function (node) {\n      return isText$1(node) ? CaretPosition$1(node, node.data.length) : CaretPosition$1.after(node);\n    };\n    var getPreviousSiblingCaretPosition = function (elm) {\n      if (isCaretCandidate(elm.previousSibling)) {\n        return Optional.some(afterOrEndOf(elm.previousSibling));\n      } else {\n        return elm.previousSibling ? lastPositionIn(elm.previousSibling) : Optional.none();\n      }\n    };\n    var getNextSiblingCaretPosition = function (elm) {\n      if (isCaretCandidate(elm.nextSibling)) {\n        return Optional.some(beforeOrStartOf(elm.nextSibling));\n      } else {\n        return elm.nextSibling ? firstPositionIn(elm.nextSibling) : Optional.none();\n      }\n    };\n    var findCaretPositionBackwardsFromElm = function (rootElement, elm) {\n      var startPosition = CaretPosition$1.before(elm.previousSibling ? elm.previousSibling : elm.parentNode);\n      return prevPosition(rootElement, startPosition).fold(function () {\n        return nextPosition(rootElement, CaretPosition$1.after(elm));\n      }, Optional.some);\n    };\n    var findCaretPositionForwardsFromElm = function (rootElement, elm) {\n      return nextPosition(rootElement, CaretPosition$1.after(elm)).fold(function () {\n        return prevPosition(rootElement, CaretPosition$1.before(elm));\n      }, Optional.some);\n    };\n    var findCaretPositionBackwards = function (rootElement, elm) {\n      return getPreviousSiblingCaretPosition(elm).orThunk(function () {\n        return getNextSiblingCaretPosition(elm);\n      }).orThunk(function () {\n        return findCaretPositionBackwardsFromElm(rootElement, elm);\n      });\n    };\n    var findCaretPositionForward = function (rootElement, elm) {\n      return getNextSiblingCaretPosition(elm).orThunk(function () {\n        return getPreviousSiblingCaretPosition(elm);\n      }).orThunk(function () {\n        return findCaretPositionForwardsFromElm(rootElement, elm);\n      });\n    };\n    var findCaretPosition$1 = function (forward, rootElement, elm) {\n      return forward ? findCaretPositionForward(rootElement, elm) : findCaretPositionBackwards(rootElement, elm);\n    };\n    var findCaretPosOutsideElmAfterDelete = function (forward, rootElement, elm) {\n      return findCaretPosition$1(forward, rootElement, elm).map(curry(reposition, elm));\n    };\n    var setSelection = function (editor, forward, pos) {\n      pos.fold(function () {\n        editor.focus();\n      }, function (pos) {\n        editor.selection.setRng(pos.toRange(), forward);\n      });\n    };\n    var eqRawNode = function (rawNode) {\n      return function (elm) {\n        return elm.dom === rawNode;\n      };\n    };\n    var isBlock$2 = function (editor, elm) {\n      return elm && has(editor.schema.getBlockElements(), name(elm));\n    };\n    var paddEmptyBlock = function (elm) {\n      if (isEmpty(elm)) {\n        var br = SugarElement.fromHtml('<br data-mce-bogus=\"1\">');\n        empty(elm);\n        append(elm, br);\n        return Optional.some(CaretPosition$1.before(br.dom));\n      } else {\n        return Optional.none();\n      }\n    };\n    var deleteNormalized = function (elm, afterDeletePosOpt, normalizeWhitespace) {\n      var prevTextOpt = prevSibling(elm).filter(isText);\n      var nextTextOpt = nextSibling(elm).filter(isText);\n      remove(elm);\n      return lift3(prevTextOpt, nextTextOpt, afterDeletePosOpt, function (prev, next, pos) {\n        var prevNode = prev.dom, nextNode = next.dom;\n        var offset = prevNode.data.length;\n        mergeTextNodes(prevNode, nextNode, normalizeWhitespace);\n        return pos.container() === nextNode ? CaretPosition$1(prevNode, offset) : pos;\n      }).orThunk(function () {\n        if (normalizeWhitespace) {\n          prevTextOpt.each(function (elm) {\n            return normalizeWhitespaceBefore(elm.dom, elm.dom.length);\n          });\n          nextTextOpt.each(function (elm) {\n            return normalizeWhitespaceAfter(elm.dom, 0);\n          });\n        }\n        return afterDeletePosOpt;\n      });\n    };\n    var isInlineElement = function (editor, element) {\n      return has(editor.schema.getTextInlineElements(), name(element));\n    };\n    var deleteElement = function (editor, forward, elm, moveCaret) {\n      if (moveCaret === void 0) {\n        moveCaret = true;\n      }\n      var afterDeletePos = findCaretPosOutsideElmAfterDelete(forward, editor.getBody(), elm.dom);\n      var parentBlock = ancestor(elm, curry(isBlock$2, editor), eqRawNode(editor.getBody()));\n      var normalizedAfterDeletePos = deleteNormalized(elm, afterDeletePos, isInlineElement(editor, elm));\n      if (editor.dom.isEmpty(editor.getBody())) {\n        editor.setContent('');\n        editor.selection.setCursorLocation();\n      } else {\n        parentBlock.bind(paddEmptyBlock).fold(function () {\n          if (moveCaret) {\n            setSelection(editor, forward, normalizedAfterDeletePos);\n          }\n        }, function (paddPos) {\n          if (moveCaret) {\n            setSelection(editor, forward, Optional.some(paddPos));\n          }\n        });\n      }\n    };\n\n    var tableCellRng = function (start, end) {\n      return {\n        start: start,\n        end: end\n      };\n    };\n    var tableSelection = function (rng, table, cells) {\n      return {\n        rng: rng,\n        table: table,\n        cells: cells\n      };\n    };\n    var deleteAction = Adt.generate([\n      { removeTable: ['element'] },\n      { emptyCells: ['cells'] },\n      {\n        deleteCellSelection: [\n          'rng',\n          'cell'\n        ]\n      }\n    ]);\n    var isRootFromElement = function (root) {\n      return function (cur) {\n        return eq$2(root, cur);\n      };\n    };\n    var getClosestCell = function (container, isRoot) {\n      return closest$1(SugarElement.fromDom(container), 'td,th', isRoot);\n    };\n    var getClosestTable = function (cell, isRoot) {\n      return ancestor$1(cell, 'table', isRoot);\n    };\n    var isExpandedCellRng = function (cellRng) {\n      return !eq$2(cellRng.start, cellRng.end);\n    };\n    var getTableFromCellRng = function (cellRng, isRoot) {\n      return getClosestTable(cellRng.start, isRoot).bind(function (startParentTable) {\n        return getClosestTable(cellRng.end, isRoot).bind(function (endParentTable) {\n          return someIf(eq$2(startParentTable, endParentTable), startParentTable);\n        });\n      });\n    };\n    var isSingleCellTable = function (cellRng, isRoot) {\n      return !isExpandedCellRng(cellRng) && getTableFromCellRng(cellRng, isRoot).exists(function (table) {\n        var rows = table.dom.rows;\n        return rows.length === 1 && rows[0].cells.length === 1;\n      });\n    };\n    var getTableCells = function (table) {\n      return descendants$1(table, 'td,th');\n    };\n    var getCellRng = function (rng, isRoot) {\n      var startCell = getClosestCell(rng.startContainer, isRoot);\n      var endCell = getClosestCell(rng.endContainer, isRoot);\n      return lift2(startCell, endCell, tableCellRng);\n    };\n    var getCellRangeFromStartTable = function (cellRng, isRoot) {\n      return getClosestTable(cellRng.start, isRoot).bind(function (table) {\n        return last(getTableCells(table)).map(function (endCell) {\n          return tableCellRng(cellRng.start, endCell);\n        });\n      });\n    };\n    var partialSelection = function (isRoot, rng) {\n      var startCell = getClosestCell(rng.startContainer, isRoot);\n      var endCell = getClosestCell(rng.endContainer, isRoot);\n      return rng.collapsed ? Optional.none() : lift2(startCell, endCell, tableCellRng).fold(function () {\n        return startCell.fold(function () {\n          return endCell.bind(function (endCell) {\n            return getClosestTable(endCell, isRoot).bind(function (table) {\n              return head(getTableCells(table)).map(function (startCell) {\n                return tableCellRng(startCell, endCell);\n              });\n            });\n          });\n        }, function (startCell) {\n          return getClosestTable(startCell, isRoot).bind(function (table) {\n            return last(getTableCells(table)).map(function (endCell) {\n              return tableCellRng(startCell, endCell);\n            });\n          });\n        });\n      }, function (cellRng) {\n        return isWithinSameTable(isRoot, cellRng) ? Optional.none() : getCellRangeFromStartTable(cellRng, isRoot);\n      });\n    };\n    var isWithinSameTable = function (isRoot, cellRng) {\n      return getTableFromCellRng(cellRng, isRoot).isSome();\n    };\n    var getTableSelectionFromCellRng = function (cellRng, isRoot) {\n      return getTableFromCellRng(cellRng, isRoot).map(function (table) {\n        return tableSelection(cellRng, table, getTableCells(table));\n      });\n    };\n    var getTableSelection = function (optCellRng, rng, isRoot) {\n      return optCellRng.filter(function (cellRng) {\n        return isExpandedCellRng(cellRng) && isWithinSameTable(isRoot, cellRng);\n      }).orThunk(function () {\n        return partialSelection(isRoot, rng);\n      }).bind(function (cRng) {\n        return getTableSelectionFromCellRng(cRng, isRoot);\n      });\n    };\n    var getCellIndex = function (cells, cell) {\n      return findIndex(cells, function (x) {\n        return eq$2(x, cell);\n      });\n    };\n    var getSelectedCells = function (tableSelection) {\n      return lift2(getCellIndex(tableSelection.cells, tableSelection.rng.start), getCellIndex(tableSelection.cells, tableSelection.rng.end), function (startIndex, endIndex) {\n        return tableSelection.cells.slice(startIndex, endIndex + 1);\n      });\n    };\n    var isSingleCellTableContentSelected = function (optCellRng, rng, isRoot) {\n      return optCellRng.filter(function (cellRng) {\n        return isSingleCellTable(cellRng, isRoot) && hasAllContentsSelected(cellRng.start, rng);\n      }).map(function (cellRng) {\n        return cellRng.start;\n      });\n    };\n    var getAction = function (tableSelection) {\n      return getSelectedCells(tableSelection).map(function (selected) {\n        var cells = tableSelection.cells;\n        return selected.length === cells.length ? deleteAction.removeTable(tableSelection.table) : deleteAction.emptyCells(selected);\n      });\n    };\n    var getActionFromRange = function (root, rng) {\n      var isRoot = isRootFromElement(root);\n      var optCellRng = getCellRng(rng, isRoot);\n      return isSingleCellTableContentSelected(optCellRng, rng, isRoot).map(function (cell) {\n        return deleteAction.deleteCellSelection(rng, cell);\n      }).orThunk(function () {\n        return getTableSelection(optCellRng, rng, isRoot).bind(getAction);\n      });\n    };\n\n    var freefallRtl = function (root) {\n      var child = isComment(root) ? prevSibling(root) : lastChild(root);\n      return child.bind(freefallRtl).orThunk(function () {\n        return Optional.some(root);\n      });\n    };\n    var emptyCells = function (editor, cells) {\n      each(cells, fillWithPaddingBr);\n      editor.selection.setCursorLocation(cells[0].dom, 0);\n      return true;\n    };\n    var deleteCellContents = function (editor, rng, cell) {\n      rng.deleteContents();\n      var lastNode = freefallRtl(cell).getOr(cell);\n      var lastBlock = SugarElement.fromDom(editor.dom.getParent(lastNode.dom, editor.dom.isBlock));\n      if (isEmpty(lastBlock)) {\n        fillWithPaddingBr(lastBlock);\n        editor.selection.setCursorLocation(lastBlock.dom, 0);\n      }\n      if (!eq$2(cell, lastBlock)) {\n        var additionalCleanupNodes = parent(lastBlock).is(cell) ? [] : siblings(lastBlock);\n        each(additionalCleanupNodes.concat(children(cell)), function (node) {\n          if (!eq$2(node, lastBlock) && !contains$2(node, lastBlock)) {\n            remove(node);\n          }\n        });\n      }\n      return true;\n    };\n    var deleteTableElement = function (editor, table) {\n      deleteElement(editor, false, table);\n      return true;\n    };\n    var deleteCellRange = function (editor, rootElm, rng) {\n      return getActionFromRange(rootElm, rng).map(function (action) {\n        return action.fold(curry(deleteTableElement, editor), curry(emptyCells, editor), curry(deleteCellContents, editor));\n      });\n    };\n    var deleteCaptionRange = function (editor, caption) {\n      return emptyElement(editor, caption);\n    };\n    var deleteTableRange = function (editor, rootElm, rng, startElm) {\n      return getParentCaption(rootElm, startElm).fold(function () {\n        return deleteCellRange(editor, rootElm, rng);\n      }, function (caption) {\n        return deleteCaptionRange(editor, caption);\n      }).getOr(false);\n    };\n    var deleteRange = function (editor, startElm) {\n      var rootNode = SugarElement.fromDom(editor.getBody());\n      var rng = editor.selection.getRng();\n      var selectedCells = getCellsFromEditor(editor);\n      return selectedCells.length !== 0 ? emptyCells(editor, selectedCells) : deleteTableRange(editor, rootNode, rng, startElm);\n    };\n    var getParentCell = function (rootElm, elm) {\n      return find(parentsAndSelf(elm, rootElm), isTableCell$1);\n    };\n    var getParentCaption = function (rootElm, elm) {\n      return find(parentsAndSelf(elm, rootElm), function (elm) {\n        return name(elm) === 'caption';\n      });\n    };\n    var deleteBetweenCells = function (editor, rootElm, forward, fromCell, from) {\n      return navigate(forward, editor.getBody(), from).bind(function (to) {\n        return getParentCell(rootElm, SugarElement.fromDom(to.getNode())).map(function (toCell) {\n          return eq$2(toCell, fromCell) === false;\n        });\n      });\n    };\n    var emptyElement = function (editor, elm) {\n      fillWithPaddingBr(elm);\n      editor.selection.setCursorLocation(elm.dom, 0);\n      return Optional.some(true);\n    };\n    var isDeleteOfLastCharPos = function (fromCaption, forward, from, to) {\n      return firstPositionIn(fromCaption.dom).bind(function (first) {\n        return lastPositionIn(fromCaption.dom).map(function (last) {\n          return forward ? from.isEqual(first) && to.isEqual(last) : from.isEqual(last) && to.isEqual(first);\n        });\n      }).getOr(true);\n    };\n    var emptyCaretCaption = function (editor, elm) {\n      return emptyElement(editor, elm);\n    };\n    var validateCaretCaption = function (rootElm, fromCaption, to) {\n      return getParentCaption(rootElm, SugarElement.fromDom(to.getNode())).map(function (toCaption) {\n        return eq$2(toCaption, fromCaption) === false;\n      });\n    };\n    var deleteCaretInsideCaption = function (editor, rootElm, forward, fromCaption, from) {\n      return navigate(forward, editor.getBody(), from).bind(function (to) {\n        return isDeleteOfLastCharPos(fromCaption, forward, from, to) ? emptyCaretCaption(editor, fromCaption) : validateCaretCaption(rootElm, fromCaption, to);\n      }).or(Optional.some(true));\n    };\n    var deleteCaretCells = function (editor, forward, rootElm, startElm) {\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return getParentCell(rootElm, startElm).bind(function (fromCell) {\n        return isEmpty(fromCell) ? emptyElement(editor, fromCell) : deleteBetweenCells(editor, rootElm, forward, fromCell, from);\n      }).getOr(false);\n    };\n    var deleteCaretCaption = function (editor, forward, rootElm, fromCaption) {\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return isEmpty(fromCaption) ? emptyElement(editor, fromCaption) : deleteCaretInsideCaption(editor, rootElm, forward, fromCaption, from);\n    };\n    var isNearTable = function (forward, pos) {\n      return forward ? isBeforeTable(pos) : isAfterTable(pos);\n    };\n    var isBeforeOrAfterTable = function (editor, forward) {\n      var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return isNearTable(forward, fromPos) || fromPosition(forward, editor.getBody(), fromPos).exists(function (pos) {\n        return isNearTable(forward, pos);\n      });\n    };\n    var deleteCaret = function (editor, forward, startElm) {\n      var rootElm = SugarElement.fromDom(editor.getBody());\n      return getParentCaption(rootElm, startElm).fold(function () {\n        return deleteCaretCells(editor, forward, rootElm, startElm) || isBeforeOrAfterTable(editor, forward);\n      }, function (fromCaption) {\n        return deleteCaretCaption(editor, forward, rootElm, fromCaption).getOr(false);\n      });\n    };\n    var backspaceDelete = function (editor, forward) {\n      var startElm = SugarElement.fromDom(editor.selection.getStart(true));\n      var cells = getCellsFromEditor(editor);\n      return editor.selection.isCollapsed() && cells.length === 0 ? deleteCaret(editor, forward, startElm) : deleteRange(editor, startElm);\n    };\n\n    var createRange$1 = function (sc, so, ec, eo) {\n      var rng = document.createRange();\n      rng.setStart(sc, so);\n      rng.setEnd(ec, eo);\n      return rng;\n    };\n    var normalizeBlockSelectionRange = function (rng) {\n      var startPos = CaretPosition$1.fromRangeStart(rng);\n      var endPos = CaretPosition$1.fromRangeEnd(rng);\n      var rootNode = rng.commonAncestorContainer;\n      return fromPosition(false, rootNode, endPos).map(function (newEndPos) {\n        if (!isInSameBlock(startPos, endPos, rootNode) && isInSameBlock(startPos, newEndPos, rootNode)) {\n          return createRange$1(startPos.container(), startPos.offset(), newEndPos.container(), newEndPos.offset());\n        } else {\n          return rng;\n        }\n      }).getOr(rng);\n    };\n    var normalize$2 = function (rng) {\n      return rng.collapsed ? rng : normalizeBlockSelectionRange(rng);\n    };\n\n    var hasOnlyOneChild = function (node) {\n      return node.firstChild && node.firstChild === node.lastChild;\n    };\n    var isPaddingNode = function (node) {\n      return node.name === 'br' || node.value === nbsp;\n    };\n    var isPaddedEmptyBlock = function (schema, node) {\n      var blockElements = schema.getBlockElements();\n      return blockElements[node.name] && hasOnlyOneChild(node) && isPaddingNode(node.firstChild);\n    };\n    var isEmptyFragmentElement = function (schema, node) {\n      var nonEmptyElements = schema.getNonEmptyElements();\n      return node && (node.isEmpty(nonEmptyElements) || isPaddedEmptyBlock(schema, node));\n    };\n    var isListFragment = function (schema, fragment) {\n      var firstChild = fragment.firstChild;\n      var lastChild = fragment.lastChild;\n      if (firstChild && firstChild.name === 'meta') {\n        firstChild = firstChild.next;\n      }\n      if (lastChild && lastChild.attr('id') === 'mce_marker') {\n        lastChild = lastChild.prev;\n      }\n      if (isEmptyFragmentElement(schema, lastChild)) {\n        lastChild = lastChild.prev;\n      }\n      if (!firstChild || firstChild !== lastChild) {\n        return false;\n      }\n      return firstChild.name === 'ul' || firstChild.name === 'ol';\n    };\n    var cleanupDomFragment = function (domFragment) {\n      var firstChild = domFragment.firstChild;\n      var lastChild = domFragment.lastChild;\n      if (firstChild && firstChild.nodeName === 'META') {\n        firstChild.parentNode.removeChild(firstChild);\n      }\n      if (lastChild && lastChild.id === 'mce_marker') {\n        lastChild.parentNode.removeChild(lastChild);\n      }\n      return domFragment;\n    };\n    var toDomFragment = function (dom, serializer, fragment) {\n      var html = serializer.serialize(fragment);\n      var domFragment = dom.createFragment(html);\n      return cleanupDomFragment(domFragment);\n    };\n    var listItems$1 = function (elm) {\n      return Tools.grep(elm.childNodes, function (child) {\n        return child.nodeName === 'LI';\n      });\n    };\n    var isPadding = function (node) {\n      return node.data === nbsp || isBr(node);\n    };\n    var isListItemPadded = function (node) {\n      return node && node.firstChild && node.firstChild === node.lastChild && isPadding(node.firstChild);\n    };\n    var isEmptyOrPadded = function (elm) {\n      return !elm.firstChild || isListItemPadded(elm);\n    };\n    var trimListItems = function (elms) {\n      return elms.length > 0 && isEmptyOrPadded(elms[elms.length - 1]) ? elms.slice(0, -1) : elms;\n    };\n    var getParentLi = function (dom, node) {\n      var parentBlock = dom.getParent(node, dom.isBlock);\n      return parentBlock && parentBlock.nodeName === 'LI' ? parentBlock : null;\n    };\n    var isParentBlockLi = function (dom, node) {\n      return !!getParentLi(dom, node);\n    };\n    var getSplit = function (parentNode, rng) {\n      var beforeRng = rng.cloneRange();\n      var afterRng = rng.cloneRange();\n      beforeRng.setStartBefore(parentNode);\n      afterRng.setEndAfter(parentNode);\n      return [\n        beforeRng.cloneContents(),\n        afterRng.cloneContents()\n      ];\n    };\n    var findFirstIn = function (node, rootNode) {\n      var caretPos = CaretPosition$1.before(node);\n      var caretWalker = CaretWalker(rootNode);\n      var newCaretPos = caretWalker.next(caretPos);\n      return newCaretPos ? newCaretPos.toRange() : null;\n    };\n    var findLastOf = function (node, rootNode) {\n      var caretPos = CaretPosition$1.after(node);\n      var caretWalker = CaretWalker(rootNode);\n      var newCaretPos = caretWalker.prev(caretPos);\n      return newCaretPos ? newCaretPos.toRange() : null;\n    };\n    var insertMiddle = function (target, elms, rootNode, rng) {\n      var parts = getSplit(target, rng);\n      var parentElm = target.parentNode;\n      parentElm.insertBefore(parts[0], target);\n      Tools.each(elms, function (li) {\n        parentElm.insertBefore(li, target);\n      });\n      parentElm.insertBefore(parts[1], target);\n      parentElm.removeChild(target);\n      return findLastOf(elms[elms.length - 1], rootNode);\n    };\n    var insertBefore = function (target, elms, rootNode) {\n      var parentElm = target.parentNode;\n      Tools.each(elms, function (elm) {\n        parentElm.insertBefore(elm, target);\n      });\n      return findFirstIn(target, rootNode);\n    };\n    var insertAfter = function (target, elms, rootNode, dom) {\n      dom.insertAfter(elms.reverse(), target);\n      return findLastOf(elms[0], rootNode);\n    };\n    var insertAtCaret = function (serializer, dom, rng, fragment) {\n      var domFragment = toDomFragment(dom, serializer, fragment);\n      var liTarget = getParentLi(dom, rng.startContainer);\n      var liElms = trimListItems(listItems$1(domFragment.firstChild));\n      var BEGINNING = 1, END = 2;\n      var rootNode = dom.getRoot();\n      var isAt = function (location) {\n        var caretPos = CaretPosition$1.fromRangeStart(rng);\n        var caretWalker = CaretWalker(dom.getRoot());\n        var newPos = location === BEGINNING ? caretWalker.prev(caretPos) : caretWalker.next(caretPos);\n        return newPos ? getParentLi(dom, newPos.getNode()) !== liTarget : true;\n      };\n      if (isAt(BEGINNING)) {\n        return insertBefore(liTarget, liElms, rootNode);\n      } else if (isAt(END)) {\n        return insertAfter(liTarget, liElms, rootNode, dom);\n      }\n      return insertMiddle(liTarget, liElms, rootNode, rng);\n    };\n\n    var trimOrPadLeftRight = function (dom, rng, html) {\n      var root = SugarElement.fromDom(dom.getRoot());\n      if (needsToBeNbspLeft(root, CaretPosition$1.fromRangeStart(rng))) {\n        html = html.replace(/^ /, '&nbsp;');\n      } else {\n        html = html.replace(/^&nbsp;/, ' ');\n      }\n      if (needsToBeNbspRight(root, CaretPosition$1.fromRangeEnd(rng))) {\n        html = html.replace(/(&nbsp;| )(<br( \\/)>)?$/, '&nbsp;');\n      } else {\n        html = html.replace(/&nbsp;(<br( \\/)?>)?$/, ' ');\n      }\n      return html;\n    };\n\n    var isTableCell$4 = isTableCell;\n    var isTableCellContentSelected = function (dom, rng, cell) {\n      if (cell !== null) {\n        var endCell = dom.getParent(rng.endContainer, isTableCell$4);\n        return cell === endCell && hasAllContentsSelected(SugarElement.fromDom(cell), rng);\n      } else {\n        return false;\n      }\n    };\n    var validInsertion = function (editor, value, parentNode) {\n      if (parentNode.getAttribute('data-mce-bogus') === 'all') {\n        parentNode.parentNode.insertBefore(editor.dom.createFragment(value), parentNode);\n      } else {\n        var node = parentNode.firstChild;\n        var node2 = parentNode.lastChild;\n        if (!node || node === node2 && node.nodeName === 'BR') {\n          editor.dom.setHTML(parentNode, value);\n        } else {\n          editor.selection.setContent(value);\n        }\n      }\n    };\n    var trimBrsFromTableCell = function (dom, elm) {\n      Optional.from(dom.getParent(elm, 'td,th')).map(SugarElement.fromDom).each(trimBlockTrailingBr);\n    };\n    var reduceInlineTextElements = function (editor, merge) {\n      var textInlineElements = editor.schema.getTextInlineElements();\n      var dom = editor.dom;\n      if (merge) {\n        var root_1 = editor.getBody(), elementUtils_1 = new ElementUtils(dom);\n        Tools.each(dom.select('*[data-mce-fragment]'), function (node) {\n          for (var testNode = node.parentNode; testNode && testNode !== root_1; testNode = testNode.parentNode) {\n            if (textInlineElements[node.nodeName.toLowerCase()] && elementUtils_1.compare(testNode, node)) {\n              dom.remove(node, true);\n            }\n          }\n        });\n      }\n    };\n    var markFragmentElements = function (fragment) {\n      var node = fragment;\n      while (node = node.walk()) {\n        if (node.type === 1) {\n          node.attr('data-mce-fragment', '1');\n        }\n      }\n    };\n    var unmarkFragmentElements = function (elm) {\n      Tools.each(elm.getElementsByTagName('*'), function (elm) {\n        elm.removeAttribute('data-mce-fragment');\n      });\n    };\n    var isPartOfFragment = function (node) {\n      return !!node.getAttribute('data-mce-fragment');\n    };\n    var canHaveChildren = function (editor, node) {\n      return node && !editor.schema.getShortEndedElements()[node.nodeName];\n    };\n    var moveSelectionToMarker = function (editor, marker) {\n      var nextRng;\n      var dom = editor.dom, selection = editor.selection;\n      var node2;\n      var getContentEditableFalseParent = function (node) {\n        var root = editor.getBody();\n        for (; node && node !== root; node = node.parentNode) {\n          if (dom.getContentEditable(node) === 'false') {\n            return node;\n          }\n        }\n        return null;\n      };\n      if (!marker) {\n        return;\n      }\n      selection.scrollIntoView(marker);\n      var parentEditableFalseElm = getContentEditableFalseParent(marker);\n      if (parentEditableFalseElm) {\n        dom.remove(marker);\n        selection.select(parentEditableFalseElm);\n        return;\n      }\n      var rng = dom.createRng();\n      var node = marker.previousSibling;\n      if (node && node.nodeType === 3) {\n        rng.setStart(node, node.nodeValue.length);\n        if (!Env.ie) {\n          node2 = marker.nextSibling;\n          if (node2 && node2.nodeType === 3) {\n            node.appendData(node2.data);\n            node2.parentNode.removeChild(node2);\n          }\n        }\n      } else {\n        rng.setStartBefore(marker);\n        rng.setEndBefore(marker);\n      }\n      var findNextCaretRng = function (rng) {\n        var caretPos = CaretPosition$1.fromRangeStart(rng);\n        var caretWalker = CaretWalker(editor.getBody());\n        caretPos = caretWalker.next(caretPos);\n        if (caretPos) {\n          return caretPos.toRange();\n        }\n      };\n      var parentBlock = dom.getParent(marker, dom.isBlock);\n      dom.remove(marker);\n      if (parentBlock && dom.isEmpty(parentBlock)) {\n        editor.$(parentBlock).empty();\n        rng.setStart(parentBlock, 0);\n        rng.setEnd(parentBlock, 0);\n        if (!isTableCell$4(parentBlock) && !isPartOfFragment(parentBlock) && (nextRng = findNextCaretRng(rng))) {\n          rng = nextRng;\n          dom.remove(parentBlock);\n        } else {\n          dom.add(parentBlock, dom.create('br', { 'data-mce-bogus': '1' }));\n        }\n      }\n      selection.setRng(rng);\n    };\n    var deleteSelectedContent = function (editor) {\n      var dom = editor.dom;\n      var rng = normalize$2(editor.selection.getRng());\n      editor.selection.setRng(rng);\n      var startCell = dom.getParent(rng.startContainer, isTableCell$4);\n      if (isTableCellContentSelected(dom, rng, startCell)) {\n        deleteCellContents(editor, rng, SugarElement.fromDom(startCell));\n      } else {\n        editor.getDoc().execCommand('Delete', false, null);\n      }\n    };\n    var insertHtmlAtCaret = function (editor, value, details) {\n      var parentNode, rootNode, args;\n      var marker, rng, node;\n      var selection = editor.selection, dom = editor.dom;\n      if (/^ | $/.test(value)) {\n        value = trimOrPadLeftRight(dom, selection.getRng(), value);\n      }\n      var parser = editor.parser;\n      var merge = details.merge;\n      var serializer = HtmlSerializer({ validate: shouldValidate(editor) }, editor.schema);\n      var bookmarkHtml = '<span id=\"mce_marker\" data-mce-type=\"bookmark\">&#xFEFF;</span>';\n      args = {\n        content: value,\n        format: 'html',\n        selection: true,\n        paste: details.paste\n      };\n      args = editor.fire('BeforeSetContent', args);\n      if (args.isDefaultPrevented()) {\n        editor.fire('SetContent', {\n          content: args.content,\n          format: 'html',\n          selection: true,\n          paste: details.paste\n        });\n        return;\n      }\n      value = args.content;\n      if (value.indexOf('{$caret}') === -1) {\n        value += '{$caret}';\n      }\n      value = value.replace(/\\{\\$caret\\}/, bookmarkHtml);\n      rng = selection.getRng();\n      var caretElement = rng.startContainer || (rng.parentElement ? rng.parentElement() : null);\n      var body = editor.getBody();\n      if (caretElement === body && selection.isCollapsed()) {\n        if (dom.isBlock(body.firstChild) && canHaveChildren(editor, body.firstChild) && dom.isEmpty(body.firstChild)) {\n          rng = dom.createRng();\n          rng.setStart(body.firstChild, 0);\n          rng.setEnd(body.firstChild, 0);\n          selection.setRng(rng);\n        }\n      }\n      if (!selection.isCollapsed()) {\n        deleteSelectedContent(editor);\n      }\n      parentNode = selection.getNode();\n      var parserArgs = {\n        context: parentNode.nodeName.toLowerCase(),\n        data: details.data,\n        insert: true\n      };\n      var fragment = parser.parse(value, parserArgs);\n      if (details.paste === true && isListFragment(editor.schema, fragment) && isParentBlockLi(dom, parentNode)) {\n        rng = insertAtCaret(serializer, dom, selection.getRng(), fragment);\n        selection.setRng(rng);\n        editor.fire('SetContent', args);\n        return;\n      }\n      markFragmentElements(fragment);\n      node = fragment.lastChild;\n      if (node.attr('id') === 'mce_marker') {\n        marker = node;\n        for (node = node.prev; node; node = node.walk(true)) {\n          if (node.type === 3 || !dom.isBlock(node.name)) {\n            if (editor.schema.isValidChild(node.parent.name, 'span')) {\n              node.parent.insert(marker, node, node.name === 'br');\n            }\n            break;\n          }\n        }\n      }\n      editor._selectionOverrides.showBlockCaretContainer(parentNode);\n      if (!parserArgs.invalid) {\n        value = serializer.serialize(fragment);\n        validInsertion(editor, value, parentNode);\n      } else {\n        editor.selection.setContent(bookmarkHtml);\n        parentNode = selection.getNode();\n        rootNode = editor.getBody();\n        if (parentNode.nodeType === 9) {\n          parentNode = node = rootNode;\n        } else {\n          node = parentNode;\n        }\n        while (node !== rootNode) {\n          parentNode = node;\n          node = node.parentNode;\n        }\n        value = parentNode === rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);\n        value = serializer.serialize(parser.parse(value.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i, function () {\n          return serializer.serialize(fragment);\n        })));\n        if (parentNode === rootNode) {\n          dom.setHTML(rootNode, value);\n        } else {\n          dom.setOuterHTML(parentNode, value);\n        }\n      }\n      reduceInlineTextElements(editor, merge);\n      moveSelectionToMarker(editor, dom.get('mce_marker'));\n      unmarkFragmentElements(editor.getBody());\n      trimBrsFromTableCell(dom, selection.getStart());\n      editor.fire('SetContent', args);\n      editor.addVisual();\n    };\n\n    var traverse = function (node, fn) {\n      fn(node);\n      if (node.firstChild) {\n        traverse(node.firstChild, fn);\n      }\n      if (node.next) {\n        traverse(node.next, fn);\n      }\n    };\n    var findMatchingNodes = function (nodeFilters, attributeFilters, node) {\n      var nodeMatches = {};\n      var attrMatches = {};\n      var matches = [];\n      if (node.firstChild) {\n        traverse(node.firstChild, function (node) {\n          each(nodeFilters, function (filter) {\n            if (filter.name === node.name) {\n              if (nodeMatches[filter.name]) {\n                nodeMatches[filter.name].nodes.push(node);\n              } else {\n                nodeMatches[filter.name] = {\n                  filter: filter,\n                  nodes: [node]\n                };\n              }\n            }\n          });\n          each(attributeFilters, function (filter) {\n            if (typeof node.attr(filter.name) === 'string') {\n              if (attrMatches[filter.name]) {\n                attrMatches[filter.name].nodes.push(node);\n              } else {\n                attrMatches[filter.name] = {\n                  filter: filter,\n                  nodes: [node]\n                };\n              }\n            }\n          });\n        });\n      }\n      for (var name_1 in nodeMatches) {\n        if (nodeMatches.hasOwnProperty(name_1)) {\n          matches.push(nodeMatches[name_1]);\n        }\n      }\n      for (var name_2 in attrMatches) {\n        if (attrMatches.hasOwnProperty(name_2)) {\n          matches.push(attrMatches[name_2]);\n        }\n      }\n      return matches;\n    };\n    var filter$3 = function (nodeFilters, attributeFilters, node) {\n      var matches = findMatchingNodes(nodeFilters, attributeFilters, node);\n      each(matches, function (match) {\n        each(match.filter.callbacks, function (callback) {\n          callback(match.nodes, match.filter.name, {});\n        });\n      });\n    };\n\n    var defaultFormat = 'html';\n    var isTreeNode = function (content) {\n      return content instanceof AstNode;\n    };\n    var moveSelection = function (editor) {\n      if (hasFocus$1(editor)) {\n        firstPositionIn(editor.getBody()).each(function (pos) {\n          var node = pos.getNode();\n          var caretPos = isTable(node) ? firstPositionIn(node).getOr(pos) : pos;\n          editor.selection.setRng(caretPos.toRange());\n        });\n      }\n    };\n    var setEditorHtml = function (editor, html) {\n      editor.dom.setHTML(editor.getBody(), html);\n      moveSelection(editor);\n    };\n    var setContentString = function (editor, body, content, args) {\n      var forcedRootBlockName, padd;\n      if (content.length === 0 || /^\\s+$/.test(content)) {\n        padd = '<br data-mce-bogus=\"1\">';\n        if (body.nodeName === 'TABLE') {\n          content = '<tr><td>' + padd + '</td></tr>';\n        } else if (/^(UL|OL)$/.test(body.nodeName)) {\n          content = '<li>' + padd + '</li>';\n        }\n        forcedRootBlockName = getForcedRootBlock(editor);\n        if (forcedRootBlockName && editor.schema.isValidChild(body.nodeName.toLowerCase(), forcedRootBlockName.toLowerCase())) {\n          content = padd;\n          content = editor.dom.createHTML(forcedRootBlockName, getForcedRootBlockAttrs(editor), content);\n        } else if (!content) {\n          content = '<br data-mce-bogus=\"1\">';\n        }\n        setEditorHtml(editor, content);\n        editor.fire('SetContent', args);\n      } else {\n        if (args.format !== 'raw') {\n          content = HtmlSerializer({ validate: editor.validate }, editor.schema).serialize(editor.parser.parse(content, {\n            isRootContent: true,\n            insert: true\n          }));\n        }\n        args.content = isWsPreserveElement(SugarElement.fromDom(body)) ? content : Tools.trim(content);\n        setEditorHtml(editor, args.content);\n        if (!args.no_events) {\n          editor.fire('SetContent', args);\n        }\n      }\n      return args.content;\n    };\n    var setContentTree = function (editor, body, content, args) {\n      filter$3(editor.parser.getNodeFilters(), editor.parser.getAttributeFilters(), content);\n      var html = HtmlSerializer({ validate: editor.validate }, editor.schema).serialize(content);\n      args.content = isWsPreserveElement(SugarElement.fromDom(body)) ? html : Tools.trim(html);\n      setEditorHtml(editor, args.content);\n      if (!args.no_events) {\n        editor.fire('SetContent', args);\n      }\n      return content;\n    };\n    var setContentInternal = function (editor, content, args) {\n      args.format = args.format ? args.format : defaultFormat;\n      args.set = true;\n      args.content = isTreeNode(content) ? '' : content;\n      if (!args.no_events) {\n        editor.fire('BeforeSetContent', args);\n      }\n      if (!isTreeNode(content)) {\n        content = args.content;\n      }\n      return Optional.from(editor.getBody()).fold(constant(content), function (body) {\n        return isTreeNode(content) ? setContentTree(editor, body, content, args) : setContentString(editor, body, content, args);\n      });\n    };\n\n    var addVisualInternal = function (editor, elm) {\n      var dom = editor.dom;\n      var scope = isNonNullable(elm) ? elm : editor.getBody();\n      if (isUndefined(editor.hasVisual)) {\n        editor.hasVisual = isVisualAidsEnabled(editor);\n      }\n      each(dom.select('table,a', scope), function (matchedElm) {\n        switch (matchedElm.nodeName) {\n        case 'TABLE':\n          var cls = getVisualAidsTableClass(editor);\n          var value = dom.getAttrib(matchedElm, 'border');\n          if ((!value || value === '0') && editor.hasVisual) {\n            dom.addClass(matchedElm, cls);\n          } else {\n            dom.removeClass(matchedElm, cls);\n          }\n          break;\n        case 'A':\n          if (!dom.getAttrib(matchedElm, 'href')) {\n            var value_1 = dom.getAttrib(matchedElm, 'name') || matchedElm.id;\n            var cls_1 = getVisualAidsAnchorClass(editor);\n            if (value_1 && editor.hasVisual) {\n              dom.addClass(matchedElm, cls_1);\n            } else {\n              dom.removeClass(matchedElm, cls_1);\n            }\n          }\n          break;\n        }\n      });\n      editor.fire('VisualAid', {\n        element: elm,\n        hasVisual: editor.hasVisual\n      });\n    };\n\n    var sibling$2 = function (scope, predicate) {\n      return sibling(scope, predicate).isSome();\n    };\n\n    var ZWSP$1 = ZWSP, CARET_ID$1 = '_mce_caret';\n    var importNode = function (ownerDocument, node) {\n      return ownerDocument.importNode(node, true);\n    };\n    var getEmptyCaretContainers = function (node) {\n      var nodes = [];\n      while (node) {\n        if (node.nodeType === 3 && node.nodeValue !== ZWSP$1 || node.childNodes.length > 1) {\n          return [];\n        }\n        if (node.nodeType === 1) {\n          nodes.push(node);\n        }\n        node = node.firstChild;\n      }\n      return nodes;\n    };\n    var isCaretContainerEmpty = function (node) {\n      return getEmptyCaretContainers(node).length > 0;\n    };\n    var findFirstTextNode = function (node) {\n      if (node) {\n        var walker = new DomTreeWalker(node, node);\n        for (node = walker.current(); node; node = walker.next()) {\n          if (isText$1(node)) {\n            return node;\n          }\n        }\n      }\n      return null;\n    };\n    var createCaretContainer = function (fill) {\n      var caretContainer = SugarElement.fromTag('span');\n      setAll(caretContainer, {\n        'id': CARET_ID$1,\n        'data-mce-bogus': '1',\n        'data-mce-type': 'format-caret'\n      });\n      if (fill) {\n        append(caretContainer, SugarElement.fromText(ZWSP$1));\n      }\n      return caretContainer;\n    };\n    var trimZwspFromCaretContainer = function (caretContainerNode) {\n      var textNode = findFirstTextNode(caretContainerNode);\n      if (textNode && textNode.nodeValue.charAt(0) === ZWSP$1) {\n        textNode.deleteData(0, 1);\n      }\n      return textNode;\n    };\n    var removeCaretContainerNode = function (editor, node, moveCaret) {\n      if (moveCaret === void 0) {\n        moveCaret = true;\n      }\n      var dom = editor.dom, selection = editor.selection;\n      if (isCaretContainerEmpty(node)) {\n        deleteElement(editor, false, SugarElement.fromDom(node), moveCaret);\n      } else {\n        var rng = selection.getRng();\n        var block = dom.getParent(node, dom.isBlock);\n        var startContainer = rng.startContainer;\n        var startOffset = rng.startOffset;\n        var endContainer = rng.endContainer;\n        var endOffset = rng.endOffset;\n        var textNode = trimZwspFromCaretContainer(node);\n        dom.remove(node, true);\n        if (startContainer === textNode && startOffset > 0) {\n          rng.setStart(textNode, startOffset - 1);\n        }\n        if (endContainer === textNode && endOffset > 0) {\n          rng.setEnd(textNode, endOffset - 1);\n        }\n        if (block && dom.isEmpty(block)) {\n          fillWithPaddingBr(SugarElement.fromDom(block));\n        }\n        selection.setRng(rng);\n      }\n    };\n    var removeCaretContainer = function (editor, node, moveCaret) {\n      if (moveCaret === void 0) {\n        moveCaret = true;\n      }\n      var dom = editor.dom, selection = editor.selection;\n      if (!node) {\n        node = getParentCaretContainer(editor.getBody(), selection.getStart());\n        if (!node) {\n          while (node = dom.get(CARET_ID$1)) {\n            removeCaretContainerNode(editor, node, false);\n          }\n        }\n      } else {\n        removeCaretContainerNode(editor, node, moveCaret);\n      }\n    };\n    var insertCaretContainerNode = function (editor, caretContainer, formatNode) {\n      var dom = editor.dom, block = dom.getParent(formatNode, curry(isTextBlock$1, editor));\n      if (block && dom.isEmpty(block)) {\n        formatNode.parentNode.replaceChild(caretContainer, formatNode);\n      } else {\n        removeTrailingBr(SugarElement.fromDom(formatNode));\n        if (dom.isEmpty(formatNode)) {\n          formatNode.parentNode.replaceChild(caretContainer, formatNode);\n        } else {\n          dom.insertAfter(caretContainer, formatNode);\n        }\n      }\n    };\n    var appendNode = function (parentNode, node) {\n      parentNode.appendChild(node);\n      return node;\n    };\n    var insertFormatNodesIntoCaretContainer = function (formatNodes, caretContainer) {\n      var innerMostFormatNode = foldr(formatNodes, function (parentNode, formatNode) {\n        return appendNode(parentNode, formatNode.cloneNode(false));\n      }, caretContainer);\n      return appendNode(innerMostFormatNode, innerMostFormatNode.ownerDocument.createTextNode(ZWSP$1));\n    };\n    var cleanFormatNode = function (editor, caretContainer, formatNode, name, vars, similar) {\n      var formatter = editor.formatter;\n      var dom = editor.dom;\n      var validFormats = filter(keys(formatter.get()), function (formatName) {\n        return formatName !== name && !contains$1(formatName, 'removeformat');\n      });\n      var matchedFormats = matchAllOnNode(editor, formatNode, validFormats);\n      var uniqueFormats = filter(matchedFormats, function (fmtName) {\n        return !areSimilarFormats(editor, fmtName, name);\n      });\n      if (uniqueFormats.length > 0) {\n        var clonedFormatNode = formatNode.cloneNode(false);\n        dom.add(caretContainer, clonedFormatNode);\n        formatter.remove(name, vars, clonedFormatNode, similar);\n        dom.remove(clonedFormatNode);\n        return Optional.some(clonedFormatNode);\n      } else {\n        return Optional.none();\n      }\n    };\n    var applyCaretFormat = function (editor, name, vars) {\n      var caretContainer, textNode;\n      var selection = editor.selection;\n      var selectionRng = selection.getRng();\n      var offset = selectionRng.startOffset;\n      var container = selectionRng.startContainer;\n      var text = container.nodeValue;\n      caretContainer = getParentCaretContainer(editor.getBody(), selection.getStart());\n      if (caretContainer) {\n        textNode = findFirstTextNode(caretContainer);\n      }\n      var wordcharRegex = /[^\\s\\u00a0\\u00ad\\u200b\\ufeff]/;\n      if (text && offset > 0 && offset < text.length && wordcharRegex.test(text.charAt(offset)) && wordcharRegex.test(text.charAt(offset - 1))) {\n        var bookmark = selection.getBookmark();\n        selectionRng.collapse(true);\n        var rng = expandRng(editor, selectionRng, editor.formatter.get(name));\n        rng = split$1(rng);\n        editor.formatter.apply(name, vars, rng);\n        selection.moveToBookmark(bookmark);\n      } else {\n        if (!caretContainer || textNode.nodeValue !== ZWSP$1) {\n          caretContainer = importNode(editor.getDoc(), createCaretContainer(true).dom);\n          textNode = caretContainer.firstChild;\n          selectionRng.insertNode(caretContainer);\n          offset = 1;\n          editor.formatter.apply(name, vars, caretContainer);\n        } else {\n          editor.formatter.apply(name, vars, caretContainer);\n        }\n        selection.setCursorLocation(textNode, offset);\n      }\n    };\n    var removeCaretFormat = function (editor, name, vars, similar) {\n      var dom = editor.dom;\n      var selection = editor.selection;\n      var hasContentAfter, node, formatNode;\n      var parents = [];\n      var rng = selection.getRng();\n      var container = rng.startContainer;\n      var offset = rng.startOffset;\n      node = container;\n      if (container.nodeType === 3) {\n        if (offset !== container.nodeValue.length) {\n          hasContentAfter = true;\n        }\n        node = node.parentNode;\n      }\n      while (node) {\n        if (matchNode(editor, node, name, vars, similar)) {\n          formatNode = node;\n          break;\n        }\n        if (node.nextSibling) {\n          hasContentAfter = true;\n        }\n        parents.push(node);\n        node = node.parentNode;\n      }\n      if (!formatNode) {\n        return;\n      }\n      if (hasContentAfter) {\n        var bookmark = selection.getBookmark();\n        rng.collapse(true);\n        var expandedRng = expandRng(editor, rng, editor.formatter.get(name), true);\n        expandedRng = split$1(expandedRng);\n        editor.formatter.remove(name, vars, expandedRng, similar);\n        selection.moveToBookmark(bookmark);\n      } else {\n        var caretContainer = getParentCaretContainer(editor.getBody(), formatNode);\n        var newCaretContainer = createCaretContainer(false).dom;\n        insertCaretContainerNode(editor, newCaretContainer, caretContainer !== null ? caretContainer : formatNode);\n        var cleanedFormatNode = cleanFormatNode(editor, newCaretContainer, formatNode, name, vars, similar);\n        var caretTextNode = insertFormatNodesIntoCaretContainer(parents.concat(cleanedFormatNode.toArray()), newCaretContainer);\n        removeCaretContainerNode(editor, caretContainer, false);\n        selection.setCursorLocation(caretTextNode, 1);\n        if (dom.isEmpty(formatNode)) {\n          dom.remove(formatNode);\n        }\n      }\n    };\n    var disableCaretContainer = function (editor, keyCode) {\n      var selection = editor.selection, body = editor.getBody();\n      removeCaretContainer(editor, null, false);\n      if ((keyCode === 8 || keyCode === 46) && selection.isCollapsed() && selection.getStart().innerHTML === ZWSP$1) {\n        removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\n      }\n      if (keyCode === 37 || keyCode === 39) {\n        removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\n      }\n    };\n    var setup$3 = function (editor) {\n      editor.on('mouseup keydown', function (e) {\n        disableCaretContainer(editor, e.keyCode);\n      });\n    };\n    var replaceWithCaretFormat = function (targetNode, formatNodes) {\n      var caretContainer = createCaretContainer(false);\n      var innerMost = insertFormatNodesIntoCaretContainer(formatNodes, caretContainer.dom);\n      before(SugarElement.fromDom(targetNode), caretContainer);\n      remove(SugarElement.fromDom(targetNode));\n      return CaretPosition$1(innerMost, 0);\n    };\n    var isFormatElement = function (editor, element) {\n      var inlineElements = editor.schema.getTextInlineElements();\n      return inlineElements.hasOwnProperty(name(element)) && !isCaretNode(element.dom) && !isBogus(element.dom);\n    };\n    var isEmptyCaretFormatElement = function (element) {\n      return isCaretNode(element.dom) && isCaretContainerEmpty(element.dom);\n    };\n\n    var postProcessHooks = {};\n    var filter$4 = filter$2;\n    var each$8 = each$2;\n    var addPostProcessHook = function (name, hook) {\n      var hooks = postProcessHooks[name];\n      if (!hooks) {\n        postProcessHooks[name] = [];\n      }\n      postProcessHooks[name].push(hook);\n    };\n    var postProcess = function (name, editor) {\n      each$8(postProcessHooks[name], function (hook) {\n        hook(editor);\n      });\n    };\n    addPostProcessHook('pre', function (editor) {\n      var rng = editor.selection.getRng();\n      var blocks;\n      var hasPreSibling = function (pre) {\n        return isPre(pre.previousSibling) && indexOf$1(blocks, pre.previousSibling) !== -1;\n      };\n      var joinPre = function (pre1, pre2) {\n        DomQuery(pre2).remove();\n        DomQuery(pre1).append('<br><br>').append(pre2.childNodes);\n      };\n      var isPre = matchNodeNames(['pre']);\n      if (!rng.collapsed) {\n        blocks = editor.selection.getSelectedBlocks();\n        each$8(filter$4(filter$4(blocks, isPre), hasPreSibling), function (pre) {\n          joinPre(pre.previousSibling, pre);\n        });\n      }\n    });\n\n    var each$9 = Tools.each;\n    var isElementNode = function (node) {\n      return isElement$1(node) && !isBookmarkNode$1(node) && !isCaretNode(node) && !isBogus(node);\n    };\n    var findElementSibling = function (node, siblingName) {\n      var sibling;\n      for (sibling = node; sibling; sibling = sibling[siblingName]) {\n        if (isText$1(sibling) && sibling.nodeValue.length !== 0) {\n          return node;\n        }\n        if (isElement$1(sibling) && !isBookmarkNode$1(sibling)) {\n          return sibling;\n        }\n      }\n      return node;\n    };\n    var mergeSiblingsNodes = function (dom, prev, next) {\n      var sibling, tmpSibling;\n      var elementUtils = new ElementUtils(dom);\n      if (prev && next) {\n        prev = findElementSibling(prev, 'previousSibling');\n        next = findElementSibling(next, 'nextSibling');\n        if (elementUtils.compare(prev, next)) {\n          for (sibling = prev.nextSibling; sibling && sibling !== next;) {\n            tmpSibling = sibling;\n            sibling = sibling.nextSibling;\n            prev.appendChild(tmpSibling);\n          }\n          dom.remove(next);\n          Tools.each(Tools.grep(next.childNodes), function (node) {\n            prev.appendChild(node);\n          });\n          return prev;\n        }\n      }\n      return next;\n    };\n    var mergeSiblings = function (dom, format, vars, node) {\n      if (node && format.merge_siblings !== false) {\n        var newNode = mergeSiblingsNodes(dom, getNonWhiteSpaceSibling(node), node);\n        mergeSiblingsNodes(dom, newNode, getNonWhiteSpaceSibling(newNode, true));\n      }\n    };\n    var clearChildStyles = function (dom, format, node) {\n      if (format.clear_child_styles) {\n        var selector = format.links ? '*:not(a)' : '*';\n        each$9(dom.select(selector, node), function (node) {\n          if (isElementNode(node)) {\n            each$9(format.styles, function (value, name) {\n              dom.setStyle(node, name, '');\n            });\n          }\n        });\n      }\n    };\n    var processChildElements = function (node, filter, process) {\n      each$9(node.childNodes, function (node) {\n        if (isElementNode(node)) {\n          if (filter(node)) {\n            process(node);\n          }\n          if (node.hasChildNodes()) {\n            processChildElements(node, filter, process);\n          }\n        }\n      });\n    };\n    var unwrapEmptySpan = function (dom, node) {\n      if (node.nodeName === 'SPAN' && dom.getAttribs(node).length === 0) {\n        dom.remove(node, true);\n      }\n    };\n    var hasStyle = function (dom, name) {\n      return function (node) {\n        return !!(node && getStyle(dom, node, name));\n      };\n    };\n    var applyStyle = function (dom, name, value) {\n      return function (node) {\n        dom.setStyle(node, name, value);\n        if (node.getAttribute('style') === '') {\n          node.removeAttribute('style');\n        }\n        unwrapEmptySpan(dom, node);\n      };\n    };\n\n    var removeResult = Adt.generate([\n      { keep: [] },\n      { rename: ['name'] },\n      { removed: [] }\n    ]);\n    var MCE_ATTR_RE = /^(src|href|style)$/;\n    var each$a = Tools.each;\n    var isEq$3 = isEq;\n    var isTableCellOrRow = function (node) {\n      return /^(TR|TH|TD)$/.test(node.nodeName);\n    };\n    var isChildOfInlineParent = function (dom, node, parent) {\n      return dom.isChildOf(node, parent) && node !== parent && !dom.isBlock(parent);\n    };\n    var getContainer = function (ed, rng, start) {\n      var container, offset;\n      container = rng[start ? 'startContainer' : 'endContainer'];\n      offset = rng[start ? 'startOffset' : 'endOffset'];\n      if (isElement$1(container)) {\n        var lastIdx = container.childNodes.length - 1;\n        if (!start && offset) {\n          offset--;\n        }\n        container = container.childNodes[offset > lastIdx ? lastIdx : offset];\n      }\n      if (isText$1(container) && start && offset >= container.nodeValue.length) {\n        container = new DomTreeWalker(container, ed.getBody()).next() || container;\n      }\n      if (isText$1(container) && !start && offset === 0) {\n        container = new DomTreeWalker(container, ed.getBody()).prev() || container;\n      }\n      return container;\n    };\n    var normalizeTableSelection = function (node, start) {\n      var prop = start ? 'firstChild' : 'lastChild';\n      if (isTableCellOrRow(node) && node[prop]) {\n        var childNode = node[prop];\n        if (node.nodeName === 'TR') {\n          return childNode[prop] || childNode;\n        } else {\n          return childNode;\n        }\n      }\n      return node;\n    };\n    var wrap$2 = function (dom, node, name, attrs) {\n      var wrapper = dom.create(name, attrs);\n      node.parentNode.insertBefore(wrapper, node);\n      wrapper.appendChild(node);\n      return wrapper;\n    };\n    var wrapWithSiblings = function (dom, node, next, name, attrs) {\n      var start = SugarElement.fromDom(node);\n      var wrapper = SugarElement.fromDom(dom.create(name, attrs));\n      var siblings = next ? nextSiblings(start) : prevSiblings(start);\n      append$1(wrapper, siblings);\n      if (next) {\n        before(start, wrapper);\n        prepend(wrapper, start);\n      } else {\n        after(start, wrapper);\n        append(wrapper, start);\n      }\n      return wrapper.dom;\n    };\n    var matchName$1 = function (dom, node, format) {\n      if (isEq$3(node, format.inline)) {\n        return true;\n      }\n      if (isEq$3(node, format.block)) {\n        return true;\n      }\n      if (format.selector) {\n        return isElement$1(node) && dom.is(node, format.selector);\n      }\n    };\n    var isColorFormatAndAnchor = function (node, format) {\n      return format.links && node.nodeName === 'A';\n    };\n    var find$3 = function (dom, node, next, inc) {\n      node = getNonWhiteSpaceSibling(node, next, inc);\n      return !node || (node.nodeName === 'BR' || dom.isBlock(node));\n    };\n    var removeNode$1 = function (ed, node, format) {\n      var parentNode = node.parentNode;\n      var rootBlockElm;\n      var dom = ed.dom, forcedRootBlock = getForcedRootBlock(ed);\n      if (format.block) {\n        if (!forcedRootBlock) {\n          if (dom.isBlock(node) && !dom.isBlock(parentNode)) {\n            if (!find$3(dom, node, false) && !find$3(dom, node.firstChild, true, true)) {\n              node.insertBefore(dom.create('br'), node.firstChild);\n            }\n            if (!find$3(dom, node, true) && !find$3(dom, node.lastChild, false, true)) {\n              node.appendChild(dom.create('br'));\n            }\n          }\n        } else {\n          if (parentNode === dom.getRoot()) {\n            if (!format.list_block || !isEq$3(node, format.list_block)) {\n              each(from$1(node.childNodes), function (node) {\n                if (isValid(ed, forcedRootBlock, node.nodeName.toLowerCase())) {\n                  if (!rootBlockElm) {\n                    rootBlockElm = wrap$2(dom, node, forcedRootBlock);\n                    dom.setAttribs(rootBlockElm, ed.settings.forced_root_block_attrs);\n                  } else {\n                    rootBlockElm.appendChild(node);\n                  }\n                } else {\n                  rootBlockElm = 0;\n                }\n              });\n            }\n          }\n        }\n      }\n      if (format.selector && format.inline && !isEq$3(format.inline, node)) {\n        return;\n      }\n      dom.remove(node, true);\n    };\n    var removeFormatInternal = function (ed, format, vars, node, compareNode) {\n      var stylesModified;\n      var dom = ed.dom;\n      if (!matchName$1(dom, node, format) && !isColorFormatAndAnchor(node, format)) {\n        return removeResult.keep();\n      }\n      var elm = node;\n      if (format.inline && format.remove === 'all' && isArray(format.preserve_attributes)) {\n        var attrsToPreserve = filter(dom.getAttribs(elm), function (attr) {\n          return contains(format.preserve_attributes, attr.name.toLowerCase());\n        });\n        dom.removeAllAttribs(elm);\n        each(attrsToPreserve, function (attr) {\n          return dom.setAttrib(elm, attr.name, attr.value);\n        });\n        if (attrsToPreserve.length > 0) {\n          return removeResult.rename('span');\n        }\n      }\n      if (format.remove !== 'all') {\n        each$a(format.styles, function (value, name) {\n          value = normalizeStyleValue(dom, replaceVars(value, vars), name + '');\n          if (isNumber(name)) {\n            name = value;\n            compareNode = null;\n          }\n          if (format.remove_similar || (!compareNode || isEq$3(getStyle(dom, compareNode, name), value))) {\n            dom.setStyle(elm, name, '');\n          }\n          stylesModified = true;\n        });\n        if (stylesModified && dom.getAttrib(elm, 'style') === '') {\n          elm.removeAttribute('style');\n          elm.removeAttribute('data-mce-style');\n        }\n        each$a(format.attributes, function (value, name) {\n          var valueOut;\n          value = replaceVars(value, vars);\n          if (isNumber(name)) {\n            name = value;\n            compareNode = null;\n          }\n          if (format.remove_similar || (!compareNode || isEq$3(dom.getAttrib(compareNode, name), value))) {\n            if (name === 'class') {\n              value = dom.getAttrib(elm, name);\n              if (value) {\n                valueOut = '';\n                each(value.split(/\\s+/), function (cls) {\n                  if (/mce\\-\\w+/.test(cls)) {\n                    valueOut += (valueOut ? ' ' : '') + cls;\n                  }\n                });\n                if (valueOut) {\n                  dom.setAttrib(elm, name, valueOut);\n                  return;\n                }\n              }\n            }\n            if (name === 'class') {\n              elm.removeAttribute('className');\n            }\n            if (MCE_ATTR_RE.test(name)) {\n              elm.removeAttribute('data-mce-' + name);\n            }\n            elm.removeAttribute(name);\n          }\n        });\n        each$a(format.classes, function (value) {\n          value = replaceVars(value, vars);\n          if (!compareNode || dom.hasClass(compareNode, value)) {\n            dom.removeClass(elm, value);\n          }\n        });\n        var attrs = dom.getAttribs(elm);\n        for (var i = 0; i < attrs.length; i++) {\n          var attrName = attrs[i].nodeName;\n          if (attrName.indexOf('_') !== 0 && attrName.indexOf('data-') !== 0) {\n            return removeResult.keep();\n          }\n        }\n      }\n      if (format.remove !== 'none') {\n        removeNode$1(ed, elm, format);\n        return removeResult.removed();\n      }\n      return removeResult.keep();\n    };\n    var removeFormat = function (ed, format, vars, node, compareNode) {\n      return removeFormatInternal(ed, format, vars, node, compareNode).fold(never, function (newName) {\n        ed.dom.rename(node, newName);\n        return true;\n      }, always);\n    };\n    var findFormatRoot = function (editor, container, name, vars, similar) {\n      var formatRoot;\n      each(getParents$1(editor.dom, container.parentNode).reverse(), function (parent) {\n        if (!formatRoot && parent.id !== '_start' && parent.id !== '_end') {\n          var format = matchNode(editor, parent, name, vars, similar);\n          if (format && format.split !== false) {\n            formatRoot = parent;\n          }\n        }\n      });\n      return formatRoot;\n    };\n    var removeFormatFromClone = function (editor, format, vars, clone) {\n      return removeFormatInternal(editor, format, vars, clone, clone).fold(constant(clone), function (newName) {\n        var fragment = editor.dom.createFragment();\n        fragment.appendChild(clone);\n        return editor.dom.rename(clone, newName);\n      }, constant(null));\n    };\n    var wrapAndSplit = function (editor, formatList, formatRoot, container, target, split, format, vars) {\n      var clone, lastClone, firstClone;\n      var dom = editor.dom;\n      if (formatRoot) {\n        var formatRootParent = formatRoot.parentNode;\n        for (var parent_1 = container.parentNode; parent_1 && parent_1 !== formatRootParent; parent_1 = parent_1.parentNode) {\n          clone = dom.clone(parent_1, false);\n          for (var i = 0; i < formatList.length; i++) {\n            clone = removeFormatFromClone(editor, formatList[i], vars, clone);\n            if (clone === null) {\n              break;\n            }\n          }\n          if (clone) {\n            if (lastClone) {\n              clone.appendChild(lastClone);\n            }\n            if (!firstClone) {\n              firstClone = clone;\n            }\n            lastClone = clone;\n          }\n        }\n        if (split && (!format.mixed || !dom.isBlock(formatRoot))) {\n          container = dom.split(formatRoot, container);\n        }\n        if (lastClone) {\n          target.parentNode.insertBefore(lastClone, target);\n          firstClone.appendChild(target);\n          if (format.inline) {\n            mergeSiblings(dom, format, vars, lastClone);\n          }\n        }\n      }\n      return container;\n    };\n    var remove$6 = function (ed, name, vars, node, similar) {\n      var formatList = ed.formatter.get(name);\n      var format = formatList[0];\n      var contentEditable = true;\n      var dom = ed.dom;\n      var selection = ed.selection;\n      var splitToFormatRoot = function (container) {\n        var formatRoot = findFormatRoot(ed, container, name, vars, similar);\n        return wrapAndSplit(ed, formatList, formatRoot, container, container, true, format, vars);\n      };\n      var isRemoveBookmarkNode = function (node) {\n        return isBookmarkNode$1(node) && isElement$1(node) && (node.id === '_start' || node.id === '_end');\n      };\n      var process = function (node) {\n        var lastContentEditable, hasContentEditableState;\n        if (isElement$1(node) && dom.getContentEditable(node)) {\n          lastContentEditable = contentEditable;\n          contentEditable = dom.getContentEditable(node) === 'true';\n          hasContentEditableState = true;\n        }\n        var children = from$1(node.childNodes);\n        if (contentEditable && !hasContentEditableState) {\n          for (var i = 0; i < formatList.length; i++) {\n            if (removeFormat(ed, formatList[i], vars, node, node)) {\n              break;\n            }\n          }\n        }\n        if (format.deep) {\n          if (children.length) {\n            for (var i = 0; i < children.length; i++) {\n              process(children[i]);\n            }\n            if (hasContentEditableState) {\n              contentEditable = lastContentEditable;\n            }\n          }\n        }\n      };\n      var unwrap = function (start) {\n        var node = dom.get(start ? '_start' : '_end');\n        var out = node[start ? 'firstChild' : 'lastChild'];\n        if (isRemoveBookmarkNode(out)) {\n          out = out[start ? 'firstChild' : 'lastChild'];\n        }\n        if (isText$1(out) && out.data.length === 0) {\n          out = start ? node.previousSibling || node.nextSibling : node.nextSibling || node.previousSibling;\n        }\n        dom.remove(node, true);\n        return out;\n      };\n      var removeRngStyle = function (rng) {\n        var startContainer, endContainer;\n        var expandedRng = expandRng(ed, rng, formatList, rng.collapsed);\n        if (format.split) {\n          expandedRng = split$1(expandedRng);\n          startContainer = getContainer(ed, expandedRng, true);\n          endContainer = getContainer(ed, expandedRng);\n          if (startContainer !== endContainer) {\n            startContainer = normalizeTableSelection(startContainer, true);\n            endContainer = normalizeTableSelection(endContainer, false);\n            if (isChildOfInlineParent(dom, startContainer, endContainer)) {\n              var marker = Optional.from(startContainer.firstChild).getOr(startContainer);\n              splitToFormatRoot(wrapWithSiblings(dom, marker, true, 'span', {\n                'id': '_start',\n                'data-mce-type': 'bookmark'\n              }));\n              unwrap(true);\n              return;\n            }\n            if (isChildOfInlineParent(dom, endContainer, startContainer)) {\n              var marker = Optional.from(endContainer.lastChild).getOr(endContainer);\n              splitToFormatRoot(wrapWithSiblings(dom, marker, false, 'span', {\n                'id': '_end',\n                'data-mce-type': 'bookmark'\n              }));\n              unwrap(false);\n              return;\n            }\n            startContainer = wrap$2(dom, startContainer, 'span', {\n              'id': '_start',\n              'data-mce-type': 'bookmark'\n            });\n            endContainer = wrap$2(dom, endContainer, 'span', {\n              'id': '_end',\n              'data-mce-type': 'bookmark'\n            });\n            var newRng = dom.createRng();\n            newRng.setStartAfter(startContainer);\n            newRng.setEndBefore(endContainer);\n            walk$1(dom, newRng, function (nodes) {\n              each(nodes, function (n) {\n                if (!isBookmarkNode$1(n) && !isBookmarkNode$1(n.parentNode)) {\n                  splitToFormatRoot(n);\n                }\n              });\n            });\n            splitToFormatRoot(startContainer);\n            splitToFormatRoot(endContainer);\n            startContainer = unwrap(true);\n            endContainer = unwrap();\n          } else {\n            startContainer = endContainer = splitToFormatRoot(startContainer);\n          }\n          expandedRng.startContainer = startContainer.parentNode ? startContainer.parentNode : startContainer;\n          expandedRng.startOffset = dom.nodeIndex(startContainer);\n          expandedRng.endContainer = endContainer.parentNode ? endContainer.parentNode : endContainer;\n          expandedRng.endOffset = dom.nodeIndex(endContainer) + 1;\n        }\n        walk$1(dom, expandedRng, function (nodes) {\n          each(nodes, function (node) {\n            process(node);\n            var textDecorations = [\n              'underline',\n              'line-through',\n              'overline'\n            ];\n            each(textDecorations, function (decoration) {\n              if (isElement$1(node) && ed.dom.getStyle(node, 'text-decoration') === decoration && node.parentNode && getTextDecoration(dom, node.parentNode) === decoration) {\n                removeFormat(ed, {\n                  deep: false,\n                  exact: true,\n                  inline: 'span',\n                  styles: { textDecoration: decoration }\n                }, null, node);\n              }\n            });\n          });\n        });\n      };\n      if (node) {\n        if (isNode(node)) {\n          var rng = dom.createRng();\n          rng.setStartBefore(node);\n          rng.setEndAfter(node);\n          removeRngStyle(rng);\n        } else {\n          removeRngStyle(node);\n        }\n        return;\n      }\n      if (dom.getContentEditable(selection.getNode()) === 'false') {\n        node = selection.getNode();\n        for (var i = 0; i < formatList.length; i++) {\n          if (formatList[i].ceFalseOverride) {\n            if (removeFormat(ed, formatList[i], vars, node, node)) {\n              break;\n            }\n          }\n        }\n        return;\n      }\n      if (!selection.isCollapsed() || !format.inline || getCellsFromEditor(ed).length) {\n        preserve(selection, true, function () {\n          runOnRanges(ed, removeRngStyle);\n        });\n        if (format.inline && match(ed, name, vars, selection.getStart())) {\n          moveStart(dom, selection, selection.getRng());\n        }\n        ed.nodeChanged();\n      } else {\n        removeCaretFormat(ed, name, vars, similar);\n      }\n    };\n\n    var each$b = Tools.each;\n    var mergeTextDecorationsAndColor = function (dom, format, vars, node) {\n      var processTextDecorationsAndColor = function (n) {\n        if (n.nodeType === 1 && n.parentNode && n.parentNode.nodeType === 1) {\n          var textDecoration = getTextDecoration(dom, n.parentNode);\n          if (dom.getStyle(n, 'color') && textDecoration) {\n            dom.setStyle(n, 'text-decoration', textDecoration);\n          } else if (dom.getStyle(n, 'text-decoration') === textDecoration) {\n            dom.setStyle(n, 'text-decoration', null);\n          }\n        }\n      };\n      if (format.styles && (format.styles.color || format.styles.textDecoration)) {\n        Tools.walk(node, processTextDecorationsAndColor, 'childNodes');\n        processTextDecorationsAndColor(node);\n      }\n    };\n    var mergeBackgroundColorAndFontSize = function (dom, format, vars, node) {\n      if (format.styles && format.styles.backgroundColor) {\n        processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'backgroundColor', replaceVars(format.styles.backgroundColor, vars)));\n      }\n    };\n    var mergeSubSup = function (dom, format, vars, node) {\n      if (format.inline === 'sub' || format.inline === 'sup') {\n        processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'fontSize', ''));\n        dom.remove(dom.select(format.inline === 'sup' ? 'sub' : 'sup', node), true);\n      }\n    };\n    var mergeWithChildren = function (editor, formatList, vars, node) {\n      each$b(formatList, function (format) {\n        each$b(editor.dom.select(format.inline, node), function (child) {\n          if (!isElementNode(child)) {\n            return;\n          }\n          removeFormat(editor, format, vars, child, format.exact ? child : null);\n        });\n        clearChildStyles(editor.dom, format, node);\n      });\n    };\n    var mergeWithParents = function (editor, format, name, vars, node) {\n      if (matchNode(editor, node.parentNode, name, vars)) {\n        if (removeFormat(editor, format, vars, node)) {\n          return;\n        }\n      }\n      if (format.merge_with_parents) {\n        editor.dom.getParent(node.parentNode, function (parent) {\n          if (matchNode(editor, parent, name, vars)) {\n            removeFormat(editor, format, vars, node);\n            return true;\n          }\n        });\n      }\n    };\n\n    var each$c = Tools.each;\n    var hasFormatProperty = function (format, prop) {\n      return hasNonNullableKey(format, prop);\n    };\n    var isElementNode$1 = function (node) {\n      return node && node.nodeType === 1 && !isBookmarkNode$1(node) && !isCaretNode(node) && !isBogus(node);\n    };\n    var canFormatBR = function (editor, format, node, parentName) {\n      if (canFormatEmptyLines(editor) && isInlineFormat(format)) {\n        var validBRParentElements = __assign(__assign({}, editor.schema.getTextBlockElements()), {\n          td: {},\n          th: {},\n          li: {},\n          dt: {},\n          dd: {},\n          figcaption: {},\n          caption: {},\n          details: {},\n          summary: {}\n        });\n        var hasCaretNodeSibling = sibling$2(SugarElement.fromDom(node), function (sibling) {\n          return isCaretNode(sibling.dom);\n        });\n        return hasNonNullableKey(validBRParentElements, parentName) && isEmpty(SugarElement.fromDom(node.parentNode), false) && !hasCaretNodeSibling;\n      } else {\n        return false;\n      }\n    };\n    var applyFormat = function (ed, name, vars, node) {\n      var formatList = ed.formatter.get(name);\n      var format = formatList[0];\n      var isCollapsed = !node && ed.selection.isCollapsed();\n      var dom = ed.dom;\n      var selection = ed.selection;\n      var setElementFormat = function (elm, fmt) {\n        fmt = fmt || format;\n        if (elm) {\n          if (fmt.onformat) {\n            fmt.onformat(elm, fmt, vars, node);\n          }\n          each$c(fmt.styles, function (value, name) {\n            dom.setStyle(elm, name, replaceVars(value, vars));\n          });\n          if (fmt.styles) {\n            var styleVal = dom.getAttrib(elm, 'style');\n            if (styleVal) {\n              dom.setAttrib(elm, 'data-mce-style', styleVal);\n            }\n          }\n          each$c(fmt.attributes, function (value, name) {\n            dom.setAttrib(elm, name, replaceVars(value, vars));\n          });\n          each$c(fmt.classes, function (value) {\n            value = replaceVars(value, vars);\n            if (!dom.hasClass(elm, value)) {\n              dom.addClass(elm, value);\n            }\n          });\n        }\n      };\n      var applyNodeStyle = function (formatList, node) {\n        var found = false;\n        if (!isSelectorFormat(format)) {\n          return false;\n        }\n        each$c(formatList, function (format) {\n          if ('collapsed' in format && format.collapsed !== isCollapsed) {\n            return;\n          }\n          if (dom.is(node, format.selector) && !isCaretNode(node)) {\n            setElementFormat(node, format);\n            found = true;\n            return false;\n          }\n        });\n        return found;\n      };\n      var applyRngStyle = function (dom, rng, bookmark, nodeSpecific) {\n        var newWrappers = [];\n        var contentEditable = true;\n        var wrapName = format.inline || format.block;\n        var wrapElm = dom.create(wrapName);\n        setElementFormat(wrapElm);\n        walk$1(dom, rng, function (nodes) {\n          var currentWrapElm;\n          var process = function (node) {\n            var hasContentEditableState = false;\n            var lastContentEditable = contentEditable;\n            var nodeName = node.nodeName.toLowerCase();\n            var parentName = node.parentNode.nodeName.toLowerCase();\n            if (isElement$1(node) && dom.getContentEditable(node)) {\n              lastContentEditable = contentEditable;\n              contentEditable = dom.getContentEditable(node) === 'true';\n              hasContentEditableState = true;\n            }\n            if (isBr(node) && !canFormatBR(ed, format, node, parentName)) {\n              currentWrapElm = null;\n              if (isBlockFormat(format)) {\n                dom.remove(node);\n              }\n              return;\n            }\n            if (format.wrapper && matchNode(ed, node, name, vars)) {\n              currentWrapElm = null;\n              return;\n            }\n            if (contentEditable && !hasContentEditableState && isBlockFormat(format) && !format.wrapper && isTextBlock$1(ed, nodeName) && isValid(ed, parentName, wrapName)) {\n              var elm = dom.rename(node, wrapName);\n              setElementFormat(elm);\n              newWrappers.push(elm);\n              currentWrapElm = null;\n              return;\n            }\n            if (isSelectorFormat(format)) {\n              var found = applyNodeStyle(formatList, node);\n              if (!hasFormatProperty(format, 'inline') || found) {\n                currentWrapElm = null;\n                return;\n              }\n            }\n            if (contentEditable && !hasContentEditableState && isValid(ed, wrapName, nodeName) && isValid(ed, parentName, wrapName) && !(!nodeSpecific && node.nodeType === 3 && node.nodeValue.length === 1 && node.nodeValue.charCodeAt(0) === 65279) && !isCaretNode(node) && (!hasFormatProperty(format, 'inline') || !dom.isBlock(node))) {\n              if (!currentWrapElm) {\n                currentWrapElm = dom.clone(wrapElm, false);\n                node.parentNode.insertBefore(currentWrapElm, node);\n                newWrappers.push(currentWrapElm);\n              }\n              currentWrapElm.appendChild(node);\n            } else {\n              currentWrapElm = null;\n              each$c(Tools.grep(node.childNodes), process);\n              if (hasContentEditableState) {\n                contentEditable = lastContentEditable;\n              }\n              currentWrapElm = null;\n            }\n          };\n          each$c(nodes, process);\n        });\n        if (format.links === true) {\n          each$c(newWrappers, function (node) {\n            var process = function (node) {\n              if (node.nodeName === 'A') {\n                setElementFormat(node, format);\n              }\n              each$c(Tools.grep(node.childNodes), process);\n            };\n            process(node);\n          });\n        }\n        each$c(newWrappers, function (node) {\n          var getChildCount = function (node) {\n            var count = 0;\n            each$c(node.childNodes, function (node) {\n              if (!isEmptyTextNode(node) && !isBookmarkNode$1(node)) {\n                count++;\n              }\n            });\n            return count;\n          };\n          var getChildElementNode = function (root) {\n            var child = false;\n            each$c(root.childNodes, function (node) {\n              if (isElementNode$1(node)) {\n                child = node;\n                return false;\n              }\n            });\n            return child;\n          };\n          var mergeStyles = function (node) {\n            var clone;\n            var child = getChildElementNode(node);\n            if (child && !isBookmarkNode$1(child) && matchName(dom, child, format)) {\n              clone = dom.clone(child, false);\n              setElementFormat(clone);\n              dom.replace(clone, node, true);\n              dom.remove(child, true);\n            }\n            return clone || node;\n          };\n          var childCount = getChildCount(node);\n          if ((newWrappers.length > 1 || !dom.isBlock(node)) && childCount === 0) {\n            dom.remove(node, true);\n            return;\n          }\n          if (isInlineFormat(format) || format.wrapper) {\n            if (!format.exact && childCount === 1) {\n              node = mergeStyles(node);\n            }\n            mergeWithChildren(ed, formatList, vars, node);\n            mergeWithParents(ed, format, name, vars, node);\n            mergeBackgroundColorAndFontSize(dom, format, vars, node);\n            mergeTextDecorationsAndColor(dom, format, vars, node);\n            mergeSubSup(dom, format, vars, node);\n            mergeSiblings(dom, format, vars, node);\n          }\n        });\n      };\n      if (dom.getContentEditable(selection.getNode()) === 'false') {\n        node = selection.getNode();\n        for (var i = 0, l = formatList.length; i < l; i++) {\n          var formatItem = formatList[i];\n          if (formatItem.ceFalseOverride && isSelectorFormat(formatItem) && dom.is(node, formatItem.selector)) {\n            setElementFormat(node, formatItem);\n            return;\n          }\n        }\n        return;\n      }\n      if (format) {\n        if (node) {\n          if (isNode(node)) {\n            if (!applyNodeStyle(formatList, node)) {\n              var rng = dom.createRng();\n              rng.setStartBefore(node);\n              rng.setEndAfter(node);\n              applyRngStyle(dom, expandRng(ed, rng, formatList), null, true);\n            }\n          } else {\n            applyRngStyle(dom, node, null, true);\n          }\n        } else {\n          if (!isCollapsed || !isInlineFormat(format) || getCellsFromEditor(ed).length) {\n            var curSelNode = selection.getNode();\n            var firstFormat = formatList[0];\n            if (!ed.settings.forced_root_block && firstFormat.defaultBlock && !dom.getParent(curSelNode, dom.isBlock)) {\n              applyFormat(ed, firstFormat.defaultBlock);\n            }\n            selection.setRng(normalize$2(selection.getRng()));\n            preserve(selection, true, function (bookmark) {\n              runOnRanges(ed, function (selectionRng, fake) {\n                var expandedRng = fake ? selectionRng : expandRng(ed, selectionRng, formatList);\n                applyRngStyle(dom, expandedRng);\n              });\n            });\n            moveStart(dom, selection, selection.getRng());\n            ed.nodeChanged();\n          } else {\n            applyCaretFormat(ed, name, vars);\n          }\n        }\n        postProcess(name, ed);\n      }\n    };\n\n    var setup$4 = function (registeredFormatListeners, editor) {\n      var currentFormats = Cell({});\n      registeredFormatListeners.set({});\n      editor.on('NodeChange', function (e) {\n        updateAndFireChangeCallbacks(editor, e.element, currentFormats, registeredFormatListeners.get());\n      });\n    };\n    var updateAndFireChangeCallbacks = function (editor, elm, currentFormats, formatChangeData) {\n      var formatsList = keys(currentFormats.get());\n      var newFormats = {};\n      var matchedFormats = {};\n      var parents = filter(getParents$1(editor.dom, elm), function (node) {\n        return node.nodeType === 1 && !node.getAttribute('data-mce-bogus');\n      });\n      each$1(formatChangeData, function (data, format) {\n        Tools.each(parents, function (node) {\n          if (editor.formatter.matchNode(node, format, {}, data.similar)) {\n            if (formatsList.indexOf(format) === -1) {\n              each(data.callbacks, function (callback) {\n                callback(true, {\n                  node: node,\n                  format: format,\n                  parents: parents\n                });\n              });\n              newFormats[format] = data.callbacks;\n            }\n            matchedFormats[format] = data.callbacks;\n            return false;\n          }\n          if (matchesUnInheritedFormatSelector(editor, node, format)) {\n            return false;\n          }\n        });\n      });\n      var remainingFormats = filterRemainingFormats(currentFormats.get(), matchedFormats, elm, parents);\n      currentFormats.set(__assign(__assign({}, newFormats), remainingFormats));\n    };\n    var filterRemainingFormats = function (currentFormats, matchedFormats, elm, parents) {\n      return bifilter(currentFormats, function (callbacks, format) {\n        if (!has(matchedFormats, format)) {\n          each(callbacks, function (callback) {\n            callback(false, {\n              node: elm,\n              format: format,\n              parents: parents\n            });\n          });\n          return false;\n        } else {\n          return true;\n        }\n      }).t;\n    };\n    var addListeners = function (registeredFormatListeners, formats, callback, similar) {\n      var formatChangeItems = registeredFormatListeners.get();\n      each(formats.split(','), function (format) {\n        if (!formatChangeItems[format]) {\n          formatChangeItems[format] = {\n            similar: similar,\n            callbacks: []\n          };\n        }\n        formatChangeItems[format].callbacks.push(callback);\n      });\n      registeredFormatListeners.set(formatChangeItems);\n    };\n    var removeListeners = function (registeredFormatListeners, formats, callback) {\n      var formatChangeItems = registeredFormatListeners.get();\n      each(formats.split(','), function (format) {\n        formatChangeItems[format].callbacks = filter(formatChangeItems[format].callbacks, function (c) {\n          return c !== callback;\n        });\n        if (formatChangeItems[format].callbacks.length === 0) {\n          delete formatChangeItems[format];\n        }\n      });\n      registeredFormatListeners.set(formatChangeItems);\n    };\n    var formatChangedInternal = function (editor, registeredFormatListeners, formats, callback, similar) {\n      if (registeredFormatListeners.get() === null) {\n        setup$4(registeredFormatListeners, editor);\n      }\n      addListeners(registeredFormatListeners, formats, callback, similar);\n      return {\n        unbind: function () {\n          return removeListeners(registeredFormatListeners, formats, callback);\n        }\n      };\n    };\n\n    var toggle = function (editor, name, vars, node) {\n      var fmt = editor.formatter.get(name);\n      if (match(editor, name, vars, node) && (!('toggle' in fmt[0]) || fmt[0].toggle)) {\n        remove$6(editor, name, vars, node);\n      } else {\n        applyFormat(editor, name, vars, node);\n      }\n    };\n\n    var fromElements = function (elements, scope) {\n      var doc = scope || document;\n      var fragment = doc.createDocumentFragment();\n      each(elements, function (element) {\n        fragment.appendChild(element.dom);\n      });\n      return SugarElement.fromDom(fragment);\n    };\n\n    var tableModel = function (element, width, rows) {\n      return {\n        element: element,\n        width: width,\n        rows: rows\n      };\n    };\n    var tableRow = function (element, cells) {\n      return {\n        element: element,\n        cells: cells\n      };\n    };\n    var cellPosition = function (x, y) {\n      return {\n        x: x,\n        y: y\n      };\n    };\n    var getSpan = function (td, key) {\n      var value = parseInt(get$4(td, key), 10);\n      return isNaN(value) ? 1 : value;\n    };\n    var fillout = function (table, x, y, tr, td) {\n      var rowspan = getSpan(td, 'rowspan');\n      var colspan = getSpan(td, 'colspan');\n      var rows = table.rows;\n      for (var y2 = y; y2 < y + rowspan; y2++) {\n        if (!rows[y2]) {\n          rows[y2] = tableRow(deep(tr), []);\n        }\n        for (var x2 = x; x2 < x + colspan; x2++) {\n          var cells = rows[y2].cells;\n          cells[x2] = y2 === y && x2 === x ? td : shallow(td);\n        }\n      }\n    };\n    var cellExists = function (table, x, y) {\n      var rows = table.rows;\n      var cells = rows[y] ? rows[y].cells : [];\n      return !!cells[x];\n    };\n    var skipCellsX = function (table, x, y) {\n      while (cellExists(table, x, y)) {\n        x++;\n      }\n      return x;\n    };\n    var getWidth = function (rows) {\n      return foldl(rows, function (acc, row) {\n        return row.cells.length > acc ? row.cells.length : acc;\n      }, 0);\n    };\n    var findElementPos = function (table, element) {\n      var rows = table.rows;\n      for (var y = 0; y < rows.length; y++) {\n        var cells = rows[y].cells;\n        for (var x = 0; x < cells.length; x++) {\n          if (eq$2(cells[x], element)) {\n            return Optional.some(cellPosition(x, y));\n          }\n        }\n      }\n      return Optional.none();\n    };\n    var extractRows = function (table, sx, sy, ex, ey) {\n      var newRows = [];\n      var rows = table.rows;\n      for (var y = sy; y <= ey; y++) {\n        var cells = rows[y].cells;\n        var slice = sx < ex ? cells.slice(sx, ex + 1) : cells.slice(ex, sx + 1);\n        newRows.push(tableRow(rows[y].element, slice));\n      }\n      return newRows;\n    };\n    var subTable = function (table, startPos, endPos) {\n      var sx = startPos.x, sy = startPos.y;\n      var ex = endPos.x, ey = endPos.y;\n      var newRows = sy < ey ? extractRows(table, sx, sy, ex, ey) : extractRows(table, sx, ey, ex, sy);\n      return tableModel(table.element, getWidth(newRows), newRows);\n    };\n    var createDomTable = function (table, rows) {\n      var tableElement = shallow(table.element);\n      var tableBody = SugarElement.fromTag('tbody');\n      append$1(tableBody, rows);\n      append(tableElement, tableBody);\n      return tableElement;\n    };\n    var modelRowsToDomRows = function (table) {\n      return map(table.rows, function (row) {\n        var cells = map(row.cells, function (cell) {\n          var td = deep(cell);\n          remove$1(td, 'colspan');\n          remove$1(td, 'rowspan');\n          return td;\n        });\n        var tr = shallow(row.element);\n        append$1(tr, cells);\n        return tr;\n      });\n    };\n    var fromDom$1 = function (tableElm) {\n      var table = tableModel(shallow(tableElm), 0, []);\n      each(descendants$1(tableElm, 'tr'), function (tr, y) {\n        each(descendants$1(tr, 'td,th'), function (td, x) {\n          fillout(table, skipCellsX(table, x, y), y, tr, td);\n        });\n      });\n      return tableModel(table.element, getWidth(table.rows), table.rows);\n    };\n    var toDom = function (table) {\n      return createDomTable(table, modelRowsToDomRows(table));\n    };\n    var subsection = function (table, startElement, endElement) {\n      return findElementPos(table, startElement).bind(function (startPos) {\n        return findElementPos(table, endElement).map(function (endPos) {\n          return subTable(table, startPos, endPos);\n        });\n      });\n    };\n\n    var findParentListContainer = function (parents) {\n      return find(parents, function (elm) {\n        return name(elm) === 'ul' || name(elm) === 'ol';\n      });\n    };\n    var getFullySelectedListWrappers = function (parents, rng) {\n      return find(parents, function (elm) {\n        return name(elm) === 'li' && hasAllContentsSelected(elm, rng);\n      }).fold(constant([]), function (_li) {\n        return findParentListContainer(parents).map(function (listCont) {\n          var listElm = SugarElement.fromTag(name(listCont));\n          var listStyles = filter$1(getAllRaw(listCont), function (_style, name) {\n            return startsWith(name, 'list-style');\n          });\n          setAll$1(listElm, listStyles);\n          return [\n            SugarElement.fromTag('li'),\n            listElm\n          ];\n        }).getOr([]);\n      });\n    };\n    var wrap$3 = function (innerElm, elms) {\n      var wrapped = foldl(elms, function (acc, elm) {\n        append(elm, acc);\n        return elm;\n      }, innerElm);\n      return elms.length > 0 ? fromElements([wrapped]) : wrapped;\n    };\n    var directListWrappers = function (commonAnchorContainer) {\n      if (isListItem(commonAnchorContainer)) {\n        return parent(commonAnchorContainer).filter(isList).fold(constant([]), function (listElm) {\n          return [\n            commonAnchorContainer,\n            listElm\n          ];\n        });\n      } else {\n        return isList(commonAnchorContainer) ? [commonAnchorContainer] : [];\n      }\n    };\n    var getWrapElements = function (rootNode, rng) {\n      var commonAnchorContainer = SugarElement.fromDom(rng.commonAncestorContainer);\n      var parents = parentsAndSelf(commonAnchorContainer, rootNode);\n      var wrapElements = filter(parents, function (elm) {\n        return isInline(elm) || isHeading(elm);\n      });\n      var listWrappers = getFullySelectedListWrappers(parents, rng);\n      var allWrappers = wrapElements.concat(listWrappers.length ? listWrappers : directListWrappers(commonAnchorContainer));\n      return map(allWrappers, shallow);\n    };\n    var emptyFragment = function () {\n      return fromElements([]);\n    };\n    var getFragmentFromRange = function (rootNode, rng) {\n      return wrap$3(SugarElement.fromDom(rng.cloneContents()), getWrapElements(rootNode, rng));\n    };\n    var getParentTable = function (rootElm, cell) {\n      return ancestor$1(cell, 'table', curry(eq$2, rootElm));\n    };\n    var getTableFragment = function (rootNode, selectedTableCells) {\n      return getParentTable(rootNode, selectedTableCells[0]).bind(function (tableElm) {\n        var firstCell = selectedTableCells[0];\n        var lastCell = selectedTableCells[selectedTableCells.length - 1];\n        var fullTableModel = fromDom$1(tableElm);\n        return subsection(fullTableModel, firstCell, lastCell).map(function (sectionedTableModel) {\n          return fromElements([toDom(sectionedTableModel)]);\n        });\n      }).getOrThunk(emptyFragment);\n    };\n    var getSelectionFragment = function (rootNode, ranges) {\n      return ranges.length > 0 && ranges[0].collapsed ? emptyFragment() : getFragmentFromRange(rootNode, ranges[0]);\n    };\n    var read$1 = function (rootNode, ranges) {\n      var selectedCells = getCellsFromElementOrRanges(ranges, rootNode);\n      return selectedCells.length > 0 ? getTableFragment(rootNode, selectedCells) : getSelectionFragment(rootNode, ranges);\n    };\n\n    var trimLeadingCollapsibleText = function (text) {\n      return text.replace(/^[ \\f\\n\\r\\t\\v]+/, '');\n    };\n    var isCollapsibleWhitespace = function (text, index) {\n      return index >= 0 && index < text.length && isWhiteSpace$1(text.charAt(index));\n    };\n    var getInnerText = function (bin, shouldTrim) {\n      var text = trim$2(bin.innerText);\n      return shouldTrim ? trimLeadingCollapsibleText(text) : text;\n    };\n    var getContextNodeName = function (parentBlockOpt) {\n      return parentBlockOpt.map(function (block) {\n        return block.nodeName;\n      }).getOr('div').toLowerCase();\n    };\n    var getTextContent = function (editor) {\n      return Optional.from(editor.selection.getRng()).map(function (rng) {\n        var parentBlockOpt = Optional.from(editor.dom.getParent(rng.commonAncestorContainer, editor.dom.isBlock));\n        var body = editor.getBody();\n        var contextNodeName = getContextNodeName(parentBlockOpt);\n        var shouldTrimSpaces = Env.browser.isIE() && contextNodeName !== 'pre';\n        var bin = editor.dom.add(body, contextNodeName, {\n          'data-mce-bogus': 'all',\n          'style': 'overflow: hidden; opacity: 0;'\n        }, rng.cloneContents());\n        var text = getInnerText(bin, shouldTrimSpaces);\n        var nonRenderedText = trim$2(bin.textContent);\n        editor.dom.remove(bin);\n        if (isCollapsibleWhitespace(nonRenderedText, 0) || isCollapsibleWhitespace(nonRenderedText, nonRenderedText.length - 1)) {\n          var parentBlock = parentBlockOpt.getOr(body);\n          var parentBlockText = getInnerText(parentBlock, shouldTrimSpaces);\n          var textIndex = parentBlockText.indexOf(text);\n          if (textIndex === -1) {\n            return text;\n          } else {\n            var hasProceedingSpace = isCollapsibleWhitespace(parentBlockText, textIndex - 1);\n            var hasTrailingSpace = isCollapsibleWhitespace(parentBlockText, textIndex + text.length);\n            return (hasProceedingSpace ? ' ' : '') + text + (hasTrailingSpace ? ' ' : '');\n          }\n        } else {\n          return text;\n        }\n      }).getOr('');\n    };\n    var getSerializedContent = function (editor, args) {\n      var rng = editor.selection.getRng(), tmpElm = editor.dom.create('body');\n      var sel = editor.selection.getSel();\n      var ranges = processRanges(editor, getRanges(sel));\n      var fragment = args.contextual ? read$1(SugarElement.fromDom(editor.getBody()), ranges).dom : rng.cloneContents();\n      if (fragment) {\n        tmpElm.appendChild(fragment);\n      }\n      return editor.selection.serializer.serialize(tmpElm, args);\n    };\n    var getSelectedContentInternal = function (editor, format, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      args.get = true;\n      args.format = format;\n      args.selection = true;\n      args = editor.fire('BeforeGetContent', args);\n      if (args.isDefaultPrevented()) {\n        editor.fire('GetContent', args);\n        return args.content;\n      }\n      if (args.format === 'text') {\n        return getTextContent(editor);\n      } else {\n        args.getInner = true;\n        var content = getSerializedContent(editor, args);\n        if (args.format === 'tree') {\n          return content;\n        } else {\n          args.content = editor.selection.isCollapsed() ? '' : content;\n          editor.fire('GetContent', args);\n          return args.content;\n        }\n      }\n    };\n\n    var KEEP = 0, INSERT = 1, DELETE = 2;\n    var diff = function (left, right) {\n      var size = left.length + right.length + 2;\n      var vDown = new Array(size);\n      var vUp = new Array(size);\n      var snake = function (start, end, diag) {\n        return {\n          start: start,\n          end: end,\n          diag: diag\n        };\n      };\n      var buildScript = function (start1, end1, start2, end2, script) {\n        var middle = getMiddleSnake(start1, end1, start2, end2);\n        if (middle === null || middle.start === end1 && middle.diag === end1 - end2 || middle.end === start1 && middle.diag === start1 - start2) {\n          var i = start1;\n          var j = start2;\n          while (i < end1 || j < end2) {\n            if (i < end1 && j < end2 && left[i] === right[j]) {\n              script.push([\n                KEEP,\n                left[i]\n              ]);\n              ++i;\n              ++j;\n            } else {\n              if (end1 - start1 > end2 - start2) {\n                script.push([\n                  DELETE,\n                  left[i]\n                ]);\n                ++i;\n              } else {\n                script.push([\n                  INSERT,\n                  right[j]\n                ]);\n                ++j;\n              }\n            }\n          }\n        } else {\n          buildScript(start1, middle.start, start2, middle.start - middle.diag, script);\n          for (var i2 = middle.start; i2 < middle.end; ++i2) {\n            script.push([\n              KEEP,\n              left[i2]\n            ]);\n          }\n          buildScript(middle.end, end1, middle.end - middle.diag, end2, script);\n        }\n      };\n      var buildSnake = function (start, diag, end1, end2) {\n        var end = start;\n        while (end - diag < end2 && end < end1 && left[end] === right[end - diag]) {\n          ++end;\n        }\n        return snake(start, end, diag);\n      };\n      var getMiddleSnake = function (start1, end1, start2, end2) {\n        var m = end1 - start1;\n        var n = end2 - start2;\n        if (m === 0 || n === 0) {\n          return null;\n        }\n        var delta = m - n;\n        var sum = n + m;\n        var offset = (sum % 2 === 0 ? sum : sum + 1) / 2;\n        vDown[1 + offset] = start1;\n        vUp[1 + offset] = end1 + 1;\n        var d, k, i, x, y;\n        for (d = 0; d <= offset; ++d) {\n          for (k = -d; k <= d; k += 2) {\n            i = k + offset;\n            if (k === -d || k !== d && vDown[i - 1] < vDown[i + 1]) {\n              vDown[i] = vDown[i + 1];\n            } else {\n              vDown[i] = vDown[i - 1] + 1;\n            }\n            x = vDown[i];\n            y = x - start1 + start2 - k;\n            while (x < end1 && y < end2 && left[x] === right[y]) {\n              vDown[i] = ++x;\n              ++y;\n            }\n            if (delta % 2 !== 0 && delta - d <= k && k <= delta + d) {\n              if (vUp[i - delta] <= vDown[i]) {\n                return buildSnake(vUp[i - delta], k + start1 - start2, end1, end2);\n              }\n            }\n          }\n          for (k = delta - d; k <= delta + d; k += 2) {\n            i = k + offset - delta;\n            if (k === delta - d || k !== delta + d && vUp[i + 1] <= vUp[i - 1]) {\n              vUp[i] = vUp[i + 1] - 1;\n            } else {\n              vUp[i] = vUp[i - 1];\n            }\n            x = vUp[i] - 1;\n            y = x - start1 + start2 - k;\n            while (x >= start1 && y >= start2 && left[x] === right[y]) {\n              vUp[i] = x--;\n              y--;\n            }\n            if (delta % 2 === 0 && -d <= k && k <= d) {\n              if (vUp[i] <= vDown[i + delta]) {\n                return buildSnake(vUp[i], k + start1 - start2, end1, end2);\n              }\n            }\n          }\n        }\n      };\n      var script = [];\n      buildScript(0, left.length, 0, right.length, script);\n      return script;\n    };\n\n    var getOuterHtml = function (elm) {\n      if (isElement$1(elm)) {\n        return elm.outerHTML;\n      } else if (isText$1(elm)) {\n        return Entities.encodeRaw(elm.data, false);\n      } else if (isComment$1(elm)) {\n        return '<!--' + elm.data + '-->';\n      }\n      return '';\n    };\n    var createFragment$1 = function (html) {\n      var node;\n      var container = document.createElement('div');\n      var frag = document.createDocumentFragment();\n      if (html) {\n        container.innerHTML = html;\n      }\n      while (node = container.firstChild) {\n        frag.appendChild(node);\n      }\n      return frag;\n    };\n    var insertAt = function (elm, html, index) {\n      var fragment = createFragment$1(html);\n      if (elm.hasChildNodes() && index < elm.childNodes.length) {\n        var target = elm.childNodes[index];\n        target.parentNode.insertBefore(fragment, target);\n      } else {\n        elm.appendChild(fragment);\n      }\n    };\n    var removeAt = function (elm, index) {\n      if (elm.hasChildNodes() && index < elm.childNodes.length) {\n        var target = elm.childNodes[index];\n        target.parentNode.removeChild(target);\n      }\n    };\n    var applyDiff = function (diff, elm) {\n      var index = 0;\n      each(diff, function (action) {\n        if (action[0] === KEEP) {\n          index++;\n        } else if (action[0] === INSERT) {\n          insertAt(elm, action[1], index);\n          index++;\n        } else if (action[0] === DELETE) {\n          removeAt(elm, index);\n        }\n      });\n    };\n    var read$2 = function (elm) {\n      return filter(map(from$1(elm.childNodes), getOuterHtml), function (item) {\n        return item.length > 0;\n      });\n    };\n    var write = function (fragments, elm) {\n      var currentFragments = map(from$1(elm.childNodes), getOuterHtml);\n      applyDiff(diff(currentFragments, fragments), elm);\n      return elm;\n    };\n\n    var undoLevelDocument = Cell(Optional.none());\n    var lazyTempDocument = function () {\n      return undoLevelDocument.get().getOrThunk(function () {\n        var doc = document.implementation.createHTMLDocument('undo');\n        undoLevelDocument.set(Optional.some(doc));\n        return doc;\n      });\n    };\n    var hasIframes = function (html) {\n      return html.indexOf('</iframe>') !== -1;\n    };\n    var createFragmentedLevel = function (fragments) {\n      return {\n        type: 'fragmented',\n        fragments: fragments,\n        content: '',\n        bookmark: null,\n        beforeBookmark: null\n      };\n    };\n    var createCompleteLevel = function (content) {\n      return {\n        type: 'complete',\n        fragments: null,\n        content: content,\n        bookmark: null,\n        beforeBookmark: null\n      };\n    };\n    var createFromEditor = function (editor) {\n      var fragments = read$2(editor.getBody());\n      var trimmedFragments = bind(fragments, function (html) {\n        var trimmed = trimInternal(editor.serializer, html);\n        return trimmed.length > 0 ? [trimmed] : [];\n      });\n      var content = trimmedFragments.join('');\n      return hasIframes(content) ? createFragmentedLevel(trimmedFragments) : createCompleteLevel(content);\n    };\n    var applyToEditor = function (editor, level, before) {\n      if (level.type === 'fragmented') {\n        write(level.fragments, editor.getBody());\n      } else {\n        editor.setContent(level.content, { format: 'raw' });\n      }\n      editor.selection.moveToBookmark(before ? level.beforeBookmark : level.bookmark);\n    };\n    var getLevelContent = function (level) {\n      return level.type === 'fragmented' ? level.fragments.join('') : level.content;\n    };\n    var getCleanLevelContent = function (level) {\n      var elm = SugarElement.fromTag('body', lazyTempDocument());\n      set$1(elm, getLevelContent(level));\n      each(descendants$1(elm, '*[data-mce-bogus]'), unwrap);\n      return get$7(elm);\n    };\n    var hasEqualContent = function (level1, level2) {\n      return getLevelContent(level1) === getLevelContent(level2);\n    };\n    var hasEqualCleanedContent = function (level1, level2) {\n      return getCleanLevelContent(level1) === getCleanLevelContent(level2);\n    };\n    var isEq$4 = function (level1, level2) {\n      if (!level1 || !level2) {\n        return false;\n      } else if (hasEqualContent(level1, level2)) {\n        return true;\n      } else {\n        return hasEqualCleanedContent(level1, level2);\n      }\n    };\n\n    var isUnlocked = function (locks) {\n      return locks.get() === 0;\n    };\n\n    var setTyping = function (undoManager, typing, locks) {\n      if (isUnlocked(locks)) {\n        undoManager.typing = typing;\n      }\n    };\n    var endTyping = function (undoManager, locks) {\n      if (undoManager.typing) {\n        setTyping(undoManager, false, locks);\n        undoManager.add();\n      }\n    };\n    var endTypingLevelIgnoreLocks = function (undoManager) {\n      if (undoManager.typing) {\n        undoManager.typing = false;\n        undoManager.add();\n      }\n    };\n\n    var beforeChange = function (editor, locks, beforeBookmark) {\n      if (isUnlocked(locks)) {\n        beforeBookmark.set(Optional.some(getUndoBookmark(editor.selection)));\n      }\n    };\n    var addUndoLevel = function (editor, undoManager, index, locks, beforeBookmark, level, event) {\n      var currentLevel = createFromEditor(editor);\n      level = level || {};\n      level = Tools.extend(level, currentLevel);\n      if (isUnlocked(locks) === false || editor.removed) {\n        return null;\n      }\n      var lastLevel = undoManager.data[index.get()];\n      if (editor.fire('BeforeAddUndo', {\n          level: level,\n          lastLevel: lastLevel,\n          originalEvent: event\n        }).isDefaultPrevented()) {\n        return null;\n      }\n      if (lastLevel && isEq$4(lastLevel, level)) {\n        return null;\n      }\n      if (undoManager.data[index.get()]) {\n        beforeBookmark.get().each(function (bm) {\n          undoManager.data[index.get()].beforeBookmark = bm;\n        });\n      }\n      var customUndoRedoLevels = getCustomUndoRedoLevels(editor);\n      if (customUndoRedoLevels) {\n        if (undoManager.data.length > customUndoRedoLevels) {\n          for (var i = 0; i < undoManager.data.length - 1; i++) {\n            undoManager.data[i] = undoManager.data[i + 1];\n          }\n          undoManager.data.length--;\n          index.set(undoManager.data.length);\n        }\n      }\n      level.bookmark = getUndoBookmark(editor.selection);\n      if (index.get() < undoManager.data.length - 1) {\n        undoManager.data.length = index.get() + 1;\n      }\n      undoManager.data.push(level);\n      index.set(undoManager.data.length - 1);\n      var args = {\n        level: level,\n        lastLevel: lastLevel,\n        originalEvent: event\n      };\n      if (index.get() > 0) {\n        editor.setDirty(true);\n        editor.fire('AddUndo', args);\n        editor.fire('change', args);\n      } else {\n        editor.fire('AddUndo', args);\n      }\n      return level;\n    };\n    var clear = function (editor, undoManager, index) {\n      undoManager.data = [];\n      index.set(0);\n      undoManager.typing = false;\n      editor.fire('ClearUndos');\n    };\n    var extra = function (editor, undoManager, index, callback1, callback2) {\n      if (undoManager.transact(callback1)) {\n        var bookmark = undoManager.data[index.get()].bookmark;\n        var lastLevel = undoManager.data[index.get() - 1];\n        applyToEditor(editor, lastLevel, true);\n        if (undoManager.transact(callback2)) {\n          undoManager.data[index.get() - 1].beforeBookmark = bookmark;\n        }\n      }\n    };\n    var redo = function (editor, index, data) {\n      var level;\n      if (index.get() < data.length - 1) {\n        index.set(index.get() + 1);\n        level = data[index.get()];\n        applyToEditor(editor, level, false);\n        editor.setDirty(true);\n        editor.fire('Redo', { level: level });\n      }\n      return level;\n    };\n    var undo = function (editor, undoManager, locks, index) {\n      var level;\n      if (undoManager.typing) {\n        undoManager.add();\n        undoManager.typing = false;\n        setTyping(undoManager, false, locks);\n      }\n      if (index.get() > 0) {\n        index.set(index.get() - 1);\n        level = undoManager.data[index.get()];\n        applyToEditor(editor, level, true);\n        editor.setDirty(true);\n        editor.fire('Undo', { level: level });\n      }\n      return level;\n    };\n    var reset = function (undoManager) {\n      undoManager.clear();\n      undoManager.add();\n    };\n    var hasUndo = function (editor, undoManager, index) {\n      return index.get() > 0 || undoManager.typing && undoManager.data[0] && !isEq$4(createFromEditor(editor), undoManager.data[0]);\n    };\n    var hasRedo = function (undoManager, index) {\n      return index.get() < undoManager.data.length - 1 && !undoManager.typing;\n    };\n    var transact = function (undoManager, locks, callback) {\n      endTyping(undoManager, locks);\n      undoManager.beforeChange();\n      undoManager.ignore(callback);\n      return undoManager.add();\n    };\n    var ignore = function (locks, callback) {\n      try {\n        locks.set(locks.get() + 1);\n        callback();\n      } finally {\n        locks.set(locks.get() - 1);\n      }\n    };\n\n    var isTreeNode$1 = function (content) {\n      return content instanceof AstNode;\n    };\n    var runSerializerFiltersOnFragment = function (editor, fragment) {\n      filter$3(editor.serializer.getNodeFilters(), editor.serializer.getAttributeFilters(), fragment);\n    };\n    var getInsertContext = function (editor) {\n      return Optional.from(editor.selection.getStart(true)).map(function (elm) {\n        return elm.nodeName.toLowerCase();\n      });\n    };\n    var createDummyUndoLevel = function () {\n      return {\n        type: 'complete',\n        fragments: [],\n        content: '',\n        bookmark: null,\n        beforeBookmark: null\n      };\n    };\n    var makePlainAdaptor = function (editor) {\n      return {\n        undoManager: {\n          beforeChange: function (locks, beforeBookmark) {\n            return beforeChange(editor, locks, beforeBookmark);\n          },\n          addUndoLevel: function (undoManager, index, locks, beforeBookmark, level, event) {\n            return addUndoLevel(editor, undoManager, index, locks, beforeBookmark, level, event);\n          },\n          undo: function (undoManager, locks, index) {\n            return undo(editor, undoManager, locks, index);\n          },\n          redo: function (index, data) {\n            return redo(editor, index, data);\n          },\n          clear: function (undoManager, index) {\n            return clear(editor, undoManager, index);\n          },\n          reset: function (undoManager) {\n            return reset(undoManager);\n          },\n          hasUndo: function (undoManager, index) {\n            return hasUndo(editor, undoManager, index);\n          },\n          hasRedo: function (undoManager, index) {\n            return hasRedo(undoManager, index);\n          },\n          transact: function (undoManager, locks, callback) {\n            return transact(undoManager, locks, callback);\n          },\n          ignore: function (locks, callback) {\n            return ignore(locks, callback);\n          },\n          extra: function (undoManager, index, callback1, callback2) {\n            return extra(editor, undoManager, index, callback1, callback2);\n          }\n        },\n        formatter: {\n          match: function (name, vars, node) {\n            return match(editor, name, vars, node);\n          },\n          matchAll: function (names, vars) {\n            return matchAll(editor, names, vars);\n          },\n          matchNode: function (node, name, vars, similar) {\n            return matchNode(editor, node, name, vars, similar);\n          },\n          canApply: function (name) {\n            return canApply(editor, name);\n          },\n          closest: function (names) {\n            return closest$3(editor, names);\n          },\n          apply: function (name, vars, node) {\n            return applyFormat(editor, name, vars, node);\n          },\n          remove: function (name, vars, node, similar) {\n            return remove$6(editor, name, vars, node, similar);\n          },\n          toggle: function (name, vars, node) {\n            return toggle(editor, name, vars, node);\n          },\n          formatChanged: function (registeredFormatListeners, formats, callback, similar) {\n            return formatChangedInternal(editor, registeredFormatListeners, formats, callback, similar);\n          }\n        },\n        editor: {\n          getContent: function (args, format) {\n            return getContentInternal(editor, args, format);\n          },\n          setContent: function (content, args) {\n            return setContentInternal(editor, content, args);\n          },\n          insertContent: function (value, details) {\n            return insertHtmlAtCaret(editor, value, details);\n          },\n          addVisual: function (elm) {\n            return addVisualInternal(editor, elm);\n          }\n        },\n        selection: {\n          getContent: function (format, args) {\n            return getSelectedContentInternal(editor, format, args);\n          }\n        },\n        raw: {\n          getModel: function () {\n            return Optional.none();\n          }\n        }\n      };\n    };\n    var makeRtcAdaptor = function (tinymceEditor, rtcEditor) {\n      var defaultVars = function (vars) {\n        return isObject(vars) ? vars : {};\n      };\n      var unsupported = die('Unimplemented feature for rtc');\n      var ignore = noop;\n      return {\n        undoManager: {\n          beforeChange: ignore,\n          addUndoLevel: unsupported,\n          undo: function () {\n            rtcEditor.undo();\n            return createDummyUndoLevel();\n          },\n          redo: function () {\n            rtcEditor.redo();\n            return createDummyUndoLevel();\n          },\n          clear: unsupported,\n          reset: unsupported,\n          hasUndo: function () {\n            return rtcEditor.hasUndo();\n          },\n          hasRedo: function () {\n            return rtcEditor.hasRedo();\n          },\n          transact: function (_undoManager, _locks, fn) {\n            rtcEditor.transact(fn);\n            return createDummyUndoLevel();\n          },\n          ignore: unsupported,\n          extra: unsupported\n        },\n        formatter: {\n          match: function (name, vars, _node) {\n            return rtcEditor.matchFormat(name, defaultVars(vars));\n          },\n          matchAll: unsupported,\n          matchNode: unsupported,\n          canApply: function (name) {\n            return rtcEditor.canApplyFormat(name);\n          },\n          closest: function (names) {\n            return rtcEditor.closestFormat(names);\n          },\n          apply: function (name, vars, _node) {\n            return rtcEditor.applyFormat(name, defaultVars(vars));\n          },\n          remove: function (name, vars, _node, _similar) {\n            return rtcEditor.removeFormat(name, defaultVars(vars));\n          },\n          toggle: function (name, vars, _node) {\n            return rtcEditor.toggleFormat(name, defaultVars(vars));\n          },\n          formatChanged: function (_rfl, formats, callback, similar) {\n            return rtcEditor.formatChanged(formats, callback, similar);\n          }\n        },\n        editor: {\n          getContent: function (args, format) {\n            if (format === 'html' || format === 'tree') {\n              var fragment = rtcEditor.getContent();\n              var serializer = HtmlSerializer({ inner: true });\n              runSerializerFiltersOnFragment(tinymceEditor, fragment);\n              return format === 'tree' ? fragment : serializer.serialize(fragment);\n            } else {\n              return makePlainAdaptor(tinymceEditor).editor.getContent(args, format);\n            }\n          },\n          setContent: function (content, _args) {\n            var fragment = isTreeNode$1(content) ? content : tinymceEditor.parser.parse(content, {\n              isRootContent: true,\n              insert: true\n            });\n            rtcEditor.setContent(fragment);\n            return content;\n          },\n          insertContent: function (value, _details) {\n            var contextArgs = getInsertContext(tinymceEditor).fold(function () {\n              return {};\n            }, function (context) {\n              return { context: context };\n            });\n            var fragment = isTreeNode$1(value) ? value : tinymceEditor.parser.parse(value, __assign(__assign({}, contextArgs), { insert: true }));\n            rtcEditor.insertContent(fragment);\n          },\n          addVisual: function (_elm) {\n          }\n        },\n        selection: {\n          getContent: function (format, args) {\n            if (format === 'html' || format === 'tree') {\n              var fragment = rtcEditor.getSelectedContent();\n              var serializer = HtmlSerializer({});\n              runSerializerFiltersOnFragment(tinymceEditor, fragment);\n              return format === 'tree' ? fragment : serializer.serialize(fragment);\n            } else {\n              return makePlainAdaptor(tinymceEditor).selection.getContent(format, args);\n            }\n          }\n        },\n        raw: {\n          getModel: function () {\n            return Optional.some(rtcEditor.getRawModel());\n          }\n        }\n      };\n    };\n    var isRtc = function (editor) {\n      return has(editor.plugins, 'rtc');\n    };\n    var setup$5 = function (editor) {\n      var editorCast = editor;\n      return get$1(editor.plugins, 'rtc').fold(function () {\n        editorCast.rtcInstance = makePlainAdaptor(editor);\n        return Optional.none();\n      }, function (rtc) {\n        return Optional.some(rtc.setup().then(function (rtcEditor) {\n          editorCast.rtcInstance = makeRtcAdaptor(editor, rtcEditor);\n          return rtcEditor.isRemote;\n        }));\n      });\n    };\n    var getRtcInstanceWithFallback = function (editor) {\n      return editor.rtcInstance ? editor.rtcInstance : makePlainAdaptor(editor);\n    };\n    var getRtcInstanceWithError = function (editor) {\n      var rtcInstance = editor.rtcInstance;\n      if (!rtcInstance) {\n        throw new Error('Failed to get RTC instance not yet initialized.');\n      } else {\n        return rtcInstance;\n      }\n    };\n    var beforeChange$1 = function (editor, locks, beforeBookmark) {\n      getRtcInstanceWithError(editor).undoManager.beforeChange(locks, beforeBookmark);\n    };\n    var addUndoLevel$1 = function (editor, undoManager, index, locks, beforeBookmark, level, event) {\n      return getRtcInstanceWithError(editor).undoManager.addUndoLevel(undoManager, index, locks, beforeBookmark, level, event);\n    };\n    var undo$1 = function (editor, undoManager, locks, index) {\n      return getRtcInstanceWithError(editor).undoManager.undo(undoManager, locks, index);\n    };\n    var redo$1 = function (editor, index, data) {\n      return getRtcInstanceWithError(editor).undoManager.redo(index, data);\n    };\n    var clear$1 = function (editor, undoManager, index) {\n      getRtcInstanceWithError(editor).undoManager.clear(undoManager, index);\n    };\n    var reset$1 = function (editor, undoManager) {\n      getRtcInstanceWithError(editor).undoManager.reset(undoManager);\n    };\n    var hasUndo$1 = function (editor, undoManager, index) {\n      return getRtcInstanceWithError(editor).undoManager.hasUndo(undoManager, index);\n    };\n    var hasRedo$1 = function (editor, undoManager, index) {\n      return getRtcInstanceWithError(editor).undoManager.hasRedo(undoManager, index);\n    };\n    var transact$1 = function (editor, undoManager, locks, callback) {\n      return getRtcInstanceWithError(editor).undoManager.transact(undoManager, locks, callback);\n    };\n    var ignore$1 = function (editor, locks, callback) {\n      getRtcInstanceWithError(editor).undoManager.ignore(locks, callback);\n    };\n    var extra$1 = function (editor, undoManager, index, callback1, callback2) {\n      getRtcInstanceWithError(editor).undoManager.extra(undoManager, index, callback1, callback2);\n    };\n    var matchFormat = function (editor, name, vars, node) {\n      return getRtcInstanceWithError(editor).formatter.match(name, vars, node);\n    };\n    var matchAllFormats = function (editor, names, vars) {\n      return getRtcInstanceWithError(editor).formatter.matchAll(names, vars);\n    };\n    var matchNodeFormat = function (editor, node, name, vars, similar) {\n      return getRtcInstanceWithError(editor).formatter.matchNode(node, name, vars, similar);\n    };\n    var canApplyFormat = function (editor, name) {\n      return getRtcInstanceWithError(editor).formatter.canApply(name);\n    };\n    var closestFormat = function (editor, names) {\n      return getRtcInstanceWithError(editor).formatter.closest(names);\n    };\n    var applyFormat$1 = function (editor, name, vars, node) {\n      getRtcInstanceWithError(editor).formatter.apply(name, vars, node);\n    };\n    var removeFormat$1 = function (editor, name, vars, node, similar) {\n      getRtcInstanceWithError(editor).formatter.remove(name, vars, node, similar);\n    };\n    var toggleFormat = function (editor, name, vars, node) {\n      getRtcInstanceWithError(editor).formatter.toggle(name, vars, node);\n    };\n    var formatChanged = function (editor, registeredFormatListeners, formats, callback, similar) {\n      if (similar === void 0) {\n        similar = false;\n      }\n      return getRtcInstanceWithError(editor).formatter.formatChanged(registeredFormatListeners, formats, callback, similar);\n    };\n    var getContent = function (editor, args, format) {\n      return getRtcInstanceWithFallback(editor).editor.getContent(args, format);\n    };\n    var setContent = function (editor, content, args) {\n      return getRtcInstanceWithFallback(editor).editor.setContent(content, args);\n    };\n    var insertContent = function (editor, value, details) {\n      return getRtcInstanceWithFallback(editor).editor.insertContent(value, details);\n    };\n    var getSelectedContent = function (editor, format, args) {\n      return getRtcInstanceWithError(editor).selection.getContent(format, args);\n    };\n    var addVisual = function (editor, elm) {\n      return getRtcInstanceWithError(editor).editor.addVisual(elm);\n    };\n\n    var getContent$1 = function (editor, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      var format = args.format ? args.format : 'html';\n      return getSelectedContent(editor, format, args);\n    };\n\n    var removeEmpty = function (text) {\n      if (text.dom.length === 0) {\n        remove(text);\n        return Optional.none();\n      } else {\n        return Optional.some(text);\n      }\n    };\n    var walkPastBookmark = function (node, start) {\n      return node.filter(function (elm) {\n        return BookmarkManager$1.isBookmarkNode(elm.dom);\n      }).bind(start ? nextSibling : prevSibling);\n    };\n    var merge = function (outer, inner, rng, start) {\n      var outerElm = outer.dom;\n      var innerElm = inner.dom;\n      var oldLength = start ? outerElm.length : innerElm.length;\n      if (start) {\n        mergeTextNodes(outerElm, innerElm, false, !start);\n        rng.setStart(innerElm, oldLength);\n      } else {\n        mergeTextNodes(innerElm, outerElm, false, !start);\n        rng.setEnd(innerElm, oldLength);\n      }\n    };\n    var normalizeTextIfRequired = function (inner, start) {\n      parent(inner).each(function (root) {\n        var text = inner.dom;\n        if (start && needsToBeNbspLeft(root, CaretPosition$1(text, 0))) {\n          normalizeWhitespaceAfter(text, 0);\n        } else if (!start && needsToBeNbspRight(root, CaretPosition$1(text, text.length))) {\n          normalizeWhitespaceBefore(text, text.length);\n        }\n      });\n    };\n    var mergeAndNormalizeText = function (outerNode, innerNode, rng, start) {\n      outerNode.bind(function (outer) {\n        var normalizer = start ? normalizeWhitespaceBefore : normalizeWhitespaceAfter;\n        normalizer(outer.dom, start ? outer.dom.length : 0);\n        return innerNode.filter(isText).map(function (inner) {\n          return merge(outer, inner, rng, start);\n        });\n      }).orThunk(function () {\n        var innerTextNode = walkPastBookmark(innerNode, start).or(innerNode).filter(isText);\n        return innerTextNode.map(function (inner) {\n          return normalizeTextIfRequired(inner, start);\n        });\n      });\n    };\n    var rngSetContent = function (rng, fragment) {\n      var firstChild = Optional.from(fragment.firstChild).map(SugarElement.fromDom);\n      var lastChild = Optional.from(fragment.lastChild).map(SugarElement.fromDom);\n      rng.deleteContents();\n      rng.insertNode(fragment);\n      var prevText = firstChild.bind(prevSibling).filter(isText).bind(removeEmpty);\n      var nextText = lastChild.bind(nextSibling).filter(isText).bind(removeEmpty);\n      mergeAndNormalizeText(prevText, firstChild, rng, true);\n      mergeAndNormalizeText(nextText, lastChild, rng, false);\n      rng.collapse(false);\n    };\n    var setupArgs = function (args, content) {\n      return __assign(__assign({ format: 'html' }, args), {\n        set: true,\n        selection: true,\n        content: content\n      });\n    };\n    var cleanContent = function (editor, args) {\n      if (args.format !== 'raw') {\n        var rng = editor.selection.getRng();\n        var contextBlock = editor.dom.getParent(rng.commonAncestorContainer, editor.dom.isBlock);\n        var contextArgs = contextBlock ? { context: contextBlock.nodeName.toLowerCase() } : {};\n        var node = editor.parser.parse(args.content, __assign(__assign({\n          isRootContent: true,\n          forced_root_block: false\n        }, contextArgs), args));\n        return HtmlSerializer({ validate: editor.validate }, editor.schema).serialize(node);\n      } else {\n        return args.content;\n      }\n    };\n    var setContent$1 = function (editor, content, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      var contentArgs = setupArgs(args, content);\n      if (!contentArgs.no_events) {\n        contentArgs = editor.fire('BeforeSetContent', contentArgs);\n        if (contentArgs.isDefaultPrevented()) {\n          editor.fire('SetContent', contentArgs);\n          return;\n        }\n      }\n      args.content = cleanContent(editor, contentArgs);\n      var rng = editor.selection.getRng();\n      rngSetContent(rng, rng.createContextualFragment(args.content));\n      editor.selection.setRng(rng);\n      scrollRangeIntoView(editor, rng);\n      if (!contentArgs.no_events) {\n        editor.fire('SetContent', contentArgs);\n      }\n    };\n\n    var deleteFromCallbackMap = function (callbackMap, selector, callback) {\n      if (callbackMap && callbackMap.hasOwnProperty(selector)) {\n        var newCallbacks = filter(callbackMap[selector], function (cb) {\n          return cb !== callback;\n        });\n        if (newCallbacks.length === 0) {\n          delete callbackMap[selector];\n        } else {\n          callbackMap[selector] = newCallbacks;\n        }\n      }\n    };\n    function SelectorChanged (dom, editor) {\n      var selectorChangedData;\n      var currentSelectors;\n      return {\n        selectorChangedWithUnbind: function (selector, callback) {\n          if (!selectorChangedData) {\n            selectorChangedData = {};\n            currentSelectors = {};\n            editor.on('NodeChange', function (e) {\n              var node = e.element, parents = dom.getParents(node, null, dom.getRoot()), matchedSelectors = {};\n              Tools.each(selectorChangedData, function (callbacks, selector) {\n                Tools.each(parents, function (node) {\n                  if (dom.is(node, selector)) {\n                    if (!currentSelectors[selector]) {\n                      Tools.each(callbacks, function (callback) {\n                        callback(true, {\n                          node: node,\n                          selector: selector,\n                          parents: parents\n                        });\n                      });\n                      currentSelectors[selector] = callbacks;\n                    }\n                    matchedSelectors[selector] = callbacks;\n                    return false;\n                  }\n                });\n              });\n              Tools.each(currentSelectors, function (callbacks, selector) {\n                if (!matchedSelectors[selector]) {\n                  delete currentSelectors[selector];\n                  Tools.each(callbacks, function (callback) {\n                    callback(false, {\n                      node: node,\n                      selector: selector,\n                      parents: parents\n                    });\n                  });\n                }\n              });\n            });\n          }\n          if (!selectorChangedData[selector]) {\n            selectorChangedData[selector] = [];\n          }\n          selectorChangedData[selector].push(callback);\n          return {\n            unbind: function () {\n              deleteFromCallbackMap(selectorChangedData, selector, callback);\n              deleteFromCallbackMap(currentSelectors, selector, callback);\n            }\n          };\n        }\n      };\n    }\n\n    var isNativeIeSelection = function (rng) {\n      return !!rng.select;\n    };\n    var isAttachedToDom = function (node) {\n      return !!(node && node.ownerDocument) && contains$2(SugarElement.fromDom(node.ownerDocument), SugarElement.fromDom(node));\n    };\n    var isValidRange = function (rng) {\n      if (!rng) {\n        return false;\n      } else if (isNativeIeSelection(rng)) {\n        return true;\n      } else {\n        return isAttachedToDom(rng.startContainer) && isAttachedToDom(rng.endContainer);\n      }\n    };\n    var EditorSelection = function (dom, win, serializer, editor) {\n      var selectedRange;\n      var explicitRange;\n      var selectorChangedWithUnbind = SelectorChanged(dom, editor).selectorChangedWithUnbind;\n      var setCursorLocation = function (node, offset) {\n        var rng = dom.createRng();\n        if (!node) {\n          moveEndPoint$1(dom, rng, editor.getBody(), true);\n          setRng(rng);\n        } else {\n          rng.setStart(node, offset);\n          rng.setEnd(node, offset);\n          setRng(rng);\n          collapse(false);\n        }\n      };\n      var getContent = function (args) {\n        return getContent$1(editor, args);\n      };\n      var setContent = function (content, args) {\n        return setContent$1(editor, content, args);\n      };\n      var getStart = function (real) {\n        return getStart$2(editor.getBody(), getRng$1(), real);\n      };\n      var getEnd$1 = function (real) {\n        return getEnd(editor.getBody(), getRng$1(), real);\n      };\n      var getBookmark = function (type, normalized) {\n        return bookmarkManager.getBookmark(type, normalized);\n      };\n      var moveToBookmark = function (bookmark) {\n        return bookmarkManager.moveToBookmark(bookmark);\n      };\n      var select = function (node, content) {\n        select$1(dom, node, content).each(setRng);\n        return node;\n      };\n      var isCollapsed = function () {\n        var rng = getRng$1(), sel = getSel();\n        if (!rng || rng.item) {\n          return false;\n        }\n        if (rng.compareEndPoints) {\n          return rng.compareEndPoints('StartToEnd', rng) === 0;\n        }\n        return !sel || rng.collapsed;\n      };\n      var collapse = function (toStart) {\n        var rng = getRng$1();\n        rng.collapse(!!toStart);\n        setRng(rng);\n      };\n      var getSel = function () {\n        return win.getSelection ? win.getSelection() : win.document.selection;\n      };\n      var getRng$1 = function () {\n        var selection, rng, elm;\n        var tryCompareBoundaryPoints = function (how, sourceRange, destinationRange) {\n          try {\n            return sourceRange.compareBoundaryPoints(how, destinationRange);\n          } catch (ex) {\n            return -1;\n          }\n        };\n        if (!win) {\n          return null;\n        }\n        var doc = win.document;\n        if (typeof doc === 'undefined' || doc === null) {\n          return null;\n        }\n        if (editor.bookmark !== undefined && hasFocus$1(editor) === false) {\n          var bookmark = getRng(editor);\n          if (bookmark.isSome()) {\n            return bookmark.map(function (r) {\n              return processRanges(editor, [r])[0];\n            }).getOr(doc.createRange());\n          }\n        }\n        try {\n          if ((selection = getSel()) && !isRestrictedNode(selection.anchorNode)) {\n            if (selection.rangeCount > 0) {\n              rng = selection.getRangeAt(0);\n            } else {\n              rng = selection.createRange ? selection.createRange() : doc.createRange();\n            }\n            rng = processRanges(editor, [rng])[0];\n          }\n        } catch (ex) {\n        }\n        if (!rng) {\n          rng = doc.createRange ? doc.createRange() : doc.body.createTextRange();\n        }\n        if (rng.setStart && rng.startContainer.nodeType === 9 && rng.collapsed) {\n          elm = dom.getRoot();\n          rng.setStart(elm, 0);\n          rng.setEnd(elm, 0);\n        }\n        if (selectedRange && explicitRange) {\n          if (tryCompareBoundaryPoints(rng.START_TO_START, rng, selectedRange) === 0 && tryCompareBoundaryPoints(rng.END_TO_END, rng, selectedRange) === 0) {\n            rng = explicitRange;\n          } else {\n            selectedRange = null;\n            explicitRange = null;\n          }\n        }\n        return rng;\n      };\n      var setRng = function (rng, forward) {\n        var node;\n        if (!isValidRange(rng)) {\n          return;\n        }\n        var ieRange = isNativeIeSelection(rng) ? rng : null;\n        if (ieRange) {\n          explicitRange = null;\n          try {\n            ieRange.select();\n          } catch (ex) {\n          }\n          return;\n        }\n        var sel = getSel();\n        var evt = editor.fire('SetSelectionRange', {\n          range: rng,\n          forward: forward\n        });\n        rng = evt.range;\n        if (sel) {\n          explicitRange = rng;\n          try {\n            sel.removeAllRanges();\n            sel.addRange(rng);\n          } catch (ex) {\n          }\n          if (forward === false && sel.extend) {\n            sel.collapse(rng.endContainer, rng.endOffset);\n            sel.extend(rng.startContainer, rng.startOffset);\n          }\n          selectedRange = sel.rangeCount > 0 ? sel.getRangeAt(0) : null;\n        }\n        if (!rng.collapsed && rng.startContainer === rng.endContainer && sel.setBaseAndExtent && !Env.ie) {\n          if (rng.endOffset - rng.startOffset < 2) {\n            if (rng.startContainer.hasChildNodes()) {\n              node = rng.startContainer.childNodes[rng.startOffset];\n              if (node && node.tagName === 'IMG') {\n                sel.setBaseAndExtent(rng.startContainer, rng.startOffset, rng.endContainer, rng.endOffset);\n                if (sel.anchorNode !== rng.startContainer || sel.focusNode !== rng.endContainer) {\n                  sel.setBaseAndExtent(node, 0, node, 1);\n                }\n              }\n            }\n          }\n        }\n        editor.fire('AfterSetSelectionRange', {\n          range: rng,\n          forward: forward\n        });\n      };\n      var setNode = function (elm) {\n        setContent(dom.getOuterHTML(elm));\n        return elm;\n      };\n      var getNode = function () {\n        return getNode$1(editor.getBody(), getRng$1());\n      };\n      var getSelectedBlocks$1 = function (startElm, endElm) {\n        return getSelectedBlocks(dom, getRng$1(), startElm, endElm);\n      };\n      var isForward = function () {\n        var sel = getSel();\n        var anchorNode = sel === null || sel === void 0 ? void 0 : sel.anchorNode;\n        var focusNode = sel === null || sel === void 0 ? void 0 : sel.focusNode;\n        if (!sel || !anchorNode || !focusNode || isRestrictedNode(anchorNode) || isRestrictedNode(focusNode)) {\n          return true;\n        }\n        var anchorRange = dom.createRng();\n        anchorRange.setStart(anchorNode, sel.anchorOffset);\n        anchorRange.collapse(true);\n        var focusRange = dom.createRng();\n        focusRange.setStart(focusNode, sel.focusOffset);\n        focusRange.collapse(true);\n        return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START, focusRange) <= 0;\n      };\n      var normalize$1 = function () {\n        var rng = getRng$1();\n        var sel = getSel();\n        if (!hasMultipleRanges(sel) && hasAnyRanges(editor)) {\n          var normRng = normalize(dom, rng);\n          normRng.each(function (normRng) {\n            setRng(normRng, isForward());\n          });\n          return normRng.getOr(rng);\n        }\n        return rng;\n      };\n      var selectorChanged = function (selector, callback) {\n        selectorChangedWithUnbind(selector, callback);\n        return exports;\n      };\n      var getScrollContainer = function () {\n        var scrollContainer;\n        var node = dom.getRoot();\n        while (node && node.nodeName !== 'BODY') {\n          if (node.scrollHeight > node.clientHeight) {\n            scrollContainer = node;\n            break;\n          }\n          node = node.parentNode;\n        }\n        return scrollContainer;\n      };\n      var scrollIntoView = function (elm, alignToTop) {\n        return scrollElementIntoView(editor, elm, alignToTop);\n      };\n      var placeCaretAt = function (clientX, clientY) {\n        return setRng(fromPoint$1(clientX, clientY, editor.getDoc()));\n      };\n      var getBoundingClientRect = function () {\n        var rng = getRng$1();\n        return rng.collapsed ? CaretPosition$1.fromRangeStart(rng).getClientRects()[0] : rng.getBoundingClientRect();\n      };\n      var destroy = function () {\n        win = selectedRange = explicitRange = null;\n        controlSelection.destroy();\n      };\n      var exports = {\n        bookmarkManager: null,\n        controlSelection: null,\n        dom: dom,\n        win: win,\n        serializer: serializer,\n        editor: editor,\n        collapse: collapse,\n        setCursorLocation: setCursorLocation,\n        getContent: getContent,\n        setContent: setContent,\n        getBookmark: getBookmark,\n        moveToBookmark: moveToBookmark,\n        select: select,\n        isCollapsed: isCollapsed,\n        isForward: isForward,\n        setNode: setNode,\n        getNode: getNode,\n        getSel: getSel,\n        setRng: setRng,\n        getRng: getRng$1,\n        getStart: getStart,\n        getEnd: getEnd$1,\n        getSelectedBlocks: getSelectedBlocks$1,\n        normalize: normalize$1,\n        selectorChanged: selectorChanged,\n        selectorChangedWithUnbind: selectorChangedWithUnbind,\n        getScrollContainer: getScrollContainer,\n        scrollIntoView: scrollIntoView,\n        placeCaretAt: placeCaretAt,\n        getBoundingClientRect: getBoundingClientRect,\n        destroy: destroy\n      };\n      var bookmarkManager = BookmarkManager$1(exports);\n      var controlSelection = ControlSelection(exports, editor);\n      exports.bookmarkManager = bookmarkManager;\n      exports.controlSelection = controlSelection;\n      return exports;\n    };\n\n    var removeAttrs = function (node, names) {\n      each(names, function (name) {\n        node.attr(name, null);\n      });\n    };\n    var addFontToSpansFilter = function (domParser, styles, fontSizes) {\n      domParser.addNodeFilter('font', function (nodes) {\n        each(nodes, function (node) {\n          var props = styles.parse(node.attr('style'));\n          var color = node.attr('color');\n          var face = node.attr('face');\n          var size = node.attr('size');\n          if (color) {\n            props.color = color;\n          }\n          if (face) {\n            props['font-family'] = face;\n          }\n          if (size) {\n            props['font-size'] = fontSizes[parseInt(node.attr('size'), 10) - 1];\n          }\n          node.name = 'span';\n          node.attr('style', styles.serialize(props));\n          removeAttrs(node, [\n            'color',\n            'face',\n            'size'\n          ]);\n        });\n      });\n    };\n    var addStrikeToSpanFilter = function (domParser, styles) {\n      domParser.addNodeFilter('strike', function (nodes) {\n        each(nodes, function (node) {\n          var props = styles.parse(node.attr('style'));\n          props['text-decoration'] = 'line-through';\n          node.name = 'span';\n          node.attr('style', styles.serialize(props));\n        });\n      });\n    };\n    var addFilters = function (domParser, settings) {\n      var styles = Styles();\n      if (settings.convert_fonts_to_spans) {\n        addFontToSpansFilter(domParser, styles, Tools.explode(settings.font_size_legacy_values));\n      }\n      addStrikeToSpanFilter(domParser, styles);\n    };\n    var register$1 = function (domParser, settings) {\n      if (settings.inline_styles) {\n        addFilters(domParser, settings);\n      }\n    };\n\n    var blobUriToBlob = function (url) {\n      return new promiseObj(function (resolve, reject) {\n        var rejectWithError = function () {\n          reject('Cannot convert ' + url + ' to Blob. Resource might not exist or is inaccessible.');\n        };\n        try {\n          var xhr = new XMLHttpRequest();\n          xhr.open('GET', url, true);\n          xhr.responseType = 'blob';\n          xhr.onload = function () {\n            if (this.status === 200) {\n              resolve(this.response);\n            } else {\n              rejectWithError();\n            }\n          };\n          xhr.onerror = rejectWithError;\n          xhr.send();\n        } catch (ex) {\n          rejectWithError();\n        }\n      });\n    };\n    var parseDataUri$1 = function (uri) {\n      var type;\n      var uriParts = decodeURIComponent(uri).split(',');\n      var matches = /data:([^;]+)/.exec(uriParts[0]);\n      if (matches) {\n        type = matches[1];\n      }\n      return {\n        type: type,\n        data: uriParts[1]\n      };\n    };\n    var buildBlob = function (type, data) {\n      var str;\n      try {\n        str = atob(data);\n      } catch (e) {\n        return Optional.none();\n      }\n      var arr = new Uint8Array(str.length);\n      for (var i = 0; i < arr.length; i++) {\n        arr[i] = str.charCodeAt(i);\n      }\n      return Optional.some(new Blob([arr], { type: type }));\n    };\n    var dataUriToBlob = function (uri) {\n      return new promiseObj(function (resolve) {\n        var _a = parseDataUri$1(uri), type = _a.type, data = _a.data;\n        buildBlob(type, data).fold(function () {\n          return resolve(new Blob([]));\n        }, resolve);\n      });\n    };\n    var uriToBlob = function (url) {\n      if (url.indexOf('blob:') === 0) {\n        return blobUriToBlob(url);\n      }\n      if (url.indexOf('data:') === 0) {\n        return dataUriToBlob(url);\n      }\n      return null;\n    };\n    var blobToDataUri = function (blob) {\n      return new promiseObj(function (resolve) {\n        var reader = new FileReader();\n        reader.onloadend = function () {\n          resolve(reader.result);\n        };\n        reader.readAsDataURL(blob);\n      });\n    };\n\n    var count = 0;\n    var uniqueId = function (prefix) {\n      return (prefix || 'blobid') + count++;\n    };\n    var imageToBlobInfo = function (blobCache, img, resolve, reject) {\n      var base64, blobInfo;\n      if (img.src.indexOf('blob:') === 0) {\n        blobInfo = blobCache.getByUri(img.src);\n        if (blobInfo) {\n          resolve({\n            image: img,\n            blobInfo: blobInfo\n          });\n        } else {\n          uriToBlob(img.src).then(function (blob) {\n            blobToDataUri(blob).then(function (dataUri) {\n              base64 = parseDataUri$1(dataUri).data;\n              blobInfo = blobCache.create(uniqueId(), blob, base64);\n              blobCache.add(blobInfo);\n              resolve({\n                image: img,\n                blobInfo: blobInfo\n              });\n            });\n          }, function (err) {\n            reject(err);\n          });\n        }\n        return;\n      }\n      var _a = parseDataUri$1(img.src), data = _a.data, type = _a.type;\n      base64 = data;\n      blobInfo = blobCache.getByData(base64, type);\n      if (blobInfo) {\n        resolve({\n          image: img,\n          blobInfo: blobInfo\n        });\n      } else {\n        uriToBlob(img.src).then(function (blob) {\n          blobInfo = blobCache.create(uniqueId(), blob, base64);\n          blobCache.add(blobInfo);\n          resolve({\n            image: img,\n            blobInfo: blobInfo\n          });\n        }, function (err) {\n          reject(err);\n        });\n      }\n    };\n    var getAllImages = function (elm) {\n      return elm ? from$1(elm.getElementsByTagName('img')) : [];\n    };\n    function ImageScanner(uploadStatus, blobCache) {\n      var cachedPromises = {};\n      var findAll = function (elm, predicate) {\n        if (!predicate) {\n          predicate = always;\n        }\n        var images = filter(getAllImages(elm), function (img) {\n          var src = img.src;\n          if (!Env.fileApi) {\n            return false;\n          }\n          if (img.hasAttribute('data-mce-bogus')) {\n            return false;\n          }\n          if (img.hasAttribute('data-mce-placeholder')) {\n            return false;\n          }\n          if (!src || src === Env.transparentSrc) {\n            return false;\n          }\n          if (src.indexOf('blob:') === 0) {\n            return !uploadStatus.isUploaded(src) && predicate(img);\n          }\n          if (src.indexOf('data:') === 0) {\n            return predicate(img);\n          }\n          return false;\n        });\n        var promises = map(images, function (img) {\n          if (cachedPromises[img.src] !== undefined) {\n            return new promiseObj(function (resolve) {\n              cachedPromises[img.src].then(function (imageInfo) {\n                if (typeof imageInfo === 'string') {\n                  return imageInfo;\n                }\n                resolve({\n                  image: img,\n                  blobInfo: imageInfo.blobInfo\n                });\n              });\n            });\n          }\n          var newPromise = new promiseObj(function (resolve, reject) {\n            imageToBlobInfo(blobCache, img, resolve, reject);\n          }).then(function (result) {\n            delete cachedPromises[result.image.src];\n            return result;\n          }).catch(function (error) {\n            delete cachedPromises[img.src];\n            return error;\n          });\n          cachedPromises[img.src] = newPromise;\n          return newPromise;\n        });\n        return promiseObj.all(promises);\n      };\n      return { findAll: findAll };\n    }\n\n    var paddEmptyNode = function (settings, args, blockElements, node) {\n      var brPreferred = settings.padd_empty_with_br || args.insert;\n      if (brPreferred && blockElements[node.name]) {\n        node.empty().append(new AstNode('br', 1)).shortEnded = true;\n      } else {\n        node.empty().append(new AstNode('#text', 3)).value = nbsp;\n      }\n    };\n    var isPaddedWithNbsp = function (node) {\n      return hasOnlyChild(node, '#text') && node.firstChild.value === nbsp;\n    };\n    var hasOnlyChild = function (node, name) {\n      return node && node.firstChild && node.firstChild === node.lastChild && node.firstChild.name === name;\n    };\n    var isPadded = function (schema, node) {\n      var rule = schema.getElementRule(node.name);\n      return rule && rule.paddEmpty;\n    };\n    var isEmpty$2 = function (schema, nonEmptyElements, whitespaceElements, node) {\n      return node.isEmpty(nonEmptyElements, whitespaceElements, function (node) {\n        return isPadded(schema, node);\n      });\n    };\n    var isLineBreakNode = function (node, blockElements) {\n      return node && (blockElements[node.name] || node.name === 'br');\n    };\n\n    var isBogusImage = function (img) {\n      return img.attr('data-mce-bogus');\n    };\n    var isInternalImageSource = function (img) {\n      return img.attr('src') === Env.transparentSrc || img.attr('data-mce-placeholder');\n    };\n    var isValidDataImg = function (img, settings) {\n      if (settings.images_dataimg_filter) {\n        var imgElem_1 = new Image();\n        imgElem_1.src = img.attr('src');\n        each$1(img.attributes.map, function (value, key) {\n          imgElem_1.setAttribute(key, value);\n        });\n        return settings.images_dataimg_filter(imgElem_1);\n      } else {\n        return true;\n      }\n    };\n    var registerBase64ImageFilter = function (parser, settings) {\n      var blobCache = settings.blob_cache;\n      var processImage = function (img) {\n        var inputSrc = img.attr('src');\n        if (isInternalImageSource(img) || isBogusImage(img)) {\n          return;\n        }\n        parseDataUri(inputSrc).filter(function () {\n          return isValidDataImg(img, settings);\n        }).bind(function (_a) {\n          var type = _a.type, data = _a.data;\n          return Optional.from(blobCache.getByData(data, type)).orThunk(function () {\n            return buildBlob(type, data).map(function (blob) {\n              var blobInfo = blobCache.create(uniqueId(), blob, data);\n              blobCache.add(blobInfo);\n              return blobInfo;\n            });\n          });\n        }).each(function (blobInfo) {\n          img.attr('src', blobInfo.blobUri());\n        });\n      };\n      if (blobCache) {\n        parser.addAttributeFilter('src', function (nodes) {\n          return each(nodes, processImage);\n        });\n      }\n    };\n    var register$2 = function (parser, settings) {\n      var schema = parser.schema;\n      if (settings.remove_trailing_brs) {\n        parser.addNodeFilter('br', function (nodes, _, args) {\n          var i;\n          var l = nodes.length;\n          var node;\n          var blockElements = Tools.extend({}, schema.getBlockElements());\n          var nonEmptyElements = schema.getNonEmptyElements();\n          var parent, lastParent, prev, prevName;\n          var whiteSpaceElements = schema.getWhiteSpaceElements();\n          var elementRule, textNode;\n          blockElements.body = 1;\n          for (i = 0; i < l; i++) {\n            node = nodes[i];\n            parent = node.parent;\n            if (blockElements[node.parent.name] && node === parent.lastChild) {\n              prev = node.prev;\n              while (prev) {\n                prevName = prev.name;\n                if (prevName !== 'span' || prev.attr('data-mce-type') !== 'bookmark') {\n                  if (prevName === 'br') {\n                    node = null;\n                  }\n                  break;\n                }\n                prev = prev.prev;\n              }\n              if (node) {\n                node.remove();\n                if (isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, parent)) {\n                  elementRule = schema.getElementRule(parent.name);\n                  if (elementRule) {\n                    if (elementRule.removeEmpty) {\n                      parent.remove();\n                    } else if (elementRule.paddEmpty) {\n                      paddEmptyNode(settings, args, blockElements, parent);\n                    }\n                  }\n                }\n              }\n            } else {\n              lastParent = node;\n              while (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {\n                lastParent = parent;\n                if (blockElements[parent.name]) {\n                  break;\n                }\n                parent = parent.parent;\n              }\n              if (lastParent === parent && settings.padd_empty_with_br !== true) {\n                textNode = new AstNode('#text', 3);\n                textNode.value = nbsp;\n                node.replace(textNode);\n              }\n            }\n          }\n        });\n      }\n      parser.addAttributeFilter('href', function (nodes) {\n        var i = nodes.length;\n        var appendRel = function (rel) {\n          var parts = rel.split(' ').filter(function (p) {\n            return p.length > 0;\n          });\n          return parts.concat(['noopener']).sort().join(' ');\n        };\n        var addNoOpener = function (rel) {\n          var newRel = rel ? Tools.trim(rel) : '';\n          if (!/\\b(noopener)\\b/g.test(newRel)) {\n            return appendRel(newRel);\n          } else {\n            return newRel;\n          }\n        };\n        if (!settings.allow_unsafe_link_target) {\n          while (i--) {\n            var node = nodes[i];\n            if (node.name === 'a' && node.attr('target') === '_blank') {\n              node.attr('rel', addNoOpener(node.attr('rel')));\n            }\n          }\n        }\n      });\n      if (!settings.allow_html_in_named_anchor) {\n        parser.addAttributeFilter('id,name', function (nodes) {\n          var i = nodes.length, sibling, prevSibling, parent, node;\n          while (i--) {\n            node = nodes[i];\n            if (node.name === 'a' && node.firstChild && !node.attr('href')) {\n              parent = node.parent;\n              sibling = node.lastChild;\n              do {\n                prevSibling = sibling.prev;\n                parent.insert(sibling, node);\n                sibling = prevSibling;\n              } while (sibling);\n            }\n          }\n        });\n      }\n      if (settings.fix_list_elements) {\n        parser.addNodeFilter('ul,ol', function (nodes) {\n          var i = nodes.length, node, parentNode;\n          while (i--) {\n            node = nodes[i];\n            parentNode = node.parent;\n            if (parentNode.name === 'ul' || parentNode.name === 'ol') {\n              if (node.prev && node.prev.name === 'li') {\n                node.prev.append(node);\n              } else {\n                var li = new AstNode('li', 1);\n                li.attr('style', 'list-style-type: none');\n                node.wrap(li);\n              }\n            }\n          }\n        });\n      }\n      if (settings.validate && schema.getValidClasses()) {\n        parser.addAttributeFilter('class', function (nodes) {\n          var i = nodes.length, node, classList, ci, className, classValue;\n          var validClasses = schema.getValidClasses();\n          var validClassesMap, valid;\n          while (i--) {\n            node = nodes[i];\n            classList = node.attr('class').split(' ');\n            classValue = '';\n            for (ci = 0; ci < classList.length; ci++) {\n              className = classList[ci];\n              valid = false;\n              validClassesMap = validClasses['*'];\n              if (validClassesMap && validClassesMap[className]) {\n                valid = true;\n              }\n              validClassesMap = validClasses[node.name];\n              if (!valid && validClassesMap && validClassesMap[className]) {\n                valid = true;\n              }\n              if (valid) {\n                if (classValue) {\n                  classValue += ' ';\n                }\n                classValue += className;\n              }\n            }\n            if (!classValue.length) {\n              classValue = null;\n            }\n            node.attr('class', classValue);\n          }\n        });\n      }\n      registerBase64ImageFilter(parser, settings);\n    };\n\n    var makeMap$4 = Tools.makeMap, each$d = Tools.each, explode$2 = Tools.explode, extend$2 = Tools.extend;\n    var DomParser = function (settings, schema) {\n      if (schema === void 0) {\n        schema = Schema();\n      }\n      var nodeFilters = {};\n      var attributeFilters = [];\n      var matchedNodes = {};\n      var matchedAttributes = {};\n      settings = settings || {};\n      settings.validate = 'validate' in settings ? settings.validate : true;\n      settings.root_name = settings.root_name || 'body';\n      var fixInvalidChildren = function (nodes) {\n        var ni, node, parent, parents, newParent, currentNode, tempNode, childNode, i;\n        var sibling, nextNode;\n        var nonSplitableElements = makeMap$4('tr,td,th,tbody,thead,tfoot,table');\n        var nonEmptyElements = schema.getNonEmptyElements();\n        var whitespaceElements = schema.getWhiteSpaceElements();\n        var textBlockElements = schema.getTextBlockElements();\n        var specialElements = schema.getSpecialElements();\n        for (ni = 0; ni < nodes.length; ni++) {\n          node = nodes[ni];\n          if (!node.parent || node.fixed) {\n            continue;\n          }\n          if (textBlockElements[node.name] && node.parent.name === 'li') {\n            sibling = node.next;\n            while (sibling) {\n              if (textBlockElements[sibling.name]) {\n                sibling.name = 'li';\n                sibling.fixed = true;\n                node.parent.insert(sibling, node.parent);\n              } else {\n                break;\n              }\n              sibling = sibling.next;\n            }\n            node.unwrap(node);\n            continue;\n          }\n          parents = [node];\n          for (parent = node.parent; parent && !schema.isValidChild(parent.name, node.name) && !nonSplitableElements[parent.name]; parent = parent.parent) {\n            parents.push(parent);\n          }\n          if (parent && parents.length > 1) {\n            parents.reverse();\n            newParent = currentNode = filterNode(parents[0].clone());\n            for (i = 0; i < parents.length - 1; i++) {\n              if (schema.isValidChild(currentNode.name, parents[i].name)) {\n                tempNode = filterNode(parents[i].clone());\n                currentNode.append(tempNode);\n              } else {\n                tempNode = currentNode;\n              }\n              for (childNode = parents[i].firstChild; childNode && childNode !== parents[i + 1];) {\n                nextNode = childNode.next;\n                tempNode.append(childNode);\n                childNode = nextNode;\n              }\n              currentNode = tempNode;\n            }\n            if (!isEmpty$2(schema, nonEmptyElements, whitespaceElements, newParent)) {\n              parent.insert(newParent, parents[0], true);\n              parent.insert(node, newParent);\n            } else {\n              parent.insert(node, parents[0], true);\n            }\n            parent = parents[0];\n            if (isEmpty$2(schema, nonEmptyElements, whitespaceElements, parent) || hasOnlyChild(parent, 'br')) {\n              parent.empty().remove();\n            }\n          } else if (node.parent) {\n            if (node.name === 'li') {\n              sibling = node.prev;\n              if (sibling && (sibling.name === 'ul' || sibling.name === 'ol')) {\n                sibling.append(node);\n                continue;\n              }\n              sibling = node.next;\n              if (sibling && (sibling.name === 'ul' || sibling.name === 'ol')) {\n                sibling.insert(node, sibling.firstChild, true);\n                continue;\n              }\n              node.wrap(filterNode(new AstNode('ul', 1)));\n              continue;\n            }\n            if (schema.isValidChild(node.parent.name, 'div') && schema.isValidChild('div', node.name)) {\n              node.wrap(filterNode(new AstNode('div', 1)));\n            } else {\n              if (specialElements[node.name]) {\n                node.empty().remove();\n              } else {\n                node.unwrap();\n              }\n            }\n          }\n        }\n      };\n      var filterNode = function (node) {\n        var i, name, list;\n        name = node.name;\n        if (name in nodeFilters) {\n          list = matchedNodes[name];\n          if (list) {\n            list.push(node);\n          } else {\n            matchedNodes[name] = [node];\n          }\n        }\n        i = attributeFilters.length;\n        while (i--) {\n          name = attributeFilters[i].name;\n          if (name in node.attributes.map) {\n            list = matchedAttributes[name];\n            if (list) {\n              list.push(node);\n            } else {\n              matchedAttributes[name] = [node];\n            }\n          }\n        }\n        return node;\n      };\n      var addNodeFilter = function (name, callback) {\n        each$d(explode$2(name), function (name) {\n          var list = nodeFilters[name];\n          if (!list) {\n            nodeFilters[name] = list = [];\n          }\n          list.push(callback);\n        });\n      };\n      var getNodeFilters = function () {\n        var out = [];\n        for (var name_1 in nodeFilters) {\n          if (nodeFilters.hasOwnProperty(name_1)) {\n            out.push({\n              name: name_1,\n              callbacks: nodeFilters[name_1]\n            });\n          }\n        }\n        return out;\n      };\n      var addAttributeFilter = function (name, callback) {\n        each$d(explode$2(name), function (name) {\n          var i;\n          for (i = 0; i < attributeFilters.length; i++) {\n            if (attributeFilters[i].name === name) {\n              attributeFilters[i].callbacks.push(callback);\n              return;\n            }\n          }\n          attributeFilters.push({\n            name: name,\n            callbacks: [callback]\n          });\n        });\n      };\n      var getAttributeFilters = function () {\n        return [].concat(attributeFilters);\n      };\n      var parse = function (html, args) {\n        var nodes, i, l, fi, fl, list, name;\n        var invalidChildren = [];\n        var isInWhiteSpacePreservedElement;\n        var node;\n        var getRootBlockName = function (name) {\n          if (name === false) {\n            return '';\n          } else if (name === true) {\n            return 'p';\n          } else {\n            return name;\n          }\n        };\n        args = args || {};\n        matchedNodes = {};\n        matchedAttributes = {};\n        var blockElements = extend$2(makeMap$4('script,style,head,html,body,title,meta,param'), schema.getBlockElements());\n        var nonEmptyElements = schema.getNonEmptyElements();\n        var children = schema.children;\n        var validate = settings.validate;\n        var forcedRootBlockName = 'forced_root_block' in args ? args.forced_root_block : settings.forced_root_block;\n        var rootBlockName = getRootBlockName(forcedRootBlockName);\n        var whiteSpaceElements = schema.getWhiteSpaceElements();\n        var startWhiteSpaceRegExp = /^[ \\t\\r\\n]+/;\n        var endWhiteSpaceRegExp = /[ \\t\\r\\n]+$/;\n        var allWhiteSpaceRegExp = /[ \\t\\r\\n]+/g;\n        var isAllWhiteSpaceRegExp = /^[ \\t\\r\\n]+$/;\n        isInWhiteSpacePreservedElement = whiteSpaceElements.hasOwnProperty(args.context) || whiteSpaceElements.hasOwnProperty(settings.root_name);\n        var addRootBlocks = function () {\n          var node = rootNode.firstChild, next, rootBlockNode;\n          var trim = function (rootBlockNode) {\n            if (rootBlockNode) {\n              node = rootBlockNode.firstChild;\n              if (node && node.type === 3) {\n                node.value = node.value.replace(startWhiteSpaceRegExp, '');\n              }\n              node = rootBlockNode.lastChild;\n              if (node && node.type === 3) {\n                node.value = node.value.replace(endWhiteSpaceRegExp, '');\n              }\n            }\n          };\n          if (!schema.isValidChild(rootNode.name, rootBlockName.toLowerCase())) {\n            return;\n          }\n          while (node) {\n            next = node.next;\n            if (node.type === 3 || node.type === 1 && node.name !== 'p' && !blockElements[node.name] && !node.attr('data-mce-type')) {\n              if (!rootBlockNode) {\n                rootBlockNode = createNode(rootBlockName, 1);\n                rootBlockNode.attr(settings.forced_root_block_attrs);\n                rootNode.insert(rootBlockNode, node);\n                rootBlockNode.append(node);\n              } else {\n                rootBlockNode.append(node);\n              }\n            } else {\n              trim(rootBlockNode);\n              rootBlockNode = null;\n            }\n            node = next;\n          }\n          trim(rootBlockNode);\n        };\n        var createNode = function (name, type) {\n          var node = new AstNode(name, type);\n          var list;\n          if (name in nodeFilters) {\n            list = matchedNodes[name];\n            if (list) {\n              list.push(node);\n            } else {\n              matchedNodes[name] = [node];\n            }\n          }\n          return node;\n        };\n        var removeWhitespaceBefore = function (node) {\n          var textNode, textNodeNext, textVal, sibling;\n          var blockElements = schema.getBlockElements();\n          for (textNode = node.prev; textNode && textNode.type === 3;) {\n            textVal = textNode.value.replace(endWhiteSpaceRegExp, '');\n            if (textVal.length > 0) {\n              textNode.value = textVal;\n              return;\n            }\n            textNodeNext = textNode.next;\n            if (textNodeNext) {\n              if (textNodeNext.type === 3 && textNodeNext.value.length) {\n                textNode = textNode.prev;\n                continue;\n              }\n              if (!blockElements[textNodeNext.name] && textNodeNext.name !== 'script' && textNodeNext.name !== 'style') {\n                textNode = textNode.prev;\n                continue;\n              }\n            }\n            sibling = textNode.prev;\n            textNode.remove();\n            textNode = sibling;\n          }\n        };\n        var cloneAndExcludeBlocks = function (input) {\n          var name;\n          var output = {};\n          for (name in input) {\n            if (name !== 'li' && name !== 'p') {\n              output[name] = input[name];\n            }\n          }\n          return output;\n        };\n        var parser = SaxParser$1({\n          validate: validate,\n          allow_html_data_urls: settings.allow_html_data_urls,\n          allow_svg_data_urls: settings.allow_svg_data_urls,\n          allow_script_urls: settings.allow_script_urls,\n          allow_conditional_comments: settings.allow_conditional_comments,\n          preserve_cdata: settings.preserve_cdata,\n          self_closing_elements: cloneAndExcludeBlocks(schema.getSelfClosingElements()),\n          cdata: function (text) {\n            node.append(createNode('#cdata', 4)).value = text;\n          },\n          text: function (text, raw) {\n            var textNode;\n            if (!isInWhiteSpacePreservedElement) {\n              text = text.replace(allWhiteSpaceRegExp, ' ');\n              if (isLineBreakNode(node.lastChild, blockElements)) {\n                text = text.replace(startWhiteSpaceRegExp, '');\n              }\n            }\n            if (text.length !== 0) {\n              textNode = createNode('#text', 3);\n              textNode.raw = !!raw;\n              node.append(textNode).value = text;\n            }\n          },\n          comment: function (text) {\n            node.append(createNode('#comment', 8)).value = text;\n          },\n          pi: function (name, text) {\n            node.append(createNode(name, 7)).value = text;\n            removeWhitespaceBefore(node);\n          },\n          doctype: function (text) {\n            var newNode = node.append(createNode('#doctype', 10));\n            newNode.value = text;\n            removeWhitespaceBefore(node);\n          },\n          start: function (name, attrs, empty) {\n            var newNode, attrFiltersLen, attrName, parent;\n            var elementRule = validate ? schema.getElementRule(name) : {};\n            if (elementRule) {\n              newNode = createNode(elementRule.outputName || name, 1);\n              newNode.attributes = attrs;\n              newNode.shortEnded = empty;\n              node.append(newNode);\n              parent = children[node.name];\n              if (parent && children[newNode.name] && !parent[newNode.name]) {\n                invalidChildren.push(newNode);\n              }\n              attrFiltersLen = attributeFilters.length;\n              while (attrFiltersLen--) {\n                attrName = attributeFilters[attrFiltersLen].name;\n                if (attrName in attrs.map) {\n                  list = matchedAttributes[attrName];\n                  if (list) {\n                    list.push(newNode);\n                  } else {\n                    matchedAttributes[attrName] = [newNode];\n                  }\n                }\n              }\n              if (blockElements[name]) {\n                removeWhitespaceBefore(newNode);\n              }\n              if (!empty) {\n                node = newNode;\n              }\n              if (!isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n                isInWhiteSpacePreservedElement = true;\n              }\n            }\n          },\n          end: function (name) {\n            var textNode, text, sibling, tempNode;\n            var elementRule = validate ? schema.getElementRule(name) : {};\n            if (elementRule) {\n              if (blockElements[name]) {\n                if (!isInWhiteSpacePreservedElement) {\n                  textNode = node.firstChild;\n                  if (textNode && textNode.type === 3) {\n                    text = textNode.value.replace(startWhiteSpaceRegExp, '');\n                    if (text.length > 0) {\n                      textNode.value = text;\n                      textNode = textNode.next;\n                    } else {\n                      sibling = textNode.next;\n                      textNode.remove();\n                      textNode = sibling;\n                      while (textNode && textNode.type === 3) {\n                        text = textNode.value;\n                        sibling = textNode.next;\n                        if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n                          textNode.remove();\n                          textNode = sibling;\n                        }\n                        textNode = sibling;\n                      }\n                    }\n                  }\n                  textNode = node.lastChild;\n                  if (textNode && textNode.type === 3) {\n                    text = textNode.value.replace(endWhiteSpaceRegExp, '');\n                    if (text.length > 0) {\n                      textNode.value = text;\n                      textNode = textNode.prev;\n                    } else {\n                      sibling = textNode.prev;\n                      textNode.remove();\n                      textNode = sibling;\n                      while (textNode && textNode.type === 3) {\n                        text = textNode.value;\n                        sibling = textNode.prev;\n                        if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n                          textNode.remove();\n                          textNode = sibling;\n                        }\n                        textNode = sibling;\n                      }\n                    }\n                  }\n                }\n              }\n              if (isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n                isInWhiteSpacePreservedElement = false;\n              }\n              if (elementRule.removeEmpty && isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node)) {\n                tempNode = node.parent;\n                if (blockElements[node.name]) {\n                  node.empty().remove();\n                } else {\n                  node.unwrap();\n                }\n                node = tempNode;\n                return;\n              }\n              if (elementRule.paddEmpty && (isPaddedWithNbsp(node) || isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node))) {\n                paddEmptyNode(settings, args, blockElements, node);\n              }\n              node = node.parent;\n            }\n          }\n        }, schema);\n        var rootNode = node = new AstNode(args.context || settings.root_name, 11);\n        parser.parse(html, args.format);\n        if (validate && invalidChildren.length) {\n          if (!args.context) {\n            fixInvalidChildren(invalidChildren);\n          } else {\n            args.invalid = true;\n          }\n        }\n        if (rootBlockName && (rootNode.name === 'body' || args.isRootContent)) {\n          addRootBlocks();\n        }\n        if (!args.invalid) {\n          for (name in matchedNodes) {\n            if (!matchedNodes.hasOwnProperty(name)) {\n              continue;\n            }\n            list = nodeFilters[name];\n            nodes = matchedNodes[name];\n            fi = nodes.length;\n            while (fi--) {\n              if (!nodes[fi].parent) {\n                nodes.splice(fi, 1);\n              }\n            }\n            for (i = 0, l = list.length; i < l; i++) {\n              list[i](nodes, name, args);\n            }\n          }\n          for (i = 0, l = attributeFilters.length; i < l; i++) {\n            list = attributeFilters[i];\n            if (list.name in matchedAttributes) {\n              nodes = matchedAttributes[list.name];\n              fi = nodes.length;\n              while (fi--) {\n                if (!nodes[fi].parent) {\n                  nodes.splice(fi, 1);\n                }\n              }\n              for (fi = 0, fl = list.callbacks.length; fi < fl; fi++) {\n                list.callbacks[fi](nodes, list.name, args);\n              }\n            }\n          }\n        }\n        return rootNode;\n      };\n      var exports = {\n        schema: schema,\n        addAttributeFilter: addAttributeFilter,\n        getAttributeFilters: getAttributeFilters,\n        addNodeFilter: addNodeFilter,\n        getNodeFilters: getNodeFilters,\n        filterNode: filterNode,\n        parse: parse\n      };\n      register$2(exports, settings);\n      register$1(exports, settings);\n      return exports;\n    };\n\n    var register$3 = function (htmlParser, settings, dom) {\n      htmlParser.addAttributeFilter('data-mce-tabindex', function (nodes, name) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          node.attr('tabindex', node.attr('data-mce-tabindex'));\n          node.attr(name, null);\n        }\n      });\n      htmlParser.addAttributeFilter('src,href,style', function (nodes, name) {\n        var i = nodes.length, node, value;\n        var internalName = 'data-mce-' + name;\n        var urlConverter = settings.url_converter;\n        var urlConverterScope = settings.url_converter_scope;\n        while (i--) {\n          node = nodes[i];\n          value = node.attr(internalName);\n          if (value !== undefined) {\n            node.attr(name, value.length > 0 ? value : null);\n            node.attr(internalName, null);\n          } else {\n            value = node.attr(name);\n            if (name === 'style') {\n              value = dom.serializeStyle(dom.parseStyle(value), node.name);\n            } else if (urlConverter) {\n              value = urlConverter.call(urlConverterScope, value, name, node.name);\n            }\n            node.attr(name, value.length > 0 ? value : null);\n          }\n        }\n      });\n      htmlParser.addAttributeFilter('class', function (nodes) {\n        var i = nodes.length, node, value;\n        while (i--) {\n          node = nodes[i];\n          value = node.attr('class');\n          if (value) {\n            value = node.attr('class').replace(/(?:^|\\s)mce-item-\\w+(?!\\S)/g, '');\n            node.attr('class', value.length > 0 ? value : null);\n          }\n        }\n      });\n      htmlParser.addAttributeFilter('data-mce-type', function (nodes, name, args) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          if (node.attr('data-mce-type') === 'bookmark' && !args.cleanup) {\n            var hasChildren = Optional.from(node.firstChild).exists(function (firstChild) {\n              return !isZwsp$1(firstChild.value);\n            });\n            if (hasChildren) {\n              node.unwrap();\n            } else {\n              node.remove();\n            }\n          }\n        }\n      });\n      htmlParser.addNodeFilter('noscript', function (nodes) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i].firstChild;\n          if (node) {\n            node.value = Entities.decode(node.value);\n          }\n        }\n      });\n      htmlParser.addNodeFilter('script,style', function (nodes, name) {\n        var i = nodes.length, node, value, type;\n        var trim = function (value) {\n          return value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n').replace(/^[\\r\\n]*|[\\r\\n]*$/g, '').replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi, '').replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g, '');\n        };\n        while (i--) {\n          node = nodes[i];\n          value = node.firstChild ? node.firstChild.value : '';\n          if (name === 'script') {\n            type = node.attr('type');\n            if (type) {\n              node.attr('type', type === 'mce-no/type' ? null : type.replace(/^mce\\-/, ''));\n            }\n            if (settings.element_format === 'xhtml' && value.length > 0) {\n              node.firstChild.value = '// <![CDATA[\\n' + trim(value) + '\\n// ]]>';\n            }\n          } else {\n            if (settings.element_format === 'xhtml' && value.length > 0) {\n              node.firstChild.value = '<!--\\n' + trim(value) + '\\n-->';\n            }\n          }\n        }\n      });\n      htmlParser.addNodeFilter('#comment', function (nodes) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          if (settings.preserve_cdata && node.value.indexOf('[CDATA[') === 0) {\n            node.name = '#cdata';\n            node.type = 4;\n            node.value = dom.decode(node.value.replace(/^\\[CDATA\\[|\\]\\]$/g, ''));\n          } else if (node.value.indexOf('mce:protected ') === 0) {\n            node.name = '#text';\n            node.type = 3;\n            node.raw = true;\n            node.value = unescape(node.value).substr(14);\n          }\n        }\n      });\n      htmlParser.addNodeFilter('xml:namespace,input', function (nodes, name) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          if (node.type === 7) {\n            node.remove();\n          } else if (node.type === 1) {\n            if (name === 'input' && !node.attr('type')) {\n              node.attr('type', 'text');\n            }\n          }\n        }\n      });\n      htmlParser.addAttributeFilter('data-mce-type', function (nodes) {\n        each(nodes, function (node) {\n          if (node.attr('data-mce-type') === 'format-caret') {\n            if (node.isEmpty(htmlParser.schema.getNonEmptyElements())) {\n              node.remove();\n            } else {\n              node.unwrap();\n            }\n          }\n        });\n      });\n      htmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style,' + 'data-mce-selected,data-mce-expando,' + 'data-mce-type,data-mce-resize,data-mce-placeholder', function (nodes, name) {\n        var i = nodes.length;\n        while (i--) {\n          nodes[i].attr(name, null);\n        }\n      });\n    };\n    var trimTrailingBr = function (rootNode) {\n      var isBr = function (node) {\n        return node && node.name === 'br';\n      };\n      var brNode1 = rootNode.lastChild;\n      if (isBr(brNode1)) {\n        var brNode2 = brNode1.prev;\n        if (isBr(brNode2)) {\n          brNode1.remove();\n          brNode2.remove();\n        }\n      }\n    };\n\n    var preProcess = function (editor, node, args) {\n      var doc, oldDoc;\n      var dom = editor.dom;\n      node = node.cloneNode(true);\n      var impl = document.implementation;\n      if (impl.createHTMLDocument) {\n        doc = impl.createHTMLDocument('');\n        Tools.each(node.nodeName === 'BODY' ? node.childNodes : [node], function (node) {\n          doc.body.appendChild(doc.importNode(node, true));\n        });\n        if (node.nodeName !== 'BODY') {\n          node = doc.body.firstChild;\n        } else {\n          node = doc.body;\n        }\n        oldDoc = dom.doc;\n        dom.doc = doc;\n      }\n      firePreProcess(editor, __assign(__assign({}, args), { node: node }));\n      if (oldDoc) {\n        dom.doc = oldDoc;\n      }\n      return node;\n    };\n    var shouldFireEvent = function (editor, args) {\n      return editor && editor.hasEventListeners('PreProcess') && !args.no_events;\n    };\n    var process = function (editor, node, args) {\n      return shouldFireEvent(editor, args) ? preProcess(editor, node, args) : node;\n    };\n\n    var addTempAttr = function (htmlParser, tempAttrs, name) {\n      if (Tools.inArray(tempAttrs, name) === -1) {\n        htmlParser.addAttributeFilter(name, function (nodes, name) {\n          var i = nodes.length;\n          while (i--) {\n            nodes[i].attr(name, null);\n          }\n        });\n        tempAttrs.push(name);\n      }\n    };\n    var postProcess$1 = function (editor, args, content) {\n      if (!args.no_events && editor) {\n        var outArgs = firePostProcess(editor, __assign(__assign({}, args), { content: content }));\n        return outArgs.content;\n      } else {\n        return content;\n      }\n    };\n    var getHtmlFromNode = function (dom, node, args) {\n      var html = trim$2(args.getInner ? node.innerHTML : dom.getOuterHTML(node));\n      return args.selection || isWsPreserveElement(SugarElement.fromDom(node)) ? html : Tools.trim(html);\n    };\n    var parseHtml = function (htmlParser, html, args) {\n      var parserArgs = args.selection ? __assign({ forced_root_block: false }, args) : args;\n      var rootNode = htmlParser.parse(html, parserArgs);\n      trimTrailingBr(rootNode);\n      return rootNode;\n    };\n    var serializeNode = function (settings, schema, node) {\n      var htmlSerializer = HtmlSerializer(settings, schema);\n      return htmlSerializer.serialize(node);\n    };\n    var toHtml = function (editor, settings, schema, rootNode, args) {\n      var content = serializeNode(settings, schema, rootNode);\n      return postProcess$1(editor, args, content);\n    };\n    var DomSerializerImpl = function (settings, editor) {\n      var tempAttrs = ['data-mce-selected'];\n      var dom = editor && editor.dom ? editor.dom : DOMUtils$1.DOM;\n      var schema = editor && editor.schema ? editor.schema : Schema(settings);\n      settings.entity_encoding = settings.entity_encoding || 'named';\n      settings.remove_trailing_brs = 'remove_trailing_brs' in settings ? settings.remove_trailing_brs : true;\n      var htmlParser = DomParser(settings, schema);\n      register$3(htmlParser, settings, dom);\n      var serialize = function (node, parserArgs) {\n        if (parserArgs === void 0) {\n          parserArgs = {};\n        }\n        var args = __assign({ format: 'html' }, parserArgs);\n        var targetNode = process(editor, node, args);\n        var html = getHtmlFromNode(dom, targetNode, args);\n        var rootNode = parseHtml(htmlParser, html, args);\n        return args.format === 'tree' ? rootNode : toHtml(editor, settings, schema, rootNode, args);\n      };\n      return {\n        schema: schema,\n        addNodeFilter: htmlParser.addNodeFilter,\n        addAttributeFilter: htmlParser.addAttributeFilter,\n        serialize: serialize,\n        addRules: function (rules) {\n          schema.addValidElements(rules);\n        },\n        setRules: function (rules) {\n          schema.setValidElements(rules);\n        },\n        addTempAttr: curry(addTempAttr, htmlParser, tempAttrs),\n        getTempAttrs: function () {\n          return tempAttrs;\n        },\n        getNodeFilters: htmlParser.getNodeFilters,\n        getAttributeFilters: htmlParser.getAttributeFilters\n      };\n    };\n\n    var DomSerializer = function (settings, editor) {\n      var domSerializer = DomSerializerImpl(settings, editor);\n      return {\n        schema: domSerializer.schema,\n        addNodeFilter: domSerializer.addNodeFilter,\n        addAttributeFilter: domSerializer.addAttributeFilter,\n        serialize: domSerializer.serialize,\n        addRules: domSerializer.addRules,\n        setRules: domSerializer.setRules,\n        addTempAttr: domSerializer.addTempAttr,\n        getTempAttrs: domSerializer.getTempAttrs,\n        getNodeFilters: domSerializer.getNodeFilters,\n        getAttributeFilters: domSerializer.getAttributeFilters\n      };\n    };\n\n    var defaultFormat$1 = 'html';\n    var getContent$2 = function (editor, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      var format = args.format ? args.format : defaultFormat$1;\n      return getContent(editor, args, format);\n    };\n\n    var setContent$2 = function (editor, content, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      return setContent(editor, content, args);\n    };\n\n    var DOM$3 = DOMUtils$1.DOM;\n    var restoreOriginalStyles = function (editor) {\n      DOM$3.setStyle(editor.id, 'display', editor.orgDisplay);\n    };\n    var safeDestroy = function (x) {\n      return Optional.from(x).each(function (x) {\n        return x.destroy();\n      });\n    };\n    var clearDomReferences = function (editor) {\n      editor.contentAreaContainer = editor.formElement = editor.container = editor.editorContainer = null;\n      editor.bodyElement = editor.contentDocument = editor.contentWindow = null;\n      editor.iframeElement = editor.targetElm = null;\n      if (editor.selection) {\n        editor.selection = editor.selection.win = editor.selection.dom = editor.selection.dom.doc = null;\n      }\n    };\n    var restoreForm = function (editor) {\n      var form = editor.formElement;\n      if (form) {\n        if (form._mceOldSubmit) {\n          form.submit = form._mceOldSubmit;\n          form._mceOldSubmit = null;\n        }\n        DOM$3.unbind(form, 'submit reset', editor.formEventDelegate);\n      }\n    };\n    var remove$7 = function (editor) {\n      if (!editor.removed) {\n        var _selectionOverrides = editor._selectionOverrides, editorUpload = editor.editorUpload;\n        var body = editor.getBody();\n        var element = editor.getElement();\n        if (body) {\n          editor.save({ is_removing: true });\n        }\n        editor.removed = true;\n        editor.unbindAllNativeEvents();\n        if (editor.hasHiddenInput && element) {\n          DOM$3.remove(element.nextSibling);\n        }\n        fireRemove(editor);\n        editor.editorManager.remove(editor);\n        if (!editor.inline && body) {\n          restoreOriginalStyles(editor);\n        }\n        fireDetach(editor);\n        DOM$3.remove(editor.getContainer());\n        safeDestroy(_selectionOverrides);\n        safeDestroy(editorUpload);\n        editor.destroy();\n      }\n    };\n    var destroy = function (editor, automatic) {\n      var selection = editor.selection, dom = editor.dom;\n      if (editor.destroyed) {\n        return;\n      }\n      if (!automatic && !editor.removed) {\n        editor.remove();\n        return;\n      }\n      if (!automatic) {\n        editor.editorManager.off('beforeunload', editor._beforeUnload);\n        if (editor.theme && editor.theme.destroy) {\n          editor.theme.destroy();\n        }\n        safeDestroy(selection);\n        safeDestroy(dom);\n      }\n      restoreForm(editor);\n      clearDomReferences(editor);\n      editor.destroyed = true;\n    };\n\n    var hasOwnProperty$2 = Object.prototype.hasOwnProperty;\n    var deep$1 = function (old, nu) {\n      var bothObjects = isObject(old) && isObject(nu);\n      return bothObjects ? deepMerge(old, nu) : nu;\n    };\n    var baseMerge = function (merger) {\n      return function () {\n        var objects = new Array(arguments.length);\n        for (var i = 0; i < objects.length; i++) {\n          objects[i] = arguments[i];\n        }\n        if (objects.length === 0) {\n          throw new Error('Can\\'t merge zero objects');\n        }\n        var ret = {};\n        for (var j = 0; j < objects.length; j++) {\n          var curObject = objects[j];\n          for (var key in curObject) {\n            if (hasOwnProperty$2.call(curObject, key)) {\n              ret[key] = merger(ret[key], curObject[key]);\n            }\n          }\n        }\n        return ret;\n      };\n    };\n    var deepMerge = baseMerge(deep$1);\n\n    var sectionResult = function (sections, settings) {\n      return {\n        sections: constant(sections),\n        settings: constant(settings)\n      };\n    };\n    var deviceDetection = detect$3().deviceType;\n    var isTouch = deviceDetection.isTouch();\n    var isPhone = deviceDetection.isPhone();\n    var isTablet = deviceDetection.isTablet();\n    var legacyMobilePlugins = [\n      'lists',\n      'autolink',\n      'autosave'\n    ];\n    var defaultTouchSettings = {\n      table_grid: false,\n      object_resizing: false,\n      resize: false\n    };\n    var normalizePlugins = function (plugins) {\n      var pluginNames = isArray(plugins) ? plugins.join(' ') : plugins;\n      var trimmedPlugins = map(isString(pluginNames) ? pluginNames.split(' ') : [], trim);\n      return filter(trimmedPlugins, function (item) {\n        return item.length > 0;\n      });\n    };\n    var filterLegacyMobilePlugins = function (plugins) {\n      return filter(plugins, curry(contains, legacyMobilePlugins));\n    };\n    var extractSections = function (keys, settings) {\n      var result = bifilter(settings, function (value, key) {\n        return contains(keys, key);\n      });\n      return sectionResult(result.t, result.f);\n    };\n    var getSection = function (sectionResult, name, defaults) {\n      if (defaults === void 0) {\n        defaults = {};\n      }\n      var sections = sectionResult.sections();\n      var sectionSettings = sections.hasOwnProperty(name) ? sections[name] : {};\n      return Tools.extend({}, defaults, sectionSettings);\n    };\n    var hasSection = function (sectionResult, name) {\n      return sectionResult.sections().hasOwnProperty(name);\n    };\n    var isSectionTheme = function (sectionResult, name, theme) {\n      var section = sectionResult.sections();\n      return hasSection(sectionResult, name) && section[name].theme === theme;\n    };\n    var getSectionConfig = function (sectionResult, name) {\n      return hasSection(sectionResult, name) ? sectionResult.sections()[name] : {};\n    };\n    var getToolbarMode = function (settings, defaultVal) {\n      return get$1(settings, 'toolbar_mode').orThunk(function () {\n        return get$1(settings, 'toolbar_drawer').map(function (val) {\n          return val === false ? 'wrap' : val;\n        });\n      }).getOr(defaultVal);\n    };\n    var getDefaultSettings = function (settings, id, documentBaseUrl, isTouch, editor) {\n      var baseDefaults = {\n        id: id,\n        theme: 'silver',\n        toolbar_mode: getToolbarMode(settings, 'floating'),\n        plugins: '',\n        document_base_url: documentBaseUrl,\n        add_form_submit_trigger: true,\n        submit_patch: true,\n        add_unload_trigger: true,\n        convert_urls: true,\n        relative_urls: true,\n        remove_script_host: true,\n        object_resizing: true,\n        doctype: '<!DOCTYPE html>',\n        visual: true,\n        font_size_legacy_values: 'xx-small,small,medium,large,x-large,xx-large,300%',\n        forced_root_block: 'p',\n        hidden_input: true,\n        inline_styles: true,\n        convert_fonts_to_spans: true,\n        indent: true,\n        indent_before: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n        indent_after: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n        entity_encoding: 'named',\n        url_converter: editor.convertURL,\n        url_converter_scope: editor\n      };\n      return __assign(__assign({}, baseDefaults), isTouch ? defaultTouchSettings : {});\n    };\n    var getDefaultMobileSettings = function (mobileSettings, isPhone) {\n      var defaultMobileSettings = {\n        resize: false,\n        toolbar_mode: getToolbarMode(mobileSettings, 'scrolling'),\n        toolbar_sticky: false\n      };\n      var defaultPhoneSettings = { menubar: false };\n      return __assign(__assign(__assign({}, defaultTouchSettings), defaultMobileSettings), isPhone ? defaultPhoneSettings : {});\n    };\n    var getExternalPlugins$1 = function (overrideSettings, settings) {\n      var userDefinedExternalPlugins = settings.external_plugins ? settings.external_plugins : {};\n      if (overrideSettings && overrideSettings.external_plugins) {\n        return Tools.extend({}, overrideSettings.external_plugins, userDefinedExternalPlugins);\n      } else {\n        return userDefinedExternalPlugins;\n      }\n    };\n    var combinePlugins = function (forcedPlugins, plugins) {\n      return [].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins));\n    };\n    var getPlatformPlugins = function (isMobileDevice, sectionResult, desktopPlugins, mobilePlugins) {\n      if (isMobileDevice && isSectionTheme(sectionResult, 'mobile', 'mobile')) {\n        return filterLegacyMobilePlugins(mobilePlugins);\n      } else if (isMobileDevice && hasSection(sectionResult, 'mobile')) {\n        return mobilePlugins;\n      } else {\n        return desktopPlugins;\n      }\n    };\n    var processPlugins = function (isMobileDevice, sectionResult, defaultOverrideSettings, settings) {\n      var forcedPlugins = normalizePlugins(defaultOverrideSettings.forced_plugins);\n      var desktopPlugins = normalizePlugins(settings.plugins);\n      var mobileConfig = getSectionConfig(sectionResult, 'mobile');\n      var mobilePlugins = mobileConfig.plugins ? normalizePlugins(mobileConfig.plugins) : desktopPlugins;\n      var platformPlugins = getPlatformPlugins(isMobileDevice, sectionResult, desktopPlugins, mobilePlugins);\n      var combinedPlugins = combinePlugins(forcedPlugins, platformPlugins);\n      if (Env.browser.isIE() && contains(combinedPlugins, 'rtc')) {\n        throw new Error('RTC plugin is not supported on IE 11.');\n      }\n      return Tools.extend(settings, { plugins: combinedPlugins.join(' ') });\n    };\n    var isOnMobile = function (isMobileDevice, sectionResult) {\n      return isMobileDevice && hasSection(sectionResult, 'mobile');\n    };\n    var combineSettings = function (isMobileDevice, isPhone, defaultSettings, defaultOverrideSettings, settings) {\n      var defaultDeviceSettings = isMobileDevice ? { mobile: getDefaultMobileSettings(settings.mobile || {}, isPhone) } : {};\n      var sectionResult = extractSections(['mobile'], deepMerge(defaultDeviceSettings, settings));\n      var extendedSettings = Tools.extend(defaultSettings, defaultOverrideSettings, sectionResult.settings(), isOnMobile(isMobileDevice, sectionResult) ? getSection(sectionResult, 'mobile') : {}, {\n        validate: true,\n        external_plugins: getExternalPlugins$1(defaultOverrideSettings, sectionResult.settings())\n      });\n      return processPlugins(isMobileDevice, sectionResult, defaultOverrideSettings, extendedSettings);\n    };\n    var getEditorSettings = function (editor, id, documentBaseUrl, defaultOverrideSettings, settings) {\n      var defaultSettings = getDefaultSettings(settings, id, documentBaseUrl, isTouch, editor);\n      return combineSettings(isPhone || isTablet, isPhone, defaultSettings, defaultOverrideSettings, settings);\n    };\n    var getFiltered = function (predicate, editor, name) {\n      return Optional.from(editor.settings[name]).filter(predicate);\n    };\n    var getParamObject = function (value) {\n      var output = {};\n      if (typeof value === 'string') {\n        each(value.indexOf('=') > 0 ? value.split(/[;,](?![^=;,]*(?:[;,]|$))/) : value.split(','), function (val) {\n          var arr = val.split('=');\n          if (arr.length > 1) {\n            output[Tools.trim(arr[0])] = Tools.trim(arr[1]);\n          } else {\n            output[Tools.trim(arr[0])] = Tools.trim(arr[0]);\n          }\n        });\n      } else {\n        output = value;\n      }\n      return output;\n    };\n    var isArrayOf = function (p) {\n      return function (a) {\n        return isArray(a) && forall(a, p);\n      };\n    };\n    var getParam = function (editor, name, defaultVal, type) {\n      var value = name in editor.settings ? editor.settings[name] : defaultVal;\n      if (type === 'hash') {\n        return getParamObject(value);\n      } else if (type === 'string') {\n        return getFiltered(isString, editor, name).getOr(defaultVal);\n      } else if (type === 'number') {\n        return getFiltered(isNumber, editor, name).getOr(defaultVal);\n      } else if (type === 'boolean') {\n        return getFiltered(isBoolean, editor, name).getOr(defaultVal);\n      } else if (type === 'object') {\n        return getFiltered(isObject, editor, name).getOr(defaultVal);\n      } else if (type === 'array') {\n        return getFiltered(isArray, editor, name).getOr(defaultVal);\n      } else if (type === 'string[]') {\n        return getFiltered(isArrayOf(isString), editor, name).getOr(defaultVal);\n      } else if (type === 'function') {\n        return getFiltered(isFunction, editor, name).getOr(defaultVal);\n      } else {\n        return value;\n      }\n    };\n\n    var CreateIconManager = function () {\n      var lookup = {};\n      var add = function (id, iconPack) {\n        lookup[id] = iconPack;\n      };\n      var get = function (id) {\n        if (lookup[id]) {\n          return lookup[id];\n        }\n        return { icons: {} };\n      };\n      var has$1 = function (id) {\n        return has(lookup, id);\n      };\n      return {\n        add: add,\n        get: get,\n        has: has$1\n      };\n    };\n    var IconManager = CreateIconManager();\n\n    var getProp = function (propName, elm) {\n      var rawElm = elm.dom;\n      return rawElm[propName];\n    };\n    var getComputedSizeProp = function (propName, elm) {\n      return parseInt(get$5(elm, propName), 10);\n    };\n    var getClientWidth = curry(getProp, 'clientWidth');\n    var getClientHeight = curry(getProp, 'clientHeight');\n    var getMarginTop = curry(getComputedSizeProp, 'margin-top');\n    var getMarginLeft = curry(getComputedSizeProp, 'margin-left');\n    var getBoundingClientRect$1 = function (elm) {\n      return elm.dom.getBoundingClientRect();\n    };\n    var isInsideElementContentArea = function (bodyElm, clientX, clientY) {\n      var clientWidth = getClientWidth(bodyElm);\n      var clientHeight = getClientHeight(bodyElm);\n      return clientX >= 0 && clientY >= 0 && clientX <= clientWidth && clientY <= clientHeight;\n    };\n    var transpose = function (inline, elm, clientX, clientY) {\n      var clientRect = getBoundingClientRect$1(elm);\n      var deltaX = inline ? clientRect.left + elm.dom.clientLeft + getMarginLeft(elm) : 0;\n      var deltaY = inline ? clientRect.top + elm.dom.clientTop + getMarginTop(elm) : 0;\n      var x = clientX - deltaX;\n      var y = clientY - deltaY;\n      return {\n        x: x,\n        y: y\n      };\n    };\n    var isXYInContentArea = function (editor, clientX, clientY) {\n      var bodyElm = SugarElement.fromDom(editor.getBody());\n      var targetElm = editor.inline ? bodyElm : documentElement(bodyElm);\n      var transposedPoint = transpose(editor.inline, targetElm, clientX, clientY);\n      return isInsideElementContentArea(targetElm, transposedPoint.x, transposedPoint.y);\n    };\n    var fromDomSafe = function (node) {\n      return Optional.from(node).map(SugarElement.fromDom);\n    };\n    var isEditorAttachedToDom = function (editor) {\n      var rawContainer = editor.inline ? editor.getBody() : editor.getContentAreaContainer();\n      return fromDomSafe(rawContainer).map(inBody).getOr(false);\n    };\n\n    function NotificationManagerImpl() {\n      var unimplemented = function () {\n        throw new Error('Theme did not provide a NotificationManager implementation.');\n      };\n      return {\n        open: unimplemented,\n        close: unimplemented,\n        reposition: unimplemented,\n        getArgs: unimplemented\n      };\n    }\n\n    function NotificationManager(editor) {\n      var notifications = [];\n      var getImplementation = function () {\n        var theme = editor.theme;\n        return theme && theme.getNotificationManagerImpl ? theme.getNotificationManagerImpl() : NotificationManagerImpl();\n      };\n      var getTopNotification = function () {\n        return Optional.from(notifications[0]);\n      };\n      var isEqual = function (a, b) {\n        return a.type === b.type && a.text === b.text && !a.progressBar && !a.timeout && !b.progressBar && !b.timeout;\n      };\n      var reposition = function () {\n        if (notifications.length > 0) {\n          getImplementation().reposition(notifications);\n        }\n      };\n      var addNotification = function (notification) {\n        notifications.push(notification);\n      };\n      var closeNotification = function (notification) {\n        findIndex(notifications, function (otherNotification) {\n          return otherNotification === notification;\n        }).each(function (index) {\n          notifications.splice(index, 1);\n        });\n      };\n      var open = function (spec, fireEvent) {\n        if (fireEvent === void 0) {\n          fireEvent = true;\n        }\n        if (editor.removed || !isEditorAttachedToDom(editor)) {\n          return;\n        }\n        if (fireEvent) {\n          editor.fire('BeforeOpenNotification', { notification: spec });\n        }\n        return find(notifications, function (notification) {\n          return isEqual(getImplementation().getArgs(notification), spec);\n        }).getOrThunk(function () {\n          editor.editorManager.setActive(editor);\n          var notification = getImplementation().open(spec, function () {\n            closeNotification(notification);\n            reposition();\n            getTopNotification().fold(function () {\n              return editor.focus();\n            }, function (top) {\n              return focus(SugarElement.fromDom(top.getEl()));\n            });\n          });\n          addNotification(notification);\n          reposition();\n          editor.fire('OpenNotification', __assign({}, notification));\n          return notification;\n        });\n      };\n      var close = function () {\n        getTopNotification().each(function (notification) {\n          getImplementation().close(notification);\n          closeNotification(notification);\n          reposition();\n        });\n      };\n      var getNotifications = function () {\n        return notifications;\n      };\n      var registerEvents = function (editor) {\n        editor.on('SkinLoaded', function () {\n          var serviceMessage = getServiceMessage(editor);\n          if (serviceMessage) {\n            open({\n              text: serviceMessage,\n              type: 'warning',\n              timeout: 0\n            }, false);\n          }\n        });\n        editor.on('ResizeEditor ResizeWindow NodeChange', function () {\n          Delay.requestAnimationFrame(reposition);\n        });\n        editor.on('remove', function () {\n          each(notifications.slice(), function (notification) {\n            getImplementation().close(notification);\n          });\n        });\n      };\n      registerEvents(editor);\n      return {\n        open: open,\n        close: close,\n        getNotifications: getNotifications\n      };\n    }\n\n    var PluginManager = AddOnManager$1.PluginManager;\n\n    var ThemeManager = AddOnManager$1.ThemeManager;\n\n    function WindowManagerImpl () {\n      var unimplemented = function () {\n        throw new Error('Theme did not provide a WindowManager implementation.');\n      };\n      return {\n        open: unimplemented,\n        openUrl: unimplemented,\n        alert: unimplemented,\n        confirm: unimplemented,\n        close: unimplemented,\n        getParams: unimplemented,\n        setParams: unimplemented\n      };\n    }\n\n    var WindowManager = function (editor) {\n      var dialogs = [];\n      var getImplementation = function () {\n        var theme = editor.theme;\n        return theme && theme.getWindowManagerImpl ? theme.getWindowManagerImpl() : WindowManagerImpl();\n      };\n      var funcBind = function (scope, f) {\n        return function () {\n          return f ? f.apply(scope, arguments) : undefined;\n        };\n      };\n      var fireOpenEvent = function (dialog) {\n        editor.fire('OpenWindow', { dialog: dialog });\n      };\n      var fireCloseEvent = function (dialog) {\n        editor.fire('CloseWindow', { dialog: dialog });\n      };\n      var addDialog = function (dialog) {\n        dialogs.push(dialog);\n        fireOpenEvent(dialog);\n      };\n      var closeDialog = function (dialog) {\n        fireCloseEvent(dialog);\n        dialogs = filter(dialogs, function (otherDialog) {\n          return otherDialog !== dialog;\n        });\n        if (dialogs.length === 0) {\n          editor.focus();\n        }\n      };\n      var getTopDialog = function () {\n        return Optional.from(dialogs[dialogs.length - 1]);\n      };\n      var storeSelectionAndOpenDialog = function (openDialog) {\n        editor.editorManager.setActive(editor);\n        store(editor);\n        var dialog = openDialog();\n        addDialog(dialog);\n        return dialog;\n      };\n      var open = function (args, params) {\n        return storeSelectionAndOpenDialog(function () {\n          return getImplementation().open(args, params, closeDialog);\n        });\n      };\n      var openUrl = function (args) {\n        return storeSelectionAndOpenDialog(function () {\n          return getImplementation().openUrl(args, closeDialog);\n        });\n      };\n      var alert = function (message, callback, scope) {\n        getImplementation().alert(message, funcBind(scope ? scope : this, callback));\n      };\n      var confirm = function (message, callback, scope) {\n        getImplementation().confirm(message, funcBind(scope ? scope : this, callback));\n      };\n      var close = function () {\n        getTopDialog().each(function (dialog) {\n          getImplementation().close(dialog);\n          closeDialog(dialog);\n        });\n      };\n      editor.on('remove', function () {\n        each(dialogs, function (dialog) {\n          getImplementation().close(dialog);\n        });\n      });\n      return {\n        open: open,\n        openUrl: openUrl,\n        alert: alert,\n        confirm: confirm,\n        close: close\n      };\n    };\n\n    var displayNotification = function (editor, message) {\n      editor.notificationManager.open({\n        type: 'error',\n        text: message\n      });\n    };\n    var displayError = function (editor, message) {\n      if (editor._skinLoaded) {\n        displayNotification(editor, message);\n      } else {\n        editor.on('SkinLoaded', function () {\n          displayNotification(editor, message);\n        });\n      }\n    };\n    var uploadError = function (editor, message) {\n      displayError(editor, I18n.translate([\n        'Failed to upload image: {0}',\n        message\n      ]));\n    };\n    var logError = function (editor, errorType, msg) {\n      fireError(editor, errorType, { message: msg });\n      console.error(msg);\n    };\n    var createLoadError = function (type, url, name) {\n      return name ? 'Failed to load ' + type + ': ' + name + ' from url ' + url : 'Failed to load ' + type + ' url: ' + url;\n    };\n    var pluginLoadError = function (editor, url, name) {\n      logError(editor, 'PluginLoadError', createLoadError('plugin', url, name));\n    };\n    var iconsLoadError = function (editor, url, name) {\n      logError(editor, 'IconsLoadError', createLoadError('icons', url, name));\n    };\n    var languageLoadError = function (editor, url, name) {\n      logError(editor, 'LanguageLoadError', createLoadError('language', url, name));\n    };\n    var pluginInitError = function (editor, name, err) {\n      var message = I18n.translate([\n        'Failed to initialize plugin: {0}',\n        name\n      ]);\n      initError(message, err);\n      displayError(editor, message);\n    };\n    var initError = function (message) {\n      var x = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        x[_i - 1] = arguments[_i];\n      }\n      var console = window.console;\n      if (console) {\n        if (console.error) {\n          console.error.apply(console, __spreadArrays([message], x));\n        } else {\n          console.log.apply(console, __spreadArrays([message], x));\n        }\n      }\n    };\n\n    var isContentCssSkinName = function (url) {\n      return /^[a-z0-9\\-]+$/i.test(url);\n    };\n    var getContentCssUrls = function (editor) {\n      var contentCss = getContentCss(editor);\n      var skinUrl = editor.editorManager.baseURL + '/skins/content';\n      var suffix = editor.editorManager.suffix;\n      var contentCssFile = 'content' + suffix + '.css';\n      var inline = editor.inline === true;\n      return map(contentCss, function (url) {\n        if (isContentCssSkinName(url) && !inline) {\n          return skinUrl + '/' + url + '/' + contentCssFile;\n        } else {\n          return editor.documentBaseURI.toAbsolute(url);\n        }\n      });\n    };\n    var appendContentCssFromSettings = function (editor) {\n      editor.contentCSS = editor.contentCSS.concat(getContentCssUrls(editor));\n    };\n\n    function Uploader(uploadStatus, settings) {\n      var pendingPromises = {};\n      var pathJoin = function (path1, path2) {\n        if (path1) {\n          return path1.replace(/\\/$/, '') + '/' + path2.replace(/^\\//, '');\n        }\n        return path2;\n      };\n      var defaultHandler = function (blobInfo, success, failure, progress) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('POST', settings.url);\n        xhr.withCredentials = settings.credentials;\n        xhr.upload.onprogress = function (e) {\n          progress(e.loaded / e.total * 100);\n        };\n        xhr.onerror = function () {\n          failure('Image upload failed due to a XHR Transport error. Code: ' + xhr.status);\n        };\n        xhr.onload = function () {\n          if (xhr.status < 200 || xhr.status >= 300) {\n            failure('HTTP Error: ' + xhr.status);\n            return;\n          }\n          var json = JSON.parse(xhr.responseText);\n          if (!json || typeof json.location !== 'string') {\n            failure('Invalid JSON: ' + xhr.responseText);\n            return;\n          }\n          success(pathJoin(settings.basePath, json.location));\n        };\n        var formData = new FormData();\n        formData.append('file', blobInfo.blob(), blobInfo.filename());\n        xhr.send(formData);\n      };\n      var noUpload = function () {\n        return new promiseObj(function (resolve) {\n          resolve([]);\n        });\n      };\n      var handlerSuccess = function (blobInfo, url) {\n        return {\n          url: url,\n          blobInfo: blobInfo,\n          status: true\n        };\n      };\n      var handlerFailure = function (blobInfo, message, options) {\n        return {\n          url: '',\n          blobInfo: blobInfo,\n          status: false,\n          error: {\n            message: message,\n            options: options\n          }\n        };\n      };\n      var resolvePending = function (blobUri, result) {\n        Tools.each(pendingPromises[blobUri], function (resolve) {\n          resolve(result);\n        });\n        delete pendingPromises[blobUri];\n      };\n      var uploadBlobInfo = function (blobInfo, handler, openNotification) {\n        uploadStatus.markPending(blobInfo.blobUri());\n        return new promiseObj(function (resolve) {\n          var notification, progress;\n          var noop = function () {\n          };\n          try {\n            var closeNotification_1 = function () {\n              if (notification) {\n                notification.close();\n                progress = noop;\n              }\n            };\n            var success = function (url) {\n              closeNotification_1();\n              uploadStatus.markUploaded(blobInfo.blobUri(), url);\n              resolvePending(blobInfo.blobUri(), handlerSuccess(blobInfo, url));\n              resolve(handlerSuccess(blobInfo, url));\n            };\n            var failure = function (error, options) {\n              var failureOptions = options ? options : {};\n              closeNotification_1();\n              uploadStatus.removeFailed(blobInfo.blobUri());\n              resolvePending(blobInfo.blobUri(), handlerFailure(blobInfo, error, failureOptions));\n              resolve(handlerFailure(blobInfo, error, failureOptions));\n            };\n            progress = function (percent) {\n              if (percent < 0 || percent > 100) {\n                return;\n              }\n              if (!notification) {\n                notification = openNotification();\n              }\n              notification.progressBar.value(percent);\n            };\n            handler(blobInfo, success, failure, progress);\n          } catch (ex) {\n            resolve(handlerFailure(blobInfo, ex.message, {}));\n          }\n        });\n      };\n      var isDefaultHandler = function (handler) {\n        return handler === defaultHandler;\n      };\n      var pendingUploadBlobInfo = function (blobInfo) {\n        var blobUri = blobInfo.blobUri();\n        return new promiseObj(function (resolve) {\n          pendingPromises[blobUri] = pendingPromises[blobUri] || [];\n          pendingPromises[blobUri].push(resolve);\n        });\n      };\n      var uploadBlobs = function (blobInfos, openNotification) {\n        blobInfos = Tools.grep(blobInfos, function (blobInfo) {\n          return !uploadStatus.isUploaded(blobInfo.blobUri());\n        });\n        return promiseObj.all(Tools.map(blobInfos, function (blobInfo) {\n          return uploadStatus.isPending(blobInfo.blobUri()) ? pendingUploadBlobInfo(blobInfo) : uploadBlobInfo(blobInfo, settings.handler, openNotification);\n        }));\n      };\n      var upload = function (blobInfos, openNotification) {\n        return !settings.url && isDefaultHandler(settings.handler) ? noUpload() : uploadBlobs(blobInfos, openNotification);\n      };\n      if (isFunction(settings.handler) === false) {\n        settings.handler = defaultHandler;\n      }\n      return { upload: upload };\n    }\n\n    function UploadStatus () {\n      var PENDING = 1, UPLOADED = 2;\n      var blobUriStatuses = {};\n      var createStatus = function (status, resultUri) {\n        return {\n          status: status,\n          resultUri: resultUri\n        };\n      };\n      var hasBlobUri = function (blobUri) {\n        return blobUri in blobUriStatuses;\n      };\n      var getResultUri = function (blobUri) {\n        var result = blobUriStatuses[blobUri];\n        return result ? result.resultUri : null;\n      };\n      var isPending = function (blobUri) {\n        return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === PENDING : false;\n      };\n      var isUploaded = function (blobUri) {\n        return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === UPLOADED : false;\n      };\n      var markPending = function (blobUri) {\n        blobUriStatuses[blobUri] = createStatus(PENDING, null);\n      };\n      var markUploaded = function (blobUri, resultUri) {\n        blobUriStatuses[blobUri] = createStatus(UPLOADED, resultUri);\n      };\n      var removeFailed = function (blobUri) {\n        delete blobUriStatuses[blobUri];\n      };\n      var destroy = function () {\n        blobUriStatuses = {};\n      };\n      return {\n        hasBlobUri: hasBlobUri,\n        getResultUri: getResultUri,\n        isPending: isPending,\n        isUploaded: isUploaded,\n        markPending: markPending,\n        markUploaded: markUploaded,\n        removeFailed: removeFailed,\n        destroy: destroy\n      };\n    }\n\n    var count$1 = 0;\n    var seed = function () {\n      var rnd = function () {\n        return Math.round(Math.random() * 4294967295).toString(36);\n      };\n      var now = new Date().getTime();\n      return 's' + now.toString(36) + rnd() + rnd() + rnd();\n    };\n    var uuid = function (prefix) {\n      return prefix + count$1++ + seed();\n    };\n\n    var BlobCache = function () {\n      var cache = [];\n      var mimeToExt = function (mime) {\n        var mimes = {\n          'image/jpeg': 'jpg',\n          'image/jpg': 'jpg',\n          'image/gif': 'gif',\n          'image/png': 'png',\n          'image/apng': 'apng',\n          'image/avif': 'avif',\n          'image/svg+xml': 'svg',\n          'image/webp': 'webp',\n          'image/bmp': 'bmp',\n          'image/tiff': 'tiff'\n        };\n        return mimes[mime.toLowerCase()] || 'dat';\n      };\n      var create = function (o, blob, base64, name, filename) {\n        if (isString(o)) {\n          var id = o;\n          return toBlobInfo({\n            id: id,\n            name: name,\n            filename: filename,\n            blob: blob,\n            base64: base64\n          });\n        } else if (isObject(o)) {\n          return toBlobInfo(o);\n        } else {\n          throw new Error('Unknown input type');\n        }\n      };\n      var toBlobInfo = function (o) {\n        if (!o.blob || !o.base64) {\n          throw new Error('blob and base64 representations of the image are required for BlobInfo to be created');\n        }\n        var id = o.id || uuid('blobid');\n        var name = o.name || id;\n        var blob = o.blob;\n        return {\n          id: constant(id),\n          name: constant(name),\n          filename: constant(o.filename || name + '.' + mimeToExt(blob.type)),\n          blob: constant(blob),\n          base64: constant(o.base64),\n          blobUri: constant(o.blobUri || URL.createObjectURL(blob)),\n          uri: constant(o.uri)\n        };\n      };\n      var add = function (blobInfo) {\n        if (!get(blobInfo.id())) {\n          cache.push(blobInfo);\n        }\n      };\n      var findFirst = function (predicate) {\n        return find(cache, predicate).getOrUndefined();\n      };\n      var get = function (id) {\n        return findFirst(function (cachedBlobInfo) {\n          return cachedBlobInfo.id() === id;\n        });\n      };\n      var getByUri = function (blobUri) {\n        return findFirst(function (blobInfo) {\n          return blobInfo.blobUri() === blobUri;\n        });\n      };\n      var getByData = function (base64, type) {\n        return findFirst(function (blobInfo) {\n          return blobInfo.base64() === base64 && blobInfo.blob().type === type;\n        });\n      };\n      var removeByUri = function (blobUri) {\n        cache = filter(cache, function (blobInfo) {\n          if (blobInfo.blobUri() === blobUri) {\n            URL.revokeObjectURL(blobInfo.blobUri());\n            return false;\n          }\n          return true;\n        });\n      };\n      var destroy = function () {\n        each(cache, function (cachedBlobInfo) {\n          URL.revokeObjectURL(cachedBlobInfo.blobUri());\n        });\n        cache = [];\n      };\n      return {\n        create: create,\n        add: add,\n        get: get,\n        getByUri: getByUri,\n        getByData: getByData,\n        findFirst: findFirst,\n        removeByUri: removeByUri,\n        destroy: destroy\n      };\n    };\n\n    var UploadChangeHandler = function (editor) {\n      var lastChangedLevel = Cell(null);\n      editor.on('change AddUndo', function (e) {\n        lastChangedLevel.set(__assign({}, e.level));\n      });\n      var fireIfChanged = function () {\n        var data = editor.undoManager.data;\n        last(data).filter(function (level) {\n          return !isEq$4(lastChangedLevel.get(), level);\n        }).each(function (level) {\n          editor.setDirty(true);\n          editor.fire('change', {\n            level: level,\n            lastLevel: get(data, data.length - 2).getOrNull()\n          });\n        });\n      };\n      return { fireIfChanged: fireIfChanged };\n    };\n    var EditorUpload = function (editor) {\n      var blobCache = BlobCache();\n      var uploader, imageScanner;\n      var uploadStatus = UploadStatus();\n      var urlFilters = [];\n      var changeHandler = UploadChangeHandler(editor);\n      var aliveGuard = function (callback) {\n        return function (result) {\n          if (editor.selection) {\n            return callback(result);\n          }\n          return [];\n        };\n      };\n      var cacheInvalidator = function (url) {\n        return url + (url.indexOf('?') === -1 ? '?' : '&') + new Date().getTime();\n      };\n      var replaceString = function (content, search, replace) {\n        var index = 0;\n        do {\n          index = content.indexOf(search, index);\n          if (index !== -1) {\n            content = content.substring(0, index) + replace + content.substr(index + search.length);\n            index += replace.length - search.length + 1;\n          }\n        } while (index !== -1);\n        return content;\n      };\n      var replaceImageUrl = function (content, targetUrl, replacementUrl) {\n        var replacementString = 'src=\"' + replacementUrl + '\"' + (replacementUrl === Env.transparentSrc ? ' data-mce-placeholder=\"1\"' : '');\n        content = replaceString(content, 'src=\"' + targetUrl + '\"', replacementString);\n        content = replaceString(content, 'data-mce-src=\"' + targetUrl + '\"', 'data-mce-src=\"' + replacementUrl + '\"');\n        return content;\n      };\n      var replaceUrlInUndoStack = function (targetUrl, replacementUrl) {\n        each(editor.undoManager.data, function (level) {\n          if (level.type === 'fragmented') {\n            level.fragments = map(level.fragments, function (fragment) {\n              return replaceImageUrl(fragment, targetUrl, replacementUrl);\n            });\n          } else {\n            level.content = replaceImageUrl(level.content, targetUrl, replacementUrl);\n          }\n        });\n      };\n      var openNotification = function () {\n        return editor.notificationManager.open({\n          text: editor.translate('Image uploading...'),\n          type: 'info',\n          timeout: -1,\n          progressBar: true\n        });\n      };\n      var replaceImageUriInView = function (image, resultUri) {\n        var src = editor.convertURL(resultUri, 'src');\n        replaceUrlInUndoStack(image.src, resultUri);\n        editor.$(image).attr({\n          'src': shouldReuseFileName(editor) ? cacheInvalidator(resultUri) : resultUri,\n          'data-mce-src': src\n        });\n      };\n      var uploadImages = function (callback) {\n        if (!uploader) {\n          uploader = Uploader(uploadStatus, {\n            url: getImageUploadUrl(editor),\n            basePath: getImageUploadBasePath(editor),\n            credentials: getImagesUploadCredentials(editor),\n            handler: getImagesUploadHandler(editor)\n          });\n        }\n        return scanForImages().then(aliveGuard(function (imageInfos) {\n          var blobInfos = map(imageInfos, function (imageInfo) {\n            return imageInfo.blobInfo;\n          });\n          return uploader.upload(blobInfos, openNotification).then(aliveGuard(function (result) {\n            var imagesToRemove = [];\n            var filteredResult = map(result, function (uploadInfo, index) {\n              var blobInfo = imageInfos[index].blobInfo;\n              var image = imageInfos[index].image;\n              if (uploadInfo.status && shouldReplaceBlobUris(editor)) {\n                blobCache.removeByUri(image.src);\n                replaceImageUriInView(image, uploadInfo.url);\n              } else if (uploadInfo.error) {\n                if (uploadInfo.error.options.remove) {\n                  replaceUrlInUndoStack(image.getAttribute('src'), Env.transparentSrc);\n                  imagesToRemove.push(image);\n                }\n                uploadError(editor, uploadInfo.error.message);\n              }\n              return {\n                element: image,\n                status: uploadInfo.status,\n                uploadUri: uploadInfo.url,\n                blobInfo: blobInfo\n              };\n            });\n            if (filteredResult.length > 0) {\n              changeHandler.fireIfChanged();\n            }\n            if (imagesToRemove.length > 0) {\n              if (isRtc(editor)) {\n                console.error('Removing images on failed uploads is currently unsupported for RTC');\n              } else {\n                editor.undoManager.transact(function () {\n                  each(imagesToRemove, function (element) {\n                    editor.dom.remove(element);\n                    blobCache.removeByUri(element.src);\n                  });\n                });\n              }\n            }\n            if (callback) {\n              callback(filteredResult);\n            }\n            return filteredResult;\n          }));\n        }));\n      };\n      var uploadImagesAuto = function (callback) {\n        if (isAutomaticUploadsEnabled(editor)) {\n          return uploadImages(callback);\n        }\n      };\n      var isValidDataUriImage = function (imgElm) {\n        if (forall(urlFilters, function (filter) {\n            return filter(imgElm);\n          }) === false) {\n          return false;\n        }\n        if (imgElm.getAttribute('src').indexOf('data:') === 0) {\n          var dataImgFilter = getImagesDataImgFilter(editor);\n          return dataImgFilter(imgElm);\n        }\n        return true;\n      };\n      var addFilter = function (filter) {\n        urlFilters.push(filter);\n      };\n      var scanForImages = function () {\n        if (!imageScanner) {\n          imageScanner = ImageScanner(uploadStatus, blobCache);\n        }\n        return imageScanner.findAll(editor.getBody(), isValidDataUriImage).then(aliveGuard(function (result) {\n          result = filter(result, function (resultItem) {\n            if (typeof resultItem === 'string') {\n              displayError(editor, resultItem);\n              return false;\n            }\n            return true;\n          });\n          each(result, function (resultItem) {\n            replaceUrlInUndoStack(resultItem.image.src, resultItem.blobInfo.blobUri());\n            resultItem.image.src = resultItem.blobInfo.blobUri();\n            resultItem.image.removeAttribute('data-mce-src');\n          });\n          return result;\n        }));\n      };\n      var destroy = function () {\n        blobCache.destroy();\n        uploadStatus.destroy();\n        imageScanner = uploader = null;\n      };\n      var replaceBlobUris = function (content) {\n        return content.replace(/src=\"(blob:[^\"]+)\"/g, function (match, blobUri) {\n          var resultUri = uploadStatus.getResultUri(blobUri);\n          if (resultUri) {\n            return 'src=\"' + resultUri + '\"';\n          }\n          var blobInfo = blobCache.getByUri(blobUri);\n          if (!blobInfo) {\n            blobInfo = foldl(editor.editorManager.get(), function (result, editor) {\n              return result || editor.editorUpload && editor.editorUpload.blobCache.getByUri(blobUri);\n            }, null);\n          }\n          if (blobInfo) {\n            var blob = blobInfo.blob();\n            return 'src=\"data:' + blob.type + ';base64,' + blobInfo.base64() + '\"';\n          }\n          return match;\n        });\n      };\n      editor.on('SetContent', function () {\n        if (isAutomaticUploadsEnabled(editor)) {\n          uploadImagesAuto();\n        } else {\n          scanForImages();\n        }\n      });\n      editor.on('RawSaveContent', function (e) {\n        e.content = replaceBlobUris(e.content);\n      });\n      editor.on('GetContent', function (e) {\n        if (e.source_view || e.format === 'raw' || e.format === 'tree') {\n          return;\n        }\n        e.content = replaceBlobUris(e.content);\n      });\n      editor.on('PostRender', function () {\n        editor.parser.addNodeFilter('img', function (images) {\n          each(images, function (img) {\n            var src = img.attr('src');\n            if (blobCache.getByUri(src)) {\n              return;\n            }\n            var resultUri = uploadStatus.getResultUri(src);\n            if (resultUri) {\n              img.attr('src', resultUri);\n            }\n          });\n        });\n      });\n      return {\n        blobCache: blobCache,\n        addFilter: addFilter,\n        uploadImages: uploadImages,\n        uploadImagesAuto: uploadImagesAuto,\n        scanForImages: scanForImages,\n        destroy: destroy\n      };\n    };\n\n    var get$a = function (dom) {\n      var formats = {\n        valigntop: [{\n            selector: 'td,th',\n            styles: { verticalAlign: 'top' }\n          }],\n        valignmiddle: [{\n            selector: 'td,th',\n            styles: { verticalAlign: 'middle' }\n          }],\n        valignbottom: [{\n            selector: 'td,th',\n            styles: { verticalAlign: 'bottom' }\n          }],\n        alignleft: [\n          {\n            selector: 'figure.image',\n            collapsed: false,\n            classes: 'align-left',\n            ceFalseOverride: true,\n            preview: 'font-family font-size'\n          },\n          {\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'left' },\n            inherit: false,\n            preview: false,\n            defaultBlock: 'div'\n          },\n          {\n            selector: 'img,table',\n            collapsed: false,\n            styles: { float: 'left' },\n            preview: 'font-family font-size'\n          }\n        ],\n        aligncenter: [\n          {\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'center' },\n            inherit: false,\n            preview: 'font-family font-size',\n            defaultBlock: 'div'\n          },\n          {\n            selector: 'figure.image',\n            collapsed: false,\n            classes: 'align-center',\n            ceFalseOverride: true,\n            preview: 'font-family font-size'\n          },\n          {\n            selector: 'img',\n            collapsed: false,\n            styles: {\n              display: 'block',\n              marginLeft: 'auto',\n              marginRight: 'auto'\n            },\n            preview: false\n          },\n          {\n            selector: 'table',\n            collapsed: false,\n            styles: {\n              marginLeft: 'auto',\n              marginRight: 'auto'\n            },\n            preview: 'font-family font-size'\n          }\n        ],\n        alignright: [\n          {\n            selector: 'figure.image',\n            collapsed: false,\n            classes: 'align-right',\n            ceFalseOverride: true,\n            preview: 'font-family font-size'\n          },\n          {\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'right' },\n            inherit: false,\n            preview: 'font-family font-size',\n            defaultBlock: 'div'\n          },\n          {\n            selector: 'img,table',\n            collapsed: false,\n            styles: { float: 'right' },\n            preview: 'font-family font-size'\n          }\n        ],\n        alignjustify: [{\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'justify' },\n            inherit: false,\n            defaultBlock: 'div',\n            preview: 'font-family font-size'\n          }],\n        bold: [\n          {\n            inline: 'strong',\n            remove: 'all',\n            preserve_attributes: [\n              'class',\n              'style'\n            ]\n          },\n          {\n            inline: 'span',\n            styles: { fontWeight: 'bold' }\n          },\n          {\n            inline: 'b',\n            remove: 'all',\n            preserve_attributes: [\n              'class',\n              'style'\n            ]\n          }\n        ],\n        italic: [\n          {\n            inline: 'em',\n            remove: 'all',\n            preserve_attributes: [\n              'class',\n              'style'\n            ]\n          },\n          {\n            inline: 'span',\n            styles: { fontStyle: 'italic' }\n          },\n          {\n            inline: 'i',\n            remove: 'all',\n            preserve_attributes: [\n              'class',\n              'style'\n            ]\n          }\n        ],\n        underline: [\n          {\n            inline: 'span',\n            styles: { textDecoration: 'underline' },\n            exact: true\n          },\n          {\n            inline: 'u',\n            remove: 'all',\n            preserve_attributes: [\n              'class',\n              'style'\n            ]\n          }\n        ],\n        strikethrough: [\n          {\n            inline: 'span',\n            styles: { textDecoration: 'line-through' },\n            exact: true\n          },\n          {\n            inline: 'strike',\n            remove: 'all',\n            preserve_attributes: [\n              'class',\n              'style'\n            ]\n          },\n          {\n            inline: 's',\n            remove: 'all',\n            preserve_attributes: [\n              'class',\n              'style'\n            ]\n          }\n        ],\n        forecolor: {\n          inline: 'span',\n          styles: { color: '%value' },\n          links: true,\n          remove_similar: true,\n          clear_child_styles: true\n        },\n        hilitecolor: {\n          inline: 'span',\n          styles: { backgroundColor: '%value' },\n          links: true,\n          remove_similar: true,\n          clear_child_styles: true\n        },\n        fontname: {\n          inline: 'span',\n          toggle: false,\n          styles: { fontFamily: '%value' },\n          clear_child_styles: true\n        },\n        fontsize: {\n          inline: 'span',\n          toggle: false,\n          styles: { fontSize: '%value' },\n          clear_child_styles: true\n        },\n        lineheight: {\n          selector: 'h1,h2,h3,h4,h5,h6,p,li,td,th,div',\n          defaultBlock: 'p',\n          styles: { lineHeight: '%value' }\n        },\n        fontsize_class: {\n          inline: 'span',\n          attributes: { class: '%value' }\n        },\n        blockquote: {\n          block: 'blockquote',\n          wrapper: true,\n          remove: 'all'\n        },\n        subscript: { inline: 'sub' },\n        superscript: { inline: 'sup' },\n        code: { inline: 'code' },\n        link: {\n          inline: 'a',\n          selector: 'a',\n          remove: 'all',\n          split: true,\n          deep: true,\n          onmatch: function (node, _fmt, _itemName) {\n            return isElement$1(node) && node.hasAttribute('href');\n          },\n          onformat: function (elm, _fmt, vars) {\n            Tools.each(vars, function (value, key) {\n              dom.setAttrib(elm, key, value);\n            });\n          }\n        },\n        removeformat: [\n          {\n            selector: 'b,strong,em,i,font,u,strike,s,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',\n            remove: 'all',\n            split: true,\n            expand: false,\n            block_expand: true,\n            deep: true\n          },\n          {\n            selector: 'span',\n            attributes: [\n              'style',\n              'class'\n            ],\n            remove: 'empty',\n            split: true,\n            expand: false,\n            deep: true\n          },\n          {\n            selector: '*',\n            attributes: [\n              'style',\n              'class'\n            ],\n            split: false,\n            expand: false,\n            deep: true\n          }\n        ]\n      };\n      Tools.each('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\\s/), function (name) {\n        formats[name] = {\n          block: name,\n          remove: 'all'\n        };\n      });\n      return formats;\n    };\n\n    function FormatRegistry(editor) {\n      var formats = {};\n      var get = function (name) {\n        return name ? formats[name] : formats;\n      };\n      var has$1 = function (name) {\n        return has(formats, name);\n      };\n      var register = function (name, format) {\n        if (name) {\n          if (typeof name !== 'string') {\n            Tools.each(name, function (format, name) {\n              register(name, format);\n            });\n          } else {\n            if (!isArray(format)) {\n              format = [format];\n            }\n            Tools.each(format, function (format) {\n              if (typeof format.deep === 'undefined') {\n                format.deep = !format.selector;\n              }\n              if (typeof format.split === 'undefined') {\n                format.split = !format.selector || format.inline;\n              }\n              if (typeof format.remove === 'undefined' && format.selector && !format.inline) {\n                format.remove = 'none';\n              }\n              if (format.selector && format.inline) {\n                format.mixed = true;\n                format.block_expand = true;\n              }\n              if (typeof format.classes === 'string') {\n                format.classes = format.classes.split(/\\s+/);\n              }\n            });\n            formats[name] = format;\n          }\n        }\n      };\n      var unregister = function (name) {\n        if (name && formats[name]) {\n          delete formats[name];\n        }\n        return formats;\n      };\n      register(get$a(editor.dom));\n      register(getFormats(editor));\n      return {\n        get: get,\n        has: has$1,\n        register: register,\n        unregister: unregister\n      };\n    }\n\n    var each$e = Tools.each;\n    var dom = DOMUtils$1.DOM;\n    var parsedSelectorToHtml = function (ancestry, editor) {\n      var elm, item, fragment;\n      var schema = editor && editor.schema || Schema({});\n      var decorate = function (elm, item) {\n        if (item.classes.length) {\n          dom.addClass(elm, item.classes.join(' '));\n        }\n        dom.setAttribs(elm, item.attrs);\n      };\n      var createElement = function (sItem) {\n        item = typeof sItem === 'string' ? {\n          name: sItem,\n          classes: [],\n          attrs: {}\n        } : sItem;\n        var elm = dom.create(item.name);\n        decorate(elm, item);\n        return elm;\n      };\n      var getRequiredParent = function (elm, candidate) {\n        var name = typeof elm !== 'string' ? elm.nodeName.toLowerCase() : elm;\n        var elmRule = schema.getElementRule(name);\n        var parentsRequired = elmRule && elmRule.parentsRequired;\n        if (parentsRequired && parentsRequired.length) {\n          return candidate && Tools.inArray(parentsRequired, candidate) !== -1 ? candidate : parentsRequired[0];\n        } else {\n          return false;\n        }\n      };\n      var wrapInHtml = function (elm, ancestry, siblings) {\n        var parent, parentCandidate;\n        var ancestor = ancestry.length > 0 && ancestry[0];\n        var ancestorName = ancestor && ancestor.name;\n        var parentRequired = getRequiredParent(elm, ancestorName);\n        if (parentRequired) {\n          if (ancestorName === parentRequired) {\n            parentCandidate = ancestry[0];\n            ancestry = ancestry.slice(1);\n          } else {\n            parentCandidate = parentRequired;\n          }\n        } else if (ancestor) {\n          parentCandidate = ancestry[0];\n          ancestry = ancestry.slice(1);\n        } else if (!siblings) {\n          return elm;\n        }\n        if (parentCandidate) {\n          parent = createElement(parentCandidate);\n          parent.appendChild(elm);\n        }\n        if (siblings) {\n          if (!parent) {\n            parent = dom.create('div');\n            parent.appendChild(elm);\n          }\n          Tools.each(siblings, function (sibling) {\n            var siblingElm = createElement(sibling);\n            parent.insertBefore(siblingElm, elm);\n          });\n        }\n        return wrapInHtml(parent, ancestry, parentCandidate && parentCandidate.siblings);\n      };\n      if (ancestry && ancestry.length) {\n        item = ancestry[0];\n        elm = createElement(item);\n        fragment = dom.create('div');\n        fragment.appendChild(wrapInHtml(elm, ancestry.slice(1), item.siblings));\n        return fragment;\n      } else {\n        return '';\n      }\n    };\n    var parseSelectorItem = function (item) {\n      var tagName;\n      var obj = {\n        classes: [],\n        attrs: {}\n      };\n      item = obj.selector = Tools.trim(item);\n      if (item !== '*') {\n        tagName = item.replace(/(?:([#\\.]|::?)([\\w\\-]+)|(\\[)([^\\]]+)\\]?)/g, function ($0, $1, $2, $3, $4) {\n          switch ($1) {\n          case '#':\n            obj.attrs.id = $2;\n            break;\n          case '.':\n            obj.classes.push($2);\n            break;\n          case ':':\n            if (Tools.inArray('checked disabled enabled read-only required'.split(' '), $2) !== -1) {\n              obj.attrs[$2] = $2;\n            }\n            break;\n          }\n          if ($3 === '[') {\n            var m = $4.match(/([\\w\\-]+)(?:\\=\\\"([^\\\"]+))?/);\n            if (m) {\n              obj.attrs[m[1]] = m[2];\n            }\n          }\n          return '';\n        });\n      }\n      obj.name = tagName || 'div';\n      return obj;\n    };\n    var parseSelector = function (selector) {\n      if (!selector || typeof selector !== 'string') {\n        return [];\n      }\n      selector = selector.split(/\\s*,\\s*/)[0];\n      selector = selector.replace(/\\s*(~\\+|~|\\+|>)\\s*/g, '$1');\n      return Tools.map(selector.split(/(?:>|\\s+(?![^\\[\\]]+\\]))/), function (item) {\n        var siblings = Tools.map(item.split(/(?:~\\+|~|\\+)/), parseSelectorItem);\n        var obj = siblings.pop();\n        if (siblings.length) {\n          obj.siblings = siblings;\n        }\n        return obj;\n      }).reverse();\n    };\n    var getCssText = function (editor, format) {\n      var name, previewFrag;\n      var previewCss = '', parentFontSize;\n      var previewStyles = getPreviewStyles(editor);\n      if (previewStyles === '') {\n        return '';\n      }\n      var removeVars = function (val) {\n        return val.replace(/%(\\w+)/g, '');\n      };\n      if (typeof format === 'string') {\n        format = editor.formatter.get(format);\n        if (!format) {\n          return;\n        }\n        format = format[0];\n      }\n      if ('preview' in format) {\n        var previewOpt = get$1(format, 'preview');\n        if (previewOpt.is(false)) {\n          return '';\n        } else {\n          previewStyles = previewOpt.getOr(previewStyles);\n        }\n      }\n      name = format.block || format.inline || 'span';\n      var items = parseSelector(format.selector);\n      if (items.length) {\n        if (!items[0].name) {\n          items[0].name = name;\n        }\n        name = format.selector;\n        previewFrag = parsedSelectorToHtml(items, editor);\n      } else {\n        previewFrag = parsedSelectorToHtml([name], editor);\n      }\n      var previewElm = dom.select(name, previewFrag)[0] || previewFrag.firstChild;\n      each$e(format.styles, function (value, name) {\n        var newValue = removeVars(value);\n        if (newValue) {\n          dom.setStyle(previewElm, name, newValue);\n        }\n      });\n      each$e(format.attributes, function (value, name) {\n        var newValue = removeVars(value);\n        if (newValue) {\n          dom.setAttrib(previewElm, name, newValue);\n        }\n      });\n      each$e(format.classes, function (value) {\n        var newValue = removeVars(value);\n        if (!dom.hasClass(previewElm, newValue)) {\n          dom.addClass(previewElm, newValue);\n        }\n      });\n      editor.fire('PreviewFormats');\n      dom.setStyles(previewFrag, {\n        position: 'absolute',\n        left: -65535\n      });\n      editor.getBody().appendChild(previewFrag);\n      parentFontSize = dom.getStyle(editor.getBody(), 'fontSize', true);\n      parentFontSize = /px$/.test(parentFontSize) ? parseInt(parentFontSize, 10) : 0;\n      each$e(previewStyles.split(' '), function (name) {\n        var value = dom.getStyle(previewElm, name, true);\n        if (name === 'background-color' && /transparent|rgba\\s*\\([^)]+,\\s*0\\)/.test(value)) {\n          value = dom.getStyle(editor.getBody(), name, true);\n          if (dom.toHex(value).toLowerCase() === '#ffffff') {\n            return;\n          }\n        }\n        if (name === 'color') {\n          if (dom.toHex(value).toLowerCase() === '#000000') {\n            return;\n          }\n        }\n        if (name === 'font-size') {\n          if (/em|%$/.test(value)) {\n            if (parentFontSize === 0) {\n              return;\n            }\n            var numValue = parseFloat(value) / (/%$/.test(value) ? 100 : 1);\n            value = numValue * parentFontSize + 'px';\n          }\n        }\n        if (name === 'border' && value) {\n          previewCss += 'padding:0 2px;';\n        }\n        previewCss += name + ':' + value + ';';\n      });\n      editor.fire('AfterPreviewFormats');\n      dom.remove(previewFrag);\n      return previewCss;\n    };\n\n    var setup$6 = function (editor) {\n      editor.addShortcut('meta+b', '', 'Bold');\n      editor.addShortcut('meta+i', '', 'Italic');\n      editor.addShortcut('meta+u', '', 'Underline');\n      for (var i = 1; i <= 6; i++) {\n        editor.addShortcut('access+' + i, '', [\n          'FormatBlock',\n          false,\n          'h' + i\n        ]);\n      }\n      editor.addShortcut('access+7', '', [\n        'FormatBlock',\n        false,\n        'p'\n      ]);\n      editor.addShortcut('access+8', '', [\n        'FormatBlock',\n        false,\n        'div'\n      ]);\n      editor.addShortcut('access+9', '', [\n        'FormatBlock',\n        false,\n        'address'\n      ]);\n    };\n\n    var Formatter = function (editor) {\n      var formats = FormatRegistry(editor);\n      var formatChangeState = Cell(null);\n      setup$6(editor);\n      setup$3(editor);\n      return {\n        get: formats.get,\n        has: formats.has,\n        register: formats.register,\n        unregister: formats.unregister,\n        apply: function (name, vars, node) {\n          applyFormat$1(editor, name, vars, node);\n        },\n        remove: function (name, vars, node, similar) {\n          removeFormat$1(editor, name, vars, node, similar);\n        },\n        toggle: function (name, vars, node) {\n          toggleFormat(editor, name, vars, node);\n        },\n        match: function (name, vars, node) {\n          return matchFormat(editor, name, vars, node);\n        },\n        closest: function (names) {\n          return closestFormat(editor, names);\n        },\n        matchAll: function (names, vars) {\n          return matchAllFormats(editor, names, vars);\n        },\n        matchNode: function (node, names, vars, similar) {\n          return matchNodeFormat(editor, node, names, vars, similar);\n        },\n        canApply: function (name) {\n          return canApplyFormat(editor, name);\n        },\n        formatChanged: function (formats, callback, similar) {\n          return formatChanged(editor, formatChangeState, formats, callback, similar);\n        },\n        getCssText: curry(getCssText, editor)\n      };\n    };\n\n    var registerEvents$1 = function (editor, undoManager, locks) {\n      var isFirstTypedCharacter = Cell(false);\n      var addNonTypingUndoLevel = function (e) {\n        setTyping(undoManager, false, locks);\n        undoManager.add({}, e);\n      };\n      editor.on('init', function () {\n        undoManager.add();\n      });\n      editor.on('BeforeExecCommand', function (e) {\n        var cmd = e.command.toLowerCase();\n        if (cmd !== 'undo' && cmd !== 'redo' && cmd !== 'mcerepaint') {\n          endTyping(undoManager, locks);\n          undoManager.beforeChange();\n        }\n      });\n      editor.on('ExecCommand', function (e) {\n        var cmd = e.command.toLowerCase();\n        if (cmd !== 'undo' && cmd !== 'redo' && cmd !== 'mcerepaint') {\n          addNonTypingUndoLevel(e);\n        }\n      });\n      editor.on('ObjectResizeStart cut', function () {\n        undoManager.beforeChange();\n      });\n      editor.on('SaveContent ObjectResized blur', addNonTypingUndoLevel);\n      editor.on('dragend', addNonTypingUndoLevel);\n      editor.on('keyup', function (e) {\n        var keyCode = e.keyCode;\n        if (e.isDefaultPrevented()) {\n          return;\n        }\n        if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45 || e.ctrlKey) {\n          addNonTypingUndoLevel();\n          editor.nodeChanged();\n        }\n        if (keyCode === 46 || keyCode === 8) {\n          editor.nodeChanged();\n        }\n        if (isFirstTypedCharacter.get() && undoManager.typing && isEq$4(createFromEditor(editor), undoManager.data[0]) === false) {\n          if (editor.isDirty() === false) {\n            editor.setDirty(true);\n            editor.fire('change', {\n              level: undoManager.data[0],\n              lastLevel: null\n            });\n          }\n          editor.fire('TypingUndo');\n          isFirstTypedCharacter.set(false);\n          editor.nodeChanged();\n        }\n      });\n      editor.on('keydown', function (e) {\n        var keyCode = e.keyCode;\n        if (e.isDefaultPrevented()) {\n          return;\n        }\n        if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45) {\n          if (undoManager.typing) {\n            addNonTypingUndoLevel(e);\n          }\n          return;\n        }\n        var modKey = e.ctrlKey && !e.altKey || e.metaKey;\n        if ((keyCode < 16 || keyCode > 20) && keyCode !== 224 && keyCode !== 91 && !undoManager.typing && !modKey) {\n          undoManager.beforeChange();\n          setTyping(undoManager, true, locks);\n          undoManager.add({}, e);\n          isFirstTypedCharacter.set(true);\n        }\n      });\n      editor.on('mousedown', function (e) {\n        if (undoManager.typing) {\n          addNonTypingUndoLevel(e);\n        }\n      });\n      var isInsertReplacementText = function (event) {\n        return event.inputType === 'insertReplacementText';\n      };\n      var isInsertTextDataNull = function (event) {\n        return event.inputType === 'insertText' && event.data === null;\n      };\n      var isInsertFromPasteOrDrop = function (event) {\n        return event.inputType === 'insertFromPaste' || event.inputType === 'insertFromDrop';\n      };\n      editor.on('input', function (e) {\n        if (e.inputType && (isInsertReplacementText(e) || isInsertTextDataNull(e) || isInsertFromPasteOrDrop(e))) {\n          addNonTypingUndoLevel(e);\n        }\n      });\n      editor.on('AddUndo Undo Redo ClearUndos', function (e) {\n        if (!e.isDefaultPrevented()) {\n          editor.nodeChanged();\n        }\n      });\n    };\n    var addKeyboardShortcuts = function (editor) {\n      editor.addShortcut('meta+z', '', 'Undo');\n      editor.addShortcut('meta+y,meta+shift+z', '', 'Redo');\n    };\n\n    var UndoManager = function (editor) {\n      var beforeBookmark = Cell(Optional.none());\n      var locks = Cell(0);\n      var index = Cell(0);\n      var undoManager = {\n        data: [],\n        typing: false,\n        beforeChange: function () {\n          beforeChange$1(editor, locks, beforeBookmark);\n        },\n        add: function (level, event) {\n          return addUndoLevel$1(editor, undoManager, index, locks, beforeBookmark, level, event);\n        },\n        undo: function () {\n          return undo$1(editor, undoManager, locks, index);\n        },\n        redo: function () {\n          return redo$1(editor, index, undoManager.data);\n        },\n        clear: function () {\n          clear$1(editor, undoManager, index);\n        },\n        reset: function () {\n          reset$1(editor, undoManager);\n        },\n        hasUndo: function () {\n          return hasUndo$1(editor, undoManager, index);\n        },\n        hasRedo: function () {\n          return hasRedo$1(editor, undoManager, index);\n        },\n        transact: function (callback) {\n          return transact$1(editor, undoManager, locks, callback);\n        },\n        ignore: function (callback) {\n          ignore$1(editor, locks, callback);\n        },\n        extra: function (callback1, callback2) {\n          extra$1(editor, undoManager, index, callback1, callback2);\n        }\n      };\n      if (!isRtc(editor)) {\n        registerEvents$1(editor, undoManager, locks);\n      }\n      addKeyboardShortcuts(editor);\n      return undoManager;\n    };\n\n    var nonTypingKeycodes = [\n      9,\n      27,\n      VK.HOME,\n      VK.END,\n      19,\n      20,\n      44,\n      144,\n      145,\n      33,\n      34,\n      45,\n      16,\n      17,\n      18,\n      91,\n      92,\n      93,\n      VK.DOWN,\n      VK.UP,\n      VK.LEFT,\n      VK.RIGHT\n    ].concat(Env.browser.isFirefox() ? [224] : []);\n    var placeholderAttr = 'data-mce-placeholder';\n    var isKeyboardEvent = function (e) {\n      return e.type === 'keydown' || e.type === 'keyup';\n    };\n    var isDeleteEvent = function (e) {\n      var keyCode = e.keyCode;\n      return keyCode === VK.BACKSPACE || keyCode === VK.DELETE;\n    };\n    var isNonTypingKeyboardEvent = function (e) {\n      if (isKeyboardEvent(e)) {\n        var keyCode = e.keyCode;\n        return !isDeleteEvent(e) && (VK.metaKeyPressed(e) || e.altKey || keyCode >= 112 && keyCode <= 123 || contains(nonTypingKeycodes, keyCode));\n      } else {\n        return false;\n      }\n    };\n    var isTypingKeyboardEvent = function (e) {\n      return isKeyboardEvent(e) && !(isDeleteEvent(e) || e.type === 'keyup' && e.keyCode === 229);\n    };\n    var isVisuallyEmpty = function (dom, rootElm, forcedRootBlock) {\n      if (isEmpty(SugarElement.fromDom(rootElm), false)) {\n        var isForcedRootBlockFalse = forcedRootBlock === '';\n        var firstElement = rootElm.firstElementChild;\n        if (!firstElement) {\n          return true;\n        } else if (dom.getStyle(rootElm.firstElementChild, 'padding-left') || dom.getStyle(rootElm.firstElementChild, 'padding-right')) {\n          return false;\n        } else {\n          return isForcedRootBlockFalse ? !dom.isBlock(firstElement) : forcedRootBlock === firstElement.nodeName.toLowerCase();\n        }\n      } else {\n        return false;\n      }\n    };\n    var setup$7 = function (editor) {\n      var dom = editor.dom;\n      var rootBlock = getForcedRootBlock(editor);\n      var placeholder = getPlaceholder(editor);\n      var updatePlaceholder = function (e, initial) {\n        if (isNonTypingKeyboardEvent(e)) {\n          return;\n        }\n        var body = editor.getBody();\n        var showPlaceholder = isTypingKeyboardEvent(e) ? false : isVisuallyEmpty(dom, body, rootBlock);\n        var isPlaceholderShown = dom.getAttrib(body, placeholderAttr) !== '';\n        if (isPlaceholderShown !== showPlaceholder || initial) {\n          dom.setAttrib(body, placeholderAttr, showPlaceholder ? placeholder : null);\n          dom.setAttrib(body, 'aria-placeholder', showPlaceholder ? placeholder : null);\n          firePlaceholderToggle(editor, showPlaceholder);\n          editor.on(showPlaceholder ? 'keydown' : 'keyup', updatePlaceholder);\n          editor.off(showPlaceholder ? 'keyup' : 'keydown', updatePlaceholder);\n        }\n      };\n      if (placeholder) {\n        editor.on('init', function (e) {\n          updatePlaceholder(e, true);\n          editor.on('change SetContent ExecCommand', updatePlaceholder);\n          editor.on('paste', function (e) {\n            return Delay.setEditorTimeout(editor, function () {\n              return updatePlaceholder(e);\n            });\n          });\n        });\n      }\n    };\n\n    var strongRtl = /[\\u0591-\\u07FF\\uFB1D-\\uFDFF\\uFE70-\\uFEFC]/;\n    var hasStrongRtl = function (text) {\n      return strongRtl.test(text);\n    };\n\n    var isInlineTarget = function (editor, elm) {\n      return is$1(SugarElement.fromDom(elm), getInlineBoundarySelector(editor));\n    };\n    var isRtl$1 = function (element) {\n      return DOMUtils$1.DOM.getStyle(element, 'direction', true) === 'rtl' || hasStrongRtl(element.textContent);\n    };\n    var findInlineParents = function (isInlineTarget, rootNode, pos) {\n      return filter(DOMUtils$1.DOM.getParents(pos.container(), '*', rootNode), isInlineTarget);\n    };\n    var findRootInline = function (isInlineTarget, rootNode, pos) {\n      var parents = findInlineParents(isInlineTarget, rootNode, pos);\n      return Optional.from(parents[parents.length - 1]);\n    };\n    var hasSameParentBlock = function (rootNode, node1, node2) {\n      var block1 = getParentBlock(node1, rootNode);\n      var block2 = getParentBlock(node2, rootNode);\n      return block1 && block1 === block2;\n    };\n    var isAtZwsp = function (pos) {\n      return isBeforeInline(pos) || isAfterInline(pos);\n    };\n    var normalizePosition = function (forward, pos) {\n      if (!pos) {\n        return pos;\n      }\n      var container = pos.container(), offset = pos.offset();\n      if (forward) {\n        if (isCaretContainerInline(container)) {\n          if (isText$1(container.nextSibling)) {\n            return CaretPosition$1(container.nextSibling, 0);\n          } else {\n            return CaretPosition$1.after(container);\n          }\n        } else {\n          return isBeforeInline(pos) ? CaretPosition$1(container, offset + 1) : pos;\n        }\n      } else {\n        if (isCaretContainerInline(container)) {\n          if (isText$1(container.previousSibling)) {\n            return CaretPosition$1(container.previousSibling, container.previousSibling.data.length);\n          } else {\n            return CaretPosition$1.before(container);\n          }\n        } else {\n          return isAfterInline(pos) ? CaretPosition$1(container, offset - 1) : pos;\n        }\n      }\n    };\n    var normalizeForwards = curry(normalizePosition, true);\n    var normalizeBackwards = curry(normalizePosition, false);\n\n    var isBeforeRoot = function (rootNode) {\n      return function (elm) {\n        return eq$2(rootNode, SugarElement.fromDom(elm.dom.parentNode));\n      };\n    };\n    var getParentBlock$1 = function (rootNode, elm) {\n      return contains$2(rootNode, elm) ? closest(elm, function (element) {\n        return isTextBlock(element) || isListItem(element);\n      }, isBeforeRoot(rootNode)) : Optional.none();\n    };\n    var placeCaretInEmptyBody = function (editor) {\n      var body = editor.getBody();\n      var node = body.firstChild && editor.dom.isBlock(body.firstChild) ? body.firstChild : body;\n      editor.selection.setCursorLocation(node, 0);\n    };\n    var paddEmptyBody = function (editor) {\n      if (editor.dom.isEmpty(editor.getBody())) {\n        editor.setContent('');\n        placeCaretInEmptyBody(editor);\n      }\n    };\n    var willDeleteLastPositionInElement = function (forward, fromPos, elm) {\n      return lift2(firstPositionIn(elm), lastPositionIn(elm), function (firstPos, lastPos) {\n        var normalizedFirstPos = normalizePosition(true, firstPos);\n        var normalizedLastPos = normalizePosition(false, lastPos);\n        var normalizedFromPos = normalizePosition(false, fromPos);\n        if (forward) {\n          return nextPosition(elm, normalizedFromPos).exists(function (nextPos) {\n            return nextPos.isEqual(normalizedLastPos) && fromPos.isEqual(normalizedFirstPos);\n          });\n        } else {\n          return prevPosition(elm, normalizedFromPos).exists(function (prevPos) {\n            return prevPos.isEqual(normalizedFirstPos) && fromPos.isEqual(normalizedLastPos);\n          });\n        }\n      }).getOr(true);\n    };\n\n    var blockPosition = function (block, position) {\n      return {\n        block: block,\n        position: position\n      };\n    };\n    var blockBoundary = function (from, to) {\n      return {\n        from: from,\n        to: to\n      };\n    };\n    var getBlockPosition = function (rootNode, pos) {\n      var rootElm = SugarElement.fromDom(rootNode);\n      var containerElm = SugarElement.fromDom(pos.container());\n      return getParentBlock$1(rootElm, containerElm).map(function (block) {\n        return blockPosition(block, pos);\n      });\n    };\n    var isDifferentBlocks = function (blockBoundary) {\n      return eq$2(blockBoundary.from.block, blockBoundary.to.block) === false;\n    };\n    var hasSameParent = function (blockBoundary) {\n      return parent(blockBoundary.from.block).bind(function (parent1) {\n        return parent(blockBoundary.to.block).filter(function (parent2) {\n          return eq$2(parent1, parent2);\n        });\n      }).isSome();\n    };\n    var isEditable = function (blockBoundary) {\n      return isContentEditableFalse(blockBoundary.from.block.dom) === false && isContentEditableFalse(blockBoundary.to.block.dom) === false;\n    };\n    var skipLastBr = function (rootNode, forward, blockPosition) {\n      if (isBr(blockPosition.position.getNode()) && isEmpty(blockPosition.block) === false) {\n        return positionIn(false, blockPosition.block.dom).bind(function (lastPositionInBlock) {\n          if (lastPositionInBlock.isEqual(blockPosition.position)) {\n            return fromPosition(forward, rootNode, lastPositionInBlock).bind(function (to) {\n              return getBlockPosition(rootNode, to);\n            });\n          } else {\n            return Optional.some(blockPosition);\n          }\n        }).getOr(blockPosition);\n      } else {\n        return blockPosition;\n      }\n    };\n    var readFromRange = function (rootNode, forward, rng) {\n      var fromBlockPos = getBlockPosition(rootNode, CaretPosition$1.fromRangeStart(rng));\n      var toBlockPos = fromBlockPos.bind(function (blockPos) {\n        return fromPosition(forward, rootNode, blockPos.position).bind(function (to) {\n          return getBlockPosition(rootNode, to).map(function (blockPos) {\n            return skipLastBr(rootNode, forward, blockPos);\n          });\n        });\n      });\n      return lift2(fromBlockPos, toBlockPos, blockBoundary).filter(function (blockBoundary) {\n        return isDifferentBlocks(blockBoundary) && hasSameParent(blockBoundary) && isEditable(blockBoundary);\n      });\n    };\n    var read$3 = function (rootNode, forward, rng) {\n      return rng.collapsed ? readFromRange(rootNode, forward, rng) : Optional.none();\n    };\n\n    var getChildrenUntilBlockBoundary = function (block) {\n      var children$1 = children(block);\n      return findIndex(children$1, isBlock).fold(function () {\n        return children$1;\n      }, function (index) {\n        return children$1.slice(0, index);\n      });\n    };\n    var extractChildren = function (block) {\n      var children = getChildrenUntilBlockBoundary(block);\n      each(children, remove);\n      return children;\n    };\n    var removeEmptyRoot = function (rootNode, block) {\n      var parents = parentsAndSelf(block, rootNode);\n      return find(parents.reverse(), function (element) {\n        return isEmpty(element);\n      }).each(remove);\n    };\n    var isEmptyBefore = function (el) {\n      return filter(prevSiblings(el), function (el) {\n        return !isEmpty(el);\n      }).length === 0;\n    };\n    var nestedBlockMerge = function (rootNode, fromBlock, toBlock, insertionPoint) {\n      if (isEmpty(toBlock)) {\n        fillWithPaddingBr(toBlock);\n        return firstPositionIn(toBlock.dom);\n      }\n      if (isEmptyBefore(insertionPoint) && isEmpty(fromBlock)) {\n        before(insertionPoint, SugarElement.fromTag('br'));\n      }\n      var position = prevPosition(toBlock.dom, CaretPosition$1.before(insertionPoint.dom));\n      each(extractChildren(fromBlock), function (child) {\n        before(insertionPoint, child);\n      });\n      removeEmptyRoot(rootNode, fromBlock);\n      return position;\n    };\n    var sidelongBlockMerge = function (rootNode, fromBlock, toBlock) {\n      if (isEmpty(toBlock)) {\n        remove(toBlock);\n        if (isEmpty(fromBlock)) {\n          fillWithPaddingBr(fromBlock);\n        }\n        return firstPositionIn(fromBlock.dom);\n      }\n      var position = lastPositionIn(toBlock.dom);\n      each(extractChildren(fromBlock), function (child) {\n        append(toBlock, child);\n      });\n      removeEmptyRoot(rootNode, fromBlock);\n      return position;\n    };\n    var findInsertionPoint = function (toBlock, block) {\n      var parentsAndSelf$1 = parentsAndSelf(block, toBlock);\n      return Optional.from(parentsAndSelf$1[parentsAndSelf$1.length - 1]);\n    };\n    var getInsertionPoint = function (fromBlock, toBlock) {\n      return contains$2(toBlock, fromBlock) ? findInsertionPoint(toBlock, fromBlock) : Optional.none();\n    };\n    var trimBr = function (first, block) {\n      positionIn(first, block.dom).map(function (position) {\n        return position.getNode();\n      }).map(SugarElement.fromDom).filter(isBr$1).each(remove);\n    };\n    var mergeBlockInto = function (rootNode, fromBlock, toBlock) {\n      trimBr(true, fromBlock);\n      trimBr(false, toBlock);\n      return getInsertionPoint(fromBlock, toBlock).fold(curry(sidelongBlockMerge, rootNode, fromBlock, toBlock), curry(nestedBlockMerge, rootNode, fromBlock, toBlock));\n    };\n    var mergeBlocks = function (rootNode, forward, block1, block2) {\n      return forward ? mergeBlockInto(rootNode, block2, block1) : mergeBlockInto(rootNode, block1, block2);\n    };\n\n    var backspaceDelete$1 = function (editor, forward) {\n      var rootNode = SugarElement.fromDom(editor.getBody());\n      var position = read$3(rootNode.dom, forward, editor.selection.getRng()).bind(function (blockBoundary) {\n        return mergeBlocks(rootNode, forward, blockBoundary.from.block, blockBoundary.to.block);\n      });\n      position.each(function (pos) {\n        editor.selection.setRng(pos.toRange());\n      });\n      return position.isSome();\n    };\n\n    var deleteRangeMergeBlocks = function (rootNode, selection) {\n      var rng = selection.getRng();\n      return lift2(getParentBlock$1(rootNode, SugarElement.fromDom(rng.startContainer)), getParentBlock$1(rootNode, SugarElement.fromDom(rng.endContainer)), function (block1, block2) {\n        if (eq$2(block1, block2) === false) {\n          rng.deleteContents();\n          mergeBlocks(rootNode, true, block1, block2).each(function (pos) {\n            selection.setRng(pos.toRange());\n          });\n          return true;\n        } else {\n          return false;\n        }\n      }).getOr(false);\n    };\n    var isRawNodeInTable = function (root, rawNode) {\n      var node = SugarElement.fromDom(rawNode);\n      var isRoot = curry(eq$2, root);\n      return ancestor(node, isTableCell$1, isRoot).isSome();\n    };\n    var isSelectionInTable = function (root, rng) {\n      return isRawNodeInTable(root, rng.startContainer) || isRawNodeInTable(root, rng.endContainer);\n    };\n    var isEverythingSelected = function (root, rng) {\n      var noPrevious = prevPosition(root.dom, CaretPosition$1.fromRangeStart(rng)).isNone();\n      var noNext = nextPosition(root.dom, CaretPosition$1.fromRangeEnd(rng)).isNone();\n      return !isSelectionInTable(root, rng) && noPrevious && noNext;\n    };\n    var emptyEditor = function (editor) {\n      editor.setContent('');\n      editor.selection.setCursorLocation();\n      return true;\n    };\n    var deleteRange$1 = function (editor) {\n      var rootNode = SugarElement.fromDom(editor.getBody());\n      var rng = editor.selection.getRng();\n      return isEverythingSelected(rootNode, rng) ? emptyEditor(editor) : deleteRangeMergeBlocks(rootNode, editor.selection);\n    };\n    var backspaceDelete$2 = function (editor, _forward) {\n      return editor.selection.isCollapsed() ? false : deleteRange$1(editor);\n    };\n\n    var isContentEditableTrue$2 = isContentEditableTrue;\n    var isContentEditableFalse$7 = isContentEditableFalse;\n    var showCaret = function (direction, editor, node, before, scrollIntoView) {\n      return Optional.from(editor._selectionOverrides.showCaret(direction, node, before, scrollIntoView));\n    };\n    var getNodeRange = function (node) {\n      var rng = node.ownerDocument.createRange();\n      rng.selectNode(node);\n      return rng;\n    };\n    var selectNode = function (editor, node) {\n      var e = editor.fire('BeforeObjectSelected', { target: node });\n      if (e.isDefaultPrevented()) {\n        return Optional.none();\n      }\n      return Optional.some(getNodeRange(node));\n    };\n    var renderCaretAtRange = function (editor, range, scrollIntoView) {\n      var normalizedRange = normalizeRange(1, editor.getBody(), range);\n      var caretPosition = CaretPosition$1.fromRangeStart(normalizedRange);\n      var caretPositionNode = caretPosition.getNode();\n      if (isInlineFakeCaretTarget(caretPositionNode)) {\n        return showCaret(1, editor, caretPositionNode, !caretPosition.isAtEnd(), false);\n      }\n      var caretPositionBeforeNode = caretPosition.getNode(true);\n      if (isInlineFakeCaretTarget(caretPositionBeforeNode)) {\n        return showCaret(1, editor, caretPositionBeforeNode, false, false);\n      }\n      var ceRoot = editor.dom.getParent(caretPosition.getNode(), function (node) {\n        return isContentEditableFalse$7(node) || isContentEditableTrue$2(node);\n      });\n      if (isInlineFakeCaretTarget(ceRoot)) {\n        return showCaret(1, editor, ceRoot, false, scrollIntoView);\n      }\n      return Optional.none();\n    };\n    var renderRangeCaret = function (editor, range, scrollIntoView) {\n      return range.collapsed ? renderCaretAtRange(editor, range, scrollIntoView).getOr(range) : range;\n    };\n\n    var isBeforeBoundary = function (pos) {\n      return isBeforeContentEditableFalse(pos) || isBeforeMedia(pos);\n    };\n    var isAfterBoundary = function (pos) {\n      return isAfterContentEditableFalse(pos) || isAfterMedia(pos);\n    };\n    var trimEmptyTextNode$1 = function (dom, node) {\n      if (isText$1(node) && node.data.length === 0) {\n        dom.remove(node);\n      }\n    };\n    var deleteContentAndShowCaret = function (editor, range, node, direction, forward, peekCaretPosition) {\n      showCaret(direction, editor, peekCaretPosition.getNode(!forward), forward, true).each(function (caretRange) {\n        if (range.collapsed) {\n          var deleteRange = range.cloneRange();\n          if (forward) {\n            deleteRange.setEnd(caretRange.startContainer, caretRange.startOffset);\n          } else {\n            deleteRange.setStart(caretRange.endContainer, caretRange.endOffset);\n          }\n          deleteRange.deleteContents();\n        } else {\n          range.deleteContents();\n        }\n        editor.selection.setRng(caretRange);\n      });\n      trimEmptyTextNode$1(editor.dom, node);\n      return true;\n    };\n    var deleteBoundaryText = function (editor, forward) {\n      var range = editor.selection.getRng();\n      if (!isText$1(range.commonAncestorContainer)) {\n        return false;\n      }\n      var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n      var caretWalker = CaretWalker(editor.getBody());\n      var getNextPosFn = curry(getVisualCaretPosition, forward ? caretWalker.next : caretWalker.prev);\n      var isBeforeFn = forward ? isBeforeBoundary : isAfterBoundary;\n      var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n      var nextCaretPosition = normalizePosition(forward, getNextPosFn(caretPosition));\n      if (!nextCaretPosition || !isMoveInsideSameBlock(caretPosition, nextCaretPosition)) {\n        return false;\n      } else if (isBeforeFn(nextCaretPosition)) {\n        return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, nextCaretPosition);\n      }\n      var peekCaretPosition = getNextPosFn(nextCaretPosition);\n      if (peekCaretPosition && isBeforeFn(peekCaretPosition)) {\n        if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\n          return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, peekCaretPosition);\n        }\n      }\n      return false;\n    };\n    var backspaceDelete$3 = function (editor, forward) {\n      return deleteBoundaryText(editor, forward);\n    };\n\n    var isCompoundElement = function (node) {\n      return isTableCell$1(SugarElement.fromDom(node)) || isListItem(SugarElement.fromDom(node));\n    };\n    var DeleteAction = Adt.generate([\n      { remove: ['element'] },\n      { moveToElement: ['element'] },\n      { moveToPosition: ['position'] }\n    ]);\n    var isAtContentEditableBlockCaret = function (forward, from) {\n      var elm = from.getNode(forward === false);\n      var caretLocation = forward ? 'after' : 'before';\n      return isElement$1(elm) && elm.getAttribute('data-mce-caret') === caretLocation;\n    };\n    var isDeleteFromCefDifferentBlocks = function (root, forward, from, to) {\n      var inSameBlock = function (elm) {\n        return isInline(SugarElement.fromDom(elm)) && !isInSameBlock(from, to, root);\n      };\n      return getRelativeCefElm(!forward, from).fold(function () {\n        return getRelativeCefElm(forward, to).fold(never, inSameBlock);\n      }, inSameBlock);\n    };\n    var deleteEmptyBlockOrMoveToCef = function (root, forward, from, to) {\n      var toCefElm = to.getNode(forward === false);\n      return getParentBlock$1(SugarElement.fromDom(root), SugarElement.fromDom(from.getNode())).map(function (blockElm) {\n        return isEmpty(blockElm) ? DeleteAction.remove(blockElm.dom) : DeleteAction.moveToElement(toCefElm);\n      }).orThunk(function () {\n        return Optional.some(DeleteAction.moveToElement(toCefElm));\n      });\n    };\n    var findCefPosition = function (root, forward, from) {\n      return fromPosition(forward, root, from).bind(function (to) {\n        if (isCompoundElement(to.getNode())) {\n          return Optional.none();\n        } else if (isDeleteFromCefDifferentBlocks(root, forward, from, to)) {\n          return Optional.none();\n        } else if (forward && isContentEditableFalse(to.getNode())) {\n          return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\n        } else if (forward === false && isContentEditableFalse(to.getNode(true))) {\n          return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\n        } else if (forward && isAfterContentEditableFalse(from)) {\n          return Optional.some(DeleteAction.moveToPosition(to));\n        } else if (forward === false && isBeforeContentEditableFalse(from)) {\n          return Optional.some(DeleteAction.moveToPosition(to));\n        } else {\n          return Optional.none();\n        }\n      });\n    };\n    var getContentEditableBlockAction = function (forward, elm) {\n      if (forward && isContentEditableFalse(elm.nextSibling)) {\n        return Optional.some(DeleteAction.moveToElement(elm.nextSibling));\n      } else if (forward === false && isContentEditableFalse(elm.previousSibling)) {\n        return Optional.some(DeleteAction.moveToElement(elm.previousSibling));\n      } else {\n        return Optional.none();\n      }\n    };\n    var skipMoveToActionFromInlineCefToContent = function (root, from, deleteAction) {\n      return deleteAction.fold(function (elm) {\n        return Optional.some(DeleteAction.remove(elm));\n      }, function (elm) {\n        return Optional.some(DeleteAction.moveToElement(elm));\n      }, function (to) {\n        if (isInSameBlock(from, to, root)) {\n          return Optional.none();\n        } else {\n          return Optional.some(DeleteAction.moveToPosition(to));\n        }\n      });\n    };\n    var getContentEditableAction = function (root, forward, from) {\n      if (isAtContentEditableBlockCaret(forward, from)) {\n        return getContentEditableBlockAction(forward, from.getNode(forward === false)).fold(function () {\n          return findCefPosition(root, forward, from);\n        }, Optional.some);\n      } else {\n        return findCefPosition(root, forward, from).bind(function (deleteAction) {\n          return skipMoveToActionFromInlineCefToContent(root, from, deleteAction);\n        });\n      }\n    };\n    var read$4 = function (root, forward, rng) {\n      var normalizedRange = normalizeRange(forward ? 1 : -1, root, rng);\n      var from = CaretPosition$1.fromRangeStart(normalizedRange);\n      var rootElement = SugarElement.fromDom(root);\n      if (forward === false && isAfterContentEditableFalse(from)) {\n        return Optional.some(DeleteAction.remove(from.getNode(true)));\n      } else if (forward && isBeforeContentEditableFalse(from)) {\n        return Optional.some(DeleteAction.remove(from.getNode()));\n      } else if (forward === false && isBeforeContentEditableFalse(from) && isAfterBr(rootElement, from)) {\n        return findPreviousBr(rootElement, from).map(function (br) {\n          return DeleteAction.remove(br.getNode());\n        });\n      } else if (forward && isAfterContentEditableFalse(from) && isBeforeBr(rootElement, from)) {\n        return findNextBr(rootElement, from).map(function (br) {\n          return DeleteAction.remove(br.getNode());\n        });\n      } else {\n        return getContentEditableAction(root, forward, from);\n      }\n    };\n\n    var deleteElement$1 = function (editor, forward) {\n      return function (element) {\n        editor._selectionOverrides.hideFakeCaret();\n        deleteElement(editor, forward, SugarElement.fromDom(element));\n        return true;\n      };\n    };\n    var moveToElement = function (editor, forward) {\n      return function (element) {\n        var pos = forward ? CaretPosition$1.before(element) : CaretPosition$1.after(element);\n        editor.selection.setRng(pos.toRange());\n        return true;\n      };\n    };\n    var moveToPosition = function (editor) {\n      return function (pos) {\n        editor.selection.setRng(pos.toRange());\n        return true;\n      };\n    };\n    var getAncestorCe = function (editor, node) {\n      return Optional.from(getContentEditableRoot(editor.getBody(), node));\n    };\n    var backspaceDeleteCaret = function (editor, forward) {\n      var selectedNode = editor.selection.getNode();\n      return getAncestorCe(editor, selectedNode).filter(isContentEditableFalse).fold(function () {\n        return read$4(editor.getBody(), forward, editor.selection.getRng()).exists(function (deleteAction) {\n          return deleteAction.fold(deleteElement$1(editor, forward), moveToElement(editor, forward), moveToPosition(editor));\n        });\n      }, always);\n    };\n    var deleteOffscreenSelection = function (rootElement) {\n      each(descendants$1(rootElement, '.mce-offscreen-selection'), remove);\n    };\n    var backspaceDeleteRange = function (editor, forward) {\n      var selectedNode = editor.selection.getNode();\n      if (isContentEditableFalse(selectedNode)) {\n        var hasCefAncestor = getAncestorCe(editor, selectedNode.parentNode).filter(isContentEditableFalse);\n        return hasCefAncestor.fold(function () {\n          deleteOffscreenSelection(SugarElement.fromDom(editor.getBody()));\n          deleteElement(editor, forward, SugarElement.fromDom(editor.selection.getNode()));\n          paddEmptyBody(editor);\n          return true;\n        }, function () {\n          return true;\n        });\n      }\n      return false;\n    };\n    var paddEmptyElement = function (editor) {\n      var dom = editor.dom, selection = editor.selection;\n      var ceRoot = getContentEditableRoot(editor.getBody(), selection.getNode());\n      if (isContentEditableTrue(ceRoot) && dom.isBlock(ceRoot) && dom.isEmpty(ceRoot)) {\n        var br = dom.create('br', { 'data-mce-bogus': '1' });\n        dom.setHTML(ceRoot, '');\n        ceRoot.appendChild(br);\n        selection.setRng(CaretPosition$1.before(br).toRange());\n      }\n      return true;\n    };\n    var backspaceDelete$4 = function (editor, forward) {\n      if (editor.selection.isCollapsed()) {\n        return backspaceDeleteCaret(editor, forward);\n      } else {\n        return backspaceDeleteRange(editor, forward);\n      }\n    };\n\n    var deleteCaret$1 = function (editor, forward) {\n      var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return fromPosition(forward, editor.getBody(), fromPos).filter(function (pos) {\n        return forward ? isBeforeImageBlock(pos) : isAfterImageBlock(pos);\n      }).bind(function (pos) {\n        return Optional.from(getChildNodeAtRelativeOffset(forward ? 0 : -1, pos));\n      }).exists(function (elm) {\n        editor.selection.select(elm);\n        return true;\n      });\n    };\n    var backspaceDelete$5 = function (editor, forward) {\n      return editor.selection.isCollapsed() ? deleteCaret$1(editor, forward) : false;\n    };\n\n    var isText$8 = isText$1;\n    var startsWithCaretContainer$1 = function (node) {\n      return isText$8(node) && node.data[0] === ZWSP;\n    };\n    var endsWithCaretContainer$1 = function (node) {\n      return isText$8(node) && node.data[node.data.length - 1] === ZWSP;\n    };\n    var createZwsp = function (node) {\n      return node.ownerDocument.createTextNode(ZWSP);\n    };\n    var insertBefore$1 = function (node) {\n      if (isText$8(node.previousSibling)) {\n        if (endsWithCaretContainer$1(node.previousSibling)) {\n          return node.previousSibling;\n        } else {\n          node.previousSibling.appendData(ZWSP);\n          return node.previousSibling;\n        }\n      } else if (isText$8(node)) {\n        if (startsWithCaretContainer$1(node)) {\n          return node;\n        } else {\n          node.insertData(0, ZWSP);\n          return node;\n        }\n      } else {\n        var newNode = createZwsp(node);\n        node.parentNode.insertBefore(newNode, node);\n        return newNode;\n      }\n    };\n    var insertAfter$1 = function (node) {\n      if (isText$8(node.nextSibling)) {\n        if (startsWithCaretContainer$1(node.nextSibling)) {\n          return node.nextSibling;\n        } else {\n          node.nextSibling.insertData(0, ZWSP);\n          return node.nextSibling;\n        }\n      } else if (isText$8(node)) {\n        if (endsWithCaretContainer$1(node)) {\n          return node;\n        } else {\n          node.appendData(ZWSP);\n          return node;\n        }\n      } else {\n        var newNode = createZwsp(node);\n        if (node.nextSibling) {\n          node.parentNode.insertBefore(newNode, node.nextSibling);\n        } else {\n          node.parentNode.appendChild(newNode);\n        }\n        return newNode;\n      }\n    };\n    var insertInline$1 = function (before, node) {\n      return before ? insertBefore$1(node) : insertAfter$1(node);\n    };\n    var insertInlineBefore = curry(insertInline$1, true);\n    var insertInlineAfter = curry(insertInline$1, false);\n\n    var insertInlinePos = function (pos, before) {\n      if (isText$1(pos.container())) {\n        return insertInline$1(before, pos.container());\n      } else {\n        return insertInline$1(before, pos.getNode());\n      }\n    };\n    var isPosCaretContainer = function (pos, caret) {\n      var caretNode = caret.get();\n      return caretNode && pos.container() === caretNode && isCaretContainerInline(caretNode);\n    };\n    var renderCaret = function (caret, location) {\n      return location.fold(function (element) {\n        remove$5(caret.get());\n        var text = insertInlineBefore(element);\n        caret.set(text);\n        return Optional.some(CaretPosition$1(text, text.length - 1));\n      }, function (element) {\n        return firstPositionIn(element).map(function (pos) {\n          if (!isPosCaretContainer(pos, caret)) {\n            remove$5(caret.get());\n            var text = insertInlinePos(pos, true);\n            caret.set(text);\n            return CaretPosition$1(text, 1);\n          } else {\n            return CaretPosition$1(caret.get(), 1);\n          }\n        });\n      }, function (element) {\n        return lastPositionIn(element).map(function (pos) {\n          if (!isPosCaretContainer(pos, caret)) {\n            remove$5(caret.get());\n            var text = insertInlinePos(pos, false);\n            caret.set(text);\n            return CaretPosition$1(text, text.length - 1);\n          } else {\n            return CaretPosition$1(caret.get(), caret.get().length - 1);\n          }\n        });\n      }, function (element) {\n        remove$5(caret.get());\n        var text = insertInlineAfter(element);\n        caret.set(text);\n        return Optional.some(CaretPosition$1(text, 1));\n      });\n    };\n\n    var evaluateUntil = function (fns, args) {\n      for (var i = 0; i < fns.length; i++) {\n        var result = fns[i].apply(null, args);\n        if (result.isSome()) {\n          return result;\n        }\n      }\n      return Optional.none();\n    };\n\n    var Location = Adt.generate([\n      { before: ['element'] },\n      { start: ['element'] },\n      { end: ['element'] },\n      { after: ['element'] }\n    ]);\n    var rescope = function (rootNode, node) {\n      var parentBlock = getParentBlock(node, rootNode);\n      return parentBlock ? parentBlock : rootNode;\n    };\n    var before$4 = function (isInlineTarget, rootNode, pos) {\n      var nPos = normalizeForwards(pos);\n      var scope = rescope(rootNode, nPos.container());\n      return findRootInline(isInlineTarget, scope, nPos).fold(function () {\n        return nextPosition(scope, nPos).bind(curry(findRootInline, isInlineTarget, scope)).map(function (inline) {\n          return Location.before(inline);\n        });\n      }, Optional.none);\n    };\n    var isNotInsideFormatCaretContainer = function (rootNode, elm) {\n      return getParentCaretContainer(rootNode, elm) === null;\n    };\n    var findInsideRootInline = function (isInlineTarget, rootNode, pos) {\n      return findRootInline(isInlineTarget, rootNode, pos).filter(curry(isNotInsideFormatCaretContainer, rootNode));\n    };\n    var start = function (isInlineTarget, rootNode, pos) {\n      var nPos = normalizeBackwards(pos);\n      return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\n        var prevPos = prevPosition(inline, nPos);\n        return prevPos.isNone() ? Optional.some(Location.start(inline)) : Optional.none();\n      });\n    };\n    var end = function (isInlineTarget, rootNode, pos) {\n      var nPos = normalizeForwards(pos);\n      return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\n        var nextPos = nextPosition(inline, nPos);\n        return nextPos.isNone() ? Optional.some(Location.end(inline)) : Optional.none();\n      });\n    };\n    var after$3 = function (isInlineTarget, rootNode, pos) {\n      var nPos = normalizeBackwards(pos);\n      var scope = rescope(rootNode, nPos.container());\n      return findRootInline(isInlineTarget, scope, nPos).fold(function () {\n        return prevPosition(scope, nPos).bind(curry(findRootInline, isInlineTarget, scope)).map(function (inline) {\n          return Location.after(inline);\n        });\n      }, Optional.none);\n    };\n    var isValidLocation = function (location) {\n      return isRtl$1(getElement(location)) === false;\n    };\n    var readLocation = function (isInlineTarget, rootNode, pos) {\n      var location = evaluateUntil([\n        before$4,\n        start,\n        end,\n        after$3\n      ], [\n        isInlineTarget,\n        rootNode,\n        pos\n      ]);\n      return location.filter(isValidLocation);\n    };\n    var getElement = function (location) {\n      return location.fold(identity, identity, identity, identity);\n    };\n    var getName = function (location) {\n      return location.fold(constant('before'), constant('start'), constant('end'), constant('after'));\n    };\n    var outside = function (location) {\n      return location.fold(Location.before, Location.before, Location.after, Location.after);\n    };\n    var inside = function (location) {\n      return location.fold(Location.start, Location.start, Location.end, Location.end);\n    };\n    var isEq$5 = function (location1, location2) {\n      return getName(location1) === getName(location2) && getElement(location1) === getElement(location2);\n    };\n    var betweenInlines = function (forward, isInlineTarget, rootNode, from, to, location) {\n      return lift2(findRootInline(isInlineTarget, rootNode, from), findRootInline(isInlineTarget, rootNode, to), function (fromInline, toInline) {\n        if (fromInline !== toInline && hasSameParentBlock(rootNode, fromInline, toInline)) {\n          return Location.after(forward ? fromInline : toInline);\n        } else {\n          return location;\n        }\n      }).getOr(location);\n    };\n    var skipNoMovement = function (fromLocation, toLocation) {\n      return fromLocation.fold(always, function (fromLocation) {\n        return !isEq$5(fromLocation, toLocation);\n      });\n    };\n    var findLocationTraverse = function (forward, isInlineTarget, rootNode, fromLocation, pos) {\n      var from = normalizePosition(forward, pos);\n      var to = fromPosition(forward, rootNode, from).map(curry(normalizePosition, forward));\n      var location = to.fold(function () {\n        return fromLocation.map(outside);\n      }, function (to) {\n        return readLocation(isInlineTarget, rootNode, to).map(curry(betweenInlines, forward, isInlineTarget, rootNode, from, to)).filter(curry(skipNoMovement, fromLocation));\n      });\n      return location.filter(isValidLocation);\n    };\n    var findLocationSimple = function (forward, location) {\n      if (forward) {\n        return location.fold(compose(Optional.some, Location.start), Optional.none, compose(Optional.some, Location.after), Optional.none);\n      } else {\n        return location.fold(Optional.none, compose(Optional.some, Location.before), Optional.none, compose(Optional.some, Location.end));\n      }\n    };\n    var findLocation = function (forward, isInlineTarget, rootNode, pos) {\n      var from = normalizePosition(forward, pos);\n      var fromLocation = readLocation(isInlineTarget, rootNode, from);\n      return readLocation(isInlineTarget, rootNode, from).bind(curry(findLocationSimple, forward)).orThunk(function () {\n        return findLocationTraverse(forward, isInlineTarget, rootNode, fromLocation, pos);\n      });\n    };\n    var prevLocation = curry(findLocation, false);\n    var nextLocation = curry(findLocation, true);\n\n    var hasSelectionModifyApi = function (editor) {\n      return isFunction(editor.selection.getSel().modify);\n    };\n    var moveRel = function (forward, selection, pos) {\n      var delta = forward ? 1 : -1;\n      selection.setRng(CaretPosition$1(pos.container(), pos.offset() + delta).toRange());\n      selection.getSel().modify('move', forward ? 'forward' : 'backward', 'word');\n      return true;\n    };\n    var moveByWord = function (forward, editor) {\n      var rng = editor.selection.getRng();\n      var pos = forward ? CaretPosition$1.fromRangeEnd(rng) : CaretPosition$1.fromRangeStart(rng);\n      if (!hasSelectionModifyApi(editor)) {\n        return false;\n      } else if (forward && isBeforeInline(pos)) {\n        return moveRel(true, editor.selection, pos);\n      } else if (!forward && isAfterInline(pos)) {\n        return moveRel(false, editor.selection, pos);\n      } else {\n        return false;\n      }\n    };\n\n    var setCaretPosition = function (editor, pos) {\n      var rng = editor.dom.createRng();\n      rng.setStart(pos.container(), pos.offset());\n      rng.setEnd(pos.container(), pos.offset());\n      editor.selection.setRng(rng);\n    };\n    var setSelected = function (state, elm) {\n      if (state) {\n        elm.setAttribute('data-mce-selected', 'inline-boundary');\n      } else {\n        elm.removeAttribute('data-mce-selected');\n      }\n    };\n    var renderCaretLocation = function (editor, caret, location) {\n      return renderCaret(caret, location).map(function (pos) {\n        setCaretPosition(editor, pos);\n        return location;\n      });\n    };\n    var findLocation$1 = function (editor, caret, forward) {\n      var rootNode = editor.getBody();\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      var isInlineTarget$1 = curry(isInlineTarget, editor);\n      var location = findLocation(forward, isInlineTarget$1, rootNode, from);\n      return location.bind(function (location) {\n        return renderCaretLocation(editor, caret, location);\n      });\n    };\n    var toggleInlines = function (isInlineTarget, dom, elms) {\n      var inlineBoundaries = map(descendants$1(SugarElement.fromDom(dom.getRoot()), '*[data-mce-selected=\"inline-boundary\"]'), function (e) {\n        return e.dom;\n      });\n      var selectedInlines = filter(inlineBoundaries, isInlineTarget);\n      var targetInlines = filter(elms, isInlineTarget);\n      each(difference(selectedInlines, targetInlines), curry(setSelected, false));\n      each(difference(targetInlines, selectedInlines), curry(setSelected, true));\n    };\n    var safeRemoveCaretContainer = function (editor, caret) {\n      if (editor.selection.isCollapsed() && editor.composing !== true && caret.get()) {\n        var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        if (CaretPosition$1.isTextPosition(pos) && isAtZwsp(pos) === false) {\n          setCaretPosition(editor, removeAndReposition(caret.get(), pos));\n          caret.set(null);\n        }\n      }\n    };\n    var renderInsideInlineCaret = function (isInlineTarget, editor, caret, elms) {\n      if (editor.selection.isCollapsed()) {\n        var inlines = filter(elms, isInlineTarget);\n        each(inlines, function (_inline) {\n          var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n          readLocation(isInlineTarget, editor.getBody(), pos).bind(function (location) {\n            return renderCaretLocation(editor, caret, location);\n          });\n        });\n      }\n    };\n    var move = function (editor, caret, forward) {\n      return isInlineBoundariesEnabled(editor) ? findLocation$1(editor, caret, forward).isSome() : false;\n    };\n    var moveWord = function (forward, editor, _caret) {\n      return isInlineBoundariesEnabled(editor) ? moveByWord(forward, editor) : false;\n    };\n    var setupSelectedState = function (editor) {\n      var caret = Cell(null);\n      var isInlineTarget$1 = curry(isInlineTarget, editor);\n      editor.on('NodeChange', function (e) {\n        if (isInlineBoundariesEnabled(editor) && !(Env.browser.isIE() && e.initial)) {\n          toggleInlines(isInlineTarget$1, editor.dom, e.parents);\n          safeRemoveCaretContainer(editor, caret);\n          renderInsideInlineCaret(isInlineTarget$1, editor, caret, e.parents);\n        }\n      });\n      return caret;\n    };\n    var moveNextWord = curry(moveWord, true);\n    var movePrevWord = curry(moveWord, false);\n\n    var rangeFromPositions = function (from, to) {\n      var range = document.createRange();\n      range.setStart(from.container(), from.offset());\n      range.setEnd(to.container(), to.offset());\n      return range;\n    };\n    var hasOnlyTwoOrLessPositionsLeft = function (elm) {\n      return lift2(firstPositionIn(elm), lastPositionIn(elm), function (firstPos, lastPos) {\n        var normalizedFirstPos = normalizePosition(true, firstPos);\n        var normalizedLastPos = normalizePosition(false, lastPos);\n        return nextPosition(elm, normalizedFirstPos).forall(function (pos) {\n          return pos.isEqual(normalizedLastPos);\n        });\n      }).getOr(true);\n    };\n    var setCaretLocation = function (editor, caret) {\n      return function (location) {\n        return renderCaret(caret, location).exists(function (pos) {\n          setCaretPosition(editor, pos);\n          return true;\n        });\n      };\n    };\n    var deleteFromTo = function (editor, caret, from, to) {\n      var rootNode = editor.getBody();\n      var isInlineTarget$1 = curry(isInlineTarget, editor);\n      editor.undoManager.ignore(function () {\n        editor.selection.setRng(rangeFromPositions(from, to));\n        editor.execCommand('Delete');\n        readLocation(isInlineTarget$1, rootNode, CaretPosition$1.fromRangeStart(editor.selection.getRng())).map(inside).map(setCaretLocation(editor, caret));\n      });\n      editor.nodeChanged();\n    };\n    var rescope$1 = function (rootNode, node) {\n      var parentBlock = getParentBlock(node, rootNode);\n      return parentBlock ? parentBlock : rootNode;\n    };\n    var backspaceDeleteCollapsed = function (editor, caret, forward, from) {\n      var rootNode = rescope$1(editor.getBody(), from.container());\n      var isInlineTarget$1 = curry(isInlineTarget, editor);\n      var fromLocation = readLocation(isInlineTarget$1, rootNode, from);\n      return fromLocation.bind(function (location) {\n        if (forward) {\n          return location.fold(constant(Optional.some(inside(location))), Optional.none, constant(Optional.some(outside(location))), Optional.none);\n        } else {\n          return location.fold(Optional.none, constant(Optional.some(outside(location))), Optional.none, constant(Optional.some(inside(location))));\n        }\n      }).map(setCaretLocation(editor, caret)).getOrThunk(function () {\n        var toPosition = navigate(forward, rootNode, from);\n        var toLocation = toPosition.bind(function (pos) {\n          return readLocation(isInlineTarget$1, rootNode, pos);\n        });\n        return lift2(fromLocation, toLocation, function () {\n          return findRootInline(isInlineTarget$1, rootNode, from).exists(function (elm) {\n            if (hasOnlyTwoOrLessPositionsLeft(elm)) {\n              deleteElement(editor, forward, SugarElement.fromDom(elm));\n              return true;\n            } else {\n              return false;\n            }\n          });\n        }).orThunk(function () {\n          return toLocation.bind(function (_) {\n            return toPosition.map(function (to) {\n              if (forward) {\n                deleteFromTo(editor, caret, from, to);\n              } else {\n                deleteFromTo(editor, caret, to, from);\n              }\n              return true;\n            });\n          });\n        }).getOr(false);\n      });\n    };\n    var backspaceDelete$6 = function (editor, caret, forward) {\n      if (editor.selection.isCollapsed() && isInlineBoundariesEnabled(editor)) {\n        var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        return backspaceDeleteCollapsed(editor, caret, forward, from);\n      }\n      return false;\n    };\n\n    var getParentInlines = function (rootElm, startElm) {\n      var parents = parentsAndSelf(startElm, rootElm);\n      return findIndex(parents, isBlock).fold(constant(parents), function (index) {\n        return parents.slice(0, index);\n      });\n    };\n    var hasOnlyOneChild$1 = function (elm) {\n      return children(elm).length === 1;\n    };\n    var deleteLastPosition = function (forward, editor, target, parentInlines) {\n      var isFormatElement$1 = curry(isFormatElement, editor);\n      var formatNodes = map(filter(parentInlines, isFormatElement$1), function (elm) {\n        return elm.dom;\n      });\n      if (formatNodes.length === 0) {\n        deleteElement(editor, forward, target);\n      } else {\n        var pos = replaceWithCaretFormat(target.dom, formatNodes);\n        editor.selection.setRng(pos.toRange());\n      }\n    };\n    var deleteCaret$2 = function (editor, forward) {\n      var rootElm = SugarElement.fromDom(editor.getBody());\n      var startElm = SugarElement.fromDom(editor.selection.getStart());\n      var parentInlines = filter(getParentInlines(rootElm, startElm), hasOnlyOneChild$1);\n      return last(parentInlines).exists(function (target) {\n        var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        if (willDeleteLastPositionInElement(forward, fromPos, target.dom) && !isEmptyCaretFormatElement(target)) {\n          deleteLastPosition(forward, editor, target, parentInlines);\n          return true;\n        } else {\n          return false;\n        }\n      });\n    };\n    var backspaceDelete$7 = function (editor, forward) {\n      return editor.selection.isCollapsed() ? deleteCaret$2(editor, forward) : false;\n    };\n\n    var deleteElement$2 = function (editor, forward, element) {\n      editor._selectionOverrides.hideFakeCaret();\n      deleteElement(editor, forward, SugarElement.fromDom(element));\n      return true;\n    };\n    var deleteCaret$3 = function (editor, forward) {\n      var isNearMedia = forward ? isBeforeMedia : isAfterMedia;\n      var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n      var fromPos = getNormalizedRangeEndPoint(direction, editor.getBody(), editor.selection.getRng());\n      if (isNearMedia(fromPos)) {\n        return deleteElement$2(editor, forward, fromPos.getNode(!forward));\n      } else {\n        return Optional.from(normalizePosition(forward, fromPos)).filter(function (pos) {\n          return isNearMedia(pos) && isMoveInsideSameBlock(fromPos, pos);\n        }).exists(function (pos) {\n          return deleteElement$2(editor, forward, pos.getNode(!forward));\n        });\n      }\n    };\n    var deleteRange$2 = function (editor, forward) {\n      var selectedNode = editor.selection.getNode();\n      return isMedia(selectedNode) ? deleteElement$2(editor, forward, selectedNode) : false;\n    };\n    var backspaceDelete$8 = function (editor, forward) {\n      return editor.selection.isCollapsed() ? deleteCaret$3(editor, forward) : deleteRange$2(editor, forward);\n    };\n\n    var isEditable$1 = function (target) {\n      return closest(target, function (elm) {\n        return isContentEditableTrue(elm.dom) || isContentEditableFalse(elm.dom);\n      }).exists(function (elm) {\n        return isContentEditableTrue(elm.dom);\n      });\n    };\n    var parseIndentValue = function (value) {\n      var number = parseInt(value, 10);\n      return isNaN(number) ? 0 : number;\n    };\n    var getIndentStyleName = function (useMargin, element) {\n      var indentStyleName = useMargin || isTable$1(element) ? 'margin' : 'padding';\n      var suffix = get$5(element, 'direction') === 'rtl' ? '-right' : '-left';\n      return indentStyleName + suffix;\n    };\n    var indentElement = function (dom, command, useMargin, value, unit, element) {\n      var indentStyleName = getIndentStyleName(useMargin, SugarElement.fromDom(element));\n      if (command === 'outdent') {\n        var styleValue = Math.max(0, parseIndentValue(element.style[indentStyleName]) - value);\n        dom.setStyle(element, indentStyleName, styleValue ? styleValue + unit : '');\n      } else {\n        var styleValue = parseIndentValue(element.style[indentStyleName]) + value + unit;\n        dom.setStyle(element, indentStyleName, styleValue);\n      }\n    };\n    var validateBlocks = function (editor, blocks) {\n      return forall(blocks, function (block) {\n        var indentStyleName = getIndentStyleName(shouldIndentUseMargin(editor), block);\n        var intentValue = getRaw(block, indentStyleName).map(parseIndentValue).getOr(0);\n        var contentEditable = editor.dom.getContentEditable(block.dom);\n        return contentEditable !== 'false' && intentValue > 0;\n      });\n    };\n    var canOutdent = function (editor) {\n      var blocks = getBlocksToIndent(editor);\n      return !editor.mode.isReadOnly() && (blocks.length > 1 || validateBlocks(editor, blocks));\n    };\n    var isListComponent = function (el) {\n      return isList(el) || isListItem(el);\n    };\n    var parentIsListComponent = function (el) {\n      return parent(el).map(isListComponent).getOr(false);\n    };\n    var getBlocksToIndent = function (editor) {\n      return filter(map(editor.selection.getSelectedBlocks(), SugarElement.fromDom), function (el) {\n        return !isListComponent(el) && !parentIsListComponent(el) && isEditable$1(el);\n      });\n    };\n    var handle = function (editor, command) {\n      var dom = editor.dom, selection = editor.selection, formatter = editor.formatter;\n      var indentation = getIndentation(editor);\n      var indentUnit = /[a-z%]+$/i.exec(indentation)[0];\n      var indentValue = parseInt(indentation, 10);\n      var useMargin = shouldIndentUseMargin(editor);\n      var forcedRootBlock = getForcedRootBlock(editor);\n      if (!editor.queryCommandState('InsertUnorderedList') && !editor.queryCommandState('InsertOrderedList')) {\n        if (forcedRootBlock === '' && !dom.getParent(selection.getNode(), dom.isBlock)) {\n          formatter.apply('div');\n        }\n      }\n      each(getBlocksToIndent(editor), function (block) {\n        indentElement(dom, command, useMargin, indentValue, indentUnit, block.dom);\n      });\n    };\n\n    var backspaceDelete$9 = function (editor, _forward) {\n      if (editor.selection.isCollapsed() && canOutdent(editor)) {\n        var dom = editor.dom;\n        var rng = editor.selection.getRng();\n        var pos = CaretPosition$1.fromRangeStart(rng);\n        var block = dom.getParent(rng.startContainer, dom.isBlock);\n        if (block !== null && isAtStartOfBlock(SugarElement.fromDom(block), pos)) {\n          handle(editor, 'outdent');\n          return true;\n        }\n      }\n      return false;\n    };\n\n    var nativeCommand = function (editor, command) {\n      editor.getDoc().execCommand(command, false, null);\n    };\n    var deleteCommand = function (editor, caret) {\n      if (backspaceDelete$9(editor)) {\n        return;\n      } else if (backspaceDelete$4(editor, false)) {\n        return;\n      } else if (backspaceDelete$3(editor, false)) {\n        return;\n      } else if (backspaceDelete$6(editor, caret, false)) {\n        return;\n      } else if (backspaceDelete$1(editor, false)) {\n        return;\n      } else if (backspaceDelete(editor)) {\n        return;\n      } else if (backspaceDelete$5(editor, false)) {\n        return;\n      } else if (backspaceDelete$8(editor, false)) {\n        return;\n      } else if (backspaceDelete$2(editor)) {\n        return;\n      } else if (backspaceDelete$7(editor, false)) {\n        return;\n      } else {\n        nativeCommand(editor, 'Delete');\n        paddEmptyBody(editor);\n      }\n    };\n    var forwardDeleteCommand = function (editor, caret) {\n      if (backspaceDelete$4(editor, true)) {\n        return;\n      } else if (backspaceDelete$3(editor, true)) {\n        return;\n      } else if (backspaceDelete$6(editor, caret, true)) {\n        return;\n      } else if (backspaceDelete$1(editor, true)) {\n        return;\n      } else if (backspaceDelete(editor)) {\n        return;\n      } else if (backspaceDelete$5(editor, true)) {\n        return;\n      } else if (backspaceDelete$8(editor, true)) {\n        return;\n      } else if (backspaceDelete$2(editor)) {\n        return;\n      } else if (backspaceDelete$7(editor, true)) {\n        return;\n      } else {\n        nativeCommand(editor, 'ForwardDelete');\n      }\n    };\n    var setup$8 = function (editor, caret) {\n      editor.addCommand('delete', function () {\n        deleteCommand(editor, caret);\n      });\n      editor.addCommand('forwardDelete', function () {\n        forwardDeleteCommand(editor, caret);\n      });\n    };\n\n    var SIGNIFICANT_MOVE = 5;\n    var LONGPRESS_DELAY = 400;\n    var getTouch = function (event) {\n      if (event.touches === undefined || event.touches.length !== 1) {\n        return Optional.none();\n      }\n      return Optional.some(event.touches[0]);\n    };\n    var isFarEnough = function (touch, data) {\n      var distX = Math.abs(touch.clientX - data.x);\n      var distY = Math.abs(touch.clientY - data.y);\n      return distX > SIGNIFICANT_MOVE || distY > SIGNIFICANT_MOVE;\n    };\n    var setup$9 = function (editor) {\n      var startData = Cell(Optional.none());\n      var longpressFired = Cell(false);\n      var debounceLongpress = last$2(function (e) {\n        editor.fire('longpress', __assign(__assign({}, e), { type: 'longpress' }));\n        longpressFired.set(true);\n      }, LONGPRESS_DELAY);\n      editor.on('touchstart', function (e) {\n        getTouch(e).each(function (touch) {\n          debounceLongpress.cancel();\n          var data = {\n            x: touch.clientX,\n            y: touch.clientY,\n            target: e.target\n          };\n          debounceLongpress.throttle(e);\n          longpressFired.set(false);\n          startData.set(Optional.some(data));\n        });\n      }, true);\n      editor.on('touchmove', function (e) {\n        debounceLongpress.cancel();\n        getTouch(e).each(function (touch) {\n          startData.get().each(function (data) {\n            if (isFarEnough(touch, data)) {\n              startData.set(Optional.none());\n              longpressFired.set(false);\n              editor.fire('longpresscancel');\n            }\n          });\n        });\n      }, true);\n      editor.on('touchend touchcancel', function (e) {\n        debounceLongpress.cancel();\n        if (e.type === 'touchcancel') {\n          return;\n        }\n        startData.get().filter(function (data) {\n          return data.target.isEqualNode(e.target);\n        }).each(function () {\n          if (longpressFired.get()) {\n            e.preventDefault();\n          } else {\n            editor.fire('tap', __assign(__assign({}, e), { type: 'tap' }));\n          }\n        });\n      }, true);\n    };\n\n    var isBlockElement = function (blockElements, node) {\n      return blockElements.hasOwnProperty(node.nodeName);\n    };\n    var isValidTarget = function (blockElements, node) {\n      if (isText$1(node)) {\n        return true;\n      } else if (isElement$1(node)) {\n        return !isBlockElement(blockElements, node) && !isBookmarkNode$1(node);\n      } else {\n        return false;\n      }\n    };\n    var hasBlockParent = function (blockElements, root, node) {\n      return exists(parents$1(SugarElement.fromDom(node), SugarElement.fromDom(root)), function (elm) {\n        return isBlockElement(blockElements, elm.dom);\n      });\n    };\n    var shouldRemoveTextNode = function (blockElements, node) {\n      if (isText$1(node)) {\n        if (node.nodeValue.length === 0) {\n          return true;\n        } else if (/^\\s+$/.test(node.nodeValue) && (!node.nextSibling || isBlockElement(blockElements, node.nextSibling))) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var addRootBlocks = function (editor) {\n      var dom = editor.dom, selection = editor.selection;\n      var schema = editor.schema, blockElements = schema.getBlockElements();\n      var node = selection.getStart();\n      var rootNode = editor.getBody();\n      var rootBlockNode, tempNode, wrapped;\n      var forcedRootBlock = getForcedRootBlock(editor);\n      if (!node || !isElement$1(node) || !forcedRootBlock) {\n        return;\n      }\n      var rootNodeName = rootNode.nodeName.toLowerCase();\n      if (!schema.isValidChild(rootNodeName, forcedRootBlock.toLowerCase()) || hasBlockParent(blockElements, rootNode, node)) {\n        return;\n      }\n      var rng = selection.getRng();\n      var startContainer = rng.startContainer;\n      var startOffset = rng.startOffset;\n      var endContainer = rng.endContainer;\n      var endOffset = rng.endOffset;\n      var restoreSelection = hasFocus$1(editor);\n      node = rootNode.firstChild;\n      while (node) {\n        if (isValidTarget(blockElements, node)) {\n          if (shouldRemoveTextNode(blockElements, node)) {\n            tempNode = node;\n            node = node.nextSibling;\n            dom.remove(tempNode);\n            continue;\n          }\n          if (!rootBlockNode) {\n            rootBlockNode = dom.create(forcedRootBlock, getForcedRootBlockAttrs(editor));\n            node.parentNode.insertBefore(rootBlockNode, node);\n            wrapped = true;\n          }\n          tempNode = node;\n          node = node.nextSibling;\n          rootBlockNode.appendChild(tempNode);\n        } else {\n          rootBlockNode = null;\n          node = node.nextSibling;\n        }\n      }\n      if (wrapped && restoreSelection) {\n        rng.setStart(startContainer, startOffset);\n        rng.setEnd(endContainer, endOffset);\n        selection.setRng(rng);\n        editor.nodeChanged();\n      }\n    };\n    var setup$a = function (editor) {\n      if (getForcedRootBlock(editor)) {\n        editor.on('NodeChange', curry(addRootBlocks, editor));\n      }\n    };\n\n    var findBlockCaretContainer = function (editor) {\n      return descendant(SugarElement.fromDom(editor.getBody()), '*[data-mce-caret]').fold(constant(null), function (elm) {\n        return elm.dom;\n      });\n    };\n    var removeIeControlRect = function (editor) {\n      editor.selection.setRng(editor.selection.getRng());\n    };\n    var showBlockCaretContainer = function (editor, blockCaretContainer) {\n      if (blockCaretContainer.hasAttribute('data-mce-caret')) {\n        showCaretContainerBlock(blockCaretContainer);\n        removeIeControlRect(editor);\n        editor.selection.scrollIntoView(blockCaretContainer);\n      }\n    };\n    var handleBlockContainer = function (editor, e) {\n      var blockCaretContainer = findBlockCaretContainer(editor);\n      if (!blockCaretContainer) {\n        return;\n      }\n      if (e.type === 'compositionstart') {\n        e.preventDefault();\n        e.stopPropagation();\n        showBlockCaretContainer(editor, blockCaretContainer);\n        return;\n      }\n      if (hasContent(blockCaretContainer)) {\n        showBlockCaretContainer(editor, blockCaretContainer);\n        editor.undoManager.add();\n      }\n    };\n    var setup$b = function (editor) {\n      editor.on('keyup compositionstart', curry(handleBlockContainer, editor));\n    };\n\n    var BreakType;\n    (function (BreakType) {\n      BreakType[BreakType['Br'] = 0] = 'Br';\n      BreakType[BreakType['Block'] = 1] = 'Block';\n      BreakType[BreakType['Wrap'] = 2] = 'Wrap';\n      BreakType[BreakType['Eol'] = 3] = 'Eol';\n    }(BreakType || (BreakType = {})));\n    var flip = function (direction, positions) {\n      return direction === HDirection.Backwards ? reverse(positions) : positions;\n    };\n    var walk$3 = function (direction, caretWalker, pos) {\n      return direction === HDirection.Forwards ? caretWalker.next(pos) : caretWalker.prev(pos);\n    };\n    var getBreakType = function (scope, direction, currentPos, nextPos) {\n      if (isBr(nextPos.getNode(direction === HDirection.Forwards))) {\n        return BreakType.Br;\n      } else if (isInSameBlock(currentPos, nextPos) === false) {\n        return BreakType.Block;\n      } else {\n        return BreakType.Wrap;\n      }\n    };\n    var getPositionsUntil = function (predicate, direction, scope, start) {\n      var caretWalker = CaretWalker(scope);\n      var currentPos = start, nextPos;\n      var positions = [];\n      while (currentPos) {\n        nextPos = walk$3(direction, caretWalker, currentPos);\n        if (!nextPos) {\n          break;\n        }\n        if (isBr(nextPos.getNode(false))) {\n          if (direction === HDirection.Forwards) {\n            return {\n              positions: flip(direction, positions).concat([nextPos]),\n              breakType: BreakType.Br,\n              breakAt: Optional.some(nextPos)\n            };\n          } else {\n            return {\n              positions: flip(direction, positions),\n              breakType: BreakType.Br,\n              breakAt: Optional.some(nextPos)\n            };\n          }\n        }\n        if (!nextPos.isVisible()) {\n          currentPos = nextPos;\n          continue;\n        }\n        if (predicate(currentPos, nextPos)) {\n          var breakType = getBreakType(scope, direction, currentPos, nextPos);\n          return {\n            positions: flip(direction, positions),\n            breakType: breakType,\n            breakAt: Optional.some(nextPos)\n          };\n        }\n        positions.push(nextPos);\n        currentPos = nextPos;\n      }\n      return {\n        positions: flip(direction, positions),\n        breakType: BreakType.Eol,\n        breakAt: Optional.none()\n      };\n    };\n    var getAdjacentLinePositions = function (direction, getPositionsUntilBreak, scope, start) {\n      return getPositionsUntilBreak(scope, start).breakAt.map(function (pos) {\n        var positions = getPositionsUntilBreak(scope, pos).positions;\n        return direction === HDirection.Backwards ? positions.concat(pos) : [pos].concat(positions);\n      }).getOr([]);\n    };\n    var findClosestHorizontalPositionFromPoint = function (positions, x) {\n      return foldl(positions, function (acc, newPos) {\n        return acc.fold(function () {\n          return Optional.some(newPos);\n        }, function (lastPos) {\n          return lift2(head(lastPos.getClientRects()), head(newPos.getClientRects()), function (lastRect, newRect) {\n            var lastDist = Math.abs(x - lastRect.left);\n            var newDist = Math.abs(x - newRect.left);\n            return newDist <= lastDist ? newPos : lastPos;\n          }).or(acc);\n        });\n      }, Optional.none());\n    };\n    var findClosestHorizontalPosition = function (positions, pos) {\n      return head(pos.getClientRects()).bind(function (targetRect) {\n        return findClosestHorizontalPositionFromPoint(positions, targetRect.left);\n      });\n    };\n    var getPositionsUntilPreviousLine = curry(getPositionsUntil, CaretPosition.isAbove, -1);\n    var getPositionsUntilNextLine = curry(getPositionsUntil, CaretPosition.isBelow, 1);\n    var isAtFirstLine = function (scope, pos) {\n      return getPositionsUntilPreviousLine(scope, pos).breakAt.isNone();\n    };\n    var isAtLastLine = function (scope, pos) {\n      return getPositionsUntilNextLine(scope, pos).breakAt.isNone();\n    };\n    var getPositionsAbove = curry(getAdjacentLinePositions, -1, getPositionsUntilPreviousLine);\n    var getPositionsBelow = curry(getAdjacentLinePositions, 1, getPositionsUntilNextLine);\n    var getFirstLinePositions = function (scope) {\n      return firstPositionIn(scope).map(function (pos) {\n        return [pos].concat(getPositionsUntilNextLine(scope, pos).positions);\n      }).getOr([]);\n    };\n    var getLastLinePositions = function (scope) {\n      return lastPositionIn(scope).map(function (pos) {\n        return getPositionsUntilPreviousLine(scope, pos).positions.concat(pos);\n      }).getOr([]);\n    };\n\n    var getNodeClientRects = function (node) {\n      var toArrayWithNode = function (clientRects) {\n        return map(clientRects, function (clientRect) {\n          clientRect = clone$2(clientRect);\n          clientRect.node = node;\n          return clientRect;\n        });\n      };\n      if (isElement$1(node)) {\n        return toArrayWithNode(node.getClientRects());\n      }\n      if (isText$1(node)) {\n        var rng = node.ownerDocument.createRange();\n        rng.setStart(node, 0);\n        rng.setEnd(node, node.data.length);\n        return toArrayWithNode(rng.getClientRects());\n      }\n    };\n    var getClientRects = function (nodes) {\n      return bind(nodes, getNodeClientRects);\n    };\n\n    var VDirection;\n    (function (VDirection) {\n      VDirection[VDirection['Up'] = -1] = 'Up';\n      VDirection[VDirection['Down'] = 1] = 'Down';\n    }(VDirection || (VDirection = {})));\n    var findUntil$1 = function (direction, root, predicateFn, node) {\n      while (node = findNode(node, direction, isEditableCaretCandidate, root)) {\n        if (predicateFn(node)) {\n          return;\n        }\n      }\n    };\n    var walkUntil = function (direction, isAboveFn, isBeflowFn, root, predicateFn, caretPosition) {\n      var line = 0;\n      var result = [];\n      var add = function (node) {\n        var i, clientRect, clientRects;\n        clientRects = getClientRects([node]);\n        if (direction === -1) {\n          clientRects = clientRects.reverse();\n        }\n        for (i = 0; i < clientRects.length; i++) {\n          clientRect = clientRects[i];\n          if (isBeflowFn(clientRect, targetClientRect)) {\n            continue;\n          }\n          if (result.length > 0 && isAboveFn(clientRect, last$1(result))) {\n            line++;\n          }\n          clientRect.line = line;\n          if (predicateFn(clientRect)) {\n            return true;\n          }\n          result.push(clientRect);\n        }\n      };\n      var targetClientRect = last$1(caretPosition.getClientRects());\n      if (!targetClientRect) {\n        return result;\n      }\n      var node = caretPosition.getNode();\n      add(node);\n      findUntil$1(direction, root, add, node);\n      return result;\n    };\n    var aboveLineNumber = function (lineNumber, clientRect) {\n      return clientRect.line > lineNumber;\n    };\n    var isLineNumber = function (lineNumber, clientRect) {\n      return clientRect.line === lineNumber;\n    };\n    var upUntil = curry(walkUntil, VDirection.Up, isAbove, isBelow);\n    var downUntil = curry(walkUntil, VDirection.Down, isBelow, isAbove);\n    var positionsUntil = function (direction, root, predicateFn, node) {\n      var caretWalker = CaretWalker(root);\n      var walkFn, isBelowFn, isAboveFn, caretPosition;\n      var result = [];\n      var line = 0, clientRect;\n      var getClientRect = function (caretPosition) {\n        if (direction === 1) {\n          return last$1(caretPosition.getClientRects());\n        }\n        return last$1(caretPosition.getClientRects());\n      };\n      if (direction === 1) {\n        walkFn = caretWalker.next;\n        isBelowFn = isBelow;\n        isAboveFn = isAbove;\n        caretPosition = CaretPosition$1.after(node);\n      } else {\n        walkFn = caretWalker.prev;\n        isBelowFn = isAbove;\n        isAboveFn = isBelow;\n        caretPosition = CaretPosition$1.before(node);\n      }\n      var targetClientRect = getClientRect(caretPosition);\n      do {\n        if (!caretPosition.isVisible()) {\n          continue;\n        }\n        clientRect = getClientRect(caretPosition);\n        if (isAboveFn(clientRect, targetClientRect)) {\n          continue;\n        }\n        if (result.length > 0 && isBelowFn(clientRect, last$1(result))) {\n          line++;\n        }\n        clientRect = clone$2(clientRect);\n        clientRect.position = caretPosition;\n        clientRect.line = line;\n        if (predicateFn(clientRect)) {\n          return result;\n        }\n        result.push(clientRect);\n      } while (caretPosition = walkFn(caretPosition));\n      return result;\n    };\n    var isAboveLine = function (lineNumber) {\n      return function (clientRect) {\n        return aboveLineNumber(lineNumber, clientRect);\n      };\n    };\n    var isLine = function (lineNumber) {\n      return function (clientRect) {\n        return isLineNumber(lineNumber, clientRect);\n      };\n    };\n\n    var isContentEditableFalse$8 = isContentEditableFalse;\n    var findNode$1 = findNode;\n    var distanceToRectLeft = function (clientRect, clientX) {\n      return Math.abs(clientRect.left - clientX);\n    };\n    var distanceToRectRight = function (clientRect, clientX) {\n      return Math.abs(clientRect.right - clientX);\n    };\n    var isInsideX = function (clientX, clientRect) {\n      return clientX >= clientRect.left && clientX <= clientRect.right;\n    };\n    var isInsideY = function (clientY, clientRect) {\n      return clientY >= clientRect.top && clientY <= clientRect.bottom;\n    };\n    var findClosestClientRect = function (clientRects, clientX) {\n      return reduce(clientRects, function (oldClientRect, clientRect) {\n        var oldDistance = Math.min(distanceToRectLeft(oldClientRect, clientX), distanceToRectRight(oldClientRect, clientX));\n        var newDistance = Math.min(distanceToRectLeft(clientRect, clientX), distanceToRectRight(clientRect, clientX));\n        if (isInsideX(clientX, clientRect)) {\n          return clientRect;\n        }\n        if (isInsideX(clientX, oldClientRect)) {\n          return oldClientRect;\n        }\n        if (newDistance === oldDistance && isContentEditableFalse$8(clientRect.node)) {\n          return clientRect;\n        }\n        if (newDistance < oldDistance) {\n          return clientRect;\n        }\n        return oldClientRect;\n      });\n    };\n    var walkUntil$1 = function (direction, root, predicateFn, startNode, includeChildren) {\n      var node = findNode$1(startNode, direction, isEditableCaretCandidate, root, !includeChildren);\n      do {\n        if (!node || predicateFn(node)) {\n          return;\n        }\n      } while (node = findNode$1(node, direction, isEditableCaretCandidate, root));\n    };\n    var findLineNodeRects = function (root, targetNodeRect, includeChildren) {\n      if (includeChildren === void 0) {\n        includeChildren = true;\n      }\n      var clientRects = [];\n      var collect = function (checkPosFn, node) {\n        var lineRects = filter(getClientRects([node]), function (clientRect) {\n          return !checkPosFn(clientRect, targetNodeRect);\n        });\n        clientRects = clientRects.concat(lineRects);\n        return lineRects.length === 0;\n      };\n      clientRects.push(targetNodeRect);\n      walkUntil$1(VDirection.Up, root, curry(collect, isAbove), targetNodeRect.node, includeChildren);\n      walkUntil$1(VDirection.Down, root, curry(collect, isBelow), targetNodeRect.node, includeChildren);\n      return clientRects;\n    };\n    var getFakeCaretTargets = function (root) {\n      return filter(from$1(root.getElementsByTagName('*')), isFakeCaretTarget);\n    };\n    var caretInfo = function (clientRect, clientX) {\n      return {\n        node: clientRect.node,\n        before: distanceToRectLeft(clientRect, clientX) < distanceToRectRight(clientRect, clientX)\n      };\n    };\n    var closestFakeCaret = function (root, clientX, clientY) {\n      var fakeTargetNodeRects = getClientRects(getFakeCaretTargets(root));\n      var targetNodeRects = filter(fakeTargetNodeRects, curry(isInsideY, clientY));\n      var closestNodeRect = findClosestClientRect(targetNodeRects, clientX);\n      if (closestNodeRect) {\n        var includeChildren = !isTable(closestNodeRect.node) && !isMedia(closestNodeRect.node);\n        closestNodeRect = findClosestClientRect(findLineNodeRects(root, closestNodeRect, includeChildren), clientX);\n        if (closestNodeRect && isFakeCaretTarget(closestNodeRect.node)) {\n          return caretInfo(closestNodeRect, clientX);\n        }\n      }\n      return null;\n    };\n\n    var moveToRange = function (editor, rng) {\n      editor.selection.setRng(rng);\n      scrollRangeIntoView(editor, editor.selection.getRng());\n    };\n    var renderRangeCaretOpt = function (editor, range, scrollIntoView) {\n      return Optional.some(renderRangeCaret(editor, range, scrollIntoView));\n    };\n    var moveHorizontally = function (editor, direction, range, isBefore, isAfter, isElement) {\n      var forwards = direction === HDirection.Forwards;\n      var caretWalker = CaretWalker(editor.getBody());\n      var getNextPosFn = curry(getVisualCaretPosition, forwards ? caretWalker.next : caretWalker.prev);\n      var isBeforeFn = forwards ? isBefore : isAfter;\n      if (!range.collapsed) {\n        var node = getSelectedNode(range);\n        if (isElement(node)) {\n          return showCaret(direction, editor, node, direction === HDirection.Backwards, false);\n        }\n      }\n      var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n      if (isBeforeFn(caretPosition)) {\n        return selectNode(editor, caretPosition.getNode(!forwards));\n      }\n      var nextCaretPosition = normalizePosition(forwards, getNextPosFn(caretPosition));\n      var rangeIsInContainerBlock = isRangeInCaretContainerBlock(range);\n      if (!nextCaretPosition) {\n        return rangeIsInContainerBlock ? Optional.some(range) : Optional.none();\n      }\n      if (isBeforeFn(nextCaretPosition)) {\n        return showCaret(direction, editor, nextCaretPosition.getNode(!forwards), forwards, false);\n      }\n      var peekCaretPosition = getNextPosFn(nextCaretPosition);\n      if (peekCaretPosition && isBeforeFn(peekCaretPosition)) {\n        if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\n          return showCaret(direction, editor, peekCaretPosition.getNode(!forwards), forwards, false);\n        }\n      }\n      if (rangeIsInContainerBlock) {\n        return renderRangeCaretOpt(editor, nextCaretPosition.toRange(), false);\n      }\n      return Optional.none();\n    };\n    var moveVertically = function (editor, direction, range, isBefore, isAfter, isElement) {\n      var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n      var caretClientRect = last$1(caretPosition.getClientRects());\n      var forwards = direction === VDirection.Down;\n      if (!caretClientRect) {\n        return Optional.none();\n      }\n      var walkerFn = forwards ? downUntil : upUntil;\n      var linePositions = walkerFn(editor.getBody(), isAboveLine(1), caretPosition);\n      var nextLinePositions = filter(linePositions, isLine(1));\n      var clientX = caretClientRect.left;\n      var nextLineRect = findClosestClientRect(nextLinePositions, clientX);\n      if (nextLineRect && isElement(nextLineRect.node)) {\n        var dist1 = Math.abs(clientX - nextLineRect.left);\n        var dist2 = Math.abs(clientX - nextLineRect.right);\n        return showCaret(direction, editor, nextLineRect.node, dist1 < dist2, false);\n      }\n      var currentNode;\n      if (isBefore(caretPosition)) {\n        currentNode = caretPosition.getNode();\n      } else if (isAfter(caretPosition)) {\n        currentNode = caretPosition.getNode(true);\n      } else {\n        currentNode = getSelectedNode(range);\n      }\n      if (currentNode) {\n        var caretPositions = positionsUntil(direction, editor.getBody(), isAboveLine(1), currentNode);\n        var closestNextLineRect = findClosestClientRect(filter(caretPositions, isLine(1)), clientX);\n        if (closestNextLineRect) {\n          return renderRangeCaretOpt(editor, closestNextLineRect.position.toRange(), false);\n        }\n        closestNextLineRect = last$1(filter(caretPositions, isLine(0)));\n        if (closestNextLineRect) {\n          return renderRangeCaretOpt(editor, closestNextLineRect.position.toRange(), false);\n        }\n      }\n      if (nextLinePositions.length === 0) {\n        return getLineEndPoint(editor, forwards).filter(forwards ? isAfter : isBefore).map(function (pos) {\n          return renderRangeCaret(editor, pos.toRange(), false);\n        });\n      }\n      return Optional.none();\n    };\n    var getLineEndPoint = function (editor, forward) {\n      var rng = editor.selection.getRng();\n      var body = editor.getBody();\n      if (forward) {\n        var from = CaretPosition$1.fromRangeEnd(rng);\n        var result = getPositionsUntilNextLine(body, from);\n        return last(result.positions);\n      } else {\n        var from = CaretPosition$1.fromRangeStart(rng);\n        var result = getPositionsUntilPreviousLine(body, from);\n        return head(result.positions);\n      }\n    };\n    var moveToLineEndPoint = function (editor, forward, isElementPosition) {\n      return getLineEndPoint(editor, forward).filter(isElementPosition).exists(function (pos) {\n        editor.selection.setRng(pos.toRange());\n        return true;\n      });\n    };\n\n    var isContentEditableFalse$9 = isContentEditableFalse;\n    var moveToCeFalseHorizontally = function (direction, editor, range) {\n      return moveHorizontally(editor, direction, range, isBeforeContentEditableFalse, isAfterContentEditableFalse, isContentEditableFalse$9);\n    };\n    var moveToCeFalseVertically = function (direction, editor, range) {\n      var isBefore = function (caretPosition) {\n        return isBeforeContentEditableFalse(caretPosition) || isBeforeTable(caretPosition);\n      };\n      var isAfter = function (caretPosition) {\n        return isAfterContentEditableFalse(caretPosition) || isAfterTable(caretPosition);\n      };\n      return moveVertically(editor, direction, range, isBefore, isAfter, isContentEditableFalse$9);\n    };\n    var createTextBlock = function (editor) {\n      var textBlock = editor.dom.create(getForcedRootBlock(editor));\n      if (!Env.ie || Env.ie >= 11) {\n        textBlock.innerHTML = '<br data-mce-bogus=\"1\">';\n      }\n      return textBlock;\n    };\n    var exitPreBlock = function (editor, direction, range) {\n      var caretWalker = CaretWalker(editor.getBody());\n      var getVisualCaretPosition$1 = curry(getVisualCaretPosition, direction === 1 ? caretWalker.next : caretWalker.prev);\n      if (range.collapsed && hasForcedRootBlock(editor)) {\n        var pre = editor.dom.getParent(range.startContainer, 'PRE');\n        if (!pre) {\n          return;\n        }\n        var caretPos = getVisualCaretPosition$1(CaretPosition$1.fromRangeStart(range));\n        if (!caretPos) {\n          var newBlock = createTextBlock(editor);\n          if (direction === 1) {\n            editor.$(pre).after(newBlock);\n          } else {\n            editor.$(pre).before(newBlock);\n          }\n          editor.selection.select(newBlock, true);\n          editor.selection.collapse();\n        }\n      }\n    };\n    var getHorizontalRange = function (editor, forward) {\n      var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n      var range = editor.selection.getRng();\n      return moveToCeFalseHorizontally(direction, editor, range).orThunk(function () {\n        exitPreBlock(editor, direction, range);\n        return Optional.none();\n      });\n    };\n    var getVerticalRange = function (editor, down) {\n      var direction = down ? 1 : -1;\n      var range = editor.selection.getRng();\n      return moveToCeFalseVertically(direction, editor, range).orThunk(function () {\n        exitPreBlock(editor, direction, range);\n        return Optional.none();\n      });\n    };\n    var moveH = function (editor, forward) {\n      return getHorizontalRange(editor, forward).exists(function (newRange) {\n        moveToRange(editor, newRange);\n        return true;\n      });\n    };\n    var moveV = function (editor, down) {\n      return getVerticalRange(editor, down).exists(function (newRange) {\n        moveToRange(editor, newRange);\n        return true;\n      });\n    };\n    var moveToLineEndPoint$1 = function (editor, forward) {\n      var isCefPosition = forward ? isAfterContentEditableFalse : isBeforeContentEditableFalse;\n      return moveToLineEndPoint(editor, forward, isCefPosition);\n    };\n\n    var isTarget = function (node) {\n      return contains(['figcaption'], name(node));\n    };\n    var rangeBefore = function (target) {\n      var rng = document.createRange();\n      rng.setStartBefore(target.dom);\n      rng.setEndBefore(target.dom);\n      return rng;\n    };\n    var insertElement = function (root, elm, forward) {\n      if (forward) {\n        append(root, elm);\n      } else {\n        prepend(root, elm);\n      }\n    };\n    var insertBr = function (root, forward) {\n      var br = SugarElement.fromTag('br');\n      insertElement(root, br, forward);\n      return rangeBefore(br);\n    };\n    var insertBlock$1 = function (root, forward, blockName, attrs) {\n      var block = SugarElement.fromTag(blockName);\n      var br = SugarElement.fromTag('br');\n      setAll(block, attrs);\n      append(block, br);\n      insertElement(root, block, forward);\n      return rangeBefore(br);\n    };\n    var insertEmptyLine = function (root, rootBlockName, attrs, forward) {\n      if (rootBlockName === '') {\n        return insertBr(root, forward);\n      } else {\n        return insertBlock$1(root, forward, rootBlockName, attrs);\n      }\n    };\n    var getClosestTargetBlock = function (pos, root) {\n      var isRoot = curry(eq$2, root);\n      return closest(SugarElement.fromDom(pos.container()), isBlock, isRoot).filter(isTarget);\n    };\n    var isAtFirstOrLastLine = function (root, forward, pos) {\n      return forward ? isAtLastLine(root.dom, pos) : isAtFirstLine(root.dom, pos);\n    };\n    var moveCaretToNewEmptyLine = function (editor, forward) {\n      var root = SugarElement.fromDom(editor.getBody());\n      var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      var rootBlock = getForcedRootBlock(editor);\n      var rootBlockAttrs = getForcedRootBlockAttrs(editor);\n      return getClosestTargetBlock(pos, root).exists(function () {\n        if (isAtFirstOrLastLine(root, forward, pos)) {\n          var rng = insertEmptyLine(root, rootBlock, rootBlockAttrs, forward);\n          editor.selection.setRng(rng);\n          return true;\n        } else {\n          return false;\n        }\n      });\n    };\n    var moveV$1 = function (editor, forward) {\n      if (editor.selection.isCollapsed()) {\n        return moveCaretToNewEmptyLine(editor, forward);\n      } else {\n        return false;\n      }\n    };\n\n    var defaultPatterns = function (patterns) {\n      return map(patterns, function (pattern) {\n        return __assign({\n          shiftKey: false,\n          altKey: false,\n          ctrlKey: false,\n          metaKey: false,\n          keyCode: 0,\n          action: noop\n        }, pattern);\n      });\n    };\n    var matchesEvent = function (pattern, evt) {\n      return evt.keyCode === pattern.keyCode && evt.shiftKey === pattern.shiftKey && evt.altKey === pattern.altKey && evt.ctrlKey === pattern.ctrlKey && evt.metaKey === pattern.metaKey;\n    };\n    var match$1 = function (patterns, evt) {\n      return bind(defaultPatterns(patterns), function (pattern) {\n        return matchesEvent(pattern, evt) ? [pattern] : [];\n      });\n    };\n    var action = function (f) {\n      var x = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        x[_i - 1] = arguments[_i];\n      }\n      return function () {\n        return f.apply(null, x);\n      };\n    };\n    var execute = function (patterns, evt) {\n      return find(match$1(patterns, evt), function (pattern) {\n        return pattern.action();\n      });\n    };\n\n    var moveH$1 = function (editor, forward) {\n      var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n      var range = editor.selection.getRng();\n      return moveHorizontally(editor, direction, range, isBeforeMedia, isAfterMedia, isMedia).exists(function (newRange) {\n        moveToRange(editor, newRange);\n        return true;\n      });\n    };\n    var moveV$2 = function (editor, down) {\n      var direction = down ? 1 : -1;\n      var range = editor.selection.getRng();\n      return moveVertically(editor, direction, range, isBeforeMedia, isAfterMedia, isMedia).exists(function (newRange) {\n        moveToRange(editor, newRange);\n        return true;\n      });\n    };\n    var moveToLineEndPoint$2 = function (editor, forward) {\n      var isNearMedia = forward ? isAfterMedia : isBeforeMedia;\n      return moveToLineEndPoint(editor, forward, isNearMedia);\n    };\n\n    var deflate = function (rect, delta) {\n      return {\n        left: rect.left - delta,\n        top: rect.top - delta,\n        right: rect.right + delta * 2,\n        bottom: rect.bottom + delta * 2,\n        width: rect.width + delta,\n        height: rect.height + delta\n      };\n    };\n    var getCorners = function (getYAxisValue, tds) {\n      return bind(tds, function (td) {\n        var rect = deflate(clone$2(td.getBoundingClientRect()), -1);\n        return [\n          {\n            x: rect.left,\n            y: getYAxisValue(rect),\n            cell: td\n          },\n          {\n            x: rect.right,\n            y: getYAxisValue(rect),\n            cell: td\n          }\n        ];\n      });\n    };\n    var findClosestCorner = function (corners, x, y) {\n      return foldl(corners, function (acc, newCorner) {\n        return acc.fold(function () {\n          return Optional.some(newCorner);\n        }, function (oldCorner) {\n          var oldDist = Math.sqrt(Math.abs(oldCorner.x - x) + Math.abs(oldCorner.y - y));\n          var newDist = Math.sqrt(Math.abs(newCorner.x - x) + Math.abs(newCorner.y - y));\n          return Optional.some(newDist < oldDist ? newCorner : oldCorner);\n        });\n      }, Optional.none());\n    };\n    var getClosestCell$1 = function (getYAxisValue, isTargetCorner, table, x, y) {\n      var cells = descendants$1(SugarElement.fromDom(table), 'td,th,caption').map(function (e) {\n        return e.dom;\n      });\n      var corners = filter(getCorners(getYAxisValue, cells), function (corner) {\n        return isTargetCorner(corner, y);\n      });\n      return findClosestCorner(corners, x, y).map(function (corner) {\n        return corner.cell;\n      });\n    };\n    var getBottomValue = function (rect) {\n      return rect.bottom;\n    };\n    var getTopValue = function (rect) {\n      return rect.top;\n    };\n    var isAbove$1 = function (corner, y) {\n      return corner.y < y;\n    };\n    var isBelow$1 = function (corner, y) {\n      return corner.y > y;\n    };\n    var getClosestCellAbove = curry(getClosestCell$1, getBottomValue, isAbove$1);\n    var getClosestCellBelow = curry(getClosestCell$1, getTopValue, isBelow$1);\n    var findClosestPositionInAboveCell = function (table, pos) {\n      return head(pos.getClientRects()).bind(function (rect) {\n        return getClosestCellAbove(table, rect.left, rect.top);\n      }).bind(function (cell) {\n        return findClosestHorizontalPosition(getLastLinePositions(cell), pos);\n      });\n    };\n    var findClosestPositionInBelowCell = function (table, pos) {\n      return last(pos.getClientRects()).bind(function (rect) {\n        return getClosestCellBelow(table, rect.left, rect.top);\n      }).bind(function (cell) {\n        return findClosestHorizontalPosition(getFirstLinePositions(cell), pos);\n      });\n    };\n\n    var hasNextBreak = function (getPositionsUntil, scope, lineInfo) {\n      return lineInfo.breakAt.exists(function (breakPos) {\n        return getPositionsUntil(scope, breakPos).breakAt.isSome();\n      });\n    };\n    var startsWithWrapBreak = function (lineInfo) {\n      return lineInfo.breakType === BreakType.Wrap && lineInfo.positions.length === 0;\n    };\n    var startsWithBrBreak = function (lineInfo) {\n      return lineInfo.breakType === BreakType.Br && lineInfo.positions.length === 1;\n    };\n    var isAtTableCellLine = function (getPositionsUntil, scope, pos) {\n      var lineInfo = getPositionsUntil(scope, pos);\n      if (startsWithWrapBreak(lineInfo) || !isBr(pos.getNode()) && startsWithBrBreak(lineInfo)) {\n        return !hasNextBreak(getPositionsUntil, scope, lineInfo);\n      } else {\n        return lineInfo.breakAt.isNone();\n      }\n    };\n    var isAtFirstTableCellLine = curry(isAtTableCellLine, getPositionsUntilPreviousLine);\n    var isAtLastTableCellLine = curry(isAtTableCellLine, getPositionsUntilNextLine);\n    var isCaretAtStartOrEndOfTable = function (forward, rng, table) {\n      var caretPos = CaretPosition$1.fromRangeStart(rng);\n      return positionIn(!forward, table).exists(function (pos) {\n        return pos.isEqual(caretPos);\n      });\n    };\n    var navigateHorizontally = function (editor, forward, table, _td) {\n      var rng = editor.selection.getRng();\n      var direction = forward ? 1 : -1;\n      if (isFakeCaretTableBrowser() && isCaretAtStartOrEndOfTable(forward, rng, table)) {\n        showCaret(direction, editor, table, !forward, false).each(function (newRng) {\n          moveToRange(editor, newRng);\n        });\n        return true;\n      }\n      return false;\n    };\n    var getClosestAbovePosition = function (root, table, start) {\n      return findClosestPositionInAboveCell(table, start).orThunk(function () {\n        return head(start.getClientRects()).bind(function (rect) {\n          return findClosestHorizontalPositionFromPoint(getPositionsAbove(root, CaretPosition$1.before(table)), rect.left);\n        });\n      }).getOr(CaretPosition$1.before(table));\n    };\n    var getClosestBelowPosition = function (root, table, start) {\n      return findClosestPositionInBelowCell(table, start).orThunk(function () {\n        return head(start.getClientRects()).bind(function (rect) {\n          return findClosestHorizontalPositionFromPoint(getPositionsBelow(root, CaretPosition$1.after(table)), rect.left);\n        });\n      }).getOr(CaretPosition$1.after(table));\n    };\n    var getTable = function (previous, pos) {\n      var node = pos.getNode(previous);\n      return isElement$1(node) && node.nodeName === 'TABLE' ? Optional.some(node) : Optional.none();\n    };\n    var renderBlock = function (down, editor, table, pos) {\n      var forcedRootBlock = getForcedRootBlock(editor);\n      if (forcedRootBlock) {\n        editor.undoManager.transact(function () {\n          var element = SugarElement.fromTag(forcedRootBlock);\n          setAll(element, getForcedRootBlockAttrs(editor));\n          append(element, SugarElement.fromTag('br'));\n          if (down) {\n            after(SugarElement.fromDom(table), element);\n          } else {\n            before(SugarElement.fromDom(table), element);\n          }\n          var rng = editor.dom.createRng();\n          rng.setStart(element.dom, 0);\n          rng.setEnd(element.dom, 0);\n          moveToRange(editor, rng);\n        });\n      } else {\n        moveToRange(editor, pos.toRange());\n      }\n    };\n    var moveCaret = function (editor, down, pos) {\n      var table = down ? getTable(true, pos) : getTable(false, pos);\n      var last = down === false;\n      table.fold(function () {\n        return moveToRange(editor, pos.toRange());\n      }, function (table) {\n        return positionIn(last, editor.getBody()).filter(function (lastPos) {\n          return lastPos.isEqual(pos);\n        }).fold(function () {\n          return moveToRange(editor, pos.toRange());\n        }, function (_) {\n          return renderBlock(down, editor, table, pos);\n        });\n      });\n    };\n    var navigateVertically = function (editor, down, table, td) {\n      var rng = editor.selection.getRng();\n      var pos = CaretPosition$1.fromRangeStart(rng);\n      var root = editor.getBody();\n      if (!down && isAtFirstTableCellLine(td, pos)) {\n        var newPos = getClosestAbovePosition(root, table, pos);\n        moveCaret(editor, down, newPos);\n        return true;\n      } else if (down && isAtLastTableCellLine(td, pos)) {\n        var newPos = getClosestBelowPosition(root, table, pos);\n        moveCaret(editor, down, newPos);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var move$1 = function (editor, forward, mover) {\n      return Optional.from(editor.dom.getParent(editor.selection.getNode(), 'td,th')).bind(function (td) {\n        return Optional.from(editor.dom.getParent(td, 'table')).map(function (table) {\n          return mover(editor, forward, table, td);\n        });\n      }).getOr(false);\n    };\n    var moveH$2 = function (editor, forward) {\n      return move$1(editor, forward, navigateHorizontally);\n    };\n    var moveV$3 = function (editor, forward) {\n      return move$1(editor, forward, navigateVertically);\n    };\n\n    var executeKeydownOverride = function (editor, caret, evt) {\n      var os = detect$3().os;\n      execute([\n        {\n          keyCode: VK.RIGHT,\n          action: action(moveH, editor, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: action(moveH, editor, false)\n        },\n        {\n          keyCode: VK.UP,\n          action: action(moveV, editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: action(moveV, editor, true)\n        },\n        {\n          keyCode: VK.RIGHT,\n          action: action(moveH$2, editor, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: action(moveH$2, editor, false)\n        },\n        {\n          keyCode: VK.UP,\n          action: action(moveV$3, editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: action(moveV$3, editor, true)\n        },\n        {\n          keyCode: VK.RIGHT,\n          action: action(moveH$1, editor, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: action(moveH$1, editor, false)\n        },\n        {\n          keyCode: VK.UP,\n          action: action(moveV$2, editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: action(moveV$2, editor, true)\n        },\n        {\n          keyCode: VK.RIGHT,\n          action: action(move, editor, caret, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: action(move, editor, caret, false)\n        },\n        {\n          keyCode: VK.RIGHT,\n          ctrlKey: !os.isOSX(),\n          altKey: os.isOSX(),\n          action: action(moveNextWord, editor, caret)\n        },\n        {\n          keyCode: VK.LEFT,\n          ctrlKey: !os.isOSX(),\n          altKey: os.isOSX(),\n          action: action(movePrevWord, editor, caret)\n        },\n        {\n          keyCode: VK.UP,\n          action: action(moveV$1, editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: action(moveV$1, editor, true)\n        }\n      ], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var setup$c = function (editor, caret) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride(editor, caret, evt);\n        }\n      });\n    };\n\n    var executeKeydownOverride$1 = function (editor, caret, evt) {\n      execute([\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$9, editor, false)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$4, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$4, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$3, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$3, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$6, editor, caret, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$6, editor, caret, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$5, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$5, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$8, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$8, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$2, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$2, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$1, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$1, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$7, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$7, editor, true)\n        }\n      ], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var executeKeyupOverride = function (editor, evt) {\n      execute([\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(paddEmptyElement, editor)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(paddEmptyElement, editor)\n        }\n      ], evt);\n    };\n    var setup$d = function (editor, caret) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride$1(editor, caret, evt);\n        }\n      });\n      editor.on('keyup', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeyupOverride(editor, evt);\n        }\n      });\n    };\n\n    var firstNonWhiteSpaceNodeSibling = function (node) {\n      while (node) {\n        if (node.nodeType === 1 || node.nodeType === 3 && node.data && /[\\r\\n\\s]/.test(node.data)) {\n          return node;\n        }\n        node = node.nextSibling;\n      }\n    };\n    var moveToCaretPosition = function (editor, root) {\n      var node, lastNode = root;\n      var dom = editor.dom;\n      var moveCaretBeforeOnEnterElementsMap = editor.schema.getMoveCaretBeforeOnEnterElements();\n      if (!root) {\n        return;\n      }\n      if (/^(LI|DT|DD)$/.test(root.nodeName)) {\n        var firstChild = firstNonWhiteSpaceNodeSibling(root.firstChild);\n        if (firstChild && /^(UL|OL|DL)$/.test(firstChild.nodeName)) {\n          root.insertBefore(dom.doc.createTextNode(nbsp), root.firstChild);\n        }\n      }\n      var rng = dom.createRng();\n      root.normalize();\n      if (root.hasChildNodes()) {\n        var walker = new DomTreeWalker(root, root);\n        while (node = walker.current()) {\n          if (isText$1(node)) {\n            rng.setStart(node, 0);\n            rng.setEnd(node, 0);\n            break;\n          }\n          if (moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]) {\n            rng.setStartBefore(node);\n            rng.setEndBefore(node);\n            break;\n          }\n          lastNode = node;\n          node = walker.next();\n        }\n        if (!node) {\n          rng.setStart(lastNode, 0);\n          rng.setEnd(lastNode, 0);\n        }\n      } else {\n        if (isBr(root)) {\n          if (root.nextSibling && dom.isBlock(root.nextSibling)) {\n            rng.setStartBefore(root);\n            rng.setEndBefore(root);\n          } else {\n            rng.setStartAfter(root);\n            rng.setEndAfter(root);\n          }\n        } else {\n          rng.setStart(root, 0);\n          rng.setEnd(root, 0);\n        }\n      }\n      editor.selection.setRng(rng);\n      scrollRangeIntoView(editor, rng);\n    };\n    var getEditableRoot = function (dom, node) {\n      var root = dom.getRoot();\n      var parent, editableRoot;\n      parent = node;\n      while (parent !== root && dom.getContentEditable(parent) !== 'false') {\n        if (dom.getContentEditable(parent) === 'true') {\n          editableRoot = parent;\n        }\n        parent = parent.parentNode;\n      }\n      return parent !== root ? editableRoot : root;\n    };\n    var getParentBlock$2 = function (editor) {\n      return Optional.from(editor.dom.getParent(editor.selection.getStart(true), editor.dom.isBlock));\n    };\n    var getParentBlockName = function (editor) {\n      return getParentBlock$2(editor).fold(constant(''), function (parentBlock) {\n        return parentBlock.nodeName.toUpperCase();\n      });\n    };\n    var isListItemParentBlock = function (editor) {\n      return getParentBlock$2(editor).filter(function (elm) {\n        return isListItem(SugarElement.fromDom(elm));\n      }).isSome();\n    };\n\n    var hasFirstChild = function (elm, name) {\n      return elm.firstChild && elm.firstChild.nodeName === name;\n    };\n    var hasParent$1 = function (elm, parentName) {\n      return elm && elm.parentNode && elm.parentNode.nodeName === parentName;\n    };\n    var isListBlock = function (elm) {\n      return elm && /^(OL|UL|LI)$/.test(elm.nodeName);\n    };\n    var isNestedList = function (elm) {\n      return isListBlock(elm) && isListBlock(elm.parentNode);\n    };\n    var getContainerBlock = function (containerBlock) {\n      var containerBlockParent = containerBlock.parentNode;\n      if (/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)) {\n        return containerBlockParent;\n      }\n      return containerBlock;\n    };\n    var isFirstOrLastLi = function (containerBlock, parentBlock, first) {\n      var node = containerBlock[first ? 'firstChild' : 'lastChild'];\n      while (node) {\n        if (isElement$1(node)) {\n          break;\n        }\n        node = node[first ? 'nextSibling' : 'previousSibling'];\n      }\n      return node === parentBlock;\n    };\n    var insert = function (editor, createNewBlock, containerBlock, parentBlock, newBlockName) {\n      var dom = editor.dom;\n      var rng = editor.selection.getRng();\n      if (containerBlock === editor.getBody()) {\n        return;\n      }\n      if (isNestedList(containerBlock)) {\n        newBlockName = 'LI';\n      }\n      var newBlock = newBlockName ? createNewBlock(newBlockName) : dom.create('BR');\n      if (isFirstOrLastLi(containerBlock, parentBlock, true) && isFirstOrLastLi(containerBlock, parentBlock, false)) {\n        if (hasParent$1(containerBlock, 'LI')) {\n          dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n        } else {\n          dom.replace(newBlock, containerBlock);\n        }\n      } else if (isFirstOrLastLi(containerBlock, parentBlock, true)) {\n        if (hasParent$1(containerBlock, 'LI')) {\n          dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n          newBlock.appendChild(dom.doc.createTextNode(' '));\n          newBlock.appendChild(containerBlock);\n        } else {\n          containerBlock.parentNode.insertBefore(newBlock, containerBlock);\n        }\n      } else if (isFirstOrLastLi(containerBlock, parentBlock, false)) {\n        dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n      } else {\n        containerBlock = getContainerBlock(containerBlock);\n        var tmpRng = rng.cloneRange();\n        tmpRng.setStartAfter(parentBlock);\n        tmpRng.setEndAfter(containerBlock);\n        var fragment = tmpRng.extractContents();\n        if (newBlockName === 'LI' && hasFirstChild(fragment, 'LI')) {\n          newBlock = fragment.firstChild;\n          dom.insertAfter(fragment, containerBlock);\n        } else {\n          dom.insertAfter(fragment, containerBlock);\n          dom.insertAfter(newBlock, containerBlock);\n        }\n      }\n      dom.remove(parentBlock);\n      moveToCaretPosition(editor, newBlock);\n    };\n\n    var trimZwsp = function (fragment) {\n      each(descendants(SugarElement.fromDom(fragment), isText), function (text) {\n        var rawNode = text.dom;\n        rawNode.nodeValue = trim$2(rawNode.nodeValue);\n      });\n    };\n    var isEmptyAnchor = function (dom, elm) {\n      return elm && elm.nodeName === 'A' && dom.isEmpty(elm);\n    };\n    var isTableCell$5 = function (node) {\n      return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n    };\n    var emptyBlock = function (elm) {\n      elm.innerHTML = '<br data-mce-bogus=\"1\">';\n    };\n    var containerAndSiblingName = function (container, nodeName) {\n      return container.nodeName === nodeName || container.previousSibling && container.previousSibling.nodeName === nodeName;\n    };\n    var canSplitBlock = function (dom, node) {\n      return node && dom.isBlock(node) && !/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName) && !/^(fixed|absolute)/i.test(node.style.position) && dom.getContentEditable(node) !== 'true';\n    };\n    var trimInlineElementsOnLeftSideOfBlock = function (dom, nonEmptyElementsMap, block) {\n      var node = block;\n      var firstChilds = [];\n      var i;\n      if (!node) {\n        return;\n      }\n      while (node = node.firstChild) {\n        if (dom.isBlock(node)) {\n          return;\n        }\n        if (isElement$1(node) && !nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n          firstChilds.push(node);\n        }\n      }\n      i = firstChilds.length;\n      while (i--) {\n        node = firstChilds[i];\n        if (!node.hasChildNodes() || node.firstChild === node.lastChild && node.firstChild.nodeValue === '') {\n          dom.remove(node);\n        } else {\n          if (isEmptyAnchor(dom, node)) {\n            dom.remove(node);\n          }\n        }\n      }\n    };\n    var normalizeZwspOffset = function (start, container, offset) {\n      if (isText$1(container) === false) {\n        return offset;\n      } else if (start) {\n        return offset === 1 && container.data.charAt(offset - 1) === ZWSP ? 0 : offset;\n      } else {\n        return offset === container.data.length - 1 && container.data.charAt(offset) === ZWSP ? container.data.length : offset;\n      }\n    };\n    var includeZwspInRange = function (rng) {\n      var newRng = rng.cloneRange();\n      newRng.setStart(rng.startContainer, normalizeZwspOffset(true, rng.startContainer, rng.startOffset));\n      newRng.setEnd(rng.endContainer, normalizeZwspOffset(false, rng.endContainer, rng.endOffset));\n      return newRng;\n    };\n    var trimLeadingLineBreaks = function (node) {\n      do {\n        if (isText$1(node)) {\n          node.nodeValue = node.nodeValue.replace(/^[\\r\\n]+/, '');\n        }\n        node = node.firstChild;\n      } while (node);\n    };\n    var getEditableRoot$1 = function (dom, node) {\n      var root = dom.getRoot();\n      var parent, editableRoot;\n      parent = node;\n      while (parent !== root && dom.getContentEditable(parent) !== 'false') {\n        if (dom.getContentEditable(parent) === 'true') {\n          editableRoot = parent;\n        }\n        parent = parent.parentNode;\n      }\n      return parent !== root ? editableRoot : root;\n    };\n    var applyAttributes = function (editor, node, forcedRootBlockAttrs) {\n      var dom = editor.dom;\n      Optional.from(forcedRootBlockAttrs.style).map(dom.parseStyle).each(function (attrStyles) {\n        var currentStyles = getAllRaw(SugarElement.fromDom(node));\n        var newStyles = __assign(__assign({}, currentStyles), attrStyles);\n        dom.setStyles(node, newStyles);\n      });\n      var attrClassesOpt = Optional.from(forcedRootBlockAttrs.class).map(function (attrClasses) {\n        return attrClasses.split(/\\s+/);\n      });\n      var currentClassesOpt = Optional.from(node.className).map(function (currentClasses) {\n        return filter(currentClasses.split(/\\s+/), function (clazz) {\n          return clazz !== '';\n        });\n      });\n      lift2(attrClassesOpt, currentClassesOpt, function (attrClasses, currentClasses) {\n        var filteredClasses = filter(currentClasses, function (clazz) {\n          return !contains(attrClasses, clazz);\n        });\n        var newClasses = __spreadArrays(attrClasses, filteredClasses);\n        dom.setAttrib(node, 'class', newClasses.join(' '));\n      });\n      var appliedAttrs = [\n        'style',\n        'class'\n      ];\n      var remainingAttrs = filter$1(forcedRootBlockAttrs, function (_, attrs) {\n        return !contains(appliedAttrs, attrs);\n      });\n      dom.setAttribs(node, remainingAttrs);\n    };\n    var setForcedBlockAttrs = function (editor, node) {\n      var forcedRootBlockName = getForcedRootBlock(editor);\n      if (forcedRootBlockName && forcedRootBlockName.toLowerCase() === node.tagName.toLowerCase()) {\n        var forcedRootBlockAttrs = getForcedRootBlockAttrs(editor);\n        applyAttributes(editor, node, forcedRootBlockAttrs);\n      }\n    };\n    var wrapSelfAndSiblingsInDefaultBlock = function (editor, newBlockName, rng, container, offset) {\n      var newBlock, parentBlock, startNode, node, next, rootBlockName;\n      var blockName = newBlockName || 'P';\n      var dom = editor.dom, editableRoot = getEditableRoot$1(dom, container);\n      parentBlock = dom.getParent(container, dom.isBlock);\n      if (!parentBlock || !canSplitBlock(dom, parentBlock)) {\n        parentBlock = parentBlock || editableRoot;\n        if (parentBlock === editor.getBody() || isTableCell$5(parentBlock)) {\n          rootBlockName = parentBlock.nodeName.toLowerCase();\n        } else {\n          rootBlockName = parentBlock.parentNode.nodeName.toLowerCase();\n        }\n        if (!parentBlock.hasChildNodes()) {\n          newBlock = dom.create(blockName);\n          setForcedBlockAttrs(editor, newBlock);\n          parentBlock.appendChild(newBlock);\n          rng.setStart(newBlock, 0);\n          rng.setEnd(newBlock, 0);\n          return newBlock;\n        }\n        node = container;\n        while (node.parentNode !== parentBlock) {\n          node = node.parentNode;\n        }\n        while (node && !dom.isBlock(node)) {\n          startNode = node;\n          node = node.previousSibling;\n        }\n        if (startNode && editor.schema.isValidChild(rootBlockName, blockName.toLowerCase())) {\n          newBlock = dom.create(blockName);\n          setForcedBlockAttrs(editor, newBlock);\n          startNode.parentNode.insertBefore(newBlock, startNode);\n          node = startNode;\n          while (node && !dom.isBlock(node)) {\n            next = node.nextSibling;\n            newBlock.appendChild(node);\n            node = next;\n          }\n          rng.setStart(container, offset);\n          rng.setEnd(container, offset);\n        }\n      }\n      return container;\n    };\n    var addBrToBlockIfNeeded = function (dom, block) {\n      block.normalize();\n      var lastChild = block.lastChild;\n      if (!lastChild || /^(left|right)$/gi.test(dom.getStyle(lastChild, 'float', true))) {\n        dom.add(block, 'br');\n      }\n    };\n    var insert$1 = function (editor, evt) {\n      var tmpRng, container, offset, parentBlock;\n      var newBlock, fragment, containerBlock, parentBlockName, newBlockName, isAfterLastNodeInContainer;\n      var dom = editor.dom;\n      var schema = editor.schema, nonEmptyElementsMap = schema.getNonEmptyElements();\n      var rng = editor.selection.getRng();\n      var createNewBlock = function (name) {\n        var node = container, block, clonedNode, caretNode;\n        var textInlineElements = schema.getTextInlineElements();\n        if (name || parentBlockName === 'TABLE' || parentBlockName === 'HR') {\n          block = dom.create(name || newBlockName);\n        } else {\n          block = parentBlock.cloneNode(false);\n        }\n        caretNode = block;\n        if (shouldKeepStyles(editor) === false) {\n          dom.setAttrib(block, 'style', null);\n          dom.setAttrib(block, 'class', null);\n        } else {\n          do {\n            if (textInlineElements[node.nodeName]) {\n              if (isCaretNode(node) || isBookmarkNode$1(node)) {\n                continue;\n              }\n              clonedNode = node.cloneNode(false);\n              dom.setAttrib(clonedNode, 'id', '');\n              if (block.hasChildNodes()) {\n                clonedNode.appendChild(block.firstChild);\n                block.appendChild(clonedNode);\n              } else {\n                caretNode = clonedNode;\n                block.appendChild(clonedNode);\n              }\n            }\n          } while ((node = node.parentNode) && node !== editableRoot);\n        }\n        setForcedBlockAttrs(editor, block);\n        emptyBlock(caretNode);\n        return block;\n      };\n      var isCaretAtStartOrEndOfBlock = function (start) {\n        var node, name;\n        var normalizedOffset = normalizeZwspOffset(start, container, offset);\n        if (isText$1(container) && (start ? normalizedOffset > 0 : normalizedOffset < container.nodeValue.length)) {\n          return false;\n        }\n        if (container.parentNode === parentBlock && isAfterLastNodeInContainer && !start) {\n          return true;\n        }\n        if (start && isElement$1(container) && container === parentBlock.firstChild) {\n          return true;\n        }\n        if (containerAndSiblingName(container, 'TABLE') || containerAndSiblingName(container, 'HR')) {\n          return isAfterLastNodeInContainer && !start || !isAfterLastNodeInContainer && start;\n        }\n        var walker = new DomTreeWalker(container, parentBlock);\n        if (isText$1(container)) {\n          if (start && normalizedOffset === 0) {\n            walker.prev();\n          } else if (!start && normalizedOffset === container.nodeValue.length) {\n            walker.next();\n          }\n        }\n        while (node = walker.current()) {\n          if (isElement$1(node)) {\n            if (!node.getAttribute('data-mce-bogus')) {\n              name = node.nodeName.toLowerCase();\n              if (nonEmptyElementsMap[name] && name !== 'br') {\n                return false;\n              }\n            }\n          } else if (isText$1(node) && !isWhitespaceText(node.nodeValue)) {\n            return false;\n          }\n          if (start) {\n            walker.prev();\n          } else {\n            walker.next();\n          }\n        }\n        return true;\n      };\n      var insertNewBlockAfter = function () {\n        if (/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName) && containerBlockName !== 'HGROUP') {\n          newBlock = createNewBlock(newBlockName);\n        } else {\n          newBlock = createNewBlock();\n        }\n        if (shouldEndContainerOnEmptyBlock(editor) && canSplitBlock(dom, containerBlock) && dom.isEmpty(parentBlock)) {\n          newBlock = dom.split(containerBlock, parentBlock);\n        } else {\n          dom.insertAfter(newBlock, parentBlock);\n        }\n        moveToCaretPosition(editor, newBlock);\n      };\n      normalize(dom, rng).each(function (normRng) {\n        rng.setStart(normRng.startContainer, normRng.startOffset);\n        rng.setEnd(normRng.endContainer, normRng.endOffset);\n      });\n      container = rng.startContainer;\n      offset = rng.startOffset;\n      newBlockName = getForcedRootBlock(editor);\n      var shiftKey = !!(evt && evt.shiftKey);\n      var ctrlKey = !!(evt && evt.ctrlKey);\n      if (isElement$1(container) && container.hasChildNodes()) {\n        isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n        container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n        if (isAfterLastNodeInContainer && isText$1(container)) {\n          offset = container.nodeValue.length;\n        } else {\n          offset = 0;\n        }\n      }\n      var editableRoot = getEditableRoot$1(dom, container);\n      if (!editableRoot) {\n        return;\n      }\n      if (newBlockName && !shiftKey || !newBlockName && shiftKey) {\n        container = wrapSelfAndSiblingsInDefaultBlock(editor, newBlockName, rng, container, offset);\n      }\n      parentBlock = dom.getParent(container, dom.isBlock);\n      containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n      parentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : '';\n      var containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\n      if (containerBlockName === 'LI' && !ctrlKey) {\n        parentBlock = containerBlock;\n        containerBlock = containerBlock.parentNode;\n        parentBlockName = containerBlockName;\n      }\n      if (/^(LI|DT|DD)$/.test(parentBlockName)) {\n        if (dom.isEmpty(parentBlock)) {\n          insert(editor, createNewBlock, containerBlock, parentBlock, newBlockName);\n          return;\n        }\n      }\n      if (newBlockName && parentBlock === editor.getBody()) {\n        return;\n      }\n      newBlockName = newBlockName || 'P';\n      if (isCaretContainerBlock(parentBlock)) {\n        newBlock = showCaretContainerBlock(parentBlock);\n        if (dom.isEmpty(parentBlock)) {\n          emptyBlock(parentBlock);\n        }\n        setForcedBlockAttrs(editor, newBlock);\n        moveToCaretPosition(editor, newBlock);\n      } else if (isCaretAtStartOrEndOfBlock()) {\n        insertNewBlockAfter();\n      } else if (isCaretAtStartOrEndOfBlock(true)) {\n        newBlock = parentBlock.parentNode.insertBefore(createNewBlock(), parentBlock);\n        moveToCaretPosition(editor, containerAndSiblingName(parentBlock, 'HR') ? newBlock : parentBlock);\n      } else {\n        tmpRng = includeZwspInRange(rng).cloneRange();\n        tmpRng.setEndAfter(parentBlock);\n        fragment = tmpRng.extractContents();\n        trimZwsp(fragment);\n        trimLeadingLineBreaks(fragment);\n        newBlock = fragment.firstChild;\n        dom.insertAfter(fragment, parentBlock);\n        trimInlineElementsOnLeftSideOfBlock(dom, nonEmptyElementsMap, newBlock);\n        addBrToBlockIfNeeded(dom, parentBlock);\n        if (dom.isEmpty(parentBlock)) {\n          emptyBlock(parentBlock);\n        }\n        newBlock.normalize();\n        if (dom.isEmpty(newBlock)) {\n          dom.remove(newBlock);\n          insertNewBlockAfter();\n        } else {\n          setForcedBlockAttrs(editor, newBlock);\n          moveToCaretPosition(editor, newBlock);\n        }\n      }\n      dom.setAttrib(newBlock, 'id', '');\n      editor.fire('NewBlock', { newBlock: newBlock });\n    };\n\n    var hasRightSideContent = function (schema, container, parentBlock) {\n      var walker = new DomTreeWalker(container, parentBlock);\n      var node;\n      var nonEmptyElementsMap = schema.getNonEmptyElements();\n      while (node = walker.next()) {\n        if (nonEmptyElementsMap[node.nodeName.toLowerCase()] || node.length > 0) {\n          return true;\n        }\n      }\n    };\n    var scrollToBr = function (dom, selection, brElm) {\n      var marker = dom.create('span', {}, '&nbsp;');\n      brElm.parentNode.insertBefore(marker, brElm);\n      selection.scrollIntoView(marker);\n      dom.remove(marker);\n    };\n    var moveSelectionToBr = function (dom, selection, brElm, extraBr) {\n      var rng = dom.createRng();\n      if (!extraBr) {\n        rng.setStartAfter(brElm);\n        rng.setEndAfter(brElm);\n      } else {\n        rng.setStartBefore(brElm);\n        rng.setEndBefore(brElm);\n      }\n      selection.setRng(rng);\n    };\n    var insertBrAtCaret = function (editor, evt) {\n      var selection = editor.selection;\n      var dom = editor.dom;\n      var rng = selection.getRng();\n      var brElm;\n      var extraBr;\n      normalize(dom, rng).each(function (normRng) {\n        rng.setStart(normRng.startContainer, normRng.startOffset);\n        rng.setEnd(normRng.endContainer, normRng.endOffset);\n      });\n      var offset = rng.startOffset;\n      var container = rng.startContainer;\n      if (container.nodeType === 1 && container.hasChildNodes()) {\n        var isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n        container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n        if (isAfterLastNodeInContainer && container.nodeType === 3) {\n          offset = container.nodeValue.length;\n        } else {\n          offset = 0;\n        }\n      }\n      var parentBlock = dom.getParent(container, dom.isBlock);\n      var containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n      var containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\n      var isControlKey = !!(evt && evt.ctrlKey);\n      if (containerBlockName === 'LI' && !isControlKey) {\n        parentBlock = containerBlock;\n      }\n      if (container && container.nodeType === 3 && offset >= container.nodeValue.length) {\n        if (!hasRightSideContent(editor.schema, container, parentBlock)) {\n          brElm = dom.create('br');\n          rng.insertNode(brElm);\n          rng.setStartAfter(brElm);\n          rng.setEndAfter(brElm);\n          extraBr = true;\n        }\n      }\n      brElm = dom.create('br');\n      rangeInsertNode(dom, rng, brElm);\n      scrollToBr(dom, selection, brElm);\n      moveSelectionToBr(dom, selection, brElm, extraBr);\n      editor.undoManager.add();\n    };\n    var insertBrBefore = function (editor, inline) {\n      var br = SugarElement.fromTag('br');\n      before(SugarElement.fromDom(inline), br);\n      editor.undoManager.add();\n    };\n    var insertBrAfter = function (editor, inline) {\n      if (!hasBrAfter(editor.getBody(), inline)) {\n        after(SugarElement.fromDom(inline), SugarElement.fromTag('br'));\n      }\n      var br = SugarElement.fromTag('br');\n      after(SugarElement.fromDom(inline), br);\n      scrollToBr(editor.dom, editor.selection, br.dom);\n      moveSelectionToBr(editor.dom, editor.selection, br.dom, false);\n      editor.undoManager.add();\n    };\n    var isBeforeBr$1 = function (pos) {\n      return isBr(pos.getNode());\n    };\n    var hasBrAfter = function (rootNode, startNode) {\n      if (isBeforeBr$1(CaretPosition$1.after(startNode))) {\n        return true;\n      } else {\n        return nextPosition(rootNode, CaretPosition$1.after(startNode)).map(function (pos) {\n          return isBr(pos.getNode());\n        }).getOr(false);\n      }\n    };\n    var isAnchorLink = function (elm) {\n      return elm && elm.nodeName === 'A' && 'href' in elm;\n    };\n    var isInsideAnchor = function (location) {\n      return location.fold(never, isAnchorLink, isAnchorLink, never);\n    };\n    var readInlineAnchorLocation = function (editor) {\n      var isInlineTarget$1 = curry(isInlineTarget, editor);\n      var position = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return readLocation(isInlineTarget$1, editor.getBody(), position).filter(isInsideAnchor);\n    };\n    var insertBrOutsideAnchor = function (editor, location) {\n      location.fold(noop, curry(insertBrBefore, editor), curry(insertBrAfter, editor), noop);\n    };\n    var insert$2 = function (editor, evt) {\n      var anchorLocation = readInlineAnchorLocation(editor);\n      if (anchorLocation.isSome()) {\n        anchorLocation.each(curry(insertBrOutsideAnchor, editor));\n      } else {\n        insertBrAtCaret(editor, evt);\n      }\n    };\n\n    var matchesSelector = function (editor, selector) {\n      return getParentBlock$2(editor).filter(function (parentBlock) {\n        return selector.length > 0 && is$1(SugarElement.fromDom(parentBlock), selector);\n      }).isSome();\n    };\n    var shouldInsertBr = function (editor) {\n      return matchesSelector(editor, getBrNewLineSelector(editor));\n    };\n    var shouldBlockNewLine = function (editor) {\n      return matchesSelector(editor, getNoNewLineSelector(editor));\n    };\n\n    var newLineAction = Adt.generate([\n      { br: [] },\n      { block: [] },\n      { none: [] }\n    ]);\n    var shouldBlockNewLine$1 = function (editor, _shiftKey) {\n      return shouldBlockNewLine(editor);\n    };\n    var isBrMode = function (requiredState) {\n      return function (editor, _shiftKey) {\n        var brMode = getForcedRootBlock(editor) === '';\n        return brMode === requiredState;\n      };\n    };\n    var inListBlock = function (requiredState) {\n      return function (editor, _shiftKey) {\n        return isListItemParentBlock(editor) === requiredState;\n      };\n    };\n    var inBlock = function (blockName, requiredState) {\n      return function (editor, _shiftKey) {\n        var state = getParentBlockName(editor) === blockName.toUpperCase();\n        return state === requiredState;\n      };\n    };\n    var inPreBlock = function (requiredState) {\n      return inBlock('pre', requiredState);\n    };\n    var inSummaryBlock = function () {\n      return inBlock('summary', true);\n    };\n    var shouldPutBrInPre$1 = function (requiredState) {\n      return function (editor, _shiftKey) {\n        return shouldPutBrInPre(editor) === requiredState;\n      };\n    };\n    var inBrContext = function (editor, _shiftKey) {\n      return shouldInsertBr(editor);\n    };\n    var hasShiftKey = function (_editor, shiftKey) {\n      return shiftKey;\n    };\n    var canInsertIntoEditableRoot = function (editor) {\n      var forcedRootBlock = getForcedRootBlock(editor);\n      var rootEditable = getEditableRoot(editor.dom, editor.selection.getStart());\n      return rootEditable && editor.schema.isValidChild(rootEditable.nodeName, forcedRootBlock ? forcedRootBlock : 'P');\n    };\n    var match$2 = function (predicates, action) {\n      return function (editor, shiftKey) {\n        var isMatch = foldl(predicates, function (res, p) {\n          return res && p(editor, shiftKey);\n        }, true);\n        return isMatch ? Optional.some(action) : Optional.none();\n      };\n    };\n    var getAction$1 = function (editor, evt) {\n      return evaluateUntil([\n        match$2([shouldBlockNewLine$1], newLineAction.none()),\n        match$2([inSummaryBlock()], newLineAction.br()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(false),\n          hasShiftKey\n        ], newLineAction.br()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(false)\n        ], newLineAction.block()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(true),\n          hasShiftKey\n        ], newLineAction.block()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(true)\n        ], newLineAction.br()),\n        match$2([\n          inListBlock(true),\n          hasShiftKey\n        ], newLineAction.br()),\n        match$2([inListBlock(true)], newLineAction.block()),\n        match$2([\n          isBrMode(true),\n          hasShiftKey,\n          canInsertIntoEditableRoot\n        ], newLineAction.block()),\n        match$2([isBrMode(true)], newLineAction.br()),\n        match$2([inBrContext], newLineAction.br()),\n        match$2([\n          isBrMode(false),\n          hasShiftKey\n        ], newLineAction.br()),\n        match$2([canInsertIntoEditableRoot], newLineAction.block())\n      ], [\n        editor,\n        !!(evt && evt.shiftKey)\n      ]).getOr(newLineAction.none());\n    };\n\n    var insert$3 = function (editor, evt) {\n      getAction$1(editor, evt).fold(function () {\n        insert$2(editor, evt);\n      }, function () {\n        insert$1(editor, evt);\n      }, noop);\n    };\n\n    var handleEnterKeyEvent = function (editor, event) {\n      if (event.isDefaultPrevented()) {\n        return;\n      }\n      event.preventDefault();\n      endTypingLevelIgnoreLocks(editor.undoManager);\n      editor.undoManager.transact(function () {\n        if (editor.selection.isCollapsed() === false) {\n          editor.execCommand('Delete');\n        }\n        insert$3(editor, event);\n      });\n    };\n    var setup$e = function (editor) {\n      editor.on('keydown', function (event) {\n        if (event.keyCode === VK.ENTER) {\n          handleEnterKeyEvent(editor, event);\n        }\n      });\n    };\n\n    var executeKeydownOverride$2 = function (editor, evt) {\n      execute([\n        {\n          keyCode: VK.END,\n          action: action(moveToLineEndPoint$1, editor, true)\n        },\n        {\n          keyCode: VK.HOME,\n          action: action(moveToLineEndPoint$1, editor, false)\n        },\n        {\n          keyCode: VK.END,\n          action: action(moveToLineEndPoint$2, editor, true)\n        },\n        {\n          keyCode: VK.HOME,\n          action: action(moveToLineEndPoint$2, editor, false)\n        }\n      ], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var setup$f = function (editor) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride$2(editor, evt);\n        }\n      });\n    };\n\n    var browser$4 = detect$3().browser;\n    var setupIeInput = function (editor) {\n      var keypressThrotter = first(function () {\n        if (!editor.composing) {\n          normalizeNbspsInEditor(editor);\n        }\n      }, 0);\n      if (browser$4.isIE()) {\n        editor.on('keypress', function (_e) {\n          keypressThrotter.throttle();\n        });\n        editor.on('remove', function (_e) {\n          keypressThrotter.cancel();\n        });\n      }\n    };\n    var setup$g = function (editor) {\n      setupIeInput(editor);\n      editor.on('input', function (e) {\n        if (e.isComposing === false) {\n          normalizeNbspsInEditor(editor);\n        }\n      });\n    };\n\n    var insertTextAtPosition = function (text, pos) {\n      var container = pos.container();\n      var offset = pos.offset();\n      if (isText$1(container)) {\n        container.insertData(offset, text);\n        return Optional.some(CaretPosition(container, offset + text.length));\n      } else {\n        return getElementFromPosition(pos).map(function (elm) {\n          var textNode = SugarElement.fromText(text);\n          if (pos.isAtEnd()) {\n            after(elm, textNode);\n          } else {\n            before(elm, textNode);\n          }\n          return CaretPosition(textNode.dom, text.length);\n        });\n      }\n    };\n    var insertNbspAtPosition = curry(insertTextAtPosition, nbsp);\n    var insertSpaceAtPosition = curry(insertTextAtPosition, ' ');\n\n    var locationToCaretPosition = function (root) {\n      return function (location) {\n        return location.fold(function (element) {\n          return prevPosition(root.dom, CaretPosition$1.before(element));\n        }, function (element) {\n          return firstPositionIn(element);\n        }, function (element) {\n          return lastPositionIn(element);\n        }, function (element) {\n          return nextPosition(root.dom, CaretPosition$1.after(element));\n        });\n      };\n    };\n    var insertInlineBoundarySpaceOrNbsp = function (root, pos) {\n      return function (checkPos) {\n        return needsToHaveNbsp(root, checkPos) ? insertNbspAtPosition(pos) : insertSpaceAtPosition(pos);\n      };\n    };\n    var setSelection$1 = function (editor) {\n      return function (pos) {\n        editor.selection.setRng(pos.toRange());\n        editor.nodeChanged();\n        return true;\n      };\n    };\n    var insertSpaceOrNbspAtSelection = function (editor) {\n      var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      var root = SugarElement.fromDom(editor.getBody());\n      if (editor.selection.isCollapsed()) {\n        var isInlineTarget$1 = curry(isInlineTarget, editor);\n        var caretPosition = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        return readLocation(isInlineTarget$1, editor.getBody(), caretPosition).bind(locationToCaretPosition(root)).bind(insertInlineBoundarySpaceOrNbsp(root, pos)).exists(setSelection$1(editor));\n      } else {\n        return false;\n      }\n    };\n\n    var executeKeydownOverride$3 = function (editor, evt) {\n      execute([{\n          keyCode: VK.SPACEBAR,\n          action: action(insertSpaceOrNbspAtSelection, editor)\n        }], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var setup$h = function (editor) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride$3(editor, evt);\n        }\n      });\n    };\n\n    var registerKeyboardOverrides = function (editor) {\n      var caret = setupSelectedState(editor);\n      setup$b(editor);\n      setup$c(editor, caret);\n      setup$d(editor, caret);\n      setup$e(editor);\n      setup$h(editor);\n      setup$g(editor);\n      setup$f(editor);\n      return caret;\n    };\n    var setup$i = function (editor) {\n      if (!isRtc(editor)) {\n        return registerKeyboardOverrides(editor);\n      } else {\n        return Cell(null);\n      }\n    };\n\n    var NodeChange = function () {\n      function NodeChange(editor) {\n        this.lastPath = [];\n        this.editor = editor;\n        var lastRng;\n        var self = this;\n        if (!('onselectionchange' in editor.getDoc())) {\n          editor.on('NodeChange click mouseup keyup focus', function (e) {\n            var nativeRng = editor.selection.getRng();\n            var fakeRng = {\n              startContainer: nativeRng.startContainer,\n              startOffset: nativeRng.startOffset,\n              endContainer: nativeRng.endContainer,\n              endOffset: nativeRng.endOffset\n            };\n            if (e.type === 'nodechange' || !isEq$1(fakeRng, lastRng)) {\n              editor.fire('SelectionChange');\n            }\n            lastRng = fakeRng;\n          });\n        }\n        editor.on('contextmenu', function () {\n          editor.fire('SelectionChange');\n        });\n        editor.on('SelectionChange', function () {\n          var startElm = editor.selection.getStart(true);\n          if (!startElm || !Env.range && editor.selection.isCollapsed()) {\n            return;\n          }\n          if (hasAnyRanges(editor) && !self.isSameElementPath(startElm) && editor.dom.isChildOf(startElm, editor.getBody())) {\n            editor.nodeChanged({ selectionChange: true });\n          }\n        });\n        editor.on('mouseup', function (e) {\n          if (!e.isDefaultPrevented() && hasAnyRanges(editor)) {\n            if (editor.selection.getNode().nodeName === 'IMG') {\n              Delay.setEditorTimeout(editor, function () {\n                editor.nodeChanged();\n              });\n            } else {\n              editor.nodeChanged();\n            }\n          }\n        });\n      }\n      NodeChange.prototype.nodeChanged = function (args) {\n        var selection = this.editor.selection;\n        var node, parents, root;\n        if (this.editor.initialized && selection && !shouldDisableNodeChange(this.editor) && !this.editor.mode.isReadOnly()) {\n          root = this.editor.getBody();\n          node = selection.getStart(true) || root;\n          if (node.ownerDocument !== this.editor.getDoc() || !this.editor.dom.isChildOf(node, root)) {\n            node = root;\n          }\n          parents = [];\n          this.editor.dom.getParent(node, function (node) {\n            if (node === root) {\n              return true;\n            }\n            parents.push(node);\n          });\n          args = args || {};\n          args.element = node;\n          args.parents = parents;\n          this.editor.fire('NodeChange', args);\n        }\n      };\n      NodeChange.prototype.isSameElementPath = function (startElm) {\n        var i;\n        var currentPath = this.editor.$(startElm).parentsUntil(this.editor.getBody()).add(startElm);\n        if (currentPath.length === this.lastPath.length) {\n          for (i = currentPath.length; i >= 0; i--) {\n            if (currentPath[i] !== this.lastPath[i]) {\n              break;\n            }\n          }\n          if (i === -1) {\n            this.lastPath = currentPath;\n            return true;\n          }\n        }\n        this.lastPath = currentPath;\n        return false;\n      };\n      return NodeChange;\n    }();\n\n    var preventSummaryToggle = function (editor) {\n      editor.on('click', function (e) {\n        if (editor.dom.getParent(e.target, 'details')) {\n          e.preventDefault();\n        }\n      });\n    };\n    var filterDetails = function (editor) {\n      editor.parser.addNodeFilter('details', function (elms) {\n        each(elms, function (details) {\n          details.attr('data-mce-open', details.attr('open'));\n          details.attr('open', 'open');\n        });\n      });\n      editor.serializer.addNodeFilter('details', function (elms) {\n        each(elms, function (details) {\n          var open = details.attr('data-mce-open');\n          details.attr('open', isString(open) ? open : null);\n          details.attr('data-mce-open', null);\n        });\n      });\n    };\n    var setup$j = function (editor) {\n      preventSummaryToggle(editor);\n      filterDetails(editor);\n    };\n\n    var isTextBlockNode = function (node) {\n      return isElement$1(node) && isTextBlock(SugarElement.fromDom(node));\n    };\n    var normalizeSelection$1 = function (editor) {\n      var rng = editor.selection.getRng();\n      var startPos = CaretPosition.fromRangeStart(rng);\n      var endPos = CaretPosition.fromRangeEnd(rng);\n      if (CaretPosition.isElementPosition(startPos)) {\n        var container = startPos.container();\n        if (isTextBlockNode(container)) {\n          firstPositionIn(container).each(function (pos) {\n            return rng.setStart(pos.container(), pos.offset());\n          });\n        }\n      }\n      if (CaretPosition.isElementPosition(endPos)) {\n        var container = startPos.container();\n        if (isTextBlockNode(container)) {\n          lastPositionIn(container).each(function (pos) {\n            return rng.setEnd(pos.container(), pos.offset());\n          });\n        }\n      }\n      editor.selection.setRng(normalize$2(rng));\n    };\n    var setup$k = function (editor) {\n      editor.on('click', function (e) {\n        if (e.detail >= 3) {\n          normalizeSelection$1(editor);\n        }\n      });\n    };\n\n    var value$1 = function () {\n      var subject = Cell(Optional.none());\n      var clear = function () {\n        return subject.set(Optional.none());\n      };\n      var set = function (s) {\n        return subject.set(Optional.some(s));\n      };\n      var isSet = function () {\n        return subject.get().isSome();\n      };\n      var on = function (f) {\n        return subject.get().each(f);\n      };\n      return {\n        clear: clear,\n        set: set,\n        isSet: isSet,\n        on: on\n      };\n    };\n\n    var getAbsolutePosition = function (elm) {\n      var clientRect = elm.getBoundingClientRect();\n      var doc = elm.ownerDocument;\n      var docElem = doc.documentElement;\n      var win = doc.defaultView;\n      return {\n        top: clientRect.top + win.pageYOffset - docElem.clientTop,\n        left: clientRect.left + win.pageXOffset - docElem.clientLeft\n      };\n    };\n    var getBodyPosition = function (editor) {\n      return editor.inline ? getAbsolutePosition(editor.getBody()) : {\n        left: 0,\n        top: 0\n      };\n    };\n    var getScrollPosition = function (editor) {\n      var body = editor.getBody();\n      return editor.inline ? {\n        left: body.scrollLeft,\n        top: body.scrollTop\n      } : {\n        left: 0,\n        top: 0\n      };\n    };\n    var getBodyScroll = function (editor) {\n      var body = editor.getBody(), docElm = editor.getDoc().documentElement;\n      var inlineScroll = {\n        left: body.scrollLeft,\n        top: body.scrollTop\n      };\n      var iframeScroll = {\n        left: body.scrollLeft || docElm.scrollLeft,\n        top: body.scrollTop || docElm.scrollTop\n      };\n      return editor.inline ? inlineScroll : iframeScroll;\n    };\n    var getMousePosition = function (editor, event) {\n      if (event.target.ownerDocument !== editor.getDoc()) {\n        var iframePosition = getAbsolutePosition(editor.getContentAreaContainer());\n        var scrollPosition = getBodyScroll(editor);\n        return {\n          left: event.pageX - iframePosition.left + scrollPosition.left,\n          top: event.pageY - iframePosition.top + scrollPosition.top\n        };\n      }\n      return {\n        left: event.pageX,\n        top: event.pageY\n      };\n    };\n    var calculatePosition = function (bodyPosition, scrollPosition, mousePosition) {\n      return {\n        pageX: mousePosition.left - bodyPosition.left + scrollPosition.left,\n        pageY: mousePosition.top - bodyPosition.top + scrollPosition.top\n      };\n    };\n    var calc = function (editor, event) {\n      return calculatePosition(getBodyPosition(editor), getScrollPosition(editor), getMousePosition(editor, event));\n    };\n\n    var isContentEditableFalse$a = isContentEditableFalse, isContentEditableTrue$3 = isContentEditableTrue;\n    var isDraggable = function (rootElm, elm) {\n      return isContentEditableFalse$a(elm) && elm !== rootElm;\n    };\n    var isValidDropTarget = function (editor, targetElement, dragElement) {\n      if (targetElement === dragElement || editor.dom.isChildOf(targetElement, dragElement)) {\n        return false;\n      }\n      return !isContentEditableFalse$a(targetElement);\n    };\n    var cloneElement = function (elm) {\n      var cloneElm = elm.cloneNode(true);\n      cloneElm.removeAttribute('data-mce-selected');\n      return cloneElm;\n    };\n    var createGhost = function (editor, elm, width, height) {\n      var dom = editor.dom;\n      var clonedElm = elm.cloneNode(true);\n      dom.setStyles(clonedElm, {\n        width: width,\n        height: height\n      });\n      dom.setAttrib(clonedElm, 'data-mce-selected', null);\n      var ghostElm = dom.create('div', {\n        'class': 'mce-drag-container',\n        'data-mce-bogus': 'all',\n        'unselectable': 'on',\n        'contenteditable': 'false'\n      });\n      dom.setStyles(ghostElm, {\n        position: 'absolute',\n        opacity: 0.5,\n        overflow: 'hidden',\n        border: 0,\n        padding: 0,\n        margin: 0,\n        width: width,\n        height: height\n      });\n      dom.setStyles(clonedElm, {\n        margin: 0,\n        boxSizing: 'border-box'\n      });\n      ghostElm.appendChild(clonedElm);\n      return ghostElm;\n    };\n    var appendGhostToBody = function (ghostElm, bodyElm) {\n      if (ghostElm.parentNode !== bodyElm) {\n        bodyElm.appendChild(ghostElm);\n      }\n    };\n    var moveGhost = function (ghostElm, position, width, height, maxX, maxY) {\n      var overflowX = 0, overflowY = 0;\n      ghostElm.style.left = position.pageX + 'px';\n      ghostElm.style.top = position.pageY + 'px';\n      if (position.pageX + width > maxX) {\n        overflowX = position.pageX + width - maxX;\n      }\n      if (position.pageY + height > maxY) {\n        overflowY = position.pageY + height - maxY;\n      }\n      ghostElm.style.width = width - overflowX + 'px';\n      ghostElm.style.height = height - overflowY + 'px';\n    };\n    var removeElement = function (elm) {\n      if (elm && elm.parentNode) {\n        elm.parentNode.removeChild(elm);\n      }\n    };\n    var isLeftMouseButtonPressed = function (e) {\n      return e.button === 0;\n    };\n    var applyRelPos = function (state, position) {\n      return {\n        pageX: position.pageX - state.relX,\n        pageY: position.pageY + 5\n      };\n    };\n    var start$1 = function (state, editor) {\n      return function (e) {\n        if (isLeftMouseButtonPressed(e)) {\n          var ceElm = find(editor.dom.getParents(e.target), or(isContentEditableFalse$a, isContentEditableTrue$3)).getOr(null);\n          if (isDraggable(editor.getBody(), ceElm)) {\n            var elmPos = editor.dom.getPos(ceElm);\n            var bodyElm = editor.getBody();\n            var docElm = editor.getDoc().documentElement;\n            state.set({\n              element: ceElm,\n              dragging: false,\n              screenX: e.screenX,\n              screenY: e.screenY,\n              maxX: (editor.inline ? bodyElm.scrollWidth : docElm.offsetWidth) - 2,\n              maxY: (editor.inline ? bodyElm.scrollHeight : docElm.offsetHeight) - 2,\n              relX: e.pageX - elmPos.x,\n              relY: e.pageY - elmPos.y,\n              width: ceElm.offsetWidth,\n              height: ceElm.offsetHeight,\n              ghost: createGhost(editor, ceElm, ceElm.offsetWidth, ceElm.offsetHeight)\n            });\n          }\n        }\n      };\n    };\n    var move$2 = function (state, editor) {\n      var throttledPlaceCaretAt = Delay.throttle(function (clientX, clientY) {\n        editor._selectionOverrides.hideFakeCaret();\n        editor.selection.placeCaretAt(clientX, clientY);\n      }, 0);\n      editor.on('remove', throttledPlaceCaretAt.stop);\n      return function (e) {\n        return state.on(function (state) {\n          var movement = Math.max(Math.abs(e.screenX - state.screenX), Math.abs(e.screenY - state.screenY));\n          if (!state.dragging && movement > 10) {\n            var args = editor.fire('dragstart', { target: state.element });\n            if (args.isDefaultPrevented()) {\n              return;\n            }\n            state.dragging = true;\n            editor.focus();\n          }\n          if (state.dragging) {\n            var targetPos = applyRelPos(state, calc(editor, e));\n            appendGhostToBody(state.ghost, editor.getBody());\n            moveGhost(state.ghost, targetPos, state.width, state.height, state.maxX, state.maxY);\n            throttledPlaceCaretAt(e.clientX, e.clientY);\n          }\n        });\n      };\n    };\n    var getRawTarget = function (selection) {\n      var rng = selection.getSel().getRangeAt(0);\n      var startContainer = rng.startContainer;\n      return startContainer.nodeType === 3 ? startContainer.parentNode : startContainer;\n    };\n    var drop = function (state, editor) {\n      return function (e) {\n        state.on(function (state) {\n          if (state.dragging) {\n            if (isValidDropTarget(editor, getRawTarget(editor.selection), state.element)) {\n              var targetClone_1 = cloneElement(state.element);\n              var args = editor.fire('drop', {\n                clientX: e.clientX,\n                clientY: e.clientY\n              });\n              if (!args.isDefaultPrevented()) {\n                editor.undoManager.transact(function () {\n                  removeElement(state.element);\n                  editor.insertContent(editor.dom.getOuterHTML(targetClone_1));\n                  editor._selectionOverrides.hideFakeCaret();\n                });\n              }\n            }\n          }\n        });\n        removeDragState(state);\n      };\n    };\n    var stop = function (state, editor) {\n      return function () {\n        state.on(function (state) {\n          if (state.dragging) {\n            editor.fire('dragend');\n          }\n        });\n        removeDragState(state);\n      };\n    };\n    var removeDragState = function (state) {\n      state.on(function (state) {\n        removeElement(state.ghost);\n      });\n      state.clear();\n    };\n    var bindFakeDragEvents = function (editor) {\n      var state = value$1();\n      var pageDom = DOMUtils$1.DOM;\n      var rootDocument = document;\n      var dragStartHandler = start$1(state, editor);\n      var dragHandler = move$2(state, editor);\n      var dropHandler = drop(state, editor);\n      var dragEndHandler = stop(state, editor);\n      editor.on('mousedown', dragStartHandler);\n      editor.on('mousemove', dragHandler);\n      editor.on('mouseup', dropHandler);\n      pageDom.bind(rootDocument, 'mousemove', dragHandler);\n      pageDom.bind(rootDocument, 'mouseup', dragEndHandler);\n      editor.on('remove', function () {\n        pageDom.unbind(rootDocument, 'mousemove', dragHandler);\n        pageDom.unbind(rootDocument, 'mouseup', dragEndHandler);\n      });\n    };\n    var blockIeDrop = function (editor) {\n      editor.on('drop', function (e) {\n        var realTarget = typeof e.clientX !== 'undefined' ? editor.getDoc().elementFromPoint(e.clientX, e.clientY) : null;\n        if (isContentEditableFalse$a(realTarget) || editor.dom.getContentEditableParent(realTarget) === 'false') {\n          e.preventDefault();\n        }\n      });\n    };\n    var blockUnsupportedFileDrop = function (editor) {\n      var preventFileDrop = function (e) {\n        if (!e.defaultPrevented) {\n          var dataTransfer = e.dataTransfer;\n          if (dataTransfer && (contains(dataTransfer.types, 'Files') || dataTransfer.files.length > 0)) {\n            e.preventDefault();\n            if (e.type === 'drop') {\n              displayError(editor, 'Dropped file type is not supported');\n            }\n          }\n        }\n      };\n      var preventFileDropIfUIElement = function (e) {\n        if (isUIElement(editor, e.target)) {\n          preventFileDrop(e);\n        }\n      };\n      var setup = function () {\n        var pageDom = DOMUtils$1.DOM;\n        var dom = editor.dom;\n        var doc = document;\n        var editorRoot = editor.inline ? editor.getBody() : editor.getDoc();\n        var eventNames = [\n          'drop',\n          'dragover'\n        ];\n        each(eventNames, function (name) {\n          pageDom.bind(doc, name, preventFileDropIfUIElement);\n          dom.bind(editorRoot, name, preventFileDrop);\n        });\n        editor.on('remove', function () {\n          each(eventNames, function (name) {\n            pageDom.unbind(doc, name, preventFileDropIfUIElement);\n            dom.unbind(editorRoot, name, preventFileDrop);\n          });\n        });\n      };\n      editor.on('init', function () {\n        Delay.setEditorTimeout(editor, setup, 0);\n      });\n    };\n    var init = function (editor) {\n      bindFakeDragEvents(editor);\n      blockIeDrop(editor);\n      if (shouldBlockUnsupportedDrop(editor)) {\n        blockUnsupportedFileDrop(editor);\n      }\n    };\n\n    var setup$l = function (editor) {\n      var renderFocusCaret = first(function () {\n        if (!editor.removed && editor.getBody().contains(document.activeElement)) {\n          var rng = editor.selection.getRng();\n          if (rng.collapsed) {\n            var caretRange = renderRangeCaret(editor, rng, false);\n            editor.selection.setRng(caretRange);\n          }\n        }\n      }, 0);\n      editor.on('focus', function () {\n        renderFocusCaret.throttle();\n      });\n      editor.on('blur', function () {\n        renderFocusCaret.cancel();\n      });\n    };\n\n    var setup$m = function (editor) {\n      editor.on('init', function () {\n        editor.on('focusin', function (e) {\n          var target = e.target;\n          if (isMedia(target)) {\n            var ceRoot = getContentEditableRoot(editor.getBody(), target);\n            var node = isContentEditableFalse(ceRoot) ? ceRoot : target;\n            if (editor.selection.getNode() !== node) {\n              selectNode(editor, node).each(function (rng) {\n                return editor.selection.setRng(rng);\n              });\n            }\n          }\n        });\n      });\n    };\n\n    var isContentEditableTrue$4 = isContentEditableTrue;\n    var isContentEditableFalse$b = isContentEditableFalse;\n    var getContentEditableRoot$1 = function (editor, node) {\n      return getContentEditableRoot(editor.getBody(), node);\n    };\n    var SelectionOverrides = function (editor) {\n      var selection = editor.selection, dom = editor.dom;\n      var isBlock = dom.isBlock;\n      var rootNode = editor.getBody();\n      var fakeCaret = FakeCaret(editor, rootNode, isBlock, function () {\n        return hasFocus$1(editor);\n      });\n      var realSelectionId = 'sel-' + dom.uniqueId();\n      var elementSelectionAttr = 'data-mce-selected';\n      var selectedElement;\n      var isFakeSelectionElement = function (node) {\n        return dom.hasClass(node, 'mce-offscreen-selection');\n      };\n      var isFakeSelectionTargetElement = function (node) {\n        return node !== rootNode && (isContentEditableFalse$b(node) || isMedia(node)) && dom.isChildOf(node, rootNode);\n      };\n      var isNearFakeSelectionElement = function (pos) {\n        return isBeforeContentEditableFalse(pos) || isAfterContentEditableFalse(pos) || isBeforeMedia(pos) || isAfterMedia(pos);\n      };\n      var getRealSelectionElement = function () {\n        var container = dom.get(realSelectionId);\n        return container ? container.getElementsByTagName('*')[0] : container;\n      };\n      var setRange = function (range) {\n        if (range) {\n          selection.setRng(range);\n        }\n      };\n      var getRange = selection.getRng;\n      var showCaret = function (direction, node, before, scrollIntoView) {\n        if (scrollIntoView === void 0) {\n          scrollIntoView = true;\n        }\n        var e = editor.fire('ShowCaret', {\n          target: node,\n          direction: direction,\n          before: before\n        });\n        if (e.isDefaultPrevented()) {\n          return null;\n        }\n        if (scrollIntoView) {\n          selection.scrollIntoView(node, direction === -1);\n        }\n        return fakeCaret.show(before, node);\n      };\n      var showBlockCaretContainer = function (blockCaretContainer) {\n        if (blockCaretContainer.hasAttribute('data-mce-caret')) {\n          showCaretContainerBlock(blockCaretContainer);\n          setRange(getRange());\n          selection.scrollIntoView(blockCaretContainer);\n        }\n      };\n      var registerEvents = function () {\n        editor.on('mouseup', function (e) {\n          var range = getRange();\n          if (range.collapsed && isXYInContentArea(editor, e.clientX, e.clientY)) {\n            renderCaretAtRange(editor, range, false).each(setRange);\n          }\n        });\n        editor.on('click', function (e) {\n          var contentEditableRoot = getContentEditableRoot$1(editor, e.target);\n          if (contentEditableRoot) {\n            if (isContentEditableFalse$b(contentEditableRoot)) {\n              e.preventDefault();\n              editor.focus();\n            }\n            if (isContentEditableTrue$4(contentEditableRoot)) {\n              if (dom.isChildOf(contentEditableRoot, selection.getNode())) {\n                removeElementSelection();\n              }\n            }\n          }\n        });\n        editor.on('blur NewBlock', removeElementSelection);\n        editor.on('ResizeWindow FullscreenStateChanged', fakeCaret.reposition);\n        var hasNormalCaretPosition = function (elm) {\n          var caretWalker = CaretWalker(elm);\n          if (!elm.firstChild) {\n            return false;\n          }\n          var startPos = CaretPosition$1.before(elm.firstChild);\n          var newPos = caretWalker.next(startPos);\n          return newPos && !isNearFakeSelectionElement(newPos);\n        };\n        var isInSameBlock = function (node1, node2) {\n          var block1 = dom.getParent(node1, isBlock);\n          var block2 = dom.getParent(node2, isBlock);\n          return block1 === block2;\n        };\n        var hasBetterMouseTarget = function (targetNode, caretNode) {\n          var targetBlock = dom.getParent(targetNode, isBlock);\n          var caretBlock = dom.getParent(caretNode, isBlock);\n          if (targetBlock && targetNode !== caretBlock && dom.isChildOf(targetBlock, caretBlock) && isContentEditableFalse$b(getContentEditableRoot$1(editor, targetBlock)) === false) {\n            return true;\n          }\n          return targetBlock && !isInSameBlock(targetBlock, caretBlock) && hasNormalCaretPosition(targetBlock);\n        };\n        editor.on('tap', function (e) {\n          var targetElm = e.target;\n          var contentEditableRoot = getContentEditableRoot$1(editor, targetElm);\n          if (isContentEditableFalse$b(contentEditableRoot)) {\n            e.preventDefault();\n            selectNode(editor, contentEditableRoot).each(setElementSelection);\n          } else if (isFakeSelectionTargetElement(targetElm)) {\n            selectNode(editor, targetElm).each(setElementSelection);\n          }\n        }, true);\n        editor.on('mousedown', function (e) {\n          var targetElm = e.target;\n          if (targetElm !== rootNode && targetElm.nodeName !== 'HTML' && !dom.isChildOf(targetElm, rootNode)) {\n            return;\n          }\n          if (isXYInContentArea(editor, e.clientX, e.clientY) === false) {\n            return;\n          }\n          var contentEditableRoot = getContentEditableRoot$1(editor, targetElm);\n          if (contentEditableRoot) {\n            if (isContentEditableFalse$b(contentEditableRoot)) {\n              e.preventDefault();\n              selectNode(editor, contentEditableRoot).each(setElementSelection);\n            } else {\n              removeElementSelection();\n              if (!(isContentEditableTrue$4(contentEditableRoot) && e.shiftKey) && !isXYWithinRange(e.clientX, e.clientY, selection.getRng())) {\n                hideFakeCaret();\n                selection.placeCaretAt(e.clientX, e.clientY);\n              }\n            }\n          } else if (isFakeSelectionTargetElement(targetElm)) {\n            selectNode(editor, targetElm).each(setElementSelection);\n          } else if (isFakeCaretTarget(targetElm) === false) {\n            removeElementSelection();\n            hideFakeCaret();\n            var fakeCaretInfo = closestFakeCaret(rootNode, e.clientX, e.clientY);\n            if (fakeCaretInfo) {\n              if (!hasBetterMouseTarget(targetElm, fakeCaretInfo.node)) {\n                e.preventDefault();\n                var range = showCaret(1, fakeCaretInfo.node, fakeCaretInfo.before, false);\n                editor.getBody().focus();\n                setRange(range);\n              }\n            }\n          }\n        });\n        editor.on('keypress', function (e) {\n          if (VK.modifierPressed(e)) {\n            return;\n          }\n          if (isContentEditableFalse$b(selection.getNode())) {\n            e.preventDefault();\n          }\n        });\n        editor.on('GetSelectionRange', function (e) {\n          var rng = e.range;\n          if (selectedElement) {\n            if (!selectedElement.parentNode) {\n              selectedElement = null;\n              return;\n            }\n            rng = rng.cloneRange();\n            rng.selectNode(selectedElement);\n            e.range = rng;\n          }\n        });\n        editor.on('SetSelectionRange', function (e) {\n          e.range = normalizeShortEndedElementSelection(e.range);\n          var rng = setElementSelection(e.range, e.forward);\n          if (rng) {\n            e.range = rng;\n          }\n        });\n        var isPasteBin = function (node) {\n          return node.id === 'mcepastebin';\n        };\n        editor.on('AfterSetSelectionRange', function (e) {\n          var rng = e.range;\n          var parentNode = rng.startContainer.parentNode;\n          if (!isRangeInCaretContainer(rng) && !isPasteBin(parentNode)) {\n            hideFakeCaret();\n          }\n          if (!isFakeSelectionElement(parentNode)) {\n            removeElementSelection();\n          }\n        });\n        editor.on('copy', function (e) {\n          var clipboardData = e.clipboardData;\n          if (!e.isDefaultPrevented() && e.clipboardData && !Env.ie) {\n            var realSelectionElement = getRealSelectionElement();\n            if (realSelectionElement) {\n              e.preventDefault();\n              clipboardData.clearData();\n              clipboardData.setData('text/html', realSelectionElement.outerHTML);\n              clipboardData.setData('text/plain', realSelectionElement.outerText || realSelectionElement.innerText);\n            }\n          }\n        });\n        init(editor);\n        setup$l(editor);\n        setup$m(editor);\n      };\n      var isWithinCaretContainer = function (node) {\n        return isCaretContainer(node) || startsWithCaretContainer(node) || endsWithCaretContainer(node);\n      };\n      var isRangeInCaretContainer = function (rng) {\n        return isWithinCaretContainer(rng.startContainer) || isWithinCaretContainer(rng.endContainer);\n      };\n      var normalizeShortEndedElementSelection = function (rng) {\n        var shortEndedElements = editor.schema.getShortEndedElements();\n        var newRng = dom.createRng();\n        var startContainer = rng.startContainer;\n        var startOffset = rng.startOffset;\n        var endContainer = rng.endContainer;\n        var endOffset = rng.endOffset;\n        if (has(shortEndedElements, startContainer.nodeName.toLowerCase())) {\n          if (startOffset === 0) {\n            newRng.setStartBefore(startContainer);\n          } else {\n            newRng.setStartAfter(startContainer);\n          }\n        } else {\n          newRng.setStart(startContainer, startOffset);\n        }\n        if (has(shortEndedElements, endContainer.nodeName.toLowerCase())) {\n          if (endOffset === 0) {\n            newRng.setEndBefore(endContainer);\n          } else {\n            newRng.setEndAfter(endContainer);\n          }\n        } else {\n          newRng.setEnd(endContainer, endOffset);\n        }\n        return newRng;\n      };\n      var setupOffscreenSelection = function (node, targetClone, origTargetClone) {\n        var $ = editor.$;\n        var $realSelectionContainer = descendant(SugarElement.fromDom(editor.getBody()), '#' + realSelectionId).fold(function () {\n          return $([]);\n        }, function (elm) {\n          return $([elm.dom]);\n        });\n        if ($realSelectionContainer.length === 0) {\n          $realSelectionContainer = $('<div data-mce-bogus=\"all\" class=\"mce-offscreen-selection\"></div>').attr('id', realSelectionId);\n          $realSelectionContainer.appendTo(editor.getBody());\n        }\n        var newRange = dom.createRng();\n        if (targetClone === origTargetClone && Env.ie) {\n          $realSelectionContainer.empty().append('<p style=\"font-size: 0\" data-mce-bogus=\"all\">\\xA0</p>').append(targetClone);\n          newRange.setStartAfter($realSelectionContainer[0].firstChild.firstChild);\n          newRange.setEndAfter(targetClone);\n        } else {\n          $realSelectionContainer.empty().append(nbsp).append(targetClone).append(nbsp);\n          newRange.setStart($realSelectionContainer[0].firstChild, 1);\n          newRange.setEnd($realSelectionContainer[0].lastChild, 0);\n        }\n        $realSelectionContainer.css({ top: dom.getPos(node, editor.getBody()).y });\n        $realSelectionContainer[0].focus();\n        var sel = selection.getSel();\n        sel.removeAllRanges();\n        sel.addRange(newRange);\n        return newRange;\n      };\n      var selectElement = function (elm) {\n        var targetClone = elm.cloneNode(true);\n        var e = editor.fire('ObjectSelected', {\n          target: elm,\n          targetClone: targetClone\n        });\n        if (e.isDefaultPrevented()) {\n          return null;\n        }\n        var range = setupOffscreenSelection(elm, e.targetClone, targetClone);\n        var nodeElm = SugarElement.fromDom(elm);\n        each(descendants$1(SugarElement.fromDom(editor.getBody()), '*[data-mce-selected]'), function (elm) {\n          if (!eq$2(nodeElm, elm)) {\n            remove$1(elm, elementSelectionAttr);\n          }\n        });\n        if (!dom.getAttrib(elm, elementSelectionAttr)) {\n          elm.setAttribute(elementSelectionAttr, '1');\n        }\n        selectedElement = elm;\n        hideFakeCaret();\n        return range;\n      };\n      var setElementSelection = function (range, forward) {\n        if (!range) {\n          return null;\n        }\n        if (range.collapsed) {\n          if (!isRangeInCaretContainer(range)) {\n            var dir = forward ? 1 : -1;\n            var caretPosition = getNormalizedRangeEndPoint(dir, rootNode, range);\n            var beforeNode = caretPosition.getNode(!forward);\n            if (isFakeCaretTarget(beforeNode)) {\n              return showCaret(dir, beforeNode, forward ? !caretPosition.isAtEnd() : false, false);\n            }\n            var afterNode = caretPosition.getNode(forward);\n            if (isFakeCaretTarget(afterNode)) {\n              return showCaret(dir, afterNode, forward ? false : !caretPosition.isAtEnd(), false);\n            }\n          }\n          return null;\n        }\n        var startContainer = range.startContainer;\n        var startOffset = range.startOffset;\n        var endOffset = range.endOffset;\n        if (startContainer.nodeType === 3 && startOffset === 0 && isContentEditableFalse$b(startContainer.parentNode)) {\n          startContainer = startContainer.parentNode;\n          startOffset = dom.nodeIndex(startContainer);\n          startContainer = startContainer.parentNode;\n        }\n        if (startContainer.nodeType !== 1) {\n          return null;\n        }\n        if (endOffset === startOffset + 1 && startContainer === range.endContainer) {\n          var node = startContainer.childNodes[startOffset];\n          if (isFakeSelectionTargetElement(node)) {\n            return selectElement(node);\n          }\n        }\n        return null;\n      };\n      var removeElementSelection = function () {\n        if (selectedElement) {\n          selectedElement.removeAttribute(elementSelectionAttr);\n        }\n        descendant(SugarElement.fromDom(editor.getBody()), '#' + realSelectionId).each(remove);\n        selectedElement = null;\n      };\n      var destroy = function () {\n        fakeCaret.destroy();\n        selectedElement = null;\n      };\n      var hideFakeCaret = function () {\n        fakeCaret.hide();\n      };\n      if (Env.ceFalse) {\n        registerEvents();\n      }\n      return {\n        showCaret: showCaret,\n        showBlockCaretContainer: showBlockCaretContainer,\n        hideFakeCaret: hideFakeCaret,\n        destroy: destroy\n      };\n    };\n\n    var Quirks = function (editor) {\n      var each = Tools.each;\n      var BACKSPACE = VK.BACKSPACE, DELETE = VK.DELETE, dom = editor.dom, selection = editor.selection, parser = editor.parser;\n      var isGecko = Env.gecko, isIE = Env.ie, isWebKit = Env.webkit;\n      var mceInternalUrlPrefix = 'data:text/mce-internal,';\n      var mceInternalDataType = isIE ? 'Text' : 'URL';\n      var setEditorCommandState = function (cmd, state) {\n        try {\n          editor.getDoc().execCommand(cmd, false, state);\n        } catch (ex) {\n        }\n      };\n      var isDefaultPrevented = function (e) {\n        return e.isDefaultPrevented();\n      };\n      var setMceInternalContent = function (e) {\n        var selectionHtml, internalContent;\n        if (e.dataTransfer) {\n          if (editor.selection.isCollapsed() && e.target.tagName === 'IMG') {\n            selection.select(e.target);\n          }\n          selectionHtml = editor.selection.getContent();\n          if (selectionHtml.length > 0) {\n            internalContent = mceInternalUrlPrefix + escape(editor.id) + ',' + escape(selectionHtml);\n            e.dataTransfer.setData(mceInternalDataType, internalContent);\n          }\n        }\n      };\n      var getMceInternalContent = function (e) {\n        var internalContent;\n        if (e.dataTransfer) {\n          internalContent = e.dataTransfer.getData(mceInternalDataType);\n          if (internalContent && internalContent.indexOf(mceInternalUrlPrefix) >= 0) {\n            internalContent = internalContent.substr(mceInternalUrlPrefix.length).split(',');\n            return {\n              id: unescape(internalContent[0]),\n              html: unescape(internalContent[1])\n            };\n          }\n        }\n        return null;\n      };\n      var insertClipboardContents = function (content, internal) {\n        if (editor.queryCommandSupported('mceInsertClipboardContent')) {\n          editor.execCommand('mceInsertClipboardContent', false, {\n            content: content,\n            internal: internal\n          });\n        } else {\n          editor.execCommand('mceInsertContent', false, content);\n        }\n      };\n      var emptyEditorWhenDeleting = function () {\n        var serializeRng = function (rng) {\n          var body = dom.create('body');\n          var contents = rng.cloneContents();\n          body.appendChild(contents);\n          return selection.serializer.serialize(body, { format: 'html' });\n        };\n        var allContentsSelected = function (rng) {\n          var selection = serializeRng(rng);\n          var allRng = dom.createRng();\n          allRng.selectNode(editor.getBody());\n          var allSelection = serializeRng(allRng);\n          return selection === allSelection;\n        };\n        editor.on('keydown', function (e) {\n          var keyCode = e.keyCode;\n          var isCollapsed, body;\n          if (!isDefaultPrevented(e) && (keyCode === DELETE || keyCode === BACKSPACE)) {\n            isCollapsed = editor.selection.isCollapsed();\n            body = editor.getBody();\n            if (isCollapsed && !dom.isEmpty(body)) {\n              return;\n            }\n            if (!isCollapsed && !allContentsSelected(editor.selection.getRng())) {\n              return;\n            }\n            e.preventDefault();\n            editor.setContent('');\n            if (body.firstChild && dom.isBlock(body.firstChild)) {\n              editor.selection.setCursorLocation(body.firstChild, 0);\n            } else {\n              editor.selection.setCursorLocation(body, 0);\n            }\n            editor.nodeChanged();\n          }\n        });\n      };\n      var selectAll = function () {\n        editor.shortcuts.add('meta+a', null, 'SelectAll');\n      };\n      var inputMethodFocus = function () {\n        if (!editor.inline) {\n          dom.bind(editor.getDoc(), 'mousedown mouseup', function (e) {\n            var rng;\n            if (e.target === editor.getDoc().documentElement) {\n              rng = selection.getRng();\n              editor.getBody().focus();\n              if (e.type === 'mousedown') {\n                if (isCaretContainer(rng.startContainer)) {\n                  return;\n                }\n                selection.placeCaretAt(e.clientX, e.clientY);\n              } else {\n                selection.setRng(rng);\n              }\n            }\n          });\n        }\n      };\n      var removeHrOnBackspace = function () {\n        editor.on('keydown', function (e) {\n          if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n            if (!editor.getBody().getElementsByTagName('hr').length) {\n              return;\n            }\n            if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\n              var node = selection.getNode();\n              var previousSibling = node.previousSibling;\n              if (node.nodeName === 'HR') {\n                dom.remove(node);\n                e.preventDefault();\n                return;\n              }\n              if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'hr') {\n                dom.remove(previousSibling);\n                e.preventDefault();\n              }\n            }\n          }\n        });\n      };\n      var focusBody = function () {\n        if (!Range.prototype.getClientRects) {\n          editor.on('mousedown', function (e) {\n            if (!isDefaultPrevented(e) && e.target.nodeName === 'HTML') {\n              var body_1 = editor.getBody();\n              body_1.blur();\n              Delay.setEditorTimeout(editor, function () {\n                body_1.focus();\n              });\n            }\n          });\n        }\n      };\n      var selectControlElements = function () {\n        editor.on('click', function (e) {\n          var target = e.target;\n          if (/^(IMG|HR)$/.test(target.nodeName) && dom.getContentEditableParent(target) !== 'false') {\n            e.preventDefault();\n            editor.selection.select(target);\n            editor.nodeChanged();\n          }\n          if (target.nodeName === 'A' && dom.hasClass(target, 'mce-item-anchor')) {\n            e.preventDefault();\n            selection.select(target);\n          }\n        });\n      };\n      var removeStylesWhenDeletingAcrossBlockElements = function () {\n        var getAttributeApplyFunction = function () {\n          var template = dom.getAttribs(selection.getStart().cloneNode(false));\n          return function () {\n            var target = selection.getStart();\n            if (target !== editor.getBody()) {\n              dom.setAttrib(target, 'style', null);\n              each(template, function (attr) {\n                target.setAttributeNode(attr.cloneNode(true));\n              });\n            }\n          };\n        };\n        var isSelectionAcrossElements = function () {\n          return !selection.isCollapsed() && dom.getParent(selection.getStart(), dom.isBlock) !== dom.getParent(selection.getEnd(), dom.isBlock);\n        };\n        editor.on('keypress', function (e) {\n          var applyAttributes;\n          if (!isDefaultPrevented(e) && (e.keyCode === 8 || e.keyCode === 46) && isSelectionAcrossElements()) {\n            applyAttributes = getAttributeApplyFunction();\n            editor.getDoc().execCommand('delete', false, null);\n            applyAttributes();\n            e.preventDefault();\n            return false;\n          }\n        });\n        dom.bind(editor.getDoc(), 'cut', function (e) {\n          var applyAttributes;\n          if (!isDefaultPrevented(e) && isSelectionAcrossElements()) {\n            applyAttributes = getAttributeApplyFunction();\n            Delay.setEditorTimeout(editor, function () {\n              applyAttributes();\n            });\n          }\n        });\n      };\n      var disableBackspaceIntoATable = function () {\n        editor.on('keydown', function (e) {\n          if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n            if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\n              var previousSibling = selection.getNode().previousSibling;\n              if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'table') {\n                e.preventDefault();\n                return false;\n              }\n            }\n          }\n        });\n      };\n      var removeBlockQuoteOnBackSpace = function () {\n        editor.on('keydown', function (e) {\n          var rng, parent;\n          if (isDefaultPrevented(e) || e.keyCode !== VK.BACKSPACE) {\n            return;\n          }\n          rng = selection.getRng();\n          var container = rng.startContainer;\n          var offset = rng.startOffset;\n          var root = dom.getRoot();\n          parent = container;\n          if (!rng.collapsed || offset !== 0) {\n            return;\n          }\n          while (parent && parent.parentNode && parent.parentNode.firstChild === parent && parent.parentNode !== root) {\n            parent = parent.parentNode;\n          }\n          if (parent.tagName === 'BLOCKQUOTE') {\n            editor.formatter.toggle('blockquote', null, parent);\n            rng = dom.createRng();\n            rng.setStart(container, 0);\n            rng.setEnd(container, 0);\n            selection.setRng(rng);\n          }\n        });\n      };\n      var setGeckoEditingOptions = function () {\n        var setOpts = function () {\n          setEditorCommandState('StyleWithCSS', false);\n          setEditorCommandState('enableInlineTableEditing', false);\n          if (!getObjectResizing(editor)) {\n            setEditorCommandState('enableObjectResizing', false);\n          }\n        };\n        if (!isReadOnly(editor)) {\n          editor.on('BeforeExecCommand mousedown', setOpts);\n        }\n      };\n      var addBrAfterLastLinks = function () {\n        var fixLinks = function () {\n          each(dom.select('a'), function (node) {\n            var parentNode = node.parentNode;\n            var root = dom.getRoot();\n            if (parentNode.lastChild === node) {\n              while (parentNode && !dom.isBlock(parentNode)) {\n                if (parentNode.parentNode.lastChild !== parentNode || parentNode === root) {\n                  return;\n                }\n                parentNode = parentNode.parentNode;\n              }\n              dom.add(parentNode, 'br', { 'data-mce-bogus': 1 });\n            }\n          });\n        };\n        editor.on('SetContent ExecCommand', function (e) {\n          if (e.type === 'setcontent' || e.command === 'mceInsertLink') {\n            fixLinks();\n          }\n        });\n      };\n      var setDefaultBlockType = function () {\n        if (getForcedRootBlock(editor)) {\n          editor.on('init', function () {\n            setEditorCommandState('DefaultParagraphSeparator', getForcedRootBlock(editor));\n          });\n        }\n      };\n      var normalizeSelection = function () {\n        editor.on('keyup focusin mouseup', function (e) {\n          if (!VK.modifierPressed(e)) {\n            selection.normalize();\n          }\n        }, true);\n      };\n      var showBrokenImageIcon = function () {\n        editor.contentStyles.push('img:-moz-broken {' + '-moz-force-broken-image-icon:1;' + 'min-width:24px;' + 'min-height:24px' + '}');\n      };\n      var restoreFocusOnKeyDown = function () {\n        if (!editor.inline) {\n          editor.on('keydown', function () {\n            if (document.activeElement === document.body) {\n              editor.getWin().focus();\n            }\n          });\n        }\n      };\n      var bodyHeight = function () {\n        if (!editor.inline) {\n          editor.contentStyles.push('body {min-height: 150px}');\n          editor.on('click', function (e) {\n            var rng;\n            if (e.target.nodeName === 'HTML') {\n              if (Env.ie > 11) {\n                editor.getBody().focus();\n                return;\n              }\n              rng = editor.selection.getRng();\n              editor.getBody().focus();\n              editor.selection.setRng(rng);\n              editor.selection.normalize();\n              editor.nodeChanged();\n            }\n          });\n        }\n      };\n      var blockCmdArrowNavigation = function () {\n        if (Env.mac) {\n          editor.on('keydown', function (e) {\n            if (VK.metaKeyPressed(e) && !e.shiftKey && (e.keyCode === 37 || e.keyCode === 39)) {\n              e.preventDefault();\n              var selection_1 = editor.selection.getSel();\n              selection_1.modify('move', e.keyCode === 37 ? 'backward' : 'forward', 'lineboundary');\n            }\n          });\n        }\n      };\n      var disableAutoUrlDetect = function () {\n        setEditorCommandState('AutoUrlDetect', false);\n      };\n      var tapLinksAndImages = function () {\n        editor.on('click', function (e) {\n          var elm = e.target;\n          do {\n            if (elm.tagName === 'A') {\n              e.preventDefault();\n              return;\n            }\n          } while (elm = elm.parentNode);\n        });\n        editor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');\n      };\n      var blockFormSubmitInsideEditor = function () {\n        editor.on('init', function () {\n          editor.dom.bind(editor.getBody(), 'submit', function (e) {\n            e.preventDefault();\n          });\n        });\n      };\n      var removeAppleInterchangeBrs = function () {\n        parser.addNodeFilter('br', function (nodes) {\n          var i = nodes.length;\n          while (i--) {\n            if (nodes[i].attr('class') === 'Apple-interchange-newline') {\n              nodes[i].remove();\n            }\n          }\n        });\n      };\n      var ieInternalDragAndDrop = function () {\n        editor.on('dragstart', function (e) {\n          setMceInternalContent(e);\n        });\n        editor.on('drop', function (e) {\n          if (!isDefaultPrevented(e)) {\n            var internalContent = getMceInternalContent(e);\n            if (internalContent && internalContent.id !== editor.id) {\n              e.preventDefault();\n              var rng = fromPoint$1(e.x, e.y, editor.getDoc());\n              selection.setRng(rng);\n              insertClipboardContents(internalContent.html, true);\n            }\n          }\n        });\n      };\n      var refreshContentEditable = function () {\n      };\n      var isHidden = function () {\n        if (!isGecko || editor.removed) {\n          return false;\n        }\n        var sel = editor.selection.getSel();\n        return !sel || !sel.rangeCount || sel.rangeCount === 0;\n      };\n      removeBlockQuoteOnBackSpace();\n      emptyEditorWhenDeleting();\n      if (!Env.windowsPhone) {\n        normalizeSelection();\n      }\n      if (isWebKit) {\n        inputMethodFocus();\n        selectControlElements();\n        setDefaultBlockType();\n        blockFormSubmitInsideEditor();\n        disableBackspaceIntoATable();\n        removeAppleInterchangeBrs();\n        if (Env.iOS) {\n          restoreFocusOnKeyDown();\n          bodyHeight();\n          tapLinksAndImages();\n        } else {\n          selectAll();\n        }\n      }\n      if (Env.ie >= 11) {\n        bodyHeight();\n        disableBackspaceIntoATable();\n      }\n      if (Env.ie) {\n        selectAll();\n        disableAutoUrlDetect();\n        ieInternalDragAndDrop();\n      }\n      if (isGecko) {\n        removeHrOnBackspace();\n        focusBody();\n        removeStylesWhenDeletingAcrossBlockElements();\n        setGeckoEditingOptions();\n        addBrAfterLastLinks();\n        showBrokenImageIcon();\n        blockCmdArrowNavigation();\n        disableBackspaceIntoATable();\n      }\n      return {\n        refreshContentEditable: refreshContentEditable,\n        isHidden: isHidden\n      };\n    };\n\n    var DOM$4 = DOMUtils$1.DOM;\n    var appendStyle = function (editor, text) {\n      var body = SugarElement.fromDom(editor.getBody());\n      var container = getStyleContainer(getRootNode(body));\n      var style = SugarElement.fromTag('style');\n      set(style, 'type', 'text/css');\n      append(style, SugarElement.fromText(text));\n      append(container, style);\n      editor.on('remove', function () {\n        remove(style);\n      });\n    };\n    var getRootName = function (editor) {\n      return editor.inline ? editor.getElement().nodeName.toLowerCase() : undefined;\n    };\n    var removeUndefined = function (obj) {\n      return filter$1(obj, function (v) {\n        return isUndefined(v) === false;\n      });\n    };\n    var mkParserSettings = function (editor) {\n      var settings = editor.settings;\n      var blobCache = editor.editorUpload.blobCache;\n      return removeUndefined({\n        allow_conditional_comments: settings.allow_conditional_comments,\n        allow_html_data_urls: settings.allow_html_data_urls,\n        allow_svg_data_urls: settings.allow_svg_data_urls,\n        allow_html_in_named_anchor: settings.allow_html_in_named_anchor,\n        allow_script_urls: settings.allow_script_urls,\n        allow_unsafe_link_target: settings.allow_unsafe_link_target,\n        convert_fonts_to_spans: settings.convert_fonts_to_spans,\n        fix_list_elements: settings.fix_list_elements,\n        font_size_legacy_values: settings.font_size_legacy_values,\n        forced_root_block: settings.forced_root_block,\n        forced_root_block_attrs: settings.forced_root_block_attrs,\n        padd_empty_with_br: settings.padd_empty_with_br,\n        preserve_cdata: settings.preserve_cdata,\n        remove_trailing_brs: settings.remove_trailing_brs,\n        inline_styles: settings.inline_styles,\n        root_name: getRootName(editor),\n        validate: true,\n        blob_cache: blobCache,\n        images_dataimg_filter: settings.images_dataimg_filter\n      });\n    };\n    var mkSerializerSettings = function (editor) {\n      var settings = editor.settings;\n      return __assign(__assign({}, mkParserSettings(editor)), removeUndefined({\n        url_converter: settings.url_converter,\n        url_converter_scope: settings.url_converter_scope,\n        element_format: settings.element_format,\n        entities: settings.entities,\n        entity_encoding: settings.entity_encoding,\n        indent: settings.indent,\n        indent_after: settings.indent_after,\n        indent_before: settings.indent_before,\n        block_elements: settings.block_elements,\n        boolean_attributes: settings.boolean_attributes,\n        custom_elements: settings.custom_elements,\n        extended_valid_elements: settings.extended_valid_elements,\n        invalid_elements: settings.invalid_elements,\n        invalid_styles: settings.invalid_styles,\n        move_caret_before_on_enter_elements: settings.move_caret_before_on_enter_elements,\n        non_empty_elements: settings.non_empty_elements,\n        schema: settings.schema,\n        self_closing_elements: settings.self_closing_elements,\n        short_ended_elements: settings.short_ended_elements,\n        special: settings.special,\n        text_block_elements: settings.text_block_elements,\n        text_inline_elements: settings.text_inline_elements,\n        valid_children: settings.valid_children,\n        valid_classes: settings.valid_classes,\n        valid_elements: settings.valid_elements,\n        valid_styles: settings.valid_styles,\n        verify_html: settings.verify_html,\n        whitespace_elements: settings.whitespace_elements\n      }));\n    };\n    var createParser = function (editor) {\n      var parser = DomParser(mkParserSettings(editor), editor.schema);\n      parser.addAttributeFilter('src,href,style,tabindex', function (nodes, name) {\n        var i = nodes.length, node, value;\n        var dom = editor.dom;\n        var internalName = 'data-mce-' + name;\n        while (i--) {\n          node = nodes[i];\n          value = node.attr(name);\n          if (value && !node.attr(internalName)) {\n            if (value.indexOf('data:') === 0 || value.indexOf('blob:') === 0) {\n              continue;\n            }\n            if (name === 'style') {\n              value = dom.serializeStyle(dom.parseStyle(value), node.name);\n              if (!value.length) {\n                value = null;\n              }\n              node.attr(internalName, value);\n              node.attr(name, value);\n            } else if (name === 'tabindex') {\n              node.attr(internalName, value);\n              node.attr(name, null);\n            } else {\n              node.attr(internalName, editor.convertURL(value, name, node.name));\n            }\n          }\n        }\n      });\n      parser.addNodeFilter('script', function (nodes) {\n        var i = nodes.length;\n        while (i--) {\n          var node = nodes[i];\n          var type = node.attr('type') || 'no/type';\n          if (type.indexOf('mce-') !== 0) {\n            node.attr('type', 'mce-' + type);\n          }\n        }\n      });\n      if (editor.settings.preserve_cdata) {\n        parser.addNodeFilter('#cdata', function (nodes) {\n          var i = nodes.length;\n          while (i--) {\n            var node = nodes[i];\n            node.type = 8;\n            node.name = '#comment';\n            node.value = '[CDATA[' + editor.dom.encode(node.value) + ']]';\n          }\n        });\n      }\n      parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function (nodes) {\n        var i = nodes.length;\n        var nonEmptyElements = editor.schema.getNonEmptyElements();\n        while (i--) {\n          var node = nodes[i];\n          if (node.isEmpty(nonEmptyElements) && node.getAll('br').length === 0) {\n            node.append(new AstNode('br', 1)).shortEnded = true;\n          }\n        }\n      });\n      return parser;\n    };\n    var autoFocus = function (editor) {\n      if (editor.settings.auto_focus) {\n        Delay.setEditorTimeout(editor, function () {\n          var focusEditor;\n          if (editor.settings.auto_focus === true) {\n            focusEditor = editor;\n          } else {\n            focusEditor = editor.editorManager.get(editor.settings.auto_focus);\n          }\n          if (!focusEditor.destroyed) {\n            focusEditor.focus();\n          }\n        }, 100);\n      }\n    };\n    var moveSelectionToFirstCaretPosition = function (editor) {\n      var root = editor.dom.getRoot();\n      if (!editor.inline && (!hasAnyRanges(editor) || editor.selection.getStart(true) === root)) {\n        firstPositionIn(root).each(function (pos) {\n          var node = pos.getNode();\n          var caretPos = isTable(node) ? firstPositionIn(node).getOr(pos) : pos;\n          if (Env.browser.isIE()) {\n            storeNative(editor, caretPos.toRange());\n          } else {\n            editor.selection.setRng(caretPos.toRange());\n          }\n        });\n      }\n    };\n    var initEditor = function (editor) {\n      editor.bindPendingEventDelegates();\n      editor.initialized = true;\n      fireInit(editor);\n      editor.focus(true);\n      moveSelectionToFirstCaretPosition(editor);\n      editor.nodeChanged({ initial: true });\n      editor.execCallback('init_instance_callback', editor);\n      autoFocus(editor);\n    };\n    var getStyleSheetLoader = function (editor) {\n      return editor.inline ? editor.ui.styleSheetLoader : editor.dom.styleSheetLoader;\n    };\n    var loadContentCss = function (editor, css) {\n      var styleSheetLoader = getStyleSheetLoader(editor);\n      var loaded = function () {\n        editor.on('remove', function () {\n          return styleSheetLoader.unloadAll(css);\n        });\n        initEditor(editor);\n      };\n      styleSheetLoader.loadAll(css, loaded, loaded);\n    };\n    var preInit = function (editor, rtcMode) {\n      var settings = editor.settings, doc = editor.getDoc(), body = editor.getBody();\n      if (!settings.browser_spellcheck && !settings.gecko_spellcheck) {\n        doc.body.spellcheck = false;\n        DOM$4.setAttrib(body, 'spellcheck', 'false');\n      }\n      editor.quirks = Quirks(editor);\n      firePostRender(editor);\n      var directionality = getDirectionality(editor);\n      if (directionality !== undefined) {\n        body.dir = directionality;\n      }\n      if (settings.protect) {\n        editor.on('BeforeSetContent', function (e) {\n          Tools.each(settings.protect, function (pattern) {\n            e.content = e.content.replace(pattern, function (str) {\n              return '<!--mce:protected ' + escape(str) + '-->';\n            });\n          });\n        });\n      }\n      editor.on('SetContent', function () {\n        editor.addVisual(editor.getBody());\n      });\n      if (rtcMode === false) {\n        editor.load({\n          initial: true,\n          format: 'html'\n        });\n      }\n      editor.startContent = editor.getContent({ format: 'raw' });\n      editor.on('compositionstart compositionend', function (e) {\n        editor.composing = e.type === 'compositionstart';\n      });\n      if (editor.contentStyles.length > 0) {\n        var contentCssText_1 = '';\n        Tools.each(editor.contentStyles, function (style) {\n          contentCssText_1 += style + '\\r\\n';\n        });\n        editor.dom.addStyle(contentCssText_1);\n      }\n      loadContentCss(editor, editor.contentCSS);\n      if (settings.content_style) {\n        appendStyle(editor, settings.content_style);\n      }\n    };\n    var initContentBody = function (editor, skipWrite) {\n      var settings = editor.settings;\n      var targetElm = editor.getElement();\n      var doc = editor.getDoc();\n      if (!settings.inline) {\n        editor.getElement().style.visibility = editor.orgVisibility;\n      }\n      if (!skipWrite && !editor.inline) {\n        doc.open();\n        doc.write(editor.iframeHTML);\n        doc.close();\n      }\n      if (editor.inline) {\n        DOM$4.addClass(targetElm, 'mce-content-body');\n        editor.contentDocument = doc = document;\n        editor.contentWindow = window;\n        editor.bodyElement = targetElm;\n        editor.contentAreaContainer = targetElm;\n      }\n      var body = editor.getBody();\n      body.disabled = true;\n      editor.readonly = !!settings.readonly;\n      if (!editor.readonly) {\n        if (editor.inline && DOM$4.getStyle(body, 'position', true) === 'static') {\n          body.style.position = 'relative';\n        }\n        body.contentEditable = editor.getParam('content_editable_state', true);\n      }\n      body.disabled = false;\n      editor.editorUpload = EditorUpload(editor);\n      editor.schema = Schema(settings);\n      editor.dom = DOMUtils$1(doc, {\n        keep_values: true,\n        url_converter: editor.convertURL,\n        url_converter_scope: editor,\n        hex_colors: settings.force_hex_style_colors,\n        update_styles: true,\n        root_element: editor.inline ? editor.getBody() : null,\n        collect: function () {\n          return editor.inline;\n        },\n        schema: editor.schema,\n        contentCssCors: shouldUseContentCssCors(editor),\n        referrerPolicy: getReferrerPolicy(editor),\n        onSetAttrib: function (e) {\n          editor.fire('SetAttrib', e);\n        }\n      });\n      editor.parser = createParser(editor);\n      editor.serializer = DomSerializer(mkSerializerSettings(editor), editor);\n      editor.selection = EditorSelection(editor.dom, editor.getWin(), editor.serializer, editor);\n      editor.annotator = Annotator(editor);\n      editor.formatter = Formatter(editor);\n      editor.undoManager = UndoManager(editor);\n      editor._nodeChangeDispatcher = new NodeChange(editor);\n      editor._selectionOverrides = SelectionOverrides(editor);\n      setup$9(editor);\n      setup$j(editor);\n      if (!isRtc(editor)) {\n        setup$k(editor);\n      }\n      var caret = setup$i(editor);\n      setup$8(editor, caret);\n      setup$a(editor);\n      setup$7(editor);\n      firePreInit(editor);\n      setup$5(editor).fold(function () {\n        preInit(editor, false);\n      }, function (loadingRtc) {\n        editor.setProgressState(true);\n        loadingRtc.then(function (rtcMode) {\n          editor.setProgressState(false);\n          preInit(editor, rtcMode);\n        });\n      });\n    };\n\n    var DOM$5 = DOMUtils$1.DOM;\n    var relaxDomain = function (editor, ifr) {\n      if (document.domain !== window.location.hostname && Env.browser.isIE()) {\n        var bodyUuid = uuid('mce');\n        editor[bodyUuid] = function () {\n          initContentBody(editor);\n        };\n        var domainRelaxUrl = 'javascript:(function(){' + 'document.open();document.domain=\"' + document.domain + '\";' + 'var ed = window.parent.tinymce.get(\"' + editor.id + '\");document.write(ed.iframeHTML);' + 'document.close();ed.' + bodyUuid + '(true);})()';\n        DOM$5.setAttrib(ifr, 'src', domainRelaxUrl);\n        return true;\n      }\n      return false;\n    };\n    var createIframeElement = function (id, title, height, customAttrs) {\n      var iframe = SugarElement.fromTag('iframe');\n      setAll(iframe, customAttrs);\n      setAll(iframe, {\n        id: id + '_ifr',\n        frameBorder: '0',\n        allowTransparency: 'true',\n        title: title\n      });\n      add$3(iframe, 'tox-edit-area__iframe');\n      return iframe;\n    };\n    var getIframeHtml = function (editor) {\n      var iframeHTML = getDocType(editor) + '<html><head>';\n      if (getDocumentBaseUrl(editor) !== editor.documentBaseUrl) {\n        iframeHTML += '<base href=\"' + editor.documentBaseURI.getURI() + '\" />';\n      }\n      iframeHTML += '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\n      var bodyId = getBodyId(editor);\n      var bodyClass = getBodyClass(editor);\n      if (getContentSecurityPolicy(editor)) {\n        iframeHTML += '<meta http-equiv=\"Content-Security-Policy\" content=\"' + getContentSecurityPolicy(editor) + '\" />';\n      }\n      iframeHTML += '</head><body id=\"' + bodyId + '\" class=\"mce-content-body ' + bodyClass + '\" data-id=\"' + editor.id + '\"><br></body></html>';\n      return iframeHTML;\n    };\n    var createIframe = function (editor, o) {\n      var title = editor.editorManager.translate('Rich Text Area. Press ALT-0 for help.');\n      var ifr = createIframeElement(editor.id, title, o.height, getIframeAttrs(editor)).dom;\n      ifr.onload = function () {\n        ifr.onload = null;\n        editor.fire('load');\n      };\n      var isDomainRelaxed = relaxDomain(editor, ifr);\n      editor.contentAreaContainer = o.iframeContainer;\n      editor.iframeElement = ifr;\n      editor.iframeHTML = getIframeHtml(editor);\n      DOM$5.add(o.iframeContainer, ifr);\n      return isDomainRelaxed;\n    };\n    var init$1 = function (editor, boxInfo) {\n      var isDomainRelaxed = createIframe(editor, boxInfo);\n      if (boxInfo.editorContainer) {\n        DOM$5.get(boxInfo.editorContainer).style.display = editor.orgDisplay;\n        editor.hidden = DOM$5.isHidden(boxInfo.editorContainer);\n      }\n      editor.getElement().style.display = 'none';\n      DOM$5.setAttrib(editor.id, 'aria-hidden', 'true');\n      if (!isDomainRelaxed) {\n        initContentBody(editor);\n      }\n    };\n\n    var DOM$6 = DOMUtils$1.DOM;\n    var initPlugin = function (editor, initializedPlugins, plugin) {\n      var Plugin = PluginManager.get(plugin);\n      var pluginUrl = PluginManager.urls[plugin] || editor.documentBaseUrl.replace(/\\/$/, '');\n      plugin = Tools.trim(plugin);\n      if (Plugin && Tools.inArray(initializedPlugins, plugin) === -1) {\n        Tools.each(PluginManager.dependencies(plugin), function (dep) {\n          initPlugin(editor, initializedPlugins, dep);\n        });\n        if (editor.plugins[plugin]) {\n          return;\n        }\n        try {\n          var pluginInstance = new Plugin(editor, pluginUrl, editor.$);\n          editor.plugins[plugin] = pluginInstance;\n          if (pluginInstance.init) {\n            pluginInstance.init(editor, pluginUrl);\n            initializedPlugins.push(plugin);\n          }\n        } catch (e) {\n          pluginInitError(editor, plugin, e);\n        }\n      }\n    };\n    var trimLegacyPrefix = function (name) {\n      return name.replace(/^\\-/, '');\n    };\n    var initPlugins = function (editor) {\n      var initializedPlugins = [];\n      Tools.each(getPlugins(editor).split(/[ ,]/), function (name) {\n        initPlugin(editor, initializedPlugins, trimLegacyPrefix(name));\n      });\n    };\n    var initIcons = function (editor) {\n      var iconPackName = Tools.trim(getIconPackName(editor));\n      var currentIcons = editor.ui.registry.getAll().icons;\n      var loadIcons = __assign(__assign({}, IconManager.get('default').icons), IconManager.get(iconPackName).icons);\n      each$1(loadIcons, function (svgData, icon) {\n        if (!has(currentIcons, icon)) {\n          editor.ui.registry.addIcon(icon, svgData);\n        }\n      });\n    };\n    var initTheme = function (editor) {\n      var theme = getTheme(editor);\n      if (isString(theme)) {\n        editor.settings.theme = trimLegacyPrefix(theme);\n        var Theme = ThemeManager.get(theme);\n        editor.theme = new Theme(editor, ThemeManager.urls[theme]);\n        if (editor.theme.init) {\n          editor.theme.init(editor, ThemeManager.urls[theme] || editor.documentBaseUrl.replace(/\\/$/, ''), editor.$);\n        }\n      } else {\n        editor.theme = {};\n      }\n    };\n    var renderFromLoadedTheme = function (editor) {\n      return editor.theme.renderUI();\n    };\n    var renderFromThemeFunc = function (editor) {\n      var elm = editor.getElement();\n      var theme = getTheme(editor);\n      var info = theme(editor, elm);\n      if (info.editorContainer.nodeType) {\n        info.editorContainer.id = info.editorContainer.id || editor.id + '_parent';\n      }\n      if (info.iframeContainer && info.iframeContainer.nodeType) {\n        info.iframeContainer.id = info.iframeContainer.id || editor.id + '_iframecontainer';\n      }\n      info.height = info.iframeHeight ? info.iframeHeight : elm.offsetHeight;\n      return info;\n    };\n    var createThemeFalseResult = function (element) {\n      return {\n        editorContainer: element,\n        iframeContainer: element,\n        api: {}\n      };\n    };\n    var renderThemeFalseIframe = function (targetElement) {\n      var iframeContainer = DOM$6.create('div');\n      DOM$6.insertAfter(iframeContainer, targetElement);\n      return createThemeFalseResult(iframeContainer);\n    };\n    var renderThemeFalse = function (editor) {\n      var targetElement = editor.getElement();\n      return editor.inline ? createThemeFalseResult(null) : renderThemeFalseIframe(targetElement);\n    };\n    var renderThemeUi = function (editor) {\n      var elm = editor.getElement();\n      editor.orgDisplay = elm.style.display;\n      if (isString(getTheme(editor))) {\n        return renderFromLoadedTheme(editor);\n      } else if (isFunction(getTheme(editor))) {\n        return renderFromThemeFunc(editor);\n      } else {\n        return renderThemeFalse(editor);\n      }\n    };\n    var augmentEditorUiApi = function (editor, api) {\n      var uiApiFacade = {\n        show: Optional.from(api.show).getOr(noop),\n        hide: Optional.from(api.hide).getOr(noop),\n        disable: Optional.from(api.disable).getOr(noop),\n        isDisabled: Optional.from(api.isDisabled).getOr(never),\n        enable: function () {\n          if (!editor.mode.isReadOnly()) {\n            Optional.from(api.enable).map(call);\n          }\n        }\n      };\n      editor.ui = __assign(__assign({}, editor.ui), uiApiFacade);\n    };\n    var init$2 = function (editor) {\n      editor.fire('ScriptsLoaded');\n      initIcons(editor);\n      initTheme(editor);\n      initPlugins(editor);\n      var renderInfo = renderThemeUi(editor);\n      augmentEditorUiApi(editor, Optional.from(renderInfo.api).getOr({}));\n      var boxInfo = {\n        editorContainer: renderInfo.editorContainer,\n        iframeContainer: renderInfo.iframeContainer\n      };\n      editor.editorContainer = boxInfo.editorContainer ? boxInfo.editorContainer : null;\n      appendContentCssFromSettings(editor);\n      if (editor.inline) {\n        return initContentBody(editor);\n      } else {\n        return init$1(editor, boxInfo);\n      }\n    };\n\n    var DOM$7 = DOMUtils$1.DOM;\n    var hasSkipLoadPrefix = function (name) {\n      return name.charAt(0) === '-';\n    };\n    var loadLanguage = function (scriptLoader, editor) {\n      var languageCode = getLanguageCode(editor);\n      var languageUrl = getLanguageUrl(editor);\n      if (I18n.hasCode(languageCode) === false && languageCode !== 'en') {\n        var url_1 = languageUrl !== '' ? languageUrl : editor.editorManager.baseURL + '/langs/' + languageCode + '.js';\n        scriptLoader.add(url_1, noop, undefined, function () {\n          languageLoadError(editor, url_1, languageCode);\n        });\n      }\n    };\n    var loadTheme = function (scriptLoader, editor, suffix, callback) {\n      var theme = getTheme(editor);\n      if (isString(theme)) {\n        if (!hasSkipLoadPrefix(theme) && !ThemeManager.urls.hasOwnProperty(theme)) {\n          var themeUrl = getThemeUrl(editor);\n          if (themeUrl) {\n            ThemeManager.load(theme, editor.documentBaseURI.toAbsolute(themeUrl));\n          } else {\n            ThemeManager.load(theme, 'themes/' + theme + '/theme' + suffix + '.js');\n          }\n        }\n        scriptLoader.loadQueue(function () {\n          ThemeManager.waitFor(theme, callback);\n        });\n      } else {\n        callback();\n      }\n    };\n    var getIconsUrlMetaFromUrl = function (editor) {\n      return Optional.from(getIconsUrl(editor)).filter(function (url) {\n        return url.length > 0;\n      }).map(function (url) {\n        return {\n          url: url,\n          name: Optional.none()\n        };\n      });\n    };\n    var getIconsUrlMetaFromName = function (editor, name, suffix) {\n      return Optional.from(name).filter(function (name) {\n        return name.length > 0 && !IconManager.has(name);\n      }).map(function (name) {\n        return {\n          url: editor.editorManager.baseURL + '/icons/' + name + '/icons' + suffix + '.js',\n          name: Optional.some(name)\n        };\n      });\n    };\n    var loadIcons = function (scriptLoader, editor, suffix) {\n      var defaultIconsUrl = getIconsUrlMetaFromName(editor, 'default', suffix);\n      var customIconsUrl = getIconsUrlMetaFromUrl(editor).orThunk(function () {\n        return getIconsUrlMetaFromName(editor, getIconPackName(editor), '');\n      });\n      each(cat([\n        defaultIconsUrl,\n        customIconsUrl\n      ]), function (urlMeta) {\n        scriptLoader.add(urlMeta.url, noop, undefined, function () {\n          iconsLoadError(editor, urlMeta.url, urlMeta.name.getOrUndefined());\n        });\n      });\n    };\n    var loadPlugins = function (editor, suffix) {\n      Tools.each(getExternalPlugins(editor), function (url, name) {\n        PluginManager.load(name, url, noop, undefined, function () {\n          pluginLoadError(editor, url, name);\n        });\n        editor.settings.plugins += ' ' + name;\n      });\n      Tools.each(getPlugins(editor).split(/[ ,]/), function (plugin) {\n        plugin = Tools.trim(plugin);\n        if (plugin && !PluginManager.urls[plugin]) {\n          if (hasSkipLoadPrefix(plugin)) {\n            plugin = plugin.substr(1, plugin.length);\n            var dependencies = PluginManager.dependencies(plugin);\n            Tools.each(dependencies, function (depPlugin) {\n              var defaultSettings = {\n                prefix: 'plugins/',\n                resource: depPlugin,\n                suffix: '/plugin' + suffix + '.js'\n              };\n              var dep = PluginManager.createUrl(defaultSettings, depPlugin);\n              PluginManager.load(dep.resource, dep, noop, undefined, function () {\n                pluginLoadError(editor, dep.prefix + dep.resource + dep.suffix, dep.resource);\n              });\n            });\n          } else {\n            var url_2 = {\n              prefix: 'plugins/',\n              resource: plugin,\n              suffix: '/plugin' + suffix + '.js'\n            };\n            PluginManager.load(plugin, url_2, noop, undefined, function () {\n              pluginLoadError(editor, url_2.prefix + url_2.resource + url_2.suffix, plugin);\n            });\n          }\n        }\n      });\n    };\n    var loadScripts = function (editor, suffix) {\n      var scriptLoader = ScriptLoader.ScriptLoader;\n      loadTheme(scriptLoader, editor, suffix, function () {\n        loadLanguage(scriptLoader, editor);\n        loadIcons(scriptLoader, editor, suffix);\n        loadPlugins(editor, suffix);\n        scriptLoader.loadQueue(function () {\n          if (!editor.removed) {\n            init$2(editor);\n          }\n        }, editor, function () {\n          if (!editor.removed) {\n            init$2(editor);\n          }\n        });\n      });\n    };\n    var getStyleSheetLoader$1 = function (element, editor) {\n      return instance.forElement(element, {\n        contentCssCors: hasContentCssCors(editor),\n        referrerPolicy: getReferrerPolicy(editor)\n      });\n    };\n    var render = function (editor) {\n      var id = editor.id;\n      I18n.setCode(getLanguageCode(editor));\n      var readyHandler = function () {\n        DOM$7.unbind(window, 'ready', readyHandler);\n        editor.render();\n      };\n      if (!EventUtils.Event.domLoaded) {\n        DOM$7.bind(window, 'ready', readyHandler);\n        return;\n      }\n      if (!editor.getElement()) {\n        return;\n      }\n      if (!Env.contentEditable) {\n        return;\n      }\n      var element = SugarElement.fromDom(editor.getElement());\n      var snapshot = clone(element);\n      editor.on('remove', function () {\n        eachr(element.dom.attributes, function (attr) {\n          return remove$1(element, attr.name);\n        });\n        setAll(element, snapshot);\n      });\n      editor.ui.styleSheetLoader = getStyleSheetLoader$1(element, editor);\n      if (!isInline$1(editor)) {\n        editor.orgVisibility = editor.getElement().style.visibility;\n        editor.getElement().style.visibility = 'hidden';\n      } else {\n        editor.inline = true;\n      }\n      var form = editor.getElement().form || DOM$7.getParent(id, 'form');\n      if (form) {\n        editor.formElement = form;\n        if (hasHiddenInput(editor) && !isTextareaOrInput(editor.getElement())) {\n          DOM$7.insertAfter(DOM$7.create('input', {\n            type: 'hidden',\n            name: id\n          }), id);\n          editor.hasHiddenInput = true;\n        }\n        editor.formEventDelegate = function (e) {\n          editor.fire(e.type, e);\n        };\n        DOM$7.bind(form, 'submit reset', editor.formEventDelegate);\n        editor.on('reset', function () {\n          editor.resetContent();\n        });\n        if (shouldPatchSubmit(editor) && !form.submit.nodeType && !form.submit.length && !form._mceOldSubmit) {\n          form._mceOldSubmit = form.submit;\n          form.submit = function () {\n            editor.editorManager.triggerSave();\n            editor.setDirty(false);\n            return form._mceOldSubmit(form);\n          };\n        }\n      }\n      editor.windowManager = WindowManager(editor);\n      editor.notificationManager = NotificationManager(editor);\n      if (isEncodingXml(editor)) {\n        editor.on('GetContent', function (e) {\n          if (e.save) {\n            e.content = DOM$7.encode(e.content);\n          }\n        });\n      }\n      if (shouldAddFormSubmitTrigger(editor)) {\n        editor.on('submit', function () {\n          if (editor.initialized) {\n            editor.save();\n          }\n        });\n      }\n      if (shouldAddUnloadTrigger(editor)) {\n        editor._beforeUnload = function () {\n          if (editor.initialized && !editor.destroyed && !editor.isHidden()) {\n            editor.save({\n              format: 'raw',\n              no_events: true,\n              set_dirty: false\n            });\n          }\n        };\n        editor.editorManager.on('BeforeUnload', editor._beforeUnload);\n      }\n      editor.editorManager.add(editor);\n      loadScripts(editor, editor.suffix);\n    };\n\n    var addVisual$1 = function (editor, elm) {\n      return addVisual(editor, elm);\n    };\n\n    var legacyPropNames = {\n      'font-size': 'size',\n      'font-family': 'face'\n    };\n    var getSpecifiedFontProp = function (propName, rootElm, elm) {\n      var getProperty = function (elm) {\n        return getRaw(elm, propName).orThunk(function () {\n          if (name(elm) === 'font') {\n            return get$1(legacyPropNames, propName).bind(function (legacyPropName) {\n              return getOpt(elm, legacyPropName);\n            });\n          } else {\n            return Optional.none();\n          }\n        });\n      };\n      var isRoot = function (elm) {\n        return eq$2(SugarElement.fromDom(rootElm), elm);\n      };\n      return closest$2(SugarElement.fromDom(elm), function (elm) {\n        return getProperty(elm);\n      }, isRoot);\n    };\n    var normalizeFontFamily = function (fontFamily) {\n      return fontFamily.replace(/[\\'\\\"\\\\]/g, '').replace(/,\\s+/g, ',');\n    };\n    var getComputedFontProp = function (propName, elm) {\n      return Optional.from(DOMUtils$1.DOM.getStyle(elm, propName, true));\n    };\n    var getFontProp = function (propName) {\n      return function (rootElm, elm) {\n        return Optional.from(elm).map(SugarElement.fromDom).filter(isElement).bind(function (element) {\n          return getSpecifiedFontProp(propName, rootElm, element.dom).or(getComputedFontProp(propName, element.dom));\n        }).getOr('');\n      };\n    };\n    var getFontSize = getFontProp('font-size');\n    var getFontFamily = compose(normalizeFontFamily, getFontProp('font-family'));\n\n    var findFirstCaretElement = function (editor) {\n      return firstPositionIn(editor.getBody()).map(function (caret) {\n        var container = caret.container();\n        return isText$1(container) ? container.parentNode : container;\n      });\n    };\n    var getCaretElement = function (editor) {\n      return Optional.from(editor.selection.getRng()).bind(function (rng) {\n        var root = editor.getBody();\n        var atStartOfNode = rng.startContainer === root && rng.startOffset === 0;\n        return atStartOfNode ? Optional.none() : Optional.from(editor.selection.getStart(true));\n      });\n    };\n    var mapRange = function (editor, mapper) {\n      return getCaretElement(editor).orThunk(curry(findFirstCaretElement, editor)).map(SugarElement.fromDom).filter(isElement).map(mapper);\n    };\n\n    var fromFontSizeNumber = function (editor, value) {\n      if (/^[0-9.]+$/.test(value)) {\n        var fontSizeNumber = parseInt(value, 10);\n        if (fontSizeNumber >= 1 && fontSizeNumber <= 7) {\n          var fontSizes = getFontStyleValues(editor);\n          var fontClasses = getFontSizeClasses(editor);\n          if (fontClasses) {\n            return fontClasses[fontSizeNumber - 1] || value;\n          } else {\n            return fontSizes[fontSizeNumber - 1] || value;\n          }\n        } else {\n          return value;\n        }\n      } else {\n        return value;\n      }\n    };\n    var normalizeFontNames = function (font) {\n      var fonts = font.split(/\\s*,\\s*/);\n      return map(fonts, function (font) {\n        if (font.indexOf(' ') !== -1 && !(startsWith(font, '\"') || startsWith(font, '\\''))) {\n          return '\\'' + font + '\\'';\n        } else {\n          return font;\n        }\n      }).join(',');\n    };\n    var fontNameAction = function (editor, value) {\n      var font = fromFontSizeNumber(editor, value);\n      editor.formatter.toggle('fontname', { value: normalizeFontNames(font) });\n      editor.nodeChanged();\n    };\n    var fontNameQuery = function (editor) {\n      return mapRange(editor, function (elm) {\n        return getFontFamily(editor.getBody(), elm.dom);\n      }).getOr('');\n    };\n    var fontSizeAction = function (editor, value) {\n      editor.formatter.toggle('fontsize', { value: fromFontSizeNumber(editor, value) });\n      editor.nodeChanged();\n    };\n    var fontSizeQuery = function (editor) {\n      return mapRange(editor, function (elm) {\n        return getFontSize(editor.getBody(), elm.dom);\n      }).getOr('');\n    };\n\n    var lineHeightQuery = function (editor) {\n      return mapRange(editor, function (elm) {\n        var root = SugarElement.fromDom(editor.getBody());\n        var specifiedStyle = closest$2(elm, function (elm) {\n          return getRaw(elm, 'line-height');\n        }, curry(eq$2, root));\n        var computedStyle = function () {\n          var lineHeight = parseFloat(get$5(elm, 'line-height'));\n          var fontSize = parseFloat(get$5(elm, 'font-size'));\n          return String(lineHeight / fontSize);\n        };\n        return specifiedStyle.getOrThunk(computedStyle);\n      }).getOr('');\n    };\n    var lineHeightAction = function (editor, lineHeight) {\n      editor.undoManager.transact(function () {\n        editor.formatter.toggle('lineheight', { value: String(lineHeight) });\n        editor.nodeChanged();\n      });\n    };\n\n    var processValue = function (value) {\n      var details;\n      if (typeof value !== 'string') {\n        details = Tools.extend({\n          paste: value.paste,\n          data: { paste: value.paste }\n        }, value);\n        return {\n          content: value.content,\n          details: details\n        };\n      }\n      return {\n        content: value,\n        details: {}\n      };\n    };\n    var insertAtCaret$1 = function (editor, value) {\n      var result = processValue(value);\n      insertContent(editor, result.content, result.details);\n    };\n\n    var each$f = Tools.each;\n    var map$3 = Tools.map, inArray$2 = Tools.inArray;\n    var EditorCommands = function () {\n      function EditorCommands(editor) {\n        this.commands = {\n          state: {},\n          exec: {},\n          value: {}\n        };\n        this.editor = editor;\n        this.setupCommands(editor);\n      }\n      EditorCommands.prototype.execCommand = function (command, ui, value, args) {\n        var func, state = false;\n        var self = this;\n        if (self.editor.removed) {\n          return;\n        }\n        if (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command) && (!args || !args.skip_focus)) {\n          self.editor.focus();\n        } else {\n          restore(self.editor);\n        }\n        args = self.editor.fire('BeforeExecCommand', {\n          command: command,\n          ui: ui,\n          value: value\n        });\n        if (args.isDefaultPrevented()) {\n          return false;\n        }\n        var customCommand = command.toLowerCase();\n        if (func = self.commands.exec[customCommand]) {\n          func(customCommand, ui, value);\n          self.editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          return true;\n        }\n        each$f(this.editor.plugins, function (p) {\n          if (p.execCommand && p.execCommand(command, ui, value)) {\n            self.editor.fire('ExecCommand', {\n              command: command,\n              ui: ui,\n              value: value\n            });\n            state = true;\n            return false;\n          }\n        });\n        if (state) {\n          return state;\n        }\n        if (self.editor.theme && self.editor.theme.execCommand && self.editor.theme.execCommand(command, ui, value)) {\n          self.editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          return true;\n        }\n        try {\n          state = self.editor.getDoc().execCommand(command, ui, value);\n        } catch (ex) {\n        }\n        if (state) {\n          self.editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          return true;\n        }\n        return false;\n      };\n      EditorCommands.prototype.queryCommandState = function (command) {\n        var func;\n        if (this.editor.quirks.isHidden() || this.editor.removed) {\n          return;\n        }\n        command = command.toLowerCase();\n        if (func = this.commands.state[command]) {\n          return func(command);\n        }\n        try {\n          return this.editor.getDoc().queryCommandState(command);\n        } catch (ex) {\n        }\n        return false;\n      };\n      EditorCommands.prototype.queryCommandValue = function (command) {\n        var func;\n        if (this.editor.quirks.isHidden() || this.editor.removed) {\n          return;\n        }\n        command = command.toLowerCase();\n        if (func = this.commands.value[command]) {\n          return func(command);\n        }\n        try {\n          return this.editor.getDoc().queryCommandValue(command);\n        } catch (ex) {\n        }\n      };\n      EditorCommands.prototype.addCommands = function (commandList, type) {\n        if (type === void 0) {\n          type = 'exec';\n        }\n        var self = this;\n        each$f(commandList, function (callback, command) {\n          each$f(command.toLowerCase().split(','), function (command) {\n            self.commands[type][command] = callback;\n          });\n        });\n      };\n      EditorCommands.prototype.addCommand = function (command, callback, scope) {\n        var _this = this;\n        command = command.toLowerCase();\n        this.commands.exec[command] = function (command, ui, value, args) {\n          return callback.call(scope || _this.editor, ui, value, args);\n        };\n      };\n      EditorCommands.prototype.queryCommandSupported = function (command) {\n        command = command.toLowerCase();\n        if (this.commands.exec[command]) {\n          return true;\n        }\n        try {\n          return this.editor.getDoc().queryCommandSupported(command);\n        } catch (ex) {\n        }\n        return false;\n      };\n      EditorCommands.prototype.addQueryStateHandler = function (command, callback, scope) {\n        var _this = this;\n        command = command.toLowerCase();\n        this.commands.state[command] = function () {\n          return callback.call(scope || _this.editor);\n        };\n      };\n      EditorCommands.prototype.addQueryValueHandler = function (command, callback, scope) {\n        var _this = this;\n        command = command.toLowerCase();\n        this.commands.value[command] = function () {\n          return callback.call(scope || _this.editor);\n        };\n      };\n      EditorCommands.prototype.hasCustomCommand = function (command) {\n        command = command.toLowerCase();\n        return !!this.commands.exec[command];\n      };\n      EditorCommands.prototype.execNativeCommand = function (command, ui, value) {\n        if (ui === undefined) {\n          ui = false;\n        }\n        if (value === undefined) {\n          value = null;\n        }\n        return this.editor.getDoc().execCommand(command, ui, value);\n      };\n      EditorCommands.prototype.isFormatMatch = function (name) {\n        return this.editor.formatter.match(name);\n      };\n      EditorCommands.prototype.toggleFormat = function (name, value) {\n        this.editor.formatter.toggle(name, value ? { value: value } : undefined);\n        this.editor.nodeChanged();\n      };\n      EditorCommands.prototype.storeSelection = function (type) {\n        this.selectionBookmark = this.editor.selection.getBookmark(type);\n      };\n      EditorCommands.prototype.restoreSelection = function () {\n        this.editor.selection.moveToBookmark(this.selectionBookmark);\n      };\n      EditorCommands.prototype.setupCommands = function (editor) {\n        var self = this;\n        this.addCommands({\n          'mceResetDesignMode,mceBeginUndoLevel': function () {\n          },\n          'mceEndUndoLevel,mceAddUndoLevel': function () {\n            editor.undoManager.add();\n          },\n          'Cut,Copy,Paste': function (command) {\n            var doc = editor.getDoc();\n            var failed;\n            try {\n              self.execNativeCommand(command);\n            } catch (ex) {\n              failed = true;\n            }\n            if (command === 'paste' && !doc.queryCommandEnabled(command)) {\n              failed = true;\n            }\n            if (failed || !doc.queryCommandSupported(command)) {\n              var msg = editor.translate('Your browser doesn\\'t support direct access to the clipboard. ' + 'Please use the Ctrl+X/C/V keyboard shortcuts instead.');\n              if (Env.mac) {\n                msg = msg.replace(/Ctrl\\+/g, '\\u2318+');\n              }\n              editor.notificationManager.open({\n                text: msg,\n                type: 'error'\n              });\n            }\n          },\n          'unlink': function () {\n            if (editor.selection.isCollapsed()) {\n              var elm = editor.dom.getParent(editor.selection.getStart(), 'a');\n              if (elm) {\n                editor.dom.remove(elm, true);\n              }\n              return;\n            }\n            editor.formatter.remove('link');\n          },\n          'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone': function (command) {\n            var align = command.substring(7);\n            if (align === 'full') {\n              align = 'justify';\n            }\n            each$f('left,center,right,justify'.split(','), function (name) {\n              if (align !== name) {\n                editor.formatter.remove('align' + name);\n              }\n            });\n            if (align !== 'none') {\n              self.toggleFormat('align' + align);\n            }\n          },\n          'InsertUnorderedList,InsertOrderedList': function (command) {\n            var listParent;\n            self.execNativeCommand(command);\n            var listElm = editor.dom.getParent(editor.selection.getNode(), 'ol,ul');\n            if (listElm) {\n              listParent = listElm.parentNode;\n              if (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\n                self.storeSelection();\n                editor.dom.split(listParent, listElm);\n                self.restoreSelection();\n              }\n            }\n          },\n          'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\n            self.toggleFormat(command);\n          },\n          'ForeColor,HiliteColor': function (command, ui, value) {\n            self.toggleFormat(command, value);\n          },\n          'FontName': function (command, ui, value) {\n            fontNameAction(editor, value);\n          },\n          'FontSize': function (command, ui, value) {\n            fontSizeAction(editor, value);\n          },\n          'LineHeight': function (command, ui, value) {\n            lineHeightAction(editor, value);\n          },\n          'RemoveFormat': function (command) {\n            editor.formatter.remove(command);\n          },\n          'mceBlockQuote': function () {\n            self.toggleFormat('blockquote');\n          },\n          'FormatBlock': function (command, ui, value) {\n            return self.toggleFormat(value || 'p');\n          },\n          'mceCleanup': function () {\n            var bookmark = editor.selection.getBookmark();\n            editor.setContent(editor.getContent());\n            editor.selection.moveToBookmark(bookmark);\n          },\n          'mceRemoveNode': function (command, ui, value) {\n            var node = value || editor.selection.getNode();\n            if (node !== editor.getBody()) {\n              self.storeSelection();\n              editor.dom.remove(node, true);\n              self.restoreSelection();\n            }\n          },\n          'mceSelectNodeDepth': function (command, ui, value) {\n            var counter = 0;\n            editor.dom.getParent(editor.selection.getNode(), function (node) {\n              if (node.nodeType === 1 && counter++ === value) {\n                editor.selection.select(node);\n                return false;\n              }\n            }, editor.getBody());\n          },\n          'mceSelectNode': function (command, ui, value) {\n            editor.selection.select(value);\n          },\n          'mceInsertContent': function (command, ui, value) {\n            insertAtCaret$1(editor, value);\n          },\n          'mceInsertRawHTML': function (command, ui, value) {\n            editor.selection.setContent('tiny_mce_marker');\n            var content = editor.getContent();\n            editor.setContent(content.replace(/tiny_mce_marker/g, function () {\n              return value;\n            }));\n          },\n          'mceInsertNewLine': function (command, ui, value) {\n            insert$3(editor, value);\n          },\n          'mceToggleFormat': function (command, ui, value) {\n            self.toggleFormat(value);\n          },\n          'mceSetContent': function (command, ui, value) {\n            editor.setContent(value);\n          },\n          'Indent,Outdent': function (command) {\n            handle(editor, command);\n          },\n          'mceRepaint': function () {\n          },\n          'InsertHorizontalRule': function () {\n            editor.execCommand('mceInsertContent', false, '<hr />');\n          },\n          'mceToggleVisualAid': function () {\n            editor.hasVisual = !editor.hasVisual;\n            editor.addVisual();\n          },\n          'mceReplaceContent': function (command, ui, value) {\n            editor.execCommand('mceInsertContent', false, value.replace(/\\{\\$selection\\}/g, editor.selection.getContent({ format: 'text' })));\n          },\n          'mceInsertLink': function (command, ui, value) {\n            if (typeof value === 'string') {\n              value = { href: value };\n            }\n            var anchor = editor.dom.getParent(editor.selection.getNode(), 'a');\n            value.href = value.href.replace(/ /g, '%20');\n            if (!anchor || !value.href) {\n              editor.formatter.remove('link');\n            }\n            if (value.href) {\n              editor.formatter.apply('link', value, anchor);\n            }\n          },\n          'selectAll': function () {\n            var editingHost = editor.dom.getParent(editor.selection.getStart(), isContentEditableTrue);\n            if (editingHost) {\n              var rng = editor.dom.createRng();\n              rng.selectNodeContents(editingHost);\n              editor.selection.setRng(rng);\n            }\n          },\n          'mceNewDocument': function () {\n            editor.setContent('');\n          },\n          'InsertLineBreak': function (command, ui, value) {\n            insert$2(editor, value);\n            return true;\n          }\n        });\n        var alignStates = function (name) {\n          return function () {\n            var selection = editor.selection;\n            var nodes = selection.isCollapsed() ? [editor.dom.getParent(selection.getNode(), editor.dom.isBlock)] : selection.getSelectedBlocks();\n            var matches = map$3(nodes, function (node) {\n              return !!editor.formatter.matchNode(node, name);\n            });\n            return inArray$2(matches, true) !== -1;\n          };\n        };\n        self.addCommands({\n          'JustifyLeft': alignStates('alignleft'),\n          'JustifyCenter': alignStates('aligncenter'),\n          'JustifyRight': alignStates('alignright'),\n          'JustifyFull': alignStates('alignjustify'),\n          'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\n            return self.isFormatMatch(command);\n          },\n          'mceBlockQuote': function () {\n            return self.isFormatMatch('blockquote');\n          },\n          'Outdent': function () {\n            return canOutdent(editor);\n          },\n          'InsertUnorderedList,InsertOrderedList': function (command) {\n            var list = editor.dom.getParent(editor.selection.getNode(), 'ul,ol');\n            return list && (command === 'insertunorderedlist' && list.tagName === 'UL' || command === 'insertorderedlist' && list.tagName === 'OL');\n          }\n        }, 'state');\n        self.addCommands({\n          Undo: function () {\n            editor.undoManager.undo();\n          },\n          Redo: function () {\n            editor.undoManager.redo();\n          }\n        });\n        self.addQueryValueHandler('FontName', function () {\n          return fontNameQuery(editor);\n        }, this);\n        self.addQueryValueHandler('FontSize', function () {\n          return fontSizeQuery(editor);\n        }, this);\n        self.addQueryValueHandler('LineHeight', function () {\n          return lineHeightQuery(editor);\n        }, this);\n      };\n      return EditorCommands;\n    }();\n\n    var internalContentEditableAttr = 'data-mce-contenteditable';\n    var toggleClass = function (elm, cls, state) {\n      if (has$2(elm, cls) && state === false) {\n        remove$4(elm, cls);\n      } else if (state) {\n        add$3(elm, cls);\n      }\n    };\n    var setEditorCommandState = function (editor, cmd, state) {\n      try {\n        editor.getDoc().execCommand(cmd, false, String(state));\n      } catch (ex) {\n      }\n    };\n    var setContentEditable = function (elm, state) {\n      elm.dom.contentEditable = state ? 'true' : 'false';\n    };\n    var switchOffContentEditableTrue = function (elm) {\n      each(descendants$1(elm, '*[contenteditable=\"true\"]'), function (elm) {\n        set(elm, internalContentEditableAttr, 'true');\n        setContentEditable(elm, false);\n      });\n    };\n    var switchOnContentEditableTrue = function (elm) {\n      each(descendants$1(elm, '*[' + internalContentEditableAttr + '=\"true\"]'), function (elm) {\n        remove$1(elm, internalContentEditableAttr);\n        setContentEditable(elm, true);\n      });\n    };\n    var removeFakeSelection = function (editor) {\n      Optional.from(editor.selection.getNode()).each(function (elm) {\n        elm.removeAttribute('data-mce-selected');\n      });\n    };\n    var restoreFakeSelection = function (editor) {\n      editor.selection.setRng(editor.selection.getRng());\n    };\n    var toggleReadOnly = function (editor, state) {\n      var body = SugarElement.fromDom(editor.getBody());\n      toggleClass(body, 'mce-content-readonly', state);\n      if (state) {\n        editor.selection.controlSelection.hideResizeRect();\n        editor._selectionOverrides.hideFakeCaret();\n        removeFakeSelection(editor);\n        editor.readonly = true;\n        setContentEditable(body, false);\n        switchOffContentEditableTrue(body);\n      } else {\n        editor.readonly = false;\n        setContentEditable(body, true);\n        switchOnContentEditableTrue(body);\n        setEditorCommandState(editor, 'StyleWithCSS', false);\n        setEditorCommandState(editor, 'enableInlineTableEditing', false);\n        setEditorCommandState(editor, 'enableObjectResizing', false);\n        if (hasEditorOrUiFocus(editor)) {\n          editor.focus();\n        }\n        restoreFakeSelection(editor);\n        editor.nodeChanged();\n      }\n    };\n    var isReadOnly$1 = function (editor) {\n      return editor.readonly;\n    };\n    var registerFilters = function (editor) {\n      editor.parser.addAttributeFilter('contenteditable', function (nodes) {\n        if (isReadOnly$1(editor)) {\n          each(nodes, function (node) {\n            node.attr(internalContentEditableAttr, node.attr('contenteditable'));\n            node.attr('contenteditable', 'false');\n          });\n        }\n      });\n      editor.serializer.addAttributeFilter(internalContentEditableAttr, function (nodes) {\n        if (isReadOnly$1(editor)) {\n          each(nodes, function (node) {\n            node.attr('contenteditable', node.attr(internalContentEditableAttr));\n          });\n        }\n      });\n      editor.serializer.addTempAttr(internalContentEditableAttr);\n    };\n    var registerReadOnlyContentFilters = function (editor) {\n      if (editor.serializer) {\n        registerFilters(editor);\n      } else {\n        editor.on('PreInit', function () {\n          registerFilters(editor);\n        });\n      }\n    };\n    var isClickEvent = function (e) {\n      return e.type === 'click';\n    };\n    var getAnchorHrefOpt = function (editor, elm) {\n      var isRoot = function (elm) {\n        return eq$2(elm, SugarElement.fromDom(editor.getBody()));\n      };\n      return closest$1(elm, 'a', isRoot).bind(function (a) {\n        return getOpt(a, 'href');\n      });\n    };\n    var processReadonlyEvents = function (editor, e) {\n      if (isClickEvent(e) && !VK.metaKeyPressed(e)) {\n        var elm = SugarElement.fromDom(e.target);\n        getAnchorHrefOpt(editor, elm).each(function (href) {\n          e.preventDefault();\n          if (/^#/.test(href)) {\n            var targetEl = editor.dom.select(href + ',[name=\"' + removeLeading(href, '#') + '\"]');\n            if (targetEl.length) {\n              editor.selection.scrollIntoView(targetEl[0], true);\n            }\n          } else {\n            window.open(href, '_blank', 'rel=noopener noreferrer,menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,scrollbars=yes');\n          }\n        });\n      }\n    };\n    var registerReadOnlySelectionBlockers = function (editor) {\n      editor.on('ShowCaret', function (e) {\n        if (isReadOnly$1(editor)) {\n          e.preventDefault();\n        }\n      });\n      editor.on('ObjectSelected', function (e) {\n        if (isReadOnly$1(editor)) {\n          e.preventDefault();\n        }\n      });\n    };\n\n    var nativeEvents = Tools.makeMap('focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange ' + 'mouseout mouseenter mouseleave wheel keydown keypress keyup input beforeinput contextmenu dragstart dragend dragover ' + 'draggesture dragdrop drop drag submit ' + 'compositionstart compositionend compositionupdate touchstart touchmove touchend touchcancel', ' ');\n    var EventDispatcher = function () {\n      function EventDispatcher(settings) {\n        this.bindings = {};\n        this.settings = settings || {};\n        this.scope = this.settings.scope || this;\n        this.toggleEvent = this.settings.toggleEvent || never;\n      }\n      EventDispatcher.isNative = function (name) {\n        return !!nativeEvents[name.toLowerCase()];\n      };\n      EventDispatcher.prototype.fire = function (nameIn, argsIn) {\n        var name = nameIn.toLowerCase();\n        var args = argsIn || {};\n        args.type = name;\n        if (!args.target) {\n          args.target = this.scope;\n        }\n        if (!args.preventDefault) {\n          args.preventDefault = function () {\n            args.isDefaultPrevented = always;\n          };\n          args.stopPropagation = function () {\n            args.isPropagationStopped = always;\n          };\n          args.stopImmediatePropagation = function () {\n            args.isImmediatePropagationStopped = always;\n          };\n          args.isDefaultPrevented = never;\n          args.isPropagationStopped = never;\n          args.isImmediatePropagationStopped = never;\n        }\n        if (this.settings.beforeFire) {\n          this.settings.beforeFire(args);\n        }\n        var handlers = this.bindings[name];\n        if (handlers) {\n          for (var i = 0, l = handlers.length; i < l; i++) {\n            var callback = handlers[i];\n            if (callback.once) {\n              this.off(name, callback.func);\n            }\n            if (args.isImmediatePropagationStopped()) {\n              args.stopPropagation();\n              return args;\n            }\n            if (callback.func.call(this.scope, args) === false) {\n              args.preventDefault();\n              return args;\n            }\n          }\n        }\n        return args;\n      };\n      EventDispatcher.prototype.on = function (name, callback, prepend, extra) {\n        if (callback === false) {\n          callback = never;\n        }\n        if (callback) {\n          var wrappedCallback = { func: callback };\n          if (extra) {\n            Tools.extend(wrappedCallback, extra);\n          }\n          var names = name.toLowerCase().split(' ');\n          var i = names.length;\n          while (i--) {\n            var currentName = names[i];\n            var handlers = this.bindings[currentName];\n            if (!handlers) {\n              handlers = this.bindings[currentName] = [];\n              this.toggleEvent(currentName, true);\n            }\n            if (prepend) {\n              handlers.unshift(wrappedCallback);\n            } else {\n              handlers.push(wrappedCallback);\n            }\n          }\n        }\n        return this;\n      };\n      EventDispatcher.prototype.off = function (name, callback) {\n        var _this = this;\n        if (name) {\n          var names = name.toLowerCase().split(' ');\n          var i = names.length;\n          while (i--) {\n            var currentName = names[i];\n            var handlers = this.bindings[currentName];\n            if (!currentName) {\n              each$1(this.bindings, function (_value, bindingName) {\n                _this.toggleEvent(bindingName, false);\n                delete _this.bindings[bindingName];\n              });\n              return this;\n            }\n            if (handlers) {\n              if (!callback) {\n                handlers.length = 0;\n              } else {\n                var hi = handlers.length;\n                while (hi--) {\n                  if (handlers[hi].func === callback) {\n                    handlers = handlers.slice(0, hi).concat(handlers.slice(hi + 1));\n                    this.bindings[currentName] = handlers;\n                  }\n                }\n              }\n              if (!handlers.length) {\n                this.toggleEvent(name, false);\n                delete this.bindings[currentName];\n              }\n            }\n          }\n        } else {\n          each$1(this.bindings, function (_value, name) {\n            _this.toggleEvent(name, false);\n          });\n          this.bindings = {};\n        }\n        return this;\n      };\n      EventDispatcher.prototype.once = function (name, callback, prepend) {\n        return this.on(name, callback, prepend, { once: true });\n      };\n      EventDispatcher.prototype.has = function (name) {\n        name = name.toLowerCase();\n        return !(!this.bindings[name] || this.bindings[name].length === 0);\n      };\n      return EventDispatcher;\n    }();\n\n    var getEventDispatcher = function (obj) {\n      if (!obj._eventDispatcher) {\n        obj._eventDispatcher = new EventDispatcher({\n          scope: obj,\n          toggleEvent: function (name, state) {\n            if (EventDispatcher.isNative(name) && obj.toggleNativeEvent) {\n              obj.toggleNativeEvent(name, state);\n            }\n          }\n        });\n      }\n      return obj._eventDispatcher;\n    };\n    var Observable = {\n      fire: function (name, args, bubble) {\n        var self = this;\n        if (self.removed && name !== 'remove' && name !== 'detach') {\n          return args;\n        }\n        var dispatcherArgs = getEventDispatcher(self).fire(name, args);\n        if (bubble !== false && self.parent) {\n          var parent_1 = self.parent();\n          while (parent_1 && !dispatcherArgs.isPropagationStopped()) {\n            parent_1.fire(name, dispatcherArgs, false);\n            parent_1 = parent_1.parent();\n          }\n        }\n        return dispatcherArgs;\n      },\n      on: function (name, callback, prepend) {\n        return getEventDispatcher(this).on(name, callback, prepend);\n      },\n      off: function (name, callback) {\n        return getEventDispatcher(this).off(name, callback);\n      },\n      once: function (name, callback) {\n        return getEventDispatcher(this).once(name, callback);\n      },\n      hasEventListeners: function (name) {\n        return getEventDispatcher(this).has(name);\n      }\n    };\n\n    var DOM$8 = DOMUtils$1.DOM;\n    var customEventRootDelegates;\n    var getEventTarget = function (editor, eventName) {\n      if (eventName === 'selectionchange') {\n        return editor.getDoc();\n      }\n      if (!editor.inline && /^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)) {\n        return editor.getDoc().documentElement;\n      }\n      var eventRoot = getEventRoot(editor);\n      if (eventRoot) {\n        if (!editor.eventRoot) {\n          editor.eventRoot = DOM$8.select(eventRoot)[0];\n        }\n        return editor.eventRoot;\n      }\n      return editor.getBody();\n    };\n    var isListening = function (editor) {\n      return !editor.hidden && !isReadOnly$1(editor);\n    };\n    var fireEvent = function (editor, eventName, e) {\n      if (isListening(editor)) {\n        editor.fire(eventName, e);\n      } else if (isReadOnly$1(editor)) {\n        processReadonlyEvents(editor, e);\n      }\n    };\n    var bindEventDelegate = function (editor, eventName) {\n      var delegate;\n      if (!editor.delegates) {\n        editor.delegates = {};\n      }\n      if (editor.delegates[eventName] || editor.removed) {\n        return;\n      }\n      var eventRootElm = getEventTarget(editor, eventName);\n      if (getEventRoot(editor)) {\n        if (!customEventRootDelegates) {\n          customEventRootDelegates = {};\n          editor.editorManager.on('removeEditor', function () {\n            if (!editor.editorManager.activeEditor) {\n              if (customEventRootDelegates) {\n                each$1(customEventRootDelegates, function (_value, name) {\n                  editor.dom.unbind(getEventTarget(editor, name));\n                });\n                customEventRootDelegates = null;\n              }\n            }\n          });\n        }\n        if (customEventRootDelegates[eventName]) {\n          return;\n        }\n        delegate = function (e) {\n          var target = e.target;\n          var editors = editor.editorManager.get();\n          var i = editors.length;\n          while (i--) {\n            var body = editors[i].getBody();\n            if (body === target || DOM$8.isChildOf(target, body)) {\n              fireEvent(editors[i], eventName, e);\n            }\n          }\n        };\n        customEventRootDelegates[eventName] = delegate;\n        DOM$8.bind(eventRootElm, eventName, delegate);\n      } else {\n        delegate = function (e) {\n          fireEvent(editor, eventName, e);\n        };\n        DOM$8.bind(eventRootElm, eventName, delegate);\n        editor.delegates[eventName] = delegate;\n      }\n    };\n    var EditorObservable = __assign(__assign({}, Observable), {\n      bindPendingEventDelegates: function () {\n        var self = this;\n        Tools.each(self._pendingNativeEvents, function (name) {\n          bindEventDelegate(self, name);\n        });\n      },\n      toggleNativeEvent: function (name, state) {\n        var self = this;\n        if (name === 'focus' || name === 'blur') {\n          return;\n        }\n        if (state) {\n          if (self.initialized) {\n            bindEventDelegate(self, name);\n          } else {\n            if (!self._pendingNativeEvents) {\n              self._pendingNativeEvents = [name];\n            } else {\n              self._pendingNativeEvents.push(name);\n            }\n          }\n        } else if (self.initialized) {\n          self.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n          delete self.delegates[name];\n        }\n      },\n      unbindAllNativeEvents: function () {\n        var self = this;\n        var body = self.getBody();\n        var dom = self.dom;\n        if (self.delegates) {\n          each$1(self.delegates, function (value, name) {\n            self.dom.unbind(getEventTarget(self, name), name, value);\n          });\n          delete self.delegates;\n        }\n        if (!self.inline && body && dom) {\n          body.onload = null;\n          dom.unbind(self.getWin());\n          dom.unbind(self.getDoc());\n        }\n        if (dom) {\n          dom.unbind(body);\n          dom.unbind(self.getContainer());\n        }\n      }\n    });\n\n    var defaultModes = [\n      'design',\n      'readonly'\n    ];\n    var switchToMode = function (editor, activeMode, availableModes, mode) {\n      var oldMode = availableModes[activeMode.get()];\n      var newMode = availableModes[mode];\n      try {\n        newMode.activate();\n      } catch (e) {\n        console.error('problem while activating editor mode ' + mode + ':', e);\n        return;\n      }\n      oldMode.deactivate();\n      if (oldMode.editorReadOnly !== newMode.editorReadOnly) {\n        toggleReadOnly(editor, newMode.editorReadOnly);\n      }\n      activeMode.set(mode);\n      fireSwitchMode(editor, mode);\n    };\n    var setMode = function (editor, availableModes, activeMode, mode) {\n      if (mode === activeMode.get()) {\n        return;\n      } else if (!has(availableModes, mode)) {\n        throw new Error('Editor mode \\'' + mode + '\\' is invalid');\n      }\n      if (editor.initialized) {\n        switchToMode(editor, activeMode, availableModes, mode);\n      } else {\n        editor.on('init', function () {\n          return switchToMode(editor, activeMode, availableModes, mode);\n        });\n      }\n    };\n    var registerMode = function (availableModes, mode, api) {\n      var _a;\n      if (contains(defaultModes, mode)) {\n        throw new Error('Cannot override default mode ' + mode);\n      }\n      return __assign(__assign({}, availableModes), (_a = {}, _a[mode] = __assign(__assign({}, api), {\n        deactivate: function () {\n          try {\n            api.deactivate();\n          } catch (e) {\n            console.error('problem while deactivating editor mode ' + mode + ':', e);\n          }\n        }\n      }), _a));\n    };\n\n    var create$5 = function (editor) {\n      var activeMode = Cell('design');\n      var availableModes = Cell({\n        design: {\n          activate: noop,\n          deactivate: noop,\n          editorReadOnly: false\n        },\n        readonly: {\n          activate: noop,\n          deactivate: noop,\n          editorReadOnly: true\n        }\n      });\n      registerReadOnlyContentFilters(editor);\n      registerReadOnlySelectionBlockers(editor);\n      return {\n        isReadOnly: function () {\n          return isReadOnly$1(editor);\n        },\n        set: function (mode) {\n          return setMode(editor, availableModes.get(), activeMode, mode);\n        },\n        get: function () {\n          return activeMode.get();\n        },\n        register: function (mode, api) {\n          availableModes.set(registerMode(availableModes.get(), mode, api));\n        }\n      };\n    };\n\n    var each$g = Tools.each, explode$3 = Tools.explode;\n    var keyCodeLookup = {\n      f1: 112,\n      f2: 113,\n      f3: 114,\n      f4: 115,\n      f5: 116,\n      f6: 117,\n      f7: 118,\n      f8: 119,\n      f9: 120,\n      f10: 121,\n      f11: 122,\n      f12: 123\n    };\n    var modifierNames = Tools.makeMap('alt,ctrl,shift,meta,access');\n    var Shortcuts = function () {\n      function Shortcuts(editor) {\n        this.shortcuts = {};\n        this.pendingPatterns = [];\n        this.editor = editor;\n        var self = this;\n        editor.on('keyup keypress keydown', function (e) {\n          if ((self.hasModifier(e) || self.isFunctionKey(e)) && !e.isDefaultPrevented()) {\n            each$g(self.shortcuts, function (shortcut) {\n              if (self.matchShortcut(e, shortcut)) {\n                self.pendingPatterns = shortcut.subpatterns.slice(0);\n                if (e.type === 'keydown') {\n                  self.executeShortcutAction(shortcut);\n                }\n                return true;\n              }\n            });\n            if (self.matchShortcut(e, self.pendingPatterns[0])) {\n              if (self.pendingPatterns.length === 1) {\n                if (e.type === 'keydown') {\n                  self.executeShortcutAction(self.pendingPatterns[0]);\n                }\n              }\n              self.pendingPatterns.shift();\n            }\n          }\n        });\n      }\n      Shortcuts.prototype.add = function (pattern, desc, cmdFunc, scope) {\n        var self = this;\n        var func = self.normalizeCommandFunc(cmdFunc);\n        each$g(explode$3(Tools.trim(pattern)), function (pattern) {\n          var shortcut = self.createShortcut(pattern, desc, func, scope);\n          self.shortcuts[shortcut.id] = shortcut;\n        });\n        return true;\n      };\n      Shortcuts.prototype.remove = function (pattern) {\n        var shortcut = this.createShortcut(pattern);\n        if (this.shortcuts[shortcut.id]) {\n          delete this.shortcuts[shortcut.id];\n          return true;\n        }\n        return false;\n      };\n      Shortcuts.prototype.normalizeCommandFunc = function (cmdFunc) {\n        var self = this;\n        var cmd = cmdFunc;\n        if (typeof cmd === 'string') {\n          return function () {\n            self.editor.execCommand(cmd, false, null);\n          };\n        } else if (Tools.isArray(cmd)) {\n          return function () {\n            self.editor.execCommand(cmd[0], cmd[1], cmd[2]);\n          };\n        } else {\n          return cmd;\n        }\n      };\n      Shortcuts.prototype.parseShortcut = function (pattern) {\n        var key;\n        var shortcut = {};\n        each$g(explode$3(pattern.toLowerCase(), '+'), function (value) {\n          if (value in modifierNames) {\n            shortcut[value] = true;\n          } else {\n            if (/^[0-9]{2,}$/.test(value)) {\n              shortcut.keyCode = parseInt(value, 10);\n            } else {\n              shortcut.charCode = value.charCodeAt(0);\n              shortcut.keyCode = keyCodeLookup[value] || value.toUpperCase().charCodeAt(0);\n            }\n          }\n        });\n        var id = [shortcut.keyCode];\n        for (key in modifierNames) {\n          if (shortcut[key]) {\n            id.push(key);\n          } else {\n            shortcut[key] = false;\n          }\n        }\n        shortcut.id = id.join(',');\n        if (shortcut.access) {\n          shortcut.alt = true;\n          if (Env.mac) {\n            shortcut.ctrl = true;\n          } else {\n            shortcut.shift = true;\n          }\n        }\n        if (shortcut.meta) {\n          if (Env.mac) {\n            shortcut.meta = true;\n          } else {\n            shortcut.ctrl = true;\n            shortcut.meta = false;\n          }\n        }\n        return shortcut;\n      };\n      Shortcuts.prototype.createShortcut = function (pattern, desc, cmdFunc, scope) {\n        var shortcuts = Tools.map(explode$3(pattern, '>'), this.parseShortcut);\n        shortcuts[shortcuts.length - 1] = Tools.extend(shortcuts[shortcuts.length - 1], {\n          func: cmdFunc,\n          scope: scope || this.editor\n        });\n        return Tools.extend(shortcuts[0], {\n          desc: this.editor.translate(desc),\n          subpatterns: shortcuts.slice(1)\n        });\n      };\n      Shortcuts.prototype.hasModifier = function (e) {\n        return e.altKey || e.ctrlKey || e.metaKey;\n      };\n      Shortcuts.prototype.isFunctionKey = function (e) {\n        return e.type === 'keydown' && e.keyCode >= 112 && e.keyCode <= 123;\n      };\n      Shortcuts.prototype.matchShortcut = function (e, shortcut) {\n        if (!shortcut) {\n          return false;\n        }\n        if (shortcut.ctrl !== e.ctrlKey || shortcut.meta !== e.metaKey) {\n          return false;\n        }\n        if (shortcut.alt !== e.altKey || shortcut.shift !== e.shiftKey) {\n          return false;\n        }\n        if (e.keyCode === shortcut.keyCode || e.charCode && e.charCode === shortcut.charCode) {\n          e.preventDefault();\n          return true;\n        }\n        return false;\n      };\n      Shortcuts.prototype.executeShortcutAction = function (shortcut) {\n        return shortcut.func ? shortcut.func.call(shortcut.scope) : null;\n      };\n      return Shortcuts;\n    }();\n\n    var create$6 = function () {\n      var buttons = {};\n      var menuItems = {};\n      var popups = {};\n      var icons = {};\n      var contextMenus = {};\n      var contextToolbars = {};\n      var sidebars = {};\n      var add = function (collection, type) {\n        return function (name, spec) {\n          return collection[name.toLowerCase()] = __assign(__assign({}, spec), { type: type });\n        };\n      };\n      var addIcon = function (name, svgData) {\n        return icons[name.toLowerCase()] = svgData;\n      };\n      return {\n        addButton: add(buttons, 'button'),\n        addGroupToolbarButton: add(buttons, 'grouptoolbarbutton'),\n        addToggleButton: add(buttons, 'togglebutton'),\n        addMenuButton: add(buttons, 'menubutton'),\n        addSplitButton: add(buttons, 'splitbutton'),\n        addMenuItem: add(menuItems, 'menuitem'),\n        addNestedMenuItem: add(menuItems, 'nestedmenuitem'),\n        addToggleMenuItem: add(menuItems, 'togglemenuitem'),\n        addAutocompleter: add(popups, 'autocompleter'),\n        addContextMenu: add(contextMenus, 'contextmenu'),\n        addContextToolbar: add(contextToolbars, 'contexttoolbar'),\n        addContextForm: add(contextToolbars, 'contextform'),\n        addSidebar: add(sidebars, 'sidebar'),\n        addIcon: addIcon,\n        getAll: function () {\n          return {\n            buttons: buttons,\n            menuItems: menuItems,\n            icons: icons,\n            popups: popups,\n            contextMenus: contextMenus,\n            contextToolbars: contextToolbars,\n            sidebars: sidebars\n          };\n        }\n      };\n    };\n\n    var registry = function () {\n      var bridge = create$6();\n      return {\n        addAutocompleter: bridge.addAutocompleter,\n        addButton: bridge.addButton,\n        addContextForm: bridge.addContextForm,\n        addContextMenu: bridge.addContextMenu,\n        addContextToolbar: bridge.addContextToolbar,\n        addIcon: bridge.addIcon,\n        addMenuButton: bridge.addMenuButton,\n        addMenuItem: bridge.addMenuItem,\n        addNestedMenuItem: bridge.addNestedMenuItem,\n        addSidebar: bridge.addSidebar,\n        addSplitButton: bridge.addSplitButton,\n        addToggleButton: bridge.addToggleButton,\n        addGroupToolbarButton: bridge.addGroupToolbarButton,\n        addToggleMenuItem: bridge.addToggleMenuItem,\n        getAll: bridge.getAll\n      };\n    };\n\n    var each$h = Tools.each, trim$4 = Tools.trim;\n    var queryParts = 'source protocol authority userInfo user password host port relative path directory file query anchor'.split(' ');\n    var DEFAULT_PORTS = {\n      ftp: 21,\n      http: 80,\n      https: 443,\n      mailto: 25\n    };\n    var URI = function () {\n      function URI(url, settings) {\n        url = trim$4(url);\n        this.settings = settings || {};\n        var baseUri = this.settings.base_uri;\n        var self = this;\n        if (/^([\\w\\-]+):([^\\/]{2})/i.test(url) || /^\\s*#/.test(url)) {\n          self.source = url;\n          return;\n        }\n        var isProtocolRelative = url.indexOf('//') === 0;\n        if (url.indexOf('/') === 0 && !isProtocolRelative) {\n          url = (baseUri ? baseUri.protocol || 'http' : 'http') + '://mce_host' + url;\n        }\n        if (!/^[\\w\\-]*:?\\/\\//.test(url)) {\n          var baseUrl = this.settings.base_uri ? this.settings.base_uri.path : new URI(document.location.href).directory;\n          if (this.settings.base_uri && this.settings.base_uri.protocol == '') {\n            url = '//mce_host' + self.toAbsPath(baseUrl, url);\n          } else {\n            var match = /([^#?]*)([#?]?.*)/.exec(url);\n            url = (baseUri && baseUri.protocol || 'http') + '://mce_host' + self.toAbsPath(baseUrl, match[1]) + match[2];\n          }\n        }\n        url = url.replace(/@@/g, '(mce_at)');\n        var urlMatch = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(url);\n        each$h(queryParts, function (v, i) {\n          var part = urlMatch[i];\n          if (part) {\n            part = part.replace(/\\(mce_at\\)/g, '@@');\n          }\n          self[v] = part;\n        });\n        if (baseUri) {\n          if (!self.protocol) {\n            self.protocol = baseUri.protocol;\n          }\n          if (!self.userInfo) {\n            self.userInfo = baseUri.userInfo;\n          }\n          if (!self.port && self.host === 'mce_host') {\n            self.port = baseUri.port;\n          }\n          if (!self.host || self.host === 'mce_host') {\n            self.host = baseUri.host;\n          }\n          self.source = '';\n        }\n        if (isProtocolRelative) {\n          self.protocol = '';\n        }\n      }\n      URI.parseDataUri = function (uri) {\n        var type;\n        var uriComponents = decodeURIComponent(uri).split(',');\n        var matches = /data:([^;]+)/.exec(uriComponents[0]);\n        if (matches) {\n          type = matches[1];\n        }\n        return {\n          type: type,\n          data: uriComponents[1]\n        };\n      };\n      URI.getDocumentBaseUrl = function (loc) {\n        var baseUrl;\n        if (loc.protocol.indexOf('http') !== 0 && loc.protocol !== 'file:') {\n          baseUrl = loc.href;\n        } else {\n          baseUrl = loc.protocol + '//' + loc.host + loc.pathname;\n        }\n        if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(baseUrl)) {\n          baseUrl = baseUrl.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n          if (!/[\\/\\\\]$/.test(baseUrl)) {\n            baseUrl += '/';\n          }\n        }\n        return baseUrl;\n      };\n      URI.prototype.setPath = function (path) {\n        var pathMatch = /^(.*?)\\/?(\\w+)?$/.exec(path);\n        this.path = pathMatch[0];\n        this.directory = pathMatch[1];\n        this.file = pathMatch[2];\n        this.source = '';\n        this.getURI();\n      };\n      URI.prototype.toRelative = function (uri) {\n        var output;\n        if (uri === './') {\n          return uri;\n        }\n        var relativeUri = new URI(uri, { base_uri: this });\n        if (relativeUri.host !== 'mce_host' && this.host !== relativeUri.host && relativeUri.host || this.port !== relativeUri.port || this.protocol !== relativeUri.protocol && relativeUri.protocol !== '') {\n          return relativeUri.getURI();\n        }\n        var tu = this.getURI(), uu = relativeUri.getURI();\n        if (tu === uu || tu.charAt(tu.length - 1) === '/' && tu.substr(0, tu.length - 1) === uu) {\n          return tu;\n        }\n        output = this.toRelPath(this.path, relativeUri.path);\n        if (relativeUri.query) {\n          output += '?' + relativeUri.query;\n        }\n        if (relativeUri.anchor) {\n          output += '#' + relativeUri.anchor;\n        }\n        return output;\n      };\n      URI.prototype.toAbsolute = function (uri, noHost) {\n        var absoluteUri = new URI(uri, { base_uri: this });\n        return absoluteUri.getURI(noHost && this.isSameOrigin(absoluteUri));\n      };\n      URI.prototype.isSameOrigin = function (uri) {\n        if (this.host == uri.host && this.protocol == uri.protocol) {\n          if (this.port == uri.port) {\n            return true;\n          }\n          var defaultPort = DEFAULT_PORTS[this.protocol];\n          if (defaultPort && (this.port || defaultPort) == (uri.port || defaultPort)) {\n            return true;\n          }\n        }\n        return false;\n      };\n      URI.prototype.toRelPath = function (base, path) {\n        var breakPoint = 0, out = '', i, l;\n        var normalizedBase = base.substring(0, base.lastIndexOf('/')).split('/');\n        var items = path.split('/');\n        if (normalizedBase.length >= items.length) {\n          for (i = 0, l = normalizedBase.length; i < l; i++) {\n            if (i >= items.length || normalizedBase[i] !== items[i]) {\n              breakPoint = i + 1;\n              break;\n            }\n          }\n        }\n        if (normalizedBase.length < items.length) {\n          for (i = 0, l = items.length; i < l; i++) {\n            if (i >= normalizedBase.length || normalizedBase[i] !== items[i]) {\n              breakPoint = i + 1;\n              break;\n            }\n          }\n        }\n        if (breakPoint === 1) {\n          return path;\n        }\n        for (i = 0, l = normalizedBase.length - (breakPoint - 1); i < l; i++) {\n          out += '../';\n        }\n        for (i = breakPoint - 1, l = items.length; i < l; i++) {\n          if (i !== breakPoint - 1) {\n            out += '/' + items[i];\n          } else {\n            out += items[i];\n          }\n        }\n        return out;\n      };\n      URI.prototype.toAbsPath = function (base, path) {\n        var i, nb = 0, o = [], outPath;\n        var tr = /\\/$/.test(path) ? '/' : '';\n        var normalizedBase = base.split('/');\n        var normalizedPath = path.split('/');\n        each$h(normalizedBase, function (k) {\n          if (k) {\n            o.push(k);\n          }\n        });\n        normalizedBase = o;\n        for (i = normalizedPath.length - 1, o = []; i >= 0; i--) {\n          if (normalizedPath[i].length === 0 || normalizedPath[i] === '.') {\n            continue;\n          }\n          if (normalizedPath[i] === '..') {\n            nb++;\n            continue;\n          }\n          if (nb > 0) {\n            nb--;\n            continue;\n          }\n          o.push(normalizedPath[i]);\n        }\n        i = normalizedBase.length - nb;\n        if (i <= 0) {\n          outPath = reverse(o).join('/');\n        } else {\n          outPath = normalizedBase.slice(0, i).join('/') + '/' + reverse(o).join('/');\n        }\n        if (outPath.indexOf('/') !== 0) {\n          outPath = '/' + outPath;\n        }\n        if (tr && outPath.lastIndexOf('/') !== outPath.length - 1) {\n          outPath += tr;\n        }\n        return outPath;\n      };\n      URI.prototype.getURI = function (noProtoHost) {\n        if (noProtoHost === void 0) {\n          noProtoHost = false;\n        }\n        var s;\n        if (!this.source || noProtoHost) {\n          s = '';\n          if (!noProtoHost) {\n            if (this.protocol) {\n              s += this.protocol + '://';\n            } else {\n              s += '//';\n            }\n            if (this.userInfo) {\n              s += this.userInfo + '@';\n            }\n            if (this.host) {\n              s += this.host;\n            }\n            if (this.port) {\n              s += ':' + this.port;\n            }\n          }\n          if (this.path) {\n            s += this.path;\n          }\n          if (this.query) {\n            s += '?' + this.query;\n          }\n          if (this.anchor) {\n            s += '#' + this.anchor;\n          }\n          this.source = s;\n        }\n        return this.source;\n      };\n      return URI;\n    }();\n\n    var DOM$9 = DOMUtils$1.DOM;\n    var extend$3 = Tools.extend, each$i = Tools.each;\n    var resolve$3 = Tools.resolve;\n    var ie$1 = Env.ie;\n    var Editor = function () {\n      function Editor(id, settings, editorManager) {\n        var _this = this;\n        this.plugins = {};\n        this.contentCSS = [];\n        this.contentStyles = [];\n        this.loadedCSS = {};\n        this.isNotDirty = false;\n        this.editorManager = editorManager;\n        this.documentBaseUrl = editorManager.documentBaseURL;\n        extend$3(this, EditorObservable);\n        this.settings = getEditorSettings(this, id, this.documentBaseUrl, editorManager.defaultSettings, settings);\n        if (this.settings.suffix) {\n          editorManager.suffix = this.settings.suffix;\n        }\n        this.suffix = editorManager.suffix;\n        if (this.settings.base_url) {\n          editorManager._setBaseUrl(this.settings.base_url);\n        }\n        this.baseUri = editorManager.baseURI;\n        if (this.settings.referrer_policy) {\n          ScriptLoader.ScriptLoader._setReferrerPolicy(this.settings.referrer_policy);\n          DOMUtils$1.DOM.styleSheetLoader._setReferrerPolicy(this.settings.referrer_policy);\n        }\n        AddOnManager$1.languageLoad = this.settings.language_load;\n        AddOnManager$1.baseURL = editorManager.baseURL;\n        this.id = id;\n        this.setDirty(false);\n        this.documentBaseURI = new URI(this.settings.document_base_url, { base_uri: this.baseUri });\n        this.baseURI = this.baseUri;\n        this.inline = !!this.settings.inline;\n        this.shortcuts = new Shortcuts(this);\n        this.editorCommands = new EditorCommands(this);\n        if (this.settings.cache_suffix) {\n          Env.cacheSuffix = this.settings.cache_suffix.replace(/^[\\?\\&]+/, '');\n        }\n        this.ui = {\n          registry: registry(),\n          styleSheetLoader: undefined,\n          show: noop,\n          hide: noop,\n          enable: noop,\n          disable: noop,\n          isDisabled: never\n        };\n        var self = this;\n        var modeInstance = create$5(self);\n        this.mode = modeInstance;\n        this.setMode = modeInstance.set;\n        editorManager.fire('SetupEditor', { editor: this });\n        this.execCallback('setup', this);\n        this.$ = DomQuery.overrideDefaults(function () {\n          return {\n            context: _this.inline ? _this.getBody() : _this.getDoc(),\n            element: _this.getBody()\n          };\n        });\n      }\n      Editor.prototype.render = function () {\n        render(this);\n      };\n      Editor.prototype.focus = function (skipFocus) {\n        focus$1(this, skipFocus);\n      };\n      Editor.prototype.hasFocus = function () {\n        return hasFocus$1(this);\n      };\n      Editor.prototype.execCallback = function (name) {\n        var x = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n          x[_i - 1] = arguments[_i];\n        }\n        var self = this;\n        var callback = self.settings[name], scope;\n        if (!callback) {\n          return;\n        }\n        if (self.callbackLookup && (scope = self.callbackLookup[name])) {\n          callback = scope.func;\n          scope = scope.scope;\n        }\n        if (typeof callback === 'string') {\n          scope = callback.replace(/\\.\\w+$/, '');\n          scope = scope ? resolve$3(scope) : 0;\n          callback = resolve$3(callback);\n          self.callbackLookup = self.callbackLookup || {};\n          self.callbackLookup[name] = {\n            func: callback,\n            scope: scope\n          };\n        }\n        return callback.apply(scope || self, x);\n      };\n      Editor.prototype.translate = function (text) {\n        return I18n.translate(text);\n      };\n      Editor.prototype.getParam = function (name, defaultVal, type) {\n        return getParam(this, name, defaultVal, type);\n      };\n      Editor.prototype.hasPlugin = function (name, loaded) {\n        var hasPlugin = contains(getPlugins(this).split(/[ ,]/), name);\n        if (hasPlugin) {\n          return loaded ? PluginManager.get(name) !== undefined : true;\n        } else {\n          return false;\n        }\n      };\n      Editor.prototype.nodeChanged = function (args) {\n        this._nodeChangeDispatcher.nodeChanged(args);\n      };\n      Editor.prototype.addCommand = function (name, callback, scope) {\n        this.editorCommands.addCommand(name, callback, scope);\n      };\n      Editor.prototype.addQueryStateHandler = function (name, callback, scope) {\n        this.editorCommands.addQueryStateHandler(name, callback, scope);\n      };\n      Editor.prototype.addQueryValueHandler = function (name, callback, scope) {\n        this.editorCommands.addQueryValueHandler(name, callback, scope);\n      };\n      Editor.prototype.addShortcut = function (pattern, desc, cmdFunc, scope) {\n        this.shortcuts.add(pattern, desc, cmdFunc, scope);\n      };\n      Editor.prototype.execCommand = function (cmd, ui, value, args) {\n        return this.editorCommands.execCommand(cmd, ui, value, args);\n      };\n      Editor.prototype.queryCommandState = function (cmd) {\n        return this.editorCommands.queryCommandState(cmd);\n      };\n      Editor.prototype.queryCommandValue = function (cmd) {\n        return this.editorCommands.queryCommandValue(cmd);\n      };\n      Editor.prototype.queryCommandSupported = function (cmd) {\n        return this.editorCommands.queryCommandSupported(cmd);\n      };\n      Editor.prototype.show = function () {\n        var self = this;\n        if (self.hidden) {\n          self.hidden = false;\n          if (self.inline) {\n            self.getBody().contentEditable = 'true';\n          } else {\n            DOM$9.show(self.getContainer());\n            DOM$9.hide(self.id);\n          }\n          self.load();\n          self.fire('show');\n        }\n      };\n      Editor.prototype.hide = function () {\n        var self = this, doc = self.getDoc();\n        if (!self.hidden) {\n          if (ie$1 && doc && !self.inline) {\n            doc.execCommand('SelectAll');\n          }\n          self.save();\n          if (self.inline) {\n            self.getBody().contentEditable = 'false';\n            if (self === self.editorManager.focusedEditor) {\n              self.editorManager.focusedEditor = null;\n            }\n          } else {\n            DOM$9.hide(self.getContainer());\n            DOM$9.setStyle(self.id, 'display', self.orgDisplay);\n          }\n          self.hidden = true;\n          self.fire('hide');\n        }\n      };\n      Editor.prototype.isHidden = function () {\n        return !!this.hidden;\n      };\n      Editor.prototype.setProgressState = function (state, time) {\n        this.fire('ProgressState', {\n          state: state,\n          time: time\n        });\n      };\n      Editor.prototype.load = function (args) {\n        var self = this;\n        var elm = self.getElement(), html;\n        if (self.removed) {\n          return '';\n        }\n        if (elm) {\n          args = args || {};\n          args.load = true;\n          var value = isTextareaOrInput(elm) ? elm.value : elm.innerHTML;\n          html = self.setContent(value, args);\n          args.element = elm;\n          if (!args.no_events) {\n            self.fire('LoadContent', args);\n          }\n          args.element = elm = null;\n          return html;\n        }\n      };\n      Editor.prototype.save = function (args) {\n        var self = this;\n        var elm = self.getElement(), html, form;\n        if (!elm || !self.initialized || self.removed) {\n          return;\n        }\n        args = args || {};\n        args.save = true;\n        args.element = elm;\n        html = args.content = self.getContent(args);\n        if (!args.no_events) {\n          self.fire('SaveContent', args);\n        }\n        if (args.format === 'raw') {\n          self.fire('RawSaveContent', args);\n        }\n        html = args.content;\n        if (!isTextareaOrInput(elm)) {\n          if (args.is_removing || !self.inline) {\n            elm.innerHTML = html;\n          }\n          if (form = DOM$9.getParent(self.id, 'form')) {\n            each$i(form.elements, function (elm) {\n              if (elm.name === self.id) {\n                elm.value = html;\n                return false;\n              }\n            });\n          }\n        } else {\n          elm.value = html;\n        }\n        args.element = elm = null;\n        if (args.set_dirty !== false) {\n          self.setDirty(false);\n        }\n        return html;\n      };\n      Editor.prototype.setContent = function (content, args) {\n        return setContent$2(this, content, args);\n      };\n      Editor.prototype.getContent = function (args) {\n        return getContent$2(this, args);\n      };\n      Editor.prototype.insertContent = function (content, args) {\n        if (args) {\n          content = extend$3({ content: content }, args);\n        }\n        this.execCommand('mceInsertContent', false, content);\n      };\n      Editor.prototype.resetContent = function (initialContent) {\n        if (initialContent === undefined) {\n          setContent$2(this, this.startContent, { format: 'raw' });\n        } else {\n          setContent$2(this, initialContent);\n        }\n        this.undoManager.reset();\n        this.setDirty(false);\n        this.nodeChanged();\n      };\n      Editor.prototype.isDirty = function () {\n        return !this.isNotDirty;\n      };\n      Editor.prototype.setDirty = function (state) {\n        var oldState = !this.isNotDirty;\n        this.isNotDirty = !state;\n        if (state && state !== oldState) {\n          this.fire('dirty');\n        }\n      };\n      Editor.prototype.getContainer = function () {\n        var self = this;\n        if (!self.container) {\n          self.container = DOM$9.get(self.editorContainer || self.id + '_parent');\n        }\n        return self.container;\n      };\n      Editor.prototype.getContentAreaContainer = function () {\n        return this.contentAreaContainer;\n      };\n      Editor.prototype.getElement = function () {\n        if (!this.targetElm) {\n          this.targetElm = DOM$9.get(this.id);\n        }\n        return this.targetElm;\n      };\n      Editor.prototype.getWin = function () {\n        var self = this;\n        var elm;\n        if (!self.contentWindow) {\n          elm = self.iframeElement;\n          if (elm) {\n            self.contentWindow = elm.contentWindow;\n          }\n        }\n        return self.contentWindow;\n      };\n      Editor.prototype.getDoc = function () {\n        var self = this;\n        var win;\n        if (!self.contentDocument) {\n          win = self.getWin();\n          if (win) {\n            self.contentDocument = win.document;\n          }\n        }\n        return self.contentDocument;\n      };\n      Editor.prototype.getBody = function () {\n        var doc = this.getDoc();\n        return this.bodyElement || (doc ? doc.body : null);\n      };\n      Editor.prototype.convertURL = function (url, name, elm) {\n        var self = this, settings = self.settings;\n        if (settings.urlconverter_callback) {\n          return self.execCallback('urlconverter_callback', url, elm, true, name);\n        }\n        if (!settings.convert_urls || elm && elm.nodeName === 'LINK' || url.indexOf('file:') === 0 || url.length === 0) {\n          return url;\n        }\n        if (settings.relative_urls) {\n          return self.documentBaseURI.toRelative(url);\n        }\n        url = self.documentBaseURI.toAbsolute(url, settings.remove_script_host);\n        return url;\n      };\n      Editor.prototype.addVisual = function (elm) {\n        addVisual$1(this, elm);\n      };\n      Editor.prototype.remove = function () {\n        remove$7(this);\n      };\n      Editor.prototype.destroy = function (automatic) {\n        destroy(this, automatic);\n      };\n      Editor.prototype.uploadImages = function (callback) {\n        return this.editorUpload.uploadImages(callback);\n      };\n      Editor.prototype._scanForImages = function () {\n        return this.editorUpload.scanForImages();\n      };\n      Editor.prototype.addButton = function () {\n        throw new Error('editor.addButton has been removed in tinymce 5x, use editor.ui.registry.addButton or editor.ui.registry.addToggleButton or editor.ui.registry.addSplitButton instead');\n      };\n      Editor.prototype.addSidebar = function () {\n        throw new Error('editor.addSidebar has been removed in tinymce 5x, use editor.ui.registry.addSidebar instead');\n      };\n      Editor.prototype.addMenuItem = function () {\n        throw new Error('editor.addMenuItem has been removed in tinymce 5x, use editor.ui.registry.addMenuItem instead');\n      };\n      Editor.prototype.addContextToolbar = function () {\n        throw new Error('editor.addContextToolbar has been removed in tinymce 5x, use editor.ui.registry.addContextToolbar instead');\n      };\n      return Editor;\n    }();\n\n    var DOM$a = DOMUtils$1.DOM;\n    var explode$4 = Tools.explode, each$j = Tools.each, extend$4 = Tools.extend;\n    var instanceCounter = 0, boundGlobalEvents = false;\n    var beforeUnloadDelegate;\n    var legacyEditors = [];\n    var editors = [];\n    var isValidLegacyKey = function (id) {\n      return id !== 'length';\n    };\n    var globalEventDelegate = function (e) {\n      var type = e.type;\n      each$j(EditorManager.get(), function (editor) {\n        switch (type) {\n        case 'scroll':\n          editor.fire('ScrollWindow', e);\n          break;\n        case 'resize':\n          editor.fire('ResizeWindow', e);\n          break;\n        }\n      });\n    };\n    var toggleGlobalEvents = function (state) {\n      if (state !== boundGlobalEvents) {\n        if (state) {\n          DomQuery(window).on('resize scroll', globalEventDelegate);\n        } else {\n          DomQuery(window).off('resize scroll', globalEventDelegate);\n        }\n        boundGlobalEvents = state;\n      }\n    };\n    var removeEditorFromList = function (targetEditor) {\n      var oldEditors = editors;\n      delete legacyEditors[targetEditor.id];\n      for (var i = 0; i < legacyEditors.length; i++) {\n        if (legacyEditors[i] === targetEditor) {\n          legacyEditors.splice(i, 1);\n          break;\n        }\n      }\n      editors = filter(editors, function (editor) {\n        return targetEditor !== editor;\n      });\n      if (EditorManager.activeEditor === targetEditor) {\n        EditorManager.activeEditor = editors.length > 0 ? editors[0] : null;\n      }\n      if (EditorManager.focusedEditor === targetEditor) {\n        EditorManager.focusedEditor = null;\n      }\n      return oldEditors.length !== editors.length;\n    };\n    var purgeDestroyedEditor = function (editor) {\n      if (editor && editor.initialized && !(editor.getContainer() || editor.getBody()).parentNode) {\n        removeEditorFromList(editor);\n        editor.unbindAllNativeEvents();\n        editor.destroy(true);\n        editor.removed = true;\n        editor = null;\n      }\n      return editor;\n    };\n    var isQuirksMode = document.compatMode !== 'CSS1Compat';\n    var EditorManager = __assign(__assign({}, Observable), {\n      baseURI: null,\n      baseURL: null,\n      defaultSettings: {},\n      documentBaseURL: null,\n      suffix: null,\n      $: DomQuery,\n      majorVersion: '5',\n      minorVersion: '6.2',\n      releaseDate: '2020-12-08',\n      editors: legacyEditors,\n      i18n: I18n,\n      activeEditor: null,\n      focusedEditor: null,\n      settings: {},\n      setup: function () {\n        var self = this;\n        var baseURL, documentBaseURL, suffix = '';\n        documentBaseURL = URI.getDocumentBaseUrl(document.location);\n        if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(documentBaseURL)) {\n          documentBaseURL = documentBaseURL.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n          if (!/[\\/\\\\]$/.test(documentBaseURL)) {\n            documentBaseURL += '/';\n          }\n        }\n        var preInit = window.tinymce || window.tinyMCEPreInit;\n        if (preInit) {\n          baseURL = preInit.base || preInit.baseURL;\n          suffix = preInit.suffix;\n        } else {\n          var scripts = document.getElementsByTagName('script');\n          for (var i = 0; i < scripts.length; i++) {\n            var src = scripts[i].src || '';\n            if (src === '') {\n              continue;\n            }\n            var srcScript = src.substring(src.lastIndexOf('/'));\n            if (/tinymce(\\.full|\\.jquery|)(\\.min|\\.dev|)\\.js/.test(src)) {\n              if (srcScript.indexOf('.min') !== -1) {\n                suffix = '.min';\n              }\n              baseURL = src.substring(0, src.lastIndexOf('/'));\n              break;\n            }\n          }\n          if (!baseURL && document.currentScript) {\n            var src = document.currentScript.src;\n            if (src.indexOf('.min') !== -1) {\n              suffix = '.min';\n            }\n            baseURL = src.substring(0, src.lastIndexOf('/'));\n          }\n        }\n        self.baseURL = new URI(documentBaseURL).toAbsolute(baseURL);\n        self.documentBaseURL = documentBaseURL;\n        self.baseURI = new URI(self.baseURL);\n        self.suffix = suffix;\n        setup$2(self);\n      },\n      overrideDefaults: function (defaultSettings) {\n        var baseUrl = defaultSettings.base_url;\n        if (baseUrl) {\n          this._setBaseUrl(baseUrl);\n        }\n        var suffix = defaultSettings.suffix;\n        if (defaultSettings.suffix) {\n          this.suffix = suffix;\n        }\n        this.defaultSettings = defaultSettings;\n        var pluginBaseUrls = defaultSettings.plugin_base_urls;\n        if (pluginBaseUrls !== undefined) {\n          each$1(pluginBaseUrls, function (pluginBaseUrl, pluginName) {\n            AddOnManager$1.PluginManager.urls[pluginName] = pluginBaseUrl;\n          });\n        }\n      },\n      init: function (settings) {\n        var self = this;\n        var result;\n        var invalidInlineTargets = Tools.makeMap('area base basefont br col frame hr img input isindex link meta param embed source wbr track ' + 'colgroup option table tbody tfoot thead tr th td script noscript style textarea video audio iframe object menu', ' ');\n        var isInvalidInlineTarget = function (settings, elm) {\n          return settings.inline && elm.tagName.toLowerCase() in invalidInlineTargets;\n        };\n        var createId = function (elm) {\n          var id = elm.id;\n          if (!id) {\n            id = get$1(elm, 'name').filter(function (name) {\n              return !DOM$a.get(name);\n            }).getOrThunk(DOM$a.uniqueId);\n            elm.setAttribute('id', id);\n          }\n          return id;\n        };\n        var execCallback = function (name) {\n          var callback = settings[name];\n          if (!callback) {\n            return;\n          }\n          return callback.apply(self, Array.prototype.slice.call(arguments, 2));\n        };\n        var hasClass = function (elm, className) {\n          return className.constructor === RegExp ? className.test(elm.className) : DOM$a.hasClass(elm, className);\n        };\n        var findTargets = function (settings) {\n          var targets = [];\n          if (Env.browser.isIE() && Env.browser.version.major < 11) {\n            initError('TinyMCE does not support the browser you are using. For a list of supported' + ' browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/');\n            return [];\n          } else if (isQuirksMode) {\n            initError('Failed to initialize the editor as the document is not in standards mode. ' + 'TinyMCE requires standards mode.');\n            return [];\n          }\n          if (settings.types) {\n            each$j(settings.types, function (type) {\n              targets = targets.concat(DOM$a.select(type.selector));\n            });\n            return targets;\n          } else if (settings.selector) {\n            return DOM$a.select(settings.selector);\n          } else if (settings.target) {\n            return [settings.target];\n          }\n          switch (settings.mode) {\n          case 'exact':\n            var l = settings.elements || '';\n            if (l.length > 0) {\n              each$j(explode$4(l), function (id) {\n                var elm = DOM$a.get(id);\n                if (elm) {\n                  targets.push(elm);\n                } else {\n                  each$j(document.forms, function (f) {\n                    each$j(f.elements, function (e) {\n                      if (e.name === id) {\n                        id = 'mce_editor_' + instanceCounter++;\n                        DOM$a.setAttrib(e, 'id', id);\n                        targets.push(e);\n                      }\n                    });\n                  });\n                }\n              });\n            }\n            break;\n          case 'textareas':\n          case 'specific_textareas':\n            each$j(DOM$a.select('textarea'), function (elm) {\n              if (settings.editor_deselector && hasClass(elm, settings.editor_deselector)) {\n                return;\n              }\n              if (!settings.editor_selector || hasClass(elm, settings.editor_selector)) {\n                targets.push(elm);\n              }\n            });\n            break;\n          }\n          return targets;\n        };\n        var provideResults = function (editors) {\n          result = editors;\n        };\n        var initEditors = function () {\n          var initCount = 0;\n          var editors = [];\n          var targets;\n          var createEditor = function (id, settings, targetElm) {\n            var editor = new Editor(id, settings, self);\n            editors.push(editor);\n            editor.on('init', function () {\n              if (++initCount === targets.length) {\n                provideResults(editors);\n              }\n            });\n            editor.targetElm = editor.targetElm || targetElm;\n            editor.render();\n          };\n          DOM$a.unbind(window, 'ready', initEditors);\n          execCallback('onpageload');\n          targets = DomQuery.unique(findTargets(settings));\n          if (settings.types) {\n            each$j(settings.types, function (type) {\n              Tools.each(targets, function (elm) {\n                if (DOM$a.is(elm, type.selector)) {\n                  createEditor(createId(elm), extend$4({}, settings, type), elm);\n                  return false;\n                }\n                return true;\n              });\n            });\n            return;\n          }\n          Tools.each(targets, function (elm) {\n            purgeDestroyedEditor(self.get(elm.id));\n          });\n          targets = Tools.grep(targets, function (elm) {\n            return !self.get(elm.id);\n          });\n          if (targets.length === 0) {\n            provideResults([]);\n          } else {\n            each$j(targets, function (elm) {\n              if (isInvalidInlineTarget(settings, elm)) {\n                initError('Could not initialize inline editor on invalid inline target element', elm);\n              } else {\n                createEditor(createId(elm), settings, elm);\n              }\n            });\n          }\n        };\n        self.settings = settings;\n        DOM$a.bind(window, 'ready', initEditors);\n        return new promiseObj(function (resolve) {\n          if (result) {\n            resolve(result);\n          } else {\n            provideResults = function (editors) {\n              resolve(editors);\n            };\n          }\n        });\n      },\n      get: function (id) {\n        if (arguments.length === 0) {\n          return editors.slice(0);\n        } else if (isString(id)) {\n          return find(editors, function (editor) {\n            return editor.id === id;\n          }).getOr(null);\n        } else if (isNumber(id)) {\n          return editors[id] ? editors[id] : null;\n        } else {\n          return null;\n        }\n      },\n      add: function (editor) {\n        var self = this;\n        var existingEditor = legacyEditors[editor.id];\n        if (existingEditor === editor) {\n          return editor;\n        }\n        if (self.get(editor.id) === null) {\n          if (isValidLegacyKey(editor.id)) {\n            legacyEditors[editor.id] = editor;\n          }\n          legacyEditors.push(editor);\n          editors.push(editor);\n        }\n        toggleGlobalEvents(true);\n        self.activeEditor = editor;\n        self.fire('AddEditor', { editor: editor });\n        if (!beforeUnloadDelegate) {\n          beforeUnloadDelegate = function (e) {\n            var event = self.fire('BeforeUnload');\n            if (event.returnValue) {\n              e.preventDefault();\n              e.returnValue = event.returnValue;\n              return event.returnValue;\n            }\n          };\n          window.addEventListener('beforeunload', beforeUnloadDelegate);\n        }\n        return editor;\n      },\n      createEditor: function (id, settings) {\n        return this.add(new Editor(id, settings, this));\n      },\n      remove: function (selector) {\n        var self = this;\n        var i, editor;\n        if (!selector) {\n          for (i = editors.length - 1; i >= 0; i--) {\n            self.remove(editors[i]);\n          }\n          return;\n        }\n        if (isString(selector)) {\n          each$j(DOM$a.select(selector), function (elm) {\n            editor = self.get(elm.id);\n            if (editor) {\n              self.remove(editor);\n            }\n          });\n          return;\n        }\n        editor = selector;\n        if (isNull(self.get(editor.id))) {\n          return null;\n        }\n        if (removeEditorFromList(editor)) {\n          self.fire('RemoveEditor', { editor: editor });\n        }\n        if (editors.length === 0) {\n          window.removeEventListener('beforeunload', beforeUnloadDelegate);\n        }\n        editor.remove();\n        toggleGlobalEvents(editors.length > 0);\n        return editor;\n      },\n      execCommand: function (cmd, ui, value) {\n        var self = this, editor = self.get(value);\n        switch (cmd) {\n        case 'mceAddEditor':\n          if (!self.get(value)) {\n            new Editor(value, self.settings, self).render();\n          }\n          return true;\n        case 'mceRemoveEditor':\n          if (editor) {\n            editor.remove();\n          }\n          return true;\n        case 'mceToggleEditor':\n          if (!editor) {\n            self.execCommand('mceAddEditor', 0, value);\n            return true;\n          }\n          if (editor.isHidden()) {\n            editor.show();\n          } else {\n            editor.hide();\n          }\n          return true;\n        }\n        if (self.activeEditor) {\n          return self.activeEditor.execCommand(cmd, ui, value);\n        }\n        return false;\n      },\n      triggerSave: function () {\n        each$j(editors, function (editor) {\n          editor.save();\n        });\n      },\n      addI18n: function (code, items) {\n        I18n.add(code, items);\n      },\n      translate: function (text) {\n        return I18n.translate(text);\n      },\n      setActive: function (editor) {\n        var activeEditor = this.activeEditor;\n        if (this.activeEditor !== editor) {\n          if (activeEditor) {\n            activeEditor.fire('deactivate', { relatedTarget: editor });\n          }\n          editor.fire('activate', { relatedTarget: activeEditor });\n        }\n        this.activeEditor = editor;\n      },\n      _setBaseUrl: function (baseUrl) {\n        this.baseURL = new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\\/+$/, ''));\n        this.baseURI = new URI(this.baseURL);\n      }\n    });\n    EditorManager.setup();\n\n    var min = Math.min, max = Math.max, round$1 = Math.round;\n    var relativePosition = function (rect, targetRect, rel) {\n      var x = targetRect.x;\n      var y = targetRect.y;\n      var w = rect.w;\n      var h = rect.h;\n      var targetW = targetRect.w;\n      var targetH = targetRect.h;\n      var relChars = (rel || '').split('');\n      if (relChars[0] === 'b') {\n        y += targetH;\n      }\n      if (relChars[1] === 'r') {\n        x += targetW;\n      }\n      if (relChars[0] === 'c') {\n        y += round$1(targetH / 2);\n      }\n      if (relChars[1] === 'c') {\n        x += round$1(targetW / 2);\n      }\n      if (relChars[3] === 'b') {\n        y -= h;\n      }\n      if (relChars[4] === 'r') {\n        x -= w;\n      }\n      if (relChars[3] === 'c') {\n        y -= round$1(h / 2);\n      }\n      if (relChars[4] === 'c') {\n        x -= round$1(w / 2);\n      }\n      return create$7(x, y, w, h);\n    };\n    var findBestRelativePosition = function (rect, targetRect, constrainRect, rels) {\n      var pos, i;\n      for (i = 0; i < rels.length; i++) {\n        pos = relativePosition(rect, targetRect, rels[i]);\n        if (pos.x >= constrainRect.x && pos.x + pos.w <= constrainRect.w + constrainRect.x && pos.y >= constrainRect.y && pos.y + pos.h <= constrainRect.h + constrainRect.y) {\n          return rels[i];\n        }\n      }\n      return null;\n    };\n    var inflate = function (rect, w, h) {\n      return create$7(rect.x - w, rect.y - h, rect.w + w * 2, rect.h + h * 2);\n    };\n    var intersect = function (rect, cropRect) {\n      var x1 = max(rect.x, cropRect.x);\n      var y1 = max(rect.y, cropRect.y);\n      var x2 = min(rect.x + rect.w, cropRect.x + cropRect.w);\n      var y2 = min(rect.y + rect.h, cropRect.y + cropRect.h);\n      if (x2 - x1 < 0 || y2 - y1 < 0) {\n        return null;\n      }\n      return create$7(x1, y1, x2 - x1, y2 - y1);\n    };\n    var clamp$1 = function (rect, clampRect, fixedSize) {\n      var x1 = rect.x;\n      var y1 = rect.y;\n      var x2 = rect.x + rect.w;\n      var y2 = rect.y + rect.h;\n      var cx2 = clampRect.x + clampRect.w;\n      var cy2 = clampRect.y + clampRect.h;\n      var underflowX1 = max(0, clampRect.x - x1);\n      var underflowY1 = max(0, clampRect.y - y1);\n      var overflowX2 = max(0, x2 - cx2);\n      var overflowY2 = max(0, y2 - cy2);\n      x1 += underflowX1;\n      y1 += underflowY1;\n      if (fixedSize) {\n        x2 += underflowX1;\n        y2 += underflowY1;\n        x1 -= overflowX2;\n        y1 -= overflowY2;\n      }\n      x2 -= overflowX2;\n      y2 -= overflowY2;\n      return create$7(x1, y1, x2 - x1, y2 - y1);\n    };\n    var create$7 = function (x, y, w, h) {\n      return {\n        x: x,\n        y: y,\n        w: w,\n        h: h\n      };\n    };\n    var fromClientRect = function (clientRect) {\n      return create$7(clientRect.left, clientRect.top, clientRect.width, clientRect.height);\n    };\n    var Rect = {\n      inflate: inflate,\n      relativePosition: relativePosition,\n      findBestRelativePosition: findBestRelativePosition,\n      intersect: intersect,\n      clamp: clamp$1,\n      create: create$7,\n      fromClientRect: fromClientRect\n    };\n\n    var awaiter = function (resolveCb, rejectCb, timeout) {\n      if (timeout === void 0) {\n        timeout = 1000;\n      }\n      var done = false;\n      var timer = null;\n      var complete = function (completer) {\n        return function () {\n          var args = [];\n          for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n          }\n          if (!done) {\n            done = true;\n            if (timer !== null) {\n              clearTimeout(timer);\n              timer = null;\n            }\n            completer.apply(null, args);\n          }\n        };\n      };\n      var resolve = complete(resolveCb);\n      var reject = complete(rejectCb);\n      var start = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (!done && timer === null) {\n          timer = setTimeout(function () {\n            return reject.apply(null, args);\n          }, timeout);\n        }\n      };\n      return {\n        start: start,\n        resolve: resolve,\n        reject: reject\n      };\n    };\n    var create$8 = function () {\n      var tasks = {};\n      var resultFns = {};\n      var load = function (id, url) {\n        var loadErrMsg = 'Script at URL \"' + url + '\" failed to load';\n        var runErrMsg = 'Script at URL \"' + url + '\" did not call `tinymce.Resource.add(\\'' + id + '\\', data)` within 1 second';\n        if (tasks[id] !== undefined) {\n          return tasks[id];\n        } else {\n          var task = new promiseObj(function (resolve, reject) {\n            var waiter = awaiter(resolve, reject);\n            resultFns[id] = waiter.resolve;\n            ScriptLoader.ScriptLoader.loadScript(url, function () {\n              return waiter.start(runErrMsg);\n            }, function () {\n              return waiter.reject(loadErrMsg);\n            });\n          });\n          tasks[id] = task;\n          return task;\n        }\n      };\n      var add = function (id, data) {\n        if (resultFns[id] !== undefined) {\n          resultFns[id](data);\n          delete resultFns[id];\n        }\n        tasks[id] = promiseObj.resolve(data);\n      };\n      return {\n        load: load,\n        add: add\n      };\n    };\n    var Resource = create$8();\n\n    var each$k = Tools.each, extend$5 = Tools.extend;\n    var extendClass, initializing;\n    var Class = function () {\n    };\n    Class.extend = extendClass = function (props) {\n      var self = this;\n      var _super = self.prototype;\n      var Class = function () {\n        var i, mixins, mixin;\n        var self = this;\n        if (!initializing) {\n          if (self.init) {\n            self.init.apply(self, arguments);\n          }\n          mixins = self.Mixins;\n          if (mixins) {\n            i = mixins.length;\n            while (i--) {\n              mixin = mixins[i];\n              if (mixin.init) {\n                mixin.init.apply(self, arguments);\n              }\n            }\n          }\n        }\n      };\n      var dummy = function () {\n        return this;\n      };\n      var createMethod = function (name, fn) {\n        return function () {\n          var self = this;\n          var tmp = self._super;\n          self._super = _super[name];\n          var ret = fn.apply(self, arguments);\n          self._super = tmp;\n          return ret;\n        };\n      };\n      initializing = true;\n      var prototype = new self();\n      initializing = false;\n      if (props.Mixins) {\n        each$k(props.Mixins, function (mixin) {\n          for (var name_1 in mixin) {\n            if (name_1 !== 'init') {\n              props[name_1] = mixin[name_1];\n            }\n          }\n        });\n        if (_super.Mixins) {\n          props.Mixins = _super.Mixins.concat(props.Mixins);\n        }\n      }\n      if (props.Methods) {\n        each$k(props.Methods.split(','), function (name) {\n          props[name] = dummy;\n        });\n      }\n      if (props.Properties) {\n        each$k(props.Properties.split(','), function (name) {\n          var fieldName = '_' + name;\n          props[name] = function (value) {\n            var self = this;\n            if (value !== undefined) {\n              self[fieldName] = value;\n              return self;\n            }\n            return self[fieldName];\n          };\n        });\n      }\n      if (props.Statics) {\n        each$k(props.Statics, function (func, name) {\n          Class[name] = func;\n        });\n      }\n      if (props.Defaults && _super.Defaults) {\n        props.Defaults = extend$5({}, _super.Defaults, props.Defaults);\n      }\n      each$1(props, function (member, name) {\n        if (typeof member === 'function' && _super[name]) {\n          prototype[name] = createMethod(name, member);\n        } else {\n          prototype[name] = member;\n        }\n      });\n      Class.prototype = prototype;\n      Class.constructor = Class;\n      Class.extend = extendClass;\n      return Class;\n    };\n\n    var min$1 = Math.min, max$1 = Math.max, round$2 = Math.round;\n    var Color = function (value) {\n      var self = {};\n      var r = 0, g = 0, b = 0;\n      var rgb2hsv = function (r, g, b) {\n        var h, s, v;\n        h = 0;\n        s = 0;\n        v = 0;\n        r = r / 255;\n        g = g / 255;\n        b = b / 255;\n        var minRGB = min$1(r, min$1(g, b));\n        var maxRGB = max$1(r, max$1(g, b));\n        if (minRGB === maxRGB) {\n          v = minRGB;\n          return {\n            h: 0,\n            s: 0,\n            v: v * 100\n          };\n        }\n        var d = r === minRGB ? g - b : b === minRGB ? r - g : b - r;\n        h = r === minRGB ? 3 : b === minRGB ? 1 : 5;\n        h = 60 * (h - d / (maxRGB - minRGB));\n        s = (maxRGB - minRGB) / maxRGB;\n        v = maxRGB;\n        return {\n          h: round$2(h),\n          s: round$2(s * 100),\n          v: round$2(v * 100)\n        };\n      };\n      var hsvToRgb = function (hue, saturation, brightness) {\n        hue = (parseInt(hue, 10) || 0) % 360;\n        saturation = parseInt(saturation, 10) / 100;\n        brightness = parseInt(brightness, 10) / 100;\n        saturation = max$1(0, min$1(saturation, 1));\n        brightness = max$1(0, min$1(brightness, 1));\n        if (saturation === 0) {\n          r = g = b = round$2(255 * brightness);\n          return;\n        }\n        var side = hue / 60;\n        var chroma = brightness * saturation;\n        var x = chroma * (1 - Math.abs(side % 2 - 1));\n        var match = brightness - chroma;\n        switch (Math.floor(side)) {\n        case 0:\n          r = chroma;\n          g = x;\n          b = 0;\n          break;\n        case 1:\n          r = x;\n          g = chroma;\n          b = 0;\n          break;\n        case 2:\n          r = 0;\n          g = chroma;\n          b = x;\n          break;\n        case 3:\n          r = 0;\n          g = x;\n          b = chroma;\n          break;\n        case 4:\n          r = x;\n          g = 0;\n          b = chroma;\n          break;\n        case 5:\n          r = chroma;\n          g = 0;\n          b = x;\n          break;\n        default:\n          r = g = b = 0;\n        }\n        r = round$2(255 * (r + match));\n        g = round$2(255 * (g + match));\n        b = round$2(255 * (b + match));\n      };\n      var toHex = function () {\n        var hex = function (val) {\n          val = parseInt(val, 10).toString(16);\n          return val.length > 1 ? val : '0' + val;\n        };\n        return '#' + hex(r) + hex(g) + hex(b);\n      };\n      var toRgb = function () {\n        return {\n          r: r,\n          g: g,\n          b: b\n        };\n      };\n      var toHsv = function () {\n        return rgb2hsv(r, g, b);\n      };\n      var parse = function (value) {\n        var matches;\n        if (typeof value === 'object') {\n          if ('r' in value) {\n            r = value.r;\n            g = value.g;\n            b = value.b;\n          } else if ('v' in value) {\n            hsvToRgb(value.h, value.s, value.v);\n          }\n        } else {\n          if (matches = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)[^\\)]*\\)/gi.exec(value)) {\n            r = parseInt(matches[1], 10);\n            g = parseInt(matches[2], 10);\n            b = parseInt(matches[3], 10);\n          } else if (matches = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value)) {\n            r = parseInt(matches[1], 16);\n            g = parseInt(matches[2], 16);\n            b = parseInt(matches[3], 16);\n          } else if (matches = /#([0-F])([0-F])([0-F])/gi.exec(value)) {\n            r = parseInt(matches[1] + matches[1], 16);\n            g = parseInt(matches[2] + matches[2], 16);\n            b = parseInt(matches[3] + matches[3], 16);\n          }\n        }\n        r = r < 0 ? 0 : r > 255 ? 255 : r;\n        g = g < 0 ? 0 : g > 255 ? 255 : g;\n        b = b < 0 ? 0 : b > 255 ? 255 : b;\n        return self;\n      };\n      if (value) {\n        parse(value);\n      }\n      self.toRgb = toRgb;\n      self.toHsv = toHsv;\n      self.toHex = toHex;\n      self.parse = parse;\n      return self;\n    };\n\n    var serialize = function (obj) {\n      var data = JSON.stringify(obj);\n      if (!isString(data)) {\n        return data;\n      }\n      return data.replace(/[\\u0080-\\uFFFF]/g, function (match) {\n        var hexCode = match.charCodeAt(0).toString(16);\n        return '\\\\u' + '0000'.substring(hexCode.length) + hexCode;\n      });\n    };\n    var JSONUtils = {\n      serialize: serialize,\n      parse: function (text) {\n        try {\n          return JSON.parse(text);\n        } catch (ex) {\n        }\n      }\n    };\n\n    var JSONP = {\n      callbacks: {},\n      count: 0,\n      send: function (settings) {\n        var self = this, dom = DOMUtils$1.DOM, count = settings.count !== undefined ? settings.count : self.count;\n        var id = 'tinymce_jsonp_' + count;\n        self.callbacks[count] = function (json) {\n          dom.remove(id);\n          delete self.callbacks[count];\n          settings.callback(json);\n        };\n        dom.add(dom.doc.body, 'script', {\n          id: id,\n          src: settings.url,\n          type: 'text/javascript'\n        });\n        self.count++;\n      }\n    };\n\n    var XHR = __assign(__assign({}, Observable), {\n      send: function (settings) {\n        var xhr, count = 0;\n        var ready = function () {\n          if (!settings.async || xhr.readyState === 4 || count++ > 10000) {\n            if (settings.success && count < 10000 && xhr.status === 200) {\n              settings.success.call(settings.success_scope, '' + xhr.responseText, xhr, settings);\n            } else if (settings.error) {\n              settings.error.call(settings.error_scope, count > 10000 ? 'TIMED_OUT' : 'GENERAL', xhr, settings);\n            }\n            xhr = null;\n          } else {\n            Delay.setTimeout(ready, 10);\n          }\n        };\n        settings.scope = settings.scope || this;\n        settings.success_scope = settings.success_scope || settings.scope;\n        settings.error_scope = settings.error_scope || settings.scope;\n        settings.async = settings.async !== false;\n        settings.data = settings.data || '';\n        XHR.fire('beforeInitialize', { settings: settings });\n        xhr = new XMLHttpRequest();\n        if (xhr.overrideMimeType) {\n          xhr.overrideMimeType(settings.content_type);\n        }\n        xhr.open(settings.type || (settings.data ? 'POST' : 'GET'), settings.url, settings.async);\n        if (settings.crossDomain) {\n          xhr.withCredentials = true;\n        }\n        if (settings.content_type) {\n          xhr.setRequestHeader('Content-Type', settings.content_type);\n        }\n        if (settings.requestheaders) {\n          Tools.each(settings.requestheaders, function (header) {\n            xhr.setRequestHeader(header.key, header.value);\n          });\n        }\n        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n        xhr = XHR.fire('beforeSend', {\n          xhr: xhr,\n          settings: settings\n        }).xhr;\n        xhr.send(settings.data);\n        if (!settings.async) {\n          return ready();\n        }\n        Delay.setTimeout(ready, 10);\n      }\n    });\n\n    var extend$6 = Tools.extend;\n    var JSONRequest = function () {\n      function JSONRequest(settings) {\n        this.settings = extend$6({}, settings);\n        this.count = 0;\n      }\n      JSONRequest.sendRPC = function (o) {\n        return new JSONRequest().send(o);\n      };\n      JSONRequest.prototype.send = function (args) {\n        var ecb = args.error, scb = args.success;\n        var xhrArgs = extend$6(this.settings, args);\n        xhrArgs.success = function (c, x) {\n          c = JSONUtils.parse(c);\n          if (typeof c === 'undefined') {\n            c = { error: 'JSON Parse error.' };\n          }\n          if (c.error) {\n            ecb.call(xhrArgs.error_scope || xhrArgs.scope, c.error, x);\n          } else {\n            scb.call(xhrArgs.success_scope || xhrArgs.scope, c.result);\n          }\n        };\n        xhrArgs.error = function (ty, x) {\n          if (ecb) {\n            ecb.call(xhrArgs.error_scope || xhrArgs.scope, ty, x);\n          }\n        };\n        xhrArgs.data = JSONUtils.serialize({\n          id: args.id || 'c' + this.count++,\n          method: args.method,\n          params: args.params\n        });\n        xhrArgs.content_type = 'application/json';\n        XHR.send(xhrArgs);\n      };\n      return JSONRequest;\n    }();\n\n    var create$9 = function () {\n      return function () {\n        var data = {};\n        var keys = [];\n        var storage = {\n          getItem: function (key) {\n            var item = data[key];\n            return item ? item : null;\n          },\n          setItem: function (key, value) {\n            keys.push(key);\n            data[key] = String(value);\n          },\n          key: function (index) {\n            return keys[index];\n          },\n          removeItem: function (key) {\n            keys = keys.filter(function (k) {\n              return k === key;\n            });\n            delete data[key];\n          },\n          clear: function () {\n            keys = [];\n            data = {};\n          },\n          length: 0\n        };\n        Object.defineProperty(storage, 'length', {\n          get: function () {\n            return keys.length;\n          },\n          configurable: false,\n          enumerable: false\n        });\n        return storage;\n      }();\n    };\n\n    var localStorage;\n    try {\n      var test = '__storage_test__';\n      localStorage = window.localStorage;\n      localStorage.setItem(test, test);\n      localStorage.removeItem(test);\n    } catch (e) {\n      localStorage = create$9();\n    }\n    var LocalStorage = localStorage;\n\n    var publicApi = {\n      geom: { Rect: Rect },\n      util: {\n        Promise: promiseObj,\n        Delay: Delay,\n        Tools: Tools,\n        VK: VK,\n        URI: URI,\n        Class: Class,\n        EventDispatcher: EventDispatcher,\n        Observable: Observable,\n        I18n: I18n,\n        XHR: XHR,\n        JSON: JSONUtils,\n        JSONRequest: JSONRequest,\n        JSONP: JSONP,\n        LocalStorage: LocalStorage,\n        Color: Color\n      },\n      dom: {\n        EventUtils: EventUtils,\n        Sizzle: Sizzle,\n        DomQuery: DomQuery,\n        TreeWalker: DomTreeWalker,\n        TextSeeker: TextSeeker,\n        DOMUtils: DOMUtils$1,\n        ScriptLoader: ScriptLoader,\n        RangeUtils: RangeUtils$1,\n        Serializer: DomSerializer,\n        StyleSheetLoader: StyleSheetLoader,\n        ControlSelection: ControlSelection,\n        BookmarkManager: BookmarkManager$1,\n        Selection: EditorSelection,\n        Event: EventUtils.Event\n      },\n      html: {\n        Styles: Styles,\n        Entities: Entities,\n        Node: AstNode,\n        Schema: Schema,\n        SaxParser: SaxParser$1,\n        DomParser: DomParser,\n        Writer: Writer,\n        Serializer: HtmlSerializer\n      },\n      Env: Env,\n      AddOnManager: AddOnManager$1,\n      Annotator: Annotator,\n      Formatter: Formatter,\n      UndoManager: UndoManager,\n      EditorCommands: EditorCommands,\n      WindowManager: WindowManager,\n      NotificationManager: NotificationManager,\n      EditorObservable: EditorObservable,\n      Shortcuts: Shortcuts,\n      Editor: Editor,\n      FocusManager: FocusManager,\n      EditorManager: EditorManager,\n      DOM: DOMUtils$1.DOM,\n      ScriptLoader: ScriptLoader.ScriptLoader,\n      PluginManager: PluginManager,\n      ThemeManager: ThemeManager,\n      IconManager: IconManager,\n      Resource: Resource,\n      trim: Tools.trim,\n      isArray: Tools.isArray,\n      is: Tools.is,\n      toArray: Tools.toArray,\n      makeMap: Tools.makeMap,\n      each: Tools.each,\n      map: Tools.map,\n      grep: Tools.grep,\n      inArray: Tools.inArray,\n      extend: Tools.extend,\n      create: Tools.create,\n      walk: Tools.walk,\n      createNS: Tools.createNS,\n      resolve: Tools.resolve,\n      explode: Tools.explode,\n      _addCacheSuffix: Tools._addCacheSuffix,\n      isOpera: Env.opera,\n      isWebKit: Env.webkit,\n      isIE: Env.ie,\n      isGecko: Env.gecko,\n      isMac: Env.mac\n    };\n    var tinymce = Tools.extend(EditorManager, publicApi);\n\n    var exportToModuleLoaders = function (tinymce) {\n      if (typeof module === 'object') {\n        try {\n          module.exports = tinymce;\n        } catch (_) {\n        }\n      }\n    };\n    var exportToWindowGlobal = function (tinymce) {\n      window.tinymce = tinymce;\n      window.tinyMCE = tinymce;\n    };\n    exportToWindowGlobal(tinymce);\n    exportToModuleLoaders(tinymce);\n\n}());\n"]},"metadata":{},"sourceType":"script"}